<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 12.3.0"/>
    <title>datagenerator.Faults API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent }nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .pdoc-alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:1rem center;margin-bottom:1rem;}.pdoc .pdoc-alert > *:last-child{margin-bottom:0;}.pdoc .pdoc-alert-note {color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--code);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="../datagenerator.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                &nbsp;datagenerator</a>


            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>



        <h2>API Documentation</h2>
            <ul class="memberlist">
            <li>
                    <a class="class" href="#Faults">Faults</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#Faults.__init__">Faults</a>
                        </li>
                        <li>
                                <a class="function" href="#Faults.apply_faulting_to_geomodels_and_depth_maps">apply_faulting_to_geomodels_and_depth_maps</a>
                        </li>
                        <li>
                                <a class="function" href="#Faults.build_faulted_property_geomodels">build_faulted_property_geomodels</a>
                        </li>
                        <li>
                                <a class="function" href="#Faults.create_qc_plots">create_qc_plots</a>
                        </li>
                        <li>
                                <a class="function" href="#Faults.generate_faults">generate_faults</a>
                        </li>
                        <li>
                                <a class="function" href="#Faults.fault_parameters">fault_parameters</a>
                        </li>
                        <li>
                                <a class="function" href="#Faults.build_faults">build_faults</a>
                        </li>
                        <li>
                                <a class="function" href="#Faults.improve_depth_maps_post_faulting">improve_depth_maps_post_faulting</a>
                        </li>
                        <li>
                                <a class="function" href="#Faults.partial_faulting">partial_faulting</a>
                        </li>
                        <li>
                                <a class="function" href="#Faults.get_displacement_vector">get_displacement_vector</a>
                        </li>
                        <li>
                                <a class="function" href="#Faults.apply_xyz_displacement">apply_xyz_displacement</a>
                        </li>
                        <li>
                                <a class="function" href="#Faults.copy_and_divide_depth_maps_by_infill">copy_and_divide_depth_maps_by_infill</a>
                        </li>
                        <li>
                                <a class="function" href="#Faults.rotate_3d_ellipsoid">rotate_3d_ellipsoid</a>
                        </li>
                        <li>
                                <a class="function" href="#Faults.apply_3d_rotation">apply_3d_rotation</a>
                        </li>
                        <li>
                                <a class="function" href="#Faults.get_fault_plane_sobel">get_fault_plane_sobel</a>
                        </li>
                        <li>
                                <a class="function" href="#Faults.get_fault_centre">get_fault_centre</a>
                        </li>
                        <li>
                                <a class="function" href="#Faults.xyz_dis">xyz_dis</a>
                        </li>
                        <li>
                                <a class="function" href="#Faults.fault_summary_plot">fault_summary_plot</a>
                        </li>
                        <li>
                                <a class="function" href="#Faults.create_binary_segmentations_post_faulting">create_binary_segmentations_post_faulting</a>
                        </li>
                        <li>
                                <a class="function" href="#Faults.reassign_channel_segment_encoding">reassign_channel_segment_encoding</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="function" href="#find_zero_thickness_onlapping_layers">find_zero_thickness_onlapping_layers</a>
            </li>
            <li>
                    <a class="function" href="#fix_zero_thickness_fan_layers">fix_zero_thickness_fan_layers</a>
            </li>
            <li>
                    <a class="function" href="#fix_zero_thickness_onlap_layers">fix_zero_thickness_onlap_layers</a>
            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
<a href="./../datagenerator.html">datagenerator</a><wbr>.Faults    </h1>

                
                        <input id="mod-Faults-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-Faults-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#-1"><span class="linenos">   1</span></a><span class="kn">import</span> <span class="nn">os</span>
</span><span id="L-2"><a href="#-2"><span class="linenos">   2</span></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span><span id="L-3"><a href="#-3"><span class="linenos">   3</span></a><span class="kn">from</span> <span class="nn">tqdm</span> <span class="kn">import</span> <span class="n">tqdm</span>
</span><span id="L-4"><a href="#-4"><span class="linenos">   4</span></a><span class="kn">from</span> <span class="nn">scipy.ndimage</span> <span class="kn">import</span> <span class="n">maximum_filter</span><span class="p">,</span> <span class="n">binary_dilation</span>
</span><span id="L-5"><a href="#-5"><span class="linenos">   5</span></a><span class="kn">from</span> <span class="nn">datagenerator.Horizons</span> <span class="kn">import</span> <span class="n">Horizons</span>
</span><span id="L-6"><a href="#-6"><span class="linenos">   6</span></a><span class="kn">from</span> <span class="nn">datagenerator.Geomodels</span> <span class="kn">import</span> <span class="n">Geomodel</span>
</span><span id="L-7"><a href="#-7"><span class="linenos">   7</span></a><span class="kn">from</span> <span class="nn">datagenerator.Parameters</span> <span class="kn">import</span> <span class="n">Parameters</span>
</span><span id="L-8"><a href="#-8"><span class="linenos">   8</span></a><span class="kn">from</span> <span class="nn">datagenerator.util</span> <span class="kn">import</span> <span class="n">write_data_to_hdf</span><span class="p">,</span> <span class="n">plot_3D_faults_plot</span>
</span><span id="L-9"><a href="#-9"><span class="linenos">   9</span></a><span class="kn">from</span> <span class="nn">skimage</span> <span class="kn">import</span> <span class="n">measure</span>
</span><span id="L-10"><a href="#-10"><span class="linenos">  10</span></a>
</span><span id="L-11"><a href="#-11"><span class="linenos">  11</span></a>
</span><span id="L-12"><a href="#-12"><span class="linenos">  12</span></a><span class="k">class</span> <span class="nc">Faults</span><span class="p">(</span><span class="n">Horizons</span><span class="p">,</span> <span class="n">Geomodel</span><span class="p">):</span>
</span><span id="L-13"><a href="#-13"><span class="linenos">  13</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-14"><a href="#-14"><span class="linenos">  14</span></a><span class="sd">    Faults Class</span>
</span><span id="L-15"><a href="#-15"><span class="linenos">  15</span></a><span class="sd">    ------------</span>
</span><span id="L-16"><a href="#-16"><span class="linenos">  16</span></a><span class="sd">    Describes the class for faulting the model.</span>
</span><span id="L-17"><a href="#-17"><span class="linenos">  17</span></a>
</span><span id="L-18"><a href="#-18"><span class="linenos">  18</span></a><span class="sd">    Parameters</span>
</span><span id="L-19"><a href="#-19"><span class="linenos">  19</span></a><span class="sd">    ----------</span>
</span><span id="L-20"><a href="#-20"><span class="linenos">  20</span></a><span class="sd">    Horizons : datagenerator.Horizons</span>
</span><span id="L-21"><a href="#-21"><span class="linenos">  21</span></a><span class="sd">        The Horizons class used to build the faults.</span>
</span><span id="L-22"><a href="#-22"><span class="linenos">  22</span></a><span class="sd">    Geomodel : data_generator.Geomodels</span>
</span><span id="L-23"><a href="#-23"><span class="linenos">  23</span></a><span class="sd">        The Geomodel class used to build the faults.</span>
</span><span id="L-24"><a href="#-24"><span class="linenos">  24</span></a><span class="sd">    </span>
</span><span id="L-25"><a href="#-25"><span class="linenos">  25</span></a><span class="sd">    Returns</span>
</span><span id="L-26"><a href="#-26"><span class="linenos">  26</span></a><span class="sd">    -------</span>
</span><span id="L-27"><a href="#-27"><span class="linenos">  27</span></a><span class="sd">    None</span>
</span><span id="L-28"><a href="#-28"><span class="linenos">  28</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-29"><a href="#-29"><span class="linenos">  29</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="L-30"><a href="#-30"><span class="linenos">  30</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-31"><a href="#-31"><span class="linenos">  31</span></a>        <span class="n">parameters</span><span class="p">:</span> <span class="n">Parameters</span><span class="p">,</span>
</span><span id="L-32"><a href="#-32"><span class="linenos">  32</span></a>        <span class="n">unfaulted_depth_maps</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
</span><span id="L-33"><a href="#-33"><span class="linenos">  33</span></a>        <span class="n">onlap_horizon_list</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
</span><span id="L-34"><a href="#-34"><span class="linenos">  34</span></a>        <span class="n">geomodels</span><span class="p">:</span> <span class="n">Geomodel</span><span class="p">,</span>
</span><span id="L-35"><a href="#-35"><span class="linenos">  35</span></a>        <span class="n">fan_horizon_list</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
</span><span id="L-36"><a href="#-36"><span class="linenos">  36</span></a>        <span class="n">fan_thickness</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
</span><span id="L-37"><a href="#-37"><span class="linenos">  37</span></a>    <span class="p">):</span>
</span><span id="L-38"><a href="#-38"><span class="linenos">  38</span></a>        <span class="sd">&quot;&quot;&quot;__init__</span>
</span><span id="L-39"><a href="#-39"><span class="linenos">  39</span></a>
</span><span id="L-40"><a href="#-40"><span class="linenos">  40</span></a><span class="sd">        Initializes the Faults class..</span>
</span><span id="L-41"><a href="#-41"><span class="linenos">  41</span></a>
</span><span id="L-42"><a href="#-42"><span class="linenos">  42</span></a><span class="sd">        Parameters</span>
</span><span id="L-43"><a href="#-43"><span class="linenos">  43</span></a><span class="sd">        ----------</span>
</span><span id="L-44"><a href="#-44"><span class="linenos">  44</span></a><span class="sd">        parameters : Parameters</span>
</span><span id="L-45"><a href="#-45"><span class="linenos">  45</span></a><span class="sd">            The parameters class.</span>
</span><span id="L-46"><a href="#-46"><span class="linenos">  46</span></a><span class="sd">        unfaulted_depth_maps : np.ndarray</span>
</span><span id="L-47"><a href="#-47"><span class="linenos">  47</span></a><span class="sd">            The depth maps to be faulted.</span>
</span><span id="L-48"><a href="#-48"><span class="linenos">  48</span></a><span class="sd">        onlap_horizon_list : np.ndarray</span>
</span><span id="L-49"><a href="#-49"><span class="linenos">  49</span></a><span class="sd">            The onlap horizon list.</span>
</span><span id="L-50"><a href="#-50"><span class="linenos">  50</span></a><span class="sd">        geomodels : Geomodel</span>
</span><span id="L-51"><a href="#-51"><span class="linenos">  51</span></a><span class="sd">            The geomodels class.</span>
</span><span id="L-52"><a href="#-52"><span class="linenos">  52</span></a><span class="sd">        fan_horizon_list : np.ndarray</span>
</span><span id="L-53"><a href="#-53"><span class="linenos">  53</span></a><span class="sd">            The fan horizon list.</span>
</span><span id="L-54"><a href="#-54"><span class="linenos">  54</span></a><span class="sd">        fan_thickness : np.ndarray</span>
</span><span id="L-55"><a href="#-55"><span class="linenos">  55</span></a><span class="sd">            The fan thickness list.</span>
</span><span id="L-56"><a href="#-56"><span class="linenos">  56</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-57"><a href="#-57"><span class="linenos">  57</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span> <span class="o">=</span> <span class="n">parameters</span>
</span><span id="L-58"><a href="#-58"><span class="linenos">  58</span></a>        <span class="c1"># Horizons</span>
</span><span id="L-59"><a href="#-59"><span class="linenos">  59</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">unfaulted_depth_maps</span> <span class="o">=</span> <span class="n">unfaulted_depth_maps</span>
</span><span id="L-60"><a href="#-60"><span class="linenos">  60</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">onlap_horizon_list</span> <span class="o">=</span> <span class="n">onlap_horizon_list</span>
</span><span id="L-61"><a href="#-61"><span class="linenos">  61</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fan_horizon_list</span> <span class="o">=</span> <span class="n">fan_horizon_list</span>
</span><span id="L-62"><a href="#-62"><span class="linenos">  62</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fan_thickness</span> <span class="o">=</span> <span class="n">fan_thickness</span>
</span><span id="L-63"><a href="#-63"><span class="linenos">  63</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">faulted_depth_maps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="L-64"><a href="#-64"><span class="linenos">  64</span></a>            <span class="s2">&quot;faulted_depth_maps&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">unfaulted_depth_maps</span><span class="o">.</span><span class="n">shape</span>
</span><span id="L-65"><a href="#-65"><span class="linenos">  65</span></a>        <span class="p">)</span>
</span><span id="L-66"><a href="#-66"><span class="linenos">  66</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">faulted_depth_maps_gaps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="L-67"><a href="#-67"><span class="linenos">  67</span></a>            <span class="s2">&quot;faulted_depth_maps_gaps&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">unfaulted_depth_maps</span><span class="o">.</span><span class="n">shape</span>
</span><span id="L-68"><a href="#-68"><span class="linenos">  68</span></a>        <span class="p">)</span>
</span><span id="L-69"><a href="#-69"><span class="linenos">  69</span></a>        <span class="c1"># Volumes</span>
</span><span id="L-70"><a href="#-70"><span class="linenos">  70</span></a>        <span class="n">cube_shape</span> <span class="o">=</span> <span class="n">geomodels</span><span class="o">.</span><span class="n">geologic_age</span><span class="p">[:]</span><span class="o">.</span><span class="n">shape</span>
</span><span id="L-71"><a href="#-71"><span class="linenos">  71</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vols</span> <span class="o">=</span> <span class="n">geomodels</span>
</span><span id="L-72"><a href="#-72"><span class="linenos">  72</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">faulted_age_volume</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="L-73"><a href="#-73"><span class="linenos">  73</span></a>            <span class="s2">&quot;faulted_age_volume&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">cube_shape</span>
</span><span id="L-74"><a href="#-74"><span class="linenos">  74</span></a>        <span class="p">)</span>
</span><span id="L-75"><a href="#-75"><span class="linenos">  75</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">faulted_net_to_gross</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="L-76"><a href="#-76"><span class="linenos">  76</span></a>            <span class="s2">&quot;faulted_net_to_gross&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">cube_shape</span>
</span><span id="L-77"><a href="#-77"><span class="linenos">  77</span></a>        <span class="p">)</span>
</span><span id="L-78"><a href="#-78"><span class="linenos">  78</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">faulted_lithology</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="L-79"><a href="#-79"><span class="linenos">  79</span></a>            <span class="s2">&quot;faulted_lithology&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">cube_shape</span>
</span><span id="L-80"><a href="#-80"><span class="linenos">  80</span></a>        <span class="p">)</span>
</span><span id="L-81"><a href="#-81"><span class="linenos">  81</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">reservoir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span><span class="s2">&quot;reservoir&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">cube_shape</span><span class="p">)</span>
</span><span id="L-82"><a href="#-82"><span class="linenos">  82</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">faulted_depth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span><span class="s2">&quot;faulted_depth&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">cube_shape</span><span class="p">)</span>
</span><span id="L-83"><a href="#-83"><span class="linenos">  83</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">faulted_onlap_segments</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="L-84"><a href="#-84"><span class="linenos">  84</span></a>            <span class="s2">&quot;faulted_onlap_segments&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">cube_shape</span>
</span><span id="L-85"><a href="#-85"><span class="linenos">  85</span></a>        <span class="p">)</span>
</span><span id="L-86"><a href="#-86"><span class="linenos">  86</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fault_planes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span><span class="s2">&quot;fault_planes&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">cube_shape</span><span class="p">)</span>
</span><span id="L-87"><a href="#-87"><span class="linenos">  87</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">displacement_vectors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="L-88"><a href="#-88"><span class="linenos">  88</span></a>            <span class="s2">&quot;displacement_vectors&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">cube_shape</span>
</span><span id="L-89"><a href="#-89"><span class="linenos">  89</span></a>        <span class="p">)</span>
</span><span id="L-90"><a href="#-90"><span class="linenos">  90</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sum_map_displacements</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="L-91"><a href="#-91"><span class="linenos">  91</span></a>            <span class="s2">&quot;sum_map_displacements&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">cube_shape</span>
</span><span id="L-92"><a href="#-92"><span class="linenos">  92</span></a>        <span class="p">)</span>
</span><span id="L-93"><a href="#-93"><span class="linenos">  93</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fault_intersections</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="L-94"><a href="#-94"><span class="linenos">  94</span></a>            <span class="s2">&quot;fault_intersections&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">cube_shape</span>
</span><span id="L-95"><a href="#-95"><span class="linenos">  95</span></a>        <span class="p">)</span>
</span><span id="L-96"><a href="#-96"><span class="linenos">  96</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fault_plane_throw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="L-97"><a href="#-97"><span class="linenos">  97</span></a>            <span class="s2">&quot;fault_plane_throw&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">cube_shape</span>
</span><span id="L-98"><a href="#-98"><span class="linenos">  98</span></a>        <span class="p">)</span>
</span><span id="L-99"><a href="#-99"><span class="linenos">  99</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">max_fault_throw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span><span class="s2">&quot;max_fault_throw&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">cube_shape</span><span class="p">)</span>
</span><span id="L-100"><a href="#-100"><span class="linenos"> 100</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fault_plane_azimuth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="L-101"><a href="#-101"><span class="linenos"> 101</span></a>            <span class="s2">&quot;fault_plane_azimuth&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">cube_shape</span>
</span><span id="L-102"><a href="#-102"><span class="linenos"> 102</span></a>        <span class="p">)</span>
</span><span id="L-103"><a href="#-103"><span class="linenos"> 103</span></a>        <span class="c1"># Salt</span>
</span><span id="L-104"><a href="#-104"><span class="linenos"> 104</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">salt_model</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-105"><a href="#-105"><span class="linenos"> 105</span></a>
</span><span id="L-106"><a href="#-106"><span class="linenos"> 106</span></a>    <span class="k">def</span> <span class="nf">apply_faulting_to_geomodels_and_depth_maps</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-107"><a href="#-107"><span class="linenos"> 107</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-108"><a href="#-108"><span class="linenos"> 108</span></a><span class="sd">        Apply faulting to horizons and cubes</span>
</span><span id="L-109"><a href="#-109"><span class="linenos"> 109</span></a><span class="sd">        ------------------------------------</span>
</span><span id="L-110"><a href="#-110"><span class="linenos"> 110</span></a><span class="sd">        Generates random faults and applies faulting to horizons and cubes.</span>
</span><span id="L-111"><a href="#-111"><span class="linenos"> 111</span></a>
</span><span id="L-112"><a href="#-112"><span class="linenos"> 112</span></a><span class="sd">        The method does the following:</span>
</span><span id="L-113"><a href="#-113"><span class="linenos"> 113</span></a>
</span><span id="L-114"><a href="#-114"><span class="linenos"> 114</span></a><span class="sd">        * Generate faults and sum the displacements</span>
</span><span id="L-115"><a href="#-115"><span class="linenos"> 115</span></a><span class="sd">        * Apply faulting to horizons</span>
</span><span id="L-116"><a href="#-116"><span class="linenos"> 116</span></a><span class="sd">        * Write faulted depth maps to disk</span>
</span><span id="L-117"><a href="#-117"><span class="linenos"> 117</span></a><span class="sd">        * Write faulted depth maps with gaps at faults to disk</span>
</span><span id="L-118"><a href="#-118"><span class="linenos"> 118</span></a><span class="sd">        * Write onlapping horizons to disk</span>
</span><span id="L-119"><a href="#-119"><span class="linenos"> 119</span></a><span class="sd">        * Apply faulting to geomodels</span>
</span><span id="L-120"><a href="#-120"><span class="linenos"> 120</span></a><span class="sd">        * Make segmentation results conform to binary values after</span>
</span><span id="L-121"><a href="#-121"><span class="linenos"> 121</span></a><span class="sd">          faulting and interpolation.</span>
</span><span id="L-122"><a href="#-122"><span class="linenos"> 122</span></a><span class="sd">        * Write cubes to file (if qc_volumes turned on in config.json)</span>
</span><span id="L-123"><a href="#-123"><span class="linenos"> 123</span></a>
</span><span id="L-124"><a href="#-124"><span class="linenos"> 124</span></a><span class="sd">        (If segmentation is not reset to binary, the multiple </span>
</span><span id="L-125"><a href="#-125"><span class="linenos"> 125</span></a><span class="sd">        interpolations for successive faults destroys the crisp</span>
</span><span id="L-126"><a href="#-126"><span class="linenos"> 126</span></a><span class="sd">        localization of the labels. Subjective observation suggests</span>
</span><span id="L-127"><a href="#-127"><span class="linenos"> 127</span></a><span class="sd">        that slightly different thresholds for different </span>
</span><span id="L-128"><a href="#-128"><span class="linenos"> 128</span></a><span class="sd">        features provide superior results)</span>
</span><span id="L-129"><a href="#-129"><span class="linenos"> 129</span></a>
</span><span id="L-130"><a href="#-130"><span class="linenos"> 130</span></a><span class="sd">        Parameters</span>
</span><span id="L-131"><a href="#-131"><span class="linenos"> 131</span></a><span class="sd">        ----------</span>
</span><span id="L-132"><a href="#-132"><span class="linenos"> 132</span></a><span class="sd">        None</span>
</span><span id="L-133"><a href="#-133"><span class="linenos"> 133</span></a>
</span><span id="L-134"><a href="#-134"><span class="linenos"> 134</span></a><span class="sd">        Returns</span>
</span><span id="L-135"><a href="#-135"><span class="linenos"> 135</span></a><span class="sd">        -------</span>
</span><span id="L-136"><a href="#-136"><span class="linenos"> 136</span></a><span class="sd">        None</span>
</span><span id="L-137"><a href="#-137"><span class="linenos"> 137</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-138"><a href="#-138"><span class="linenos"> 138</span></a>        <span class="c1"># Make a dictionary of zero-thickness onlapping layers before faulting</span>
</span><span id="L-139"><a href="#-139"><span class="linenos"> 139</span></a>        <span class="n">onlap_clip_dict</span> <span class="o">=</span> <span class="n">find_zero_thickness_onlapping_layers</span><span class="p">(</span>
</span><span id="L-140"><a href="#-140"><span class="linenos"> 140</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">unfaulted_depth_maps</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">onlap_horizon_list</span>
</span><span id="L-141"><a href="#-141"><span class="linenos"> 141</span></a>        <span class="p">)</span>
</span><span id="L-142"><a href="#-142"><span class="linenos"> 142</span></a>        <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_faults</span><span class="p">()</span>
</span><span id="L-143"><a href="#-143"><span class="linenos"> 143</span></a>
</span><span id="L-144"><a href="#-144"><span class="linenos"> 144</span></a>        <span class="c1"># Apply faulting to age model, net_to_gross cube &amp; onlap segments</span>
</span><span id="L-145"><a href="#-145"><span class="linenos"> 145</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">faulted_age_volume</span><span class="p">[:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_xyz_displacement</span><span class="p">(</span>
</span><span id="L-146"><a href="#-146"><span class="linenos"> 146</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">geologic_age</span><span class="p">[:]</span>
</span><span id="L-147"><a href="#-147"><span class="linenos"> 147</span></a>        <span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;float&quot;</span><span class="p">)</span>
</span><span id="L-148"><a href="#-148"><span class="linenos"> 148</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">faulted_onlap_segments</span><span class="p">[:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_xyz_displacement</span><span class="p">(</span>
</span><span id="L-149"><a href="#-149"><span class="linenos"> 149</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">onlap_segments</span><span class="p">[:]</span>
</span><span id="L-150"><a href="#-150"><span class="linenos"> 150</span></a>        <span class="p">)</span>
</span><span id="L-151"><a href="#-151"><span class="linenos"> 151</span></a>
</span><span id="L-152"><a href="#-152"><span class="linenos"> 152</span></a>        <span class="c1"># Improve the depth maps post faulting by</span>
</span><span id="L-153"><a href="#-153"><span class="linenos"> 153</span></a>        <span class="c1"># re-interpolating across faulted age model</span>
</span><span id="L-154"><a href="#-154"><span class="linenos"> 154</span></a>        <span class="p">(</span>
</span><span id="L-155"><a href="#-155"><span class="linenos"> 155</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">faulted_depth_maps</span><span class="p">[:],</span>
</span><span id="L-156"><a href="#-156"><span class="linenos"> 156</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">faulted_depth_maps_gaps</span><span class="p">[:],</span>
</span><span id="L-157"><a href="#-157"><span class="linenos"> 157</span></a>        <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">improve_depth_maps_post_faulting</span><span class="p">(</span>
</span><span id="L-158"><a href="#-158"><span class="linenos"> 158</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">geologic_age</span><span class="p">[:],</span> <span class="bp">self</span><span class="o">.</span><span class="n">faulted_age_volume</span><span class="p">[:],</span> <span class="n">onlap_clip_dict</span>
</span><span id="L-159"><a href="#-159"><span class="linenos"> 159</span></a>        <span class="p">)</span>
</span><span id="L-160"><a href="#-160"><span class="linenos"> 160</span></a>
</span><span id="L-161"><a href="#-161"><span class="linenos"> 161</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">include_salt</span><span class="p">:</span>
</span><span id="L-162"><a href="#-162"><span class="linenos"> 162</span></a>            <span class="kn">from</span> <span class="nn">datagenerator.Salt</span> <span class="kn">import</span> <span class="n">SaltModel</span>
</span><span id="L-163"><a href="#-163"><span class="linenos"> 163</span></a>
</span><span id="L-164"><a href="#-164"><span class="linenos"> 164</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">salt_model</span> <span class="o">=</span> <span class="n">SaltModel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="p">)</span>
</span><span id="L-165"><a href="#-165"><span class="linenos"> 165</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">salt_model</span><span class="o">.</span><span class="n">compute_salt_body_segmentation</span><span class="p">()</span>
</span><span id="L-166"><a href="#-166"><span class="linenos"> 166</span></a>            <span class="p">(</span>
</span><span id="L-167"><a href="#-167"><span class="linenos"> 167</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">faulted_depth_maps</span><span class="p">[:],</span>
</span><span id="L-168"><a href="#-168"><span class="linenos"> 168</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">faulted_depth_maps_gaps</span><span class="p">[:],</span>
</span><span id="L-169"><a href="#-169"><span class="linenos"> 169</span></a>            <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">salt_model</span><span class="o">.</span><span class="n">update_depth_maps_with_salt_segments_drag</span><span class="p">()</span>
</span><span id="L-170"><a href="#-170"><span class="linenos"> 170</span></a>
</span><span id="L-171"><a href="#-171"><span class="linenos"> 171</span></a>        <span class="c1"># # Write the faulted maps to disk</span>
</span><span id="L-172"><a href="#-172"><span class="linenos"> 172</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">write_maps_to_disk</span><span class="p">(</span>
</span><span id="L-173"><a href="#-173"><span class="linenos"> 173</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">faulted_depth_maps</span><span class="p">[:]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">digi</span><span class="p">,</span> <span class="s2">&quot;depth_maps&quot;</span>
</span><span id="L-174"><a href="#-174"><span class="linenos"> 174</span></a>        <span class="p">)</span>
</span><span id="L-175"><a href="#-175"><span class="linenos"> 175</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">write_maps_to_disk</span><span class="p">(</span>
</span><span id="L-176"><a href="#-176"><span class="linenos"> 176</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">faulted_depth_maps_gaps</span><span class="p">[:]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">digi</span><span class="p">,</span> <span class="s2">&quot;depth_maps_gaps&quot;</span>
</span><span id="L-177"><a href="#-177"><span class="linenos"> 177</span></a>        <span class="p">)</span>
</span><span id="L-178"><a href="#-178"><span class="linenos"> 178</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">write_onlap_episodes</span><span class="p">(</span>
</span><span id="L-179"><a href="#-179"><span class="linenos"> 179</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">onlap_horizon_list</span><span class="p">[:],</span>
</span><span id="L-180"><a href="#-180"><span class="linenos"> 180</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">faulted_depth_maps_gaps</span><span class="p">[:],</span>
</span><span id="L-181"><a href="#-181"><span class="linenos"> 181</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">faulted_depth_maps</span><span class="p">[:],</span>
</span><span id="L-182"><a href="#-182"><span class="linenos"> 182</span></a>        <span class="p">)</span>
</span><span id="L-183"><a href="#-183"><span class="linenos"> 183</span></a>        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fan_horizon_list</span><span class="p">):</span>
</span><span id="L-184"><a href="#-184"><span class="linenos"> 184</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">write_fan_horizons</span><span class="p">(</span>
</span><span id="L-185"><a href="#-185"><span class="linenos"> 185</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">fan_horizon_list</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">faulted_depth_maps</span><span class="p">[:]</span> <span class="o">*</span> <span class="mf">4.0</span>
</span><span id="L-186"><a href="#-186"><span class="linenos"> 186</span></a>            <span class="p">)</span>
</span><span id="L-187"><a href="#-187"><span class="linenos"> 187</span></a>
</span><span id="L-188"><a href="#-188"><span class="linenos"> 188</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_store</span><span class="p">:</span>
</span><span id="L-189"><a href="#-189"><span class="linenos"> 189</span></a>            <span class="c1"># Write faulted maps to hdf</span>
</span><span id="L-190"><a href="#-190"><span class="linenos"> 190</span></a>            <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
</span><span id="L-191"><a href="#-191"><span class="linenos"> 191</span></a>                <span class="p">[</span><span class="s2">&quot;depth_maps&quot;</span><span class="p">,</span> <span class="s2">&quot;depth_maps_gaps&quot;</span><span class="p">],</span>
</span><span id="L-192"><a href="#-192"><span class="linenos"> 192</span></a>                <span class="p">[</span>
</span><span id="L-193"><a href="#-193"><span class="linenos"> 193</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">faulted_depth_maps</span><span class="p">[:]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">digi</span><span class="p">,</span>
</span><span id="L-194"><a href="#-194"><span class="linenos"> 194</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">faulted_depth_maps_gaps</span><span class="p">[:]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">digi</span><span class="p">,</span>
</span><span id="L-195"><a href="#-195"><span class="linenos"> 195</span></a>                <span class="p">],</span>
</span><span id="L-196"><a href="#-196"><span class="linenos"> 196</span></a>            <span class="p">):</span>
</span><span id="L-197"><a href="#-197"><span class="linenos"> 197</span></a>                <span class="n">write_data_to_hdf</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_master</span><span class="p">)</span>
</span><span id="L-198"><a href="#-198"><span class="linenos"> 198</span></a>
</span><span id="L-199"><a href="#-199"><span class="linenos"> 199</span></a>        <span class="c1"># Create faulted binary segmentation volumes</span>
</span><span id="L-200"><a href="#-200"><span class="linenos"> 200</span></a>        <span class="n">_fault_planes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fault_planes</span><span class="p">[:]</span>
</span><span id="L-201"><a href="#-201"><span class="linenos"> 201</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fault_planes</span><span class="p">[:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_binary_segmentations_post_faulting</span><span class="p">(</span>
</span><span id="L-202"><a href="#-202"><span class="linenos"> 202</span></a>            <span class="n">_fault_planes</span><span class="p">,</span> <span class="mf">0.45</span>
</span><span id="L-203"><a href="#-203"><span class="linenos"> 203</span></a>        <span class="p">)</span>
</span><span id="L-204"><a href="#-204"><span class="linenos"> 204</span></a>        <span class="k">del</span> <span class="n">_fault_planes</span>
</span><span id="L-205"><a href="#-205"><span class="linenos"> 205</span></a>        <span class="n">_fault_intersections</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fault_intersections</span><span class="p">[:]</span>
</span><span id="L-206"><a href="#-206"><span class="linenos"> 206</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fault_intersections</span><span class="p">[:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_binary_segmentations_post_faulting</span><span class="p">(</span>
</span><span id="L-207"><a href="#-207"><span class="linenos"> 207</span></a>            <span class="n">_fault_intersections</span><span class="p">,</span> <span class="mf">0.45</span>
</span><span id="L-208"><a href="#-208"><span class="linenos"> 208</span></a>        <span class="p">)</span>
</span><span id="L-209"><a href="#-209"><span class="linenos"> 209</span></a>        <span class="k">del</span> <span class="n">_fault_intersections</span>
</span><span id="L-210"><a href="#-210"><span class="linenos"> 210</span></a>        <span class="n">_faulted_onlap_segments</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">faulted_onlap_segments</span><span class="p">[:]</span>
</span><span id="L-211"><a href="#-211"><span class="linenos"> 211</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">faulted_onlap_segments</span><span class="p">[:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_binary_segmentations_post_faulting</span><span class="p">(</span>
</span><span id="L-212"><a href="#-212"><span class="linenos"> 212</span></a>            <span class="n">_faulted_onlap_segments</span><span class="p">,</span> <span class="mf">0.45</span>
</span><span id="L-213"><a href="#-213"><span class="linenos"> 213</span></a>        <span class="p">)</span>
</span><span id="L-214"><a href="#-214"><span class="linenos"> 214</span></a>        <span class="k">del</span> <span class="n">_faulted_onlap_segments</span>
</span><span id="L-215"><a href="#-215"><span class="linenos"> 215</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">include_channels</span><span class="p">:</span>
</span><span id="L-216"><a href="#-216"><span class="linenos"> 216</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">floodplain_shale</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_xyz_displacement</span><span class="p">(</span>
</span><span id="L-217"><a href="#-217"><span class="linenos"> 217</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">floodplain_shale</span>
</span><span id="L-218"><a href="#-218"><span class="linenos"> 218</span></a>            <span class="p">)</span>
</span><span id="L-219"><a href="#-219"><span class="linenos"> 219</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">channel_fill</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_xyz_displacement</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">channel_fill</span><span class="p">)</span>
</span><span id="L-220"><a href="#-220"><span class="linenos"> 220</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">shale_channel_drape</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_xyz_displacement</span><span class="p">(</span>
</span><span id="L-221"><a href="#-221"><span class="linenos"> 221</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">shale_channel_drape</span>
</span><span id="L-222"><a href="#-222"><span class="linenos"> 222</span></a>            <span class="p">)</span>
</span><span id="L-223"><a href="#-223"><span class="linenos"> 223</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">levee</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_xyz_displacement</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">levee</span><span class="p">)</span>
</span><span id="L-224"><a href="#-224"><span class="linenos"> 224</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">crevasse</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_xyz_displacement</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">crevasse</span><span class="p">)</span>
</span><span id="L-225"><a href="#-225"><span class="linenos"> 225</span></a>
</span><span id="L-226"><a href="#-226"><span class="linenos"> 226</span></a>            <span class="p">(</span>
</span><span id="L-227"><a href="#-227"><span class="linenos"> 227</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">channel_segments</span><span class="p">,</span>
</span><span id="L-228"><a href="#-228"><span class="linenos"> 228</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">geologic_age</span><span class="p">,</span>
</span><span id="L-229"><a href="#-229"><span class="linenos"> 229</span></a>            <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reassign_channel_segment_encoding</span><span class="p">(</span>
</span><span id="L-230"><a href="#-230"><span class="linenos"> 230</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">geologic_age</span><span class="p">,</span>
</span><span id="L-231"><a href="#-231"><span class="linenos"> 231</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">floodplain_shale</span><span class="p">,</span>
</span><span id="L-232"><a href="#-232"><span class="linenos"> 232</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">channel_fill</span><span class="p">,</span>
</span><span id="L-233"><a href="#-233"><span class="linenos"> 233</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">shale_channel_drape</span><span class="p">,</span>
</span><span id="L-234"><a href="#-234"><span class="linenos"> 234</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">levee</span><span class="p">,</span>
</span><span id="L-235"><a href="#-235"><span class="linenos"> 235</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">crevasse</span><span class="p">,</span>
</span><span id="L-236"><a href="#-236"><span class="linenos"> 236</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">maps</span><span class="o">.</span><span class="n">channels</span><span class="p">,</span>
</span><span id="L-237"><a href="#-237"><span class="linenos"> 237</span></a>            <span class="p">)</span>
</span><span id="L-238"><a href="#-238"><span class="linenos"> 238</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">model_qc_volumes</span><span class="p">:</span>
</span><span id="L-239"><a href="#-239"><span class="linenos"> 239</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">write_cube_to_disk</span><span class="p">(</span>
</span><span id="L-240"><a href="#-240"><span class="linenos"> 240</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">channel_segments</span><span class="p">,</span> <span class="s2">&quot;channel_segments&quot;</span>
</span><span id="L-241"><a href="#-241"><span class="linenos"> 241</span></a>                <span class="p">)</span>
</span><span id="L-242"><a href="#-242"><span class="linenos"> 242</span></a>
</span><span id="L-243"><a href="#-243"><span class="linenos"> 243</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">model_qc_volumes</span><span class="p">:</span>
</span><span id="L-244"><a href="#-244"><span class="linenos"> 244</span></a>            <span class="c1"># Output files if qc volumes required</span>
</span><span id="L-245"><a href="#-245"><span class="linenos"> 245</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">write_cube_to_disk</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faulted_age_volume</span><span class="p">[:],</span> <span class="s2">&quot;geologic_age&quot;</span><span class="p">)</span>
</span><span id="L-246"><a href="#-246"><span class="linenos"> 246</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">write_cube_to_disk</span><span class="p">(</span>
</span><span id="L-247"><a href="#-247"><span class="linenos"> 247</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">faulted_onlap_segments</span><span class="p">[:],</span> <span class="s2">&quot;onlap_segments&quot;</span>
</span><span id="L-248"><a href="#-248"><span class="linenos"> 248</span></a>            <span class="p">)</span>
</span><span id="L-249"><a href="#-249"><span class="linenos"> 249</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">write_cube_to_disk</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fault_planes</span><span class="p">[:],</span> <span class="s2">&quot;fault_segments&quot;</span><span class="p">)</span>
</span><span id="L-250"><a href="#-250"><span class="linenos"> 250</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">write_cube_to_disk</span><span class="p">(</span>
</span><span id="L-251"><a href="#-251"><span class="linenos"> 251</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">fault_intersections</span><span class="p">[:],</span> <span class="s2">&quot;fault_intersection_segments&quot;</span>
</span><span id="L-252"><a href="#-252"><span class="linenos"> 252</span></a>            <span class="p">)</span>
</span><span id="L-253"><a href="#-253"><span class="linenos"> 253</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">write_cube_to_disk</span><span class="p">(</span>
</span><span id="L-254"><a href="#-254"><span class="linenos"> 254</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">fault_plane_throw</span><span class="p">[:],</span> <span class="s2">&quot;fault_segments_throw&quot;</span>
</span><span id="L-255"><a href="#-255"><span class="linenos"> 255</span></a>            <span class="p">)</span>
</span><span id="L-256"><a href="#-256"><span class="linenos"> 256</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">write_cube_to_disk</span><span class="p">(</span>
</span><span id="L-257"><a href="#-257"><span class="linenos"> 257</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">fault_plane_azimuth</span><span class="p">[:],</span> <span class="s2">&quot;fault_segments_azimuth&quot;</span>
</span><span id="L-258"><a href="#-258"><span class="linenos"> 258</span></a>            <span class="p">)</span>
</span><span id="L-259"><a href="#-259"><span class="linenos"> 259</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_store</span><span class="p">:</span>
</span><span id="L-260"><a href="#-260"><span class="linenos"> 260</span></a>            <span class="c1"># Write faulted age, onlap and fault segment cubes to hdf</span>
</span><span id="L-261"><a href="#-261"><span class="linenos"> 261</span></a>            <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
</span><span id="L-262"><a href="#-262"><span class="linenos"> 262</span></a>                <span class="p">[</span>
</span><span id="L-263"><a href="#-263"><span class="linenos"> 263</span></a>                    <span class="s2">&quot;geologic_age_faulted&quot;</span><span class="p">,</span>
</span><span id="L-264"><a href="#-264"><span class="linenos"> 264</span></a>                    <span class="s2">&quot;onlap_segments&quot;</span><span class="p">,</span>
</span><span id="L-265"><a href="#-265"><span class="linenos"> 265</span></a>                    <span class="s2">&quot;fault_segments&quot;</span><span class="p">,</span>
</span><span id="L-266"><a href="#-266"><span class="linenos"> 266</span></a>                    <span class="s2">&quot;fault_intersection_segments&quot;</span><span class="p">,</span>
</span><span id="L-267"><a href="#-267"><span class="linenos"> 267</span></a>                    <span class="s2">&quot;fault_segments_throw&quot;</span><span class="p">,</span>
</span><span id="L-268"><a href="#-268"><span class="linenos"> 268</span></a>                    <span class="s2">&quot;fault_segments_azimuth&quot;</span><span class="p">,</span>
</span><span id="L-269"><a href="#-269"><span class="linenos"> 269</span></a>                <span class="p">],</span>
</span><span id="L-270"><a href="#-270"><span class="linenos"> 270</span></a>                <span class="p">[</span>
</span><span id="L-271"><a href="#-271"><span class="linenos"> 271</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">faulted_age_volume</span><span class="p">,</span>
</span><span id="L-272"><a href="#-272"><span class="linenos"> 272</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">faulted_onlap_segments</span><span class="p">,</span>
</span><span id="L-273"><a href="#-273"><span class="linenos"> 273</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">fault_planes</span><span class="p">,</span>
</span><span id="L-274"><a href="#-274"><span class="linenos"> 274</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">fault_intersections</span><span class="p">,</span>
</span><span id="L-275"><a href="#-275"><span class="linenos"> 275</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">fault_plane_throw</span><span class="p">,</span>
</span><span id="L-276"><a href="#-276"><span class="linenos"> 276</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">fault_plane_azimuth</span><span class="p">,</span>
</span><span id="L-277"><a href="#-277"><span class="linenos"> 277</span></a>                <span class="p">],</span>
</span><span id="L-278"><a href="#-278"><span class="linenos"> 278</span></a>            <span class="p">):</span>
</span><span id="L-279"><a href="#-279"><span class="linenos"> 279</span></a>                <span class="n">write_data_to_hdf</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_master</span><span class="p">)</span>
</span><span id="L-280"><a href="#-280"><span class="linenos"> 280</span></a>
</span><span id="L-281"><a href="#-281"><span class="linenos"> 281</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">qc_plots</span><span class="p">:</span>
</span><span id="L-282"><a href="#-282"><span class="linenos"> 282</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">create_qc_plots</span><span class="p">()</span>
</span><span id="L-283"><a href="#-283"><span class="linenos"> 283</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="L-284"><a href="#-284"><span class="linenos"> 284</span></a>                <span class="c1"># Create 3D qc plot</span>
</span><span id="L-285"><a href="#-285"><span class="linenos"> 285</span></a>                <span class="n">plot_3D_faults_plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
</span><span id="L-286"><a href="#-286"><span class="linenos"> 286</span></a>            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
</span><span id="L-287"><a href="#-287"><span class="linenos"> 287</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span><span class="s2">&quot;3D Fault Plotting Failed&quot;</span><span class="p">)</span>
</span><span id="L-288"><a href="#-288"><span class="linenos"> 288</span></a>
</span><span id="L-289"><a href="#-289"><span class="linenos"> 289</span></a>    <span class="k">def</span> <span class="nf">build_faulted_property_geomodels</span><span class="p">(</span>
</span><span id="L-290"><a href="#-290"><span class="linenos"> 290</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-291"><a href="#-291"><span class="linenos"> 291</span></a>        <span class="n">facies</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
</span><span id="L-292"><a href="#-292"><span class="linenos"> 292</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-293"><a href="#-293"><span class="linenos"> 293</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-294"><a href="#-294"><span class="linenos"> 294</span></a><span class="sd">        Build Faulted Property Geomodels</span>
</span><span id="L-295"><a href="#-295"><span class="linenos"> 295</span></a><span class="sd">        ------------</span>
</span><span id="L-296"><a href="#-296"><span class="linenos"> 296</span></a><span class="sd">        Generates faulted property geomodels.</span>
</span><span id="L-297"><a href="#-297"><span class="linenos"> 297</span></a>
</span><span id="L-298"><a href="#-298"><span class="linenos"> 298</span></a><span class="sd">        **The method does the following:**</span>
</span><span id="L-299"><a href="#-299"><span class="linenos"> 299</span></a>
</span><span id="L-300"><a href="#-300"><span class="linenos"> 300</span></a><span class="sd">        Use faulted geologic_age cube, depth_maps and facies</span>
</span><span id="L-301"><a href="#-301"><span class="linenos"> 301</span></a><span class="sd">        to create geomodel properties (depth, lith)</span>
</span><span id="L-302"><a href="#-302"><span class="linenos"> 302</span></a>
</span><span id="L-303"><a href="#-303"><span class="linenos"> 303</span></a><span class="sd">        - lithology</span>
</span><span id="L-304"><a href="#-304"><span class="linenos"> 304</span></a><span class="sd">        - net_to_gross (to create effective sand layers)</span>
</span><span id="L-305"><a href="#-305"><span class="linenos"> 305</span></a><span class="sd">        - depth below mudline</span>
</span><span id="L-306"><a href="#-306"><span class="linenos"> 306</span></a><span class="sd">        - randomised depth below mudline (to </span>
</span><span id="L-307"><a href="#-307"><span class="linenos"> 307</span></a><span class="sd">          randomise the rock properties per layer)</span>
</span><span id="L-308"><a href="#-308"><span class="linenos"> 308</span></a>
</span><span id="L-309"><a href="#-309"><span class="linenos"> 309</span></a><span class="sd">        Parameters</span>
</span><span id="L-310"><a href="#-310"><span class="linenos"> 310</span></a><span class="sd">        ----------</span>
</span><span id="L-311"><a href="#-311"><span class="linenos"> 311</span></a><span class="sd">        facies : np.ndarray</span>
</span><span id="L-312"><a href="#-312"><span class="linenos"> 312</span></a><span class="sd">            The Horizons class used to build the faults.</span>
</span><span id="L-313"><a href="#-313"><span class="linenos"> 313</span></a>
</span><span id="L-314"><a href="#-314"><span class="linenos"> 314</span></a><span class="sd">        Returns</span>
</span><span id="L-315"><a href="#-315"><span class="linenos"> 315</span></a><span class="sd">        -------</span>
</span><span id="L-316"><a href="#-316"><span class="linenos"> 316</span></a><span class="sd">        None</span>
</span><span id="L-317"><a href="#-317"><span class="linenos"> 317</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-318"><a href="#-318"><span class="linenos"> 318</span></a>        <span class="n">work_cube_lith</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-319"><a href="#-319"><span class="linenos"> 319</span></a>            <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faulted_age_volume</span><span class="p">)</span> <span class="o">*</span> <span class="o">-</span><span class="mi">1</span>
</span><span id="L-320"><a href="#-320"><span class="linenos"> 320</span></a>        <span class="p">)</span>  <span class="c1"># initialise lith cube to water</span>
</span><span id="L-321"><a href="#-321"><span class="linenos"> 321</span></a>        <span class="n">work_cube_sealed</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faulted_age_volume</span><span class="p">)</span>
</span><span id="L-322"><a href="#-322"><span class="linenos"> 322</span></a>        <span class="n">work_cube_net_to_gross</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faulted_age_volume</span><span class="p">)</span>
</span><span id="L-323"><a href="#-323"><span class="linenos"> 323</span></a>        <span class="n">work_cube_depth</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faulted_age_volume</span><span class="p">)</span>
</span><span id="L-324"><a href="#-324"><span class="linenos"> 324</span></a>        <span class="c1"># Also create a randomised depth cube for generating randomised rock properties</span>
</span><span id="L-325"><a href="#-325"><span class="linenos"> 325</span></a>        <span class="c1"># final dimension&#39;s shape is based on number of possible list types</span>
</span><span id="L-326"><a href="#-326"><span class="linenos"> 326</span></a>        <span class="c1"># currently  one of [&#39;seawater&#39;, &#39;shale&#39;, &#39;sand&#39;]</span>
</span><span id="L-327"><a href="#-327"><span class="linenos"> 327</span></a>        <span class="c1"># n_lith = len([&#39;shale&#39;, &#39;sand&#39;])</span>
</span><span id="L-328"><a href="#-328"><span class="linenos"> 328</span></a>        <span class="n">cube_shape</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">faulted_age_volume</span><span class="o">.</span><span class="n">shape</span>
</span><span id="L-329"><a href="#-329"><span class="linenos"> 329</span></a>        <span class="c1"># randomised_depth = np.zeros(cube_shape, &#39;float32&#39;)</span>
</span><span id="L-330"><a href="#-330"><span class="linenos"> 330</span></a>
</span><span id="L-331"><a href="#-331"><span class="linenos"> 331</span></a>        <span class="n">ii</span><span class="p">,</span> <span class="n">jj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">build_meshgrid</span><span class="p">()</span>
</span><span id="L-332"><a href="#-332"><span class="linenos"> 332</span></a>
</span><span id="L-333"><a href="#-333"><span class="linenos"> 333</span></a>        <span class="c1"># Loop over layers in reverse order, start at base</span>
</span><span id="L-334"><a href="#-334"><span class="linenos"> 334</span></a>        <span class="n">previous_depth_map</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">faulted_depth_maps</span><span class="p">[:,</span> <span class="p">:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-335"><a href="#-335"><span class="linenos"> 335</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">partial_voxels</span><span class="p">:</span>
</span><span id="L-336"><a href="#-336"><span class="linenos"> 336</span></a>            <span class="c1"># add .5 to consider partial voxels from half above and half below</span>
</span><span id="L-337"><a href="#-337"><span class="linenos"> 337</span></a>            <span class="n">previous_depth_map</span> <span class="o">+=</span> <span class="mf">0.5</span>
</span><span id="L-338"><a href="#-338"><span class="linenos"> 338</span></a>
</span><span id="L-339"><a href="#-339"><span class="linenos"> 339</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faulted_depth_maps</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
</span><span id="L-340"><a href="#-340"><span class="linenos"> 340</span></a>            <span class="c1"># Apply a random depth shift within the range as provided in config file</span>
</span><span id="L-341"><a href="#-341"><span class="linenos"> 341</span></a>            <span class="c1"># (provided in metres, so converted to samples here)</span>
</span><span id="L-342"><a href="#-342"><span class="linenos"> 342</span></a>
</span><span id="L-343"><a href="#-343"><span class="linenos"> 343</span></a>            <span class="n">current_depth_map</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">faulted_depth_maps</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">i</span><span class="p">]</span>
</span><span id="L-344"><a href="#-344"><span class="linenos"> 344</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">partial_voxels</span><span class="p">:</span>
</span><span id="L-345"><a href="#-345"><span class="linenos"> 345</span></a>                <span class="n">current_depth_map</span> <span class="o">+=</span> <span class="mf">0.5</span>
</span><span id="L-346"><a href="#-346"><span class="linenos"> 346</span></a>
</span><span id="L-347"><a href="#-347"><span class="linenos"> 347</span></a>            <span class="c1"># compute maps with indices of top map and base map to include partial voxels</span>
</span><span id="L-348"><a href="#-348"><span class="linenos"> 348</span></a>            <span class="n">top_map_index</span> <span class="o">=</span> <span class="n">current_depth_map</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;int&quot;</span><span class="p">)</span>
</span><span id="L-349"><a href="#-349"><span class="linenos"> 349</span></a>            <span class="n">base_map_index</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-350"><a href="#-350"><span class="linenos"> 350</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">faulted_depth_maps</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;int&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="L-351"><a href="#-351"><span class="linenos"> 351</span></a>            <span class="p">)</span>
</span><span id="L-352"><a href="#-352"><span class="linenos"> 352</span></a>
</span><span id="L-353"><a href="#-353"><span class="linenos"> 353</span></a>            <span class="c1"># compute thickness over which to iterate</span>
</span><span id="L-354"><a href="#-354"><span class="linenos"> 354</span></a>            <span class="n">thickness_map</span> <span class="o">=</span> <span class="n">base_map_index</span> <span class="o">-</span> <span class="n">top_map_index</span>
</span><span id="L-355"><a href="#-355"><span class="linenos"> 355</span></a>            <span class="n">thickness_map_max</span> <span class="o">=</span> <span class="n">thickness_map</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</span><span id="L-356"><a href="#-356"><span class="linenos"> 356</span></a>
</span><span id="L-357"><a href="#-357"><span class="linenos"> 357</span></a>            <span class="n">tvdml_map</span> <span class="o">=</span> <span class="n">previous_depth_map</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">faulted_depth_maps</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span>
</span><span id="L-358"><a href="#-358"><span class="linenos"> 358</span></a>            <span class="c1"># Net to Gross Map for layer</span>
</span><span id="L-359"><a href="#-359"><span class="linenos"> 359</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">variable_shale_ng</span><span class="p">:</span>
</span><span id="L-360"><a href="#-360"><span class="linenos"> 360</span></a>                <span class="n">ng_map</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span>
</span><span id="L-361"><a href="#-361"><span class="linenos"> 361</span></a>                    <span class="n">shape</span><span class="o">=</span><span class="p">(</span>
</span><span id="L-362"><a href="#-362"><span class="linenos"> 362</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">faulted_depth_maps</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
</span><span id="L-363"><a href="#-363"><span class="linenos"> 363</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">faulted_depth_maps</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
</span><span id="L-364"><a href="#-364"><span class="linenos"> 364</span></a>                    <span class="p">)</span>
</span><span id="L-365"><a href="#-365"><span class="linenos"> 365</span></a>                <span class="p">)</span>
</span><span id="L-366"><a href="#-366"><span class="linenos"> 366</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-367"><a href="#-367"><span class="linenos"> 367</span></a>                <span class="k">if</span> <span class="p">(</span>
</span><span id="L-368"><a href="#-368"><span class="linenos"> 368</span></a>                    <span class="n">facies</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mf">0.0</span>
</span><span id="L-369"><a href="#-369"><span class="linenos"> 369</span></a>                <span class="p">):</span>  <span class="c1"># if shale layer, make non-zero N/G map for layer using a low average net to gross</span>
</span><span id="L-370"><a href="#-370"><span class="linenos"> 370</span></a>                    <span class="n">ng_map</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_random_net_over_gross_map</span><span class="p">(</span>
</span><span id="L-371"><a href="#-371"><span class="linenos"> 371</span></a>                        <span class="n">avg</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">),</span> <span class="n">stdev</span><span class="o">=</span><span class="p">(</span><span class="mf">0.001</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">),</span> <span class="n">octave</span><span class="o">=</span><span class="mi">3</span>
</span><span id="L-372"><a href="#-372"><span class="linenos"> 372</span></a>                    <span class="p">)</span>
</span><span id="L-373"><a href="#-373"><span class="linenos"> 373</span></a>            <span class="k">if</span> <span class="n">facies</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mf">1.0</span><span class="p">:</span>  <span class="c1"># if sand layer, make non-zero N/G map for layer</span>
</span><span id="L-374"><a href="#-374"><span class="linenos"> 374</span></a>                <span class="n">ng_map</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_random_net_over_gross_map</span><span class="p">()</span>
</span><span id="L-375"><a href="#-375"><span class="linenos"> 375</span></a>
</span><span id="L-376"><a href="#-376"><span class="linenos"> 376</span></a>            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">thickness_map_max</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="L-377"><a href="#-377"><span class="linenos"> 377</span></a>
</span><span id="L-378"><a href="#-378"><span class="linenos"> 378</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">partial_voxels</span><span class="p">:</span>
</span><span id="L-379"><a href="#-379"><span class="linenos"> 379</span></a>                    <span class="c1"># compute fraction of voxel containing layer</span>
</span><span id="L-380"><a href="#-380"><span class="linenos"> 380</span></a>                    <span class="n">top_map</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span>
</span><span id="L-381"><a href="#-381"><span class="linenos"> 381</span></a>                        <span class="n">np</span><span class="o">.</span><span class="n">dstack</span><span class="p">(</span>
</span><span id="L-382"><a href="#-382"><span class="linenos"> 382</span></a>                            <span class="p">(</span><span class="n">current_depth_map</span><span class="p">,</span> <span class="n">top_map_index</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;float32&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="n">k</span><span class="p">)</span>
</span><span id="L-383"><a href="#-383"><span class="linenos"> 383</span></a>                        <span class="p">),</span>
</span><span id="L-384"><a href="#-384"><span class="linenos"> 384</span></a>                        <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
</span><span id="L-385"><a href="#-385"><span class="linenos"> 385</span></a>                    <span class="p">)</span>
</span><span id="L-386"><a href="#-386"><span class="linenos"> 386</span></a>                    <span class="n">top_map</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dstack</span><span class="p">((</span><span class="n">top_map</span><span class="p">,</span> <span class="n">previous_depth_map</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-387"><a href="#-387"><span class="linenos"> 387</span></a>                    <span class="n">base_map</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span>
</span><span id="L-388"><a href="#-388"><span class="linenos"> 388</span></a>                        <span class="n">np</span><span class="o">.</span><span class="n">dstack</span><span class="p">(</span>
</span><span id="L-389"><a href="#-389"><span class="linenos"> 389</span></a>                            <span class="p">(</span>
</span><span id="L-390"><a href="#-390"><span class="linenos"> 390</span></a>                                <span class="n">previous_depth_map</span><span class="p">,</span>
</span><span id="L-391"><a href="#-391"><span class="linenos"> 391</span></a>                                <span class="n">top_map_index</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;float32&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="L-392"><a href="#-392"><span class="linenos"> 392</span></a>                            <span class="p">)</span>
</span><span id="L-393"><a href="#-393"><span class="linenos"> 393</span></a>                        <span class="p">),</span>
</span><span id="L-394"><a href="#-394"><span class="linenos"> 394</span></a>                        <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
</span><span id="L-395"><a href="#-395"><span class="linenos"> 395</span></a>                    <span class="p">)</span>
</span><span id="L-396"><a href="#-396"><span class="linenos"> 396</span></a>                    <span class="n">fraction_of_voxel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">base_map</span> <span class="o">-</span> <span class="n">top_map</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
</span><span id="L-397"><a href="#-397"><span class="linenos"> 397</span></a>                    <span class="n">valid_k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
</span><span id="L-398"><a href="#-398"><span class="linenos"> 398</span></a>                        <span class="p">(</span><span class="n">fraction_of_voxel</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">)</span>
</span><span id="L-399"><a href="#-399"><span class="linenos"> 399</span></a>                        <span class="o">&amp;</span> <span class="p">((</span><span class="n">top_map_index</span> <span class="o">+</span> <span class="n">k</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;int&quot;</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">cube_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span>
</span><span id="L-400"><a href="#-400"><span class="linenos"> 400</span></a>                        <span class="mi">1</span><span class="p">,</span>
</span><span id="L-401"><a href="#-401"><span class="linenos"> 401</span></a>                        <span class="mi">0</span><span class="p">,</span>
</span><span id="L-402"><a href="#-402"><span class="linenos"> 402</span></a>                    <span class="p">)</span>
</span><span id="L-403"><a href="#-403"><span class="linenos"> 403</span></a>
</span><span id="L-404"><a href="#-404"><span class="linenos"> 404</span></a>                    <span class="c1"># put layer properties in the cube for each case</span>
</span><span id="L-405"><a href="#-405"><span class="linenos"> 405</span></a>                    <span class="n">sublayer_ii</span> <span class="o">=</span> <span class="n">ii</span><span class="p">[</span><span class="n">valid_k</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="L-406"><a href="#-406"><span class="linenos"> 406</span></a>                    <span class="n">sublayer_jj</span> <span class="o">=</span> <span class="n">jj</span><span class="p">[</span><span class="n">valid_k</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="L-407"><a href="#-407"><span class="linenos"> 407</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-408"><a href="#-408"><span class="linenos"> 408</span></a>                    <span class="n">sublayer_ii</span> <span class="o">=</span> <span class="n">ii</span><span class="p">[</span><span class="n">thickness_map</span> <span class="o">&gt;</span> <span class="n">k</span><span class="p">]</span>
</span><span id="L-409"><a href="#-409"><span class="linenos"> 409</span></a>                    <span class="n">sublayer_jj</span> <span class="o">=</span> <span class="n">jj</span><span class="p">[</span><span class="n">thickness_map</span> <span class="o">&gt;</span> <span class="n">k</span><span class="p">]</span>
</span><span id="L-410"><a href="#-410"><span class="linenos"> 410</span></a>
</span><span id="L-411"><a href="#-411"><span class="linenos"> 411</span></a>                <span class="k">if</span> <span class="n">sublayer_ii</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-412"><a href="#-412"><span class="linenos"> 412</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">partial_voxels</span><span class="p">:</span>
</span><span id="L-413"><a href="#-413"><span class="linenos"> 413</span></a>                        <span class="n">sublayer_depth_map</span> <span class="o">=</span> <span class="p">(</span><span class="n">top_map_index</span> <span class="o">+</span> <span class="n">k</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;int&quot;</span><span class="p">)[</span>
</span><span id="L-414"><a href="#-414"><span class="linenos"> 414</span></a>                            <span class="n">valid_k</span> <span class="o">==</span> <span class="mi">1</span>
</span><span id="L-415"><a href="#-415"><span class="linenos"> 415</span></a>                        <span class="p">]</span>
</span><span id="L-416"><a href="#-416"><span class="linenos"> 416</span></a>                        <span class="n">sublayer_depth_map_int</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">sublayer_depth_map</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="L-417"><a href="#-417"><span class="linenos"> 417</span></a>                        <span class="n">sublayer_ng_map</span> <span class="o">=</span> <span class="n">ng_map</span><span class="p">[</span><span class="n">valid_k</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="L-418"><a href="#-418"><span class="linenos"> 418</span></a>                        <span class="n">sublayer_tvdml_map</span> <span class="o">=</span> <span class="n">tvdml_map</span><span class="p">[</span><span class="n">valid_k</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="L-419"><a href="#-419"><span class="linenos"> 419</span></a>                        <span class="n">sublayer_fraction</span> <span class="o">=</span> <span class="n">fraction_of_voxel</span><span class="p">[</span><span class="n">valid_k</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="L-420"><a href="#-420"><span class="linenos"> 420</span></a>
</span><span id="L-421"><a href="#-421"><span class="linenos"> 421</span></a>                        <span class="c1"># Lithology cube</span>
</span><span id="L-422"><a href="#-422"><span class="linenos"> 422</span></a>                        <span class="n">input_cube</span> <span class="o">=</span> <span class="n">work_cube_lith</span><span class="p">[</span>
</span><span id="L-423"><a href="#-423"><span class="linenos"> 423</span></a>                            <span class="n">sublayer_ii</span><span class="p">,</span> <span class="n">sublayer_jj</span><span class="p">,</span> <span class="n">sublayer_depth_map_int</span>
</span><span id="L-424"><a href="#-424"><span class="linenos"> 424</span></a>                        <span class="p">]</span>
</span><span id="L-425"><a href="#-425"><span class="linenos"> 425</span></a>                        <span class="n">values</span> <span class="o">=</span> <span class="n">facies</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">sublayer_fraction</span>
</span><span id="L-426"><a href="#-426"><span class="linenos"> 426</span></a>                        <span class="n">input_cube</span><span class="p">[</span><span class="n">input_cube</span> <span class="o">==</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-427"><a href="#-427"><span class="linenos"> 427</span></a>                            <span class="n">values</span><span class="p">[</span><span class="n">input_cube</span> <span class="o">==</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1.0</span>
</span><span id="L-428"><a href="#-428"><span class="linenos"> 428</span></a>                        <span class="p">)</span>
</span><span id="L-429"><a href="#-429"><span class="linenos"> 429</span></a>                        <span class="n">input_cube</span><span class="p">[</span><span class="n">input_cube</span> <span class="o">!=</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">]</span> <span class="o">+=</span> <span class="n">values</span><span class="p">[</span><span class="n">input_cube</span> <span class="o">!=</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">]</span>
</span><span id="L-430"><a href="#-430"><span class="linenos"> 430</span></a>                        <span class="n">work_cube_lith</span><span class="p">[</span>
</span><span id="L-431"><a href="#-431"><span class="linenos"> 431</span></a>                            <span class="n">sublayer_ii</span><span class="p">,</span> <span class="n">sublayer_jj</span><span class="p">,</span> <span class="n">sublayer_depth_map_int</span>
</span><span id="L-432"><a href="#-432"><span class="linenos"> 432</span></a>                        <span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">input_cube</span> <span class="o">*</span> <span class="mf">1.0</span><span class="p">)</span>
</span><span id="L-433"><a href="#-433"><span class="linenos"> 433</span></a>                        <span class="k">del</span> <span class="n">input_cube</span>
</span><span id="L-434"><a href="#-434"><span class="linenos"> 434</span></a>                        <span class="k">del</span> <span class="n">values</span>
</span><span id="L-435"><a href="#-435"><span class="linenos"> 435</span></a>
</span><span id="L-436"><a href="#-436"><span class="linenos"> 436</span></a>                        <span class="n">input_cube</span> <span class="o">=</span> <span class="n">work_cube_sealed</span><span class="p">[</span>
</span><span id="L-437"><a href="#-437"><span class="linenos"> 437</span></a>                            <span class="n">sublayer_ii</span><span class="p">,</span> <span class="n">sublayer_jj</span><span class="p">,</span> <span class="n">sublayer_depth_map_int</span>
</span><span id="L-438"><a href="#-438"><span class="linenos"> 438</span></a>                        <span class="p">]</span>
</span><span id="L-439"><a href="#-439"><span class="linenos"> 439</span></a>                        <span class="n">values</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">facies</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="n">sublayer_fraction</span>
</span><span id="L-440"><a href="#-440"><span class="linenos"> 440</span></a>                        <span class="n">input_cube</span><span class="p">[</span><span class="n">input_cube</span> <span class="o">==</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-441"><a href="#-441"><span class="linenos"> 441</span></a>                            <span class="n">values</span><span class="p">[</span><span class="n">input_cube</span> <span class="o">==</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1.0</span>
</span><span id="L-442"><a href="#-442"><span class="linenos"> 442</span></a>                        <span class="p">)</span>
</span><span id="L-443"><a href="#-443"><span class="linenos"> 443</span></a>                        <span class="n">input_cube</span><span class="p">[</span><span class="n">input_cube</span> <span class="o">!=</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">]</span> <span class="o">+=</span> <span class="n">values</span><span class="p">[</span><span class="n">input_cube</span> <span class="o">!=</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">]</span>
</span><span id="L-444"><a href="#-444"><span class="linenos"> 444</span></a>                        <span class="n">work_cube_sealed</span><span class="p">[</span>
</span><span id="L-445"><a href="#-445"><span class="linenos"> 445</span></a>                            <span class="n">sublayer_ii</span><span class="p">,</span> <span class="n">sublayer_jj</span><span class="p">,</span> <span class="n">sublayer_depth_map_int</span>
</span><span id="L-446"><a href="#-446"><span class="linenos"> 446</span></a>                        <span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">input_cube</span> <span class="o">*</span> <span class="mf">1.0</span><span class="p">)</span>
</span><span id="L-447"><a href="#-447"><span class="linenos"> 447</span></a>                        <span class="k">del</span> <span class="n">input_cube</span>
</span><span id="L-448"><a href="#-448"><span class="linenos"> 448</span></a>                        <span class="k">del</span> <span class="n">values</span>
</span><span id="L-449"><a href="#-449"><span class="linenos"> 449</span></a>
</span><span id="L-450"><a href="#-450"><span class="linenos"> 450</span></a>                        <span class="c1"># Depth cube</span>
</span><span id="L-451"><a href="#-451"><span class="linenos"> 451</span></a>                        <span class="n">work_cube_depth</span><span class="p">[</span>
</span><span id="L-452"><a href="#-452"><span class="linenos"> 452</span></a>                            <span class="n">sublayer_ii</span><span class="p">,</span> <span class="n">sublayer_jj</span><span class="p">,</span> <span class="n">sublayer_depth_map_int</span>
</span><span id="L-453"><a href="#-453"><span class="linenos"> 453</span></a>                        <span class="p">]</span> <span class="o">+=</span> <span class="p">(</span><span class="n">sublayer_tvdml_map</span> <span class="o">*</span> <span class="n">sublayer_fraction</span><span class="p">)</span>
</span><span id="L-454"><a href="#-454"><span class="linenos"> 454</span></a>                        <span class="c1"># Net to Gross cube</span>
</span><span id="L-455"><a href="#-455"><span class="linenos"> 455</span></a>                        <span class="n">work_cube_net_to_gross</span><span class="p">[</span>
</span><span id="L-456"><a href="#-456"><span class="linenos"> 456</span></a>                            <span class="n">sublayer_ii</span><span class="p">,</span> <span class="n">sublayer_jj</span><span class="p">,</span> <span class="n">sublayer_depth_map_int</span>
</span><span id="L-457"><a href="#-457"><span class="linenos"> 457</span></a>                        <span class="p">]</span> <span class="o">+=</span> <span class="p">(</span><span class="n">sublayer_ng_map</span> <span class="o">*</span> <span class="n">sublayer_fraction</span><span class="p">)</span>
</span><span id="L-458"><a href="#-458"><span class="linenos"> 458</span></a>
</span><span id="L-459"><a href="#-459"><span class="linenos"> 459</span></a>                        <span class="c1"># Randomised Depth Cube</span>
</span><span id="L-460"><a href="#-460"><span class="linenos"> 460</span></a>                        <span class="c1"># randomised_depth[sublayer_ii, sublayer_jj, sublayer_depth_map_int] += \</span>
</span><span id="L-461"><a href="#-461"><span class="linenos"> 461</span></a>                        <span class="c1">#     (sublayer_tvdml_map + random_z_perturbation) * sublayer_fraction</span>
</span><span id="L-462"><a href="#-462"><span class="linenos"> 462</span></a>
</span><span id="L-463"><a href="#-463"><span class="linenos"> 463</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="L-464"><a href="#-464"><span class="linenos"> 464</span></a>                        <span class="n">sublayer_depth_map_int</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-465"><a href="#-465"><span class="linenos"> 465</span></a>                            <span class="mf">0.5</span>
</span><span id="L-466"><a href="#-466"><span class="linenos"> 466</span></a>                            <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span>
</span><span id="L-467"><a href="#-467"><span class="linenos"> 467</span></a>                                <span class="n">previous_depth_map</span><span class="p">[</span><span class="n">thickness_map</span> <span class="o">&gt;</span> <span class="n">k</span><span class="p">],</span>
</span><span id="L-468"><a href="#-468"><span class="linenos"> 468</span></a>                                <span class="mi">0</span><span class="p">,</span>
</span><span id="L-469"><a href="#-469"><span class="linenos"> 469</span></a>                                <span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">geologic_age</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="L-470"><a href="#-470"><span class="linenos"> 470</span></a>                            <span class="p">)</span>
</span><span id="L-471"><a href="#-471"><span class="linenos"> 471</span></a>                        <span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;int&quot;</span><span class="p">)</span> <span class="o">-</span> <span class="n">k</span>
</span><span id="L-472"><a href="#-472"><span class="linenos"> 472</span></a>                        <span class="n">sublayer_tvdml_map</span> <span class="o">=</span> <span class="n">tvdml_map</span><span class="p">[</span><span class="n">thickness_map</span> <span class="o">&gt;</span> <span class="n">k</span><span class="p">]</span>
</span><span id="L-473"><a href="#-473"><span class="linenos"> 473</span></a>                        <span class="n">sublayer_ng_map</span> <span class="o">=</span> <span class="n">ng_map</span><span class="p">[</span><span class="n">thickness_map</span> <span class="o">&gt;</span> <span class="n">k</span><span class="p">]</span>
</span><span id="L-474"><a href="#-474"><span class="linenos"> 474</span></a>
</span><span id="L-475"><a href="#-475"><span class="linenos"> 475</span></a>                        <span class="n">work_cube_lith</span><span class="p">[</span>
</span><span id="L-476"><a href="#-476"><span class="linenos"> 476</span></a>                            <span class="n">sublayer_ii</span><span class="p">,</span> <span class="n">sublayer_jj</span><span class="p">,</span> <span class="n">sublayer_depth_map_int</span>
</span><span id="L-477"><a href="#-477"><span class="linenos"> 477</span></a>                        <span class="p">]</span> <span class="o">=</span> <span class="n">facies</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="L-478"><a href="#-478"><span class="linenos"> 478</span></a>                        <span class="n">work_cube_sealed</span><span class="p">[</span>
</span><span id="L-479"><a href="#-479"><span class="linenos"> 479</span></a>                            <span class="n">sublayer_ii</span><span class="p">,</span> <span class="n">sublayer_jj</span><span class="p">,</span> <span class="n">sublayer_depth_map_int</span>
</span><span id="L-480"><a href="#-480"><span class="linenos"> 480</span></a>                        <span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">facies</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span>
</span><span id="L-481"><a href="#-481"><span class="linenos"> 481</span></a>
</span><span id="L-482"><a href="#-482"><span class="linenos"> 482</span></a>                        <span class="n">work_cube_depth</span><span class="p">[</span>
</span><span id="L-483"><a href="#-483"><span class="linenos"> 483</span></a>                            <span class="n">sublayer_ii</span><span class="p">,</span> <span class="n">sublayer_jj</span><span class="p">,</span> <span class="n">sublayer_depth_map_int</span>
</span><span id="L-484"><a href="#-484"><span class="linenos"> 484</span></a>                        <span class="p">]</span> <span class="o">=</span> <span class="n">sublayer_tvdml_map</span>
</span><span id="L-485"><a href="#-485"><span class="linenos"> 485</span></a>                        <span class="n">work_cube_net_to_gross</span><span class="p">[</span>
</span><span id="L-486"><a href="#-486"><span class="linenos"> 486</span></a>                            <span class="n">sublayer_ii</span><span class="p">,</span> <span class="n">sublayer_jj</span><span class="p">,</span> <span class="n">sublayer_depth_map_int</span>
</span><span id="L-487"><a href="#-487"><span class="linenos"> 487</span></a>                        <span class="p">]</span> <span class="o">+=</span> <span class="n">sublayer_ng_map</span>
</span><span id="L-488"><a href="#-488"><span class="linenos"> 488</span></a>                        <span class="c1"># randomised_depth[sublayer_ii, sublayer_jj, sublayer_depth_map_int] += (sublayer_tvdml_map + random_z_perturbation)</span>
</span><span id="L-489"><a href="#-489"><span class="linenos"> 489</span></a>
</span><span id="L-490"><a href="#-490"><span class="linenos"> 490</span></a>            <span class="c1"># replace previous depth map for next iteration</span>
</span><span id="L-491"><a href="#-491"><span class="linenos"> 491</span></a>            <span class="n">previous_depth_map</span> <span class="o">=</span> <span class="n">current_depth_map</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-492"><a href="#-492"><span class="linenos"> 492</span></a>
</span><span id="L-493"><a href="#-493"><span class="linenos"> 493</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="L-494"><a href="#-494"><span class="linenos"> 494</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2"> ... After infilling ...&quot;</span><span class="p">)</span>
</span><span id="L-495"><a href="#-495"><span class="linenos"> 495</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">write_cube_to_disk</span><span class="p">(</span><span class="n">work_cube_sealed</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;uint8&quot;</span><span class="p">),</span> <span class="s2">&quot;sealed_label&quot;</span><span class="p">)</span>
</span><span id="L-496"><a href="#-496"><span class="linenos"> 496</span></a>
</span><span id="L-497"><a href="#-497"><span class="linenos"> 497</span></a>        <span class="c1"># Clip cubes and convert from samples to units</span>
</span><span id="L-498"><a href="#-498"><span class="linenos"> 498</span></a>        <span class="n">work_cube_lith</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">work_cube_lith</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>  <span class="c1"># clip lith to [-1, +1]</span>
</span><span id="L-499"><a href="#-499"><span class="linenos"> 499</span></a>        <span class="n">work_cube_net_to_gross</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span>
</span><span id="L-500"><a href="#-500"><span class="linenos"> 500</span></a>            <span class="n">work_cube_net_to_gross</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">1.0</span>
</span><span id="L-501"><a href="#-501"><span class="linenos"> 501</span></a>        <span class="p">)</span>  <span class="c1"># clip n/g to [0, 1]</span>
</span><span id="L-502"><a href="#-502"><span class="linenos"> 502</span></a>        <span class="n">work_cube_depth</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">work_cube_depth</span><span class="p">,</span> <span class="n">a_min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">a_max</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</span><span id="L-503"><a href="#-503"><span class="linenos"> 503</span></a>        <span class="n">work_cube_depth</span> <span class="o">*=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">digi</span>
</span><span id="L-504"><a href="#-504"><span class="linenos"> 504</span></a>
</span><span id="L-505"><a href="#-505"><span class="linenos"> 505</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">include_salt</span><span class="p">:</span>
</span><span id="L-506"><a href="#-506"><span class="linenos"> 506</span></a>            <span class="c1"># Update age model after horizons have been modified by salt inclusion</span>
</span><span id="L-507"><a href="#-507"><span class="linenos"> 507</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">faulted_age_volume</span><span class="p">[</span>
</span><span id="L-508"><a href="#-508"><span class="linenos"> 508</span></a>                <span class="p">:</span>
</span><span id="L-509"><a href="#-509"><span class="linenos"> 509</span></a>            <span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_geologic_age_3d_from_infilled_horizons</span><span class="p">(</span>
</span><span id="L-510"><a href="#-510"><span class="linenos"> 510</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">faulted_depth_maps</span><span class="p">[:]</span> <span class="o">*</span> <span class="mf">10.0</span>
</span><span id="L-511"><a href="#-511"><span class="linenos"> 511</span></a>            <span class="p">)</span>
</span><span id="L-512"><a href="#-512"><span class="linenos"> 512</span></a>            <span class="c1"># Set lith code for salt</span>
</span><span id="L-513"><a href="#-513"><span class="linenos"> 513</span></a>            <span class="n">work_cube_lith</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">salt_model</span><span class="o">.</span><span class="n">salt_segments</span><span class="p">[:]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">2.0</span>
</span><span id="L-514"><a href="#-514"><span class="linenos"> 514</span></a>            <span class="c1"># Fix deepest part of facies in case salt inclusion has shifted base horizon</span>
</span><span id="L-515"><a href="#-515"><span class="linenos"> 515</span></a>            <span class="c1"># This can leave default (water) facies codes at the base</span>
</span><span id="L-516"><a href="#-516"><span class="linenos"> 516</span></a>            <span class="n">last_50_samples</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">50</span>
</span><span id="L-517"><a href="#-517"><span class="linenos"> 517</span></a>            <span class="n">work_cube_lith</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">last_50_samples</span><span class="p">:][</span>
</span><span id="L-518"><a href="#-518"><span class="linenos"> 518</span></a>                <span class="n">work_cube_lith</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">last_50_samples</span><span class="p">:]</span> <span class="o">==</span> <span class="o">-</span><span class="mf">1.0</span>
</span><span id="L-519"><a href="#-519"><span class="linenos"> 519</span></a>            <span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="L-520"><a href="#-520"><span class="linenos"> 520</span></a>
</span><span id="L-521"><a href="#-521"><span class="linenos"> 521</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">qc_plots</span><span class="p">:</span>
</span><span id="L-522"><a href="#-522"><span class="linenos"> 522</span></a>            <span class="kn">from</span> <span class="nn">datagenerator.util</span> <span class="kn">import</span> <span class="n">plot_xsection</span>
</span><span id="L-523"><a href="#-523"><span class="linenos"> 523</span></a>            <span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>
</span><span id="L-524"><a href="#-524"><span class="linenos"> 524</span></a>
</span><span id="L-525"><a href="#-525"><span class="linenos"> 525</span></a>            <span class="n">line_number</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span>
</span><span id="L-526"><a href="#-526"><span class="linenos"> 526</span></a>                <span class="n">work_cube_lith</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span>
</span><span id="L-527"><a href="#-527"><span class="linenos"> 527</span></a>            <span class="p">)</span>  <span class="c1"># pick centre line for all plots</span>
</span><span id="L-528"><a href="#-528"><span class="linenos"> 528</span></a>
</span><span id="L-529"><a href="#-529"><span class="linenos"> 529</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">include_salt</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">work_cube_lith</span><span class="p">[</span><span class="n">line_number</span><span class="p">,</span> <span class="o">...</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-530"><a href="#-530"><span class="linenos"> 530</span></a>                <span class="n">lith_cmap</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">ListedColormap</span><span class="p">(</span>
</span><span id="L-531"><a href="#-531"><span class="linenos"> 531</span></a>                    <span class="p">[</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="s2">&quot;saddlebrown&quot;</span><span class="p">,</span> <span class="s2">&quot;gold&quot;</span><span class="p">,</span> <span class="s2">&quot;grey&quot;</span><span class="p">]</span>
</span><span id="L-532"><a href="#-532"><span class="linenos"> 532</span></a>                <span class="p">)</span>
</span><span id="L-533"><a href="#-533"><span class="linenos"> 533</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-534"><a href="#-534"><span class="linenos"> 534</span></a>                <span class="n">lith_cmap</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">ListedColormap</span><span class="p">([</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="s2">&quot;saddlebrown&quot;</span><span class="p">,</span> <span class="s2">&quot;gold&quot;</span><span class="p">])</span>
</span><span id="L-535"><a href="#-535"><span class="linenos"> 535</span></a>            <span class="n">plot_xsection</span><span class="p">(</span>
</span><span id="L-536"><a href="#-536"><span class="linenos"> 536</span></a>                <span class="n">work_cube_lith</span><span class="p">,</span>
</span><span id="L-537"><a href="#-537"><span class="linenos"> 537</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">faulted_depth_maps</span><span class="p">[:],</span>
</span><span id="L-538"><a href="#-538"><span class="linenos"> 538</span></a>                <span class="n">line_num</span><span class="o">=</span><span class="n">line_number</span><span class="p">,</span>
</span><span id="L-539"><a href="#-539"><span class="linenos"> 539</span></a>                <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Example Trav through 3D model</span><span class="se">\n</span><span class="s2">Lithology&quot;</span><span class="p">,</span>
</span><span id="L-540"><a href="#-540"><span class="linenos"> 540</span></a>                <span class="n">png_name</span><span class="o">=</span><span class="s2">&quot;QC_plot__AfterFaulting_lithology.png&quot;</span><span class="p">,</span>
</span><span id="L-541"><a href="#-541"><span class="linenos"> 541</span></a>                <span class="n">cfg</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="p">,</span>
</span><span id="L-542"><a href="#-542"><span class="linenos"> 542</span></a>                <span class="n">cmap</span><span class="o">=</span><span class="n">lith_cmap</span><span class="p">,</span>
</span><span id="L-543"><a href="#-543"><span class="linenos"> 543</span></a>            <span class="p">)</span>
</span><span id="L-544"><a href="#-544"><span class="linenos"> 544</span></a>            <span class="n">plot_xsection</span><span class="p">(</span>
</span><span id="L-545"><a href="#-545"><span class="linenos"> 545</span></a>                <span class="n">work_cube_depth</span><span class="p">,</span>
</span><span id="L-546"><a href="#-546"><span class="linenos"> 546</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">faulted_depth_maps</span><span class="p">,</span>
</span><span id="L-547"><a href="#-547"><span class="linenos"> 547</span></a>                <span class="n">line_num</span><span class="o">=</span><span class="n">line_number</span><span class="p">,</span>
</span><span id="L-548"><a href="#-548"><span class="linenos"> 548</span></a>                <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Example Trav through 3D model</span><span class="se">\n</span><span class="s2">Depth Below Mudline&quot;</span><span class="p">,</span>
</span><span id="L-549"><a href="#-549"><span class="linenos"> 549</span></a>                <span class="n">png_name</span><span class="o">=</span><span class="s2">&quot;QC_plot__AfterFaulting_depth_bml.png&quot;</span><span class="p">,</span>
</span><span id="L-550"><a href="#-550"><span class="linenos"> 550</span></a>                <span class="n">cfg</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="p">,</span>
</span><span id="L-551"><a href="#-551"><span class="linenos"> 551</span></a>                <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;cubehelix_r&quot;</span><span class="p">,</span>
</span><span id="L-552"><a href="#-552"><span class="linenos"> 552</span></a>            <span class="p">)</span>
</span><span id="L-553"><a href="#-553"><span class="linenos"> 553</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">faulted_lithology</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">work_cube_lith</span>
</span><span id="L-554"><a href="#-554"><span class="linenos"> 554</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">faulted_net_to_gross</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">work_cube_net_to_gross</span>
</span><span id="L-555"><a href="#-555"><span class="linenos"> 555</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">faulted_depth</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">work_cube_depth</span>
</span><span id="L-556"><a href="#-556"><span class="linenos"> 556</span></a>        <span class="c1"># self.randomised_depth[:] = randomised_depth</span>
</span><span id="L-557"><a href="#-557"><span class="linenos"> 557</span></a>
</span><span id="L-558"><a href="#-558"><span class="linenos"> 558</span></a>        <span class="c1"># Write the % sand in model to logfile</span>
</span><span id="L-559"><a href="#-559"><span class="linenos"> 559</span></a>        <span class="n">sand_fraction</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-560"><a href="#-560"><span class="linenos"> 560</span></a>            <span class="n">work_cube_lith</span><span class="p">[</span><span class="n">work_cube_lith</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="L-561"><a href="#-561"><span class="linenos"> 561</span></a>            <span class="o">/</span> <span class="n">work_cube_lith</span><span class="p">[</span><span class="n">work_cube_lith</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="L-562"><a href="#-562"><span class="linenos"> 562</span></a>        <span class="p">)</span>
</span><span id="L-563"><a href="#-563"><span class="linenos"> 563</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="L-564"><a href="#-564"><span class="linenos"> 564</span></a>            <span class="sa">f</span><span class="s2">&quot;Sand voxel % in model </span><span class="si">{</span><span class="mi">100</span> <span class="o">*</span> <span class="n">sand_fraction</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">,</span>
</span><span id="L-565"><a href="#-565"><span class="linenos"> 565</span></a>            <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span>
</span><span id="L-566"><a href="#-566"><span class="linenos"> 566</span></a>            <span class="n">subkey</span><span class="o">=</span><span class="s2">&quot;sand_voxel_pct&quot;</span><span class="p">,</span>
</span><span id="L-567"><a href="#-567"><span class="linenos"> 567</span></a>            <span class="n">val</span><span class="o">=</span><span class="mi">100</span> <span class="o">*</span> <span class="n">sand_fraction</span><span class="p">,</span>
</span><span id="L-568"><a href="#-568"><span class="linenos"> 568</span></a>        <span class="p">)</span>
</span><span id="L-569"><a href="#-569"><span class="linenos"> 569</span></a>
</span><span id="L-570"><a href="#-570"><span class="linenos"> 570</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_store</span><span class="p">:</span>
</span><span id="L-571"><a href="#-571"><span class="linenos"> 571</span></a>            <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
</span><span id="L-572"><a href="#-572"><span class="linenos"> 572</span></a>                <span class="p">[</span><span class="s2">&quot;lithology&quot;</span><span class="p">,</span> <span class="s2">&quot;net_to_gross&quot;</span><span class="p">,</span> <span class="s2">&quot;depth&quot;</span><span class="p">],</span>
</span><span id="L-573"><a href="#-573"><span class="linenos"> 573</span></a>                <span class="p">[</span>
</span><span id="L-574"><a href="#-574"><span class="linenos"> 574</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">faulted_lithology</span><span class="p">[:],</span>
</span><span id="L-575"><a href="#-575"><span class="linenos"> 575</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">faulted_net_to_gross</span><span class="p">[:],</span>
</span><span id="L-576"><a href="#-576"><span class="linenos"> 576</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">faulted_depth</span><span class="p">[:],</span>
</span><span id="L-577"><a href="#-577"><span class="linenos"> 577</span></a>                <span class="p">],</span>
</span><span id="L-578"><a href="#-578"><span class="linenos"> 578</span></a>            <span class="p">):</span>
</span><span id="L-579"><a href="#-579"><span class="linenos"> 579</span></a>                <span class="n">write_data_to_hdf</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_master</span><span class="p">)</span>
</span><span id="L-580"><a href="#-580"><span class="linenos"> 580</span></a>
</span><span id="L-581"><a href="#-581"><span class="linenos"> 581</span></a>        <span class="c1"># Save out reservoir volume for XAI-NBDT</span>
</span><span id="L-582"><a href="#-582"><span class="linenos"> 582</span></a>        <span class="n">reservoir</span> <span class="o">=</span> <span class="p">(</span><span class="n">work_cube_lith</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1.0</span>
</span><span id="L-583"><a href="#-583"><span class="linenos"> 583</span></a>        <span class="n">reservoir_dilated</span> <span class="o">=</span> <span class="n">binary_dilation</span><span class="p">(</span><span class="n">reservoir</span><span class="p">)</span>
</span><span id="L-584"><a href="#-584"><span class="linenos"> 584</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">reservoir</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">reservoir_dilated</span>
</span><span id="L-585"><a href="#-585"><span class="linenos"> 585</span></a>
</span><span id="L-586"><a href="#-586"><span class="linenos"> 586</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">model_qc_volumes</span><span class="p">:</span>
</span><span id="L-587"><a href="#-587"><span class="linenos"> 587</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">write_cube_to_disk</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faulted_lithology</span><span class="p">[:],</span> <span class="s2">&quot;faulted_lithology&quot;</span><span class="p">)</span>
</span><span id="L-588"><a href="#-588"><span class="linenos"> 588</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">write_cube_to_disk</span><span class="p">(</span>
</span><span id="L-589"><a href="#-589"><span class="linenos"> 589</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">faulted_net_to_gross</span><span class="p">[:],</span> <span class="s2">&quot;faulted_net_to_gross&quot;</span>
</span><span id="L-590"><a href="#-590"><span class="linenos"> 590</span></a>            <span class="p">)</span>
</span><span id="L-591"><a href="#-591"><span class="linenos"> 591</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">write_cube_to_disk</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faulted_depth</span><span class="p">[:],</span> <span class="s2">&quot;faulted_depth&quot;</span><span class="p">)</span>
</span><span id="L-592"><a href="#-592"><span class="linenos"> 592</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">write_cube_to_disk</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faulted_age_volume</span><span class="p">[:],</span> <span class="s2">&quot;faulted_age&quot;</span><span class="p">)</span>
</span><span id="L-593"><a href="#-593"><span class="linenos"> 593</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">include_salt</span><span class="p">:</span>
</span><span id="L-594"><a href="#-594"><span class="linenos"> 594</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">write_cube_to_disk</span><span class="p">(</span>
</span><span id="L-595"><a href="#-595"><span class="linenos"> 595</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">salt_model</span><span class="o">.</span><span class="n">salt_segments</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span>
</span><span id="L-596"><a href="#-596"><span class="linenos"> 596</span></a>                        <span class="s2">&quot;uint8&quot;</span>
</span><span id="L-597"><a href="#-597"><span class="linenos"> 597</span></a>                    <span class="p">),</span>
</span><span id="L-598"><a href="#-598"><span class="linenos"> 598</span></a>                    <span class="s2">&quot;salt&quot;</span><span class="p">,</span>
</span><span id="L-599"><a href="#-599"><span class="linenos"> 599</span></a>                <span class="p">)</span>
</span><span id="L-600"><a href="#-600"><span class="linenos"> 600</span></a>
</span><span id="L-601"><a href="#-601"><span class="linenos"> 601</span></a>    <span class="k">def</span> <span class="nf">create_qc_plots</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-602"><a href="#-602"><span class="linenos"> 602</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-603"><a href="#-603"><span class="linenos"> 603</span></a><span class="sd">        Create QC Plots</span>
</span><span id="L-604"><a href="#-604"><span class="linenos"> 604</span></a><span class="sd">        ---------------</span>
</span><span id="L-605"><a href="#-605"><span class="linenos"> 605</span></a><span class="sd">        Creates QC Plots of faulted models and histograms of</span>
</span><span id="L-606"><a href="#-606"><span class="linenos"> 606</span></a><span class="sd">        voxels which are not in layers.</span>
</span><span id="L-607"><a href="#-607"><span class="linenos"> 607</span></a>
</span><span id="L-608"><a href="#-608"><span class="linenos"> 608</span></a><span class="sd">        Parameters</span>
</span><span id="L-609"><a href="#-609"><span class="linenos"> 609</span></a><span class="sd">        ----------</span>
</span><span id="L-610"><a href="#-610"><span class="linenos"> 610</span></a><span class="sd">        None</span>
</span><span id="L-611"><a href="#-611"><span class="linenos"> 611</span></a>
</span><span id="L-612"><a href="#-612"><span class="linenos"> 612</span></a><span class="sd">        Returns</span>
</span><span id="L-613"><a href="#-613"><span class="linenos"> 613</span></a><span class="sd">        -------</span>
</span><span id="L-614"><a href="#-614"><span class="linenos"> 614</span></a><span class="sd">        None</span>
</span><span id="L-615"><a href="#-615"><span class="linenos"> 615</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-616"><a href="#-616"><span class="linenos"> 616</span></a>        <span class="kn">from</span> <span class="nn">datagenerator.util</span> <span class="kn">import</span> <span class="p">(</span>
</span><span id="L-617"><a href="#-617"><span class="linenos"> 617</span></a>            <span class="n">find_line_with_most_voxels</span><span class="p">,</span>
</span><span id="L-618"><a href="#-618"><span class="linenos"> 618</span></a>            <span class="n">plot_voxels_not_in_regular_layers</span><span class="p">,</span>
</span><span id="L-619"><a href="#-619"><span class="linenos"> 619</span></a>            <span class="n">plot_xsection</span><span class="p">,</span>
</span><span id="L-620"><a href="#-620"><span class="linenos"> 620</span></a>        <span class="p">)</span>
</span><span id="L-621"><a href="#-621"><span class="linenos"> 621</span></a>
</span><span id="L-622"><a href="#-622"><span class="linenos"> 622</span></a>        <span class="c1"># analyze voxel values not in regular layers</span>
</span><span id="L-623"><a href="#-623"><span class="linenos"> 623</span></a>        <span class="n">plot_voxels_not_in_regular_layers</span><span class="p">(</span>
</span><span id="L-624"><a href="#-624"><span class="linenos"> 624</span></a>            <span class="n">volume</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">faulted_age_volume</span><span class="p">[:],</span>
</span><span id="L-625"><a href="#-625"><span class="linenos"> 625</span></a>            <span class="n">threshold</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
</span><span id="L-626"><a href="#-626"><span class="linenos"> 626</span></a>            <span class="n">cfg</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="p">,</span>
</span><span id="L-627"><a href="#-627"><span class="linenos"> 627</span></a>            <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Example Trav through 3D model</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="L-628"><a href="#-628"><span class="linenos"> 628</span></a>            <span class="o">+</span> <span class="s2">&quot;histogram of layers after faulting, before inserting channel facies&quot;</span><span class="p">,</span>
</span><span id="L-629"><a href="#-629"><span class="linenos"> 629</span></a>            <span class="n">png_name</span><span class="o">=</span><span class="s2">&quot;QC_plot__Channels__histogram_FaultedLayersNoChannels.png&quot;</span><span class="p">,</span>
</span><span id="L-630"><a href="#-630"><span class="linenos"> 630</span></a>        <span class="p">)</span>
</span><span id="L-631"><a href="#-631"><span class="linenos"> 631</span></a>        <span class="k">try</span><span class="p">:</span>  <span class="c1"># if channel_segments exists</span>
</span><span id="L-632"><a href="#-632"><span class="linenos"> 632</span></a>            <span class="n">inline_index_channels</span> <span class="o">=</span> <span class="n">find_line_with_most_voxels</span><span class="p">(</span>
</span><span id="L-633"><a href="#-633"><span class="linenos"> 633</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">channel_segments</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span>
</span><span id="L-634"><a href="#-634"><span class="linenos"> 634</span></a>            <span class="p">)</span>
</span><span id="L-635"><a href="#-635"><span class="linenos"> 635</span></a>            <span class="n">plot_xsection</span><span class="p">(</span>
</span><span id="L-636"><a href="#-636"><span class="linenos"> 636</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">channel_segments</span><span class="p">,</span>
</span><span id="L-637"><a href="#-637"><span class="linenos"> 637</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">faulted_depth_maps</span><span class="p">,</span>
</span><span id="L-638"><a href="#-638"><span class="linenos"> 638</span></a>                <span class="n">inline_index_channels</span><span class="p">,</span>
</span><span id="L-639"><a href="#-639"><span class="linenos"> 639</span></a>                <span class="n">cfg</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="p">,</span>
</span><span id="L-640"><a href="#-640"><span class="linenos"> 640</span></a>                <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Example Trav through 3D model</span><span class="se">\n</span><span class="s2">channel_segments after faulting&quot;</span><span class="p">,</span>
</span><span id="L-641"><a href="#-641"><span class="linenos"> 641</span></a>                <span class="n">png_name</span><span class="o">=</span><span class="s2">&quot;QC_plot__AfterFaulting_channel_segments.png&quot;</span><span class="p">,</span>
</span><span id="L-642"><a href="#-642"><span class="linenos"> 642</span></a>            <span class="p">)</span>
</span><span id="L-643"><a href="#-643"><span class="linenos"> 643</span></a>            <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Example Trav through 3D model</span><span class="se">\n</span><span class="s2">Layers Filled With Layer Number / ChannelsAdded / Faulted&quot;</span>
</span><span id="L-644"><a href="#-644"><span class="linenos"> 644</span></a>            <span class="n">png_name</span> <span class="o">=</span> <span class="s2">&quot;QC_plot__LayersFilledWithLayerNumber_ChannelsAdded_Faulted.png&quot;</span>
</span><span id="L-645"><a href="#-645"><span class="linenos"> 645</span></a>        <span class="k">except</span> <span class="p">(</span><span class="ne">NameError</span><span class="p">,</span> <span class="ne">AttributeError</span><span class="p">):</span>  <span class="c1"># channel_segments does not exist</span>
</span><span id="L-646"><a href="#-646"><span class="linenos"> 646</span></a>            <span class="n">inline_index_channels</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faulted_age_volume</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="L-647"><a href="#-647"><span class="linenos"> 647</span></a>            <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Example Trav through 3D model</span><span class="se">\n</span><span class="s2">Layers Filled With Layer Number / Faulted&quot;</span>
</span><span id="L-648"><a href="#-648"><span class="linenos"> 648</span></a>            <span class="n">png_name</span> <span class="o">=</span> <span class="s2">&quot;QC_plot__LayersFilledWithLayerNumber_Faulted.png&quot;</span>
</span><span id="L-649"><a href="#-649"><span class="linenos"> 649</span></a>        <span class="n">plot_xsection</span><span class="p">(</span>
</span><span id="L-650"><a href="#-650"><span class="linenos"> 650</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">faulted_age_volume</span><span class="p">[:],</span>
</span><span id="L-651"><a href="#-651"><span class="linenos"> 651</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">faulted_depth_maps</span><span class="p">[:],</span>
</span><span id="L-652"><a href="#-652"><span class="linenos"> 652</span></a>            <span class="n">inline_index_channels</span><span class="p">,</span>
</span><span id="L-653"><a href="#-653"><span class="linenos"> 653</span></a>            <span class="n">title</span><span class="p">,</span>
</span><span id="L-654"><a href="#-654"><span class="linenos"> 654</span></a>            <span class="n">png_name</span><span class="p">,</span>
</span><span id="L-655"><a href="#-655"><span class="linenos"> 655</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="p">,</span>
</span><span id="L-656"><a href="#-656"><span class="linenos"> 656</span></a>        <span class="p">)</span>
</span><span id="L-657"><a href="#-657"><span class="linenos"> 657</span></a>
</span><span id="L-658"><a href="#-658"><span class="linenos"> 658</span></a>    <span class="k">def</span> <span class="nf">generate_faults</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="L-659"><a href="#-659"><span class="linenos"> 659</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-660"><a href="#-660"><span class="linenos"> 660</span></a><span class="sd">        Generate Faults</span>
</span><span id="L-661"><a href="#-661"><span class="linenos"> 661</span></a><span class="sd">        ---------------</span>
</span><span id="L-662"><a href="#-662"><span class="linenos"> 662</span></a><span class="sd">        Generates faults in the model.</span>
</span><span id="L-663"><a href="#-663"><span class="linenos"> 663</span></a>
</span><span id="L-664"><a href="#-664"><span class="linenos"> 664</span></a><span class="sd">        Parameters</span>
</span><span id="L-665"><a href="#-665"><span class="linenos"> 665</span></a><span class="sd">        ----------</span>
</span><span id="L-666"><a href="#-666"><span class="linenos"> 666</span></a><span class="sd">        None</span>
</span><span id="L-667"><a href="#-667"><span class="linenos"> 667</span></a>
</span><span id="L-668"><a href="#-668"><span class="linenos"> 668</span></a><span class="sd">        Returns</span>
</span><span id="L-669"><a href="#-669"><span class="linenos"> 669</span></a><span class="sd">        -------</span>
</span><span id="L-670"><a href="#-670"><span class="linenos"> 670</span></a><span class="sd">        displacements_classification : np.ndarray</span>
</span><span id="L-671"><a href="#-671"><span class="linenos"> 671</span></a><span class="sd">            Array of fault displacement classifications</span>
</span><span id="L-672"><a href="#-672"><span class="linenos"> 672</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-673"><a href="#-673"><span class="linenos"> 673</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="L-674"><a href="#-674"><span class="linenos"> 674</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; ... create </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">number_faults</span><span class="si">}</span><span class="s2"> faults&quot;</span><span class="p">)</span>
</span><span id="L-675"><a href="#-675"><span class="linenos"> 675</span></a>        <span class="n">fault_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fault_parameters</span><span class="p">()</span>
</span><span id="L-676"><a href="#-676"><span class="linenos"> 676</span></a>
</span><span id="L-677"><a href="#-677"><span class="linenos"> 677</span></a>        <span class="c1"># Write fault parameters to logfile</span>
</span><span id="L-678"><a href="#-678"><span class="linenos"> 678</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="L-679"><a href="#-679"><span class="linenos"> 679</span></a>            <span class="sa">f</span><span class="s2">&quot;Fault_mode: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">fmode</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="L-680"><a href="#-680"><span class="linenos"> 680</span></a>            <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span>
</span><span id="L-681"><a href="#-681"><span class="linenos"> 681</span></a>            <span class="n">subkey</span><span class="o">=</span><span class="s2">&quot;fault_mode&quot;</span><span class="p">,</span>
</span><span id="L-682"><a href="#-682"><span class="linenos"> 682</span></a>            <span class="n">val</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">fmode</span><span class="p">,</span>
</span><span id="L-683"><a href="#-683"><span class="linenos"> 683</span></a>        <span class="p">)</span>
</span><span id="L-684"><a href="#-684"><span class="linenos"> 684</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="L-685"><a href="#-685"><span class="linenos"> 685</span></a>            <span class="sa">f</span><span class="s2">&quot;Noise_level: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">fnoise</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="L-686"><a href="#-686"><span class="linenos"> 686</span></a>            <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span>
</span><span id="L-687"><a href="#-687"><span class="linenos"> 687</span></a>            <span class="n">subkey</span><span class="o">=</span><span class="s2">&quot;noise_level&quot;</span><span class="p">,</span>
</span><span id="L-688"><a href="#-688"><span class="linenos"> 688</span></a>            <span class="n">val</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">fnoise</span><span class="p">,</span>
</span><span id="L-689"><a href="#-689"><span class="linenos"> 689</span></a>        <span class="p">)</span>
</span><span id="L-690"><a href="#-690"><span class="linenos"> 690</span></a>
</span><span id="L-691"><a href="#-691"><span class="linenos"> 691</span></a>        <span class="c1"># Build faults, and sum displacements</span>
</span><span id="L-692"><a href="#-692"><span class="linenos"> 692</span></a>        <span class="n">displacements_classification</span><span class="p">,</span> <span class="n">hockeys</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">build_faults</span><span class="p">(</span><span class="n">fault_params</span><span class="p">)</span>
</span><span id="L-693"><a href="#-693"><span class="linenos"> 693</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">model_qc_volumes</span><span class="p">:</span>
</span><span id="L-694"><a href="#-694"><span class="linenos"> 694</span></a>            <span class="c1"># Write max fault throw cube to disk</span>
</span><span id="L-695"><a href="#-695"><span class="linenos"> 695</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">write_cube_to_disk</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_fault_throw</span><span class="p">[:],</span> <span class="s2">&quot;max_fault_throw&quot;</span><span class="p">)</span>
</span><span id="L-696"><a href="#-696"><span class="linenos"> 696</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="L-697"><a href="#-697"><span class="linenos"> 697</span></a>            <span class="sa">f</span><span class="s2">&quot;Hockey_Sticks generated: </span><span class="si">{</span><span class="nb">sum</span><span class="p">(</span><span class="n">hockeys</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="L-698"><a href="#-698"><span class="linenos"> 698</span></a>            <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span>
</span><span id="L-699"><a href="#-699"><span class="linenos"> 699</span></a>            <span class="n">subkey</span><span class="o">=</span><span class="s2">&quot;hockey_sticks_generated&quot;</span><span class="p">,</span>
</span><span id="L-700"><a href="#-700"><span class="linenos"> 700</span></a>            <span class="n">val</span><span class="o">=</span><span class="nb">sum</span><span class="p">(</span><span class="n">hockeys</span><span class="p">),</span>
</span><span id="L-701"><a href="#-701"><span class="linenos"> 701</span></a>        <span class="p">)</span>
</span><span id="L-702"><a href="#-702"><span class="linenos"> 702</span></a>
</span><span id="L-703"><a href="#-703"><span class="linenos"> 703</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="L-704"><a href="#-704"><span class="linenos"> 704</span></a>            <span class="sa">f</span><span class="s2">&quot;Fault Info: a, b, c, x0, y0, z0, throw/infill_factor, shear_zone_width,&quot;</span>
</span><span id="L-705"><a href="#-705"><span class="linenos"> 705</span></a>            <span class="s2">&quot; gouge_pctile, tilt_pct*100&quot;</span>
</span><span id="L-706"><a href="#-706"><span class="linenos"> 706</span></a>        <span class="p">)</span>
</span><span id="L-707"><a href="#-707"><span class="linenos"> 707</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">number_faults</span><span class="p">):</span>
</span><span id="L-708"><a href="#-708"><span class="linenos"> 708</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="L-709"><a href="#-709"><span class="linenos"> 709</span></a>                <span class="sa">f</span><span class="s2">&quot;Fault_</span><span class="si">{</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">fault_params</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">fault_params</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">fault_params</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">,&quot;</span>
</span><span id="L-710"><a href="#-710"><span class="linenos"> 710</span></a>                <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">fault_params</span><span class="p">[</span><span class="s1">&#39;x0&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="si">:</span><span class="s2">&gt;7.2f</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">fault_params</span><span class="p">[</span><span class="s1">&#39;y0&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="si">:</span><span class="s2">&gt;7.2f</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">fault_params</span><span class="p">[</span><span class="s1">&#39;z0&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="si">:</span><span class="s2">&gt;8.2f</span><span class="si">}</span><span class="s2">,&quot;</span>
</span><span id="L-711"><a href="#-711"><span class="linenos"> 711</span></a>                <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">fault_params</span><span class="p">[</span><span class="s1">&#39;throw&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">infill_factor</span><span class="si">:</span><span class="s2">&gt;6.2f</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">fault_params</span><span class="p">[</span><span class="s1">&#39;tilt_pct&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="mi">100</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-712"><a href="#-712"><span class="linenos"> 712</span></a>            <span class="p">)</span>
</span><span id="L-713"><a href="#-713"><span class="linenos"> 713</span></a>
</span><span id="L-714"><a href="#-714"><span class="linenos"> 714</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="L-715"><a href="#-715"><span class="linenos"> 715</span></a>                <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-716"><a href="#-716"><span class="linenos"> 716</span></a>                <span class="n">mainkey</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;fault_</span><span class="si">{</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="L-717"><a href="#-717"><span class="linenos"> 717</span></a>                <span class="n">subkey</span><span class="o">=</span><span class="s2">&quot;model_id&quot;</span><span class="p">,</span>
</span><span id="L-718"><a href="#-718"><span class="linenos"> 718</span></a>                <span class="n">val</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">work_subfolder</span><span class="p">),</span>
</span><span id="L-719"><a href="#-719"><span class="linenos"> 719</span></a>            <span class="p">)</span>
</span><span id="L-720"><a href="#-720"><span class="linenos"> 720</span></a>            <span class="k">for</span> <span class="n">_subkey_name</span> <span class="ow">in</span> <span class="p">[</span>
</span><span id="L-721"><a href="#-721"><span class="linenos"> 721</span></a>                <span class="s2">&quot;a&quot;</span><span class="p">,</span>
</span><span id="L-722"><a href="#-722"><span class="linenos"> 722</span></a>                <span class="s2">&quot;b&quot;</span><span class="p">,</span>
</span><span id="L-723"><a href="#-723"><span class="linenos"> 723</span></a>                <span class="s2">&quot;c&quot;</span><span class="p">,</span>
</span><span id="L-724"><a href="#-724"><span class="linenos"> 724</span></a>                <span class="s2">&quot;x0&quot;</span><span class="p">,</span>
</span><span id="L-725"><a href="#-725"><span class="linenos"> 725</span></a>                <span class="s2">&quot;y0&quot;</span><span class="p">,</span>
</span><span id="L-726"><a href="#-726"><span class="linenos"> 726</span></a>                <span class="s2">&quot;z0&quot;</span><span class="p">,</span>
</span><span id="L-727"><a href="#-727"><span class="linenos"> 727</span></a>                <span class="s2">&quot;throw&quot;</span><span class="p">,</span>
</span><span id="L-728"><a href="#-728"><span class="linenos"> 728</span></a>                <span class="s2">&quot;tilt_pct&quot;</span><span class="p">,</span>
</span><span id="L-729"><a href="#-729"><span class="linenos"> 729</span></a>                <span class="s2">&quot;shear_zone_width&quot;</span><span class="p">,</span>
</span><span id="L-730"><a href="#-730"><span class="linenos"> 730</span></a>                <span class="s2">&quot;gouge_pctile&quot;</span><span class="p">,</span>
</span><span id="L-731"><a href="#-731"><span class="linenos"> 731</span></a>            <span class="p">]:</span>
</span><span id="L-732"><a href="#-732"><span class="linenos"> 732</span></a>                <span class="n">_val</span> <span class="o">=</span> <span class="n">fault_params</span><span class="p">[</span><span class="n">_subkey_name</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
</span><span id="L-733"><a href="#-733"><span class="linenos"> 733</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="L-734"><a href="#-734"><span class="linenos"> 734</span></a>                    <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mainkey</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;fault_</span><span class="si">{</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">subkey</span><span class="o">=</span><span class="n">_subkey_name</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">_val</span>
</span><span id="L-735"><a href="#-735"><span class="linenos"> 735</span></a>                <span class="p">)</span>
</span><span id="L-736"><a href="#-736"><span class="linenos"> 736</span></a>
</span><span id="L-737"><a href="#-737"><span class="linenos"> 737</span></a>        <span class="k">return</span> <span class="n">displacements_classification</span>
</span><span id="L-738"><a href="#-738"><span class="linenos"> 738</span></a>
</span><span id="L-739"><a href="#-739"><span class="linenos"> 739</span></a>    <span class="k">def</span> <span class="nf">fault_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-740"><a href="#-740"><span class="linenos"> 740</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-741"><a href="#-741"><span class="linenos"> 741</span></a><span class="sd">        Get Fault Parameters</span>
</span><span id="L-742"><a href="#-742"><span class="linenos"> 742</span></a><span class="sd">        ---------------</span>
</span><span id="L-743"><a href="#-743"><span class="linenos"> 743</span></a><span class="sd">        Returns the fault parameters.</span>
</span><span id="L-744"><a href="#-744"><span class="linenos"> 744</span></a>
</span><span id="L-745"><a href="#-745"><span class="linenos"> 745</span></a><span class="sd">        Factory design pattern used to select fault parameters</span>
</span><span id="L-746"><a href="#-746"><span class="linenos"> 746</span></a>
</span><span id="L-747"><a href="#-747"><span class="linenos"> 747</span></a><span class="sd">        Parameters</span>
</span><span id="L-748"><a href="#-748"><span class="linenos"> 748</span></a><span class="sd">        ----------</span>
</span><span id="L-749"><a href="#-749"><span class="linenos"> 749</span></a><span class="sd">        None</span>
</span><span id="L-750"><a href="#-750"><span class="linenos"> 750</span></a>
</span><span id="L-751"><a href="#-751"><span class="linenos"> 751</span></a><span class="sd">        Returns</span>
</span><span id="L-752"><a href="#-752"><span class="linenos"> 752</span></a><span class="sd">        -------</span>
</span><span id="L-753"><a href="#-753"><span class="linenos"> 753</span></a><span class="sd">        fault_mode : dict</span>
</span><span id="L-754"><a href="#-754"><span class="linenos"> 754</span></a><span class="sd">            Dictionary containing the fault parameters.</span>
</span><span id="L-755"><a href="#-755"><span class="linenos"> 755</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-756"><a href="#-756"><span class="linenos"> 756</span></a>        <span class="n">fault_mode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_fault_mode</span><span class="p">()</span>
</span><span id="L-757"><a href="#-757"><span class="linenos"> 757</span></a>        <span class="k">return</span> <span class="n">fault_mode</span><span class="p">()</span>
</span><span id="L-758"><a href="#-758"><span class="linenos"> 758</span></a>
</span><span id="L-759"><a href="#-759"><span class="linenos"> 759</span></a>    <span class="k">def</span> <span class="nf">build_faults</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fp</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="L-760"><a href="#-760"><span class="linenos"> 760</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-761"><a href="#-761"><span class="linenos"> 761</span></a><span class="sd">        Build Faults</span>
</span><span id="L-762"><a href="#-762"><span class="linenos"> 762</span></a><span class="sd">        ---------------</span>
</span><span id="L-763"><a href="#-763"><span class="linenos"> 763</span></a><span class="sd">        Creates faults in the model.</span>
</span><span id="L-764"><a href="#-764"><span class="linenos"> 764</span></a>
</span><span id="L-765"><a href="#-765"><span class="linenos"> 765</span></a><span class="sd">        Parameters</span>
</span><span id="L-766"><a href="#-766"><span class="linenos"> 766</span></a><span class="sd">        ----------</span>
</span><span id="L-767"><a href="#-767"><span class="linenos"> 767</span></a><span class="sd">        fp : dict</span>
</span><span id="L-768"><a href="#-768"><span class="linenos"> 768</span></a><span class="sd">            Dictionary containing the fault parameters.</span>
</span><span id="L-769"><a href="#-769"><span class="linenos"> 769</span></a><span class="sd">        verbose : bool</span>
</span><span id="L-770"><a href="#-770"><span class="linenos"> 770</span></a><span class="sd">            The level of verbosity to use.</span>
</span><span id="L-771"><a href="#-771"><span class="linenos"> 771</span></a>
</span><span id="L-772"><a href="#-772"><span class="linenos"> 772</span></a><span class="sd">        Returns</span>
</span><span id="L-773"><a href="#-773"><span class="linenos"> 773</span></a><span class="sd">        -------</span>
</span><span id="L-774"><a href="#-774"><span class="linenos"> 774</span></a><span class="sd">        dis_class : np.ndarray</span>
</span><span id="L-775"><a href="#-775"><span class="linenos"> 775</span></a><span class="sd">            Array of fault displacement classifications</span>
</span><span id="L-776"><a href="#-776"><span class="linenos"> 776</span></a><span class="sd">        hockey_sticks : list</span>
</span><span id="L-777"><a href="#-777"><span class="linenos"> 777</span></a><span class="sd">            List of hockey sticks</span>
</span><span id="L-778"><a href="#-778"><span class="linenos"> 778</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-779"><a href="#-779"><span class="linenos"> 779</span></a>        <span class="k">def</span> <span class="nf">apply_faulting</span><span class="p">(</span><span class="n">traces</span><span class="p">,</span> <span class="n">stretch_times</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="L-780"><a href="#-780"><span class="linenos"> 780</span></a>            <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-781"><a href="#-781"><span class="linenos"> 781</span></a><span class="sd">            Apply Faulting</span>
</span><span id="L-782"><a href="#-782"><span class="linenos"> 782</span></a><span class="sd">            --------------</span>
</span><span id="L-783"><a href="#-783"><span class="linenos"> 783</span></a><span class="sd">            Applies faulting to the traces.</span>
</span><span id="L-784"><a href="#-784"><span class="linenos"> 784</span></a>
</span><span id="L-785"><a href="#-785"><span class="linenos"> 785</span></a><span class="sd">            The method does the following:</span>
</span><span id="L-786"><a href="#-786"><span class="linenos"> 786</span></a>
</span><span id="L-787"><a href="#-787"><span class="linenos"> 787</span></a><span class="sd">            Apply stretching and squeezing previously applied to the input cube</span>
</span><span id="L-788"><a href="#-788"><span class="linenos"> 788</span></a><span class="sd">            vertically to give all depths the same number of extrema.</span>
</span><span id="L-789"><a href="#-789"><span class="linenos"> 789</span></a><span class="sd">            This is intended to be a proxy for making the</span>
</span><span id="L-790"><a href="#-790"><span class="linenos"> 790</span></a><span class="sd">            dominant frequency the same everywhere.</span>
</span><span id="L-791"><a href="#-791"><span class="linenos"> 791</span></a><span class="sd">            Variables:</span>
</span><span id="L-792"><a href="#-792"><span class="linenos"> 792</span></a><span class="sd">            - traces - input, previously stretched/squeezed trace(s)</span>
</span><span id="L-793"><a href="#-793"><span class="linenos"> 793</span></a><span class="sd">            - stretch_times - input, LUT for stretching/squeezing trace(s),</span>
</span><span id="L-794"><a href="#-794"><span class="linenos"> 794</span></a><span class="sd">                              range is (0,number samples in last dimension of &#39;traces&#39;)</span>
</span><span id="L-795"><a href="#-795"><span class="linenos"> 795</span></a><span class="sd">            - unstretch_traces - output, un-stretched/un-squeezed trace(s)</span>
</span><span id="L-796"><a href="#-796"><span class="linenos"> 796</span></a>
</span><span id="L-797"><a href="#-797"><span class="linenos"> 797</span></a><span class="sd">            Parameters</span>
</span><span id="L-798"><a href="#-798"><span class="linenos"> 798</span></a><span class="sd">            ----------</span>
</span><span id="L-799"><a href="#-799"><span class="linenos"> 799</span></a><span class="sd">            traces : np.ndarray</span>
</span><span id="L-800"><a href="#-800"><span class="linenos"> 800</span></a><span class="sd">                Previously stretched/squeezed trace(s).</span>
</span><span id="L-801"><a href="#-801"><span class="linenos"> 801</span></a><span class="sd">            stretch_times : np.ndarray</span>
</span><span id="L-802"><a href="#-802"><span class="linenos"> 802</span></a><span class="sd">                A look up table for stretching and squeezing the traces.</span>
</span><span id="L-803"><a href="#-803"><span class="linenos"> 803</span></a><span class="sd">            verbose : bool, optional</span>
</span><span id="L-804"><a href="#-804"><span class="linenos"> 804</span></a><span class="sd">                The level of verbosity, by default False</span>
</span><span id="L-805"><a href="#-805"><span class="linenos"> 805</span></a>
</span><span id="L-806"><a href="#-806"><span class="linenos"> 806</span></a><span class="sd">            Returns</span>
</span><span id="L-807"><a href="#-807"><span class="linenos"> 807</span></a><span class="sd">            -------</span>
</span><span id="L-808"><a href="#-808"><span class="linenos"> 808</span></a><span class="sd">            np.ndarray</span>
</span><span id="L-809"><a href="#-809"><span class="linenos"> 809</span></a><span class="sd">                The un-stretched/un-squeezed trace(s).</span>
</span><span id="L-810"><a href="#-810"><span class="linenos"> 810</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="L-811"><a href="#-811"><span class="linenos"> 811</span></a>            <span class="n">unstretch_traces</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">traces</span><span class="p">)</span>
</span><span id="L-812"><a href="#-812"><span class="linenos"> 812</span></a>            <span class="n">origtime</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">traces</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</span><span id="L-813"><a href="#-813"><span class="linenos"> 813</span></a>
</span><span id="L-814"><a href="#-814"><span class="linenos"> 814</span></a>            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="L-815"><a href="#-815"><span class="linenos"> 815</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">   ... Cube parameters going into interpolation&quot;</span><span class="p">)</span>
</span><span id="L-816"><a href="#-816"><span class="linenos"> 816</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">   ... Origtime shape  = </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">origtime</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-817"><a href="#-817"><span class="linenos"> 817</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">   ... stretch_times_effects shape  = </span><span class="si">{</span><span class="n">stretch_times</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-818"><a href="#-818"><span class="linenos"> 818</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">   ... unstretch_times shape  = </span><span class="si">{</span><span class="n">unstretch_traces</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-819"><a href="#-819"><span class="linenos"> 819</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">   ... traces shape  = </span><span class="si">{</span><span class="n">traces</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-820"><a href="#-820"><span class="linenos"> 820</span></a>
</span><span id="L-821"><a href="#-821"><span class="linenos"> 821</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">traces</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="L-822"><a href="#-822"><span class="linenos"> 822</span></a>                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">traces</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
</span><span id="L-823"><a href="#-823"><span class="linenos"> 823</span></a>                    <span class="k">if</span> <span class="n">traces</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">!=</span> <span class="n">traces</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">max</span><span class="p">():</span>
</span><span id="L-824"><a href="#-824"><span class="linenos"> 824</span></a>                        <span class="n">unstretch_traces</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span>
</span><span id="L-825"><a href="#-825"><span class="linenos"> 825</span></a>                            <span class="n">stretch_times</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="p">:],</span> <span class="n">origtime</span><span class="p">,</span> <span class="n">traces</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="p">:]</span>
</span><span id="L-826"><a href="#-826"><span class="linenos"> 826</span></a>                        <span class="p">)</span>
</span><span id="L-827"><a href="#-827"><span class="linenos"> 827</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="L-828"><a href="#-828"><span class="linenos"> 828</span></a>                        <span class="n">unstretch_traces</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">traces</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="p">:]</span>
</span><span id="L-829"><a href="#-829"><span class="linenos"> 829</span></a>            <span class="k">return</span> <span class="n">unstretch_traces</span>
</span><span id="L-830"><a href="#-830"><span class="linenos"> 830</span></a>
</span><span id="L-831"><a href="#-831"><span class="linenos"> 831</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2"> . starting &#39;build_faults&#39;.&quot;</span><span class="p">)</span>
</span><span id="L-832"><a href="#-832"><span class="linenos"> 832</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   ... self.cfg.verbose = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">))</span>
</span><span id="L-833"><a href="#-833"><span class="linenos"> 833</span></a>        <span class="n">cube_shape</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">)</span>
</span><span id="L-834"><a href="#-834"><span class="linenos"> 834</span></a>        <span class="n">cube_shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">pad_samples</span>
</span><span id="L-835"><a href="#-835"><span class="linenos"> 835</span></a>        <span class="n">samples_in_cube</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">geologic_age</span><span class="p">[:]</span><span class="o">.</span><span class="n">size</span>
</span><span id="L-836"><a href="#-836"><span class="linenos"> 836</span></a>        <span class="n">wb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy_and_divide_depth_maps_by_infill</span><span class="p">(</span>
</span><span id="L-837"><a href="#-837"><span class="linenos"> 837</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">unfaulted_depth_maps</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
</span><span id="L-838"><a href="#-838"><span class="linenos"> 838</span></a>        <span class="p">)</span>
</span><span id="L-839"><a href="#-839"><span class="linenos"> 839</span></a>
</span><span id="L-840"><a href="#-840"><span class="linenos"> 840</span></a>        <span class="n">sum_displacements</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">geologic_age</span><span class="p">[:])</span>
</span><span id="L-841"><a href="#-841"><span class="linenos"> 841</span></a>        <span class="n">displacements_class</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">geologic_age</span><span class="p">[:])</span>
</span><span id="L-842"><a href="#-842"><span class="linenos"> 842</span></a>        <span class="n">hockey_sticks</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-843"><a href="#-843"><span class="linenos"> 843</span></a>        <span class="n">fault_voxel_count_list</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-844"><a href="#-844"><span class="linenos"> 844</span></a>        <span class="n">number_fault_intersections</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-845"><a href="#-845"><span class="linenos"> 845</span></a>
</span><span id="L-846"><a href="#-846"><span class="linenos"> 846</span></a>        <span class="n">depth_maps_faulted_infilled</span> <span class="o">=</span> \
</span><span id="L-847"><a href="#-847"><span class="linenos"> 847</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">copy_and_divide_depth_maps_by_infill</span><span class="p">(</span>
</span><span id="L-848"><a href="#-848"><span class="linenos"> 848</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">unfaulted_depth_maps</span><span class="p">[:]</span>
</span><span id="L-849"><a href="#-849"><span class="linenos"> 849</span></a>            <span class="p">)</span>
</span><span id="L-850"><a href="#-850"><span class="linenos"> 850</span></a>        <span class="n">depth_maps_gaps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy_and_divide_depth_maps_by_infill</span><span class="p">(</span>
</span><span id="L-851"><a href="#-851"><span class="linenos"> 851</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">unfaulted_depth_maps</span><span class="p">[:]</span>
</span><span id="L-852"><a href="#-852"><span class="linenos"> 852</span></a>        <span class="p">)</span>
</span><span id="L-853"><a href="#-853"><span class="linenos"> 853</span></a>
</span><span id="L-854"><a href="#-854"><span class="linenos"> 854</span></a>        <span class="c1"># Create depth indices cube (moved from inside loop)</span>
</span><span id="L-855"><a href="#-855"><span class="linenos"> 855</span></a>        <span class="n">faulted_depths</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">geologic_age</span><span class="p">[:])</span>
</span><span id="L-856"><a href="#-856"><span class="linenos"> 856</span></a>        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">faulted_depths</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
</span><span id="L-857"><a href="#-857"><span class="linenos"> 857</span></a>            <span class="n">faulted_depths</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">k</span>
</span><span id="L-858"><a href="#-858"><span class="linenos"> 858</span></a>        <span class="n">unfaulted_depths</span> <span class="o">=</span> <span class="n">faulted_depths</span> <span class="o">*</span> <span class="mf">1.0</span>
</span><span id="L-859"><a href="#-859"><span class="linenos"> 859</span></a>        <span class="n">_faulted_depths</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-860"><a href="#-860"><span class="linenos"> 860</span></a>            <span class="n">unfaulted_depths</span> <span class="o">*</span> <span class="mf">1.0</span>
</span><span id="L-861"><a href="#-861"><span class="linenos"> 861</span></a>        <span class="p">)</span>  <span class="c1"># in case there are 0 faults, prepare _faulted_depths here</span>
</span><span id="L-862"><a href="#-862"><span class="linenos"> 862</span></a>
</span><span id="L-863"><a href="#-863"><span class="linenos"> 863</span></a>        <span class="k">for</span> <span class="n">ifault</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">number_faults</span><span class="p">)):</span>
</span><span id="L-864"><a href="#-864"><span class="linenos"> 864</span></a>            <span class="n">semi_axes</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-865"><a href="#-865"><span class="linenos"> 865</span></a>                <span class="n">fp</span><span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">][</span><span class="n">ifault</span><span class="p">],</span>
</span><span id="L-866"><a href="#-866"><span class="linenos"> 866</span></a>                <span class="n">fp</span><span class="p">[</span><span class="s2">&quot;b&quot;</span><span class="p">][</span><span class="n">ifault</span><span class="p">],</span>
</span><span id="L-867"><a href="#-867"><span class="linenos"> 867</span></a>                <span class="n">fp</span><span class="p">[</span><span class="s2">&quot;c&quot;</span><span class="p">][</span><span class="n">ifault</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">infill_factor</span> <span class="o">**</span> <span class="mi">2</span><span class="p">,</span>
</span><span id="L-868"><a href="#-868"><span class="linenos"> 868</span></a>            <span class="p">]</span>
</span><span id="L-869"><a href="#-869"><span class="linenos"> 869</span></a>            <span class="n">origin</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-870"><a href="#-870"><span class="linenos"> 870</span></a>                <span class="n">fp</span><span class="p">[</span><span class="s2">&quot;x0&quot;</span><span class="p">][</span><span class="n">ifault</span><span class="p">],</span>
</span><span id="L-871"><a href="#-871"><span class="linenos"> 871</span></a>                <span class="n">fp</span><span class="p">[</span><span class="s2">&quot;y0&quot;</span><span class="p">][</span><span class="n">ifault</span><span class="p">],</span>
</span><span id="L-872"><a href="#-872"><span class="linenos"> 872</span></a>                <span class="n">fp</span><span class="p">[</span><span class="s2">&quot;z0&quot;</span><span class="p">][</span><span class="n">ifault</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">infill_factor</span><span class="p">,</span>
</span><span id="L-873"><a href="#-873"><span class="linenos"> 873</span></a>            <span class="p">]</span>
</span><span id="L-874"><a href="#-874"><span class="linenos"> 874</span></a>            <span class="n">throw</span> <span class="o">=</span> <span class="n">fp</span><span class="p">[</span><span class="s2">&quot;throw&quot;</span><span class="p">][</span><span class="n">ifault</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">infill_factor</span>
</span><span id="L-875"><a href="#-875"><span class="linenos"> 875</span></a>            <span class="n">tilt</span> <span class="o">=</span> <span class="n">fp</span><span class="p">[</span><span class="s2">&quot;tilt_pct&quot;</span><span class="p">][</span><span class="n">ifault</span><span class="p">]</span>
</span><span id="L-876"><a href="#-876"><span class="linenos"> 876</span></a>
</span><span id="L-877"><a href="#-877"><span class="linenos"> 877</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2"> ... inserting fault </span><span class="si">{</span><span class="n">ifault</span><span class="si">}</span><span class="s2"> with throw </span><span class="si">{</span><span class="n">throw</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-878"><a href="#-878"><span class="linenos"> 878</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="L-879"><a href="#-879"><span class="linenos"> 879</span></a>                <span class="sa">f</span><span class="s2">&quot;   ... fault ellipsoid semi-axes (a, b, c): </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">semi_axes</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, &quot;</span>
</span><span id="L-880"><a href="#-880"><span class="linenos"> 880</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">semi_axes</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">semi_axes</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-881"><a href="#-881"><span class="linenos"> 881</span></a>            <span class="p">)</span>
</span><span id="L-882"><a href="#-882"><span class="linenos"> 882</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="L-883"><a href="#-883"><span class="linenos"> 883</span></a>                <span class="sa">f</span><span class="s2">&quot;   ... fault ellipsoid origin (x, y, z): </span><span class="si">{</span><span class="n">origin</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">origin</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">origin</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-884"><a href="#-884"><span class="linenos"> 884</span></a>            <span class="p">)</span>
</span><span id="L-885"><a href="#-885"><span class="linenos"> 885</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   ... tilt_pct: </span><span class="si">{</span><span class="n">tilt</span> <span class="o">*</span> <span class="mi">100</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-886"><a href="#-886"><span class="linenos"> 886</span></a>            <span class="n">z_base</span> <span class="o">=</span> <span class="n">origin</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">semi_axes</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</span><span id="L-887"><a href="#-887"><span class="linenos"> 887</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="L-888"><a href="#-888"><span class="linenos"> 888</span></a>                <span class="sa">f</span><span class="s2">&quot;   ...z for bottom of ellipsoid at depth (samples) = </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">z_base</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-889"><a href="#-889"><span class="linenos"> 889</span></a>            <span class="p">)</span>
</span><span id="L-890"><a href="#-890"><span class="linenos"> 890</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   ...shape of output_cube = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">geologic_age</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-891"><a href="#-891"><span class="linenos"> 891</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="L-892"><a href="#-892"><span class="linenos"> 892</span></a>                <span class="sa">f</span><span class="s2">&quot;   ...infill_factor, pad_samples = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">infill_factor</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">pad_samples</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-893"><a href="#-893"><span class="linenos"> 893</span></a>            <span class="p">)</span>
</span><span id="L-894"><a href="#-894"><span class="linenos"> 894</span></a>
</span><span id="L-895"><a href="#-895"><span class="linenos"> 895</span></a>            <span class="c1"># add empty arrays for shear_zone_width and gouge_pctile to fault params dictionary</span>
</span><span id="L-896"><a href="#-896"><span class="linenos"> 896</span></a>            <span class="n">fp</span><span class="p">[</span><span class="s2">&quot;shear_zone_width&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">number_faults</span><span class="p">)</span>
</span><span id="L-897"><a href="#-897"><span class="linenos"> 897</span></a>            <span class="n">fp</span><span class="p">[</span><span class="s2">&quot;gouge_pctile&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">number_faults</span><span class="p">)</span>
</span><span id="L-898"><a href="#-898"><span class="linenos"> 898</span></a>            <span class="p">(</span>
</span><span id="L-899"><a href="#-899"><span class="linenos"> 899</span></a>                <span class="n">displacement</span><span class="p">,</span>
</span><span id="L-900"><a href="#-900"><span class="linenos"> 900</span></a>                <span class="n">displacement_classification</span><span class="p">,</span>
</span><span id="L-901"><a href="#-901"><span class="linenos"> 901</span></a>                <span class="n">interpolation</span><span class="p">,</span>
</span><span id="L-902"><a href="#-902"><span class="linenos"> 902</span></a>                <span class="n">hockey_stick</span><span class="p">,</span>
</span><span id="L-903"><a href="#-903"><span class="linenos"> 903</span></a>                <span class="n">fault_segm</span><span class="p">,</span>
</span><span id="L-904"><a href="#-904"><span class="linenos"> 904</span></a>                <span class="n">ellipsoid</span><span class="p">,</span>
</span><span id="L-905"><a href="#-905"><span class="linenos"> 905</span></a>                <span class="n">fp</span><span class="p">,</span>
</span><span id="L-906"><a href="#-906"><span class="linenos"> 906</span></a>            <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_displacement_vector</span><span class="p">(</span>
</span><span id="L-907"><a href="#-907"><span class="linenos"> 907</span></a>                <span class="n">semi_axes</span><span class="p">,</span> <span class="n">origin</span><span class="p">,</span> <span class="n">throw</span><span class="p">,</span> <span class="n">tilt</span><span class="p">,</span> <span class="n">wb</span><span class="p">,</span> <span class="n">ifault</span><span class="p">,</span> <span class="n">fp</span>
</span><span id="L-908"><a href="#-908"><span class="linenos"> 908</span></a>            <span class="p">)</span>
</span><span id="L-909"><a href="#-909"><span class="linenos"> 909</span></a>
</span><span id="L-910"><a href="#-910"><span class="linenos"> 910</span></a>            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="L-911"><a href="#-911"><span class="linenos"> 911</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;     ... hockey_stick = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">hockey_stick</span><span class="p">))</span>
</span><span id="L-912"><a href="#-912"><span class="linenos"> 912</span></a>                <span class="nb">print</span><span class="p">(</span>
</span><span id="L-913"><a href="#-913"><span class="linenos"> 913</span></a>                    <span class="s2">&quot;     ... Is displacement the same as displacement_classification? &quot;</span>
</span><span id="L-914"><a href="#-914"><span class="linenos"> 914</span></a>                    <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">displacement</span> <span class="o">==</span> <span class="n">displacement_classification</span><span class="p">))</span>
</span><span id="L-915"><a href="#-915"><span class="linenos"> 915</span></a>                <span class="p">)</span>
</span><span id="L-916"><a href="#-916"><span class="linenos"> 916</span></a>                <span class="nb">print</span><span class="p">(</span>
</span><span id="L-917"><a href="#-917"><span class="linenos"> 917</span></a>                    <span class="s2">&quot;     ... Sample count where displacement differs from displacement_classification? &quot;</span>
</span><span id="L-918"><a href="#-918"><span class="linenos"> 918</span></a>                    <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="L-919"><a href="#-919"><span class="linenos"> 919</span></a>                        <span class="n">displacement</span><span class="p">[</span><span class="n">displacement</span> <span class="o">!=</span> <span class="n">displacement_classification</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="L-920"><a href="#-920"><span class="linenos"> 920</span></a>                    <span class="p">)</span>
</span><span id="L-921"><a href="#-921"><span class="linenos"> 921</span></a>                <span class="p">)</span>
</span><span id="L-922"><a href="#-922"><span class="linenos"> 922</span></a>                <span class="nb">print</span><span class="p">(</span>
</span><span id="L-923"><a href="#-923"><span class="linenos"> 923</span></a>                    <span class="s2">&quot;     ... percent of samples where displacement differs from displacement_classification = &quot;</span>
</span><span id="L-924"><a href="#-924"><span class="linenos"> 924</span></a>                    <span class="o">+</span> <span class="nb">format</span><span class="p">(</span>
</span><span id="L-925"><a href="#-925"><span class="linenos"> 925</span></a>                        <span class="nb">float</span><span class="p">(</span>
</span><span id="L-926"><a href="#-926"><span class="linenos"> 926</span></a>                            <span class="n">displacement</span><span class="p">[</span>
</span><span id="L-927"><a href="#-927"><span class="linenos"> 927</span></a>                                <span class="n">displacement</span> <span class="o">!=</span> <span class="n">displacement_classification</span>
</span><span id="L-928"><a href="#-928"><span class="linenos"> 928</span></a>                            <span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="L-929"><a href="#-929"><span class="linenos"> 929</span></a>                        <span class="p">)</span>
</span><span id="L-930"><a href="#-930"><span class="linenos"> 930</span></a>                        <span class="o">/</span> <span class="n">samples_in_cube</span><span class="p">,</span>
</span><span id="L-931"><a href="#-931"><span class="linenos"> 931</span></a>                        <span class="s2">&quot;5.1%&quot;</span><span class="p">,</span>
</span><span id="L-932"><a href="#-932"><span class="linenos"> 932</span></a>                    <span class="p">)</span>
</span><span id="L-933"><a href="#-933"><span class="linenos"> 933</span></a>                <span class="p">)</span>
</span><span id="L-934"><a href="#-934"><span class="linenos"> 934</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="L-935"><a href="#-935"><span class="linenos"> 935</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="L-936"><a href="#-936"><span class="linenos"> 936</span></a>                        <span class="s2">&quot;     ... (displacement differs from displacement_classification).mean() &quot;</span>
</span><span id="L-937"><a href="#-937"><span class="linenos"> 937</span></a>                        <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="L-938"><a href="#-938"><span class="linenos"> 938</span></a>                            <span class="n">displacement</span><span class="p">[</span>
</span><span id="L-939"><a href="#-939"><span class="linenos"> 939</span></a>                                <span class="n">displacement</span> <span class="o">!=</span> <span class="n">displacement_classification</span>
</span><span id="L-940"><a href="#-940"><span class="linenos"> 940</span></a>                            <span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</span><span id="L-941"><a href="#-941"><span class="linenos"> 941</span></a>                        <span class="p">)</span>
</span><span id="L-942"><a href="#-942"><span class="linenos"> 942</span></a>                    <span class="p">)</span>
</span><span id="L-943"><a href="#-943"><span class="linenos"> 943</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="L-944"><a href="#-944"><span class="linenos"> 944</span></a>                        <span class="s2">&quot;     ... (displacement differs from displacement_classification).max() &quot;</span>
</span><span id="L-945"><a href="#-945"><span class="linenos"> 945</span></a>                        <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="L-946"><a href="#-946"><span class="linenos"> 946</span></a>                            <span class="n">displacement</span><span class="p">[</span>
</span><span id="L-947"><a href="#-947"><span class="linenos"> 947</span></a>                                <span class="n">displacement</span> <span class="o">!=</span> <span class="n">displacement_classification</span>
</span><span id="L-948"><a href="#-948"><span class="linenos"> 948</span></a>                            <span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</span><span id="L-949"><a href="#-949"><span class="linenos"> 949</span></a>                        <span class="p">)</span>
</span><span id="L-950"><a href="#-950"><span class="linenos"> 950</span></a>                    <span class="p">)</span>
</span><span id="L-951"><a href="#-951"><span class="linenos"> 951</span></a>                <span class="k">except</span><span class="p">:</span>
</span><span id="L-952"><a href="#-952"><span class="linenos"> 952</span></a>                    <span class="k">pass</span>
</span><span id="L-953"><a href="#-953"><span class="linenos"> 953</span></a>
</span><span id="L-954"><a href="#-954"><span class="linenos"> 954</span></a>                <span class="nb">print</span><span class="p">(</span>
</span><span id="L-955"><a href="#-955"><span class="linenos"> 955</span></a>                    <span class="s2">&quot;   ...displacement_classification.min() = &quot;</span>
</span><span id="L-956"><a href="#-956"><span class="linenos"> 956</span></a>                    <span class="o">+</span> <span class="s2">&quot;, &quot;</span>
</span><span id="L-957"><a href="#-957"><span class="linenos"> 957</span></a>                    <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">displacement_classification</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
</span><span id="L-958"><a href="#-958"><span class="linenos"> 958</span></a>                <span class="p">)</span>
</span><span id="L-959"><a href="#-959"><span class="linenos"> 959</span></a>                <span class="nb">print</span><span class="p">(</span>
</span><span id="L-960"><a href="#-960"><span class="linenos"> 960</span></a>                    <span class="s2">&quot;   ...displacement_classification.mean() = &quot;</span>
</span><span id="L-961"><a href="#-961"><span class="linenos"> 961</span></a>                    <span class="o">+</span> <span class="s2">&quot;, &quot;</span>
</span><span id="L-962"><a href="#-962"><span class="linenos"> 962</span></a>                    <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">displacement_classification</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
</span><span id="L-963"><a href="#-963"><span class="linenos"> 963</span></a>                <span class="p">)</span>
</span><span id="L-964"><a href="#-964"><span class="linenos"> 964</span></a>                <span class="nb">print</span><span class="p">(</span>
</span><span id="L-965"><a href="#-965"><span class="linenos"> 965</span></a>                    <span class="s2">&quot;   ...displacement_classification.max() = &quot;</span>
</span><span id="L-966"><a href="#-966"><span class="linenos"> 966</span></a>                    <span class="o">+</span> <span class="s2">&quot;, &quot;</span>
</span><span id="L-967"><a href="#-967"><span class="linenos"> 967</span></a>                    <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">displacement_classification</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
</span><span id="L-968"><a href="#-968"><span class="linenos"> 968</span></a>                <span class="p">)</span>
</span><span id="L-969"><a href="#-969"><span class="linenos"> 969</span></a>
</span><span id="L-970"><a href="#-970"><span class="linenos"> 970</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   ...displacement.min() = &quot;</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">displacement</span><span class="o">.</span><span class="n">min</span><span class="p">()))</span>
</span><span id="L-971"><a href="#-971"><span class="linenos"> 971</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   ...displacement.mean() = &quot;</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">displacement</span><span class="o">.</span><span class="n">mean</span><span class="p">()))</span>
</span><span id="L-972"><a href="#-972"><span class="linenos"> 972</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   ...displacement.max() = &quot;</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">displacement</span><span class="o">.</span><span class="n">max</span><span class="p">()))</span>
</span><span id="L-973"><a href="#-973"><span class="linenos"> 973</span></a>                <span class="k">if</span> <span class="n">fault_segm</span><span class="p">[</span><span class="n">fault_segm</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-974"><a href="#-974"><span class="linenos"> 974</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="L-975"><a href="#-975"><span class="linenos"> 975</span></a>                        <span class="s2">&quot;   ...displacement[fault_segm &gt;0].min() = &quot;</span>
</span><span id="L-976"><a href="#-976"><span class="linenos"> 976</span></a>                        <span class="o">+</span> <span class="s2">&quot;, &quot;</span>
</span><span id="L-977"><a href="#-977"><span class="linenos"> 977</span></a>                        <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">displacement</span><span class="p">[</span><span class="n">fault_segm</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
</span><span id="L-978"><a href="#-978"><span class="linenos"> 978</span></a>                    <span class="p">)</span>
</span><span id="L-979"><a href="#-979"><span class="linenos"> 979</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="L-980"><a href="#-980"><span class="linenos"> 980</span></a>                        <span class="s2">&quot;   ...displacement[fault_segm &gt;0] P10 = &quot;</span>
</span><span id="L-981"><a href="#-981"><span class="linenos"> 981</span></a>                        <span class="o">+</span> <span class="s2">&quot;, &quot;</span>
</span><span id="L-982"><a href="#-982"><span class="linenos"> 982</span></a>                        <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">displacement</span><span class="p">[</span><span class="n">fault_segm</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">],</span> <span class="mi">10</span><span class="p">))</span>
</span><span id="L-983"><a href="#-983"><span class="linenos"> 983</span></a>                    <span class="p">)</span>
</span><span id="L-984"><a href="#-984"><span class="linenos"> 984</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="L-985"><a href="#-985"><span class="linenos"> 985</span></a>                        <span class="s2">&quot;   ...displacement[fault_segm &gt;0] P25 = &quot;</span>
</span><span id="L-986"><a href="#-986"><span class="linenos"> 986</span></a>                        <span class="o">+</span> <span class="s2">&quot;, &quot;</span>
</span><span id="L-987"><a href="#-987"><span class="linenos"> 987</span></a>                        <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">displacement</span><span class="p">[</span><span class="n">fault_segm</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">],</span> <span class="mi">25</span><span class="p">))</span>
</span><span id="L-988"><a href="#-988"><span class="linenos"> 988</span></a>                    <span class="p">)</span>
</span><span id="L-989"><a href="#-989"><span class="linenos"> 989</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="L-990"><a href="#-990"><span class="linenos"> 990</span></a>                        <span class="s2">&quot;   ...displacement[fault_segm &gt;0].mean() = &quot;</span>
</span><span id="L-991"><a href="#-991"><span class="linenos"> 991</span></a>                        <span class="o">+</span> <span class="s2">&quot;, &quot;</span>
</span><span id="L-992"><a href="#-992"><span class="linenos"> 992</span></a>                        <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">displacement</span><span class="p">[</span><span class="n">fault_segm</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
</span><span id="L-993"><a href="#-993"><span class="linenos"> 993</span></a>                    <span class="p">)</span>
</span><span id="L-994"><a href="#-994"><span class="linenos"> 994</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="L-995"><a href="#-995"><span class="linenos"> 995</span></a>                        <span class="s2">&quot;   ...displacement[fault_segm &gt;0] P75 = &quot;</span>
</span><span id="L-996"><a href="#-996"><span class="linenos"> 996</span></a>                        <span class="o">+</span> <span class="s2">&quot;, &quot;</span>
</span><span id="L-997"><a href="#-997"><span class="linenos"> 997</span></a>                        <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">displacement</span><span class="p">[</span><span class="n">fault_segm</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">],</span> <span class="mi">75</span><span class="p">))</span>
</span><span id="L-998"><a href="#-998"><span class="linenos"> 998</span></a>                    <span class="p">)</span>
</span><span id="L-999"><a href="#-999"><span class="linenos"> 999</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="L-1000"><a href="#-1000"><span class="linenos">1000</span></a>                        <span class="s2">&quot;   ...displacement[fault_segm &gt;0] P90 = &quot;</span>
</span><span id="L-1001"><a href="#-1001"><span class="linenos">1001</span></a>                        <span class="o">+</span> <span class="s2">&quot;, &quot;</span>
</span><span id="L-1002"><a href="#-1002"><span class="linenos">1002</span></a>                        <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">displacement</span><span class="p">[</span><span class="n">fault_segm</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">],</span> <span class="mi">90</span><span class="p">))</span>
</span><span id="L-1003"><a href="#-1003"><span class="linenos">1003</span></a>                    <span class="p">)</span>
</span><span id="L-1004"><a href="#-1004"><span class="linenos">1004</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="L-1005"><a href="#-1005"><span class="linenos">1005</span></a>                        <span class="s2">&quot;   ...displacement[fault_segm &gt;0].max() = &quot;</span>
</span><span id="L-1006"><a href="#-1006"><span class="linenos">1006</span></a>                        <span class="o">+</span> <span class="s2">&quot;, &quot;</span>
</span><span id="L-1007"><a href="#-1007"><span class="linenos">1007</span></a>                        <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">displacement</span><span class="p">[</span><span class="n">fault_segm</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
</span><span id="L-1008"><a href="#-1008"><span class="linenos">1008</span></a>                    <span class="p">)</span>
</span><span id="L-1009"><a href="#-1009"><span class="linenos">1009</span></a>
</span><span id="L-1010"><a href="#-1010"><span class="linenos">1010</span></a>            <span class="n">inline</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">//</span> <span class="mi">2</span>
</span><span id="L-1011"><a href="#-1011"><span class="linenos">1011</span></a>
</span><span id="L-1012"><a href="#-1012"><span class="linenos">1012</span></a>            <span class="c1"># limit labels to portions of fault plane with throw above threshold</span>
</span><span id="L-1013"><a href="#-1013"><span class="linenos">1013</span></a>            <span class="n">throw_threshold_samples</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="L-1014"><a href="#-1014"><span class="linenos">1014</span></a>            <span class="n">footprint</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</span><span id="L-1015"><a href="#-1015"><span class="linenos">1015</span></a>            <span class="n">fp_i</span><span class="p">,</span> <span class="n">fp_j</span><span class="p">,</span> <span class="n">fp_k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
</span><span id="L-1016"><a href="#-1016"><span class="linenos">1016</span></a>                <span class="p">(</span><span class="n">fault_segm</span> <span class="o">&gt;</span> <span class="mf">0.25</span><span class="p">)</span>
</span><span id="L-1017"><a href="#-1017"><span class="linenos">1017</span></a>                <span class="o">&amp;</span> <span class="p">(</span><span class="n">displacement_classification</span> <span class="o">&gt;</span> <span class="n">throw_threshold_samples</span><span class="p">)</span>
</span><span id="L-1018"><a href="#-1018"><span class="linenos">1018</span></a>            <span class="p">)</span>
</span><span id="L-1019"><a href="#-1019"><span class="linenos">1019</span></a>            <span class="n">fault_segm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">fault_segm</span><span class="p">)</span>
</span><span id="L-1020"><a href="#-1020"><span class="linenos">1020</span></a>            <span class="n">fault_plane_displacement</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">fault_segm</span><span class="p">)</span>
</span><span id="L-1021"><a href="#-1021"><span class="linenos">1021</span></a>            <span class="n">fault_segm</span><span class="p">[</span><span class="n">fp_i</span><span class="p">,</span> <span class="n">fp_j</span><span class="p">,</span> <span class="n">fp_k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="L-1022"><a href="#-1022"><span class="linenos">1022</span></a>            <span class="n">fault_plane_displacement</span><span class="p">[</span><span class="n">fp_i</span><span class="p">,</span> <span class="n">fp_j</span><span class="p">,</span> <span class="n">fp_k</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-1023"><a href="#-1023"><span class="linenos">1023</span></a>                <span class="n">displacement_classification</span><span class="p">[</span><span class="n">fp_i</span><span class="p">,</span> <span class="n">fp_j</span><span class="p">,</span> <span class="n">fp_k</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1.0</span>
</span><span id="L-1024"><a href="#-1024"><span class="linenos">1024</span></a>            <span class="p">)</span>
</span><span id="L-1025"><a href="#-1025"><span class="linenos">1025</span></a>
</span><span id="L-1026"><a href="#-1026"><span class="linenos">1026</span></a>            <span class="n">fault_voxel_count_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fault_segm</span><span class="p">[</span><span class="n">fault_segm</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
</span><span id="L-1027"><a href="#-1027"><span class="linenos">1027</span></a>
</span><span id="L-1028"><a href="#-1028"><span class="linenos">1028</span></a>            <span class="c1"># create blended version of displacement that accounts for simulation of fault drag</span>
</span><span id="L-1029"><a href="#-1029"><span class="linenos">1029</span></a>            <span class="n">drag_factor</span> <span class="o">=</span> <span class="mf">0.5</span>
</span><span id="L-1030"><a href="#-1030"><span class="linenos">1030</span></a>            <span class="n">displacement</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-1031"><a href="#-1031"><span class="linenos">1031</span></a>                <span class="mf">1.0</span> <span class="o">-</span> <span class="n">drag_factor</span>
</span><span id="L-1032"><a href="#-1032"><span class="linenos">1032</span></a>            <span class="p">)</span> <span class="o">*</span> <span class="n">displacement</span> <span class="o">+</span> <span class="n">drag_factor</span> <span class="o">*</span> <span class="n">displacement_classification</span>
</span><span id="L-1033"><a href="#-1033"><span class="linenos">1033</span></a>
</span><span id="L-1034"><a href="#-1034"><span class="linenos">1034</span></a>            <span class="c1"># project fault depth on 2D map surface</span>
</span><span id="L-1035"><a href="#-1035"><span class="linenos">1035</span></a>            <span class="n">fault_plane_map</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">wb</span><span class="p">)</span>
</span><span id="L-1036"><a href="#-1036"><span class="linenos">1036</span></a>            <span class="n">depth_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">ellipsoid</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</span><span id="L-1037"><a href="#-1037"><span class="linenos">1037</span></a>            <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">fault_plane_map</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="L-1038"><a href="#-1038"><span class="linenos">1038</span></a>                <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">fault_plane_map</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
</span><span id="L-1039"><a href="#-1039"><span class="linenos">1039</span></a>                    <span class="n">fault_plane_map</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span> <span class="n">jj</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span>
</span><span id="L-1040"><a href="#-1040"><span class="linenos">1040</span></a>                        <span class="mf">1.0</span><span class="p">,</span> <span class="n">ellipsoid</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span> <span class="n">jj</span><span class="p">,</span> <span class="p">:],</span> <span class="n">depth_indices</span>
</span><span id="L-1041"><a href="#-1041"><span class="linenos">1041</span></a>                    <span class="p">)</span>
</span><span id="L-1042"><a href="#-1042"><span class="linenos">1042</span></a>            <span class="n">fault_plane_map</span> <span class="o">=</span> <span class="n">fault_plane_map</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">ellipsoid</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-1043"><a href="#-1043"><span class="linenos">1043</span></a>
</span><span id="L-1044"><a href="#-1044"><span class="linenos">1044</span></a>            <span class="c1"># compute fault azimuth (relative to i,j,k indices, not North)</span>
</span><span id="L-1045"><a href="#-1045"><span class="linenos">1045</span></a>            <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">gradient</span><span class="p">(</span><span class="n">fault_plane_map</span><span class="p">)</span>
</span><span id="L-1046"><a href="#-1046"><span class="linenos">1046</span></a>            <span class="n">strike_angle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">dy</span><span class="p">,</span> <span class="n">dx</span><span class="p">)</span> <span class="o">*</span> <span class="mf">180.0</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>  <span class="c1"># 2D</span>
</span><span id="L-1047"><a href="#-1047"><span class="linenos">1047</span></a>            <span class="k">del</span> <span class="n">dx</span>
</span><span id="L-1048"><a href="#-1048"><span class="linenos">1048</span></a>            <span class="k">del</span> <span class="n">dy</span>
</span><span id="L-1049"><a href="#-1049"><span class="linenos">1049</span></a>            <span class="n">strike_angle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">fault_segm</span><span class="p">)</span> <span class="o">+</span> <span class="n">strike_angle</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span>
</span><span id="L-1050"><a href="#-1050"><span class="linenos">1050</span></a>                <span class="n">fault_plane_map</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">fault_plane_map</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1</span>
</span><span id="L-1051"><a href="#-1051"><span class="linenos">1051</span></a>            <span class="p">)</span>
</span><span id="L-1052"><a href="#-1052"><span class="linenos">1052</span></a>            <span class="n">strike_angle</span><span class="p">[</span><span class="n">fault_segm</span> <span class="o">&lt;</span> <span class="mf">0.5</span><span class="p">]</span> <span class="o">=</span> <span class="mf">200.0</span>
</span><span id="L-1053"><a href="#-1053"><span class="linenos">1053</span></a>
</span><span id="L-1054"><a href="#-1054"><span class="linenos">1054</span></a>            <span class="c1"># - compute faulted depth as max of fault plane or faulted depth</span>
</span><span id="L-1055"><a href="#-1055"><span class="linenos">1055</span></a>            <span class="n">fault_plane</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">displacement</span><span class="p">)</span> <span class="o">+</span> <span class="n">fault_plane_map</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span>
</span><span id="L-1056"><a href="#-1056"><span class="linenos">1056</span></a>                <span class="n">fault_plane_map</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">fault_plane_map</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1</span>
</span><span id="L-1057"><a href="#-1057"><span class="linenos">1057</span></a>            <span class="p">)</span>
</span><span id="L-1058"><a href="#-1058"><span class="linenos">1058</span></a>
</span><span id="L-1059"><a href="#-1059"><span class="linenos">1059</span></a>            <span class="k">if</span> <span class="n">ifault</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-1060"><a href="#-1060"><span class="linenos">1060</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;      .... set _unfaulted_depths to array with all zeros...&quot;</span><span class="p">)</span>
</span><span id="L-1061"><a href="#-1061"><span class="linenos">1061</span></a>                <span class="n">_faulted_depths</span> <span class="o">=</span> <span class="n">unfaulted_depths</span> <span class="o">*</span> <span class="mf">1.0</span>
</span><span id="L-1062"><a href="#-1062"><span class="linenos">1062</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">fault_plane_azimuth</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">strike_angle</span> <span class="o">*</span> <span class="mf">1.0</span>
</span><span id="L-1063"><a href="#-1063"><span class="linenos">1063</span></a>
</span><span id="L-1064"><a href="#-1064"><span class="linenos">1064</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   ... interpolation = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">interpolation</span><span class="p">))</span>
</span><span id="L-1065"><a href="#-1065"><span class="linenos">1065</span></a>
</span><span id="L-1066"><a href="#-1066"><span class="linenos">1066</span></a>            <span class="k">if</span> <span class="p">(</span>
</span><span id="L-1067"><a href="#-1067"><span class="linenos">1067</span></a>                <span class="n">interpolation</span>
</span><span id="L-1068"><a href="#-1068"><span class="linenos">1068</span></a>            <span class="p">):</span>  <span class="c1"># i.e. if the fault should be considered, apply the displacements and append fault plane</span>
</span><span id="L-1069"><a href="#-1069"><span class="linenos">1069</span></a>                <span class="n">faulted_depths2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span>
</span><span id="L-1070"><a href="#-1070"><span class="linenos">1070</span></a>                    <span class="p">(</span><span class="n">ellipsoid</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ellipsoid</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ellipsoid</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">2</span><span class="p">),</span>
</span><span id="L-1071"><a href="#-1071"><span class="linenos">1071</span></a>                    <span class="s2">&quot;float&quot;</span><span class="p">,</span>
</span><span id="L-1072"><a href="#-1072"><span class="linenos">1072</span></a>                <span class="p">)</span>
</span><span id="L-1073"><a href="#-1073"><span class="linenos">1073</span></a>                <span class="n">faulted_depths2</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">displacement</span> <span class="o">*</span> <span class="mf">1.0</span>
</span><span id="L-1074"><a href="#-1074"><span class="linenos">1074</span></a>                <span class="n">faulted_depths2</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">fault_plane</span> <span class="o">-</span> <span class="n">faulted_depths</span>
</span><span id="L-1075"><a href="#-1075"><span class="linenos">1075</span></a>                <span class="n">faulted_depths2</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="mi">1</span><span class="p">][</span><span class="n">ellipsoid</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="L-1076"><a href="#-1076"><span class="linenos">1076</span></a>                <span class="n">map_displacement_vector</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">faulted_depths2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span>
</span><span id="L-1077"><a href="#-1077"><span class="linenos">1077</span></a>                    <span class="mf">0.0</span><span class="p">,</span> <span class="kc">None</span>
</span><span id="L-1078"><a href="#-1078"><span class="linenos">1078</span></a>                <span class="p">)</span>
</span><span id="L-1079"><a href="#-1079"><span class="linenos">1079</span></a>                <span class="k">del</span> <span class="n">faulted_depths2</span>
</span><span id="L-1080"><a href="#-1080"><span class="linenos">1080</span></a>                <span class="n">map_displacement_vector</span><span class="p">[</span><span class="n">ellipsoid</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="L-1081"><a href="#-1081"><span class="linenos">1081</span></a>
</span><span id="L-1082"><a href="#-1082"><span class="linenos">1082</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">sum_map_displacements</span><span class="p">[:]</span> <span class="o">+=</span> <span class="n">map_displacement_vector</span>
</span><span id="L-1083"><a href="#-1083"><span class="linenos">1083</span></a>                <span class="n">displacements_class</span> <span class="o">+=</span> <span class="n">displacement_classification</span>
</span><span id="L-1084"><a href="#-1084"><span class="linenos">1084</span></a>                <span class="c1"># Set displacements outside ellipsoid to 0</span>
</span><span id="L-1085"><a href="#-1085"><span class="linenos">1085</span></a>                <span class="n">displacement</span><span class="p">[</span><span class="n">ellipsoid</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-1086"><a href="#-1086"><span class="linenos">1086</span></a>
</span><span id="L-1087"><a href="#-1087"><span class="linenos">1087</span></a>                <span class="n">sum_displacements</span> <span class="o">+=</span> <span class="n">displacement</span>
</span><span id="L-1088"><a href="#-1088"><span class="linenos">1088</span></a>
</span><span id="L-1089"><a href="#-1089"><span class="linenos">1089</span></a>                <span class="c1"># apply fault to depth_cube</span>
</span><span id="L-1090"><a href="#-1090"><span class="linenos">1090</span></a>                <span class="k">if</span> <span class="n">ifault</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-1091"><a href="#-1091"><span class="linenos">1091</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;      .... set _unfaulted_depths to array with all zeros...&quot;</span><span class="p">)</span>
</span><span id="L-1092"><a href="#-1092"><span class="linenos">1092</span></a>                    <span class="n">_faulted_depths</span> <span class="o">=</span> <span class="n">unfaulted_depths</span> <span class="o">*</span> <span class="mf">1.0</span>
</span><span id="L-1093"><a href="#-1093"><span class="linenos">1093</span></a>                    <span class="n">adjusted_faulted_depths</span> <span class="o">=</span> <span class="p">(</span><span class="n">unfaulted_depths</span> <span class="o">-</span> <span class="n">displacement</span><span class="p">)</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span>
</span><span id="L-1094"><a href="#-1094"><span class="linenos">1094</span></a>                        <span class="mi">0</span><span class="p">,</span> <span class="n">ellipsoid</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>
</span><span id="L-1095"><a href="#-1095"><span class="linenos">1095</span></a>                    <span class="p">)</span>
</span><span id="L-1096"><a href="#-1096"><span class="linenos">1096</span></a>                    <span class="n">_faulted_depths</span> <span class="o">=</span> <span class="n">apply_faulting</span><span class="p">(</span>
</span><span id="L-1097"><a href="#-1097"><span class="linenos">1097</span></a>                        <span class="n">_faulted_depths</span><span class="p">,</span> <span class="n">adjusted_faulted_depths</span>
</span><span id="L-1098"><a href="#-1098"><span class="linenos">1098</span></a>                    <span class="p">)</span>
</span><span id="L-1099"><a href="#-1099"><span class="linenos">1099</span></a>                    <span class="n">_mft</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_fault_throw</span><span class="p">[:]</span>
</span><span id="L-1100"><a href="#-1100"><span class="linenos">1100</span></a>                    <span class="n">_mft</span><span class="p">[</span><span class="n">ellipsoid</span> <span class="o">&lt;=</span> <span class="mf">1.0</span><span class="p">]</span> <span class="o">=</span> <span class="n">throw</span>
</span><span id="L-1101"><a href="#-1101"><span class="linenos">1101</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">max_fault_throw</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">_mft</span>
</span><span id="L-1102"><a href="#-1102"><span class="linenos">1102</span></a>                    <span class="k">del</span> <span class="n">_mft</span>
</span><span id="L-1103"><a href="#-1103"><span class="linenos">1103</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">fault_planes</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">fault_segm</span> <span class="o">*</span> <span class="mf">1.0</span>
</span><span id="L-1104"><a href="#-1104"><span class="linenos">1104</span></a>                    <span class="n">_fault_intersections</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fault_intersections</span><span class="p">[:]</span>
</span><span id="L-1105"><a href="#-1105"><span class="linenos">1105</span></a>                    <span class="n">previous_intersection_voxel_count</span> <span class="o">=</span> <span class="n">_fault_intersections</span><span class="p">[</span>
</span><span id="L-1106"><a href="#-1106"><span class="linenos">1106</span></a>                        <span class="n">_fault_intersections</span> <span class="o">&gt;</span> <span class="mf">1.1</span>
</span><span id="L-1107"><a href="#-1107"><span class="linenos">1107</span></a>                    <span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="L-1108"><a href="#-1108"><span class="linenos">1108</span></a>                    <span class="n">_fault_intersections</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fault_planes</span><span class="p">[:]</span> <span class="o">*</span> <span class="mf">1.0</span>
</span><span id="L-1109"><a href="#-1109"><span class="linenos">1109</span></a>                    <span class="k">if</span> <span class="p">(</span>
</span><span id="L-1110"><a href="#-1110"><span class="linenos">1110</span></a>                        <span class="n">_fault_intersections</span><span class="p">[</span><span class="n">_fault_intersections</span> <span class="o">&gt;</span> <span class="mf">1.1</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="L-1111"><a href="#-1111"><span class="linenos">1111</span></a>                        <span class="o">&gt;</span> <span class="n">previous_intersection_voxel_count</span>
</span><span id="L-1112"><a href="#-1112"><span class="linenos">1112</span></a>                    <span class="p">):</span>
</span><span id="L-1113"><a href="#-1113"><span class="linenos">1113</span></a>                        <span class="n">number_fault_intersections</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-1114"><a href="#-1114"><span class="linenos">1114</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">fault_intersections</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">_fault_intersections</span>
</span><span id="L-1115"><a href="#-1115"><span class="linenos">1115</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">fault_plane_throw</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">fault_plane_displacement</span> <span class="o">*</span> <span class="mf">1.0</span>
</span><span id="L-1116"><a href="#-1116"><span class="linenos">1116</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">fault_plane_azimuth</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">strike_angle</span> <span class="o">*</span> <span class="mf">1.0</span>
</span><span id="L-1117"><a href="#-1117"><span class="linenos">1117</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-1118"><a href="#-1118"><span class="linenos">1118</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="L-1119"><a href="#-1119"><span class="linenos">1119</span></a>                        <span class="s2">&quot;      .... update _unfaulted_depths array using faulted depths...&quot;</span>
</span><span id="L-1120"><a href="#-1120"><span class="linenos">1120</span></a>                    <span class="p">)</span>
</span><span id="L-1121"><a href="#-1121"><span class="linenos">1121</span></a>                    <span class="k">try</span><span class="p">:</span>
</span><span id="L-1122"><a href="#-1122"><span class="linenos">1122</span></a>                        <span class="nb">print</span><span class="p">(</span>
</span><span id="L-1123"><a href="#-1123"><span class="linenos">1123</span></a>                            <span class="s2">&quot;          .... (before) _faulted_depths.mean() = &quot;</span>
</span><span id="L-1124"><a href="#-1124"><span class="linenos">1124</span></a>                            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">_faulted_depths</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
</span><span id="L-1125"><a href="#-1125"><span class="linenos">1125</span></a>                        <span class="p">)</span>
</span><span id="L-1126"><a href="#-1126"><span class="linenos">1126</span></a>                    <span class="k">except</span><span class="p">:</span>
</span><span id="L-1127"><a href="#-1127"><span class="linenos">1127</span></a>                        <span class="n">_faulted_depths</span> <span class="o">=</span> <span class="n">unfaulted_depths</span> <span class="o">*</span> <span class="mf">1.0</span>
</span><span id="L-1128"><a href="#-1128"><span class="linenos">1128</span></a>                    <span class="n">adjusted_faulted_depths</span> <span class="o">=</span> <span class="p">(</span><span class="n">unfaulted_depths</span> <span class="o">-</span> <span class="n">displacement</span><span class="p">)</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span>
</span><span id="L-1129"><a href="#-1129"><span class="linenos">1129</span></a>                        <span class="mi">0</span><span class="p">,</span> <span class="n">ellipsoid</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>
</span><span id="L-1130"><a href="#-1130"><span class="linenos">1130</span></a>                    <span class="p">)</span>
</span><span id="L-1131"><a href="#-1131"><span class="linenos">1131</span></a>                    <span class="n">_faulted_depths</span> <span class="o">=</span> <span class="n">apply_faulting</span><span class="p">(</span>
</span><span id="L-1132"><a href="#-1132"><span class="linenos">1132</span></a>                        <span class="n">_faulted_depths</span><span class="p">,</span> <span class="n">adjusted_faulted_depths</span>
</span><span id="L-1133"><a href="#-1133"><span class="linenos">1133</span></a>                    <span class="p">)</span>
</span><span id="L-1134"><a href="#-1134"><span class="linenos">1134</span></a>
</span><span id="L-1135"><a href="#-1135"><span class="linenos">1135</span></a>                    <span class="n">_fault_planes</span> <span class="o">=</span> <span class="n">apply_faulting</span><span class="p">(</span>
</span><span id="L-1136"><a href="#-1136"><span class="linenos">1136</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">fault_planes</span><span class="p">[:],</span> <span class="n">adjusted_faulted_depths</span>
</span><span id="L-1137"><a href="#-1137"><span class="linenos">1137</span></a>                    <span class="p">)</span>
</span><span id="L-1138"><a href="#-1138"><span class="linenos">1138</span></a>                    <span class="k">if</span> <span class="p">(</span>
</span><span id="L-1139"><a href="#-1139"><span class="linenos">1139</span></a>                        <span class="n">_fault_planes</span><span class="p">[</span>
</span><span id="L-1140"><a href="#-1140"><span class="linenos">1140</span></a>                            <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="mf">0.0</span> <span class="o">&lt;</span> <span class="n">_fault_planes</span><span class="p">,</span> <span class="n">_fault_planes</span> <span class="o">&lt;</span> <span class="mf">0.25</span><span class="p">)</span>
</span><span id="L-1141"><a href="#-1141"><span class="linenos">1141</span></a>                        <span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="L-1142"><a href="#-1142"><span class="linenos">1142</span></a>                        <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="L-1143"><a href="#-1143"><span class="linenos">1143</span></a>                    <span class="p">):</span>
</span><span id="L-1144"><a href="#-1144"><span class="linenos">1144</span></a>                        <span class="n">_fault_planes</span><span class="p">[</span>
</span><span id="L-1145"><a href="#-1145"><span class="linenos">1145</span></a>                            <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="mf">0.0</span> <span class="o">&lt;</span> <span class="n">_fault_planes</span><span class="p">,</span> <span class="n">_fault_planes</span> <span class="o">&lt;</span> <span class="mf">0.25</span><span class="p">)</span>
</span><span id="L-1146"><a href="#-1146"><span class="linenos">1146</span></a>                        <span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="L-1147"><a href="#-1147"><span class="linenos">1147</span></a>                    <span class="k">if</span> <span class="p">(</span>
</span><span id="L-1148"><a href="#-1148"><span class="linenos">1148</span></a>                        <span class="n">_fault_planes</span><span class="p">[</span>
</span><span id="L-1149"><a href="#-1149"><span class="linenos">1149</span></a>                            <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="mf">0.25</span> <span class="o">&lt;</span> <span class="n">_fault_planes</span><span class="p">,</span> <span class="n">_fault_planes</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">)</span>
</span><span id="L-1150"><a href="#-1150"><span class="linenos">1150</span></a>                        <span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="L-1151"><a href="#-1151"><span class="linenos">1151</span></a>                        <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="L-1152"><a href="#-1152"><span class="linenos">1152</span></a>                    <span class="p">):</span>
</span><span id="L-1153"><a href="#-1153"><span class="linenos">1153</span></a>                        <span class="n">_fault_planes</span><span class="p">[</span>
</span><span id="L-1154"><a href="#-1154"><span class="linenos">1154</span></a>                            <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="mf">0.25</span> <span class="o">&lt;</span> <span class="n">_fault_planes</span><span class="p">,</span> <span class="n">_fault_planes</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">)</span>
</span><span id="L-1155"><a href="#-1155"><span class="linenos">1155</span></a>                        <span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="L-1156"><a href="#-1156"><span class="linenos">1156</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">fault_planes</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">_fault_planes</span>
</span><span id="L-1157"><a href="#-1157"><span class="linenos">1157</span></a>                    <span class="k">del</span> <span class="n">_fault_planes</span>
</span><span id="L-1158"><a href="#-1158"><span class="linenos">1158</span></a>
</span><span id="L-1159"><a href="#-1159"><span class="linenos">1159</span></a>                    <span class="n">_fault_intersections</span> <span class="o">=</span> <span class="n">apply_faulting</span><span class="p">(</span>
</span><span id="L-1160"><a href="#-1160"><span class="linenos">1160</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">fault_intersections</span><span class="p">[:],</span> <span class="n">adjusted_faulted_depths</span>
</span><span id="L-1161"><a href="#-1161"><span class="linenos">1161</span></a>                    <span class="p">)</span>
</span><span id="L-1162"><a href="#-1162"><span class="linenos">1162</span></a>                    <span class="k">if</span> <span class="p">(</span>
</span><span id="L-1163"><a href="#-1163"><span class="linenos">1163</span></a>                        <span class="n">_fault_intersections</span><span class="p">[</span>
</span><span id="L-1164"><a href="#-1164"><span class="linenos">1164</span></a>                            <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span>
</span><span id="L-1165"><a href="#-1165"><span class="linenos">1165</span></a>                                <span class="mf">1.25</span> <span class="o">&lt;</span> <span class="n">_fault_intersections</span><span class="p">,</span> <span class="n">_fault_intersections</span> <span class="o">&lt;</span> <span class="mf">2.0</span>
</span><span id="L-1166"><a href="#-1166"><span class="linenos">1166</span></a>                            <span class="p">)</span>
</span><span id="L-1167"><a href="#-1167"><span class="linenos">1167</span></a>                        <span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="L-1168"><a href="#-1168"><span class="linenos">1168</span></a>                        <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="L-1169"><a href="#-1169"><span class="linenos">1169</span></a>                    <span class="p">):</span>
</span><span id="L-1170"><a href="#-1170"><span class="linenos">1170</span></a>                        <span class="n">_fault_intersections</span><span class="p">[</span>
</span><span id="L-1171"><a href="#-1171"><span class="linenos">1171</span></a>                            <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span>
</span><span id="L-1172"><a href="#-1172"><span class="linenos">1172</span></a>                                <span class="mf">1.25</span> <span class="o">&lt;</span> <span class="n">_fault_intersections</span><span class="p">,</span> <span class="n">_fault_intersections</span> <span class="o">&lt;</span> <span class="mf">2.0</span>
</span><span id="L-1173"><a href="#-1173"><span class="linenos">1173</span></a>                            <span class="p">)</span>
</span><span id="L-1174"><a href="#-1174"><span class="linenos">1174</span></a>                        <span class="p">]</span> <span class="o">=</span> <span class="mf">2.0</span>
</span><span id="L-1175"><a href="#-1175"><span class="linenos">1175</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">fault_intersections</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">_fault_intersections</span>
</span><span id="L-1176"><a href="#-1176"><span class="linenos">1176</span></a>                    <span class="k">del</span> <span class="n">_fault_intersections</span>
</span><span id="L-1177"><a href="#-1177"><span class="linenos">1177</span></a>
</span><span id="L-1178"><a href="#-1178"><span class="linenos">1178</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">max_fault_throw</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">apply_faulting</span><span class="p">(</span>
</span><span id="L-1179"><a href="#-1179"><span class="linenos">1179</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">max_fault_throw</span><span class="p">[:],</span> <span class="n">adjusted_faulted_depths</span>
</span><span id="L-1180"><a href="#-1180"><span class="linenos">1180</span></a>                    <span class="p">)</span>
</span><span id="L-1181"><a href="#-1181"><span class="linenos">1181</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">fault_plane_throw</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">apply_faulting</span><span class="p">(</span>
</span><span id="L-1182"><a href="#-1182"><span class="linenos">1182</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">fault_plane_throw</span><span class="p">[:],</span> <span class="n">adjusted_faulted_depths</span>
</span><span id="L-1183"><a href="#-1183"><span class="linenos">1183</span></a>                    <span class="p">)</span>
</span><span id="L-1184"><a href="#-1184"><span class="linenos">1184</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">fault_plane_azimuth</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">apply_faulting</span><span class="p">(</span>
</span><span id="L-1185"><a href="#-1185"><span class="linenos">1185</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">fault_plane_azimuth</span><span class="p">[:],</span> <span class="n">adjusted_faulted_depths</span>
</span><span id="L-1186"><a href="#-1186"><span class="linenos">1186</span></a>                    <span class="p">)</span>
</span><span id="L-1187"><a href="#-1187"><span class="linenos">1187</span></a>
</span><span id="L-1188"><a href="#-1188"><span class="linenos">1188</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">fault_planes</span><span class="p">[:]</span> <span class="o">+=</span> <span class="n">fault_segm</span>
</span><span id="L-1189"><a href="#-1189"><span class="linenos">1189</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">fault_intersections</span><span class="p">[:]</span> <span class="o">+=</span> <span class="n">fault_segm</span>
</span><span id="L-1190"><a href="#-1190"><span class="linenos">1190</span></a>                    <span class="n">_mft</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_fault_throw</span><span class="p">[:]</span>
</span><span id="L-1191"><a href="#-1191"><span class="linenos">1191</span></a>                    <span class="n">_mft</span><span class="p">[</span><span class="n">ellipsoid</span> <span class="o">&lt;=</span> <span class="mf">1.0</span><span class="p">]</span> <span class="o">+=</span> <span class="n">throw</span>
</span><span id="L-1192"><a href="#-1192"><span class="linenos">1192</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">max_fault_throw</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">_mft</span>
</span><span id="L-1193"><a href="#-1193"><span class="linenos">1193</span></a>                    <span class="k">del</span> <span class="n">_mft</span>
</span><span id="L-1194"><a href="#-1194"><span class="linenos">1194</span></a>
</span><span id="L-1195"><a href="#-1195"><span class="linenos">1195</span></a>                    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="L-1196"><a href="#-1196"><span class="linenos">1196</span></a>                        <span class="nb">print</span><span class="p">(</span>
</span><span id="L-1197"><a href="#-1197"><span class="linenos">1197</span></a>                            <span class="s2">&quot;   ... fault_plane_displacement[fault_plane_displacement &gt; 0.].size = &quot;</span>
</span><span id="L-1198"><a href="#-1198"><span class="linenos">1198</span></a>                            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="L-1199"><a href="#-1199"><span class="linenos">1199</span></a>                                <span class="n">fault_plane_displacement</span><span class="p">[</span>
</span><span id="L-1200"><a href="#-1200"><span class="linenos">1200</span></a>                                    <span class="n">fault_plane_displacement</span> <span class="o">&gt;</span> <span class="mf">0.0</span>
</span><span id="L-1201"><a href="#-1201"><span class="linenos">1201</span></a>                                <span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="L-1202"><a href="#-1202"><span class="linenos">1202</span></a>                            <span class="p">)</span>
</span><span id="L-1203"><a href="#-1203"><span class="linenos">1203</span></a>                        <span class="p">)</span>
</span><span id="L-1204"><a href="#-1204"><span class="linenos">1204</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">fault_plane_throw</span><span class="p">[</span>
</span><span id="L-1205"><a href="#-1205"><span class="linenos">1205</span></a>                        <span class="n">fault_plane_displacement</span> <span class="o">&gt;</span> <span class="mf">0.0</span>
</span><span id="L-1206"><a href="#-1206"><span class="linenos">1206</span></a>                    <span class="p">]</span> <span class="o">=</span> <span class="n">fault_plane_displacement</span><span class="p">[</span><span class="n">fault_plane_displacement</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">]</span>
</span><span id="L-1207"><a href="#-1207"><span class="linenos">1207</span></a>                    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="L-1208"><a href="#-1208"><span class="linenos">1208</span></a>                        <span class="nb">print</span><span class="p">(</span>
</span><span id="L-1209"><a href="#-1209"><span class="linenos">1209</span></a>                            <span class="s2">&quot;   ... self.fault_plane_throw[self.fault_plane_throw &gt; 0.].size = &quot;</span>
</span><span id="L-1210"><a href="#-1210"><span class="linenos">1210</span></a>                            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="L-1211"><a href="#-1211"><span class="linenos">1211</span></a>                                <span class="bp">self</span><span class="o">.</span><span class="n">fault_plane_throw</span><span class="p">[</span>
</span><span id="L-1212"><a href="#-1212"><span class="linenos">1212</span></a>                                    <span class="bp">self</span><span class="o">.</span><span class="n">fault_plane_throw</span> <span class="o">&gt;</span> <span class="mf">0.0</span>
</span><span id="L-1213"><a href="#-1213"><span class="linenos">1213</span></a>                                <span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="L-1214"><a href="#-1214"><span class="linenos">1214</span></a>                            <span class="p">)</span>
</span><span id="L-1215"><a href="#-1215"><span class="linenos">1215</span></a>                        <span class="p">)</span>
</span><span id="L-1216"><a href="#-1216"><span class="linenos">1216</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">fault_plane_azimuth</span><span class="p">[</span><span class="n">fault_segm</span> <span class="o">&gt;</span> <span class="mf">0.9</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-1217"><a href="#-1217"><span class="linenos">1217</span></a>                        <span class="n">strike_angle</span><span class="p">[</span><span class="n">fault_segm</span> <span class="o">&gt;</span> <span class="mf">0.9</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1.0</span>
</span><span id="L-1218"><a href="#-1218"><span class="linenos">1218</span></a>                    <span class="p">)</span>
</span><span id="L-1219"><a href="#-1219"><span class="linenos">1219</span></a>
</span><span id="L-1220"><a href="#-1220"><span class="linenos">1220</span></a>                    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="L-1221"><a href="#-1221"><span class="linenos">1221</span></a>                        <span class="nb">print</span><span class="p">(</span>
</span><span id="L-1222"><a href="#-1222"><span class="linenos">1222</span></a>                            <span class="s2">&quot;          .... (after) _faulted_depths.mean() = &quot;</span>
</span><span id="L-1223"><a href="#-1223"><span class="linenos">1223</span></a>                            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">_faulted_depths</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
</span><span id="L-1224"><a href="#-1224"><span class="linenos">1224</span></a>                        <span class="p">)</span>
</span><span id="L-1225"><a href="#-1225"><span class="linenos">1225</span></a>
</span><span id="L-1226"><a href="#-1226"><span class="linenos">1226</span></a>                    <span class="c1"># fix interpolated values in max_fault_throw</span>
</span><span id="L-1227"><a href="#-1227"><span class="linenos">1227</span></a>                    <span class="n">max_fault_throw_list</span><span class="p">,</span> <span class="n">max_fault_throw_list_counts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span>
</span><span id="L-1228"><a href="#-1228"><span class="linenos">1228</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">max_fault_throw</span><span class="p">,</span> <span class="n">return_counts</span><span class="o">=</span><span class="kc">True</span>
</span><span id="L-1229"><a href="#-1229"><span class="linenos">1229</span></a>                    <span class="p">)</span>
</span><span id="L-1230"><a href="#-1230"><span class="linenos">1230</span></a>                    <span class="n">max_fault_throw_list</span> <span class="o">=</span> <span class="n">max_fault_throw_list</span><span class="p">[</span>
</span><span id="L-1231"><a href="#-1231"><span class="linenos">1231</span></a>                        <span class="n">max_fault_throw_list_counts</span> <span class="o">&gt;</span> <span class="mi">500</span>
</span><span id="L-1232"><a href="#-1232"><span class="linenos">1232</span></a>                    <span class="p">]</span>
</span><span id="L-1233"><a href="#-1233"><span class="linenos">1233</span></a>                    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="L-1234"><a href="#-1234"><span class="linenos">1234</span></a>                        <span class="nb">print</span><span class="p">(</span>
</span><span id="L-1235"><a href="#-1235"><span class="linenos">1235</span></a>                            <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">   ...max_fault_throw_list = &quot;</span>
</span><span id="L-1236"><a href="#-1236"><span class="linenos">1236</span></a>                            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">max_fault_throw_list</span><span class="p">)</span>
</span><span id="L-1237"><a href="#-1237"><span class="linenos">1237</span></a>                            <span class="o">+</span> <span class="s2">&quot;, &quot;</span>
</span><span id="L-1238"><a href="#-1238"><span class="linenos">1238</span></a>                            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">max_fault_throw_list_counts</span><span class="p">)</span>
</span><span id="L-1239"><a href="#-1239"><span class="linenos">1239</span></a>                        <span class="p">)</span>
</span><span id="L-1240"><a href="#-1240"><span class="linenos">1240</span></a>                    <span class="n">mfts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_fault_throw</span><span class="o">.</span><span class="n">shape</span>
</span><span id="L-1241"><a href="#-1241"><span class="linenos">1241</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_remove_node_list</span><span class="p">(</span><span class="s2">&quot;max_fault_throw_4d_diff&quot;</span><span class="p">)</span>
</span><span id="L-1242"><a href="#-1242"><span class="linenos">1242</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_remove_node_list</span><span class="p">(</span><span class="s2">&quot;max_fault_throw_4d&quot;</span><span class="p">)</span>
</span><span id="L-1243"><a href="#-1243"><span class="linenos">1243</span></a>                    <span class="n">max_fault_throw_4d_diff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="L-1244"><a href="#-1244"><span class="linenos">1244</span></a>                        <span class="s2">&quot;max_fault_throw_4d_diff&quot;</span><span class="p">,</span>
</span><span id="L-1245"><a href="#-1245"><span class="linenos">1245</span></a>                        <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">mfts</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">mfts</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">mfts</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">max_fault_throw_list</span><span class="o">.</span><span class="n">size</span><span class="p">),</span>
</span><span id="L-1246"><a href="#-1246"><span class="linenos">1246</span></a>                    <span class="p">)</span>
</span><span id="L-1247"><a href="#-1247"><span class="linenos">1247</span></a>                    <span class="n">max_fault_throw_4d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="L-1248"><a href="#-1248"><span class="linenos">1248</span></a>                        <span class="s2">&quot;max_fault_throw_4d&quot;</span><span class="p">,</span>
</span><span id="L-1249"><a href="#-1249"><span class="linenos">1249</span></a>                        <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">mfts</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">mfts</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">mfts</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">max_fault_throw_list</span><span class="o">.</span><span class="n">size</span><span class="p">),</span>
</span><span id="L-1250"><a href="#-1250"><span class="linenos">1250</span></a>                    <span class="p">)</span>
</span><span id="L-1251"><a href="#-1251"><span class="linenos">1251</span></a>                    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="L-1252"><a href="#-1252"><span class="linenos">1252</span></a>                        <span class="nb">print</span><span class="p">(</span>
</span><span id="L-1253"><a href="#-1253"><span class="linenos">1253</span></a>                            <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">   ...max_fault_throw_4d.shape = &quot;</span>
</span><span id="L-1254"><a href="#-1254"><span class="linenos">1254</span></a>                            <span class="o">+</span> <span class="s2">&quot;, &quot;</span>
</span><span id="L-1255"><a href="#-1255"><span class="linenos">1255</span></a>                            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">max_fault_throw_4d</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span><span id="L-1256"><a href="#-1256"><span class="linenos">1256</span></a>                        <span class="p">)</span>
</span><span id="L-1257"><a href="#-1257"><span class="linenos">1257</span></a>                    <span class="n">_max_fault_throw_4d_diff</span> <span class="o">=</span> <span class="n">max_fault_throw_4d_diff</span><span class="p">[:]</span>
</span><span id="L-1258"><a href="#-1258"><span class="linenos">1258</span></a>                    <span class="n">_max_fault_throw_4d</span> <span class="o">=</span> <span class="n">max_fault_throw_4d</span><span class="p">[:]</span>
</span><span id="L-1259"><a href="#-1259"><span class="linenos">1259</span></a>                    <span class="k">for</span> <span class="n">imft</span><span class="p">,</span> <span class="n">mft</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">max_fault_throw_list</span><span class="p">):</span>
</span><span id="L-1260"><a href="#-1260"><span class="linenos">1260</span></a>                        <span class="nb">print</span><span class="p">(</span>
</span><span id="L-1261"><a href="#-1261"><span class="linenos">1261</span></a>                            <span class="s2">&quot;      ... imft, mft, max_fault_throw_4d_diff[:,:,:,imft].shape = &quot;</span>
</span><span id="L-1262"><a href="#-1262"><span class="linenos">1262</span></a>                            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="L-1263"><a href="#-1263"><span class="linenos">1263</span></a>                                <span class="p">(</span>
</span><span id="L-1264"><a href="#-1264"><span class="linenos">1264</span></a>                                    <span class="n">imft</span><span class="p">,</span>
</span><span id="L-1265"><a href="#-1265"><span class="linenos">1265</span></a>                                    <span class="n">mft</span><span class="p">,</span>
</span><span id="L-1266"><a href="#-1266"><span class="linenos">1266</span></a>                                    <span class="n">max_fault_throw_4d_diff</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="n">imft</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
</span><span id="L-1267"><a href="#-1267"><span class="linenos">1267</span></a>                                <span class="p">)</span>
</span><span id="L-1268"><a href="#-1268"><span class="linenos">1268</span></a>                            <span class="p">)</span>
</span><span id="L-1269"><a href="#-1269"><span class="linenos">1269</span></a>                        <span class="p">)</span>
</span><span id="L-1270"><a href="#-1270"><span class="linenos">1270</span></a>                        <span class="n">_max_fault_throw_4d_diff</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="n">imft</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span>
</span><span id="L-1271"><a href="#-1271"><span class="linenos">1271</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">max_fault_throw</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">-</span> <span class="n">mft</span>
</span><span id="L-1272"><a href="#-1272"><span class="linenos">1272</span></a>                        <span class="p">)</span>
</span><span id="L-1273"><a href="#-1273"><span class="linenos">1273</span></a>                        <span class="n">_max_fault_throw_4d</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="n">imft</span><span class="p">]</span> <span class="o">=</span> <span class="n">mft</span>
</span><span id="L-1274"><a href="#-1274"><span class="linenos">1274</span></a>                    <span class="n">max_fault_throw_4d</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">_max_fault_throw_4d</span>
</span><span id="L-1275"><a href="#-1275"><span class="linenos">1275</span></a>                    <span class="n">max_fault_throw_4d_diff</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">_max_fault_throw_4d_diff</span>
</span><span id="L-1276"><a href="#-1276"><span class="linenos">1276</span></a>                    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="L-1277"><a href="#-1277"><span class="linenos">1277</span></a>                        <span class="nb">print</span><span class="p">(</span>
</span><span id="L-1278"><a href="#-1278"><span class="linenos">1278</span></a>                            <span class="s2">&quot;   ...np.argmin(max_fault_throw_4d_diff, axis=-1).shape = &quot;</span>
</span><span id="L-1279"><a href="#-1279"><span class="linenos">1279</span></a>                            <span class="o">+</span> <span class="s2">&quot;, &quot;</span>
</span><span id="L-1280"><a href="#-1280"><span class="linenos">1280</span></a>                            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">max_fault_throw_4d_diff</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span><span id="L-1281"><a href="#-1281"><span class="linenos">1281</span></a>                        <span class="p">)</span>
</span><span id="L-1282"><a href="#-1282"><span class="linenos">1282</span></a>                    <span class="n">indices_nearest_throw</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">max_fault_throw_4d_diff</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-1283"><a href="#-1283"><span class="linenos">1283</span></a>                    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="L-1284"><a href="#-1284"><span class="linenos">1284</span></a>                        <span class="nb">print</span><span class="p">(</span>
</span><span id="L-1285"><a href="#-1285"><span class="linenos">1285</span></a>                            <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">   ...indices_nearest_throw.shape = &quot;</span>
</span><span id="L-1286"><a href="#-1286"><span class="linenos">1286</span></a>                            <span class="o">+</span> <span class="s2">&quot;, &quot;</span>
</span><span id="L-1287"><a href="#-1287"><span class="linenos">1287</span></a>                            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">indices_nearest_throw</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span><span id="L-1288"><a href="#-1288"><span class="linenos">1288</span></a>                        <span class="p">)</span>
</span><span id="L-1289"><a href="#-1289"><span class="linenos">1289</span></a>                    <span class="n">_max_fault_throw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_fault_throw</span><span class="p">[:]</span>
</span><span id="L-1290"><a href="#-1290"><span class="linenos">1290</span></a>                    <span class="k">for</span> <span class="n">imft</span><span class="p">,</span> <span class="n">mft</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">max_fault_throw_list</span><span class="p">):</span>
</span><span id="L-1291"><a href="#-1291"><span class="linenos">1291</span></a>                        <span class="n">_max_fault_throw</span><span class="p">[</span><span class="n">indices_nearest_throw</span> <span class="o">==</span> <span class="n">imft</span><span class="p">]</span> <span class="o">=</span> <span class="n">mft</span>
</span><span id="L-1292"><a href="#-1292"><span class="linenos">1292</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">max_fault_throw</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">_max_fault_throw</span>
</span><span id="L-1293"><a href="#-1293"><span class="linenos">1293</span></a>
</span><span id="L-1294"><a href="#-1294"><span class="linenos">1294</span></a>                    <span class="k">del</span> <span class="n">_max_fault_throw</span>
</span><span id="L-1295"><a href="#-1295"><span class="linenos">1295</span></a>                    <span class="k">del</span> <span class="n">adjusted_faulted_depths</span>
</span><span id="L-1296"><a href="#-1296"><span class="linenos">1296</span></a>
</span><span id="L-1297"><a href="#-1297"><span class="linenos">1297</span></a>                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="L-1298"><a href="#-1298"><span class="linenos">1298</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="L-1299"><a href="#-1299"><span class="linenos">1299</span></a>                        <span class="s2">&quot;   ...fault_segm[fault_segm&gt;0.].size = &quot;</span>
</span><span id="L-1300"><a href="#-1300"><span class="linenos">1300</span></a>                        <span class="o">+</span> <span class="s2">&quot;, &quot;</span>
</span><span id="L-1301"><a href="#-1301"><span class="linenos">1301</span></a>                        <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">fault_segm</span><span class="p">[</span><span class="n">fault_segm</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
</span><span id="L-1302"><a href="#-1302"><span class="linenos">1302</span></a>                    <span class="p">)</span>
</span><span id="L-1303"><a href="#-1303"><span class="linenos">1303</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   ...fault_segm.min() = &quot;</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">fault_segm</span><span class="o">.</span><span class="n">min</span><span class="p">()))</span>
</span><span id="L-1304"><a href="#-1304"><span class="linenos">1304</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   ...fault_segm.max() = &quot;</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">fault_segm</span><span class="o">.</span><span class="n">max</span><span class="p">()))</span>
</span><span id="L-1305"><a href="#-1305"><span class="linenos">1305</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="L-1306"><a href="#-1306"><span class="linenos">1306</span></a>                        <span class="s2">&quot;   ...self.fault_planes.max() = &quot;</span>
</span><span id="L-1307"><a href="#-1307"><span class="linenos">1307</span></a>                        <span class="o">+</span> <span class="s2">&quot;, &quot;</span>
</span><span id="L-1308"><a href="#-1308"><span class="linenos">1308</span></a>                        <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fault_planes</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
</span><span id="L-1309"><a href="#-1309"><span class="linenos">1309</span></a>                    <span class="p">)</span>
</span><span id="L-1310"><a href="#-1310"><span class="linenos">1310</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="L-1311"><a href="#-1311"><span class="linenos">1311</span></a>                        <span class="s2">&quot;   ...self.fault_intersections.max() = &quot;</span>
</span><span id="L-1312"><a href="#-1312"><span class="linenos">1312</span></a>                        <span class="o">+</span> <span class="s2">&quot;, &quot;</span>
</span><span id="L-1313"><a href="#-1313"><span class="linenos">1313</span></a>                        <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fault_intersections</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
</span><span id="L-1314"><a href="#-1314"><span class="linenos">1314</span></a>                    <span class="p">)</span>
</span><span id="L-1315"><a href="#-1315"><span class="linenos">1315</span></a>
</span><span id="L-1316"><a href="#-1316"><span class="linenos">1316</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="L-1317"><a href="#-1317"><span class="linenos">1317</span></a>                        <span class="s2">&quot;   ...list of unique values in self.max_fault_throw = &quot;</span>
</span><span id="L-1318"><a href="#-1318"><span class="linenos">1318</span></a>                        <span class="o">+</span> <span class="s2">&quot;, &quot;</span>
</span><span id="L-1319"><a href="#-1319"><span class="linenos">1319</span></a>                        <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_fault_throw</span><span class="p">))</span>
</span><span id="L-1320"><a href="#-1320"><span class="linenos">1320</span></a>                    <span class="p">)</span>
</span><span id="L-1321"><a href="#-1321"><span class="linenos">1321</span></a>
</span><span id="L-1322"><a href="#-1322"><span class="linenos">1322</span></a>                <span class="c1"># TODO: remove this block after qc/tests complete</span>
</span><span id="L-1323"><a href="#-1323"><span class="linenos">1323</span></a>                <span class="kn">from</span> <span class="nn">datagenerator.util</span> <span class="kn">import</span> <span class="n">import_matplotlib</span>
</span><span id="L-1324"><a href="#-1324"><span class="linenos">1324</span></a>                <span class="n">plt</span> <span class="o">=</span> <span class="n">import_matplotlib</span><span class="p">()</span>
</span><span id="L-1325"><a href="#-1325"><span class="linenos">1325</span></a>
</span><span id="L-1326"><a href="#-1326"><span class="linenos">1326</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="mi">35</span><span class="p">)</span>
</span><span id="L-1327"><a href="#-1327"><span class="linenos">1327</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">35</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
</span><span id="L-1328"><a href="#-1328"><span class="linenos">1328</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
</span><span id="L-1329"><a href="#-1329"><span class="linenos">1329</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">_faulted_depths</span><span class="p">[</span><span class="n">inline</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;prism&quot;</span><span class="p">)</span>
</span><span id="L-1330"><a href="#-1330"><span class="linenos">1330</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</span><span id="L-1331"><a href="#-1331"><span class="linenos">1331</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span>
</span><span id="L-1332"><a href="#-1332"><span class="linenos">1332</span></a>                    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="L-1333"><a href="#-1333"><span class="linenos">1333</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">work_subfolder</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;faulted_depths_</span><span class="si">{</span><span class="n">ifault</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">.png&quot;</span>
</span><span id="L-1334"><a href="#-1334"><span class="linenos">1334</span></a>                    <span class="p">),</span>
</span><span id="L-1335"><a href="#-1335"><span class="linenos">1335</span></a>                    <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;png&quot;</span><span class="p">,</span>
</span><span id="L-1336"><a href="#-1336"><span class="linenos">1336</span></a>                <span class="p">)</span>
</span><span id="L-1337"><a href="#-1337"><span class="linenos">1337</span></a>
</span><span id="L-1338"><a href="#-1338"><span class="linenos">1338</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="mi">35</span><span class="p">)</span>
</span><span id="L-1339"><a href="#-1339"><span class="linenos">1339</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">36</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
</span><span id="L-1340"><a href="#-1340"><span class="linenos">1340</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
</span><span id="L-1341"><a href="#-1341"><span class="linenos">1341</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">displacement</span><span class="p">[</span><span class="n">inline</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;jet&quot;</span><span class="p">)</span>
</span><span id="L-1342"><a href="#-1342"><span class="linenos">1342</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</span><span id="L-1343"><a href="#-1343"><span class="linenos">1343</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span>
</span><span id="L-1344"><a href="#-1344"><span class="linenos">1344</span></a>                    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="L-1345"><a href="#-1345"><span class="linenos">1345</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">work_subfolder</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;displacement_</span><span class="si">{</span><span class="n">ifault</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">.png&quot;</span>
</span><span id="L-1346"><a href="#-1346"><span class="linenos">1346</span></a>                    <span class="p">),</span>
</span><span id="L-1347"><a href="#-1347"><span class="linenos">1347</span></a>                    <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;png&quot;</span><span class="p">,</span>
</span><span id="L-1348"><a href="#-1348"><span class="linenos">1348</span></a>                <span class="p">)</span>
</span><span id="L-1349"><a href="#-1349"><span class="linenos">1349</span></a>
</span><span id="L-1350"><a href="#-1350"><span class="linenos">1350</span></a>                <span class="c1"># TODO: remove this block after qc/tests complete</span>
</span><span id="L-1351"><a href="#-1351"><span class="linenos">1351</span></a>                <span class="n">_plotarray</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fault_planes</span><span class="p">[</span><span class="n">inline</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-1352"><a href="#-1352"><span class="linenos">1352</span></a>                <span class="n">_plotarray</span><span class="p">[</span><span class="n">_plotarray</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
</span><span id="L-1353"><a href="#-1353"><span class="linenos">1353</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="mi">37</span><span class="p">)</span>
</span><span id="L-1354"><a href="#-1354"><span class="linenos">1354</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">37</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
</span><span id="L-1355"><a href="#-1355"><span class="linenos">1355</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
</span><span id="L-1356"><a href="#-1356"><span class="linenos">1356</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">_plotarray</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;gist_ncar&quot;</span><span class="p">)</span>
</span><span id="L-1357"><a href="#-1357"><span class="linenos">1357</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</span><span id="L-1358"><a href="#-1358"><span class="linenos">1358</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span>
</span><span id="L-1359"><a href="#-1359"><span class="linenos">1359</span></a>                    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">work_subfolder</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;fault_</span><span class="si">{</span><span class="n">ifault</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">.png&quot;</span><span class="p">),</span>
</span><span id="L-1360"><a href="#-1360"><span class="linenos">1360</span></a>                    <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;png&quot;</span><span class="p">,</span>
</span><span id="L-1361"><a href="#-1361"><span class="linenos">1361</span></a>                <span class="p">)</span>
</span><span id="L-1362"><a href="#-1362"><span class="linenos">1362</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="mi">37</span><span class="p">)</span>
</span><span id="L-1363"><a href="#-1363"><span class="linenos">1363</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">36</span><span class="p">)</span>
</span><span id="L-1364"><a href="#-1364"><span class="linenos">1364</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">_plotarray</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
</span><span id="L-1365"><a href="#-1365"><span class="linenos">1365</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</span><span id="L-1366"><a href="#-1366"><span class="linenos">1366</span></a>
</span><span id="L-1367"><a href="#-1367"><span class="linenos">1367</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span>
</span><span id="L-1368"><a href="#-1368"><span class="linenos">1368</span></a>                    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="L-1369"><a href="#-1369"><span class="linenos">1369</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">work_subfolder</span><span class="p">,</span>
</span><span id="L-1370"><a href="#-1370"><span class="linenos">1370</span></a>                        <span class="sa">f</span><span class="s2">&quot;displacement_fault_overlay_</span><span class="si">{</span><span class="n">ifault</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">.png&quot;</span><span class="p">,</span>
</span><span id="L-1371"><a href="#-1371"><span class="linenos">1371</span></a>                    <span class="p">),</span>
</span><span id="L-1372"><a href="#-1372"><span class="linenos">1372</span></a>                    <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;png&quot;</span><span class="p">,</span>
</span><span id="L-1373"><a href="#-1373"><span class="linenos">1373</span></a>                <span class="p">)</span>
</span><span id="L-1374"><a href="#-1374"><span class="linenos">1374</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="mi">36</span><span class="p">)</span>
</span><span id="L-1375"><a href="#-1375"><span class="linenos">1375</span></a>
</span><span id="L-1376"><a href="#-1376"><span class="linenos">1376</span></a>                <span class="n">hockey_sticks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hockey_stick</span><span class="p">)</span>
</span><span id="L-1377"><a href="#-1377"><span class="linenos">1377</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   ...hockey_sticks = &quot;</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">hockey_sticks</span><span class="p">))</span>
</span><span id="L-1378"><a href="#-1378"><span class="linenos">1378</span></a>
</span><span id="L-1379"><a href="#-1379"><span class="linenos">1379</span></a>        <span class="c1"># print final count</span>
</span><span id="L-1380"><a href="#-1380"><span class="linenos">1380</span></a>        <span class="n">max_fault_throw_list</span><span class="p">,</span> <span class="n">max_fault_throw_list_counts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span>
</span><span id="L-1381"><a href="#-1381"><span class="linenos">1381</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">max_fault_throw</span><span class="p">,</span> <span class="n">return_counts</span><span class="o">=</span><span class="kc">True</span>
</span><span id="L-1382"><a href="#-1382"><span class="linenos">1382</span></a>        <span class="p">)</span>
</span><span id="L-1383"><a href="#-1383"><span class="linenos">1383</span></a>        <span class="n">max_fault_throw_list</span> <span class="o">=</span> <span class="n">max_fault_throw_list</span><span class="p">[</span><span class="n">max_fault_throw_list_counts</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">]</span>
</span><span id="L-1384"><a href="#-1384"><span class="linenos">1384</span></a>        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="L-1385"><a href="#-1385"><span class="linenos">1385</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="L-1386"><a href="#-1386"><span class="linenos">1386</span></a>                <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">   ... ** final ** max_fault_throw_list = &quot;</span>
</span><span id="L-1387"><a href="#-1387"><span class="linenos">1387</span></a>                <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">max_fault_throw_list</span><span class="p">)</span>
</span><span id="L-1388"><a href="#-1388"><span class="linenos">1388</span></a>                <span class="o">+</span> <span class="s2">&quot;, &quot;</span>
</span><span id="L-1389"><a href="#-1389"><span class="linenos">1389</span></a>                <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">max_fault_throw_list_counts</span><span class="p">)</span>
</span><span id="L-1390"><a href="#-1390"><span class="linenos">1390</span></a>            <span class="p">)</span>
</span><span id="L-1391"><a href="#-1391"><span class="linenos">1391</span></a>
</span><span id="L-1392"><a href="#-1392"><span class="linenos">1392</span></a>        <span class="c1"># create fault intersections</span>
</span><span id="L-1393"><a href="#-1393"><span class="linenos">1393</span></a>        <span class="n">_fault_intersections</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fault_planes</span><span class="p">[:]</span> <span class="o">*</span> <span class="mf">1.0</span>
</span><span id="L-1394"><a href="#-1394"><span class="linenos">1394</span></a>        <span class="c1"># self.fault_intersections = self.fault_planes * 1.</span>
</span><span id="L-1395"><a href="#-1395"><span class="linenos">1395</span></a>        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="L-1396"><a href="#-1396"><span class="linenos">1396</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  ... line 592:&quot;</span><span class="p">)</span>
</span><span id="L-1397"><a href="#-1397"><span class="linenos">1397</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="L-1398"><a href="#-1398"><span class="linenos">1398</span></a>                <span class="s2">&quot;   ...self.fault_intersections.max() = &quot;</span>
</span><span id="L-1399"><a href="#-1399"><span class="linenos">1399</span></a>                <span class="o">+</span> <span class="s2">&quot;, &quot;</span>
</span><span id="L-1400"><a href="#-1400"><span class="linenos">1400</span></a>                <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">_fault_intersections</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
</span><span id="L-1401"><a href="#-1401"><span class="linenos">1401</span></a>            <span class="p">)</span>
</span><span id="L-1402"><a href="#-1402"><span class="linenos">1402</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="L-1403"><a href="#-1403"><span class="linenos">1403</span></a>                <span class="s2">&quot;   ...self.fault_intersections[self.fault_intersections&gt;0.].size = &quot;</span>
</span><span id="L-1404"><a href="#-1404"><span class="linenos">1404</span></a>                <span class="o">+</span> <span class="s2">&quot;, &quot;</span>
</span><span id="L-1405"><a href="#-1405"><span class="linenos">1405</span></a>                <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">_fault_intersections</span><span class="p">[</span><span class="n">_fault_intersections</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
</span><span id="L-1406"><a href="#-1406"><span class="linenos">1406</span></a>            <span class="p">)</span>
</span><span id="L-1407"><a href="#-1407"><span class="linenos">1407</span></a>
</span><span id="L-1408"><a href="#-1408"><span class="linenos">1408</span></a>        <span class="n">_fault_intersections</span><span class="p">[</span><span class="n">_fault_intersections</span> <span class="o">&lt;=</span> <span class="mf">1.0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="L-1409"><a href="#-1409"><span class="linenos">1409</span></a>        <span class="n">_fault_intersections</span><span class="p">[</span><span class="n">_fault_intersections</span> <span class="o">&gt;</span> <span class="mf">1.1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="L-1410"><a href="#-1410"><span class="linenos">1410</span></a>        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="L-1411"><a href="#-1411"><span class="linenos">1411</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  ... line 597:&quot;</span><span class="p">)</span>
</span><span id="L-1412"><a href="#-1412"><span class="linenos">1412</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="L-1413"><a href="#-1413"><span class="linenos">1413</span></a>                <span class="s2">&quot;   ...self.fault_intersections.max() = &quot;</span>
</span><span id="L-1414"><a href="#-1414"><span class="linenos">1414</span></a>                <span class="o">+</span> <span class="s2">&quot;, &quot;</span>
</span><span id="L-1415"><a href="#-1415"><span class="linenos">1415</span></a>                <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">_fault_intersections</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
</span><span id="L-1416"><a href="#-1416"><span class="linenos">1416</span></a>            <span class="p">)</span>
</span><span id="L-1417"><a href="#-1417"><span class="linenos">1417</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="L-1418"><a href="#-1418"><span class="linenos">1418</span></a>                <span class="s2">&quot;   ...self.fault_intersections[self.fault_intersections&gt;0.].size = &quot;</span>
</span><span id="L-1419"><a href="#-1419"><span class="linenos">1419</span></a>                <span class="o">+</span> <span class="s2">&quot;, &quot;</span>
</span><span id="L-1420"><a href="#-1420"><span class="linenos">1420</span></a>                <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">_fault_intersections</span><span class="p">[</span><span class="n">_fault_intersections</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
</span><span id="L-1421"><a href="#-1421"><span class="linenos">1421</span></a>            <span class="p">)</span>
</span><span id="L-1422"><a href="#-1422"><span class="linenos">1422</span></a>
</span><span id="L-1423"><a href="#-1423"><span class="linenos">1423</span></a>        <span class="c1"># make 2nd count of number of intersections between faults. write result to logfile.</span>
</span><span id="L-1424"><a href="#-1424"><span class="linenos">1424</span></a>        <span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
</span><span id="L-1425"><a href="#-1425"><span class="linenos">1425</span></a>
</span><span id="L-1426"><a href="#-1426"><span class="linenos">1426</span></a>        <span class="n">start_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
</span><span id="L-1427"><a href="#-1427"><span class="linenos">1427</span></a>        <span class="n">number_fault_intersections</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span>
</span><span id="L-1428"><a href="#-1428"><span class="linenos">1428</span></a>            <span class="n">number_fault_intersections</span><span class="p">,</span>
</span><span id="L-1429"><a href="#-1429"><span class="linenos">1429</span></a>            <span class="n">measure</span><span class="o">.</span><span class="n">label</span><span class="p">(</span><span class="n">_fault_intersections</span><span class="p">,</span> <span class="n">background</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span>
</span><span id="L-1430"><a href="#-1430"><span class="linenos">1430</span></a>        <span class="p">)</span>
</span><span id="L-1431"><a href="#-1431"><span class="linenos">1431</span></a>        <span class="nb">print</span><span class="p">(</span>
</span><span id="L-1432"><a href="#-1432"><span class="linenos">1432</span></a>            <span class="sa">f</span><span class="s2">&quot;   ... elapsed time for skimage.label = </span><span class="si">{</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-1433"><a href="#-1433"><span class="linenos">1433</span></a>        <span class="p">)</span>
</span><span id="L-1434"><a href="#-1434"><span class="linenos">1434</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   ... number_fault_intersections = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">number_fault_intersections</span><span class="p">))</span>
</span><span id="L-1435"><a href="#-1435"><span class="linenos">1435</span></a>
</span><span id="L-1436"><a href="#-1436"><span class="linenos">1436</span></a>        <span class="c1"># dilate intersection values</span>
</span><span id="L-1437"><a href="#-1437"><span class="linenos">1437</span></a>        <span class="c1"># - window size of (5,5,15) is arbitrary. Should be based on isolating sections</span>
</span><span id="L-1438"><a href="#-1438"><span class="linenos">1438</span></a>        <span class="c1">#   of fault planes on real seismic</span>
</span><span id="L-1439"><a href="#-1439"><span class="linenos">1439</span></a>        <span class="n">_fault_intersections</span> <span class="o">=</span> <span class="n">maximum_filter</span><span class="p">(</span><span class="n">_fault_intersections</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">17</span><span class="p">))</span>
</span><span id="L-1440"><a href="#-1440"><span class="linenos">1440</span></a>
</span><span id="L-1441"><a href="#-1441"><span class="linenos">1441</span></a>        <span class="c1"># Fault intersection segments &gt; 1 at intersecting faults. Clip to 1</span>
</span><span id="L-1442"><a href="#-1442"><span class="linenos">1442</span></a>        <span class="n">_fault_intersections</span><span class="p">[</span><span class="n">_fault_intersections</span> <span class="o">&gt;</span> <span class="mf">0.05</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="L-1443"><a href="#-1443"><span class="linenos">1443</span></a>        <span class="n">_fault_intersections</span><span class="p">[</span><span class="n">_fault_intersections</span> <span class="o">!=</span> <span class="mf">1.0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="L-1444"><a href="#-1444"><span class="linenos">1444</span></a>        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="L-1445"><a href="#-1445"><span class="linenos">1445</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  ... line 607:&quot;</span><span class="p">)</span>
</span><span id="L-1446"><a href="#-1446"><span class="linenos">1446</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="L-1447"><a href="#-1447"><span class="linenos">1447</span></a>                <span class="s2">&quot;   ...self.fault_intersections.max() = &quot;</span>
</span><span id="L-1448"><a href="#-1448"><span class="linenos">1448</span></a>                <span class="o">+</span> <span class="s2">&quot;, &quot;</span>
</span><span id="L-1449"><a href="#-1449"><span class="linenos">1449</span></a>                <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">_fault_intersections</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
</span><span id="L-1450"><a href="#-1450"><span class="linenos">1450</span></a>            <span class="p">)</span>
</span><span id="L-1451"><a href="#-1451"><span class="linenos">1451</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="L-1452"><a href="#-1452"><span class="linenos">1452</span></a>                <span class="s2">&quot;   ...self.fault_intersections[self.fault_intersections&gt;0.].size = &quot;</span>
</span><span id="L-1453"><a href="#-1453"><span class="linenos">1453</span></a>                <span class="o">+</span> <span class="s2">&quot;, &quot;</span>
</span><span id="L-1454"><a href="#-1454"><span class="linenos">1454</span></a>                <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">_fault_intersections</span><span class="p">[</span><span class="n">_fault_intersections</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
</span><span id="L-1455"><a href="#-1455"><span class="linenos">1455</span></a>            <span class="p">)</span>
</span><span id="L-1456"><a href="#-1456"><span class="linenos">1456</span></a>
</span><span id="L-1457"><a href="#-1457"><span class="linenos">1457</span></a>        <span class="c1"># Fault segments = 1 at fault &gt; 1 at intersections. Clip intersecting fault voxels to 1</span>
</span><span id="L-1458"><a href="#-1458"><span class="linenos">1458</span></a>        <span class="n">_fault_planes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fault_planes</span><span class="p">[:]</span>
</span><span id="L-1459"><a href="#-1459"><span class="linenos">1459</span></a>        <span class="n">_fault_planes</span><span class="p">[</span><span class="n">_fault_planes</span> <span class="o">&gt;</span> <span class="mf">0.05</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="L-1460"><a href="#-1460"><span class="linenos">1460</span></a>        <span class="n">_fault_planes</span><span class="p">[</span><span class="n">_fault_planes</span> <span class="o">!=</span> <span class="mf">1.0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="L-1461"><a href="#-1461"><span class="linenos">1461</span></a>
</span><span id="L-1462"><a href="#-1462"><span class="linenos">1462</span></a>        <span class="c1"># make fault azi 3D and only retain voxels in fault plane</span>
</span><span id="L-1463"><a href="#-1463"><span class="linenos">1463</span></a>
</span><span id="L-1464"><a href="#-1464"><span class="linenos">1464</span></a>        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
</span><span id="L-1465"><a href="#-1465"><span class="linenos">1465</span></a>            <span class="p">[</span>
</span><span id="L-1466"><a href="#-1466"><span class="linenos">1466</span></a>                <span class="s2">&quot;n_voxels_faults&quot;</span><span class="p">,</span>
</span><span id="L-1467"><a href="#-1467"><span class="linenos">1467</span></a>                <span class="s2">&quot;n_voxels_fault_intersections&quot;</span><span class="p">,</span>
</span><span id="L-1468"><a href="#-1468"><span class="linenos">1468</span></a>                <span class="s2">&quot;number_fault_intersections&quot;</span><span class="p">,</span>
</span><span id="L-1469"><a href="#-1469"><span class="linenos">1469</span></a>                <span class="s2">&quot;fault_voxel_count_list&quot;</span><span class="p">,</span>
</span><span id="L-1470"><a href="#-1470"><span class="linenos">1470</span></a>                <span class="s2">&quot;hockey_sticks&quot;</span><span class="p">,</span>
</span><span id="L-1471"><a href="#-1471"><span class="linenos">1471</span></a>            <span class="p">],</span>
</span><span id="L-1472"><a href="#-1472"><span class="linenos">1472</span></a>            <span class="p">[</span>
</span><span id="L-1473"><a href="#-1473"><span class="linenos">1473</span></a>                <span class="n">_fault_planes</span><span class="p">[</span><span class="n">_fault_planes</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">,</span>
</span><span id="L-1474"><a href="#-1474"><span class="linenos">1474</span></a>                <span class="n">_fault_intersections</span><span class="p">[</span><span class="n">_fault_intersections</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">,</span>
</span><span id="L-1475"><a href="#-1475"><span class="linenos">1475</span></a>                <span class="n">number_fault_intersections</span><span class="p">,</span>
</span><span id="L-1476"><a href="#-1476"><span class="linenos">1476</span></a>                <span class="n">fault_voxel_count_list</span><span class="p">,</span>
</span><span id="L-1477"><a href="#-1477"><span class="linenos">1477</span></a>                <span class="n">hockey_sticks</span><span class="p">,</span>
</span><span id="L-1478"><a href="#-1478"><span class="linenos">1478</span></a>            <span class="p">],</span>
</span><span id="L-1479"><a href="#-1479"><span class="linenos">1479</span></a>        <span class="p">):</span>
</span><span id="L-1480"><a href="#-1480"><span class="linenos">1480</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1481"><a href="#-1481"><span class="linenos">1481</span></a>
</span><span id="L-1482"><a href="#-1482"><span class="linenos">1482</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="L-1483"><a href="#-1483"><span class="linenos">1483</span></a>                <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span> <span class="n">subkey</span><span class="o">=</span><span class="n">k</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">v</span>
</span><span id="L-1484"><a href="#-1484"><span class="linenos">1484</span></a>            <span class="p">)</span>
</span><span id="L-1485"><a href="#-1485"><span class="linenos">1485</span></a>
</span><span id="L-1486"><a href="#-1486"><span class="linenos">1486</span></a>        <span class="n">dis_class</span> <span class="o">=</span> <span class="n">_faulted_depths</span> <span class="o">*</span> <span class="mi">1</span>
</span><span id="L-1487"><a href="#-1487"><span class="linenos">1487</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fault_intersections</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">_fault_intersections</span>
</span><span id="L-1488"><a href="#-1488"><span class="linenos">1488</span></a>        <span class="k">del</span> <span class="n">_fault_intersections</span>
</span><span id="L-1489"><a href="#-1489"><span class="linenos">1489</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fault_planes</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">_fault_planes</span>
</span><span id="L-1490"><a href="#-1490"><span class="linenos">1490</span></a>        <span class="k">del</span> <span class="n">_fault_planes</span>
</span><span id="L-1491"><a href="#-1491"><span class="linenos">1491</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">displacement_vectors</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">_faulted_depths</span> <span class="o">*</span> <span class="mf">1.0</span>
</span><span id="L-1492"><a href="#-1492"><span class="linenos">1492</span></a>
</span><span id="L-1493"><a href="#-1493"><span class="linenos">1493</span></a>        <span class="c1"># TODO: check if next line of code modifies &#39;displacement&#39; properly</span>
</span><span id="L-1494"><a href="#-1494"><span class="linenos">1494</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sum_map_displacements</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">_faulted_depths</span> <span class="o">*</span> <span class="mf">1.0</span>
</span><span id="L-1495"><a href="#-1495"><span class="linenos">1495</span></a>
</span><span id="L-1496"><a href="#-1496"><span class="linenos">1496</span></a>        <span class="c1"># Save faulted maps</span>
</span><span id="L-1497"><a href="#-1497"><span class="linenos">1497</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">faulted_depth_maps</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">depth_maps_faulted_infilled</span>
</span><span id="L-1498"><a href="#-1498"><span class="linenos">1498</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">faulted_depth_maps_gaps</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">depth_maps_gaps</span>
</span><span id="L-1499"><a href="#-1499"><span class="linenos">1499</span></a>
</span><span id="L-1500"><a href="#-1500"><span class="linenos">1500</span></a>        <span class="c1"># perform faulting for fault_segments and fault_intersections</span>
</span><span id="L-1501"><a href="#-1501"><span class="linenos">1501</span></a>        <span class="k">return</span> <span class="n">dis_class</span><span class="p">,</span> <span class="n">hockey_sticks</span>
</span><span id="L-1502"><a href="#-1502"><span class="linenos">1502</span></a>
</span><span id="L-1503"><a href="#-1503"><span class="linenos">1503</span></a>    <span class="k">def</span> <span class="nf">_qc_plot_check_faulted_horizons_match_fault_segments</span><span class="p">(</span>
</span><span id="L-1504"><a href="#-1504"><span class="linenos">1504</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">faulted_depth_maps</span><span class="p">,</span> <span class="n">faulted_geologic_age</span>
</span><span id="L-1505"><a href="#-1505"><span class="linenos">1505</span></a>    <span class="p">):</span>
</span><span id="L-1506"><a href="#-1506"><span class="linenos">1506</span></a>        <span class="sd">&quot;&quot;&quot;_qc_plot_check_faulted_horizons_match_fault_segments _summary_</span>
</span><span id="L-1507"><a href="#-1507"><span class="linenos">1507</span></a>
</span><span id="L-1508"><a href="#-1508"><span class="linenos">1508</span></a><span class="sd">        Parameters</span>
</span><span id="L-1509"><a href="#-1509"><span class="linenos">1509</span></a><span class="sd">        ----------</span>
</span><span id="L-1510"><a href="#-1510"><span class="linenos">1510</span></a><span class="sd">        faulted_depth_maps : np.ndarray</span>
</span><span id="L-1511"><a href="#-1511"><span class="linenos">1511</span></a><span class="sd">            The faluted depth maps</span>
</span><span id="L-1512"><a href="#-1512"><span class="linenos">1512</span></a><span class="sd">        faulted_geologic_age : _type_</span>
</span><span id="L-1513"><a href="#-1513"><span class="linenos">1513</span></a><span class="sd">            _description_</span>
</span><span id="L-1514"><a href="#-1514"><span class="linenos">1514</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1515"><a href="#-1515"><span class="linenos">1515</span></a>        <span class="kn">import</span> <span class="nn">os</span>
</span><span id="L-1516"><a href="#-1516"><span class="linenos">1516</span></a>        <span class="kn">from</span> <span class="nn">datagenerator.util</span> <span class="kn">import</span> <span class="n">import_matplotlib</span>
</span><span id="L-1517"><a href="#-1517"><span class="linenos">1517</span></a>
</span><span id="L-1518"><a href="#-1518"><span class="linenos">1518</span></a>        <span class="n">plt</span> <span class="o">=</span> <span class="n">import_matplotlib</span><span class="p">()</span>
</span><span id="L-1519"><a href="#-1519"><span class="linenos">1519</span></a>
</span><span id="L-1520"><a href="#-1520"><span class="linenos">1520</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
</span><span id="L-1521"><a href="#-1521"><span class="linenos">1521</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
</span><span id="L-1522"><a href="#-1522"><span class="linenos">1522</span></a>        <span class="n">voxel_count_max</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-1523"><a href="#-1523"><span class="linenos">1523</span></a>        <span class="n">inline</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">//</span> <span class="mi">2</span>
</span><span id="L-1524"><a href="#-1524"><span class="linenos">1524</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fault_planes</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">10</span><span class="p">):</span>
</span><span id="L-1525"><a href="#-1525"><span class="linenos">1525</span></a>            <span class="n">voxel_count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fault_planes</span><span class="p">[:,</span> <span class="n">i</span><span class="p">,</span> <span class="p">:]</span>
</span><span id="L-1526"><a href="#-1526"><span class="linenos">1526</span></a>            <span class="n">voxel_count</span> <span class="o">=</span> <span class="n">voxel_count</span><span class="p">[</span><span class="n">voxel_count</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="L-1527"><a href="#-1527"><span class="linenos">1527</span></a>            <span class="k">if</span> <span class="n">voxel_count</span> <span class="o">&gt;</span> <span class="n">voxel_count_max</span><span class="p">:</span>
</span><span id="L-1528"><a href="#-1528"><span class="linenos">1528</span></a>                <span class="n">inline</span> <span class="o">=</span> <span class="n">i</span>
</span><span id="L-1529"><a href="#-1529"><span class="linenos">1529</span></a>                <span class="n">voxel_count_max</span> <span class="o">=</span> <span class="n">voxel_count</span>
</span><span id="L-1530"><a href="#-1530"><span class="linenos">1530</span></a>        <span class="c1"># inline=50</span>
</span><span id="L-1531"><a href="#-1531"><span class="linenos">1531</span></a>        <span class="n">plotdata</span> <span class="o">=</span> <span class="p">(</span><span class="n">faulted_geologic_age</span><span class="p">[:,</span> <span class="n">inline</span><span class="p">,</span> <span class="p">:])</span><span class="o">.</span><span class="n">T</span>
</span><span id="L-1532"><a href="#-1532"><span class="linenos">1532</span></a>        <span class="n">plotdata_overlay</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fault_planes</span><span class="p">[:,</span> <span class="n">inline</span><span class="p">,</span> <span class="p">:])</span><span class="o">.</span><span class="n">T</span>
</span><span id="L-1533"><a href="#-1533"><span class="linenos">1533</span></a>        <span class="n">plotdata</span><span class="p">[</span><span class="n">plotdata_overlay</span> <span class="o">&gt;</span> <span class="mf">0.9</span><span class="p">]</span> <span class="o">=</span> <span class="n">plotdata</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</span><span id="L-1534"><a href="#-1534"><span class="linenos">1534</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">plotdata</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;prism&quot;</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">)</span>
</span><span id="L-1535"><a href="#-1535"><span class="linenos">1535</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span>
</span><span id="L-1536"><a href="#-1536"><span class="linenos">1536</span></a>            <span class="s2">&quot;QC plot: faulted layers with horizons and fault_segments overlain&quot;</span>
</span><span id="L-1537"><a href="#-1537"><span class="linenos">1537</span></a>            <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Inline &quot;</span>
</span><span id="L-1538"><a href="#-1538"><span class="linenos">1538</span></a>            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">inline</span><span class="p">)</span>
</span><span id="L-1539"><a href="#-1539"><span class="linenos">1539</span></a>        <span class="p">)</span>
</span><span id="L-1540"><a href="#-1540"><span class="linenos">1540</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
</span><span id="L-1541"><a href="#-1541"><span class="linenos">1541</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">faulted_depth_maps</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">10</span><span class="p">):</span>
</span><span id="L-1542"><a href="#-1542"><span class="linenos">1542</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
</span><span id="L-1543"><a href="#-1543"><span class="linenos">1543</span></a>                <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
</span><span id="L-1544"><a href="#-1544"><span class="linenos">1544</span></a>                <span class="n">faulted_depth_maps</span><span class="p">[:,</span> <span class="n">inline</span><span class="p">],</span>
</span><span id="L-1545"><a href="#-1545"><span class="linenos">1545</span></a>                <span class="s2">&quot;k-&quot;</span><span class="p">,</span>
</span><span id="L-1546"><a href="#-1546"><span class="linenos">1546</span></a>                <span class="n">lw</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span>
</span><span id="L-1547"><a href="#-1547"><span class="linenos">1547</span></a>            <span class="p">)</span>
</span><span id="L-1548"><a href="#-1548"><span class="linenos">1548</span></a>        <span class="n">plot_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="L-1549"><a href="#-1549"><span class="linenos">1549</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">work_subfolder</span><span class="p">,</span> <span class="s2">&quot;QC_horizons_from_geologic_age_isovalues.png&quot;</span>
</span><span id="L-1550"><a href="#-1550"><span class="linenos">1550</span></a>        <span class="p">)</span>
</span><span id="L-1551"><a href="#-1551"><span class="linenos">1551</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">plot_name</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;png&quot;</span><span class="p">)</span>
</span><span id="L-1552"><a href="#-1552"><span class="linenos">1552</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="L-1553"><a href="#-1553"><span class="linenos">1553</span></a>        <span class="c1">#</span>
</span><span id="L-1554"><a href="#-1554"><span class="linenos">1554</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
</span><span id="L-1555"><a href="#-1555"><span class="linenos">1555</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
</span><span id="L-1556"><a href="#-1556"><span class="linenos">1556</span></a>        <span class="n">voxel_count_max</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-1557"><a href="#-1557"><span class="linenos">1557</span></a>        <span class="n">iz</span> <span class="o">=</span> <span class="n">faulted_geologic_age</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">//</span> <span class="mi">2</span>
</span><span id="L-1558"><a href="#-1558"><span class="linenos">1558</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fault_planes</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="mi">50</span><span class="p">):</span>
</span><span id="L-1559"><a href="#-1559"><span class="linenos">1559</span></a>            <span class="n">voxel_count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fault_planes</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">i</span><span class="p">]</span>
</span><span id="L-1560"><a href="#-1560"><span class="linenos">1560</span></a>            <span class="n">voxel_count</span> <span class="o">=</span> <span class="n">voxel_count</span><span class="p">[</span><span class="n">voxel_count</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="L-1561"><a href="#-1561"><span class="linenos">1561</span></a>            <span class="k">if</span> <span class="n">voxel_count</span> <span class="o">&gt;</span> <span class="n">voxel_count_max</span><span class="p">:</span>
</span><span id="L-1562"><a href="#-1562"><span class="linenos">1562</span></a>                <span class="n">iz</span> <span class="o">=</span> <span class="n">i</span>
</span><span id="L-1563"><a href="#-1563"><span class="linenos">1563</span></a>                <span class="n">voxel_count_max</span> <span class="o">=</span> <span class="n">voxel_count</span>
</span><span id="L-1564"><a href="#-1564"><span class="linenos">1564</span></a>
</span><span id="L-1565"><a href="#-1565"><span class="linenos">1565</span></a>        <span class="n">plotdata</span> <span class="o">=</span> <span class="n">faulted_geologic_age</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">iz</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-1566"><a href="#-1566"><span class="linenos">1566</span></a>        <span class="n">plotdata2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fault_planes</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">iz</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-1567"><a href="#-1567"><span class="linenos">1567</span></a>        <span class="n">plotdata</span><span class="p">[</span><span class="n">plotdata2</span> <span class="o">&gt;</span> <span class="mf">0.05</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="L-1568"><a href="#-1568"><span class="linenos">1568</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-1569"><a href="#-1569"><span class="linenos">1569</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">iz</span><span class="p">))</span>
</span><span id="L-1570"><a href="#-1570"><span class="linenos">1570</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">plotdata</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;prism&quot;</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">)</span>
</span><span id="L-1571"><a href="#-1571"><span class="linenos">1571</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="L-1572"><a href="#-1572"><span class="linenos">1572</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">plotdata2</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;jet&quot;</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">)</span>
</span><span id="L-1573"><a href="#-1573"><span class="linenos">1573</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
</span><span id="L-1574"><a href="#-1574"><span class="linenos">1574</span></a>        <span class="n">plot_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="L-1575"><a href="#-1575"><span class="linenos">1575</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">work_subfolder</span><span class="p">,</span> <span class="s2">&quot;QC_fault_segments_on_geologic_age_timeslice.png&quot;</span>
</span><span id="L-1576"><a href="#-1576"><span class="linenos">1576</span></a>        <span class="p">)</span>
</span><span id="L-1577"><a href="#-1577"><span class="linenos">1577</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">plot_name</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;png&quot;</span><span class="p">)</span>
</span><span id="L-1578"><a href="#-1578"><span class="linenos">1578</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="L-1579"><a href="#-1579"><span class="linenos">1579</span></a>
</span><span id="L-1580"><a href="#-1580"><span class="linenos">1580</span></a>    <span class="k">def</span> <span class="nf">improve_depth_maps_post_faulting</span><span class="p">(</span>
</span><span id="L-1581"><a href="#-1581"><span class="linenos">1581</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-1582"><a href="#-1582"><span class="linenos">1582</span></a>        <span class="n">unfaulted_geologic_age</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
</span><span id="L-1583"><a href="#-1583"><span class="linenos">1583</span></a>        <span class="n">faulted_geologic_age</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
</span><span id="L-1584"><a href="#-1584"><span class="linenos">1584</span></a>        <span class="n">onlap_clips</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
</span><span id="L-1585"><a href="#-1585"><span class="linenos">1585</span></a>    <span class="p">):</span>
</span><span id="L-1586"><a href="#-1586"><span class="linenos">1586</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1587"><a href="#-1587"><span class="linenos">1587</span></a><span class="sd">        Re-interpolates the depth maps using the faulted geologic age cube</span>
</span><span id="L-1588"><a href="#-1588"><span class="linenos">1588</span></a>
</span><span id="L-1589"><a href="#-1589"><span class="linenos">1589</span></a><span class="sd">        Parameters</span>
</span><span id="L-1590"><a href="#-1590"><span class="linenos">1590</span></a><span class="sd">        ----------</span>
</span><span id="L-1591"><a href="#-1591"><span class="linenos">1591</span></a><span class="sd">        unfaulted_geologic_age : np.ndarray</span>
</span><span id="L-1592"><a href="#-1592"><span class="linenos">1592</span></a><span class="sd">            The unfaulted geologic age cube</span>
</span><span id="L-1593"><a href="#-1593"><span class="linenos">1593</span></a><span class="sd">        faulted_geologic_age : np.ndarray</span>
</span><span id="L-1594"><a href="#-1594"><span class="linenos">1594</span></a><span class="sd">            The faulted geologic age cube</span>
</span><span id="L-1595"><a href="#-1595"><span class="linenos">1595</span></a><span class="sd">        onlap_clips : np.ndarray</span>
</span><span id="L-1596"><a href="#-1596"><span class="linenos">1596</span></a><span class="sd">            The onlap clips</span>
</span><span id="L-1597"><a href="#-1597"><span class="linenos">1597</span></a><span class="sd">        </span>
</span><span id="L-1598"><a href="#-1598"><span class="linenos">1598</span></a><span class="sd">        Returns</span>
</span><span id="L-1599"><a href="#-1599"><span class="linenos">1599</span></a><span class="sd">        -------</span>
</span><span id="L-1600"><a href="#-1600"><span class="linenos">1600</span></a><span class="sd">        depth_maps : np.ndarray</span>
</span><span id="L-1601"><a href="#-1601"><span class="linenos">1601</span></a><span class="sd">            The improved depth maps</span>
</span><span id="L-1602"><a href="#-1602"><span class="linenos">1602</span></a><span class="sd">        depth_maps_gaps : np.ndarray</span>
</span><span id="L-1603"><a href="#-1603"><span class="linenos">1603</span></a><span class="sd">            The improved depth maps with gaps</span>
</span><span id="L-1604"><a href="#-1604"><span class="linenos">1604</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1605"><a href="#-1605"><span class="linenos">1605</span></a>        <span class="n">faulted_depth_maps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faulted_depth_maps</span><span class="p">)</span>
</span><span id="L-1606"><a href="#-1606"><span class="linenos">1606</span></a>        <span class="n">origtime</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faulted_depth_maps</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</span><span id="L-1607"><a href="#-1607"><span class="linenos">1607</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faulted_depth_maps</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="L-1608"><a href="#-1608"><span class="linenos">1608</span></a>            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faulted_depth_maps</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
</span><span id="L-1609"><a href="#-1609"><span class="linenos">1609</span></a>                <span class="k">if</span> <span class="p">(</span>
</span><span id="L-1610"><a href="#-1610"><span class="linenos">1610</span></a>                    <span class="n">faulted_geologic_age</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
</span><span id="L-1611"><a href="#-1611"><span class="linenos">1611</span></a>                    <span class="o">!=</span> <span class="n">faulted_geologic_age</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</span><span id="L-1612"><a href="#-1612"><span class="linenos">1612</span></a>                <span class="p">):</span>
</span><span id="L-1613"><a href="#-1613"><span class="linenos">1613</span></a>                    <span class="n">faulted_depth_maps</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span>
</span><span id="L-1614"><a href="#-1614"><span class="linenos">1614</span></a>                        <span class="n">origtime</span><span class="p">,</span>
</span><span id="L-1615"><a href="#-1615"><span class="linenos">1615</span></a>                        <span class="n">faulted_geologic_age</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="p">:],</span>
</span><span id="L-1616"><a href="#-1616"><span class="linenos">1616</span></a>                        <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">faulted_geologic_age</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;float&quot;</span><span class="p">),</span>
</span><span id="L-1617"><a href="#-1617"><span class="linenos">1617</span></a>                    <span class="p">)</span>
</span><span id="L-1618"><a href="#-1618"><span class="linenos">1618</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-1619"><a href="#-1619"><span class="linenos">1619</span></a>                    <span class="n">faulted_depth_maps</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">unfaulted_geologic_age</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="p">:]</span>
</span><span id="L-1620"><a href="#-1620"><span class="linenos">1620</span></a>        <span class="c1"># Waterbottom horizon has been set to 0. Re-insert this from the original depth_maps array</span>
</span><span id="L-1621"><a href="#-1621"><span class="linenos">1621</span></a>        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">count_nonzero</span><span class="p">(</span><span class="n">faulted_depth_maps</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-1622"><a href="#-1622"><span class="linenos">1622</span></a>            <span class="n">faulted_depth_maps</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">faulted_depth_maps</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1.0</span>
</span><span id="L-1623"><a href="#-1623"><span class="linenos">1623</span></a>
</span><span id="L-1624"><a href="#-1624"><span class="linenos">1624</span></a>        <span class="c1"># Shift re-interpolated horizons to replace first horizon (of 0&#39;s) with the second, etc</span>
</span><span id="L-1625"><a href="#-1625"><span class="linenos">1625</span></a>        <span class="n">zmaps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">faulted_depth_maps</span><span class="p">)</span>
</span><span id="L-1626"><a href="#-1626"><span class="linenos">1626</span></a>        <span class="n">zmaps</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">faulted_depth_maps</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">:]</span>
</span><span id="L-1627"><a href="#-1627"><span class="linenos">1627</span></a>        <span class="c1"># Fix the deepest re-interpolated horizon by adding a constant thickness to the shallower horizon</span>
</span><span id="L-1628"><a href="#-1628"><span class="linenos">1628</span></a>        <span class="n">zmaps</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">faulted_depth_maps</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">10</span>
</span><span id="L-1629"><a href="#-1629"><span class="linenos">1629</span></a>        <span class="c1"># Clip this last horizon to the one above</span>
</span><span id="L-1630"><a href="#-1630"><span class="linenos">1630</span></a>        <span class="n">thickness_map</span> <span class="o">=</span> <span class="n">zmaps</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">zmaps</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">]</span>
</span><span id="L-1631"><a href="#-1631"><span class="linenos">1631</span></a>        <span class="n">zmaps</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">thickness_map</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">)]</span> <span class="o">=</span> <span class="n">zmaps</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">][</span>
</span><span id="L-1632"><a href="#-1632"><span class="linenos">1632</span></a>            <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">thickness_map</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">)</span>
</span><span id="L-1633"><a href="#-1633"><span class="linenos">1633</span></a>        <span class="p">]</span>
</span><span id="L-1634"><a href="#-1634"><span class="linenos">1634</span></a>        <span class="n">faulted_depth_maps</span> <span class="o">=</span> <span class="n">zmaps</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-1635"><a href="#-1635"><span class="linenos">1635</span></a>
</span><span id="L-1636"><a href="#-1636"><span class="linenos">1636</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">qc_plots</span><span class="p">:</span>
</span><span id="L-1637"><a href="#-1637"><span class="linenos">1637</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_qc_plot_check_faulted_horizons_match_fault_segments</span><span class="p">(</span>
</span><span id="L-1638"><a href="#-1638"><span class="linenos">1638</span></a>                <span class="n">faulted_depth_maps</span><span class="p">,</span> <span class="n">faulted_geologic_age</span>
</span><span id="L-1639"><a href="#-1639"><span class="linenos">1639</span></a>            <span class="p">)</span>
</span><span id="L-1640"><a href="#-1640"><span class="linenos">1640</span></a>
</span><span id="L-1641"><a href="#-1641"><span class="linenos">1641</span></a>        <span class="c1"># Re-apply old gaps to improved depth_maps</span>
</span><span id="L-1642"><a href="#-1642"><span class="linenos">1642</span></a>        <span class="n">zmaps_imp</span> <span class="o">=</span> <span class="n">faulted_depth_maps</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-1643"><a href="#-1643"><span class="linenos">1643</span></a>        <span class="n">merged</span> <span class="o">=</span> <span class="n">zmaps_imp</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-1644"><a href="#-1644"><span class="linenos">1644</span></a>        <span class="n">_depth_maps_gaps_improved</span> <span class="o">=</span> <span class="n">merged</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-1645"><a href="#-1645"><span class="linenos">1645</span></a>        <span class="n">_depth_maps_gaps_improved</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faulted_depth_maps_gaps</span><span class="p">)]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
</span><span id="L-1646"><a href="#-1646"><span class="linenos">1646</span></a>        <span class="n">depth_maps_gaps</span> <span class="o">=</span> <span class="n">_depth_maps_gaps_improved</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-1647"><a href="#-1647"><span class="linenos">1647</span></a>
</span><span id="L-1648"><a href="#-1648"><span class="linenos">1648</span></a>        <span class="c1"># for zero-thickness layers, set depth_maps_gaps to nan</span>
</span><span id="L-1649"><a href="#-1649"><span class="linenos">1649</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">depth_maps_gaps</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="L-1650"><a href="#-1650"><span class="linenos">1650</span></a>            <span class="n">thickness_map</span> <span class="o">=</span> <span class="n">depth_maps_gaps</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">depth_maps_gaps</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">i</span><span class="p">]</span>
</span><span id="L-1651"><a href="#-1651"><span class="linenos">1651</span></a>            <span class="c1"># set thicknesses &lt; zero to NaN. Use NaNs in thickness_map to 0 to avoid runtime warning when indexing</span>
</span><span id="L-1652"><a href="#-1652"><span class="linenos">1652</span></a>            <span class="n">depth_maps_gaps</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">i</span><span class="p">][</span><span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">thickness_map</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
</span><span id="L-1653"><a href="#-1653"><span class="linenos">1653</span></a>
</span><span id="L-1654"><a href="#-1654"><span class="linenos">1654</span></a>        <span class="c1"># restore zero thickness from faulted horizons to improved (interpolated) depth maps</span>
</span><span id="L-1655"><a href="#-1655"><span class="linenos">1655</span></a>        <span class="n">ii</span><span class="p">,</span> <span class="n">jj</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span>
</span><span id="L-1656"><a href="#-1656"><span class="linenos">1656</span></a>            <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
</span><span id="L-1657"><a href="#-1657"><span class="linenos">1657</span></a>            <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
</span><span id="L-1658"><a href="#-1658"><span class="linenos">1658</span></a>            <span class="n">sparse</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="L-1659"><a href="#-1659"><span class="linenos">1659</span></a>            <span class="n">indexing</span><span class="o">=</span><span class="s2">&quot;ij&quot;</span><span class="p">,</span>
</span><span id="L-1660"><a href="#-1660"><span class="linenos">1660</span></a>        <span class="p">)</span>
</span><span id="L-1661"><a href="#-1661"><span class="linenos">1661</span></a>        <span class="n">merged</span> <span class="o">=</span> <span class="n">zmaps_imp</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-1662"><a href="#-1662"><span class="linenos">1662</span></a>
</span><span id="L-1663"><a href="#-1663"><span class="linenos">1663</span></a>        <span class="c1"># create temporary copy of fault_segments with dilation</span>
</span><span id="L-1664"><a href="#-1664"><span class="linenos">1664</span></a>        <span class="kn">from</span> <span class="nn">scipy.ndimage.morphology</span> <span class="kn">import</span> <span class="n">grey_dilation</span>
</span><span id="L-1665"><a href="#-1665"><span class="linenos">1665</span></a>
</span><span id="L-1666"><a href="#-1666"><span class="linenos">1666</span></a>        <span class="n">_dilated_fault_planes</span> <span class="o">=</span> <span class="n">grey_dilation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fault_planes</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</span><span id="L-1667"><a href="#-1667"><span class="linenos">1667</span></a>
</span><span id="L-1668"><a href="#-1668"><span class="linenos">1668</span></a>        <span class="n">_onlap_segments</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">onlap_segments</span><span class="p">[:]</span>
</span><span id="L-1669"><a href="#-1669"><span class="linenos">1669</span></a>        <span class="k">for</span> <span class="n">ihor</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">depth_maps_gaps</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
</span><span id="L-1670"><a href="#-1670"><span class="linenos">1670</span></a>            <span class="c1"># filter upper horizon being used for thickness if shallower events onlap it, except at faults</span>
</span><span id="L-1671"><a href="#-1671"><span class="linenos">1671</span></a>            <span class="n">improved_zmap_thickness</span> <span class="o">=</span> <span class="n">merged</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">ihor</span><span class="p">]</span> <span class="o">-</span> <span class="n">merged</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">ihor</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="L-1672"><a href="#-1672"><span class="linenos">1672</span></a>            <span class="n">depth_map_int</span> <span class="o">=</span> <span class="p">((</span><span class="n">merged</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">ihor</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">))</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span>
</span><span id="L-1673"><a href="#-1673"><span class="linenos">1673</span></a>                <span class="mi">0</span><span class="p">,</span> <span class="n">_onlap_segments</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>
</span><span id="L-1674"><a href="#-1674"><span class="linenos">1674</span></a>            <span class="p">)</span>
</span><span id="L-1675"><a href="#-1675"><span class="linenos">1675</span></a>            <span class="n">improved_map_onlap_segments</span> <span class="o">=</span> <span class="n">_onlap_segments</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span> <span class="n">jj</span><span class="p">,</span> <span class="n">depth_map_int</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.0</span>
</span><span id="L-1676"><a href="#-1676"><span class="linenos">1676</span></a>            <span class="n">improved_map_fault_segments</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-1677"><a href="#-1677"><span class="linenos">1677</span></a>                <span class="n">_dilated_fault_planes</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span> <span class="n">jj</span><span class="p">,</span> <span class="n">depth_map_int</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.0</span>
</span><span id="L-1678"><a href="#-1678"><span class="linenos">1678</span></a>            <span class="p">)</span>
</span><span id="L-1679"><a href="#-1679"><span class="linenos">1679</span></a>            <span class="c1"># remember that self.maps.depth_maps has horizons with direct fault application</span>
</span><span id="L-1680"><a href="#-1680"><span class="linenos">1680</span></a>            <span class="n">faulted_infilled_map_thickness</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-1681"><a href="#-1681"><span class="linenos">1681</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">faulted_depth_maps</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">ihor</span><span class="p">]</span>
</span><span id="L-1682"><a href="#-1682"><span class="linenos">1682</span></a>                <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">faulted_depth_maps</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">ihor</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="L-1683"><a href="#-1683"><span class="linenos">1683</span></a>            <span class="p">)</span>
</span><span id="L-1684"><a href="#-1684"><span class="linenos">1684</span></a>            <span class="n">improved_zmap_thickness</span><span class="p">[</span>
</span><span id="L-1685"><a href="#-1685"><span class="linenos">1685</span></a>                <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
</span><span id="L-1686"><a href="#-1686"><span class="linenos">1686</span></a>                    <span class="p">(</span><span class="n">faulted_infilled_map_thickness</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">)</span>
</span><span id="L-1687"><a href="#-1687"><span class="linenos">1687</span></a>                    <span class="o">&amp;</span> <span class="p">(</span><span class="n">improved_map_onlap_segments</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">)</span>
</span><span id="L-1688"><a href="#-1688"><span class="linenos">1688</span></a>                    <span class="o">&amp;</span> <span class="p">(</span><span class="n">improved_map_fault_segments</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">)</span>
</span><span id="L-1689"><a href="#-1689"><span class="linenos">1689</span></a>                <span class="p">)</span>
</span><span id="L-1690"><a href="#-1690"><span class="linenos">1690</span></a>            <span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="L-1691"><a href="#-1691"><span class="linenos">1691</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="L-1692"><a href="#-1692"><span class="linenos">1692</span></a>                <span class="s2">&quot; ... ihor, improved_map_onlap_segments[improved_map_onlap_segments&gt;0.].shape,&quot;</span>
</span><span id="L-1693"><a href="#-1693"><span class="linenos">1693</span></a>                <span class="s2">&quot; improved_zmap_thickness[improved_zmap_thickness==0].shape = &quot;</span><span class="p">,</span>
</span><span id="L-1694"><a href="#-1694"><span class="linenos">1694</span></a>                <span class="n">ihor</span><span class="p">,</span>
</span><span id="L-1695"><a href="#-1695"><span class="linenos">1695</span></a>                <span class="n">improved_map_onlap_segments</span><span class="p">[</span><span class="n">improved_map_onlap_segments</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
</span><span id="L-1696"><a href="#-1696"><span class="linenos">1696</span></a>                <span class="n">improved_zmap_thickness</span><span class="p">[</span><span class="n">improved_zmap_thickness</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
</span><span id="L-1697"><a href="#-1697"><span class="linenos">1697</span></a>            <span class="p">)</span>
</span><span id="L-1698"><a href="#-1698"><span class="linenos">1698</span></a>            <span class="n">merged</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">ihor</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">merged</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">ihor</span><span class="p">]</span> <span class="o">-</span> <span class="n">improved_zmap_thickness</span>
</span><span id="L-1699"><a href="#-1699"><span class="linenos">1699</span></a>
</span><span id="L-1700"><a href="#-1700"><span class="linenos">1700</span></a>        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fan_horizon_list</span><span class="p">):</span>
</span><span id="L-1701"><a href="#-1701"><span class="linenos">1701</span></a>            <span class="c1"># Clip fans downwards when thickness map is zero</span>
</span><span id="L-1702"><a href="#-1702"><span class="linenos">1702</span></a>            <span class="k">for</span> <span class="n">count</span><span class="p">,</span> <span class="n">layer</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fan_horizon_list</span><span class="p">):</span>
</span><span id="L-1703"><a href="#-1703"><span class="linenos">1703</span></a>                <span class="n">merged</span> <span class="o">=</span> <span class="n">fix_zero_thickness_fan_layers</span><span class="p">(</span>
</span><span id="L-1704"><a href="#-1704"><span class="linenos">1704</span></a>                    <span class="n">merged</span><span class="p">,</span> <span class="n">layer</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fan_thickness</span><span class="p">[</span><span class="n">count</span><span class="p">]</span>
</span><span id="L-1705"><a href="#-1705"><span class="linenos">1705</span></a>                <span class="p">)</span>
</span><span id="L-1706"><a href="#-1706"><span class="linenos">1706</span></a>
</span><span id="L-1707"><a href="#-1707"><span class="linenos">1707</span></a>        <span class="c1"># Re-apply clipping to onlapping layers post faulting</span>
</span><span id="L-1708"><a href="#-1708"><span class="linenos">1708</span></a>        <span class="n">merged</span> <span class="o">=</span> <span class="n">fix_zero_thickness_onlap_layers</span><span class="p">(</span><span class="n">merged</span><span class="p">,</span> <span class="n">onlap_clips</span><span class="p">)</span>
</span><span id="L-1709"><a href="#-1709"><span class="linenos">1709</span></a>
</span><span id="L-1710"><a href="#-1710"><span class="linenos">1710</span></a>        <span class="k">del</span> <span class="n">_dilated_fault_planes</span>
</span><span id="L-1711"><a href="#-1711"><span class="linenos">1711</span></a>
</span><span id="L-1712"><a href="#-1712"><span class="linenos">1712</span></a>        <span class="c1"># Re-apply gaps to improved depth_maps</span>
</span><span id="L-1713"><a href="#-1713"><span class="linenos">1713</span></a>        <span class="n">_depth_maps_gaps_improved</span> <span class="o">=</span> <span class="n">merged</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-1714"><a href="#-1714"><span class="linenos">1714</span></a>        <span class="n">_depth_maps_gaps_improved</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faulted_depth_maps_gaps</span><span class="p">)]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
</span><span id="L-1715"><a href="#-1715"><span class="linenos">1715</span></a>        <span class="n">depth_maps_gaps</span> <span class="o">=</span> <span class="n">_depth_maps_gaps_improved</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-1716"><a href="#-1716"><span class="linenos">1716</span></a>
</span><span id="L-1717"><a href="#-1717"><span class="linenos">1717</span></a>        <span class="c1"># for zero-thickness layers, set depth_maps_gaps to nan</span>
</span><span id="L-1718"><a href="#-1718"><span class="linenos">1718</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">depth_maps_gaps</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="L-1719"><a href="#-1719"><span class="linenos">1719</span></a>            <span class="n">thickness_map</span> <span class="o">=</span> <span class="n">depth_maps_gaps</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">depth_maps_gaps</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">i</span><span class="p">]</span>
</span><span id="L-1720"><a href="#-1720"><span class="linenos">1720</span></a>            <span class="c1"># set nans in thickness_map to 0 to avoid runtime warning</span>
</span><span id="L-1721"><a href="#-1721"><span class="linenos">1721</span></a>            <span class="n">depth_maps_gaps</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">i</span><span class="p">][</span><span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">thickness_map</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
</span><span id="L-1722"><a href="#-1722"><span class="linenos">1722</span></a>
</span><span id="L-1723"><a href="#-1723"><span class="linenos">1723</span></a>        <span class="k">return</span> <span class="n">merged</span><span class="p">,</span> <span class="n">depth_maps_gaps</span>
</span><span id="L-1724"><a href="#-1724"><span class="linenos">1724</span></a>
</span><span id="L-1725"><a href="#-1725"><span class="linenos">1725</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-1726"><a href="#-1726"><span class="linenos">1726</span></a>    <span class="k">def</span> <span class="nf">partial_faulting</span><span class="p">(</span>
</span><span id="L-1727"><a href="#-1727"><span class="linenos">1727</span></a>        <span class="n">depth_map_gaps_faulted</span><span class="p">,</span>
</span><span id="L-1728"><a href="#-1728"><span class="linenos">1728</span></a>        <span class="n">fault_plane_classification</span><span class="p">,</span>
</span><span id="L-1729"><a href="#-1729"><span class="linenos">1729</span></a>        <span class="n">faulted_depth_map</span><span class="p">,</span>
</span><span id="L-1730"><a href="#-1730"><span class="linenos">1730</span></a>        <span class="n">ii</span><span class="p">,</span>
</span><span id="L-1731"><a href="#-1731"><span class="linenos">1731</span></a>        <span class="n">jj</span><span class="p">,</span>
</span><span id="L-1732"><a href="#-1732"><span class="linenos">1732</span></a>        <span class="n">max_throw</span><span class="p">,</span>
</span><span id="L-1733"><a href="#-1733"><span class="linenos">1733</span></a>        <span class="n">origtime_cube</span><span class="p">,</span>
</span><span id="L-1734"><a href="#-1734"><span class="linenos">1734</span></a>        <span class="n">unfaulted_depth_map</span><span class="p">,</span>
</span><span id="L-1735"><a href="#-1735"><span class="linenos">1735</span></a>    <span class="p">):</span>
</span><span id="L-1736"><a href="#-1736"><span class="linenos">1736</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1737"><a href="#-1737"><span class="linenos">1737</span></a><span class="sd">        Partial faulting</span>
</span><span id="L-1738"><a href="#-1738"><span class="linenos">1738</span></a><span class="sd">        ----------------</span>
</span><span id="L-1739"><a href="#-1739"><span class="linenos">1739</span></a>
</span><span id="L-1740"><a href="#-1740"><span class="linenos">1740</span></a><span class="sd">        Executes partial faluting.</span>
</span><span id="L-1741"><a href="#-1741"><span class="linenos">1741</span></a>
</span><span id="L-1742"><a href="#-1742"><span class="linenos">1742</span></a><span class="sd">        The docstring of this function is a work in progress.</span>
</span><span id="L-1743"><a href="#-1743"><span class="linenos">1743</span></a>
</span><span id="L-1744"><a href="#-1744"><span class="linenos">1744</span></a><span class="sd">        Parameters</span>
</span><span id="L-1745"><a href="#-1745"><span class="linenos">1745</span></a><span class="sd">        ----------</span>
</span><span id="L-1746"><a href="#-1746"><span class="linenos">1746</span></a><span class="sd">        depth_map_gaps_faulted : np.ndarray</span>
</span><span id="L-1747"><a href="#-1747"><span class="linenos">1747</span></a><span class="sd">            The depth map.</span>
</span><span id="L-1748"><a href="#-1748"><span class="linenos">1748</span></a><span class="sd">        fault_plane_classification : np.ndarray</span>
</span><span id="L-1749"><a href="#-1749"><span class="linenos">1749</span></a><span class="sd">            Fault plane classifications.</span>
</span><span id="L-1750"><a href="#-1750"><span class="linenos">1750</span></a><span class="sd">        faulted_depth_map : _type_</span>
</span><span id="L-1751"><a href="#-1751"><span class="linenos">1751</span></a><span class="sd">            The faulted depth map.</span>
</span><span id="L-1752"><a href="#-1752"><span class="linenos">1752</span></a><span class="sd">        ii : int</span>
</span><span id="L-1753"><a href="#-1753"><span class="linenos">1753</span></a><span class="sd">            The i position</span>
</span><span id="L-1754"><a href="#-1754"><span class="linenos">1754</span></a><span class="sd">        jj : int</span>
</span><span id="L-1755"><a href="#-1755"><span class="linenos">1755</span></a><span class="sd">            The j position</span>
</span><span id="L-1756"><a href="#-1756"><span class="linenos">1756</span></a><span class="sd">        max_throw : float</span>
</span><span id="L-1757"><a href="#-1757"><span class="linenos">1757</span></a><span class="sd">            The maximum amount of throw for the faults.</span>
</span><span id="L-1758"><a href="#-1758"><span class="linenos">1758</span></a><span class="sd">        origtime_cube : np.ndarray</span>
</span><span id="L-1759"><a href="#-1759"><span class="linenos">1759</span></a><span class="sd">            Original time cube.</span>
</span><span id="L-1760"><a href="#-1760"><span class="linenos">1760</span></a><span class="sd">        unfaulted_depth_map : np.ndarray</span>
</span><span id="L-1761"><a href="#-1761"><span class="linenos">1761</span></a><span class="sd">            Unfaulted depth map.</span>
</span><span id="L-1762"><a href="#-1762"><span class="linenos">1762</span></a>
</span><span id="L-1763"><a href="#-1763"><span class="linenos">1763</span></a><span class="sd">        Returns</span>
</span><span id="L-1764"><a href="#-1764"><span class="linenos">1764</span></a><span class="sd">        -------</span>
</span><span id="L-1765"><a href="#-1765"><span class="linenos">1765</span></a><span class="sd">        faulted_depth_map : np.ndarray</span>
</span><span id="L-1766"><a href="#-1766"><span class="linenos">1766</span></a><span class="sd">            The faulted depth map</span>
</span><span id="L-1767"><a href="#-1767"><span class="linenos">1767</span></a><span class="sd">        depth_map_gaps_faulted : np.ndarray</span>
</span><span id="L-1768"><a href="#-1768"><span class="linenos">1768</span></a><span class="sd">            Depth map with gaps filled</span>
</span><span id="L-1769"><a href="#-1769"><span class="linenos">1769</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1770"><a href="#-1770"><span class="linenos">1770</span></a>        <span class="k">for</span> <span class="n">ithrow</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">max_throw</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="L-1771"><a href="#-1771"><span class="linenos">1771</span></a>            <span class="c1"># infilled</span>
</span><span id="L-1772"><a href="#-1772"><span class="linenos">1772</span></a>            <span class="n">partial_faulting_map</span> <span class="o">=</span> <span class="n">unfaulted_depth_map</span> <span class="o">+</span> <span class="n">ithrow</span>
</span><span id="L-1773"><a href="#-1773"><span class="linenos">1773</span></a>            <span class="n">partial_faulting_map_ii_jj</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-1774"><a href="#-1774"><span class="linenos">1774</span></a>                <span class="n">partial_faulting_map</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span> <span class="n">jj</span><span class="p">]</span>
</span><span id="L-1775"><a href="#-1775"><span class="linenos">1775</span></a>                <span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;int&quot;</span><span class="p">)</span>
</span><span id="L-1776"><a href="#-1776"><span class="linenos">1776</span></a>                <span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">origtime_cube</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-1777"><a href="#-1777"><span class="linenos">1777</span></a>            <span class="p">)</span>
</span><span id="L-1778"><a href="#-1778"><span class="linenos">1778</span></a>            <span class="n">partial_faulting_on_horizon</span> <span class="o">=</span> <span class="n">fault_plane_classification</span><span class="p">[</span>
</span><span id="L-1779"><a href="#-1779"><span class="linenos">1779</span></a>                <span class="n">ii</span><span class="p">,</span> <span class="n">jj</span><span class="p">,</span> <span class="n">partial_faulting_map_ii_jj</span>
</span><span id="L-1780"><a href="#-1780"><span class="linenos">1780</span></a>            <span class="p">][</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
</span><span id="L-1781"><a href="#-1781"><span class="linenos">1781</span></a>            <span class="n">origtime_on_horizon</span> <span class="o">=</span> <span class="n">origtime_cube</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span> <span class="n">jj</span><span class="p">,</span> <span class="n">partial_faulting_map_ii_jj</span><span class="p">][</span>
</span><span id="L-1782"><a href="#-1782"><span class="linenos">1782</span></a>                <span class="o">...</span><span class="p">,</span> <span class="mi">0</span>
</span><span id="L-1783"><a href="#-1783"><span class="linenos">1783</span></a>            <span class="p">]</span>
</span><span id="L-1784"><a href="#-1784"><span class="linenos">1784</span></a>            <span class="n">faulted_depth_map</span><span class="p">[</span><span class="n">partial_faulting_on_horizon</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dstack</span><span class="p">(</span>
</span><span id="L-1785"><a href="#-1785"><span class="linenos">1785</span></a>                <span class="p">(</span><span class="n">origtime_on_horizon</span><span class="p">,</span> <span class="n">partial_faulting_map</span><span class="p">)</span>
</span><span id="L-1786"><a href="#-1786"><span class="linenos">1786</span></a>            <span class="p">)</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)[</span><span class="n">partial_faulting_on_horizon</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="L-1787"><a href="#-1787"><span class="linenos">1787</span></a>            <span class="c1"># gaps</span>
</span><span id="L-1788"><a href="#-1788"><span class="linenos">1788</span></a>            <span class="n">depth_map_gaps_faulted</span><span class="p">[</span><span class="n">partial_faulting_on_horizon</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
</span><span id="L-1789"><a href="#-1789"><span class="linenos">1789</span></a>        <span class="k">return</span> <span class="n">faulted_depth_map</span><span class="p">,</span> <span class="n">depth_map_gaps_faulted</span>
</span><span id="L-1790"><a href="#-1790"><span class="linenos">1790</span></a>
</span><span id="L-1791"><a href="#-1791"><span class="linenos">1791</span></a>    <span class="k">def</span> <span class="nf">get_displacement_vector</span><span class="p">(</span>
</span><span id="L-1792"><a href="#-1792"><span class="linenos">1792</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-1793"><a href="#-1793"><span class="linenos">1793</span></a>        <span class="n">semi_axes</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">,</span>
</span><span id="L-1794"><a href="#-1794"><span class="linenos">1794</span></a>        <span class="n">origin</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">,</span>
</span><span id="L-1795"><a href="#-1795"><span class="linenos">1795</span></a>        <span class="n">throw</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
</span><span id="L-1796"><a href="#-1796"><span class="linenos">1796</span></a>        <span class="n">tilt</span><span class="p">,</span>
</span><span id="L-1797"><a href="#-1797"><span class="linenos">1797</span></a>        <span class="n">wb</span><span class="p">,</span>
</span><span id="L-1798"><a href="#-1798"><span class="linenos">1798</span></a>        <span class="n">index</span><span class="p">,</span>
</span><span id="L-1799"><a href="#-1799"><span class="linenos">1799</span></a>        <span class="n">fp</span>
</span><span id="L-1800"><a href="#-1800"><span class="linenos">1800</span></a>    <span class="p">):</span>
</span><span id="L-1801"><a href="#-1801"><span class="linenos">1801</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1802"><a href="#-1802"><span class="linenos">1802</span></a><span class="sd">        Gets a displacement vector.</span>
</span><span id="L-1803"><a href="#-1803"><span class="linenos">1803</span></a>
</span><span id="L-1804"><a href="#-1804"><span class="linenos">1804</span></a><span class="sd">        Parameters</span>
</span><span id="L-1805"><a href="#-1805"><span class="linenos">1805</span></a><span class="sd">        ----------</span>
</span><span id="L-1806"><a href="#-1806"><span class="linenos">1806</span></a><span class="sd">        semi_axes : tuple</span>
</span><span id="L-1807"><a href="#-1807"><span class="linenos">1807</span></a><span class="sd">            The semi axes.</span>
</span><span id="L-1808"><a href="#-1808"><span class="linenos">1808</span></a><span class="sd">        origin : tuple</span>
</span><span id="L-1809"><a href="#-1809"><span class="linenos">1809</span></a><span class="sd">            The origin.</span>
</span><span id="L-1810"><a href="#-1810"><span class="linenos">1810</span></a><span class="sd">        throw : float</span>
</span><span id="L-1811"><a href="#-1811"><span class="linenos">1811</span></a><span class="sd">            The throw of th fault to use.</span>
</span><span id="L-1812"><a href="#-1812"><span class="linenos">1812</span></a><span class="sd">        tilt : float</span>
</span><span id="L-1813"><a href="#-1813"><span class="linenos">1813</span></a><span class="sd">            The tilt of the fault.</span>
</span><span id="L-1814"><a href="#-1814"><span class="linenos">1814</span></a><span class="sd">        </span>
</span><span id="L-1815"><a href="#-1815"><span class="linenos">1815</span></a><span class="sd">        Returns</span>
</span><span id="L-1816"><a href="#-1816"><span class="linenos">1816</span></a><span class="sd">        -------</span>
</span><span id="L-1817"><a href="#-1817"><span class="linenos">1817</span></a><span class="sd">        stretch_times : np.ndarray</span>
</span><span id="L-1818"><a href="#-1818"><span class="linenos">1818</span></a><span class="sd">            The stretch times.</span>
</span><span id="L-1819"><a href="#-1819"><span class="linenos">1819</span></a><span class="sd">        stretch_times_classification : np.ndarray</span>
</span><span id="L-1820"><a href="#-1820"><span class="linenos">1820</span></a><span class="sd">            Stretch times classification.</span>
</span><span id="L-1821"><a href="#-1821"><span class="linenos">1821</span></a><span class="sd">        interpolation : bool</span>
</span><span id="L-1822"><a href="#-1822"><span class="linenos">1822</span></a><span class="sd">            Whether or not to interpolate.</span>
</span><span id="L-1823"><a href="#-1823"><span class="linenos">1823</span></a><span class="sd">        hockey_stick : int</span>
</span><span id="L-1824"><a href="#-1824"><span class="linenos">1824</span></a><span class="sd">            The hockey stick.</span>
</span><span id="L-1825"><a href="#-1825"><span class="linenos">1825</span></a><span class="sd">        fault_segments : np.ndarray</span>
</span><span id="L-1826"><a href="#-1826"><span class="linenos">1826</span></a>
</span><span id="L-1827"><a href="#-1827"><span class="linenos">1827</span></a><span class="sd">        ellipsoid : </span>
</span><span id="L-1828"><a href="#-1828"><span class="linenos">1828</span></a><span class="sd">        fp : </span>
</span><span id="L-1829"><a href="#-1829"><span class="linenos">1829</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1830"><a href="#-1830"><span class="linenos">1830</span></a>        <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">semi_axes</span>
</span><span id="L-1831"><a href="#-1831"><span class="linenos">1831</span></a>        <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">z0</span> <span class="o">=</span> <span class="n">origin</span>
</span><span id="L-1832"><a href="#-1832"><span class="linenos">1832</span></a>
</span><span id="L-1833"><a href="#-1833"><span class="linenos">1833</span></a>        <span class="n">random_shear_zone_width</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-1834"><a href="#-1834"><span class="linenos">1834</span></a>            <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="mf">0.75</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span> <span class="o">*</span> <span class="mi">200</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">200</span>
</span><span id="L-1835"><a href="#-1835"><span class="linenos">1835</span></a>        <span class="p">)</span>
</span><span id="L-1836"><a href="#-1836"><span class="linenos">1836</span></a>        <span class="k">if</span> <span class="n">random_shear_zone_width</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-1837"><a href="#-1837"><span class="linenos">1837</span></a>            <span class="n">random_gouge_pctile</span> <span class="o">=</span> <span class="mi">100</span>
</span><span id="L-1838"><a href="#-1838"><span class="linenos">1838</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1839"><a href="#-1839"><span class="linenos">1839</span></a>            <span class="c1"># clip amplitudes inside shear_zone with this percentile of total (100 implies doing nothing)</span>
</span><span id="L-1840"><a href="#-1840"><span class="linenos">1840</span></a>            <span class="n">random_gouge_pctile</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">triangular</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
</span><span id="L-1841"><a href="#-1841"><span class="linenos">1841</span></a>        <span class="c1"># Store the random values</span>
</span><span id="L-1842"><a href="#-1842"><span class="linenos">1842</span></a>        <span class="n">fp</span><span class="p">[</span><span class="s2">&quot;shear_zone_width&quot;</span><span class="p">][</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">random_shear_zone_width</span>
</span><span id="L-1843"><a href="#-1843"><span class="linenos">1843</span></a>        <span class="n">fp</span><span class="p">[</span><span class="s2">&quot;gouge_pctile&quot;</span><span class="p">][</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">random_gouge_pctile</span>
</span><span id="L-1844"><a href="#-1844"><span class="linenos">1844</span></a>
</span><span id="L-1845"><a href="#-1845"><span class="linenos">1845</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="L-1846"><a href="#-1846"><span class="linenos">1846</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   ...shear_zone_width (samples) = </span><span class="si">{</span><span class="n">random_shear_zone_width</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1847"><a href="#-1847"><span class="linenos">1847</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   ...gouge_pctile (percent*100) = </span><span class="si">{</span><span class="n">random_gouge_pctile</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1848"><a href="#-1848"><span class="linenos">1848</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   .... output_cube.shape = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">geologic_age</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1849"><a href="#-1849"><span class="linenos">1849</span></a>            <span class="n">_p</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-1850"><a href="#-1850"><span class="linenos">1850</span></a>                <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">geologic_age</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">infill_factor</span>
</span><span id="L-1851"><a href="#-1851"><span class="linenos">1851</span></a>            <span class="p">)</span><span class="o">.</span><span class="n">shape</span>
</span><span id="L-1852"><a href="#-1852"><span class="linenos">1852</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="L-1853"><a href="#-1853"><span class="linenos">1853</span></a>                <span class="sa">f</span><span class="s2">&quot;   .... (np.arange(output_cube.shape[2])*infill_factor).shape = </span><span class="si">{</span><span class="n">_p</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-1854"><a href="#-1854"><span class="linenos">1854</span></a>            <span class="p">)</span>
</span><span id="L-1855"><a href="#-1855"><span class="linenos">1855</span></a>
</span><span id="L-1856"><a href="#-1856"><span class="linenos">1856</span></a>        <span class="n">ellipsoid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rotate_3d_ellipsoid</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">z0</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">tilt</span><span class="p">)</span>
</span><span id="L-1857"><a href="#-1857"><span class="linenos">1857</span></a>        <span class="n">fault_segments</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_fault_plane_sobel</span><span class="p">(</span><span class="n">ellipsoid</span><span class="p">)</span>
</span><span id="L-1858"><a href="#-1858"><span class="linenos">1858</span></a>        <span class="n">z_idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_fault_centre</span><span class="p">(</span><span class="n">ellipsoid</span><span class="p">,</span> <span class="n">wb</span><span class="p">,</span> <span class="n">fault_segments</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>
</span><span id="L-1859"><a href="#-1859"><span class="linenos">1859</span></a>
</span><span id="L-1860"><a href="#-1860"><span class="linenos">1860</span></a>        <span class="c1"># Initialise return objects in case z_idx size == 0</span>
</span><span id="L-1861"><a href="#-1861"><span class="linenos">1861</span></a>        <span class="n">interpolation</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-1862"><a href="#-1862"><span class="linenos">1862</span></a>        <span class="n">hockey_stick</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-1863"><a href="#-1863"><span class="linenos">1863</span></a>        <span class="c1"># displacement_cube = None</span>
</span><span id="L-1864"><a href="#-1864"><span class="linenos">1864</span></a>        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">z_idx</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-1865"><a href="#-1865"><span class="linenos">1865</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    ... Computing fault depth at max displacement&quot;</span><span class="p">)</span>
</span><span id="L-1866"><a href="#-1866"><span class="linenos">1866</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    ... depth at max displacement  = </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">z_idx</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
</span><span id="L-1867"><a href="#-1867"><span class="linenos">1867</span></a>            <span class="n">down</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">ellipsoid</span><span class="p">[</span><span class="n">ellipsoid</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span>
</span><span id="L-1868"><a href="#-1868"><span class="linenos">1868</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">geologic_age</span><span class="p">[:]</span><span class="o">.</span><span class="n">shape</span>
</span><span id="L-1869"><a href="#-1869"><span class="linenos">1869</span></a>            <span class="p">)</span>
</span><span id="L-1870"><a href="#-1870"><span class="linenos">1870</span></a>            <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1871"><a href="#-1871"><span class="linenos">1871</span></a><span class="sd">            down = np.int16(len(np.where(ellipsoid &lt; 1.)[0]) / 1.0 * (self.vols.geologic_age.shape[2] *</span>
</span><span id="L-1872"><a href="#-1872"><span class="linenos">1872</span></a><span class="sd">                                                                      self.vols.geologic_age.shape[1] *</span>
</span><span id="L-1873"><a href="#-1873"><span class="linenos">1873</span></a><span class="sd">                                                                      self.vols.geologic_age.shape[0]))</span>
</span><span id="L-1874"><a href="#-1874"><span class="linenos">1874</span></a><span class="sd">            print(&quot;    ... This fault has {!s} %% of downthrown samples&quot;.format(down))</span>
</span><span id="L-1875"><a href="#-1875"><span class="linenos">1875</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="L-1876"><a href="#-1876"><span class="linenos">1876</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="L-1877"><a href="#-1877"><span class="linenos">1877</span></a>                <span class="s2">&quot;    ... This fault has &quot;</span>
</span><span id="L-1878"><a href="#-1878"><span class="linenos">1878</span></a>                <span class="o">+</span> <span class="nb">format</span><span class="p">(</span><span class="n">down</span><span class="p">,</span> <span class="s2">&quot;5.1%&quot;</span><span class="p">)</span>
</span><span id="L-1879"><a href="#-1879"><span class="linenos">1879</span></a>                <span class="o">+</span> <span class="s2">&quot; of downthrown samples&quot;</span>
</span><span id="L-1880"><a href="#-1880"><span class="linenos">1880</span></a>            <span class="p">)</span>
</span><span id="L-1881"><a href="#-1881"><span class="linenos">1881</span></a>
</span><span id="L-1882"><a href="#-1882"><span class="linenos">1882</span></a>            <span class="p">(</span>
</span><span id="L-1883"><a href="#-1883"><span class="linenos">1883</span></a>                <span class="n">stretch_times</span><span class="p">,</span>
</span><span id="L-1884"><a href="#-1884"><span class="linenos">1884</span></a>                <span class="n">stretch_times_classification</span><span class="p">,</span>
</span><span id="L-1885"><a href="#-1885"><span class="linenos">1885</span></a>                <span class="n">interpolation</span><span class="p">,</span>
</span><span id="L-1886"><a href="#-1886"><span class="linenos">1886</span></a>                <span class="n">hockey_stick</span><span class="p">,</span>
</span><span id="L-1887"><a href="#-1887"><span class="linenos">1887</span></a>            <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xyz_dis</span><span class="p">(</span><span class="n">z_idx</span><span class="p">,</span> <span class="n">throw</span><span class="p">,</span> <span class="n">fault_segments</span><span class="p">,</span> <span class="n">ellipsoid</span><span class="p">,</span> <span class="n">wb</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>
</span><span id="L-1888"><a href="#-1888"><span class="linenos">1888</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1889"><a href="#-1889"><span class="linenos">1889</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  ... Ellipsoid larger than cube no fault inserted&quot;</span><span class="p">)</span>
</span><span id="L-1890"><a href="#-1890"><span class="linenos">1890</span></a>            <span class="n">stretch_times</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">ellipsoid</span><span class="p">)</span>
</span><span id="L-1891"><a href="#-1891"><span class="linenos">1891</span></a>            <span class="n">stretch_times_classification</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">geologic_age</span><span class="p">[:])</span>
</span><span id="L-1892"><a href="#-1892"><span class="linenos">1892</span></a>
</span><span id="L-1893"><a href="#-1893"><span class="linenos">1893</span></a>        <span class="n">max_fault_throw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_fault_throw</span><span class="p">[:]</span>
</span><span id="L-1894"><a href="#-1894"><span class="linenos">1894</span></a>        <span class="n">max_fault_throw</span><span class="p">[</span><span class="n">ellipsoid</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="n">throw</span><span class="p">)</span>
</span><span id="L-1895"><a href="#-1895"><span class="linenos">1895</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">max_fault_throw</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">max_fault_throw</span>
</span><span id="L-1896"><a href="#-1896"><span class="linenos">1896</span></a>
</span><span id="L-1897"><a href="#-1897"><span class="linenos">1897</span></a>        <span class="k">return</span> <span class="p">(</span>
</span><span id="L-1898"><a href="#-1898"><span class="linenos">1898</span></a>            <span class="n">stretch_times</span><span class="p">,</span>
</span><span id="L-1899"><a href="#-1899"><span class="linenos">1899</span></a>            <span class="n">stretch_times_classification</span><span class="p">,</span>
</span><span id="L-1900"><a href="#-1900"><span class="linenos">1900</span></a>            <span class="n">interpolation</span><span class="p">,</span>
</span><span id="L-1901"><a href="#-1901"><span class="linenos">1901</span></a>            <span class="n">hockey_stick</span><span class="p">,</span>
</span><span id="L-1902"><a href="#-1902"><span class="linenos">1902</span></a>            <span class="n">fault_segments</span><span class="p">,</span>
</span><span id="L-1903"><a href="#-1903"><span class="linenos">1903</span></a>            <span class="n">ellipsoid</span><span class="p">,</span>
</span><span id="L-1904"><a href="#-1904"><span class="linenos">1904</span></a>            <span class="n">fp</span><span class="p">,</span>
</span><span id="L-1905"><a href="#-1905"><span class="linenos">1905</span></a>        <span class="p">)</span>
</span><span id="L-1906"><a href="#-1906"><span class="linenos">1906</span></a>
</span><span id="L-1907"><a href="#-1907"><span class="linenos">1907</span></a>    <span class="k">def</span> <span class="nf">apply_xyz_displacement</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">traces</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="L-1908"><a href="#-1908"><span class="linenos">1908</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1909"><a href="#-1909"><span class="linenos">1909</span></a><span class="sd">        Applies XYZ Displacement.</span>
</span><span id="L-1910"><a href="#-1910"><span class="linenos">1910</span></a><span class="sd">        </span>
</span><span id="L-1911"><a href="#-1911"><span class="linenos">1911</span></a><span class="sd">        Apply stretching and squeezing previously applied to the input cube</span>
</span><span id="L-1912"><a href="#-1912"><span class="linenos">1912</span></a><span class="sd">        vertically to give all depths the same number of extrema.</span>
</span><span id="L-1913"><a href="#-1913"><span class="linenos">1913</span></a>
</span><span id="L-1914"><a href="#-1914"><span class="linenos">1914</span></a><span class="sd">        This is intended to be a proxy for making the</span>
</span><span id="L-1915"><a href="#-1915"><span class="linenos">1915</span></a><span class="sd">        dominant frequency the same everywhere.</span>
</span><span id="L-1916"><a href="#-1916"><span class="linenos">1916</span></a>
</span><span id="L-1917"><a href="#-1917"><span class="linenos">1917</span></a><span class="sd">        Parameters</span>
</span><span id="L-1918"><a href="#-1918"><span class="linenos">1918</span></a><span class="sd">        ----------</span>
</span><span id="L-1919"><a href="#-1919"><span class="linenos">1919</span></a><span class="sd">        traces : np.ndarray</span>
</span><span id="L-1920"><a href="#-1920"><span class="linenos">1920</span></a><span class="sd">            Previously stretched/squeezed trace(s)</span>
</span><span id="L-1921"><a href="#-1921"><span class="linenos">1921</span></a>
</span><span id="L-1922"><a href="#-1922"><span class="linenos">1922</span></a><span class="sd">        Returns</span>
</span><span id="L-1923"><a href="#-1923"><span class="linenos">1923</span></a><span class="sd">        -------</span>
</span><span id="L-1924"><a href="#-1924"><span class="linenos">1924</span></a><span class="sd">        unstretch_traces: np.ndarray</span>
</span><span id="L-1925"><a href="#-1925"><span class="linenos">1925</span></a><span class="sd">            Un-stretched/un-squeezed trace(s)</span>
</span><span id="L-1926"><a href="#-1926"><span class="linenos">1926</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1927"><a href="#-1927"><span class="linenos">1927</span></a>        <span class="n">unstretch_traces</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">traces</span><span class="p">)</span>
</span><span id="L-1928"><a href="#-1928"><span class="linenos">1928</span></a>        <span class="n">origtime</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">traces</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</span><span id="L-1929"><a href="#-1929"><span class="linenos">1929</span></a>
</span><span id="L-1930"><a href="#-1930"><span class="linenos">1930</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">   ... Cube parameters going into interpolation&quot;</span><span class="p">)</span>
</span><span id="L-1931"><a href="#-1931"><span class="linenos">1931</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">   ... Origtime shape  = </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">origtime</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1932"><a href="#-1932"><span class="linenos">1932</span></a>        <span class="nb">print</span><span class="p">(</span>
</span><span id="L-1933"><a href="#-1933"><span class="linenos">1933</span></a>            <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">   ... stretch_times_effects shape  = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">displacement_vectors</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-1934"><a href="#-1934"><span class="linenos">1934</span></a>        <span class="p">)</span>
</span><span id="L-1935"><a href="#-1935"><span class="linenos">1935</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">   ... unstretch_times shape  = </span><span class="si">{</span><span class="n">unstretch_traces</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1936"><a href="#-1936"><span class="linenos">1936</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">   ... traces shape  = </span><span class="si">{</span><span class="n">traces</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1937"><a href="#-1937"><span class="linenos">1937</span></a>
</span><span id="L-1938"><a href="#-1938"><span class="linenos">1938</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">traces</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="L-1939"><a href="#-1939"><span class="linenos">1939</span></a>            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">traces</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
</span><span id="L-1940"><a href="#-1940"><span class="linenos">1940</span></a>                <span class="k">if</span> <span class="n">traces</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">!=</span> <span class="n">traces</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">max</span><span class="p">():</span>
</span><span id="L-1941"><a href="#-1941"><span class="linenos">1941</span></a>                    <span class="n">unstretch_traces</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span>
</span><span id="L-1942"><a href="#-1942"><span class="linenos">1942</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">displacement_vectors</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="p">:],</span> <span class="n">origtime</span><span class="p">,</span> <span class="n">traces</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="p">:]</span>
</span><span id="L-1943"><a href="#-1943"><span class="linenos">1943</span></a>                    <span class="p">)</span>
</span><span id="L-1944"><a href="#-1944"><span class="linenos">1944</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-1945"><a href="#-1945"><span class="linenos">1945</span></a>                    <span class="n">unstretch_traces</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">traces</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="p">:]</span>
</span><span id="L-1946"><a href="#-1946"><span class="linenos">1946</span></a>        <span class="k">return</span> <span class="n">unstretch_traces</span>
</span><span id="L-1947"><a href="#-1947"><span class="linenos">1947</span></a>
</span><span id="L-1948"><a href="#-1948"><span class="linenos">1948</span></a>    <span class="k">def</span> <span class="nf">copy_and_divide_depth_maps_by_infill</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zmaps</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="L-1949"><a href="#-1949"><span class="linenos">1949</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1950"><a href="#-1950"><span class="linenos">1950</span></a><span class="sd">        Copy and divide depth maps by infill factor</span>
</span><span id="L-1951"><a href="#-1951"><span class="linenos">1951</span></a><span class="sd">        -------------------------------------------</span>
</span><span id="L-1952"><a href="#-1952"><span class="linenos">1952</span></a>
</span><span id="L-1953"><a href="#-1953"><span class="linenos">1953</span></a><span class="sd">        Copies and divides depth maps by infill factor.</span>
</span><span id="L-1954"><a href="#-1954"><span class="linenos">1954</span></a>
</span><span id="L-1955"><a href="#-1955"><span class="linenos">1955</span></a><span class="sd">        Parameters</span>
</span><span id="L-1956"><a href="#-1956"><span class="linenos">1956</span></a><span class="sd">        ----------</span>
</span><span id="L-1957"><a href="#-1957"><span class="linenos">1957</span></a><span class="sd">        zmaps : np.array</span>
</span><span id="L-1958"><a href="#-1958"><span class="linenos">1958</span></a><span class="sd">            The depth maps to copy and divide.</span>
</span><span id="L-1959"><a href="#-1959"><span class="linenos">1959</span></a>
</span><span id="L-1960"><a href="#-1960"><span class="linenos">1960</span></a><span class="sd">        Returns</span>
</span><span id="L-1961"><a href="#-1961"><span class="linenos">1961</span></a><span class="sd">        -------</span>
</span><span id="L-1962"><a href="#-1962"><span class="linenos">1962</span></a><span class="sd">        np.ndarray</span>
</span><span id="L-1963"><a href="#-1963"><span class="linenos">1963</span></a><span class="sd">            The result of the division</span>
</span><span id="L-1964"><a href="#-1964"><span class="linenos">1964</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1965"><a href="#-1965"><span class="linenos">1965</span></a>        <span class="k">return</span> <span class="n">zmaps</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">infill_factor</span>
</span><span id="L-1966"><a href="#-1966"><span class="linenos">1966</span></a>
</span><span id="L-1967"><a href="#-1967"><span class="linenos">1967</span></a>    <span class="k">def</span> <span class="nf">rotate_3d_ellipsoid</span><span class="p">(</span>
</span><span id="L-1968"><a href="#-1968"><span class="linenos">1968</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">z0</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">fraction</span>
</span><span id="L-1969"><a href="#-1969"><span class="linenos">1969</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="L-1970"><a href="#-1970"><span class="linenos">1970</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1971"><a href="#-1971"><span class="linenos">1971</span></a><span class="sd">        Rotate a 3D ellipsoid</span>
</span><span id="L-1972"><a href="#-1972"><span class="linenos">1972</span></a><span class="sd">        ---------------------</span>
</span><span id="L-1973"><a href="#-1973"><span class="linenos">1973</span></a>
</span><span id="L-1974"><a href="#-1974"><span class="linenos">1974</span></a><span class="sd">        Parameters</span>
</span><span id="L-1975"><a href="#-1975"><span class="linenos">1975</span></a><span class="sd">        ----------</span>
</span><span id="L-1976"><a href="#-1976"><span class="linenos">1976</span></a><span class="sd">        x0 : _type_</span>
</span><span id="L-1977"><a href="#-1977"><span class="linenos">1977</span></a><span class="sd">            _description_</span>
</span><span id="L-1978"><a href="#-1978"><span class="linenos">1978</span></a><span class="sd">        y0 : _type_</span>
</span><span id="L-1979"><a href="#-1979"><span class="linenos">1979</span></a><span class="sd">            _description_</span>
</span><span id="L-1980"><a href="#-1980"><span class="linenos">1980</span></a><span class="sd">        z0 : _type_</span>
</span><span id="L-1981"><a href="#-1981"><span class="linenos">1981</span></a><span class="sd">            _description_</span>
</span><span id="L-1982"><a href="#-1982"><span class="linenos">1982</span></a><span class="sd">        a : _type_</span>
</span><span id="L-1983"><a href="#-1983"><span class="linenos">1983</span></a><span class="sd">            _description_</span>
</span><span id="L-1984"><a href="#-1984"><span class="linenos">1984</span></a><span class="sd">        b : _type_</span>
</span><span id="L-1985"><a href="#-1985"><span class="linenos">1985</span></a><span class="sd">            _description_</span>
</span><span id="L-1986"><a href="#-1986"><span class="linenos">1986</span></a><span class="sd">        c : _type_</span>
</span><span id="L-1987"><a href="#-1987"><span class="linenos">1987</span></a><span class="sd">            _description_</span>
</span><span id="L-1988"><a href="#-1988"><span class="linenos">1988</span></a><span class="sd">        fraction : _type_</span>
</span><span id="L-1989"><a href="#-1989"><span class="linenos">1989</span></a><span class="sd">            _description_</span>
</span><span id="L-1990"><a href="#-1990"><span class="linenos">1990</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1991"><a href="#-1991"><span class="linenos">1991</span></a>        <span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">z1</span><span class="p">,</span> <span class="n">x_0</span><span class="p">,</span> <span class="n">y_0</span><span class="p">,</span> <span class="n">z_0</span><span class="p">,</span> <span class="n">a1</span><span class="p">,</span> <span class="n">b1</span><span class="p">,</span> <span class="n">c1</span><span class="p">):</span>
</span><span id="L-1992"><a href="#-1992"><span class="linenos">1992</span></a>            <span class="k">return</span> <span class="p">(</span>
</span><span id="L-1993"><a href="#-1993"><span class="linenos">1993</span></a>                <span class="p">((</span><span class="n">x1</span> <span class="o">-</span> <span class="n">x_0</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="n">a1</span> <span class="o">+</span> <span class="p">((</span><span class="n">y1</span> <span class="o">-</span> <span class="n">y_0</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="n">b1</span> <span class="o">+</span> <span class="p">((</span><span class="n">z1</span> <span class="o">-</span> <span class="n">z_0</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="n">c1</span>
</span><span id="L-1994"><a href="#-1994"><span class="linenos">1994</span></a>            <span class="p">)</span>
</span><span id="L-1995"><a href="#-1995"><span class="linenos">1995</span></a>
</span><span id="L-1996"><a href="#-1996"><span class="linenos">1996</span></a>        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">geologic_age</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;float&quot;</span><span class="p">)</span>
</span><span id="L-1997"><a href="#-1997"><span class="linenos">1997</span></a>        <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">geologic_age</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;float&quot;</span><span class="p">)</span>
</span><span id="L-1998"><a href="#-1998"><span class="linenos">1998</span></a>        <span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">geologic_age</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;float&quot;</span><span class="p">)</span>
</span><span id="L-1999"><a href="#-1999"><span class="linenos">1999</span></a>
</span><span id="L-2000"><a href="#-2000"><span class="linenos">2000</span></a>        <span class="n">xx</span><span class="p">,</span> <span class="n">yy</span><span class="p">,</span> <span class="n">zz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">indexing</span><span class="o">=</span><span class="s2">&quot;ij&quot;</span><span class="p">,</span> <span class="n">sparse</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="L-2001"><a href="#-2001"><span class="linenos">2001</span></a>
</span><span id="L-2002"><a href="#-2002"><span class="linenos">2002</span></a>        <span class="n">xyz</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-2003"><a href="#-2003"><span class="linenos">2003</span></a>            <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">xx</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">yy</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">zz</span><span class="o">.</span><span class="n">flatten</span><span class="p">()))</span>
</span><span id="L-2004"><a href="#-2004"><span class="linenos">2004</span></a>            <span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-2005"><a href="#-2005"><span class="linenos">2005</span></a>            <span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;float&quot;</span><span class="p">)</span>
</span><span id="L-2006"><a href="#-2006"><span class="linenos">2006</span></a>        <span class="p">)</span>
</span><span id="L-2007"><a href="#-2007"><span class="linenos">2007</span></a>
</span><span id="L-2008"><a href="#-2008"><span class="linenos">2008</span></a>        <span class="n">xyz_rotated</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_3d_rotation</span><span class="p">(</span>
</span><span id="L-2009"><a href="#-2009"><span class="linenos">2009</span></a>            <span class="n">xyz</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">geologic_age</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">fraction</span>
</span><span id="L-2010"><a href="#-2010"><span class="linenos">2010</span></a>        <span class="p">)</span>
</span><span id="L-2011"><a href="#-2011"><span class="linenos">2011</span></a>
</span><span id="L-2012"><a href="#-2012"><span class="linenos">2012</span></a>        <span class="n">xx_rotated</span> <span class="o">=</span> <span class="n">xyz_rotated</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">geologic_age</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span><span id="L-2013"><a href="#-2013"><span class="linenos">2013</span></a>        <span class="n">yy_rotated</span> <span class="o">=</span> <span class="n">xyz_rotated</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">geologic_age</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span><span id="L-2014"><a href="#-2014"><span class="linenos">2014</span></a>        <span class="n">zz_rotated</span> <span class="o">=</span> <span class="n">xyz_rotated</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">geologic_age</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span><span id="L-2015"><a href="#-2015"><span class="linenos">2015</span></a>
</span><span id="L-2016"><a href="#-2016"><span class="linenos">2016</span></a>        <span class="n">ellipsoid</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">xx_rotated</span><span class="p">,</span> <span class="n">yy_rotated</span><span class="p">,</span> <span class="n">zz_rotated</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">z0</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span>
</span><span id="L-2017"><a href="#-2017"><span class="linenos">2017</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">geologic_age</span><span class="o">.</span><span class="n">shape</span>
</span><span id="L-2018"><a href="#-2018"><span class="linenos">2018</span></a>        <span class="p">)</span>
</span><span id="L-2019"><a href="#-2019"><span class="linenos">2019</span></a>
</span><span id="L-2020"><a href="#-2020"><span class="linenos">2020</span></a>        <span class="k">return</span> <span class="n">ellipsoid</span>
</span><span id="L-2021"><a href="#-2021"><span class="linenos">2021</span></a>
</span><span id="L-2022"><a href="#-2022"><span class="linenos">2022</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-2023"><a href="#-2023"><span class="linenos">2023</span></a>    <span class="k">def</span> <span class="nf">apply_3d_rotation</span><span class="p">(</span><span class="n">inarray</span><span class="p">,</span> <span class="n">array_shape</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">fraction</span><span class="p">):</span>
</span><span id="L-2024"><a href="#-2024"><span class="linenos">2024</span></a>        <span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">sqrt</span><span class="p">,</span> <span class="n">sin</span><span class="p">,</span> <span class="n">cos</span><span class="p">,</span> <span class="n">atan2</span>
</span><span id="L-2025"><a href="#-2025"><span class="linenos">2025</span></a>        <span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">cross</span><span class="p">,</span> <span class="n">eye</span>
</span><span id="L-2026"><a href="#-2026"><span class="linenos">2026</span></a>
</span><span id="L-2027"><a href="#-2027"><span class="linenos">2027</span></a>        <span class="c1"># expm3 deprecated, changed to &#39;more robust&#39; expm (TM)</span>
</span><span id="L-2028"><a href="#-2028"><span class="linenos">2028</span></a>        <span class="kn">from</span> <span class="nn">scipy.linalg</span> <span class="kn">import</span> <span class="n">expm</span><span class="p">,</span> <span class="n">norm</span>
</span><span id="L-2029"><a href="#-2029"><span class="linenos">2029</span></a>
</span><span id="L-2030"><a href="#-2030"><span class="linenos">2030</span></a>        <span class="k">def</span> <span class="nf">m</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="n">angle</span><span class="p">):</span>
</span><span id="L-2031"><a href="#-2031"><span class="linenos">2031</span></a>            <span class="k">return</span> <span class="n">expm</span><span class="p">(</span><span class="n">cross</span><span class="p">(</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">axis</span> <span class="o">/</span> <span class="n">norm</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span> <span class="o">*</span> <span class="n">angle</span><span class="p">))</span>
</span><span id="L-2032"><a href="#-2032"><span class="linenos">2032</span></a>
</span><span id="L-2033"><a href="#-2033"><span class="linenos">2033</span></a>        <span class="n">theta</span> <span class="o">=</span> <span class="n">atan2</span><span class="p">(</span>
</span><span id="L-2034"><a href="#-2034"><span class="linenos">2034</span></a>            <span class="n">fraction</span>
</span><span id="L-2035"><a href="#-2035"><span class="linenos">2035</span></a>            <span class="o">*</span> <span class="n">sqrt</span><span class="p">((</span><span class="n">x0</span> <span class="o">-</span> <span class="n">array_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">y0</span> <span class="o">-</span> <span class="n">array_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">),</span>
</span><span id="L-2036"><a href="#-2036"><span class="linenos">2036</span></a>            <span class="n">array_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
</span><span id="L-2037"><a href="#-2037"><span class="linenos">2037</span></a>        <span class="p">)</span>
</span><span id="L-2038"><a href="#-2038"><span class="linenos">2038</span></a>        <span class="n">dip_angle</span> <span class="o">=</span> <span class="n">atan2</span><span class="p">(</span><span class="n">y0</span> <span class="o">-</span> <span class="n">array_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">x0</span> <span class="o">-</span> <span class="n">array_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="L-2039"><a href="#-2039"><span class="linenos">2039</span></a>
</span><span id="L-2040"><a href="#-2040"><span class="linenos">2040</span></a>        <span class="n">strike_unitvector</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
</span><span id="L-2041"><a href="#-2041"><span class="linenos">2041</span></a>            <span class="p">(</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">-</span> <span class="n">dip_angle</span><span class="p">),</span> <span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">-</span> <span class="n">dip_angle</span><span class="p">),</span> <span class="mf">0.0</span><span class="p">)</span>
</span><span id="L-2042"><a href="#-2042"><span class="linenos">2042</span></a>        <span class="p">)</span>
</span><span id="L-2043"><a href="#-2043"><span class="linenos">2043</span></a>        <span class="n">m0</span> <span class="o">=</span> <span class="n">m</span><span class="p">(</span><span class="n">strike_unitvector</span><span class="p">,</span> <span class="n">theta</span><span class="p">)</span>
</span><span id="L-2044"><a href="#-2044"><span class="linenos">2044</span></a>
</span><span id="L-2045"><a href="#-2045"><span class="linenos">2045</span></a>        <span class="n">outarray</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">m0</span><span class="p">,</span> <span class="n">inarray</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
</span><span id="L-2046"><a href="#-2046"><span class="linenos">2046</span></a>
</span><span id="L-2047"><a href="#-2047"><span class="linenos">2047</span></a>        <span class="k">return</span> <span class="n">outarray</span>
</span><span id="L-2048"><a href="#-2048"><span class="linenos">2048</span></a>
</span><span id="L-2049"><a href="#-2049"><span class="linenos">2049</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-2050"><a href="#-2050"><span class="linenos">2050</span></a>    <span class="k">def</span> <span class="nf">get_fault_plane_sobel</span><span class="p">(</span><span class="n">test_ellipsoid</span><span class="p">):</span>
</span><span id="L-2051"><a href="#-2051"><span class="linenos">2051</span></a>        <span class="kn">from</span> <span class="nn">scipy.ndimage</span> <span class="kn">import</span> <span class="n">sobel</span>
</span><span id="L-2052"><a href="#-2052"><span class="linenos">2052</span></a>        <span class="kn">from</span> <span class="nn">scipy.ndimage</span> <span class="kn">import</span> <span class="n">maximum_filter</span>
</span><span id="L-2053"><a href="#-2053"><span class="linenos">2053</span></a>
</span><span id="L-2054"><a href="#-2054"><span class="linenos">2054</span></a>        <span class="n">test_ellipsoid</span><span class="p">[</span><span class="n">test_ellipsoid</span> <span class="o">&lt;=</span> <span class="mf">1.0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="L-2055"><a href="#-2055"><span class="linenos">2055</span></a>        <span class="n">inside</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">test_ellipsoid</span><span class="p">)</span>
</span><span id="L-2056"><a href="#-2056"><span class="linenos">2056</span></a>        <span class="n">inside</span><span class="p">[</span><span class="n">test_ellipsoid</span> <span class="o">&lt;=</span> <span class="mf">1.0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="L-2057"><a href="#-2057"><span class="linenos">2057</span></a>        <span class="c1"># method 2</span>
</span><span id="L-2058"><a href="#-2058"><span class="linenos">2058</span></a>        <span class="n">edge</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-2059"><a href="#-2059"><span class="linenos">2059</span></a>            <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">sobel</span><span class="p">(</span><span class="n">inside</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
</span><span id="L-2060"><a href="#-2060"><span class="linenos">2060</span></a>            <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">sobel</span><span class="p">(</span><span class="n">inside</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
</span><span id="L-2061"><a href="#-2061"><span class="linenos">2061</span></a>            <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">sobel</span><span class="p">(</span><span class="n">inside</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">))</span>
</span><span id="L-2062"><a href="#-2062"><span class="linenos">2062</span></a>        <span class="p">)</span>
</span><span id="L-2063"><a href="#-2063"><span class="linenos">2063</span></a>        <span class="n">edge_max</span> <span class="o">=</span> <span class="n">maximum_filter</span><span class="p">(</span><span class="n">edge</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
</span><span id="L-2064"><a href="#-2064"><span class="linenos">2064</span></a>        <span class="n">edge_max</span><span class="p">[</span><span class="n">edge_max</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1e6</span>
</span><span id="L-2065"><a href="#-2065"><span class="linenos">2065</span></a>        <span class="n">fault_segments</span> <span class="o">=</span> <span class="n">edge</span> <span class="o">/</span> <span class="n">edge_max</span>
</span><span id="L-2066"><a href="#-2066"><span class="linenos">2066</span></a>        <span class="n">fault_segments</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">fault_segments</span><span class="p">)]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="L-2067"><a href="#-2067"><span class="linenos">2067</span></a>        <span class="n">fault_segments</span><span class="p">[</span><span class="n">fault_segments</span> <span class="o">&lt;</span> <span class="mf">0.5</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="L-2068"><a href="#-2068"><span class="linenos">2068</span></a>        <span class="n">fault_segments</span><span class="p">[</span><span class="n">fault_segments</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="L-2069"><a href="#-2069"><span class="linenos">2069</span></a>        <span class="k">return</span> <span class="n">fault_segments</span>
</span><span id="L-2070"><a href="#-2070"><span class="linenos">2070</span></a>
</span><span id="L-2071"><a href="#-2071"><span class="linenos">2071</span></a>    <span class="k">def</span> <span class="nf">get_fault_centre</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ellipsoid</span><span class="p">,</span> <span class="n">wb_time_map</span><span class="p">,</span> <span class="n">z_on_ellipse</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
</span><span id="L-2072"><a href="#-2072"><span class="linenos">2072</span></a>        <span class="k">def</span> <span class="nf">find_nearest</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
</span><span id="L-2073"><a href="#-2073"><span class="linenos">2073</span></a>            <span class="n">idx</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">array</span> <span class="o">-</span> <span class="n">value</span><span class="p">))</span><span class="o">.</span><span class="n">argmin</span><span class="p">()</span>
</span><span id="L-2074"><a href="#-2074"><span class="linenos">2074</span></a>            <span class="k">return</span> <span class="n">array</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
</span><span id="L-2075"><a href="#-2075"><span class="linenos">2075</span></a>
</span><span id="L-2076"><a href="#-2076"><span class="linenos">2076</span></a>        <span class="k">def</span> <span class="nf">intersec</span><span class="p">(</span><span class="n">ell</span><span class="p">,</span> <span class="n">thresh</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">):</span>
</span><span id="L-2077"><a href="#-2077"><span class="linenos">2077</span></a>            <span class="n">abc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
</span><span id="L-2078"><a href="#-2078"><span class="linenos">2078</span></a>                <span class="p">(</span><span class="n">ell</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">thresh</span><span class="p">))</span>
</span><span id="L-2079"><a href="#-2079"><span class="linenos">2079</span></a>                <span class="o">&amp;</span> <span class="p">(</span><span class="n">ell</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">thresh</span><span class="p">))</span>
</span><span id="L-2080"><a href="#-2080"><span class="linenos">2080</span></a>            <span class="p">)</span>
</span><span id="L-2081"><a href="#-2081"><span class="linenos">2081</span></a>            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">abc</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-2082"><a href="#-2082"><span class="linenos">2082</span></a>                <span class="n">direction</span> <span class="o">=</span> <span class="n">find_nearest</span><span class="p">(</span><span class="n">abc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-2083"><a href="#-2083"><span class="linenos">2083</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-2084"><a href="#-2084"><span class="linenos">2084</span></a>                <span class="n">direction</span> <span class="o">=</span> <span class="mi">9999</span>
</span><span id="L-2085"><a href="#-2085"><span class="linenos">2085</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="L-2086"><a href="#-2086"><span class="linenos">2086</span></a>                <span class="s2">&quot;   ... computing intersection points between ellipsoid and cube, raise error if none found&quot;</span>
</span><span id="L-2087"><a href="#-2087"><span class="linenos">2087</span></a>            <span class="p">)</span>
</span><span id="L-2088"><a href="#-2088"><span class="linenos">2088</span></a>            <span class="n">xdir_min</span> <span class="o">=</span> <span class="n">intersec</span><span class="p">(</span><span class="n">ell</span><span class="p">,</span> <span class="n">thresh</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">z</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-2089"><a href="#-2089"><span class="linenos">2089</span></a>            <span class="n">xdir_max</span> <span class="o">=</span> <span class="n">intersec</span><span class="p">(</span><span class="n">ell</span><span class="p">,</span> <span class="n">thresh</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">z</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-2090"><a href="#-2090"><span class="linenos">2090</span></a>            <span class="n">ydir_min</span> <span class="o">=</span> <span class="n">intersec</span><span class="p">(</span><span class="n">ell</span><span class="p">,</span> <span class="n">thresh</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-2091"><a href="#-2091"><span class="linenos">2091</span></a>            <span class="n">ydir_max</span> <span class="o">=</span> <span class="n">intersec</span><span class="p">(</span><span class="n">ell</span><span class="p">,</span> <span class="n">thresh</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-2092"><a href="#-2092"><span class="linenos">2092</span></a>
</span><span id="L-2093"><a href="#-2093"><span class="linenos">2093</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    ... xdir_min coord = &quot;</span><span class="p">,</span> <span class="n">xdir_min</span><span class="p">,</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">z</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-2094"><a href="#-2094"><span class="linenos">2094</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    ... xdir_max coord = &quot;</span><span class="p">,</span> <span class="n">xdir_max</span><span class="p">,</span> <span class="n">y</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">z</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-2095"><a href="#-2095"><span class="linenos">2095</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    ... ydir_min coord = &quot;</span><span class="p">,</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ydir_min</span><span class="p">,</span> <span class="n">z</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-2096"><a href="#-2096"><span class="linenos">2096</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    ... ydir_max coord = &quot;</span><span class="p">,</span> <span class="n">y</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">ydir_max</span><span class="p">,</span> <span class="n">z</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-2097"><a href="#-2097"><span class="linenos">2097</span></a>            <span class="k">return</span> <span class="n">direction</span>
</span><span id="L-2098"><a href="#-2098"><span class="linenos">2098</span></a>
</span><span id="L-2099"><a href="#-2099"><span class="linenos">2099</span></a>        <span class="k">def</span> <span class="nf">get_middle_z</span><span class="p">(</span><span class="n">ellipse</span><span class="p">,</span> <span class="n">wb_map</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="L-2100"><a href="#-2100"><span class="linenos">2100</span></a>            <span class="c1"># Retrieve indices and cube of point on the ellipsoid and under the sea bed</span>
</span><span id="L-2101"><a href="#-2101"><span class="linenos">2101</span></a>
</span><span id="L-2102"><a href="#-2102"><span class="linenos">2102</span></a>            <span class="n">random_idx</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-2103"><a href="#-2103"><span class="linenos">2103</span></a>            <span class="n">do_it</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-2104"><a href="#-2104"><span class="linenos">2104</span></a>            <span class="n">origtime</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">ellipse</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
</span><span id="L-2105"><a href="#-2105"><span class="linenos">2105</span></a>            <span class="n">wb_time_cube</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span>
</span><span id="L-2106"><a href="#-2106"><span class="linenos">2106</span></a>                <span class="n">wb_map</span><span class="p">,</span> <span class="p">(</span><span class="n">wb_map</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">wb_map</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-2107"><a href="#-2107"><span class="linenos">2107</span></a>            <span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">origtime</span><span class="p">)</span>
</span><span id="L-2108"><a href="#-2108"><span class="linenos">2108</span></a>            <span class="n">abc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">z_on_ellipse</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">((</span><span class="n">wb_time_cube</span> <span class="o">-</span> <span class="n">origtime</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">))</span>
</span><span id="L-2109"><a href="#-2109"><span class="linenos">2109</span></a>            <span class="n">xyz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span><span class="n">abc</span><span class="p">)</span>
</span><span id="L-2110"><a href="#-2110"><span class="linenos">2110</span></a>            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="L-2111"><a href="#-2111"><span class="linenos">2111</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;     ... xyz.shape  = &quot;</span><span class="p">,</span> <span class="n">xyz</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span><span id="L-2112"><a href="#-2112"><span class="linenos">2112</span></a>            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">abc</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-2113"><a href="#-2113"><span class="linenos">2113</span></a>                <span class="n">xyz_xyz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
</span><span id="L-2114"><a href="#-2114"><span class="linenos">2114</span></a>                <span class="n">threshold_center</span> <span class="o">=</span> <span class="mi">5</span>
</span><span id="L-2115"><a href="#-2115"><span class="linenos">2115</span></a>                <span class="k">while</span> <span class="n">xyz_xyz</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-2116"><a href="#-2116"><span class="linenos">2116</span></a>                    <span class="k">if</span> <span class="n">threshold_center</span> <span class="o">&lt;</span> <span class="n">z_on_ellipse</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
</span><span id="L-2117"><a href="#-2117"><span class="linenos">2117</span></a>                        <span class="n">z_middle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
</span><span id="L-2118"><a href="#-2118"><span class="linenos">2118</span></a>                            <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">xyz</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="nb">int</span><span class="p">((</span><span class="n">xyz</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">+</span> <span class="n">xyz</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
</span><span id="L-2119"><a href="#-2119"><span class="linenos">2119</span></a>                            <span class="o">&lt;</span> <span class="n">threshold_center</span>
</span><span id="L-2120"><a href="#-2120"><span class="linenos">2120</span></a>                        <span class="p">)</span>
</span><span id="L-2121"><a href="#-2121"><span class="linenos">2121</span></a>                        <span class="n">xyz_z</span> <span class="o">=</span> <span class="n">xyz</span><span class="p">[:,</span> <span class="n">z_middle</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-2122"><a href="#-2122"><span class="linenos">2122</span></a>                        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="L-2123"><a href="#-2123"><span class="linenos">2123</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;     ... xyz_z.shape  = &quot;</span><span class="p">,</span> <span class="n">xyz_z</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span><span id="L-2124"><a href="#-2124"><span class="linenos">2124</span></a>                        <span class="k">if</span> <span class="n">xyz_z</span><span class="o">.</span><span class="n">size</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-2125"><a href="#-2125"><span class="linenos">2125</span></a>                            <span class="n">x_middle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
</span><span id="L-2126"><a href="#-2126"><span class="linenos">2126</span></a>                                <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span>
</span><span id="L-2127"><a href="#-2127"><span class="linenos">2127</span></a>                                    <span class="n">xyz_z</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-2128"><a href="#-2128"><span class="linenos">2128</span></a>                                    <span class="o">-</span> <span class="nb">int</span><span class="p">((</span><span class="n">xyz_z</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">+</span> <span class="n">xyz_z</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="L-2129"><a href="#-2129"><span class="linenos">2129</span></a>                                <span class="p">)</span>
</span><span id="L-2130"><a href="#-2130"><span class="linenos">2130</span></a>                                <span class="o">&lt;</span> <span class="n">threshold_center</span>
</span><span id="L-2131"><a href="#-2131"><span class="linenos">2131</span></a>                            <span class="p">)</span>
</span><span id="L-2132"><a href="#-2132"><span class="linenos">2132</span></a>                            <span class="n">xyz_xz</span> <span class="o">=</span> <span class="n">xyz_z</span><span class="p">[:,</span> <span class="n">x_middle</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-2133"><a href="#-2133"><span class="linenos">2133</span></a>                            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="L-2134"><a href="#-2134"><span class="linenos">2134</span></a>                                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;     ... xyz_xz.shape  = &quot;</span><span class="p">,</span> <span class="n">xyz_xz</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span><span id="L-2135"><a href="#-2135"><span class="linenos">2135</span></a>                            <span class="k">if</span> <span class="n">xyz_xz</span><span class="o">.</span><span class="n">size</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-2136"><a href="#-2136"><span class="linenos">2136</span></a>                                <span class="n">y_middle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
</span><span id="L-2137"><a href="#-2137"><span class="linenos">2137</span></a>                                    <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span>
</span><span id="L-2138"><a href="#-2138"><span class="linenos">2138</span></a>                                        <span class="n">xyz_xz</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-2139"><a href="#-2139"><span class="linenos">2139</span></a>                                        <span class="o">-</span> <span class="nb">int</span><span class="p">((</span><span class="n">xyz_xz</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">+</span> <span class="n">xyz_xz</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="L-2140"><a href="#-2140"><span class="linenos">2140</span></a>                                    <span class="p">)</span>
</span><span id="L-2141"><a href="#-2141"><span class="linenos">2141</span></a>                                    <span class="o">&lt;</span> <span class="n">threshold_center</span>
</span><span id="L-2142"><a href="#-2142"><span class="linenos">2142</span></a>                                <span class="p">)</span>
</span><span id="L-2143"><a href="#-2143"><span class="linenos">2143</span></a>                                <span class="n">xyz_xyz</span> <span class="o">=</span> <span class="n">xyz_xz</span><span class="p">[:,</span> <span class="n">y_middle</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-2144"><a href="#-2144"><span class="linenos">2144</span></a>                                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="L-2145"><a href="#-2145"><span class="linenos">2145</span></a>                                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;     ... xyz_xyz.shape  = &quot;</span><span class="p">,</span> <span class="n">xyz_xyz</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span><span id="L-2146"><a href="#-2146"><span class="linenos">2146</span></a>                        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="L-2147"><a href="#-2147"><span class="linenos">2147</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;     ... z for upper intersection  = &quot;</span><span class="p">,</span> <span class="n">xyz</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
</span><span id="L-2148"><a href="#-2148"><span class="linenos">2148</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;     ... z for lower intersection  = &quot;</span><span class="p">,</span> <span class="n">xyz</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
</span><span id="L-2149"><a href="#-2149"><span class="linenos">2149</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;     ... threshold_center used = &quot;</span><span class="p">,</span> <span class="n">threshold_center</span><span class="p">)</span>
</span><span id="L-2150"><a href="#-2150"><span class="linenos">2150</span></a>                        <span class="n">threshold_center</span> <span class="o">+=</span> <span class="mi">5</span>
</span><span id="L-2151"><a href="#-2151"><span class="linenos">2151</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="L-2152"><a href="#-2152"><span class="linenos">2152</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   ... Break the loop, could not find a suitable point&quot;</span><span class="p">)</span>
</span><span id="L-2153"><a href="#-2153"><span class="linenos">2153</span></a>                        <span class="n">random_idx</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-2154"><a href="#-2154"><span class="linenos">2154</span></a>                        <span class="n">do_it</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-2155"><a href="#-2155"><span class="linenos">2155</span></a>                        <span class="k">break</span>
</span><span id="L-2156"><a href="#-2156"><span class="linenos">2156</span></a>                <span class="k">if</span> <span class="n">do_it</span><span class="p">:</span>
</span><span id="L-2157"><a href="#-2157"><span class="linenos">2157</span></a>                    <span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">random</span>
</span><span id="L-2158"><a href="#-2158"><span class="linenos">2158</span></a>
</span><span id="L-2159"><a href="#-2159"><span class="linenos">2159</span></a>                    <span class="n">random_idx</span> <span class="o">=</span> <span class="n">xyz_xyz</span><span class="p">[:,</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">xyz_xyz</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>
</span><span id="L-2160"><a href="#-2160"><span class="linenos">2160</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="L-2161"><a href="#-2161"><span class="linenos">2161</span></a>                        <span class="s2">&quot;   ... Computing fault middle to hang max displacement function&quot;</span>
</span><span id="L-2162"><a href="#-2162"><span class="linenos">2162</span></a>                    <span class="p">)</span>
</span><span id="L-2163"><a href="#-2163"><span class="linenos">2163</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    ... x idx for max displacement  = &quot;</span><span class="p">,</span> <span class="n">random_idx</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-2164"><a href="#-2164"><span class="linenos">2164</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    ... y idx for max displacement  = &quot;</span><span class="p">,</span> <span class="n">random_idx</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="L-2165"><a href="#-2165"><span class="linenos">2165</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    ... z idx for max displacement  = &quot;</span><span class="p">,</span> <span class="n">random_idx</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</span><span id="L-2166"><a href="#-2166"><span class="linenos">2166</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="L-2167"><a href="#-2167"><span class="linenos">2167</span></a>                        <span class="s2">&quot;    ... ellipsoid value  = &quot;</span><span class="p">,</span>
</span><span id="L-2168"><a href="#-2168"><span class="linenos">2168</span></a>                        <span class="n">ellipse</span><span class="p">[</span><span class="n">random_idx</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">random_idx</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">random_idx</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span>
</span><span id="L-2169"><a href="#-2169"><span class="linenos">2169</span></a>                    <span class="p">)</span>
</span><span id="L-2170"><a href="#-2170"><span class="linenos">2170</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-2171"><a href="#-2171"><span class="linenos">2171</span></a>                <span class="nb">print</span><span class="p">(</span>
</span><span id="L-2172"><a href="#-2172"><span class="linenos">2172</span></a>                    <span class="s2">&quot;    ... Empty intersection between fault and cube, assign d-max at cube lower corner&quot;</span>
</span><span id="L-2173"><a href="#-2173"><span class="linenos">2173</span></a>                <span class="p">)</span>
</span><span id="L-2174"><a href="#-2174"><span class="linenos">2174</span></a>
</span><span id="L-2175"><a href="#-2175"><span class="linenos">2175</span></a>            <span class="k">return</span> <span class="n">random_idx</span>
</span><span id="L-2176"><a href="#-2176"><span class="linenos">2176</span></a>
</span><span id="L-2177"><a href="#-2177"><span class="linenos">2177</span></a>        <span class="n">z_idx</span> <span class="o">=</span> <span class="n">get_middle_z</span><span class="p">(</span><span class="n">ellipsoid</span><span class="p">,</span> <span class="n">wb_time_map</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>
</span><span id="L-2178"><a href="#-2178"><span class="linenos">2178</span></a>        <span class="k">return</span> <span class="n">z_idx</span>
</span><span id="L-2179"><a href="#-2179"><span class="linenos">2179</span></a>
</span><span id="L-2180"><a href="#-2180"><span class="linenos">2180</span></a>    <span class="k">def</span> <span class="nf">xyz_dis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">z_idx</span><span class="p">,</span> <span class="n">throw</span><span class="p">,</span> <span class="n">z_on_ellipse</span><span class="p">,</span> <span class="n">ellipsoid</span><span class="p">,</span> <span class="n">wb</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
</span><span id="L-2181"><a href="#-2181"><span class="linenos">2181</span></a>        <span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">interpolate</span><span class="p">,</span> <span class="n">signal</span>
</span><span id="L-2182"><a href="#-2182"><span class="linenos">2182</span></a>        <span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">atan2</span><span class="p">,</span> <span class="n">degrees</span>
</span><span id="L-2183"><a href="#-2183"><span class="linenos">2183</span></a>        <span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">multivariate_normal</span>
</span><span id="L-2184"><a href="#-2184"><span class="linenos">2184</span></a>        <span class="kn">from</span> <span class="nn">scipy.ndimage.interpolation</span> <span class="kn">import</span> <span class="n">rotate</span>
</span><span id="L-2185"><a href="#-2185"><span class="linenos">2185</span></a>
</span><span id="L-2186"><a href="#-2186"><span class="linenos">2186</span></a>        <span class="n">cube_shape</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">geologic_age</span><span class="o">.</span><span class="n">shape</span>
</span><span id="L-2187"><a href="#-2187"><span class="linenos">2187</span></a>
</span><span id="L-2188"><a href="#-2188"><span class="linenos">2188</span></a>        <span class="k">def</span> <span class="nf">u_gaussian</span><span class="p">(</span><span class="n">d_max</span><span class="p">,</span> <span class="n">sig</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span> <span class="n">points</span><span class="p">):</span>
</span><span id="L-2189"><a href="#-2189"><span class="linenos">2189</span></a>            <span class="kn">from</span> <span class="nn">scipy.signal.windows</span> <span class="kn">import</span> <span class="n">general_gaussian</span>
</span><span id="L-2190"><a href="#-2190"><span class="linenos">2190</span></a>
</span><span id="L-2191"><a href="#-2191"><span class="linenos">2191</span></a>            <span class="k">return</span> <span class="n">d_max</span> <span class="o">*</span> <span class="n">general_gaussian</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">(</span><span class="n">sig</span><span class="p">))</span>
</span><span id="L-2192"><a href="#-2192"><span class="linenos">2192</span></a>
</span><span id="L-2193"><a href="#-2193"><span class="linenos">2193</span></a>        <span class="c1"># Choose random values sigma, p and coef</span>
</span><span id="L-2194"><a href="#-2194"><span class="linenos">2194</span></a>        <span class="n">sigma</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="mi">10</span> <span class="o">*</span> <span class="n">throw</span> <span class="o">-</span> <span class="mi">50</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
</span><span id="L-2195"><a href="#-2195"><span class="linenos">2195</span></a>        <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</span><span id="L-2196"><a href="#-2196"><span class="linenos">2196</span></a>        <span class="n">coef</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">1.3</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">)</span>
</span><span id="L-2197"><a href="#-2197"><span class="linenos">2197</span></a>
</span><span id="L-2198"><a href="#-2198"><span class="linenos">2198</span></a>        <span class="c1"># Fault plane</span>
</span><span id="L-2199"><a href="#-2199"><span class="linenos">2199</span></a>        <span class="n">infill_factor</span> <span class="o">=</span> <span class="mf">0.5</span>
</span><span id="L-2200"><a href="#-2200"><span class="linenos">2200</span></a>        <span class="n">origtime</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">cube_shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</span><span id="L-2201"><a href="#-2201"><span class="linenos">2201</span></a>        <span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;int&quot;</span><span class="p">)</span>
</span><span id="L-2202"><a href="#-2202"><span class="linenos">2202</span></a>        <span class="c1"># Define Gaussian max throw and roll it to chosen z</span>
</span><span id="L-2203"><a href="#-2203"><span class="linenos">2203</span></a>        <span class="c1"># Gaussian should be defined on at least 5 sigma on each side</span>
</span><span id="L-2204"><a href="#-2204"><span class="linenos">2204</span></a>        <span class="n">roll_int</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">10</span> <span class="o">*</span> <span class="n">sigma</span><span class="p">)</span>
</span><span id="L-2205"><a href="#-2205"><span class="linenos">2205</span></a>        <span class="n">g</span> <span class="o">=</span> <span class="n">u_gaussian</span><span class="p">(</span><span class="n">throw</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">cube_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">roll_int</span><span class="p">)</span>
</span><span id="L-2206"><a href="#-2206"><span class="linenos">2206</span></a>        <span class="c1"># Pad signal by 10*sigma before rolling</span>
</span><span id="L-2207"><a href="#-2207"><span class="linenos">2207</span></a>        <span class="n">g_padded_rolled</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">(</span><span class="n">z_idx</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">g</span><span class="o">.</span><span class="n">argmax</span><span class="p">()</span> <span class="o">+</span> <span class="n">roll_int</span><span class="p">))</span>
</span><span id="L-2208"><a href="#-2208"><span class="linenos">2208</span></a>        <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-2209"><a href="#-2209"><span class="linenos">2209</span></a>        <span class="n">wb_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">z_on_ellipse</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-2210"><a href="#-2210"><span class="linenos">2210</span></a>        <span class="n">wb_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">z_on_ellipse</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-2211"><a href="#-2211"><span class="linenos">2211</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   ... Taper fault so it doesn&#39;t reach seabed&quot;</span><span class="p">)</span>
</span><span id="L-2212"><a href="#-2212"><span class="linenos">2212</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    ... Sea floor max = </span><span class="si">{</span><span class="n">wb</span><span class="p">[</span><span class="n">wb_x</span><span class="p">,</span> <span class="n">wb_y</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-2213"><a href="#-2213"><span class="linenos">2213</span></a>        <span class="c1"># Shift Z throw so that id doesn&#39;t cross sea bed</span>
</span><span id="L-2214"><a href="#-2214"><span class="linenos">2214</span></a>        <span class="k">while</span> <span class="n">g_padded_rolled</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">roll_int</span> <span class="o">+</span> <span class="n">wb</span><span class="p">[</span><span class="n">wb_x</span><span class="p">,</span> <span class="n">wb_y</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-2215"><a href="#-2215"><span class="linenos">2215</span></a>            <span class="n">g_padded_rolled</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">g_padded_rolled</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
</span><span id="L-2216"><a href="#-2216"><span class="linenos">2216</span></a>            <span class="n">count</span> <span class="o">+=</span> <span class="mi">5</span>
</span><span id="L-2217"><a href="#-2217"><span class="linenos">2217</span></a>            <span class="c1"># Break loop if can&#39;t find spot</span>
</span><span id="L-2218"><a href="#-2218"><span class="linenos">2218</span></a>            <span class="k">if</span> <span class="n">count</span> <span class="o">&gt;</span> <span class="n">cube_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">wb</span><span class="p">[</span><span class="n">wb_x</span><span class="p">,</span> <span class="n">wb_y</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">():</span>
</span><span id="L-2219"><a href="#-2219"><span class="linenos">2219</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    ... Too many rolled sample, seafloor will not have 0 throw&quot;</span><span class="p">)</span>
</span><span id="L-2220"><a href="#-2220"><span class="linenos">2220</span></a>                <span class="k">break</span>
</span><span id="L-2221"><a href="#-2221"><span class="linenos">2221</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   ... Vertical throw shifted by </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">count</span><span class="p">)</span><span class="si">}</span><span class="s2"> samples&quot;</span><span class="p">)</span>
</span><span id="L-2222"><a href="#-2222"><span class="linenos">2222</span></a>        <span class="n">g_centered</span> <span class="o">=</span> <span class="n">g_padded_rolled</span><span class="p">[</span><span class="n">roll_int</span> <span class="p">:</span> <span class="n">cube_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">roll_int</span><span class="p">]</span>
</span><span id="L-2223"><a href="#-2223"><span class="linenos">2223</span></a>
</span><span id="L-2224"><a href="#-2224"><span class="linenos">2224</span></a>        <span class="n">ff</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">g_centered</span><span class="p">)</span>
</span><span id="L-2225"><a href="#-2225"><span class="linenos">2225</span></a>        <span class="n">z_shift</span> <span class="o">=</span> <span class="n">ff</span>
</span><span id="L-2226"><a href="#-2226"><span class="linenos">2226</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   ... Computing Gaussian distribution function&quot;</span><span class="p">)</span>
</span><span id="L-2227"><a href="#-2227"><span class="linenos">2227</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    ... Max displacement  = </span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">throw</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-2228"><a href="#-2228"><span class="linenos">2228</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    ... Sigma  = </span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">sigma</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-2229"><a href="#-2229"><span class="linenos">2229</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    ... P  = </span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-2230"><a href="#-2230"><span class="linenos">2230</span></a>
</span><span id="L-2231"><a href="#-2231"><span class="linenos">2231</span></a>        <span class="n">low_fault_throw</span> <span class="o">=</span> <span class="mi">5</span>
</span><span id="L-2232"><a href="#-2232"><span class="linenos">2232</span></a>        <span class="n">high_fault_throw</span> <span class="o">=</span> <span class="mi">35</span>
</span><span id="L-2233"><a href="#-2233"><span class="linenos">2233</span></a>        <span class="c1"># Parameters to set ratio of 1.4 seems to be optimal for a 1500x1500 grid</span>
</span><span id="L-2234"><a href="#-2234"><span class="linenos">2234</span></a>        <span class="n">mu_x</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-2235"><a href="#-2235"><span class="linenos">2235</span></a>        <span class="n">mu_y</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-2236"><a href="#-2236"><span class="linenos">2236</span></a>
</span><span id="L-2237"><a href="#-2237"><span class="linenos">2237</span></a>        <span class="c1"># Use throw to get length</span>
</span><span id="L-2238"><a href="#-2238"><span class="linenos">2238</span></a>        <span class="n">throw_range</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">low_fault_throw</span><span class="p">,</span> <span class="n">high_fault_throw</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-2239"><a href="#-2239"><span class="linenos">2239</span></a>        <span class="c1"># Max throw vs length relationship</span>
</span><span id="L-2240"><a href="#-2240"><span class="linenos">2240</span></a>        <span class="n">fault_length</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="mf">0.0013</span> <span class="o">*</span> <span class="n">throw_range</span><span class="p">,</span> <span class="mf">1.3258</span><span class="p">)</span>
</span><span id="L-2241"><a href="#-2241"><span class="linenos">2241</span></a>        <span class="c1"># Max throw == 16000</span>
</span><span id="L-2242"><a href="#-2242"><span class="linenos">2242</span></a>        <span class="n">scale_factor</span> <span class="o">=</span> <span class="mi">16000</span> <span class="o">/</span> <span class="n">fault_length</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-2243"><a href="#-2243"><span class="linenos">2243</span></a>        <span class="c1"># Coef random selection moved to top of function</span>
</span><span id="L-2244"><a href="#-2244"><span class="linenos">2244</span></a>        <span class="n">variance_x</span> <span class="o">=</span> <span class="n">scale_factor</span> <span class="o">*</span> <span class="n">fault_length</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">throw_range</span> <span class="o">==</span> <span class="nb">int</span><span class="p">(</span><span class="n">throw</span><span class="p">))]</span>
</span><span id="L-2245"><a href="#-2245"><span class="linenos">2245</span></a>        <span class="n">variance_y</span> <span class="o">=</span> <span class="n">variance_x</span> <span class="o">*</span> <span class="n">coef</span>
</span><span id="L-2246"><a href="#-2246"><span class="linenos">2246</span></a>        <span class="c1"># Do the same for the drag zone area</span>
</span><span id="L-2247"><a href="#-2247"><span class="linenos">2247</span></a>        <span class="n">fault_length_drag</span> <span class="o">=</span> <span class="n">fault_length</span> <span class="o">/</span> <span class="mi">10000</span>
</span><span id="L-2248"><a href="#-2248"><span class="linenos">2248</span></a>        <span class="n">variance_x_drag</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-2249"><a href="#-2249"><span class="linenos">2249</span></a>            <span class="n">scale_factor</span> <span class="o">*</span> <span class="n">fault_length_drag</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">throw_range</span> <span class="o">==</span> <span class="nb">int</span><span class="p">(</span><span class="n">throw</span><span class="p">))]</span>
</span><span id="L-2250"><a href="#-2250"><span class="linenos">2250</span></a>        <span class="p">)</span>
</span><span id="L-2251"><a href="#-2251"><span class="linenos">2251</span></a>        <span class="n">variance_y_drag</span> <span class="o">=</span> <span class="n">variance_x_drag</span> <span class="o">*</span> <span class="n">coef</span>
</span><span id="L-2252"><a href="#-2252"><span class="linenos">2252</span></a>        <span class="c1"># Rotation from z_idx to center</span>
</span><span id="L-2253"><a href="#-2253"><span class="linenos">2253</span></a>        <span class="n">alpha</span> <span class="o">=</span> <span class="n">atan2</span><span class="p">(</span><span class="n">z_idx</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">cube_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">z_idx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">cube_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="L-2254"><a href="#-2254"><span class="linenos">2254</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    ... Variance_x, Variance_y = </span><span class="si">{</span><span class="n">variance_x</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">variance_y</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-2255"><a href="#-2255"><span class="linenos">2255</span></a>        <span class="nb">print</span><span class="p">(</span>
</span><span id="L-2256"><a href="#-2256"><span class="linenos">2256</span></a>            <span class="sa">f</span><span class="s2">&quot;    ... Angle between max displacement point tangent plane and cube = </span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">degrees</span><span class="p">(</span><span class="n">alpha</span><span class="p">))</span><span class="si">}</span><span class="s2"> Degrees&quot;</span>
</span><span id="L-2257"><a href="#-2257"><span class="linenos">2257</span></a>        <span class="p">)</span>
</span><span id="L-2258"><a href="#-2258"><span class="linenos">2258</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    ... Max displacement point at x,y,z = </span><span class="si">{</span><span class="n">z_idx</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-2259"><a href="#-2259"><span class="linenos">2259</span></a>
</span><span id="L-2260"><a href="#-2260"><span class="linenos">2260</span></a>        <span class="c1"># Create grid and multivariate normal</span>
</span><span id="L-2261"><a href="#-2261"><span class="linenos">2261</span></a>        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span>
</span><span id="L-2262"><a href="#-2262"><span class="linenos">2262</span></a>            <span class="o">-</span><span class="nb">int</span><span class="p">(</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mf">1.5</span> <span class="o">*</span> <span class="n">cube_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
</span><span id="L-2263"><a href="#-2263"><span class="linenos">2263</span></a>            <span class="nb">int</span><span class="p">(</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mf">1.5</span> <span class="o">*</span> <span class="n">cube_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
</span><span id="L-2264"><a href="#-2264"><span class="linenos">2264</span></a>            <span class="mi">2</span> <span class="o">*</span> <span class="nb">int</span><span class="p">(</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mf">1.5</span> <span class="o">*</span> <span class="n">cube_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
</span><span id="L-2265"><a href="#-2265"><span class="linenos">2265</span></a>        <span class="p">)</span>
</span><span id="L-2266"><a href="#-2266"><span class="linenos">2266</span></a>        <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span>
</span><span id="L-2267"><a href="#-2267"><span class="linenos">2267</span></a>            <span class="o">-</span><span class="nb">int</span><span class="p">(</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mf">1.5</span> <span class="o">*</span> <span class="n">cube_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
</span><span id="L-2268"><a href="#-2268"><span class="linenos">2268</span></a>            <span class="nb">int</span><span class="p">(</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mf">1.5</span> <span class="o">*</span> <span class="n">cube_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
</span><span id="L-2269"><a href="#-2269"><span class="linenos">2269</span></a>            <span class="mi">2</span> <span class="o">*</span> <span class="nb">int</span><span class="p">(</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mf">1.5</span> <span class="o">*</span> <span class="n">cube_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
</span><span id="L-2270"><a href="#-2270"><span class="linenos">2270</span></a>        <span class="p">)</span>
</span><span id="L-2271"><a href="#-2271"><span class="linenos">2271</span></a>        <span class="n">_x</span><span class="p">,</span> <span class="n">_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</span><span id="L-2272"><a href="#-2272"><span class="linenos">2272</span></a>        <span class="n">pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">_x</span><span class="o">.</span><span class="n">shape</span> <span class="o">+</span> <span class="p">(</span><span class="mi">2</span><span class="p">,))</span>
</span><span id="L-2273"><a href="#-2273"><span class="linenos">2273</span></a>        <span class="n">pos</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">_x</span>
</span><span id="L-2274"><a href="#-2274"><span class="linenos">2274</span></a>        <span class="n">pos</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">_y</span>
</span><span id="L-2275"><a href="#-2275"><span class="linenos">2275</span></a>        <span class="n">rv</span> <span class="o">=</span> <span class="n">multivariate_normal</span><span class="p">([</span><span class="n">mu_x</span><span class="p">,</span> <span class="n">mu_y</span><span class="p">],</span> <span class="p">[[</span><span class="n">variance_x</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">variance_y</span><span class="p">]])</span>
</span><span id="L-2276"><a href="#-2276"><span class="linenos">2276</span></a>        <span class="n">rv_drag</span> <span class="o">=</span> <span class="n">multivariate_normal</span><span class="p">(</span>
</span><span id="L-2277"><a href="#-2277"><span class="linenos">2277</span></a>            <span class="p">[</span><span class="n">mu_x</span><span class="p">,</span> <span class="n">mu_y</span><span class="p">],</span> <span class="p">[[</span><span class="n">variance_x_drag</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">variance_y_drag</span><span class="p">]]</span>
</span><span id="L-2278"><a href="#-2278"><span class="linenos">2278</span></a>        <span class="p">)</span>
</span><span id="L-2279"><a href="#-2279"><span class="linenos">2279</span></a>        <span class="c1"># Scale up by mu order of magnitude and swap axes</span>
</span><span id="L-2280"><a href="#-2280"><span class="linenos">2280</span></a>        <span class="n">xy_dis</span> <span class="o">=</span> <span class="mi">10000</span> <span class="o">*</span> <span class="p">(</span><span class="n">rv</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">pos</span><span class="p">))</span>
</span><span id="L-2281"><a href="#-2281"><span class="linenos">2281</span></a>        <span class="n">xy_dis_drag</span> <span class="o">=</span> <span class="mi">10000</span> <span class="o">*</span> <span class="p">(</span><span class="n">rv_drag</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">pos</span><span class="p">))</span>
</span><span id="L-2282"><a href="#-2282"><span class="linenos">2282</span></a>
</span><span id="L-2283"><a href="#-2283"><span class="linenos">2283</span></a>        <span class="c1"># Normalize</span>
</span><span id="L-2284"><a href="#-2284"><span class="linenos">2284</span></a>        <span class="n">xy_dis</span> <span class="o">=</span> <span class="n">xy_dis</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="n">xy_dis</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span>
</span><span id="L-2285"><a href="#-2285"><span class="linenos">2285</span></a>        <span class="n">xy_dis_drag</span> <span class="o">=</span> <span class="p">(</span><span class="n">xy_dis_drag</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="n">xy_dis_drag</span><span class="o">.</span><span class="n">flatten</span><span class="p">()))</span> <span class="o">*</span> <span class="mf">0.99</span>
</span><span id="L-2286"><a href="#-2286"><span class="linenos">2286</span></a>
</span><span id="L-2287"><a href="#-2287"><span class="linenos">2287</span></a>        <span class="c1"># Rotate plane by alpha</span>
</span><span id="L-2288"><a href="#-2288"><span class="linenos">2288</span></a>        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">cube_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cube_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-2289"><a href="#-2289"><span class="linenos">2289</span></a>        <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">cube_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">cube_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="L-2290"><a href="#-2290"><span class="linenos">2290</span></a>        <span class="n">_x</span><span class="p">,</span> <span class="n">_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</span><span id="L-2291"><a href="#-2291"><span class="linenos">2291</span></a>        <span class="n">xy_dis_rotated</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">xy_dis</span><span class="p">)</span>
</span><span id="L-2292"><a href="#-2292"><span class="linenos">2292</span></a>        <span class="n">xy_dis_drag_rotated</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">xy_dis</span><span class="p">)</span>
</span><span id="L-2293"><a href="#-2293"><span class="linenos">2293</span></a>        <span class="n">rotate</span><span class="p">(</span>
</span><span id="L-2294"><a href="#-2294"><span class="linenos">2294</span></a>            <span class="n">xy_dis_drag</span><span class="p">,</span>
</span><span id="L-2295"><a href="#-2295"><span class="linenos">2295</span></a>            <span class="n">degrees</span><span class="p">(</span><span class="n">alpha</span><span class="p">),</span>
</span><span id="L-2296"><a href="#-2296"><span class="linenos">2296</span></a>            <span class="n">reshape</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="L-2297"><a href="#-2297"><span class="linenos">2297</span></a>            <span class="n">output</span><span class="o">=</span><span class="n">xy_dis_drag_rotated</span><span class="p">,</span>
</span><span id="L-2298"><a href="#-2298"><span class="linenos">2298</span></a>            <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;nearest&quot;</span><span class="p">,</span>
</span><span id="L-2299"><a href="#-2299"><span class="linenos">2299</span></a>        <span class="p">)</span>
</span><span id="L-2300"><a href="#-2300"><span class="linenos">2300</span></a>        <span class="n">rotate</span><span class="p">(</span>
</span><span id="L-2301"><a href="#-2301"><span class="linenos">2301</span></a>            <span class="n">xy_dis</span><span class="p">,</span> <span class="n">degrees</span><span class="p">(</span><span class="n">alpha</span><span class="p">),</span> <span class="n">reshape</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="n">xy_dis_rotated</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;nearest&quot;</span>
</span><span id="L-2302"><a href="#-2302"><span class="linenos">2302</span></a>        <span class="p">)</span>
</span><span id="L-2303"><a href="#-2303"><span class="linenos">2303</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   ...&quot;</span><span class="p">,</span> <span class="n">xy_dis_rotated</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">xy_dis</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span><span id="L-2304"><a href="#-2304"><span class="linenos">2304</span></a>        <span class="n">xy_dis</span> <span class="o">=</span> <span class="n">xy_dis</span><span class="p">[</span>
</span><span id="L-2305"><a href="#-2305"><span class="linenos">2305</span></a>            <span class="nb">int</span><span class="p">(</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="mi">2</span> <span class="p">:</span> <span class="n">cube_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span>
</span><span id="L-2306"><a href="#-2306"><span class="linenos">2306</span></a>            <span class="nb">int</span><span class="p">(</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="mi">2</span> <span class="p">:</span> <span class="n">cube_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span>
</span><span id="L-2307"><a href="#-2307"><span class="linenos">2307</span></a>        <span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-2308"><a href="#-2308"><span class="linenos">2308</span></a>        <span class="n">xy_dis_drag</span> <span class="o">=</span> <span class="n">xy_dis_drag</span><span class="p">[</span>
</span><span id="L-2309"><a href="#-2309"><span class="linenos">2309</span></a>            <span class="nb">int</span><span class="p">(</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="mi">2</span> <span class="p">:</span> <span class="n">cube_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span>
</span><span id="L-2310"><a href="#-2310"><span class="linenos">2310</span></a>            <span class="nb">int</span><span class="p">(</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="mi">2</span> <span class="p">:</span> <span class="n">cube_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span>
</span><span id="L-2311"><a href="#-2311"><span class="linenos">2311</span></a>        <span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-2312"><a href="#-2312"><span class="linenos">2312</span></a>
</span><span id="L-2313"><a href="#-2313"><span class="linenos">2313</span></a>        <span class="c1"># taper edges of xy_dis_drag in 2d to avoid edge artifacts in fft</span>
</span><span id="L-2314"><a href="#-2314"><span class="linenos">2314</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    ... xy_dis_drag.shape = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">xy_dis_drag</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
</span><span id="L-2315"><a href="#-2315"><span class="linenos">2315</span></a>        <span class="nb">print</span><span class="p">(</span>
</span><span id="L-2316"><a href="#-2316"><span class="linenos">2316</span></a>            <span class="s2">&quot;    ... xy_dis_drag[xy_dis_drag&gt;0.].size = &quot;</span>
</span><span id="L-2317"><a href="#-2317"><span class="linenos">2317</span></a>            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">xy_dis_drag</span><span class="p">[</span><span class="n">xy_dis_drag</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
</span><span id="L-2318"><a href="#-2318"><span class="linenos">2318</span></a>        <span class="p">)</span>
</span><span id="L-2319"><a href="#-2319"><span class="linenos">2319</span></a>        <span class="nb">print</span><span class="p">(</span>
</span><span id="L-2320"><a href="#-2320"><span class="linenos">2320</span></a>            <span class="s2">&quot;    ... xy_dis_drag.shape min/mean/max= &quot;</span>
</span><span id="L-2321"><a href="#-2321"><span class="linenos">2321</span></a>            <span class="o">+</span> <span class="nb">str</span><span class="p">((</span><span class="n">xy_dis_drag</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">xy_dis_drag</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">xy_dis_drag</span><span class="o">.</span><span class="n">max</span><span class="p">()))</span>
</span><span id="L-2322"><a href="#-2322"><span class="linenos">2322</span></a>        <span class="p">)</span>
</span><span id="L-2323"><a href="#-2323"><span class="linenos">2323</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-2324"><a href="#-2324"><span class="linenos">2324</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">plot_counter</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-2325"><a href="#-2325"><span class="linenos">2325</span></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="L-2326"><a href="#-2326"><span class="linenos">2326</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">plot_counter</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-2327"><a href="#-2327"><span class="linenos">2327</span></a>
</span><span id="L-2328"><a href="#-2328"><span class="linenos">2328</span></a>        <span class="c1"># xy_dis_rotated = rotate(xy_dis, degrees(alpha), mode=&#39;constant&#39;)</span>
</span><span id="L-2329"><a href="#-2329"><span class="linenos">2329</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   ...&quot;</span><span class="p">,</span> <span class="n">xy_dis_rotated</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">xy_dis</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span><span id="L-2330"><a href="#-2330"><span class="linenos">2330</span></a>
</span><span id="L-2331"><a href="#-2331"><span class="linenos">2331</span></a>        <span class="c1"># Normalize</span>
</span><span id="L-2332"><a href="#-2332"><span class="linenos">2332</span></a>        <span class="c1"># xy_dis_rotated = rotate(xy_dis, degrees(alpha), mode=&#39;constant&#39;)</span>
</span><span id="L-2333"><a href="#-2333"><span class="linenos">2333</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   ...&quot;</span><span class="p">,</span> <span class="n">xy_dis_rotated</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">xy_dis</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span><span id="L-2334"><a href="#-2334"><span class="linenos">2334</span></a>        <span class="c1"># Normalize</span>
</span><span id="L-2335"><a href="#-2335"><span class="linenos">2335</span></a>        <span class="n">new_matrix</span> <span class="o">=</span> <span class="n">xy_dis_rotated</span>
</span><span id="L-2336"><a href="#-2336"><span class="linenos">2336</span></a>        <span class="n">xy_dis_norm</span> <span class="o">=</span> <span class="n">xy_dis</span>
</span><span id="L-2337"><a href="#-2337"><span class="linenos">2337</span></a>        <span class="n">x_center</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">new_matrix</span> <span class="o">==</span> <span class="n">new_matrix</span><span class="o">.</span><span class="n">max</span><span class="p">())[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-2338"><a href="#-2338"><span class="linenos">2338</span></a>        <span class="n">y_center</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">new_matrix</span> <span class="o">==</span> <span class="n">new_matrix</span><span class="o">.</span><span class="n">max</span><span class="p">())[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-2339"><a href="#-2339"><span class="linenos">2339</span></a>
</span><span id="L-2340"><a href="#-2340"><span class="linenos">2340</span></a>        <span class="c1"># Pad event and move it to maximum depth location</span>
</span><span id="L-2341"><a href="#-2341"><span class="linenos">2341</span></a>        <span class="n">x_pad</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-2342"><a href="#-2342"><span class="linenos">2342</span></a>        <span class="n">y_pad</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-2343"><a href="#-2343"><span class="linenos">2343</span></a>        <span class="n">x_roll</span> <span class="o">=</span> <span class="n">z_idx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">x_center</span>
</span><span id="L-2344"><a href="#-2344"><span class="linenos">2344</span></a>        <span class="n">y_roll</span> <span class="o">=</span> <span class="n">z_idx</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">y_center</span>
</span><span id="L-2345"><a href="#-2345"><span class="linenos">2345</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    ... padding x,y and roll x,y = </span><span class="si">{</span><span class="n">x_pad</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">y_pad</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">x_roll</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">y_roll</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-2346"><a href="#-2346"><span class="linenos">2346</span></a>        <span class="nb">print</span><span class="p">(</span>
</span><span id="L-2347"><a href="#-2347"><span class="linenos">2347</span></a>            <span class="sa">f</span><span class="s2">&quot;    ... Max displacement point before rotation and adding of padding x,y = </span><span class="si">{</span><span class="n">x_center</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">y_center</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-2348"><a href="#-2348"><span class="linenos">2348</span></a>        <span class="p">)</span>
</span><span id="L-2349"><a href="#-2349"><span class="linenos">2349</span></a>        <span class="n">new_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span>
</span><span id="L-2350"><a href="#-2350"><span class="linenos">2350</span></a>            <span class="n">new_matrix</span><span class="p">,</span> <span class="p">((</span><span class="nb">abs</span><span class="p">(</span><span class="n">x_pad</span><span class="p">),</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x_pad</span><span class="p">)),</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">y_pad</span><span class="p">),</span> <span class="nb">abs</span><span class="p">(</span><span class="n">y_pad</span><span class="p">))),</span> <span class="s2">&quot;edge&quot;</span>
</span><span id="L-2351"><a href="#-2351"><span class="linenos">2351</span></a>        <span class="p">)</span>
</span><span id="L-2352"><a href="#-2352"><span class="linenos">2352</span></a>        <span class="n">new_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">new_matrix</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">x_roll</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-2353"><a href="#-2353"><span class="linenos">2353</span></a>        <span class="n">new_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">new_matrix</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">y_roll</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-2354"><a href="#-2354"><span class="linenos">2354</span></a>        <span class="n">new_matrix</span> <span class="o">=</span> <span class="n">new_matrix</span><span class="p">[</span>
</span><span id="L-2355"><a href="#-2355"><span class="linenos">2355</span></a>            <span class="nb">abs</span><span class="p">(</span><span class="n">x_pad</span><span class="p">)</span> <span class="p">:</span> <span class="n">cube_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x_pad</span><span class="p">),</span>
</span><span id="L-2356"><a href="#-2356"><span class="linenos">2356</span></a>            <span class="nb">abs</span><span class="p">(</span><span class="n">y_pad</span><span class="p">)</span> <span class="p">:</span> <span class="n">cube_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="nb">abs</span><span class="p">(</span><span class="n">y_pad</span><span class="p">),</span>
</span><span id="L-2357"><a href="#-2357"><span class="linenos">2357</span></a>        <span class="p">]</span>
</span><span id="L-2358"><a href="#-2358"><span class="linenos">2358</span></a>        <span class="c1"># Check that fault center is at the right place</span>
</span><span id="L-2359"><a href="#-2359"><span class="linenos">2359</span></a>        <span class="n">x_center</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">new_matrix</span> <span class="o">==</span> <span class="n">new_matrix</span><span class="o">.</span><span class="n">max</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-2360"><a href="#-2360"><span class="linenos">2360</span></a>        <span class="n">y_center</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">new_matrix</span> <span class="o">==</span> <span class="n">new_matrix</span><span class="o">.</span><span class="n">max</span><span class="p">())[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-2361"><a href="#-2361"><span class="linenos">2361</span></a>        <span class="nb">print</span><span class="p">(</span>
</span><span id="L-2362"><a href="#-2362"><span class="linenos">2362</span></a>            <span class="sa">f</span><span class="s2">&quot;    ... Max displacement point after rotation and removal of padding x,y = </span><span class="si">{</span><span class="n">x_center</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">y_center</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-2363"><a href="#-2363"><span class="linenos">2363</span></a>        <span class="p">)</span>
</span><span id="L-2364"><a href="#-2364"><span class="linenos">2364</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    ... z_idx = </span><span class="si">{</span><span class="n">z_idx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">z_idx</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-2365"><a href="#-2365"><span class="linenos">2365</span></a>        <span class="nb">print</span><span class="p">(</span>
</span><span id="L-2366"><a href="#-2366"><span class="linenos">2366</span></a>            <span class="sa">f</span><span class="s2">&quot;    ... Difference from origin z_idx = </span><span class="si">{</span><span class="n">x_center</span> <span class="o">-</span> <span class="n">z_idx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">y_center</span> <span class="o">-</span> <span class="n">z_idx</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-2367"><a href="#-2367"><span class="linenos">2367</span></a>        <span class="p">)</span>
</span><span id="L-2368"><a href="#-2368"><span class="linenos">2368</span></a>
</span><span id="L-2369"><a href="#-2369"><span class="linenos">2369</span></a>        <span class="c1"># Build cube of lateral variable displacement</span>
</span><span id="L-2370"><a href="#-2370"><span class="linenos">2370</span></a>        <span class="n">xy_dis</span> <span class="o">=</span> <span class="n">new_matrix</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cube_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-2371"><a href="#-2371"><span class="linenos">2371</span></a>        <span class="c1"># Get enlarged fault plane</span>
</span><span id="L-2372"><a href="#-2372"><span class="linenos">2372</span></a>        <span class="n">bb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">ellipsoid</span><span class="p">)</span>
</span><span id="L-2373"><a href="#-2373"><span class="linenos">2373</span></a>        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">bb</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
</span><span id="L-2374"><a href="#-2374"><span class="linenos">2374</span></a>            <span class="n">bb</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">j</span>
</span><span id="L-2375"><a href="#-2375"><span class="linenos">2375</span></a>        <span class="n">stretch_times_effects_drag</span> <span class="o">=</span> <span class="n">bb</span> <span class="o">-</span> <span class="n">xy_dis</span> <span class="o">*</span> <span class="n">z_shift</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
</span><span id="L-2376"><a href="#-2376"><span class="linenos">2376</span></a>        <span class="n">fault_plane_classification</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
</span><span id="L-2377"><a href="#-2377"><span class="linenos">2377</span></a>            <span class="p">(</span><span class="n">z_on_ellipse</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-2378"><a href="#-2378"><span class="linenos">2378</span></a>            <span class="o">&amp;</span> <span class="p">((</span><span class="n">origtime</span> <span class="o">-</span> <span class="n">stretch_times_effects_drag</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">infill_factor</span><span class="p">),</span>
</span><span id="L-2379"><a href="#-2379"><span class="linenos">2379</span></a>            <span class="mi">1</span><span class="p">,</span>
</span><span id="L-2380"><a href="#-2380"><span class="linenos">2380</span></a>            <span class="mi">0</span><span class="p">,</span>
</span><span id="L-2381"><a href="#-2381"><span class="linenos">2381</span></a>        <span class="p">)</span>
</span><span id="L-2382"><a href="#-2382"><span class="linenos">2382</span></a>        <span class="n">hockey_stick</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-2383"><a href="#-2383"><span class="linenos">2383</span></a>        <span class="c1"># Define as 0&#39;s, to be updated if necessary</span>
</span><span id="L-2384"><a href="#-2384"><span class="linenos">2384</span></a>        <span class="n">fault_plane_classification_drag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">z_on_ellipse</span><span class="p">)</span>
</span><span id="L-2385"><a href="#-2385"><span class="linenos">2385</span></a>        <span class="k">if</span> <span class="n">throw</span> <span class="o">&gt;=</span> <span class="mf">0.85</span> <span class="o">*</span> <span class="n">high_fault_throw</span><span class="p">:</span>
</span><span id="L-2386"><a href="#-2386"><span class="linenos">2386</span></a>            <span class="n">hockey_stick</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-2387"><a href="#-2387"><span class="linenos">2387</span></a>            <span class="c1"># Check for non zero fault_plane_classification, to avoid division by 0</span>
</span><span id="L-2388"><a href="#-2388"><span class="linenos">2388</span></a>            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">count_nonzero</span><span class="p">(</span><span class="n">fault_plane_classification</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-2389"><a href="#-2389"><span class="linenos">2389</span></a>                <span class="c1"># Generate Hockey sticks by convolving small xy displacement with fault segment</span>
</span><span id="L-2390"><a href="#-2390"><span class="linenos">2390</span></a>                <span class="n">fault_plane_classification_drag</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">fftconvolve</span><span class="p">(</span>
</span><span id="L-2391"><a href="#-2391"><span class="linenos">2391</span></a>                    <span class="n">fault_plane_classification</span><span class="p">,</span>
</span><span id="L-2392"><a href="#-2392"><span class="linenos">2392</span></a>                    <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">xy_dis_drag</span><span class="p">,</span> <span class="p">(</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cube_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1</span><span class="p">)),</span>
</span><span id="L-2393"><a href="#-2393"><span class="linenos">2393</span></a>                    <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;same&quot;</span><span class="p">,</span>
</span><span id="L-2394"><a href="#-2394"><span class="linenos">2394</span></a>                <span class="p">)</span>
</span><span id="L-2395"><a href="#-2395"><span class="linenos">2395</span></a>                <span class="n">fault_plane_classification_drag</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-2396"><a href="#-2396"><span class="linenos">2396</span></a>                    <span class="n">fault_plane_classification_drag</span>
</span><span id="L-2397"><a href="#-2397"><span class="linenos">2397</span></a>                    <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="n">fault_plane_classification_drag</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span>
</span><span id="L-2398"><a href="#-2398"><span class="linenos">2398</span></a>                <span class="p">)</span>
</span><span id="L-2399"><a href="#-2399"><span class="linenos">2399</span></a>
</span><span id="L-2400"><a href="#-2400"><span class="linenos">2400</span></a>        <span class="n">xy_dis</span> <span class="o">=</span> <span class="n">xy_dis</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">geologic_age</span><span class="p">)</span>
</span><span id="L-2401"><a href="#-2401"><span class="linenos">2401</span></a>        <span class="n">xy_dis_classification</span> <span class="o">=</span> <span class="n">xy_dis</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-2402"><a href="#-2402"><span class="linenos">2402</span></a>        <span class="n">interpolation</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-2403"><a href="#-2403"><span class="linenos">2403</span></a>
</span><span id="L-2404"><a href="#-2404"><span class="linenos">2404</span></a>        <span class="n">xy_dis</span> <span class="o">=</span> <span class="n">xy_dis</span> <span class="o">-</span> <span class="n">fault_plane_classification_drag</span>
</span><span id="L-2405"><a href="#-2405"><span class="linenos">2405</span></a>        <span class="n">xy_dis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">xy_dis</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">xy_dis</span><span class="p">)</span>
</span><span id="L-2406"><a href="#-2406"><span class="linenos">2406</span></a>        <span class="n">stretch_times</span> <span class="o">=</span> <span class="n">xy_dis</span> <span class="o">*</span> <span class="n">z_shift</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
</span><span id="L-2407"><a href="#-2407"><span class="linenos">2407</span></a>        <span class="n">stretch_times_classification</span> <span class="o">=</span> <span class="n">xy_dis_classification</span> <span class="o">*</span> <span class="n">z_shift</span><span class="p">(</span>
</span><span id="L-2408"><a href="#-2408"><span class="linenos">2408</span></a>            <span class="nb">range</span><span class="p">(</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</span><span id="L-2409"><a href="#-2409"><span class="linenos">2409</span></a>        <span class="p">)</span>
</span><span id="L-2410"><a href="#-2410"><span class="linenos">2410</span></a>
</span><span id="L-2411"><a href="#-2411"><span class="linenos">2411</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">qc_plots</span><span class="p">:</span>
</span><span id="L-2412"><a href="#-2412"><span class="linenos">2412</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">fault_summary_plot</span><span class="p">(</span>
</span><span id="L-2413"><a href="#-2413"><span class="linenos">2413</span></a>                <span class="n">ff</span><span class="p">,</span>
</span><span id="L-2414"><a href="#-2414"><span class="linenos">2414</span></a>                <span class="n">z</span><span class="p">,</span>
</span><span id="L-2415"><a href="#-2415"><span class="linenos">2415</span></a>                <span class="n">throw</span><span class="p">,</span>
</span><span id="L-2416"><a href="#-2416"><span class="linenos">2416</span></a>                <span class="n">sigma</span><span class="p">,</span>
</span><span id="L-2417"><a href="#-2417"><span class="linenos">2417</span></a>                <span class="n">_x</span><span class="p">,</span>
</span><span id="L-2418"><a href="#-2418"><span class="linenos">2418</span></a>                <span class="n">_y</span><span class="p">,</span>
</span><span id="L-2419"><a href="#-2419"><span class="linenos">2419</span></a>                <span class="n">xy_dis_norm</span><span class="p">,</span>
</span><span id="L-2420"><a href="#-2420"><span class="linenos">2420</span></a>                <span class="n">ellipsoid</span><span class="p">,</span>
</span><span id="L-2421"><a href="#-2421"><span class="linenos">2421</span></a>                <span class="n">z_idx</span><span class="p">,</span>
</span><span id="L-2422"><a href="#-2422"><span class="linenos">2422</span></a>                <span class="n">xy_dis</span><span class="p">,</span>
</span><span id="L-2423"><a href="#-2423"><span class="linenos">2423</span></a>                <span class="n">index</span><span class="p">,</span>
</span><span id="L-2424"><a href="#-2424"><span class="linenos">2424</span></a>                <span class="n">alpha</span><span class="p">,</span>
</span><span id="L-2425"><a href="#-2425"><span class="linenos">2425</span></a>            <span class="p">)</span>
</span><span id="L-2426"><a href="#-2426"><span class="linenos">2426</span></a>
</span><span id="L-2427"><a href="#-2427"><span class="linenos">2427</span></a>        <span class="k">return</span> <span class="n">stretch_times</span><span class="p">,</span> <span class="n">stretch_times_classification</span><span class="p">,</span> <span class="n">interpolation</span><span class="p">,</span> <span class="n">hockey_stick</span>
</span><span id="L-2428"><a href="#-2428"><span class="linenos">2428</span></a>
</span><span id="L-2429"><a href="#-2429"><span class="linenos">2429</span></a>    <span class="k">def</span> <span class="nf">fault_summary_plot</span><span class="p">(</span>
</span><span id="L-2430"><a href="#-2430"><span class="linenos">2430</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-2431"><a href="#-2431"><span class="linenos">2431</span></a>        <span class="n">ff</span><span class="p">,</span>
</span><span id="L-2432"><a href="#-2432"><span class="linenos">2432</span></a>        <span class="n">z</span><span class="p">,</span>
</span><span id="L-2433"><a href="#-2433"><span class="linenos">2433</span></a>        <span class="n">throw</span><span class="p">,</span>
</span><span id="L-2434"><a href="#-2434"><span class="linenos">2434</span></a>        <span class="n">sigma</span><span class="p">,</span>
</span><span id="L-2435"><a href="#-2435"><span class="linenos">2435</span></a>        <span class="n">x</span><span class="p">,</span>
</span><span id="L-2436"><a href="#-2436"><span class="linenos">2436</span></a>        <span class="n">y</span><span class="p">,</span>
</span><span id="L-2437"><a href="#-2437"><span class="linenos">2437</span></a>        <span class="n">xy_dis_norm</span><span class="p">,</span>
</span><span id="L-2438"><a href="#-2438"><span class="linenos">2438</span></a>        <span class="n">ellipsoid</span><span class="p">,</span>
</span><span id="L-2439"><a href="#-2439"><span class="linenos">2439</span></a>        <span class="n">z_idx</span><span class="p">,</span>
</span><span id="L-2440"><a href="#-2440"><span class="linenos">2440</span></a>        <span class="n">xy_dis</span><span class="p">,</span>
</span><span id="L-2441"><a href="#-2441"><span class="linenos">2441</span></a>        <span class="n">index</span><span class="p">,</span>
</span><span id="L-2442"><a href="#-2442"><span class="linenos">2442</span></a>        <span class="n">alpha</span><span class="p">,</span>
</span><span id="L-2443"><a href="#-2443"><span class="linenos">2443</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-2444"><a href="#-2444"><span class="linenos">2444</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2445"><a href="#-2445"><span class="linenos">2445</span></a><span class="sd">        Fault Summary Plot</span>
</span><span id="L-2446"><a href="#-2446"><span class="linenos">2446</span></a><span class="sd">        ------------------</span>
</span><span id="L-2447"><a href="#-2447"><span class="linenos">2447</span></a>
</span><span id="L-2448"><a href="#-2448"><span class="linenos">2448</span></a><span class="sd">        Generates a fault summary plot.</span>
</span><span id="L-2449"><a href="#-2449"><span class="linenos">2449</span></a>
</span><span id="L-2450"><a href="#-2450"><span class="linenos">2450</span></a><span class="sd">        Parameters</span>
</span><span id="L-2451"><a href="#-2451"><span class="linenos">2451</span></a><span class="sd">        ----------</span>
</span><span id="L-2452"><a href="#-2452"><span class="linenos">2452</span></a><span class="sd">        ff : _type_</span>
</span><span id="L-2453"><a href="#-2453"><span class="linenos">2453</span></a><span class="sd">            _description_</span>
</span><span id="L-2454"><a href="#-2454"><span class="linenos">2454</span></a><span class="sd">        z : _type_</span>
</span><span id="L-2455"><a href="#-2455"><span class="linenos">2455</span></a><span class="sd">            _description_</span>
</span><span id="L-2456"><a href="#-2456"><span class="linenos">2456</span></a><span class="sd">        throw : _type_</span>
</span><span id="L-2457"><a href="#-2457"><span class="linenos">2457</span></a><span class="sd">            _description_</span>
</span><span id="L-2458"><a href="#-2458"><span class="linenos">2458</span></a><span class="sd">        sigma : _type_</span>
</span><span id="L-2459"><a href="#-2459"><span class="linenos">2459</span></a><span class="sd">            _description_</span>
</span><span id="L-2460"><a href="#-2460"><span class="linenos">2460</span></a><span class="sd">        x : _type_</span>
</span><span id="L-2461"><a href="#-2461"><span class="linenos">2461</span></a><span class="sd">            _description_</span>
</span><span id="L-2462"><a href="#-2462"><span class="linenos">2462</span></a><span class="sd">        y : _type_</span>
</span><span id="L-2463"><a href="#-2463"><span class="linenos">2463</span></a><span class="sd">            _description_</span>
</span><span id="L-2464"><a href="#-2464"><span class="linenos">2464</span></a><span class="sd">        xy_dis_norm : _type_</span>
</span><span id="L-2465"><a href="#-2465"><span class="linenos">2465</span></a><span class="sd">            _description_</span>
</span><span id="L-2466"><a href="#-2466"><span class="linenos">2466</span></a><span class="sd">        ellipsoid : _type_</span>
</span><span id="L-2467"><a href="#-2467"><span class="linenos">2467</span></a><span class="sd">            _description_</span>
</span><span id="L-2468"><a href="#-2468"><span class="linenos">2468</span></a><span class="sd">        z_idx : _type_</span>
</span><span id="L-2469"><a href="#-2469"><span class="linenos">2469</span></a><span class="sd">            _description_</span>
</span><span id="L-2470"><a href="#-2470"><span class="linenos">2470</span></a><span class="sd">        xy_dis : _type_</span>
</span><span id="L-2471"><a href="#-2471"><span class="linenos">2471</span></a><span class="sd">            _description_</span>
</span><span id="L-2472"><a href="#-2472"><span class="linenos">2472</span></a><span class="sd">        index : _type_</span>
</span><span id="L-2473"><a href="#-2473"><span class="linenos">2473</span></a><span class="sd">            _description_</span>
</span><span id="L-2474"><a href="#-2474"><span class="linenos">2474</span></a><span class="sd">        alpha : _type_</span>
</span><span id="L-2475"><a href="#-2475"><span class="linenos">2475</span></a><span class="sd">            _description_</span>
</span><span id="L-2476"><a href="#-2476"><span class="linenos">2476</span></a><span class="sd">        </span>
</span><span id="L-2477"><a href="#-2477"><span class="linenos">2477</span></a><span class="sd">        Returns</span>
</span><span id="L-2478"><a href="#-2478"><span class="linenos">2478</span></a><span class="sd">        -------</span>
</span><span id="L-2479"><a href="#-2479"><span class="linenos">2479</span></a><span class="sd">        None</span>
</span><span id="L-2480"><a href="#-2480"><span class="linenos">2480</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-2481"><a href="#-2481"><span class="linenos">2481</span></a>        <span class="kn">import</span> <span class="nn">os</span>
</span><span id="L-2482"><a href="#-2482"><span class="linenos">2482</span></a>        <span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">degrees</span>
</span><span id="L-2483"><a href="#-2483"><span class="linenos">2483</span></a>        <span class="kn">from</span> <span class="nn">datagenerator.util</span> <span class="kn">import</span> <span class="n">import_matplotlib</span>
</span><span id="L-2484"><a href="#-2484"><span class="linenos">2484</span></a>
</span><span id="L-2485"><a href="#-2485"><span class="linenos">2485</span></a>        <span class="n">plt</span> <span class="o">=</span> <span class="n">import_matplotlib</span><span class="p">()</span>
</span><span id="L-2486"><a href="#-2486"><span class="linenos">2486</span></a>        <span class="c1"># Import axes3d, required to create plot with projection=&#39;3d&#39; below. DO NOT REMOVE!</span>
</span><span id="L-2487"><a href="#-2487"><span class="linenos">2487</span></a>        <span class="kn">from</span> <span class="nn">mpl_toolkits.mplot3d</span> <span class="kn">import</span> <span class="n">axes3d</span>
</span><span id="L-2488"><a href="#-2488"><span class="linenos">2488</span></a>        <span class="kn">from</span> <span class="nn">mpl_toolkits.axes_grid1</span> <span class="kn">import</span> <span class="n">make_axes_locatable</span>
</span><span id="L-2489"><a href="#-2489"><span class="linenos">2489</span></a>
</span><span id="L-2490"><a href="#-2490"><span class="linenos">2490</span></a>        <span class="c1"># Make summary picture</span>
</span><span id="L-2491"><a href="#-2491"><span class="linenos">2491</span></a>        <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span><span id="L-2492"><a href="#-2492"><span class="linenos">2492</span></a>        <span class="n">ax0</span><span class="p">,</span> <span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">,</span> <span class="n">ax3</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
</span><span id="L-2493"><a href="#-2493"><span class="linenos">2493</span></a>        <span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
</span><span id="L-2494"><a href="#-2494"><span class="linenos">2494</span></a>        <span class="c1"># PLot Z displacement</span>
</span><span id="L-2495"><a href="#-2495"><span class="linenos">2495</span></a>        <span class="n">ax0</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ff</span><span class="p">(</span><span class="n">z</span><span class="p">))</span>
</span><span id="L-2496"><a href="#-2496"><span class="linenos">2496</span></a>        <span class="n">ax0</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Fault with throw </span><span class="si">%s</span><span class="s2"> and sigma </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">throw</span><span class="p">,</span> <span class="n">sigma</span><span class="p">))</span>
</span><span id="L-2497"><a href="#-2497"><span class="linenos">2497</span></a>        <span class="n">ax0</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Z axis&quot;</span><span class="p">)</span>
</span><span id="L-2498"><a href="#-2498"><span class="linenos">2498</span></a>        <span class="n">ax0</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Throw&quot;</span><span class="p">)</span>
</span><span id="L-2499"><a href="#-2499"><span class="linenos">2499</span></a>        <span class="c1"># Plot 3D XY displacement</span>
</span><span id="L-2500"><a href="#-2500"><span class="linenos">2500</span></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>
</span><span id="L-2501"><a href="#-2501"><span class="linenos">2501</span></a>        <span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">222</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s2">&quot;3d&quot;</span><span class="p">)</span>
</span><span id="L-2502"><a href="#-2502"><span class="linenos">2502</span></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">plot_surface</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">xy_dis_norm</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;Spectral&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-2503"><a href="#-2503"><span class="linenos">2503</span></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;X axis&quot;</span><span class="p">)</span>
</span><span id="L-2504"><a href="#-2504"><span class="linenos">2504</span></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Y axis&quot;</span><span class="p">)</span>
</span><span id="L-2505"><a href="#-2505"><span class="linenos">2505</span></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">set_zlabel</span><span class="p">(</span><span class="s2">&quot;Throw fraction&quot;</span><span class="p">)</span>
</span><span id="L-2506"><a href="#-2506"><span class="linenos">2506</span></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;3D XY displacement&quot;</span><span class="p">)</span>
</span><span id="L-2507"><a href="#-2507"><span class="linenos">2507</span></a>        <span class="c1"># Ellipsoid location</span>
</span><span id="L-2508"><a href="#-2508"><span class="linenos">2508</span></a>        <span class="n">weights</span> <span class="o">=</span> <span class="n">ellipsoid</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">z_idx</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>
</span><span id="L-2509"><a href="#-2509"><span class="linenos">2509</span></a>        <span class="c1"># Plot un-rotated XY displacement</span>
</span><span id="L-2510"><a href="#-2510"><span class="linenos">2510</span></a>        <span class="n">cax2</span> <span class="o">=</span> <span class="n">ax2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">rot90</span><span class="p">(</span><span class="n">xy_dis_norm</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
</span><span id="L-2511"><a href="#-2511"><span class="linenos">2511</span></a>        <span class="c1"># Levels for imshow contour</span>
</span><span id="L-2512"><a href="#-2512"><span class="linenos">2512</span></a>        <span class="n">levels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span>
</span><span id="L-2513"><a href="#-2513"><span class="linenos">2513</span></a>        <span class="c1"># Plot contour</span>
</span><span id="L-2514"><a href="#-2514"><span class="linenos">2514</span></a>        <span class="n">ax2</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">rot90</span><span class="p">(</span><span class="n">xy_dis_norm</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">levels</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="n">linestyles</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">)</span>
</span><span id="L-2515"><a href="#-2515"><span class="linenos">2515</span></a>        <span class="n">divider</span> <span class="o">=</span> <span class="n">make_axes_locatable</span><span class="p">(</span><span class="n">ax2</span><span class="p">)</span>
</span><span id="L-2516"><a href="#-2516"><span class="linenos">2516</span></a>        <span class="n">cax4</span> <span class="o">=</span> <span class="n">divider</span><span class="o">.</span><span class="n">append_axes</span><span class="p">(</span><span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s2">&quot;5%&quot;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
</span><span id="L-2517"><a href="#-2517"><span class="linenos">2517</span></a>        <span class="n">cbar2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">cax2</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">cax4</span><span class="p">)</span>
</span><span id="L-2518"><a href="#-2518"><span class="linenos">2518</span></a>        <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;X axis&quot;</span><span class="p">)</span>
</span><span id="L-2519"><a href="#-2519"><span class="linenos">2519</span></a>        <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Y axis&quot;</span><span class="p">)</span>
</span><span id="L-2520"><a href="#-2520"><span class="linenos">2520</span></a>        <span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;2D projection of XY displacement unrotated&quot;</span><span class="p">)</span>
</span><span id="L-2521"><a href="#-2521"><span class="linenos">2521</span></a>        <span class="c1">############################################################</span>
</span><span id="L-2522"><a href="#-2522"><span class="linenos">2522</span></a>        <span class="c1"># Plot rotated displacement and contour</span>
</span><span id="L-2523"><a href="#-2523"><span class="linenos">2523</span></a>        <span class="n">cax3</span> <span class="o">=</span> <span class="n">ax3</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">rot90</span><span class="p">(</span><span class="n">xy_dis</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">z_idx</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span> <span class="mi">3</span><span class="p">))</span>
</span><span id="L-2524"><a href="#-2524"><span class="linenos">2524</span></a>        <span class="n">ax3</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span>
</span><span id="L-2525"><a href="#-2525"><span class="linenos">2525</span></a>            <span class="n">np</span><span class="o">.</span><span class="n">rot90</span><span class="p">(</span><span class="n">xy_dis</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">z_idx</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span> <span class="mi">3</span><span class="p">),</span> <span class="n">levels</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="n">linestyles</span><span class="o">=</span><span class="s2">&quot;-&quot;</span>
</span><span id="L-2526"><a href="#-2526"><span class="linenos">2526</span></a>        <span class="p">)</span>
</span><span id="L-2527"><a href="#-2527"><span class="linenos">2527</span></a>        <span class="c1"># Add ellipsoid shape</span>
</span><span id="L-2528"><a href="#-2528"><span class="linenos">2528</span></a>        <span class="n">ax3</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">rot90</span><span class="p">(</span><span class="n">weights</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">levels</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">colors</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">linestyles</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">)</span>
</span><span id="L-2529"><a href="#-2529"><span class="linenos">2529</span></a>        <span class="n">divider</span> <span class="o">=</span> <span class="n">make_axes_locatable</span><span class="p">(</span><span class="n">ax3</span><span class="p">)</span>
</span><span id="L-2530"><a href="#-2530"><span class="linenos">2530</span></a>        <span class="n">cax5</span> <span class="o">=</span> <span class="n">divider</span><span class="o">.</span><span class="n">append_axes</span><span class="p">(</span><span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s2">&quot;5%&quot;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
</span><span id="L-2531"><a href="#-2531"><span class="linenos">2531</span></a>        <span class="n">cbar3</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">cax3</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">cax5</span><span class="p">)</span>
</span><span id="L-2532"><a href="#-2532"><span class="linenos">2532</span></a>        <span class="n">ax3</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;X axis&quot;</span><span class="p">)</span>
</span><span id="L-2533"><a href="#-2533"><span class="linenos">2533</span></a>        <span class="n">ax3</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Y axis&quot;</span><span class="p">)</span>
</span><span id="L-2534"><a href="#-2534"><span class="linenos">2534</span></a>        <span class="n">ax3</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span>
</span><span id="L-2535"><a href="#-2535"><span class="linenos">2535</span></a>            <span class="s2">&quot;2D projection of XY displacement rotated by </span><span class="si">%s</span><span class="s2"> degrees&quot;</span>
</span><span id="L-2536"><a href="#-2536"><span class="linenos">2536</span></a>            <span class="o">%</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">degrees</span><span class="p">(</span><span class="n">alpha</span><span class="p">)))</span>
</span><span id="L-2537"><a href="#-2537"><span class="linenos">2537</span></a>        <span class="p">)</span>
</span><span id="L-2538"><a href="#-2538"><span class="linenos">2538</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span>
</span><span id="L-2539"><a href="#-2539"><span class="linenos">2539</span></a>            <span class="s2">&quot;XYZ displacement parameters for fault Nr </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">),</span>
</span><span id="L-2540"><a href="#-2540"><span class="linenos">2540</span></a>            <span class="n">fontweight</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span><span class="p">,</span>
</span><span id="L-2541"><a href="#-2541"><span class="linenos">2541</span></a>        <span class="p">)</span>
</span><span id="L-2542"><a href="#-2542"><span class="linenos">2542</span></a>        <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</span><span id="L-2543"><a href="#-2543"><span class="linenos">2543</span></a>        <span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">top</span><span class="o">=</span><span class="mf">0.94</span><span class="p">)</span>
</span><span id="L-2544"><a href="#-2544"><span class="linenos">2544</span></a>        <span class="n">image_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="L-2545"><a href="#-2545"><span class="linenos">2545</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">work_subfolder</span><span class="p">,</span> <span class="s2">&quot;QC_plot__Fault_</span><span class="si">%s</span><span class="s2">.png&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
</span><span id="L-2546"><a href="#-2546"><span class="linenos">2546</span></a>        <span class="p">)</span>
</span><span id="L-2547"><a href="#-2547"><span class="linenos">2547</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">image_path</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;png&quot;</span><span class="p">)</span>
</span><span id="L-2548"><a href="#-2548"><span class="linenos">2548</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
</span><span id="L-2549"><a href="#-2549"><span class="linenos">2549</span></a>
</span><span id="L-2550"><a href="#-2550"><span class="linenos">2550</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-2551"><a href="#-2551"><span class="linenos">2551</span></a>    <span class="k">def</span> <span class="nf">create_binary_segmentations_post_faulting</span><span class="p">(</span><span class="n">cube</span><span class="p">,</span> <span class="n">segmentation_threshold</span><span class="p">):</span>
</span><span id="L-2552"><a href="#-2552"><span class="linenos">2552</span></a>        <span class="n">cube</span><span class="p">[</span><span class="n">cube</span> <span class="o">&gt;=</span> <span class="n">segmentation_threshold</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="L-2553"><a href="#-2553"><span class="linenos">2553</span></a>        <span class="k">return</span> <span class="n">cube</span>
</span><span id="L-2554"><a href="#-2554"><span class="linenos">2554</span></a>
</span><span id="L-2555"><a href="#-2555"><span class="linenos">2555</span></a>    <span class="k">def</span> <span class="nf">reassign_channel_segment_encoding</span><span class="p">(</span>
</span><span id="L-2556"><a href="#-2556"><span class="linenos">2556</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-2557"><a href="#-2557"><span class="linenos">2557</span></a>        <span class="n">faulted_age</span><span class="p">,</span>
</span><span id="L-2558"><a href="#-2558"><span class="linenos">2558</span></a>        <span class="n">floodplain_shale</span><span class="p">,</span>
</span><span id="L-2559"><a href="#-2559"><span class="linenos">2559</span></a>        <span class="n">channel_fill</span><span class="p">,</span>
</span><span id="L-2560"><a href="#-2560"><span class="linenos">2560</span></a>        <span class="n">shale_channel_drape</span><span class="p">,</span>
</span><span id="L-2561"><a href="#-2561"><span class="linenos">2561</span></a>        <span class="n">levee</span><span class="p">,</span>
</span><span id="L-2562"><a href="#-2562"><span class="linenos">2562</span></a>        <span class="n">crevasse</span><span class="p">,</span>
</span><span id="L-2563"><a href="#-2563"><span class="linenos">2563</span></a>        <span class="n">channel_flag_lut</span><span class="p">,</span>
</span><span id="L-2564"><a href="#-2564"><span class="linenos">2564</span></a>    <span class="p">):</span>
</span><span id="L-2565"><a href="#-2565"><span class="linenos">2565</span></a>        <span class="c1"># Generate list of horizons with channel episodes</span>
</span><span id="L-2566"><a href="#-2566"><span class="linenos">2566</span></a>        <span class="n">channel_segments</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">floodplain_shale</span><span class="p">)</span>
</span><span id="L-2567"><a href="#-2567"><span class="linenos">2567</span></a>        <span class="n">channel_horizons_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
</span><span id="L-2568"><a href="#-2568"><span class="linenos">2568</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faulted_depth_maps</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="mi">7</span><span class="p">):</span>
</span><span id="L-2569"><a href="#-2569"><span class="linenos">2569</span></a>            <span class="k">if</span> <span class="n">channel_flag_lut</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-2570"><a href="#-2570"><span class="linenos">2570</span></a>                <span class="n">channel_horizons_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</span><span id="L-2571"><a href="#-2571"><span class="linenos">2571</span></a>        <span class="n">channel_horizons_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">999</span><span class="p">)</span>
</span><span id="L-2572"><a href="#-2572"><span class="linenos">2572</span></a>
</span><span id="L-2573"><a href="#-2573"><span class="linenos">2573</span></a>        <span class="c1"># Re-assign correct channel segments encoding</span>
</span><span id="L-2574"><a href="#-2574"><span class="linenos">2574</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">iLayer</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">channel_horizons_list</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
</span><span id="L-2575"><a href="#-2575"><span class="linenos">2575</span></a>            <span class="k">if</span> <span class="n">iLayer</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">iLayer</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">faulted_depth_maps</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
</span><span id="L-2576"><a href="#-2576"><span class="linenos">2576</span></a>                <span class="c1"># loop through channel facies</span>
</span><span id="L-2577"><a href="#-2577"><span class="linenos">2577</span></a>                <span class="c1">#    --- 0  is floodplain shale</span>
</span><span id="L-2578"><a href="#-2578"><span class="linenos">2578</span></a>                <span class="c1">#    --- 1  is channel fill (sand)</span>
</span><span id="L-2579"><a href="#-2579"><span class="linenos">2579</span></a>                <span class="c1">#    --- 2  is shale channel drape</span>
</span><span id="L-2580"><a href="#-2580"><span class="linenos">2580</span></a>                <span class="c1">#    --- 3  is levee (mid quality sand)</span>
</span><span id="L-2581"><a href="#-2581"><span class="linenos">2581</span></a>                <span class="c1">#    --- 4  is crevasse (low quality sand)</span>
</span><span id="L-2582"><a href="#-2582"><span class="linenos">2582</span></a>                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">4001</span><span class="p">,</span> <span class="mi">1000</span><span class="p">):</span>
</span><span id="L-2583"><a href="#-2583"><span class="linenos">2583</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="L-2584"><a href="#-2584"><span class="linenos">2584</span></a>                        <span class="s2">&quot; ... re-assign channel segments after faulting: i, iLayer, j = &quot;</span><span class="p">,</span>
</span><span id="L-2585"><a href="#-2585"><span class="linenos">2585</span></a>                        <span class="n">i</span><span class="p">,</span>
</span><span id="L-2586"><a href="#-2586"><span class="linenos">2586</span></a>                        <span class="n">iLayer</span><span class="p">,</span>
</span><span id="L-2587"><a href="#-2587"><span class="linenos">2587</span></a>                        <span class="n">j</span><span class="p">,</span>
</span><span id="L-2588"><a href="#-2588"><span class="linenos">2588</span></a>                    <span class="p">)</span>
</span><span id="L-2589"><a href="#-2589"><span class="linenos">2589</span></a>                    <span class="n">channel_facies_code</span> <span class="o">=</span> <span class="n">j</span> <span class="o">+</span> <span class="n">iLayer</span>
</span><span id="L-2590"><a href="#-2590"><span class="linenos">2590</span></a>                    <span class="n">layers_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
</span><span id="L-2591"><a href="#-2591"><span class="linenos">2591</span></a>                        <span class="p">(</span>
</span><span id="L-2592"><a href="#-2592"><span class="linenos">2592</span></a>                            <span class="p">(</span><span class="n">faulted_age</span> <span class="o">&gt;=</span> <span class="n">iLayer</span><span class="p">)</span>
</span><span id="L-2593"><a href="#-2593"><span class="linenos">2593</span></a>                            <span class="o">&amp;</span> <span class="p">(</span><span class="n">faulted_age</span> <span class="o">&lt;</span> <span class="n">channel_horizons_list</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
</span><span id="L-2594"><a href="#-2594"><span class="linenos">2594</span></a>                        <span class="p">),</span>
</span><span id="L-2595"><a href="#-2595"><span class="linenos">2595</span></a>                        <span class="mi">1</span><span class="p">,</span>
</span><span id="L-2596"><a href="#-2596"><span class="linenos">2596</span></a>                        <span class="mi">0</span><span class="p">,</span>
</span><span id="L-2597"><a href="#-2597"><span class="linenos">2597</span></a>                    <span class="p">)</span>
</span><span id="L-2598"><a href="#-2598"><span class="linenos">2598</span></a>                    <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="mi">1000</span><span class="p">:</span>
</span><span id="L-2599"><a href="#-2599"><span class="linenos">2599</span></a>                        <span class="n">channel_segments</span><span class="p">[</span>
</span><span id="L-2600"><a href="#-2600"><span class="linenos">2600</span></a>                            <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">layers_mask</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="n">channel_fill</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-2601"><a href="#-2601"><span class="linenos">2601</span></a>                        <span class="p">]</span> <span class="o">=</span> <span class="n">channel_facies_code</span>
</span><span id="L-2602"><a href="#-2602"><span class="linenos">2602</span></a>                        <span class="n">faulted_age</span><span class="p">[</span>
</span><span id="L-2603"><a href="#-2603"><span class="linenos">2603</span></a>                            <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">layers_mask</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="n">channel_fill</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-2604"><a href="#-2604"><span class="linenos">2604</span></a>                        <span class="p">]</span> <span class="o">=</span> <span class="n">channel_facies_code</span>
</span><span id="L-2605"><a href="#-2605"><span class="linenos">2605</span></a>                    <span class="k">elif</span> <span class="n">j</span> <span class="o">==</span> <span class="mi">2000</span><span class="p">:</span>
</span><span id="L-2606"><a href="#-2606"><span class="linenos">2606</span></a>                        <span class="n">channel_segments</span><span class="p">[</span>
</span><span id="L-2607"><a href="#-2607"><span class="linenos">2607</span></a>                            <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">layers_mask</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="n">shale_channel_drape</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-2608"><a href="#-2608"><span class="linenos">2608</span></a>                        <span class="p">]</span> <span class="o">=</span> <span class="n">channel_facies_code</span>
</span><span id="L-2609"><a href="#-2609"><span class="linenos">2609</span></a>                        <span class="n">faulted_age</span><span class="p">[</span>
</span><span id="L-2610"><a href="#-2610"><span class="linenos">2610</span></a>                            <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">layers_mask</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="n">shale_channel_drape</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-2611"><a href="#-2611"><span class="linenos">2611</span></a>                        <span class="p">]</span> <span class="o">=</span> <span class="n">channel_facies_code</span>
</span><span id="L-2612"><a href="#-2612"><span class="linenos">2612</span></a>                    <span class="k">elif</span> <span class="n">j</span> <span class="o">==</span> <span class="mi">3000</span><span class="p">:</span>
</span><span id="L-2613"><a href="#-2613"><span class="linenos">2613</span></a>                        <span class="n">channel_segments</span><span class="p">[</span>
</span><span id="L-2614"><a href="#-2614"><span class="linenos">2614</span></a>                            <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">layers_mask</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="n">levee</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-2615"><a href="#-2615"><span class="linenos">2615</span></a>                        <span class="p">]</span> <span class="o">=</span> <span class="n">channel_facies_code</span>
</span><span id="L-2616"><a href="#-2616"><span class="linenos">2616</span></a>                        <span class="n">faulted_age</span><span class="p">[</span>
</span><span id="L-2617"><a href="#-2617"><span class="linenos">2617</span></a>                            <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">layers_mask</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="n">levee</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-2618"><a href="#-2618"><span class="linenos">2618</span></a>                        <span class="p">]</span> <span class="o">=</span> <span class="n">channel_facies_code</span>
</span><span id="L-2619"><a href="#-2619"><span class="linenos">2619</span></a>                    <span class="k">elif</span> <span class="n">j</span> <span class="o">==</span> <span class="mi">4000</span><span class="p">:</span>
</span><span id="L-2620"><a href="#-2620"><span class="linenos">2620</span></a>                        <span class="n">channel_segments</span><span class="p">[</span>
</span><span id="L-2621"><a href="#-2621"><span class="linenos">2621</span></a>                            <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">layers_mask</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="n">crevasse</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-2622"><a href="#-2622"><span class="linenos">2622</span></a>                        <span class="p">]</span> <span class="o">=</span> <span class="n">channel_facies_code</span>
</span><span id="L-2623"><a href="#-2623"><span class="linenos">2623</span></a>                        <span class="n">faulted_age</span><span class="p">[</span>
</span><span id="L-2624"><a href="#-2624"><span class="linenos">2624</span></a>                            <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">layers_mask</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="n">crevasse</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-2625"><a href="#-2625"><span class="linenos">2625</span></a>                        <span class="p">]</span> <span class="o">=</span> <span class="n">channel_facies_code</span>
</span><span id="L-2626"><a href="#-2626"><span class="linenos">2626</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; ... finished Re-assign correct channel segments&quot;</span><span class="p">)</span>
</span><span id="L-2627"><a href="#-2627"><span class="linenos">2627</span></a>        <span class="k">return</span> <span class="n">channel_segments</span><span class="p">,</span> <span class="n">faulted_age</span>
</span><span id="L-2628"><a href="#-2628"><span class="linenos">2628</span></a>
</span><span id="L-2629"><a href="#-2629"><span class="linenos">2629</span></a>    <span class="k">def</span> <span class="nf">_get_fault_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-2630"><a href="#-2630"><span class="linenos">2630</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-2631"><a href="#-2631"><span class="linenos">2631</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fault_params_random</span>
</span><span id="L-2632"><a href="#-2632"><span class="linenos">2632</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="mf">1.0</span><span class="p">:</span>
</span><span id="L-2633"><a href="#-2633"><span class="linenos">2633</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">clustering</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-2634"><a href="#-2634"><span class="linenos">2634</span></a>                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fault_params_self_branching</span>
</span><span id="L-2635"><a href="#-2635"><span class="linenos">2635</span></a>            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">clustering</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-2636"><a href="#-2636"><span class="linenos">2636</span></a>                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fault_params_stairs</span>
</span><span id="L-2637"><a href="#-2637"><span class="linenos">2637</span></a>            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">clustering</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="L-2638"><a href="#-2638"><span class="linenos">2638</span></a>                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fault_params_relay_ramps</span>
</span><span id="L-2639"><a href="#-2639"><span class="linenos">2639</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-2640"><a href="#-2640"><span class="linenos">2640</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">clustering</span><span class="p">)</span>
</span><span id="L-2641"><a href="#-2641"><span class="linenos">2641</span></a>
</span><span id="L-2642"><a href="#-2642"><span class="linenos">2642</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="mf">2.0</span><span class="p">:</span>
</span><span id="L-2643"><a href="#-2643"><span class="linenos">2643</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fault_params_horst_graben</span>
</span><span id="L-2644"><a href="#-2644"><span class="linenos">2644</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-2645"><a href="#-2645"><span class="linenos">2645</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">mode</span><span class="p">)</span>
</span><span id="L-2646"><a href="#-2646"><span class="linenos">2646</span></a>
</span><span id="L-2647"><a href="#-2647"><span class="linenos">2647</span></a>    <span class="k">def</span> <span class="nf">_fault_params_random</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-2648"><a href="#-2648"><span class="linenos">2648</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; ... </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">number_faults</span><span class="si">}</span><span class="s2"> faults will be inserted randomly&quot;</span><span class="p">)</span>
</span><span id="L-2649"><a href="#-2649"><span class="linenos">2649</span></a>
</span><span id="L-2650"><a href="#-2650"><span class="linenos">2650</span></a>        <span class="c1"># Fault origin</span>
</span><span id="L-2651"><a href="#-2651"><span class="linenos">2651</span></a>        <span class="n">x0_min</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mf">4.0</span><span class="p">)</span>
</span><span id="L-2652"><a href="#-2652"><span class="linenos">2652</span></a>        <span class="n">x0_max</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">)</span>
</span><span id="L-2653"><a href="#-2653"><span class="linenos">2653</span></a>        <span class="n">y0_min</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="mf">4.0</span><span class="p">)</span>
</span><span id="L-2654"><a href="#-2654"><span class="linenos">2654</span></a>        <span class="n">y0_max</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">)</span>
</span><span id="L-2655"><a href="#-2655"><span class="linenos">2655</span></a>
</span><span id="L-2656"><a href="#-2656"><span class="linenos">2656</span></a>        <span class="c1"># Principal semi-axes location of fault ellipsoid</span>
</span><span id="L-2657"><a href="#-2657"><span class="linenos">2657</span></a>        <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">600</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">number_faults</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
</span><span id="L-2658"><a href="#-2658"><span class="linenos">2658</span></a>        <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">600</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">number_faults</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
</span><span id="L-2659"><a href="#-2659"><span class="linenos">2659</span></a>        <span class="n">x0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span>
</span><span id="L-2660"><a href="#-2660"><span class="linenos">2660</span></a>            <span class="n">x0_min</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">+</span> <span class="n">x0_max</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">number_faults</span>
</span><span id="L-2661"><a href="#-2661"><span class="linenos">2661</span></a>        <span class="p">)</span>
</span><span id="L-2662"><a href="#-2662"><span class="linenos">2662</span></a>        <span class="n">y0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span>
</span><span id="L-2663"><a href="#-2663"><span class="linenos">2663</span></a>            <span class="n">y0_min</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">b</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="o">+</span> <span class="n">y0_max</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">number_faults</span>
</span><span id="L-2664"><a href="#-2664"><span class="linenos">2664</span></a>        <span class="p">)</span>
</span><span id="L-2665"><a href="#-2665"><span class="linenos">2665</span></a>        <span class="n">z0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span>
</span><span id="L-2666"><a href="#-2666"><span class="linenos">2666</span></a>            <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="mf">2.0</span><span class="p">,</span>
</span><span id="L-2667"><a href="#-2667"><span class="linenos">2667</span></a>            <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="mf">6.0</span><span class="p">,</span>
</span><span id="L-2668"><a href="#-2668"><span class="linenos">2668</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">number_faults</span><span class="p">,</span>
</span><span id="L-2669"><a href="#-2669"><span class="linenos">2669</span></a>        <span class="p">)</span>
</span><span id="L-2670"><a href="#-2670"><span class="linenos">2670</span></a>        <span class="n">_c0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">infill_factor</span> <span class="o">*</span> <span class="mf">4.0</span> <span class="o">-</span> <span class="n">z0</span>
</span><span id="L-2671"><a href="#-2671"><span class="linenos">2671</span></a>        <span class="n">_c1</span> <span class="o">=</span> <span class="n">_c0</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">infill_factor</span> <span class="o">/</span> <span class="mf">4.0</span>
</span><span id="L-2672"><a href="#-2672"><span class="linenos">2672</span></a>        <span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">_c0</span><span class="p">,</span> <span class="n">_c1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">number_faults</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
</span><span id="L-2673"><a href="#-2673"><span class="linenos">2673</span></a>        <span class="n">tilt_pct</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">number_faults</span><span class="p">)</span>
</span><span id="L-2674"><a href="#-2674"><span class="linenos">2674</span></a>        <span class="n">throw_lut</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span>
</span><span id="L-2675"><a href="#-2675"><span class="linenos">2675</span></a>            <span class="n">low</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">low_fault_throw</span><span class="p">,</span>
</span><span id="L-2676"><a href="#-2676"><span class="linenos">2676</span></a>            <span class="n">high</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">high_fault_throw</span><span class="p">,</span>
</span><span id="L-2677"><a href="#-2677"><span class="linenos">2677</span></a>            <span class="n">size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">number_faults</span><span class="p">,</span>
</span><span id="L-2678"><a href="#-2678"><span class="linenos">2678</span></a>        <span class="p">)</span>
</span><span id="L-2679"><a href="#-2679"><span class="linenos">2679</span></a>
</span><span id="L-2680"><a href="#-2680"><span class="linenos">2680</span></a>        <span class="n">fault_param_dict</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-2681"><a href="#-2681"><span class="linenos">2681</span></a>            <span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="n">a</span><span class="p">,</span>
</span><span id="L-2682"><a href="#-2682"><span class="linenos">2682</span></a>            <span class="s2">&quot;b&quot;</span><span class="p">:</span> <span class="n">b</span><span class="p">,</span>
</span><span id="L-2683"><a href="#-2683"><span class="linenos">2683</span></a>            <span class="s2">&quot;c&quot;</span><span class="p">:</span> <span class="n">c</span><span class="p">,</span>
</span><span id="L-2684"><a href="#-2684"><span class="linenos">2684</span></a>            <span class="s2">&quot;x0&quot;</span><span class="p">:</span> <span class="n">x0</span><span class="p">,</span>
</span><span id="L-2685"><a href="#-2685"><span class="linenos">2685</span></a>            <span class="s2">&quot;y0&quot;</span><span class="p">:</span> <span class="n">y0</span><span class="p">,</span>
</span><span id="L-2686"><a href="#-2686"><span class="linenos">2686</span></a>            <span class="s2">&quot;z0&quot;</span><span class="p">:</span> <span class="n">z0</span><span class="p">,</span>
</span><span id="L-2687"><a href="#-2687"><span class="linenos">2687</span></a>            <span class="s2">&quot;tilt_pct&quot;</span><span class="p">:</span> <span class="n">tilt_pct</span><span class="p">,</span>
</span><span id="L-2688"><a href="#-2688"><span class="linenos">2688</span></a>            <span class="s2">&quot;throw&quot;</span><span class="p">:</span> <span class="n">throw_lut</span><span class="p">,</span>
</span><span id="L-2689"><a href="#-2689"><span class="linenos">2689</span></a>        <span class="p">}</span>
</span><span id="L-2690"><a href="#-2690"><span class="linenos">2690</span></a>
</span><span id="L-2691"><a href="#-2691"><span class="linenos">2691</span></a>        <span class="k">return</span> <span class="n">fault_param_dict</span>
</span><span id="L-2692"><a href="#-2692"><span class="linenos">2692</span></a>
</span><span id="L-2693"><a href="#-2693"><span class="linenos">2693</span></a>    <span class="k">def</span> <span class="nf">_fault_params_self_branching</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-2694"><a href="#-2694"><span class="linenos">2694</span></a>        <span class="nb">print</span><span class="p">(</span>
</span><span id="L-2695"><a href="#-2695"><span class="linenos">2695</span></a>            <span class="sa">f</span><span class="s2">&quot; ... </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">number_faults</span><span class="si">}</span><span class="s2"> faults will be inserted in clustered mode with&quot;</span>
</span><span id="L-2696"><a href="#-2696"><span class="linenos">2696</span></a>        <span class="p">)</span>
</span><span id="L-2697"><a href="#-2697"><span class="linenos">2697</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; ... Self branching&quot;</span><span class="p">)</span>
</span><span id="L-2698"><a href="#-2698"><span class="linenos">2698</span></a>        <span class="n">x0_min</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-2699"><a href="#-2699"><span class="linenos">2699</span></a>        <span class="n">x0_max</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-2700"><a href="#-2700"><span class="linenos">2700</span></a>        <span class="n">y0_min</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-2701"><a href="#-2701"><span class="linenos">2701</span></a>        <span class="n">y0_max</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="L-2702"><a href="#-2702"><span class="linenos">2702</span></a>        <span class="c1"># Self Branching mode means that faults are inserted side by side with no separation.</span>
</span><span id="L-2703"><a href="#-2703"><span class="linenos">2703</span></a>        <span class="n">number_of_branches</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">number_faults</span> <span class="o">/</span> <span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span>
</span><span id="L-2704"><a href="#-2704"><span class="linenos">2704</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">number_faults</span> <span class="o">%</span> <span class="mi">3</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="L-2705"><a href="#-2705"><span class="linenos">2705</span></a>        <span class="p">)</span>
</span><span id="L-2706"><a href="#-2706"><span class="linenos">2706</span></a>
</span><span id="L-2707"><a href="#-2707"><span class="linenos">2707</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">number_of_branches</span><span class="p">):</span>
</span><span id="L-2708"><a href="#-2708"><span class="linenos">2708</span></a>            <span class="c1"># Initialize first fault center, offset center between each branch</span>
</span><span id="L-2709"><a href="#-2709"><span class="linenos">2709</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; ... Computing branch number &quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
</span><span id="L-2710"><a href="#-2710"><span class="linenos">2710</span></a>            <span class="n">b_ini</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">600</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="L-2711"><a href="#-2711"><span class="linenos">2711</span></a>            <span class="n">a_ini</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">600</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="L-2712"><a href="#-2712"><span class="linenos">2712</span></a>            <span class="k">if</span> <span class="n">a_ini</span> <span class="o">&gt;</span> <span class="n">b_ini</span><span class="p">:</span>
</span><span id="L-2713"><a href="#-2713"><span class="linenos">2713</span></a>                <span class="k">while</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">b_ini</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
</span><span id="L-2714"><a href="#-2714"><span class="linenos">2714</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; ... Recomputing b_ini for better branching&quot;</span><span class="p">)</span>
</span><span id="L-2715"><a href="#-2715"><span class="linenos">2715</span></a>                    <span class="n">b_ini</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">600</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="L-2716"><a href="#-2716"><span class="linenos">2716</span></a>                <span class="n">x0_ini</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">x0_min</span><span class="p">,</span> <span class="n">x0_max</span><span class="p">))</span>
</span><span id="L-2717"><a href="#-2717"><span class="linenos">2717</span></a>                <span class="n">range_1</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">y0_min</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">b_ini</span><span class="p">)),</span> <span class="mi">0</span><span class="p">))</span>
</span><span id="L-2718"><a href="#-2718"><span class="linenos">2718</span></a>                <span class="n">range_2</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])))</span>
</span><span id="L-2719"><a href="#-2719"><span class="linenos">2719</span></a>                <span class="n">y0_ini</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
</span><span id="L-2720"><a href="#-2720"><span class="linenos">2720</span></a>                    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">range_1</span> <span class="o">+</span> <span class="n">range_2</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">b_ini</span><span class="p">)</span> <span class="o">+</span> <span class="n">y0_max</span><span class="p">))</span>
</span><span id="L-2721"><a href="#-2721"><span class="linenos">2721</span></a>                <span class="p">)</span>
</span><span id="L-2722"><a href="#-2722"><span class="linenos">2722</span></a>                <span class="n">side</span> <span class="o">=</span> <span class="s2">&quot;x&quot;</span>
</span><span id="L-2723"><a href="#-2723"><span class="linenos">2723</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-2724"><a href="#-2724"><span class="linenos">2724</span></a>                <span class="k">while</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">a_ini</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
</span><span id="L-2725"><a href="#-2725"><span class="linenos">2725</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; ... Recomputing a_ini for better branching&quot;</span><span class="p">)</span>
</span><span id="L-2726"><a href="#-2726"><span class="linenos">2726</span></a>                    <span class="n">a_ini</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">600</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="L-2727"><a href="#-2727"><span class="linenos">2727</span></a>                <span class="n">range_1</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">x0_min</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">a_ini</span><span class="p">)),</span> <span class="mi">0</span><span class="p">))</span>
</span><span id="L-2728"><a href="#-2728"><span class="linenos">2728</span></a>                <span class="n">range_2</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])))</span>
</span><span id="L-2729"><a href="#-2729"><span class="linenos">2729</span></a>                <span class="n">x0_ini</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
</span><span id="L-2730"><a href="#-2730"><span class="linenos">2730</span></a>                    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
</span><span id="L-2731"><a href="#-2731"><span class="linenos">2731</span></a>                        <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span>
</span><span id="L-2732"><a href="#-2732"><span class="linenos">2732</span></a>                            <span class="n">range_1</span> <span class="o">+</span> <span class="n">range_2</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">a_ini</span><span class="p">)</span> <span class="o">+</span> <span class="n">x0_max</span><span class="p">)</span>
</span><span id="L-2733"><a href="#-2733"><span class="linenos">2733</span></a>                        <span class="p">)</span>
</span><span id="L-2734"><a href="#-2734"><span class="linenos">2734</span></a>                    <span class="p">)</span>
</span><span id="L-2735"><a href="#-2735"><span class="linenos">2735</span></a>                <span class="p">)</span>
</span><span id="L-2736"><a href="#-2736"><span class="linenos">2736</span></a>                <span class="n">y0_ini</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">y0_min</span><span class="p">,</span> <span class="n">y0_max</span><span class="p">))</span>
</span><span id="L-2737"><a href="#-2737"><span class="linenos">2737</span></a>                <span class="n">side</span> <span class="o">=</span> <span class="s2">&quot;y&quot;</span>
</span><span id="L-2738"><a href="#-2738"><span class="linenos">2738</span></a>            <span class="c1"># Compute the rest of the initial parameters normally</span>
</span><span id="L-2739"><a href="#-2739"><span class="linenos">2739</span></a>            <span class="n">z0_ini</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
</span><span id="L-2740"><a href="#-2740"><span class="linenos">2740</span></a>                <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span>
</span><span id="L-2741"><a href="#-2741"><span class="linenos">2741</span></a>                    <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="mf">2.0</span><span class="p">,</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="mf">6.0</span>
</span><span id="L-2742"><a href="#-2742"><span class="linenos">2742</span></a>                <span class="p">)</span>
</span><span id="L-2743"><a href="#-2743"><span class="linenos">2743</span></a>            <span class="p">)</span>
</span><span id="L-2744"><a href="#-2744"><span class="linenos">2744</span></a>
</span><span id="L-2745"><a href="#-2745"><span class="linenos">2745</span></a>            <span class="n">_c0_ini</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">infill_factor</span> <span class="o">*</span> <span class="mf">4.0</span> <span class="o">-</span> <span class="n">z0_ini</span>
</span><span id="L-2746"><a href="#-2746"><span class="linenos">2746</span></a>            <span class="n">_c1_ini</span> <span class="o">=</span> <span class="n">_c0_ini</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">infill_factor</span> <span class="o">/</span> <span class="mf">4.0</span>
</span><span id="L-2747"><a href="#-2747"><span class="linenos">2747</span></a>            <span class="n">c_ini</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">_c0_ini</span><span class="p">,</span> <span class="n">_c1_ini</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="L-2748"><a href="#-2748"><span class="linenos">2748</span></a>            <span class="n">tilt_pct_ini</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">))</span>
</span><span id="L-2749"><a href="#-2749"><span class="linenos">2749</span></a>            <span class="c1"># direction = np.random.choice([-1, 1])</span>
</span><span id="L-2750"><a href="#-2750"><span class="linenos">2750</span></a>            <span class="n">throw_lut_ini</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
</span><span id="L-2751"><a href="#-2751"><span class="linenos">2751</span></a>                <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span>
</span><span id="L-2752"><a href="#-2752"><span class="linenos">2752</span></a>                    <span class="n">low</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">low_fault_throw</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">high_fault_throw</span>
</span><span id="L-2753"><a href="#-2753"><span class="linenos">2753</span></a>                <span class="p">)</span>
</span><span id="L-2754"><a href="#-2754"><span class="linenos">2754</span></a>            <span class="p">)</span>
</span><span id="L-2755"><a href="#-2755"><span class="linenos">2755</span></a>            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-2756"><a href="#-2756"><span class="linenos">2756</span></a>                <span class="c1"># Initialize return parameters</span>
</span><span id="L-2757"><a href="#-2757"><span class="linenos">2757</span></a>                <span class="n">a</span> <span class="o">=</span> <span class="n">a_ini</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-2758"><a href="#-2758"><span class="linenos">2758</span></a>                <span class="n">b</span> <span class="o">=</span> <span class="n">b_ini</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-2759"><a href="#-2759"><span class="linenos">2759</span></a>                <span class="n">c</span> <span class="o">=</span> <span class="n">c_ini</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-2760"><a href="#-2760"><span class="linenos">2760</span></a>                <span class="n">x0</span> <span class="o">=</span> <span class="n">x0_ini</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-2761"><a href="#-2761"><span class="linenos">2761</span></a>                <span class="n">y0</span> <span class="o">=</span> <span class="n">y0_ini</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-2762"><a href="#-2762"><span class="linenos">2762</span></a>                <span class="n">z0</span> <span class="o">=</span> <span class="n">z0_ini</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-2763"><a href="#-2763"><span class="linenos">2763</span></a>                <span class="n">tilt_pct</span> <span class="o">=</span> <span class="n">tilt_pct_ini</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-2764"><a href="#-2764"><span class="linenos">2764</span></a>                <span class="n">throw_lut</span> <span class="o">=</span> <span class="n">throw_lut_ini</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-2765"><a href="#-2765"><span class="linenos">2765</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-2766"><a href="#-2766"><span class="linenos">2766</span></a>                <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">a_ini</span><span class="p">)</span>
</span><span id="L-2767"><a href="#-2767"><span class="linenos">2767</span></a>                <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">b_ini</span><span class="p">)</span>
</span><span id="L-2768"><a href="#-2768"><span class="linenos">2768</span></a>                <span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">c_ini</span><span class="p">)</span>
</span><span id="L-2769"><a href="#-2769"><span class="linenos">2769</span></a>                <span class="n">x0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">x0_ini</span><span class="p">)</span>
</span><span id="L-2770"><a href="#-2770"><span class="linenos">2770</span></a>                <span class="n">y0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y0</span><span class="p">,</span> <span class="n">y0_ini</span><span class="p">)</span>
</span><span id="L-2771"><a href="#-2771"><span class="linenos">2771</span></a>                <span class="n">z0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">z0</span><span class="p">,</span> <span class="n">z0_ini</span><span class="p">)</span>
</span><span id="L-2772"><a href="#-2772"><span class="linenos">2772</span></a>                <span class="n">tilt_pct</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tilt_pct</span><span class="p">,</span> <span class="n">tilt_pct_ini</span><span class="p">)</span>
</span><span id="L-2773"><a href="#-2773"><span class="linenos">2773</span></a>                <span class="n">throw_lut</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">throw_lut</span><span class="p">,</span> <span class="n">throw_lut_ini</span><span class="p">)</span>
</span><span id="L-2774"><a href="#-2774"><span class="linenos">2774</span></a>            <span class="c1"># Construct fault in branch</span>
</span><span id="L-2775"><a href="#-2775"><span class="linenos">2775</span></a>            <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">number_of_branches</span> <span class="o">-</span> <span class="mi">1</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">number_faults</span> <span class="o">%</span> <span class="mi">3</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-2776"><a href="#-2776"><span class="linenos">2776</span></a>                <span class="n">fault_in_branch</span> <span class="o">=</span> <span class="mi">2</span>
</span><span id="L-2777"><a href="#-2777"><span class="linenos">2777</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-2778"><a href="#-2778"><span class="linenos">2778</span></a>                <span class="n">fault_in_branch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">number_faults</span> <span class="o">%</span> <span class="mi">3</span>
</span><span id="L-2779"><a href="#-2779"><span class="linenos">2779</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; ... Branch along axis &quot;</span><span class="p">,</span> <span class="n">side</span><span class="p">)</span>
</span><span id="L-2780"><a href="#-2780"><span class="linenos">2780</span></a>
</span><span id="L-2781"><a href="#-2781"><span class="linenos">2781</span></a>            <span class="n">direction</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-2782"><a href="#-2782"><span class="linenos">2782</span></a>            <span class="k">if</span> <span class="n">side</span> <span class="o">==</span> <span class="s2">&quot;x&quot;</span><span class="p">:</span>
</span><span id="L-2783"><a href="#-2783"><span class="linenos">2783</span></a>                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">y0_ini</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">y0_ini</span><span class="p">)):</span>
</span><span id="L-2784"><a href="#-2784"><span class="linenos">2784</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;     ... Building from right to left&quot;</span><span class="p">)</span>
</span><span id="L-2785"><a href="#-2785"><span class="linenos">2785</span></a>                    <span class="n">direction</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
</span><span id="L-2786"><a href="#-2786"><span class="linenos">2786</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-2787"><a href="#-2787"><span class="linenos">2787</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;     ... Building from left to right&quot;</span><span class="p">)</span>
</span><span id="L-2788"><a href="#-2788"><span class="linenos">2788</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-2789"><a href="#-2789"><span class="linenos">2789</span></a>                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">x0_ini</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">x0_ini</span><span class="p">)):</span>
</span><span id="L-2790"><a href="#-2790"><span class="linenos">2790</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;     ... Building from left to right&quot;</span><span class="p">)</span>
</span><span id="L-2791"><a href="#-2791"><span class="linenos">2791</span></a>                    <span class="n">direction</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
</span><span id="L-2792"><a href="#-2792"><span class="linenos">2792</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-2793"><a href="#-2793"><span class="linenos">2793</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;     ... Building from right to left&quot;</span><span class="p">)</span>
</span><span id="L-2794"><a href="#-2794"><span class="linenos">2794</span></a>            <span class="n">move</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-2795"><a href="#-2795"><span class="linenos">2795</span></a>            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span>
</span><span id="L-2796"><a href="#-2796"><span class="linenos">2796</span></a>                <span class="n">i</span> <span class="o">*</span> <span class="n">number_of_branches</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">fault_in_branch</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="n">number_of_branches</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="L-2797"><a href="#-2797"><span class="linenos">2797</span></a>            <span class="p">):</span>
</span><span id="L-2798"><a href="#-2798"><span class="linenos">2798</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;     ... Computing fault number &quot;</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
</span><span id="L-2799"><a href="#-2799"><span class="linenos">2799</span></a>                <span class="c1"># Allow 20% deviation from initial fault parameter</span>
</span><span id="L-2800"><a href="#-2800"><span class="linenos">2800</span></a>                <span class="n">a_ramp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">)</span> <span class="o">*</span> <span class="n">a_ini</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-2801"><a href="#-2801"><span class="linenos">2801</span></a>                <span class="n">b_ramp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">)</span> <span class="o">*</span> <span class="n">b_ini</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-2802"><a href="#-2802"><span class="linenos">2802</span></a>                <span class="n">c_ramp</span> <span class="o">=</span> <span class="n">c_ini</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-2803"><a href="#-2803"><span class="linenos">2803</span></a>                <span class="k">if</span> <span class="n">side</span> <span class="o">==</span> <span class="s2">&quot;x&quot;</span><span class="p">:</span>
</span><span id="L-2804"><a href="#-2804"><span class="linenos">2804</span></a>                    <span class="n">x0_ramp</span> <span class="o">=</span> <span class="n">x0_ini</span> <span class="o">+</span> <span class="n">direction</span> <span class="o">*</span> <span class="n">move</span> <span class="o">*</span> <span class="nb">int</span><span class="p">(</span>
</span><span id="L-2805"><a href="#-2805"><span class="linenos">2805</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mf">3.0</span>
</span><span id="L-2806"><a href="#-2806"><span class="linenos">2806</span></a>                    <span class="p">)</span>
</span><span id="L-2807"><a href="#-2807"><span class="linenos">2807</span></a>                    <span class="n">y0_ramp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.9</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">)</span> <span class="o">*</span> <span class="n">y0_ini</span>
</span><span id="L-2808"><a href="#-2808"><span class="linenos">2808</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-2809"><a href="#-2809"><span class="linenos">2809</span></a>                    <span class="n">y0_ramp</span> <span class="o">=</span> <span class="n">y0_ini</span> <span class="o">+</span> <span class="n">direction</span> <span class="o">*</span> <span class="n">move</span> <span class="o">*</span> <span class="nb">int</span><span class="p">(</span>
</span><span id="L-2810"><a href="#-2810"><span class="linenos">2810</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mf">3.0</span>
</span><span id="L-2811"><a href="#-2811"><span class="linenos">2811</span></a>                    <span class="p">)</span>
</span><span id="L-2812"><a href="#-2812"><span class="linenos">2812</span></a>                    <span class="n">x0_ramp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.9</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">)</span> <span class="o">*</span> <span class="n">x0_ini</span>
</span><span id="L-2813"><a href="#-2813"><span class="linenos">2813</span></a>                <span class="n">z0_ramp</span> <span class="o">=</span> <span class="n">z0_ini</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-2814"><a href="#-2814"><span class="linenos">2814</span></a>                <span class="n">tilt_pct_ramp</span> <span class="o">=</span> <span class="n">tilt_pct_ini</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.85</span><span class="p">,</span> <span class="mf">1.15</span><span class="p">)</span>
</span><span id="L-2815"><a href="#-2815"><span class="linenos">2815</span></a>                <span class="c1"># Add to existing</span>
</span><span id="L-2816"><a href="#-2816"><span class="linenos">2816</span></a>                <span class="n">throw_lut_ramp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span>
</span><span id="L-2817"><a href="#-2817"><span class="linenos">2817</span></a>                    <span class="n">low</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">low_fault_throw</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">high_fault_throw</span>
</span><span id="L-2818"><a href="#-2818"><span class="linenos">2818</span></a>                <span class="p">)</span>
</span><span id="L-2819"><a href="#-2819"><span class="linenos">2819</span></a>                <span class="n">throw_lut</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">throw_lut</span><span class="p">,</span> <span class="n">throw_lut_ramp</span><span class="p">)</span>
</span><span id="L-2820"><a href="#-2820"><span class="linenos">2820</span></a>                <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">a_ramp</span><span class="p">)</span>
</span><span id="L-2821"><a href="#-2821"><span class="linenos">2821</span></a>                <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">b_ramp</span><span class="p">)</span>
</span><span id="L-2822"><a href="#-2822"><span class="linenos">2822</span></a>                <span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">c_ramp</span><span class="p">)</span>
</span><span id="L-2823"><a href="#-2823"><span class="linenos">2823</span></a>                <span class="n">x0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">x0_ramp</span><span class="p">)</span>
</span><span id="L-2824"><a href="#-2824"><span class="linenos">2824</span></a>                <span class="n">y0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y0</span><span class="p">,</span> <span class="n">y0_ramp</span><span class="p">)</span>
</span><span id="L-2825"><a href="#-2825"><span class="linenos">2825</span></a>                <span class="n">z0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">z0</span><span class="p">,</span> <span class="n">z0_ramp</span><span class="p">)</span>
</span><span id="L-2826"><a href="#-2826"><span class="linenos">2826</span></a>                <span class="n">tilt_pct</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tilt_pct</span><span class="p">,</span> <span class="n">tilt_pct_ramp</span><span class="p">)</span>
</span><span id="L-2827"><a href="#-2827"><span class="linenos">2827</span></a>                <span class="n">move</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-2828"><a href="#-2828"><span class="linenos">2828</span></a>
</span><span id="L-2829"><a href="#-2829"><span class="linenos">2829</span></a>        <span class="n">fault_param_dict</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-2830"><a href="#-2830"><span class="linenos">2830</span></a>            <span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="n">a</span><span class="p">,</span>
</span><span id="L-2831"><a href="#-2831"><span class="linenos">2831</span></a>            <span class="s2">&quot;b&quot;</span><span class="p">:</span> <span class="n">b</span><span class="p">,</span>
</span><span id="L-2832"><a href="#-2832"><span class="linenos">2832</span></a>            <span class="s2">&quot;c&quot;</span><span class="p">:</span> <span class="n">c</span><span class="p">,</span>
</span><span id="L-2833"><a href="#-2833"><span class="linenos">2833</span></a>            <span class="s2">&quot;x0&quot;</span><span class="p">:</span> <span class="n">x0</span><span class="p">,</span>
</span><span id="L-2834"><a href="#-2834"><span class="linenos">2834</span></a>            <span class="s2">&quot;y0&quot;</span><span class="p">:</span> <span class="n">y0</span><span class="p">,</span>
</span><span id="L-2835"><a href="#-2835"><span class="linenos">2835</span></a>            <span class="s2">&quot;z0&quot;</span><span class="p">:</span> <span class="n">z0</span><span class="p">,</span>
</span><span id="L-2836"><a href="#-2836"><span class="linenos">2836</span></a>            <span class="s2">&quot;tilt_pct&quot;</span><span class="p">:</span> <span class="n">tilt_pct</span><span class="p">,</span>
</span><span id="L-2837"><a href="#-2837"><span class="linenos">2837</span></a>            <span class="s2">&quot;throw&quot;</span><span class="p">:</span> <span class="n">throw_lut</span><span class="p">,</span>
</span><span id="L-2838"><a href="#-2838"><span class="linenos">2838</span></a>        <span class="p">}</span>
</span><span id="L-2839"><a href="#-2839"><span class="linenos">2839</span></a>        <span class="k">return</span> <span class="n">fault_param_dict</span>
</span><span id="L-2840"><a href="#-2840"><span class="linenos">2840</span></a>
</span><span id="L-2841"><a href="#-2841"><span class="linenos">2841</span></a>    <span class="k">def</span> <span class="nf">_fault_params_stairs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-2842"><a href="#-2842"><span class="linenos">2842</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; ... Stairs like feature&quot;</span><span class="p">)</span>
</span><span id="L-2843"><a href="#-2843"><span class="linenos">2843</span></a>        <span class="c1"># Initialize value for first fault</span>
</span><span id="L-2844"><a href="#-2844"><span class="linenos">2844</span></a>        <span class="n">x0_min</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mf">4.0</span><span class="p">)</span>
</span><span id="L-2845"><a href="#-2845"><span class="linenos">2845</span></a>        <span class="n">x0_max</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">)</span>
</span><span id="L-2846"><a href="#-2846"><span class="linenos">2846</span></a>        <span class="n">y0_min</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="mf">4.0</span><span class="p">)</span>
</span><span id="L-2847"><a href="#-2847"><span class="linenos">2847</span></a>        <span class="n">y0_max</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">)</span>
</span><span id="L-2848"><a href="#-2848"><span class="linenos">2848</span></a>
</span><span id="L-2849"><a href="#-2849"><span class="linenos">2849</span></a>        <span class="n">b_ini</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">600</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="L-2850"><a href="#-2850"><span class="linenos">2850</span></a>        <span class="n">a_ini</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">600</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="L-2851"><a href="#-2851"><span class="linenos">2851</span></a>        <span class="n">x0_ini</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
</span><span id="L-2852"><a href="#-2852"><span class="linenos">2852</span></a>            <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">x0_min</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">a_ini</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">a_ini</span><span class="p">)</span> <span class="o">+</span> <span class="n">x0_max</span><span class="p">)</span>
</span><span id="L-2853"><a href="#-2853"><span class="linenos">2853</span></a>        <span class="p">)</span>
</span><span id="L-2854"><a href="#-2854"><span class="linenos">2854</span></a>        <span class="n">y0_ini</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
</span><span id="L-2855"><a href="#-2855"><span class="linenos">2855</span></a>            <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">y0_min</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">b_ini</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">b_ini</span><span class="p">)</span> <span class="o">+</span> <span class="n">y0_max</span><span class="p">)</span>
</span><span id="L-2856"><a href="#-2856"><span class="linenos">2856</span></a>        <span class="p">)</span>
</span><span id="L-2857"><a href="#-2857"><span class="linenos">2857</span></a>        <span class="n">z0_ini</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
</span><span id="L-2858"><a href="#-2858"><span class="linenos">2858</span></a>            <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span>
</span><span id="L-2859"><a href="#-2859"><span class="linenos">2859</span></a>                <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="mf">2.0</span><span class="p">,</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="mf">6.0</span>
</span><span id="L-2860"><a href="#-2860"><span class="linenos">2860</span></a>            <span class="p">)</span>
</span><span id="L-2861"><a href="#-2861"><span class="linenos">2861</span></a>        <span class="p">)</span>
</span><span id="L-2862"><a href="#-2862"><span class="linenos">2862</span></a>
</span><span id="L-2863"><a href="#-2863"><span class="linenos">2863</span></a>        <span class="n">_c0_ini</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">infill_factor</span> <span class="o">*</span> <span class="mf">4.0</span> <span class="o">-</span> <span class="n">z0_ini</span>
</span><span id="L-2864"><a href="#-2864"><span class="linenos">2864</span></a>        <span class="n">_c1_ini</span> <span class="o">=</span> <span class="n">_c0_ini</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">infill_factor</span> <span class="o">/</span> <span class="mf">4.0</span>
</span><span id="L-2865"><a href="#-2865"><span class="linenos">2865</span></a>        <span class="n">c_ini</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">_c0_ini</span><span class="p">,</span> <span class="n">_c1_ini</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="L-2866"><a href="#-2866"><span class="linenos">2866</span></a>
</span><span id="L-2867"><a href="#-2867"><span class="linenos">2867</span></a>        <span class="n">tilt_pct_ini</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">))</span>
</span><span id="L-2868"><a href="#-2868"><span class="linenos">2868</span></a>        <span class="n">throw_lut</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span>
</span><span id="L-2869"><a href="#-2869"><span class="linenos">2869</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">low_fault_throw</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">high_fault_throw</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">number_faults</span>
</span><span id="L-2870"><a href="#-2870"><span class="linenos">2870</span></a>        <span class="p">)</span>
</span><span id="L-2871"><a href="#-2871"><span class="linenos">2871</span></a>        <span class="n">direction</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
</span><span id="L-2872"><a href="#-2872"><span class="linenos">2872</span></a>        <span class="n">separation_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
</span><span id="L-2873"><a href="#-2873"><span class="linenos">2873</span></a>        <span class="n">separation_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
</span><span id="L-2874"><a href="#-2874"><span class="linenos">2874</span></a>        <span class="c1"># Initialize return parameters</span>
</span><span id="L-2875"><a href="#-2875"><span class="linenos">2875</span></a>        <span class="n">a</span> <span class="o">=</span> <span class="n">a_ini</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-2876"><a href="#-2876"><span class="linenos">2876</span></a>        <span class="n">b</span> <span class="o">=</span> <span class="n">b_ini</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-2877"><a href="#-2877"><span class="linenos">2877</span></a>        <span class="n">c</span> <span class="o">=</span> <span class="n">c_ini</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-2878"><a href="#-2878"><span class="linenos">2878</span></a>        <span class="n">x0</span> <span class="o">=</span> <span class="n">x0_ini</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-2879"><a href="#-2879"><span class="linenos">2879</span></a>        <span class="n">y0</span> <span class="o">=</span> <span class="n">y0_ini</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-2880"><a href="#-2880"><span class="linenos">2880</span></a>        <span class="n">z0</span> <span class="o">=</span> <span class="n">z0_ini</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-2881"><a href="#-2881"><span class="linenos">2881</span></a>        <span class="n">x0_prec</span> <span class="o">=</span> <span class="n">x0_ini</span>
</span><span id="L-2882"><a href="#-2882"><span class="linenos">2882</span></a>        <span class="n">y0_prec</span> <span class="o">=</span> <span class="n">y0_ini</span>
</span><span id="L-2883"><a href="#-2883"><span class="linenos">2883</span></a>        <span class="n">tilt_pct</span> <span class="o">=</span> <span class="n">tilt_pct_ini</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-2884"><a href="#-2884"><span class="linenos">2884</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">number_faults</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="L-2885"><a href="#-2885"><span class="linenos">2885</span></a>            <span class="n">a_ramp</span> <span class="o">=</span> <span class="n">a_ini</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">)</span>
</span><span id="L-2886"><a href="#-2886"><span class="linenos">2886</span></a>            <span class="n">b_ramp</span> <span class="o">=</span> <span class="n">b_ini</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">)</span>
</span><span id="L-2887"><a href="#-2887"><span class="linenos">2887</span></a>            <span class="n">c_ramp</span> <span class="o">=</span> <span class="n">c_ini</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">)</span>
</span><span id="L-2888"><a href="#-2888"><span class="linenos">2888</span></a>            <span class="n">direction</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
</span><span id="L-2889"><a href="#-2889"><span class="linenos">2889</span></a>            <span class="n">x0_ramp</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-2890"><a href="#-2890"><span class="linenos">2890</span></a>                <span class="n">x0_prec</span> <span class="o">+</span> <span class="n">separation_x</span> <span class="o">*</span> <span class="n">direction</span> <span class="o">*</span> <span class="n">x0_ini</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">number_faults</span>
</span><span id="L-2891"><a href="#-2891"><span class="linenos">2891</span></a>            <span class="p">)</span>
</span><span id="L-2892"><a href="#-2892"><span class="linenos">2892</span></a>            <span class="n">y0_ramp</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-2893"><a href="#-2893"><span class="linenos">2893</span></a>                <span class="n">y0_prec</span> <span class="o">+</span> <span class="n">separation_y</span> <span class="o">*</span> <span class="n">direction</span> <span class="o">*</span> <span class="n">y0_ini</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">number_faults</span>
</span><span id="L-2894"><a href="#-2894"><span class="linenos">2894</span></a>            <span class="p">)</span>
</span><span id="L-2895"><a href="#-2895"><span class="linenos">2895</span></a>            <span class="n">z0_ramp</span> <span class="o">=</span> <span class="n">z0_ini</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-2896"><a href="#-2896"><span class="linenos">2896</span></a>            <span class="n">tilt_pct_ramp</span> <span class="o">=</span> <span class="n">tilt_pct_ini</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.85</span><span class="p">,</span> <span class="mf">1.15</span><span class="p">)</span>
</span><span id="L-2897"><a href="#-2897"><span class="linenos">2897</span></a>            <span class="n">x0_prec</span> <span class="o">=</span> <span class="n">x0_ramp</span>
</span><span id="L-2898"><a href="#-2898"><span class="linenos">2898</span></a>            <span class="n">y0_prec</span> <span class="o">=</span> <span class="n">y0_ramp</span>
</span><span id="L-2899"><a href="#-2899"><span class="linenos">2899</span></a>            <span class="c1"># Add to existing</span>
</span><span id="L-2900"><a href="#-2900"><span class="linenos">2900</span></a>            <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">a_ramp</span><span class="p">)</span>
</span><span id="L-2901"><a href="#-2901"><span class="linenos">2901</span></a>            <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">b_ramp</span><span class="p">)</span>
</span><span id="L-2902"><a href="#-2902"><span class="linenos">2902</span></a>            <span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">c_ramp</span><span class="p">)</span>
</span><span id="L-2903"><a href="#-2903"><span class="linenos">2903</span></a>            <span class="n">x0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">x0_ramp</span><span class="p">)</span>
</span><span id="L-2904"><a href="#-2904"><span class="linenos">2904</span></a>            <span class="n">y0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y0</span><span class="p">,</span> <span class="n">y0_ramp</span><span class="p">)</span>
</span><span id="L-2905"><a href="#-2905"><span class="linenos">2905</span></a>            <span class="n">z0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">z0</span><span class="p">,</span> <span class="n">z0_ramp</span><span class="p">)</span>
</span><span id="L-2906"><a href="#-2906"><span class="linenos">2906</span></a>            <span class="n">tilt_pct</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tilt_pct</span><span class="p">,</span> <span class="n">tilt_pct_ramp</span><span class="p">)</span>
</span><span id="L-2907"><a href="#-2907"><span class="linenos">2907</span></a>
</span><span id="L-2908"><a href="#-2908"><span class="linenos">2908</span></a>        <span class="n">fault_param_dict</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-2909"><a href="#-2909"><span class="linenos">2909</span></a>            <span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="n">a</span><span class="p">,</span>
</span><span id="L-2910"><a href="#-2910"><span class="linenos">2910</span></a>            <span class="s2">&quot;b&quot;</span><span class="p">:</span> <span class="n">b</span><span class="p">,</span>
</span><span id="L-2911"><a href="#-2911"><span class="linenos">2911</span></a>            <span class="s2">&quot;c&quot;</span><span class="p">:</span> <span class="n">c</span><span class="p">,</span>
</span><span id="L-2912"><a href="#-2912"><span class="linenos">2912</span></a>            <span class="s2">&quot;x0&quot;</span><span class="p">:</span> <span class="n">x0</span><span class="p">,</span>
</span><span id="L-2913"><a href="#-2913"><span class="linenos">2913</span></a>            <span class="s2">&quot;y0&quot;</span><span class="p">:</span> <span class="n">y0</span><span class="p">,</span>
</span><span id="L-2914"><a href="#-2914"><span class="linenos">2914</span></a>            <span class="s2">&quot;z0&quot;</span><span class="p">:</span> <span class="n">z0</span><span class="p">,</span>
</span><span id="L-2915"><a href="#-2915"><span class="linenos">2915</span></a>            <span class="s2">&quot;tilt_pct&quot;</span><span class="p">:</span> <span class="n">tilt_pct</span><span class="p">,</span>
</span><span id="L-2916"><a href="#-2916"><span class="linenos">2916</span></a>            <span class="s2">&quot;throw&quot;</span><span class="p">:</span> <span class="n">throw_lut</span><span class="p">,</span>
</span><span id="L-2917"><a href="#-2917"><span class="linenos">2917</span></a>        <span class="p">}</span>
</span><span id="L-2918"><a href="#-2918"><span class="linenos">2918</span></a>        <span class="k">return</span> <span class="n">fault_param_dict</span>
</span><span id="L-2919"><a href="#-2919"><span class="linenos">2919</span></a>
</span><span id="L-2920"><a href="#-2920"><span class="linenos">2920</span></a>    <span class="k">def</span> <span class="nf">_fault_params_relay_ramps</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-2921"><a href="#-2921"><span class="linenos">2921</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; ... relay ramps&quot;</span><span class="p">)</span>
</span><span id="L-2922"><a href="#-2922"><span class="linenos">2922</span></a>        <span class="c1"># Initialize value for first fault</span>
</span><span id="L-2923"><a href="#-2923"><span class="linenos">2923</span></a>        <span class="c1"># Maximum of 3 fault per ramp</span>
</span><span id="L-2924"><a href="#-2924"><span class="linenos">2924</span></a>        <span class="n">x0_min</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mf">4.0</span><span class="p">)</span>
</span><span id="L-2925"><a href="#-2925"><span class="linenos">2925</span></a>        <span class="n">x0_max</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">)</span>
</span><span id="L-2926"><a href="#-2926"><span class="linenos">2926</span></a>        <span class="n">y0_min</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="mf">4.0</span><span class="p">)</span>
</span><span id="L-2927"><a href="#-2927"><span class="linenos">2927</span></a>        <span class="n">y0_max</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">)</span>
</span><span id="L-2928"><a href="#-2928"><span class="linenos">2928</span></a>        <span class="n">number_of_branches</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">number_faults</span> <span class="o">/</span> <span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span>
</span><span id="L-2929"><a href="#-2929"><span class="linenos">2929</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">number_faults</span> <span class="o">%</span> <span class="mi">3</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="L-2930"><a href="#-2930"><span class="linenos">2930</span></a>        <span class="p">)</span>
</span><span id="L-2931"><a href="#-2931"><span class="linenos">2931</span></a>
</span><span id="L-2932"><a href="#-2932"><span class="linenos">2932</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">number_of_branches</span><span class="p">):</span>
</span><span id="L-2933"><a href="#-2933"><span class="linenos">2933</span></a>            <span class="c1"># Initialize first fault center, offset center between each branch</span>
</span><span id="L-2934"><a href="#-2934"><span class="linenos">2934</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; ... Computing branch number &quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
</span><span id="L-2935"><a href="#-2935"><span class="linenos">2935</span></a>            <span class="n">b_ini</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">600</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="L-2936"><a href="#-2936"><span class="linenos">2936</span></a>            <span class="n">a_ini</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">600</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="L-2937"><a href="#-2937"><span class="linenos">2937</span></a>            <span class="n">x0_ini</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
</span><span id="L-2938"><a href="#-2938"><span class="linenos">2938</span></a>                <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">x0_min</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">a_ini</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">a_ini</span><span class="p">)</span> <span class="o">+</span> <span class="n">x0_max</span><span class="p">)</span>
</span><span id="L-2939"><a href="#-2939"><span class="linenos">2939</span></a>                <span class="o">/</span> <span class="mi">2</span>
</span><span id="L-2940"><a href="#-2940"><span class="linenos">2940</span></a>            <span class="p">)</span>
</span><span id="L-2941"><a href="#-2941"><span class="linenos">2941</span></a>            <span class="n">y0_ini</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
</span><span id="L-2942"><a href="#-2942"><span class="linenos">2942</span></a>                <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">y0_min</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">b_ini</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">b_ini</span><span class="p">)</span> <span class="o">+</span> <span class="n">y0_max</span><span class="p">)</span>
</span><span id="L-2943"><a href="#-2943"><span class="linenos">2943</span></a>                <span class="o">/</span> <span class="mi">2</span>
</span><span id="L-2944"><a href="#-2944"><span class="linenos">2944</span></a>            <span class="p">)</span>
</span><span id="L-2945"><a href="#-2945"><span class="linenos">2945</span></a>            <span class="c1"># Compute the rest of the initial parameters normally</span>
</span><span id="L-2946"><a href="#-2946"><span class="linenos">2946</span></a>            <span class="n">z0_ini</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
</span><span id="L-2947"><a href="#-2947"><span class="linenos">2947</span></a>                <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span>
</span><span id="L-2948"><a href="#-2948"><span class="linenos">2948</span></a>                    <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="mf">2.0</span><span class="p">,</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="mf">6.0</span>
</span><span id="L-2949"><a href="#-2949"><span class="linenos">2949</span></a>                <span class="p">)</span>
</span><span id="L-2950"><a href="#-2950"><span class="linenos">2950</span></a>            <span class="p">)</span>
</span><span id="L-2951"><a href="#-2951"><span class="linenos">2951</span></a>            <span class="n">c_ini</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
</span><span id="L-2952"><a href="#-2952"><span class="linenos">2952</span></a>                <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span>
</span><span id="L-2953"><a href="#-2953"><span class="linenos">2953</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">infill_factor</span> <span class="o">*</span> <span class="mf">4.0</span> <span class="o">-</span> <span class="n">z0_ini</span><span class="p">,</span>
</span><span id="L-2954"><a href="#-2954"><span class="linenos">2954</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">infill_factor</span> <span class="o">*</span> <span class="mf">4.0</span>
</span><span id="L-2955"><a href="#-2955"><span class="linenos">2955</span></a>                    <span class="o">-</span> <span class="n">z0_ini</span>
</span><span id="L-2956"><a href="#-2956"><span class="linenos">2956</span></a>                    <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">infill_factor</span> <span class="o">/</span> <span class="mf">4.0</span><span class="p">,</span>
</span><span id="L-2957"><a href="#-2957"><span class="linenos">2957</span></a>                <span class="p">)</span>
</span><span id="L-2958"><a href="#-2958"><span class="linenos">2958</span></a>                <span class="o">**</span> <span class="mi">2</span>
</span><span id="L-2959"><a href="#-2959"><span class="linenos">2959</span></a>            <span class="p">)</span>
</span><span id="L-2960"><a href="#-2960"><span class="linenos">2960</span></a>            <span class="n">tilt_pct_ini</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">))</span>
</span><span id="L-2961"><a href="#-2961"><span class="linenos">2961</span></a>            <span class="n">throw_lut</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span>
</span><span id="L-2962"><a href="#-2962"><span class="linenos">2962</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">low_fault_throw</span><span class="p">,</span>
</span><span id="L-2963"><a href="#-2963"><span class="linenos">2963</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">high_fault_throw</span><span class="p">,</span>
</span><span id="L-2964"><a href="#-2964"><span class="linenos">2964</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">number_faults</span><span class="p">,</span>
</span><span id="L-2965"><a href="#-2965"><span class="linenos">2965</span></a>            <span class="p">)</span>
</span><span id="L-2966"><a href="#-2966"><span class="linenos">2966</span></a>            <span class="c1"># Initialize return parameters</span>
</span><span id="L-2967"><a href="#-2967"><span class="linenos">2967</span></a>            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-2968"><a href="#-2968"><span class="linenos">2968</span></a>                <span class="n">a</span> <span class="o">=</span> <span class="n">a_ini</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-2969"><a href="#-2969"><span class="linenos">2969</span></a>                <span class="n">b</span> <span class="o">=</span> <span class="n">b_ini</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-2970"><a href="#-2970"><span class="linenos">2970</span></a>                <span class="n">c</span> <span class="o">=</span> <span class="n">c_ini</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-2971"><a href="#-2971"><span class="linenos">2971</span></a>                <span class="n">x0</span> <span class="o">=</span> <span class="n">x0_ini</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-2972"><a href="#-2972"><span class="linenos">2972</span></a>                <span class="n">y0</span> <span class="o">=</span> <span class="n">y0_ini</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-2973"><a href="#-2973"><span class="linenos">2973</span></a>                <span class="n">z0</span> <span class="o">=</span> <span class="n">z0_ini</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-2974"><a href="#-2974"><span class="linenos">2974</span></a>                <span class="n">tilt_pct</span> <span class="o">=</span> <span class="n">tilt_pct_ini</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-2975"><a href="#-2975"><span class="linenos">2975</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-2976"><a href="#-2976"><span class="linenos">2976</span></a>                <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">a_ini</span><span class="p">)</span>
</span><span id="L-2977"><a href="#-2977"><span class="linenos">2977</span></a>                <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">b_ini</span><span class="p">)</span>
</span><span id="L-2978"><a href="#-2978"><span class="linenos">2978</span></a>                <span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">c_ini</span><span class="p">)</span>
</span><span id="L-2979"><a href="#-2979"><span class="linenos">2979</span></a>                <span class="n">x0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">x0_ini</span><span class="p">)</span>
</span><span id="L-2980"><a href="#-2980"><span class="linenos">2980</span></a>                <span class="n">y0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y0</span><span class="p">,</span> <span class="n">y0_ini</span><span class="p">)</span>
</span><span id="L-2981"><a href="#-2981"><span class="linenos">2981</span></a>                <span class="n">z0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">z0</span><span class="p">,</span> <span class="n">z0_ini</span><span class="p">)</span>
</span><span id="L-2982"><a href="#-2982"><span class="linenos">2982</span></a>                <span class="n">tilt_pct</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tilt_pct</span><span class="p">,</span> <span class="n">tilt_pct_ini</span><span class="p">)</span>
</span><span id="L-2983"><a href="#-2983"><span class="linenos">2983</span></a>                <span class="c1"># Construct fault in branch</span>
</span><span id="L-2984"><a href="#-2984"><span class="linenos">2984</span></a>            <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">number_of_branches</span> <span class="o">-</span> <span class="mi">1</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">number_faults</span> <span class="o">%</span> <span class="mi">3</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-2985"><a href="#-2985"><span class="linenos">2985</span></a>                <span class="n">fault_in_branche</span> <span class="o">=</span> <span class="mi">2</span>
</span><span id="L-2986"><a href="#-2986"><span class="linenos">2986</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-2987"><a href="#-2987"><span class="linenos">2987</span></a>                <span class="n">fault_in_branche</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">number_faults</span> <span class="o">%</span> <span class="mi">3</span>
</span><span id="L-2988"><a href="#-2988"><span class="linenos">2988</span></a>
</span><span id="L-2989"><a href="#-2989"><span class="linenos">2989</span></a>            <span class="n">direction</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
</span><span id="L-2990"><a href="#-2990"><span class="linenos">2990</span></a>            <span class="n">move</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-2991"><a href="#-2991"><span class="linenos">2991</span></a>            <span class="n">x0_prec</span> <span class="o">=</span> <span class="n">x0_ini</span>
</span><span id="L-2992"><a href="#-2992"><span class="linenos">2992</span></a>            <span class="n">y0_prec</span> <span class="o">=</span> <span class="n">y0_ini</span>
</span><span id="L-2993"><a href="#-2993"><span class="linenos">2993</span></a>            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span>
</span><span id="L-2994"><a href="#-2994"><span class="linenos">2994</span></a>                <span class="n">i</span> <span class="o">*</span> <span class="n">number_of_branches</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="L-2995"><a href="#-2995"><span class="linenos">2995</span></a>                <span class="n">fault_in_branche</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="n">number_of_branches</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="L-2996"><a href="#-2996"><span class="linenos">2996</span></a>            <span class="p">):</span>
</span><span id="L-2997"><a href="#-2997"><span class="linenos">2997</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;     ... Computing fault number &quot;</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
</span><span id="L-2998"><a href="#-2998"><span class="linenos">2998</span></a>                <span class="c1"># Allow 20% deviation from initial fault parameter</span>
</span><span id="L-2999"><a href="#-2999"><span class="linenos">2999</span></a>                <span class="n">a_ramp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">)</span> <span class="o">*</span> <span class="n">a_ini</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-3000"><a href="#-3000"><span class="linenos">3000</span></a>                <span class="n">b_ramp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">)</span> <span class="o">*</span> <span class="n">b_ini</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-3001"><a href="#-3001"><span class="linenos">3001</span></a>                <span class="n">c_ramp</span> <span class="o">=</span> <span class="n">c_ini</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-3002"><a href="#-3002"><span class="linenos">3002</span></a>                <span class="n">direction</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
</span><span id="L-3003"><a href="#-3003"><span class="linenos">3003</span></a>                <span class="n">x0_ramp</span> <span class="o">=</span> <span class="n">x0_prec</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">)</span> <span class="o">+</span> <span class="n">direction</span> <span class="o">*</span> <span class="n">x0_ini</span> <span class="o">/</span> <span class="p">(</span>
</span><span id="L-3004"><a href="#-3004"><span class="linenos">3004</span></a>                    <span class="n">fault_in_branche</span>
</span><span id="L-3005"><a href="#-3005"><span class="linenos">3005</span></a>                <span class="p">)</span>
</span><span id="L-3006"><a href="#-3006"><span class="linenos">3006</span></a>                <span class="n">y0_ramp</span> <span class="o">=</span> <span class="n">y0_prec</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">)</span> <span class="o">+</span> <span class="n">direction</span> <span class="o">*</span> <span class="n">y0_ini</span> <span class="o">/</span> <span class="p">(</span>
</span><span id="L-3007"><a href="#-3007"><span class="linenos">3007</span></a>                    <span class="n">fault_in_branche</span>
</span><span id="L-3008"><a href="#-3008"><span class="linenos">3008</span></a>                <span class="p">)</span>
</span><span id="L-3009"><a href="#-3009"><span class="linenos">3009</span></a>                <span class="n">z0_ramp</span> <span class="o">=</span> <span class="n">z0_ini</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-3010"><a href="#-3010"><span class="linenos">3010</span></a>                <span class="n">tilt_pct_ramp</span> <span class="o">=</span> <span class="n">tilt_pct_ini</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.85</span><span class="p">,</span> <span class="mf">1.15</span><span class="p">)</span>
</span><span id="L-3011"><a href="#-3011"><span class="linenos">3011</span></a>                <span class="c1"># Add to existing</span>
</span><span id="L-3012"><a href="#-3012"><span class="linenos">3012</span></a>                <span class="n">throw_LUT_ramp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span>
</span><span id="L-3013"><a href="#-3013"><span class="linenos">3013</span></a>                    <span class="n">low</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">low_fault_throw</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">high_fault_throw</span>
</span><span id="L-3014"><a href="#-3014"><span class="linenos">3014</span></a>                <span class="p">)</span>
</span><span id="L-3015"><a href="#-3015"><span class="linenos">3015</span></a>                <span class="n">throw_lut</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">throw_lut</span><span class="p">,</span> <span class="n">throw_LUT_ramp</span><span class="p">)</span>
</span><span id="L-3016"><a href="#-3016"><span class="linenos">3016</span></a>                <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">a_ramp</span><span class="p">)</span>
</span><span id="L-3017"><a href="#-3017"><span class="linenos">3017</span></a>                <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">b_ramp</span><span class="p">)</span>
</span><span id="L-3018"><a href="#-3018"><span class="linenos">3018</span></a>                <span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">c_ramp</span><span class="p">)</span>
</span><span id="L-3019"><a href="#-3019"><span class="linenos">3019</span></a>                <span class="n">x0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">x0_ramp</span><span class="p">)</span>
</span><span id="L-3020"><a href="#-3020"><span class="linenos">3020</span></a>                <span class="n">y0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y0</span><span class="p">,</span> <span class="n">y0_ramp</span><span class="p">)</span>
</span><span id="L-3021"><a href="#-3021"><span class="linenos">3021</span></a>                <span class="n">z0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">z0</span><span class="p">,</span> <span class="n">z0_ramp</span><span class="p">)</span>
</span><span id="L-3022"><a href="#-3022"><span class="linenos">3022</span></a>                <span class="n">tilt_pct</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tilt_pct</span><span class="p">,</span> <span class="n">tilt_pct_ramp</span><span class="p">)</span>
</span><span id="L-3023"><a href="#-3023"><span class="linenos">3023</span></a>                <span class="n">x0_prec</span> <span class="o">=</span> <span class="n">x0_ramp</span>
</span><span id="L-3024"><a href="#-3024"><span class="linenos">3024</span></a>                <span class="n">y0_prec</span> <span class="o">=</span> <span class="n">y0_ramp</span>
</span><span id="L-3025"><a href="#-3025"><span class="linenos">3025</span></a>                <span class="n">move</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-3026"><a href="#-3026"><span class="linenos">3026</span></a>
</span><span id="L-3027"><a href="#-3027"><span class="linenos">3027</span></a>        <span class="n">fault_param_dict</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-3028"><a href="#-3028"><span class="linenos">3028</span></a>            <span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="n">a</span><span class="p">,</span>
</span><span id="L-3029"><a href="#-3029"><span class="linenos">3029</span></a>            <span class="s2">&quot;b&quot;</span><span class="p">:</span> <span class="n">b</span><span class="p">,</span>
</span><span id="L-3030"><a href="#-3030"><span class="linenos">3030</span></a>            <span class="s2">&quot;c&quot;</span><span class="p">:</span> <span class="n">c</span><span class="p">,</span>
</span><span id="L-3031"><a href="#-3031"><span class="linenos">3031</span></a>            <span class="s2">&quot;x0&quot;</span><span class="p">:</span> <span class="n">x0</span><span class="p">,</span>
</span><span id="L-3032"><a href="#-3032"><span class="linenos">3032</span></a>            <span class="s2">&quot;y0&quot;</span><span class="p">:</span> <span class="n">y0</span><span class="p">,</span>
</span><span id="L-3033"><a href="#-3033"><span class="linenos">3033</span></a>            <span class="s2">&quot;z0&quot;</span><span class="p">:</span> <span class="n">z0</span><span class="p">,</span>
</span><span id="L-3034"><a href="#-3034"><span class="linenos">3034</span></a>            <span class="s2">&quot;tilt_pct&quot;</span><span class="p">:</span> <span class="n">tilt_pct</span><span class="p">,</span>
</span><span id="L-3035"><a href="#-3035"><span class="linenos">3035</span></a>            <span class="s2">&quot;throw&quot;</span><span class="p">:</span> <span class="n">throw_lut</span><span class="p">,</span>
</span><span id="L-3036"><a href="#-3036"><span class="linenos">3036</span></a>        <span class="p">}</span>
</span><span id="L-3037"><a href="#-3037"><span class="linenos">3037</span></a>        <span class="k">return</span> <span class="n">fault_param_dict</span>
</span><span id="L-3038"><a href="#-3038"><span class="linenos">3038</span></a>
</span><span id="L-3039"><a href="#-3039"><span class="linenos">3039</span></a>    <span class="k">def</span> <span class="nf">_fault_params_horst_graben</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-3040"><a href="#-3040"><span class="linenos">3040</span></a>        <span class="nb">print</span><span class="p">(</span>
</span><span id="L-3041"><a href="#-3041"><span class="linenos">3041</span></a>            <span class="s2">&quot;   ... </span><span class="si">%s</span><span class="s2"> faults will be inserted as Horst and Graben&quot;</span>
</span><span id="L-3042"><a href="#-3042"><span class="linenos">3042</span></a>            <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">number_faults</span><span class="p">)</span>
</span><span id="L-3043"><a href="#-3043"><span class="linenos">3043</span></a>        <span class="p">)</span>
</span><span id="L-3044"><a href="#-3044"><span class="linenos">3044</span></a>        <span class="c1"># Initialize value for first fault</span>
</span><span id="L-3045"><a href="#-3045"><span class="linenos">3045</span></a>        <span class="n">x0_min</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">)</span>
</span><span id="L-3046"><a href="#-3046"><span class="linenos">3046</span></a>        <span class="n">x0_max</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-3047"><a href="#-3047"><span class="linenos">3047</span></a>        <span class="n">y0_min</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">)</span>
</span><span id="L-3048"><a href="#-3048"><span class="linenos">3048</span></a>        <span class="n">y0_max</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="L-3049"><a href="#-3049"><span class="linenos">3049</span></a>
</span><span id="L-3050"><a href="#-3050"><span class="linenos">3050</span></a>        <span class="n">b_ini</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">600</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="L-3051"><a href="#-3051"><span class="linenos">3051</span></a>        <span class="n">a_ini</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">600</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="L-3052"><a href="#-3052"><span class="linenos">3052</span></a>        <span class="k">if</span> <span class="n">a_ini</span> <span class="o">&gt;</span> <span class="n">b_ini</span><span class="p">:</span>
</span><span id="L-3053"><a href="#-3053"><span class="linenos">3053</span></a>            <span class="n">side</span> <span class="o">=</span> <span class="s2">&quot;x&quot;</span>
</span><span id="L-3054"><a href="#-3054"><span class="linenos">3054</span></a>            <span class="k">while</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">b_ini</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
</span><span id="L-3055"><a href="#-3055"><span class="linenos">3055</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   ... Recomputing b_ini for better branching&quot;</span><span class="p">)</span>
</span><span id="L-3056"><a href="#-3056"><span class="linenos">3056</span></a>                <span class="n">b_ini</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">600</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="L-3057"><a href="#-3057"><span class="linenos">3057</span></a>            <span class="n">x0_ini</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</span><span id="L-3058"><a href="#-3058"><span class="linenos">3058</span></a>            <span class="c1"># Compute so that first is near center</span>
</span><span id="L-3059"><a href="#-3059"><span class="linenos">3059</span></a>            <span class="n">range_1</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
</span><span id="L-3060"><a href="#-3060"><span class="linenos">3060</span></a>                <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">y0_min</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">b_ini</span><span class="p">)),</span> <span class="nb">int</span><span class="p">(</span><span class="n">y0_max</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">b_ini</span><span class="p">)))</span>
</span><span id="L-3061"><a href="#-3061"><span class="linenos">3061</span></a>            <span class="p">)</span>
</span><span id="L-3062"><a href="#-3062"><span class="linenos">3062</span></a>            <span class="n">range_2</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
</span><span id="L-3063"><a href="#-3063"><span class="linenos">3063</span></a>                <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">y0_min</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">b_ini</span><span class="p">)),</span> <span class="nb">int</span><span class="p">(</span><span class="n">y0_max</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">b_ini</span><span class="p">)))</span>
</span><span id="L-3064"><a href="#-3064"><span class="linenos">3064</span></a>            <span class="p">)</span>
</span><span id="L-3065"><a href="#-3065"><span class="linenos">3065</span></a>            <span class="n">y0_ini</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">range_1</span> <span class="o">+</span> <span class="n">range_2</span><span class="p">))</span>
</span><span id="L-3066"><a href="#-3066"><span class="linenos">3066</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-3067"><a href="#-3067"><span class="linenos">3067</span></a>            <span class="n">side</span> <span class="o">=</span> <span class="s2">&quot;y&quot;</span>
</span><span id="L-3068"><a href="#-3068"><span class="linenos">3068</span></a>            <span class="k">while</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">a_ini</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
</span><span id="L-3069"><a href="#-3069"><span class="linenos">3069</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; ... Recomputing a_ini for better branching&quot;</span><span class="p">)</span>
</span><span id="L-3070"><a href="#-3070"><span class="linenos">3070</span></a>                <span class="n">a_ini</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">600</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="L-3071"><a href="#-3071"><span class="linenos">3071</span></a>            <span class="c1"># compute so that first is near center</span>
</span><span id="L-3072"><a href="#-3072"><span class="linenos">3072</span></a>            <span class="n">range_1</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
</span><span id="L-3073"><a href="#-3073"><span class="linenos">3073</span></a>                <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">x0_min</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">a_ini</span><span class="p">)),</span> <span class="nb">int</span><span class="p">(</span><span class="n">x0_max</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">a_ini</span><span class="p">)))</span>
</span><span id="L-3074"><a href="#-3074"><span class="linenos">3074</span></a>            <span class="p">)</span>
</span><span id="L-3075"><a href="#-3075"><span class="linenos">3075</span></a>            <span class="n">range_2</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
</span><span id="L-3076"><a href="#-3076"><span class="linenos">3076</span></a>                <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">x0_min</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">a_ini</span><span class="p">)),</span> <span class="nb">int</span><span class="p">(</span><span class="n">x0_max</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">a_ini</span><span class="p">)))</span>
</span><span id="L-3077"><a href="#-3077"><span class="linenos">3077</span></a>            <span class="p">)</span>
</span><span id="L-3078"><a href="#-3078"><span class="linenos">3078</span></a>            <span class="n">x0_ini</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">range_1</span> <span class="o">+</span> <span class="n">range_2</span><span class="p">))</span>
</span><span id="L-3079"><a href="#-3079"><span class="linenos">3079</span></a>            <span class="n">y0_ini</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
</span><span id="L-3080"><a href="#-3080"><span class="linenos">3080</span></a>        <span class="n">z0_ini</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
</span><span id="L-3081"><a href="#-3081"><span class="linenos">3081</span></a>            <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span>
</span><span id="L-3082"><a href="#-3082"><span class="linenos">3082</span></a>                <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="mf">2.0</span><span class="p">,</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="mf">6.0</span>
</span><span id="L-3083"><a href="#-3083"><span class="linenos">3083</span></a>            <span class="p">)</span>
</span><span id="L-3084"><a href="#-3084"><span class="linenos">3084</span></a>        <span class="p">)</span>
</span><span id="L-3085"><a href="#-3085"><span class="linenos">3085</span></a>        <span class="n">c_ini</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
</span><span id="L-3086"><a href="#-3086"><span class="linenos">3086</span></a>            <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span>
</span><span id="L-3087"><a href="#-3087"><span class="linenos">3087</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">infill_factor</span> <span class="o">*</span> <span class="mf">4.0</span> <span class="o">-</span> <span class="n">z0_ini</span><span class="p">,</span>
</span><span id="L-3088"><a href="#-3088"><span class="linenos">3088</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">infill_factor</span> <span class="o">*</span> <span class="mf">4.0</span>
</span><span id="L-3089"><a href="#-3089"><span class="linenos">3089</span></a>                <span class="o">-</span> <span class="n">z0_ini</span>
</span><span id="L-3090"><a href="#-3090"><span class="linenos">3090</span></a>                <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">infill_factor</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">,</span>
</span><span id="L-3091"><a href="#-3091"><span class="linenos">3091</span></a>            <span class="p">)</span>
</span><span id="L-3092"><a href="#-3092"><span class="linenos">3092</span></a>            <span class="o">**</span> <span class="mi">2</span>
</span><span id="L-3093"><a href="#-3093"><span class="linenos">3093</span></a>        <span class="p">)</span>
</span><span id="L-3094"><a href="#-3094"><span class="linenos">3094</span></a>        <span class="n">tilt_pct_ini</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">))</span>
</span><span id="L-3095"><a href="#-3095"><span class="linenos">3095</span></a>        <span class="n">throw_lut</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span>
</span><span id="L-3096"><a href="#-3096"><span class="linenos">3096</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">low_fault_throw</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">high_fault_throw</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">number_faults</span>
</span><span id="L-3097"><a href="#-3097"><span class="linenos">3097</span></a>        <span class="p">)</span>
</span><span id="L-3098"><a href="#-3098"><span class="linenos">3098</span></a>        <span class="c1"># Initialize return parameters</span>
</span><span id="L-3099"><a href="#-3099"><span class="linenos">3099</span></a>        <span class="n">a</span> <span class="o">=</span> <span class="n">a_ini</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-3100"><a href="#-3100"><span class="linenos">3100</span></a>        <span class="n">b</span> <span class="o">=</span> <span class="n">b_ini</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-3101"><a href="#-3101"><span class="linenos">3101</span></a>        <span class="n">c</span> <span class="o">=</span> <span class="n">c_ini</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-3102"><a href="#-3102"><span class="linenos">3102</span></a>        <span class="n">x0</span> <span class="o">=</span> <span class="n">x0_ini</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-3103"><a href="#-3103"><span class="linenos">3103</span></a>        <span class="n">y0</span> <span class="o">=</span> <span class="n">y0_ini</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-3104"><a href="#-3104"><span class="linenos">3104</span></a>        <span class="n">z0</span> <span class="o">=</span> <span class="n">z0_ini</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-3105"><a href="#-3105"><span class="linenos">3105</span></a>
</span><span id="L-3106"><a href="#-3106"><span class="linenos">3106</span></a>        <span class="n">tilt_pct</span> <span class="o">=</span> <span class="n">tilt_pct_ini</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-3107"><a href="#-3107"><span class="linenos">3107</span></a>        <span class="n">direction</span> <span class="o">=</span> <span class="s2">&quot;odd&quot;</span>
</span><span id="L-3108"><a href="#-3108"><span class="linenos">3108</span></a>        <span class="n">mod</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;new&quot;</span><span class="p">]</span>
</span><span id="L-3109"><a href="#-3109"><span class="linenos">3109</span></a>
</span><span id="L-3110"><a href="#-3110"><span class="linenos">3110</span></a>        <span class="n">x0_even</span> <span class="o">=</span> <span class="n">x0_ini</span>
</span><span id="L-3111"><a href="#-3111"><span class="linenos">3111</span></a>        <span class="n">y0_even</span> <span class="o">=</span> <span class="n">y0_ini</span>
</span><span id="L-3112"><a href="#-3112"><span class="linenos">3112</span></a>        <span class="k">if</span> <span class="n">side</span> <span class="o">==</span> <span class="s2">&quot;x&quot;</span><span class="p">:</span>
</span><span id="L-3113"><a href="#-3113"><span class="linenos">3113</span></a>            <span class="c1"># X only moves marginally</span>
</span><span id="L-3114"><a href="#-3114"><span class="linenos">3114</span></a>            <span class="n">y0_odd</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="n">y0_even</span>
</span><span id="L-3115"><a href="#-3115"><span class="linenos">3115</span></a>            <span class="n">x0_odd</span> <span class="o">=</span> <span class="n">x0_even</span>
</span><span id="L-3116"><a href="#-3116"><span class="linenos">3116</span></a>            <span class="n">direction_sign</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">y0_ini</span><span class="p">)</span>
</span><span id="L-3117"><a href="#-3117"><span class="linenos">3117</span></a>            <span class="n">direction_sidex</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-3118"><a href="#-3118"><span class="linenos">3118</span></a>            <span class="n">direction_sidey</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-3119"><a href="#-3119"><span class="linenos">3119</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-3120"><a href="#-3120"><span class="linenos">3120</span></a>            <span class="c1"># Y only moves marginally</span>
</span><span id="L-3121"><a href="#-3121"><span class="linenos">3121</span></a>            <span class="n">x0_odd</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">-</span> <span class="n">x0_even</span>
</span><span id="L-3122"><a href="#-3122"><span class="linenos">3122</span></a>            <span class="n">y0_odd</span> <span class="o">=</span> <span class="n">y0_even</span>
</span><span id="L-3123"><a href="#-3123"><span class="linenos">3123</span></a>            <span class="n">direction_sign</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">x0_ini</span><span class="p">)</span>
</span><span id="L-3124"><a href="#-3124"><span class="linenos">3124</span></a>            <span class="n">direction_sidex</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-3125"><a href="#-3125"><span class="linenos">3125</span></a>            <span class="n">direction_sidey</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-3126"><a href="#-3126"><span class="linenos">3126</span></a>
</span><span id="L-3127"><a href="#-3127"><span class="linenos">3127</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">number_faults</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="L-3128"><a href="#-3128"><span class="linenos">3128</span></a>            <span class="k">if</span> <span class="n">direction</span> <span class="o">==</span> <span class="s2">&quot;odd&quot;</span><span class="p">:</span>
</span><span id="L-3129"><a href="#-3129"><span class="linenos">3129</span></a>                <span class="c1"># Put the next point as a mirror shifted by maximal shift and go backward</span>
</span><span id="L-3130"><a href="#-3130"><span class="linenos">3130</span></a>                <span class="n">a_ramp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">)</span> <span class="o">*</span> <span class="n">a_ini</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-3131"><a href="#-3131"><span class="linenos">3131</span></a>                <span class="n">b_ramp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">)</span> <span class="o">*</span> <span class="n">b_ini</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-3132"><a href="#-3132"><span class="linenos">3132</span></a>                <span class="n">c_ramp</span> <span class="o">=</span> <span class="n">c_ini</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-3133"><a href="#-3133"><span class="linenos">3133</span></a>                <span class="n">x0_ramp</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-3134"><a href="#-3134"><span class="linenos">3134</span></a>                    <span class="o">-</span><span class="mi">1</span>
</span><span id="L-3135"><a href="#-3135"><span class="linenos">3135</span></a>                    <span class="o">*</span> <span class="n">direction_sign</span>
</span><span id="L-3136"><a href="#-3136"><span class="linenos">3136</span></a>                    <span class="o">*</span> <span class="n">direction_sidex</span>
</span><span id="L-3137"><a href="#-3137"><span class="linenos">3137</span></a>                    <span class="o">*</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-3138"><a href="#-3138"><span class="linenos">3138</span></a>                    <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-3139"><a href="#-3139"><span class="linenos">3139</span></a>                    <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">number_faults</span>
</span><span id="L-3140"><a href="#-3140"><span class="linenos">3140</span></a>                <span class="p">)</span> <span class="o">+</span> <span class="n">x0_odd</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">)</span>
</span><span id="L-3141"><a href="#-3141"><span class="linenos">3141</span></a>                <span class="n">y0_ramp</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-3142"><a href="#-3142"><span class="linenos">3142</span></a>                    <span class="o">-</span><span class="mi">1</span>
</span><span id="L-3143"><a href="#-3143"><span class="linenos">3143</span></a>                    <span class="o">*</span> <span class="n">direction_sign</span>
</span><span id="L-3144"><a href="#-3144"><span class="linenos">3144</span></a>                    <span class="o">*</span> <span class="n">direction_sidey</span>
</span><span id="L-3145"><a href="#-3145"><span class="linenos">3145</span></a>                    <span class="o">*</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-3146"><a href="#-3146"><span class="linenos">3146</span></a>                    <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-3147"><a href="#-3147"><span class="linenos">3147</span></a>                    <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">number_faults</span>
</span><span id="L-3148"><a href="#-3148"><span class="linenos">3148</span></a>                <span class="p">)</span> <span class="o">+</span> <span class="n">y0_odd</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">)</span>
</span><span id="L-3149"><a href="#-3149"><span class="linenos">3149</span></a>                <span class="n">z0_ramp</span> <span class="o">=</span> <span class="n">z0_ini</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-3150"><a href="#-3150"><span class="linenos">3150</span></a>                <span class="n">tilt_pct_ramp</span> <span class="o">=</span> <span class="n">tilt_pct_ini</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.85</span><span class="p">,</span> <span class="mf">1.15</span><span class="p">)</span>
</span><span id="L-3151"><a href="#-3151"><span class="linenos">3151</span></a>                <span class="n">x0_prec</span> <span class="o">=</span> <span class="n">x0_ramp</span>
</span><span id="L-3152"><a href="#-3152"><span class="linenos">3152</span></a>                <span class="n">y0_prec</span> <span class="o">=</span> <span class="n">y0_ramp</span>
</span><span id="L-3153"><a href="#-3153"><span class="linenos">3153</span></a>                <span class="c1"># Add to existing</span>
</span><span id="L-3154"><a href="#-3154"><span class="linenos">3154</span></a>                <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">a_ramp</span><span class="p">)</span>
</span><span id="L-3155"><a href="#-3155"><span class="linenos">3155</span></a>                <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">b_ramp</span><span class="p">)</span>
</span><span id="L-3156"><a href="#-3156"><span class="linenos">3156</span></a>                <span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">c_ramp</span><span class="p">)</span>
</span><span id="L-3157"><a href="#-3157"><span class="linenos">3157</span></a>                <span class="n">x0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">x0_ramp</span><span class="p">)</span>
</span><span id="L-3158"><a href="#-3158"><span class="linenos">3158</span></a>                <span class="n">y0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y0</span><span class="p">,</span> <span class="n">y0_ramp</span><span class="p">)</span>
</span><span id="L-3159"><a href="#-3159"><span class="linenos">3159</span></a>                <span class="n">z0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">z0</span><span class="p">,</span> <span class="n">z0_ramp</span><span class="p">)</span>
</span><span id="L-3160"><a href="#-3160"><span class="linenos">3160</span></a>                <span class="n">tilt_pct</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tilt_pct</span><span class="p">,</span> <span class="n">tilt_pct_ramp</span><span class="p">)</span>
</span><span id="L-3161"><a href="#-3161"><span class="linenos">3161</span></a>                <span class="n">direction</span> <span class="o">=</span> <span class="s2">&quot;even&quot;</span>
</span><span id="L-3162"><a href="#-3162"><span class="linenos">3162</span></a>                <span class="n">mod</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;old&quot;</span><span class="p">)</span>
</span><span id="L-3163"><a href="#-3163"><span class="linenos">3163</span></a>            <span class="k">elif</span> <span class="n">direction</span> <span class="o">==</span> <span class="s2">&quot;even&quot;</span><span class="p">:</span>
</span><span id="L-3164"><a href="#-3164"><span class="linenos">3164</span></a>                <span class="c1"># Put next to ini</span>
</span><span id="L-3165"><a href="#-3165"><span class="linenos">3165</span></a>                <span class="n">a_ramp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">)</span> <span class="o">*</span> <span class="n">a_ini</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-3166"><a href="#-3166"><span class="linenos">3166</span></a>                <span class="n">b_ramp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">)</span> <span class="o">*</span> <span class="n">b_ini</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-3167"><a href="#-3167"><span class="linenos">3167</span></a>                <span class="n">c_ramp</span> <span class="o">=</span> <span class="n">c_ini</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-3168"><a href="#-3168"><span class="linenos">3168</span></a>                <span class="n">x0_ramp</span> <span class="o">=</span> <span class="n">direction_sign</span> <span class="o">*</span> <span class="n">direction_sidex</span> <span class="o">*</span> <span class="nb">int</span><span class="p">(</span>
</span><span id="L-3169"><a href="#-3169"><span class="linenos">3169</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-3170"><a href="#-3170"><span class="linenos">3170</span></a>                <span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">number_faults</span> <span class="o">+</span> <span class="n">x0_even</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span>
</span><span id="L-3171"><a href="#-3171"><span class="linenos">3171</span></a>                    <span class="mf">0.8</span><span class="p">,</span> <span class="mf">1.2</span>
</span><span id="L-3172"><a href="#-3172"><span class="linenos">3172</span></a>                <span class="p">)</span>
</span><span id="L-3173"><a href="#-3173"><span class="linenos">3173</span></a>                <span class="n">y0_ramp</span> <span class="o">=</span> <span class="n">direction_sign</span> <span class="o">*</span> <span class="n">direction_sidey</span> <span class="o">*</span> <span class="nb">int</span><span class="p">(</span>
</span><span id="L-3174"><a href="#-3174"><span class="linenos">3174</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-3175"><a href="#-3175"><span class="linenos">3175</span></a>                <span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">number_faults</span> <span class="o">+</span> <span class="n">y0_even</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span>
</span><span id="L-3176"><a href="#-3176"><span class="linenos">3176</span></a>                    <span class="mf">0.8</span><span class="p">,</span> <span class="mf">1.2</span>
</span><span id="L-3177"><a href="#-3177"><span class="linenos">3177</span></a>                <span class="p">)</span>
</span><span id="L-3178"><a href="#-3178"><span class="linenos">3178</span></a>                <span class="n">z0_ramp</span> <span class="o">=</span> <span class="n">z0_ini</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-3179"><a href="#-3179"><span class="linenos">3179</span></a>                <span class="n">tilt_pct_ramp</span> <span class="o">=</span> <span class="n">tilt_pct_ini</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.85</span><span class="p">,</span> <span class="mf">1.15</span><span class="p">)</span>
</span><span id="L-3180"><a href="#-3180"><span class="linenos">3180</span></a>                <span class="c1"># Add to existing</span>
</span><span id="L-3181"><a href="#-3181"><span class="linenos">3181</span></a>                <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">a_ramp</span><span class="p">)</span>
</span><span id="L-3182"><a href="#-3182"><span class="linenos">3182</span></a>                <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">b_ramp</span><span class="p">)</span>
</span><span id="L-3183"><a href="#-3183"><span class="linenos">3183</span></a>                <span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">c_ramp</span><span class="p">)</span>
</span><span id="L-3184"><a href="#-3184"><span class="linenos">3184</span></a>                <span class="n">x0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">x0_ramp</span><span class="p">)</span>
</span><span id="L-3185"><a href="#-3185"><span class="linenos">3185</span></a>                <span class="n">y0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y0</span><span class="p">,</span> <span class="n">y0_ramp</span><span class="p">)</span>
</span><span id="L-3186"><a href="#-3186"><span class="linenos">3186</span></a>                <span class="n">z0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">z0</span><span class="p">,</span> <span class="n">z0_ramp</span><span class="p">)</span>
</span><span id="L-3187"><a href="#-3187"><span class="linenos">3187</span></a>                <span class="n">tilt_pct</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tilt_pct</span><span class="p">,</span> <span class="n">tilt_pct_ramp</span><span class="p">)</span>
</span><span id="L-3188"><a href="#-3188"><span class="linenos">3188</span></a>                <span class="n">direction</span> <span class="o">=</span> <span class="s2">&quot;odd&quot;</span>
</span><span id="L-3189"><a href="#-3189"><span class="linenos">3189</span></a>                <span class="n">mod</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;new&quot;</span><span class="p">)</span>
</span><span id="L-3190"><a href="#-3190"><span class="linenos">3190</span></a>
</span><span id="L-3191"><a href="#-3191"><span class="linenos">3191</span></a>        <span class="n">fault_param_dict</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-3192"><a href="#-3192"><span class="linenos">3192</span></a>            <span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="n">a</span><span class="p">,</span>
</span><span id="L-3193"><a href="#-3193"><span class="linenos">3193</span></a>            <span class="s2">&quot;b&quot;</span><span class="p">:</span> <span class="n">b</span><span class="p">,</span>
</span><span id="L-3194"><a href="#-3194"><span class="linenos">3194</span></a>            <span class="s2">&quot;c&quot;</span><span class="p">:</span> <span class="n">c</span><span class="p">,</span>
</span><span id="L-3195"><a href="#-3195"><span class="linenos">3195</span></a>            <span class="s2">&quot;x0&quot;</span><span class="p">:</span> <span class="n">x0</span><span class="p">,</span>
</span><span id="L-3196"><a href="#-3196"><span class="linenos">3196</span></a>            <span class="s2">&quot;y0&quot;</span><span class="p">:</span> <span class="n">y0</span><span class="p">,</span>
</span><span id="L-3197"><a href="#-3197"><span class="linenos">3197</span></a>            <span class="s2">&quot;z0&quot;</span><span class="p">:</span> <span class="n">z0</span><span class="p">,</span>
</span><span id="L-3198"><a href="#-3198"><span class="linenos">3198</span></a>            <span class="s2">&quot;tilt_pct&quot;</span><span class="p">:</span> <span class="n">tilt_pct</span><span class="p">,</span>
</span><span id="L-3199"><a href="#-3199"><span class="linenos">3199</span></a>            <span class="s2">&quot;throw&quot;</span><span class="p">:</span> <span class="n">throw_lut</span><span class="p">,</span>
</span><span id="L-3200"><a href="#-3200"><span class="linenos">3200</span></a>        <span class="p">}</span>
</span><span id="L-3201"><a href="#-3201"><span class="linenos">3201</span></a>        <span class="k">return</span> <span class="n">fault_param_dict</span>
</span><span id="L-3202"><a href="#-3202"><span class="linenos">3202</span></a>
</span><span id="L-3203"><a href="#-3203"><span class="linenos">3203</span></a>
</span><span id="L-3204"><a href="#-3204"><span class="linenos">3204</span></a><span class="k">def</span> <span class="nf">find_zero_thickness_onlapping_layers</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">onlap_list</span><span class="p">):</span>
</span><span id="L-3205"><a href="#-3205"><span class="linenos">3205</span></a>    <span class="n">onlap_zero_z</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
</span><span id="L-3206"><a href="#-3206"><span class="linenos">3206</span></a>    <span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="n">onlap_list</span><span class="p">:</span>
</span><span id="L-3207"><a href="#-3207"><span class="linenos">3207</span></a>        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
</span><span id="L-3208"><a href="#-3208"><span class="linenos">3208</span></a>            <span class="n">thickness</span> <span class="o">=</span> <span class="n">z</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">layer</span><span class="p">]</span> <span class="o">-</span> <span class="n">z</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">x</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="L-3209"><a href="#-3209"><span class="linenos">3209</span></a>            <span class="n">zeros</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">thickness</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">)</span>
</span><span id="L-3210"><a href="#-3210"><span class="linenos">3210</span></a>            <span class="k">if</span> <span class="n">zeros</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-3211"><a href="#-3211"><span class="linenos">3211</span></a>                <span class="n">onlap_zero_z</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">layer</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">x</span><span class="o">-</span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">zeros</span>
</span><span id="L-3212"><a href="#-3212"><span class="linenos">3212</span></a>    <span class="k">return</span> <span class="n">onlap_zero_z</span>
</span><span id="L-3213"><a href="#-3213"><span class="linenos">3213</span></a>
</span><span id="L-3214"><a href="#-3214"><span class="linenos">3214</span></a>
</span><span id="L-3215"><a href="#-3215"><span class="linenos">3215</span></a><span class="k">def</span> <span class="nf">fix_zero_thickness_fan_layers</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">layer_number</span><span class="p">,</span> <span class="n">thickness</span><span class="p">):</span>
</span><span id="L-3216"><a href="#-3216"><span class="linenos">3216</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-3217"><a href="#-3217"><span class="linenos">3217</span></a><span class="sd">    Clip fan layers to horizon below the fan layer in areas where the fan thickness is zero</span>
</span><span id="L-3218"><a href="#-3218"><span class="linenos">3218</span></a>
</span><span id="L-3219"><a href="#-3219"><span class="linenos">3219</span></a><span class="sd">    Parameters</span>
</span><span id="L-3220"><a href="#-3220"><span class="linenos">3220</span></a><span class="sd">    ----------</span>
</span><span id="L-3221"><a href="#-3221"><span class="linenos">3221</span></a><span class="sd">    z : ndarray - depth maps</span>
</span><span id="L-3222"><a href="#-3222"><span class="linenos">3222</span></a><span class="sd">    layer_number : 1d array - horizon numbers which contain fans</span>
</span><span id="L-3223"><a href="#-3223"><span class="linenos">3223</span></a><span class="sd">    thickness : tuple of ndarrays - original thickness maps of the fans</span>
</span><span id="L-3224"><a href="#-3224"><span class="linenos">3224</span></a>
</span><span id="L-3225"><a href="#-3225"><span class="linenos">3225</span></a><span class="sd">    Returns</span>
</span><span id="L-3226"><a href="#-3226"><span class="linenos">3226</span></a><span class="sd">    -------</span>
</span><span id="L-3227"><a href="#-3227"><span class="linenos">3227</span></a><span class="sd">    zmaps : ndarray - depth maps with fan layers clipped to lower horizons where thicknesses is zero</span>
</span><span id="L-3228"><a href="#-3228"><span class="linenos">3228</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-3229"><a href="#-3229"><span class="linenos">3229</span></a>    <span class="n">zmaps</span> <span class="o">=</span> <span class="n">z</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-3230"><a href="#-3230"><span class="linenos">3230</span></a>    <span class="n">zmaps</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">layer_number</span><span class="p">][</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">thickness</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">)]</span> <span class="o">=</span> <span class="n">zmaps</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">layer_number</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span>
</span><span id="L-3231"><a href="#-3231"><span class="linenos">3231</span></a>        <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">thickness</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">)</span>
</span><span id="L-3232"><a href="#-3232"><span class="linenos">3232</span></a>    <span class="p">]</span>
</span><span id="L-3233"><a href="#-3233"><span class="linenos">3233</span></a>    <span class="k">return</span> <span class="n">zmaps</span>
</span><span id="L-3234"><a href="#-3234"><span class="linenos">3234</span></a>
</span><span id="L-3235"><a href="#-3235"><span class="linenos">3235</span></a>
</span><span id="L-3236"><a href="#-3236"><span class="linenos">3236</span></a><span class="k">def</span> <span class="nf">fix_zero_thickness_onlap_layers</span><span class="p">(</span>
</span><span id="L-3237"><a href="#-3237"><span class="linenos">3237</span></a>    <span class="n">faulted_depth_maps</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
</span><span id="L-3238"><a href="#-3238"><span class="linenos">3238</span></a>    <span class="n">onlap_dict</span><span class="p">:</span> <span class="nb">dict</span>
</span><span id="L-3239"><a href="#-3239"><span class="linenos">3239</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="L-3240"><a href="#-3240"><span class="linenos">3240</span></a>    <span class="sd">&quot;&quot;&quot;fix_zero_thickness_onlap_layers _summary_</span>
</span><span id="L-3241"><a href="#-3241"><span class="linenos">3241</span></a>
</span><span id="L-3242"><a href="#-3242"><span class="linenos">3242</span></a><span class="sd">    Parameters</span>
</span><span id="L-3243"><a href="#-3243"><span class="linenos">3243</span></a><span class="sd">    ----------</span>
</span><span id="L-3244"><a href="#-3244"><span class="linenos">3244</span></a><span class="sd">    faulted_depth_maps : np.ndarray</span>
</span><span id="L-3245"><a href="#-3245"><span class="linenos">3245</span></a><span class="sd">        The depth maps with faults</span>
</span><span id="L-3246"><a href="#-3246"><span class="linenos">3246</span></a><span class="sd">    onlap_dict : dict</span>
</span><span id="L-3247"><a href="#-3247"><span class="linenos">3247</span></a><span class="sd">        Onlaps dictionary</span>
</span><span id="L-3248"><a href="#-3248"><span class="linenos">3248</span></a>
</span><span id="L-3249"><a href="#-3249"><span class="linenos">3249</span></a><span class="sd">    Returns</span>
</span><span id="L-3250"><a href="#-3250"><span class="linenos">3250</span></a><span class="sd">    -------</span>
</span><span id="L-3251"><a href="#-3251"><span class="linenos">3251</span></a><span class="sd">    zmaps : np.ndarray</span>
</span><span id="L-3252"><a href="#-3252"><span class="linenos">3252</span></a><span class="sd">        Fixed depth maps</span>
</span><span id="L-3253"><a href="#-3253"><span class="linenos">3253</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-3254"><a href="#-3254"><span class="linenos">3254</span></a>    <span class="n">zmaps</span> <span class="o">=</span> <span class="n">faulted_depth_maps</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-3255"><a href="#-3255"><span class="linenos">3255</span></a>    <span class="k">for</span> <span class="n">layers</span><span class="p">,</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">onlap_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-3256"><a href="#-3256"><span class="linenos">3256</span></a>        <span class="n">onlap_layer</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">layers</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-3257"><a href="#-3257"><span class="linenos">3257</span></a>        <span class="n">layer_to_clip</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">layers</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="L-3258"><a href="#-3258"><span class="linenos">3258</span></a>        <span class="n">zmaps</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">layer_to_clip</span><span class="p">][</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">zmaps</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">onlap_layer</span><span class="p">][</span><span class="n">idx</span><span class="p">]</span>
</span><span id="L-3259"><a href="#-3259"><span class="linenos">3259</span></a>
</span><span id="L-3260"><a href="#-3260"><span class="linenos">3260</span></a>    <span class="k">return</span> <span class="n">zmaps</span>
</span></pre></div>


            </section>
                <section id="Faults">
                            <input id="Faults-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">Faults</span><wbr>(<span class="base"><a href="Horizons.html#Horizons">datagenerator.Horizons.Horizons</a></span>, <span class="base"><a href="Geomodels.html#Geomodel">datagenerator.Geomodels.Geomodel</a></span>):

                <label class="view-source-button" for="Faults-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Faults"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Faults-13"><a href="#-13"><span class="linenos">  13</span></a><span class="k">class</span> <span class="nc">Faults</span><span class="p">(</span><span class="n">Horizons</span><span class="p">,</span> <span class="n">Geomodel</span><span class="p">):</span>
</span><span id="Faults-14"><a href="#-14"><span class="linenos">  14</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="Faults-15"><a href="#-15"><span class="linenos">  15</span></a><span class="sd">    Faults Class</span>
</span><span id="Faults-16"><a href="#-16"><span class="linenos">  16</span></a><span class="sd">    ------------</span>
</span><span id="Faults-17"><a href="#-17"><span class="linenos">  17</span></a><span class="sd">    Describes the class for faulting the model.</span>
</span><span id="Faults-18"><a href="#-18"><span class="linenos">  18</span></a>
</span><span id="Faults-19"><a href="#-19"><span class="linenos">  19</span></a><span class="sd">    Parameters</span>
</span><span id="Faults-20"><a href="#-20"><span class="linenos">  20</span></a><span class="sd">    ----------</span>
</span><span id="Faults-21"><a href="#-21"><span class="linenos">  21</span></a><span class="sd">    Horizons : datagenerator.Horizons</span>
</span><span id="Faults-22"><a href="#-22"><span class="linenos">  22</span></a><span class="sd">        The Horizons class used to build the faults.</span>
</span><span id="Faults-23"><a href="#-23"><span class="linenos">  23</span></a><span class="sd">    Geomodel : data_generator.Geomodels</span>
</span><span id="Faults-24"><a href="#-24"><span class="linenos">  24</span></a><span class="sd">        The Geomodel class used to build the faults.</span>
</span><span id="Faults-25"><a href="#-25"><span class="linenos">  25</span></a><span class="sd">    </span>
</span><span id="Faults-26"><a href="#-26"><span class="linenos">  26</span></a><span class="sd">    Returns</span>
</span><span id="Faults-27"><a href="#-27"><span class="linenos">  27</span></a><span class="sd">    -------</span>
</span><span id="Faults-28"><a href="#-28"><span class="linenos">  28</span></a><span class="sd">    None</span>
</span><span id="Faults-29"><a href="#-29"><span class="linenos">  29</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="Faults-30"><a href="#-30"><span class="linenos">  30</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="Faults-31"><a href="#-31"><span class="linenos">  31</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Faults-32"><a href="#-32"><span class="linenos">  32</span></a>        <span class="n">parameters</span><span class="p">:</span> <span class="n">Parameters</span><span class="p">,</span>
</span><span id="Faults-33"><a href="#-33"><span class="linenos">  33</span></a>        <span class="n">unfaulted_depth_maps</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
</span><span id="Faults-34"><a href="#-34"><span class="linenos">  34</span></a>        <span class="n">onlap_horizon_list</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
</span><span id="Faults-35"><a href="#-35"><span class="linenos">  35</span></a>        <span class="n">geomodels</span><span class="p">:</span> <span class="n">Geomodel</span><span class="p">,</span>
</span><span id="Faults-36"><a href="#-36"><span class="linenos">  36</span></a>        <span class="n">fan_horizon_list</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
</span><span id="Faults-37"><a href="#-37"><span class="linenos">  37</span></a>        <span class="n">fan_thickness</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
</span><span id="Faults-38"><a href="#-38"><span class="linenos">  38</span></a>    <span class="p">):</span>
</span><span id="Faults-39"><a href="#-39"><span class="linenos">  39</span></a>        <span class="sd">&quot;&quot;&quot;__init__</span>
</span><span id="Faults-40"><a href="#-40"><span class="linenos">  40</span></a>
</span><span id="Faults-41"><a href="#-41"><span class="linenos">  41</span></a><span class="sd">        Initializes the Faults class..</span>
</span><span id="Faults-42"><a href="#-42"><span class="linenos">  42</span></a>
</span><span id="Faults-43"><a href="#-43"><span class="linenos">  43</span></a><span class="sd">        Parameters</span>
</span><span id="Faults-44"><a href="#-44"><span class="linenos">  44</span></a><span class="sd">        ----------</span>
</span><span id="Faults-45"><a href="#-45"><span class="linenos">  45</span></a><span class="sd">        parameters : Parameters</span>
</span><span id="Faults-46"><a href="#-46"><span class="linenos">  46</span></a><span class="sd">            The parameters class.</span>
</span><span id="Faults-47"><a href="#-47"><span class="linenos">  47</span></a><span class="sd">        unfaulted_depth_maps : np.ndarray</span>
</span><span id="Faults-48"><a href="#-48"><span class="linenos">  48</span></a><span class="sd">            The depth maps to be faulted.</span>
</span><span id="Faults-49"><a href="#-49"><span class="linenos">  49</span></a><span class="sd">        onlap_horizon_list : np.ndarray</span>
</span><span id="Faults-50"><a href="#-50"><span class="linenos">  50</span></a><span class="sd">            The onlap horizon list.</span>
</span><span id="Faults-51"><a href="#-51"><span class="linenos">  51</span></a><span class="sd">        geomodels : Geomodel</span>
</span><span id="Faults-52"><a href="#-52"><span class="linenos">  52</span></a><span class="sd">            The geomodels class.</span>
</span><span id="Faults-53"><a href="#-53"><span class="linenos">  53</span></a><span class="sd">        fan_horizon_list : np.ndarray</span>
</span><span id="Faults-54"><a href="#-54"><span class="linenos">  54</span></a><span class="sd">            The fan horizon list.</span>
</span><span id="Faults-55"><a href="#-55"><span class="linenos">  55</span></a><span class="sd">        fan_thickness : np.ndarray</span>
</span><span id="Faults-56"><a href="#-56"><span class="linenos">  56</span></a><span class="sd">            The fan thickness list.</span>
</span><span id="Faults-57"><a href="#-57"><span class="linenos">  57</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Faults-58"><a href="#-58"><span class="linenos">  58</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span> <span class="o">=</span> <span class="n">parameters</span>
</span><span id="Faults-59"><a href="#-59"><span class="linenos">  59</span></a>        <span class="c1"># Horizons</span>
</span><span id="Faults-60"><a href="#-60"><span class="linenos">  60</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">unfaulted_depth_maps</span> <span class="o">=</span> <span class="n">unfaulted_depth_maps</span>
</span><span id="Faults-61"><a href="#-61"><span class="linenos">  61</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">onlap_horizon_list</span> <span class="o">=</span> <span class="n">onlap_horizon_list</span>
</span><span id="Faults-62"><a href="#-62"><span class="linenos">  62</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fan_horizon_list</span> <span class="o">=</span> <span class="n">fan_horizon_list</span>
</span><span id="Faults-63"><a href="#-63"><span class="linenos">  63</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fan_thickness</span> <span class="o">=</span> <span class="n">fan_thickness</span>
</span><span id="Faults-64"><a href="#-64"><span class="linenos">  64</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">faulted_depth_maps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="Faults-65"><a href="#-65"><span class="linenos">  65</span></a>            <span class="s2">&quot;faulted_depth_maps&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">unfaulted_depth_maps</span><span class="o">.</span><span class="n">shape</span>
</span><span id="Faults-66"><a href="#-66"><span class="linenos">  66</span></a>        <span class="p">)</span>
</span><span id="Faults-67"><a href="#-67"><span class="linenos">  67</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">faulted_depth_maps_gaps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="Faults-68"><a href="#-68"><span class="linenos">  68</span></a>            <span class="s2">&quot;faulted_depth_maps_gaps&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">unfaulted_depth_maps</span><span class="o">.</span><span class="n">shape</span>
</span><span id="Faults-69"><a href="#-69"><span class="linenos">  69</span></a>        <span class="p">)</span>
</span><span id="Faults-70"><a href="#-70"><span class="linenos">  70</span></a>        <span class="c1"># Volumes</span>
</span><span id="Faults-71"><a href="#-71"><span class="linenos">  71</span></a>        <span class="n">cube_shape</span> <span class="o">=</span> <span class="n">geomodels</span><span class="o">.</span><span class="n">geologic_age</span><span class="p">[:]</span><span class="o">.</span><span class="n">shape</span>
</span><span id="Faults-72"><a href="#-72"><span class="linenos">  72</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vols</span> <span class="o">=</span> <span class="n">geomodels</span>
</span><span id="Faults-73"><a href="#-73"><span class="linenos">  73</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">faulted_age_volume</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="Faults-74"><a href="#-74"><span class="linenos">  74</span></a>            <span class="s2">&quot;faulted_age_volume&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">cube_shape</span>
</span><span id="Faults-75"><a href="#-75"><span class="linenos">  75</span></a>        <span class="p">)</span>
</span><span id="Faults-76"><a href="#-76"><span class="linenos">  76</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">faulted_net_to_gross</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="Faults-77"><a href="#-77"><span class="linenos">  77</span></a>            <span class="s2">&quot;faulted_net_to_gross&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">cube_shape</span>
</span><span id="Faults-78"><a href="#-78"><span class="linenos">  78</span></a>        <span class="p">)</span>
</span><span id="Faults-79"><a href="#-79"><span class="linenos">  79</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">faulted_lithology</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="Faults-80"><a href="#-80"><span class="linenos">  80</span></a>            <span class="s2">&quot;faulted_lithology&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">cube_shape</span>
</span><span id="Faults-81"><a href="#-81"><span class="linenos">  81</span></a>        <span class="p">)</span>
</span><span id="Faults-82"><a href="#-82"><span class="linenos">  82</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">reservoir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span><span class="s2">&quot;reservoir&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">cube_shape</span><span class="p">)</span>
</span><span id="Faults-83"><a href="#-83"><span class="linenos">  83</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">faulted_depth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span><span class="s2">&quot;faulted_depth&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">cube_shape</span><span class="p">)</span>
</span><span id="Faults-84"><a href="#-84"><span class="linenos">  84</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">faulted_onlap_segments</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="Faults-85"><a href="#-85"><span class="linenos">  85</span></a>            <span class="s2">&quot;faulted_onlap_segments&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">cube_shape</span>
</span><span id="Faults-86"><a href="#-86"><span class="linenos">  86</span></a>        <span class="p">)</span>
</span><span id="Faults-87"><a href="#-87"><span class="linenos">  87</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fault_planes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span><span class="s2">&quot;fault_planes&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">cube_shape</span><span class="p">)</span>
</span><span id="Faults-88"><a href="#-88"><span class="linenos">  88</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">displacement_vectors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="Faults-89"><a href="#-89"><span class="linenos">  89</span></a>            <span class="s2">&quot;displacement_vectors&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">cube_shape</span>
</span><span id="Faults-90"><a href="#-90"><span class="linenos">  90</span></a>        <span class="p">)</span>
</span><span id="Faults-91"><a href="#-91"><span class="linenos">  91</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sum_map_displacements</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="Faults-92"><a href="#-92"><span class="linenos">  92</span></a>            <span class="s2">&quot;sum_map_displacements&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">cube_shape</span>
</span><span id="Faults-93"><a href="#-93"><span class="linenos">  93</span></a>        <span class="p">)</span>
</span><span id="Faults-94"><a href="#-94"><span class="linenos">  94</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fault_intersections</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="Faults-95"><a href="#-95"><span class="linenos">  95</span></a>            <span class="s2">&quot;fault_intersections&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">cube_shape</span>
</span><span id="Faults-96"><a href="#-96"><span class="linenos">  96</span></a>        <span class="p">)</span>
</span><span id="Faults-97"><a href="#-97"><span class="linenos">  97</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fault_plane_throw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="Faults-98"><a href="#-98"><span class="linenos">  98</span></a>            <span class="s2">&quot;fault_plane_throw&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">cube_shape</span>
</span><span id="Faults-99"><a href="#-99"><span class="linenos">  99</span></a>        <span class="p">)</span>
</span><span id="Faults-100"><a href="#-100"><span class="linenos"> 100</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">max_fault_throw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span><span class="s2">&quot;max_fault_throw&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">cube_shape</span><span class="p">)</span>
</span><span id="Faults-101"><a href="#-101"><span class="linenos"> 101</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fault_plane_azimuth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="Faults-102"><a href="#-102"><span class="linenos"> 102</span></a>            <span class="s2">&quot;fault_plane_azimuth&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">cube_shape</span>
</span><span id="Faults-103"><a href="#-103"><span class="linenos"> 103</span></a>        <span class="p">)</span>
</span><span id="Faults-104"><a href="#-104"><span class="linenos"> 104</span></a>        <span class="c1"># Salt</span>
</span><span id="Faults-105"><a href="#-105"><span class="linenos"> 105</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">salt_model</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Faults-106"><a href="#-106"><span class="linenos"> 106</span></a>
</span><span id="Faults-107"><a href="#-107"><span class="linenos"> 107</span></a>    <span class="k">def</span> <span class="nf">apply_faulting_to_geomodels_and_depth_maps</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Faults-108"><a href="#-108"><span class="linenos"> 108</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="Faults-109"><a href="#-109"><span class="linenos"> 109</span></a><span class="sd">        Apply faulting to horizons and cubes</span>
</span><span id="Faults-110"><a href="#-110"><span class="linenos"> 110</span></a><span class="sd">        ------------------------------------</span>
</span><span id="Faults-111"><a href="#-111"><span class="linenos"> 111</span></a><span class="sd">        Generates random faults and applies faulting to horizons and cubes.</span>
</span><span id="Faults-112"><a href="#-112"><span class="linenos"> 112</span></a>
</span><span id="Faults-113"><a href="#-113"><span class="linenos"> 113</span></a><span class="sd">        The method does the following:</span>
</span><span id="Faults-114"><a href="#-114"><span class="linenos"> 114</span></a>
</span><span id="Faults-115"><a href="#-115"><span class="linenos"> 115</span></a><span class="sd">        * Generate faults and sum the displacements</span>
</span><span id="Faults-116"><a href="#-116"><span class="linenos"> 116</span></a><span class="sd">        * Apply faulting to horizons</span>
</span><span id="Faults-117"><a href="#-117"><span class="linenos"> 117</span></a><span class="sd">        * Write faulted depth maps to disk</span>
</span><span id="Faults-118"><a href="#-118"><span class="linenos"> 118</span></a><span class="sd">        * Write faulted depth maps with gaps at faults to disk</span>
</span><span id="Faults-119"><a href="#-119"><span class="linenos"> 119</span></a><span class="sd">        * Write onlapping horizons to disk</span>
</span><span id="Faults-120"><a href="#-120"><span class="linenos"> 120</span></a><span class="sd">        * Apply faulting to geomodels</span>
</span><span id="Faults-121"><a href="#-121"><span class="linenos"> 121</span></a><span class="sd">        * Make segmentation results conform to binary values after</span>
</span><span id="Faults-122"><a href="#-122"><span class="linenos"> 122</span></a><span class="sd">          faulting and interpolation.</span>
</span><span id="Faults-123"><a href="#-123"><span class="linenos"> 123</span></a><span class="sd">        * Write cubes to file (if qc_volumes turned on in config.json)</span>
</span><span id="Faults-124"><a href="#-124"><span class="linenos"> 124</span></a>
</span><span id="Faults-125"><a href="#-125"><span class="linenos"> 125</span></a><span class="sd">        (If segmentation is not reset to binary, the multiple </span>
</span><span id="Faults-126"><a href="#-126"><span class="linenos"> 126</span></a><span class="sd">        interpolations for successive faults destroys the crisp</span>
</span><span id="Faults-127"><a href="#-127"><span class="linenos"> 127</span></a><span class="sd">        localization of the labels. Subjective observation suggests</span>
</span><span id="Faults-128"><a href="#-128"><span class="linenos"> 128</span></a><span class="sd">        that slightly different thresholds for different </span>
</span><span id="Faults-129"><a href="#-129"><span class="linenos"> 129</span></a><span class="sd">        features provide superior results)</span>
</span><span id="Faults-130"><a href="#-130"><span class="linenos"> 130</span></a>
</span><span id="Faults-131"><a href="#-131"><span class="linenos"> 131</span></a><span class="sd">        Parameters</span>
</span><span id="Faults-132"><a href="#-132"><span class="linenos"> 132</span></a><span class="sd">        ----------</span>
</span><span id="Faults-133"><a href="#-133"><span class="linenos"> 133</span></a><span class="sd">        None</span>
</span><span id="Faults-134"><a href="#-134"><span class="linenos"> 134</span></a>
</span><span id="Faults-135"><a href="#-135"><span class="linenos"> 135</span></a><span class="sd">        Returns</span>
</span><span id="Faults-136"><a href="#-136"><span class="linenos"> 136</span></a><span class="sd">        -------</span>
</span><span id="Faults-137"><a href="#-137"><span class="linenos"> 137</span></a><span class="sd">        None</span>
</span><span id="Faults-138"><a href="#-138"><span class="linenos"> 138</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Faults-139"><a href="#-139"><span class="linenos"> 139</span></a>        <span class="c1"># Make a dictionary of zero-thickness onlapping layers before faulting</span>
</span><span id="Faults-140"><a href="#-140"><span class="linenos"> 140</span></a>        <span class="n">onlap_clip_dict</span> <span class="o">=</span> <span class="n">find_zero_thickness_onlapping_layers</span><span class="p">(</span>
</span><span id="Faults-141"><a href="#-141"><span class="linenos"> 141</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">unfaulted_depth_maps</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">onlap_horizon_list</span>
</span><span id="Faults-142"><a href="#-142"><span class="linenos"> 142</span></a>        <span class="p">)</span>
</span><span id="Faults-143"><a href="#-143"><span class="linenos"> 143</span></a>        <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_faults</span><span class="p">()</span>
</span><span id="Faults-144"><a href="#-144"><span class="linenos"> 144</span></a>
</span><span id="Faults-145"><a href="#-145"><span class="linenos"> 145</span></a>        <span class="c1"># Apply faulting to age model, net_to_gross cube &amp; onlap segments</span>
</span><span id="Faults-146"><a href="#-146"><span class="linenos"> 146</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">faulted_age_volume</span><span class="p">[:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_xyz_displacement</span><span class="p">(</span>
</span><span id="Faults-147"><a href="#-147"><span class="linenos"> 147</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">geologic_age</span><span class="p">[:]</span>
</span><span id="Faults-148"><a href="#-148"><span class="linenos"> 148</span></a>        <span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;float&quot;</span><span class="p">)</span>
</span><span id="Faults-149"><a href="#-149"><span class="linenos"> 149</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">faulted_onlap_segments</span><span class="p">[:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_xyz_displacement</span><span class="p">(</span>
</span><span id="Faults-150"><a href="#-150"><span class="linenos"> 150</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">onlap_segments</span><span class="p">[:]</span>
</span><span id="Faults-151"><a href="#-151"><span class="linenos"> 151</span></a>        <span class="p">)</span>
</span><span id="Faults-152"><a href="#-152"><span class="linenos"> 152</span></a>
</span><span id="Faults-153"><a href="#-153"><span class="linenos"> 153</span></a>        <span class="c1"># Improve the depth maps post faulting by</span>
</span><span id="Faults-154"><a href="#-154"><span class="linenos"> 154</span></a>        <span class="c1"># re-interpolating across faulted age model</span>
</span><span id="Faults-155"><a href="#-155"><span class="linenos"> 155</span></a>        <span class="p">(</span>
</span><span id="Faults-156"><a href="#-156"><span class="linenos"> 156</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">faulted_depth_maps</span><span class="p">[:],</span>
</span><span id="Faults-157"><a href="#-157"><span class="linenos"> 157</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">faulted_depth_maps_gaps</span><span class="p">[:],</span>
</span><span id="Faults-158"><a href="#-158"><span class="linenos"> 158</span></a>        <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">improve_depth_maps_post_faulting</span><span class="p">(</span>
</span><span id="Faults-159"><a href="#-159"><span class="linenos"> 159</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">geologic_age</span><span class="p">[:],</span> <span class="bp">self</span><span class="o">.</span><span class="n">faulted_age_volume</span><span class="p">[:],</span> <span class="n">onlap_clip_dict</span>
</span><span id="Faults-160"><a href="#-160"><span class="linenos"> 160</span></a>        <span class="p">)</span>
</span><span id="Faults-161"><a href="#-161"><span class="linenos"> 161</span></a>
</span><span id="Faults-162"><a href="#-162"><span class="linenos"> 162</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">include_salt</span><span class="p">:</span>
</span><span id="Faults-163"><a href="#-163"><span class="linenos"> 163</span></a>            <span class="kn">from</span> <span class="nn">datagenerator.Salt</span> <span class="kn">import</span> <span class="n">SaltModel</span>
</span><span id="Faults-164"><a href="#-164"><span class="linenos"> 164</span></a>
</span><span id="Faults-165"><a href="#-165"><span class="linenos"> 165</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">salt_model</span> <span class="o">=</span> <span class="n">SaltModel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="p">)</span>
</span><span id="Faults-166"><a href="#-166"><span class="linenos"> 166</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">salt_model</span><span class="o">.</span><span class="n">compute_salt_body_segmentation</span><span class="p">()</span>
</span><span id="Faults-167"><a href="#-167"><span class="linenos"> 167</span></a>            <span class="p">(</span>
</span><span id="Faults-168"><a href="#-168"><span class="linenos"> 168</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">faulted_depth_maps</span><span class="p">[:],</span>
</span><span id="Faults-169"><a href="#-169"><span class="linenos"> 169</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">faulted_depth_maps_gaps</span><span class="p">[:],</span>
</span><span id="Faults-170"><a href="#-170"><span class="linenos"> 170</span></a>            <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">salt_model</span><span class="o">.</span><span class="n">update_depth_maps_with_salt_segments_drag</span><span class="p">()</span>
</span><span id="Faults-171"><a href="#-171"><span class="linenos"> 171</span></a>
</span><span id="Faults-172"><a href="#-172"><span class="linenos"> 172</span></a>        <span class="c1"># # Write the faulted maps to disk</span>
</span><span id="Faults-173"><a href="#-173"><span class="linenos"> 173</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">write_maps_to_disk</span><span class="p">(</span>
</span><span id="Faults-174"><a href="#-174"><span class="linenos"> 174</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">faulted_depth_maps</span><span class="p">[:]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">digi</span><span class="p">,</span> <span class="s2">&quot;depth_maps&quot;</span>
</span><span id="Faults-175"><a href="#-175"><span class="linenos"> 175</span></a>        <span class="p">)</span>
</span><span id="Faults-176"><a href="#-176"><span class="linenos"> 176</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">write_maps_to_disk</span><span class="p">(</span>
</span><span id="Faults-177"><a href="#-177"><span class="linenos"> 177</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">faulted_depth_maps_gaps</span><span class="p">[:]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">digi</span><span class="p">,</span> <span class="s2">&quot;depth_maps_gaps&quot;</span>
</span><span id="Faults-178"><a href="#-178"><span class="linenos"> 178</span></a>        <span class="p">)</span>
</span><span id="Faults-179"><a href="#-179"><span class="linenos"> 179</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">write_onlap_episodes</span><span class="p">(</span>
</span><span id="Faults-180"><a href="#-180"><span class="linenos"> 180</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">onlap_horizon_list</span><span class="p">[:],</span>
</span><span id="Faults-181"><a href="#-181"><span class="linenos"> 181</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">faulted_depth_maps_gaps</span><span class="p">[:],</span>
</span><span id="Faults-182"><a href="#-182"><span class="linenos"> 182</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">faulted_depth_maps</span><span class="p">[:],</span>
</span><span id="Faults-183"><a href="#-183"><span class="linenos"> 183</span></a>        <span class="p">)</span>
</span><span id="Faults-184"><a href="#-184"><span class="linenos"> 184</span></a>        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fan_horizon_list</span><span class="p">):</span>
</span><span id="Faults-185"><a href="#-185"><span class="linenos"> 185</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">write_fan_horizons</span><span class="p">(</span>
</span><span id="Faults-186"><a href="#-186"><span class="linenos"> 186</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">fan_horizon_list</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">faulted_depth_maps</span><span class="p">[:]</span> <span class="o">*</span> <span class="mf">4.0</span>
</span><span id="Faults-187"><a href="#-187"><span class="linenos"> 187</span></a>            <span class="p">)</span>
</span><span id="Faults-188"><a href="#-188"><span class="linenos"> 188</span></a>
</span><span id="Faults-189"><a href="#-189"><span class="linenos"> 189</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_store</span><span class="p">:</span>
</span><span id="Faults-190"><a href="#-190"><span class="linenos"> 190</span></a>            <span class="c1"># Write faulted maps to hdf</span>
</span><span id="Faults-191"><a href="#-191"><span class="linenos"> 191</span></a>            <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
</span><span id="Faults-192"><a href="#-192"><span class="linenos"> 192</span></a>                <span class="p">[</span><span class="s2">&quot;depth_maps&quot;</span><span class="p">,</span> <span class="s2">&quot;depth_maps_gaps&quot;</span><span class="p">],</span>
</span><span id="Faults-193"><a href="#-193"><span class="linenos"> 193</span></a>                <span class="p">[</span>
</span><span id="Faults-194"><a href="#-194"><span class="linenos"> 194</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">faulted_depth_maps</span><span class="p">[:]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">digi</span><span class="p">,</span>
</span><span id="Faults-195"><a href="#-195"><span class="linenos"> 195</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">faulted_depth_maps_gaps</span><span class="p">[:]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">digi</span><span class="p">,</span>
</span><span id="Faults-196"><a href="#-196"><span class="linenos"> 196</span></a>                <span class="p">],</span>
</span><span id="Faults-197"><a href="#-197"><span class="linenos"> 197</span></a>            <span class="p">):</span>
</span><span id="Faults-198"><a href="#-198"><span class="linenos"> 198</span></a>                <span class="n">write_data_to_hdf</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_master</span><span class="p">)</span>
</span><span id="Faults-199"><a href="#-199"><span class="linenos"> 199</span></a>
</span><span id="Faults-200"><a href="#-200"><span class="linenos"> 200</span></a>        <span class="c1"># Create faulted binary segmentation volumes</span>
</span><span id="Faults-201"><a href="#-201"><span class="linenos"> 201</span></a>        <span class="n">_fault_planes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fault_planes</span><span class="p">[:]</span>
</span><span id="Faults-202"><a href="#-202"><span class="linenos"> 202</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fault_planes</span><span class="p">[:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_binary_segmentations_post_faulting</span><span class="p">(</span>
</span><span id="Faults-203"><a href="#-203"><span class="linenos"> 203</span></a>            <span class="n">_fault_planes</span><span class="p">,</span> <span class="mf">0.45</span>
</span><span id="Faults-204"><a href="#-204"><span class="linenos"> 204</span></a>        <span class="p">)</span>
</span><span id="Faults-205"><a href="#-205"><span class="linenos"> 205</span></a>        <span class="k">del</span> <span class="n">_fault_planes</span>
</span><span id="Faults-206"><a href="#-206"><span class="linenos"> 206</span></a>        <span class="n">_fault_intersections</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fault_intersections</span><span class="p">[:]</span>
</span><span id="Faults-207"><a href="#-207"><span class="linenos"> 207</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fault_intersections</span><span class="p">[:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_binary_segmentations_post_faulting</span><span class="p">(</span>
</span><span id="Faults-208"><a href="#-208"><span class="linenos"> 208</span></a>            <span class="n">_fault_intersections</span><span class="p">,</span> <span class="mf">0.45</span>
</span><span id="Faults-209"><a href="#-209"><span class="linenos"> 209</span></a>        <span class="p">)</span>
</span><span id="Faults-210"><a href="#-210"><span class="linenos"> 210</span></a>        <span class="k">del</span> <span class="n">_fault_intersections</span>
</span><span id="Faults-211"><a href="#-211"><span class="linenos"> 211</span></a>        <span class="n">_faulted_onlap_segments</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">faulted_onlap_segments</span><span class="p">[:]</span>
</span><span id="Faults-212"><a href="#-212"><span class="linenos"> 212</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">faulted_onlap_segments</span><span class="p">[:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_binary_segmentations_post_faulting</span><span class="p">(</span>
</span><span id="Faults-213"><a href="#-213"><span class="linenos"> 213</span></a>            <span class="n">_faulted_onlap_segments</span><span class="p">,</span> <span class="mf">0.45</span>
</span><span id="Faults-214"><a href="#-214"><span class="linenos"> 214</span></a>        <span class="p">)</span>
</span><span id="Faults-215"><a href="#-215"><span class="linenos"> 215</span></a>        <span class="k">del</span> <span class="n">_faulted_onlap_segments</span>
</span><span id="Faults-216"><a href="#-216"><span class="linenos"> 216</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">include_channels</span><span class="p">:</span>
</span><span id="Faults-217"><a href="#-217"><span class="linenos"> 217</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">floodplain_shale</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_xyz_displacement</span><span class="p">(</span>
</span><span id="Faults-218"><a href="#-218"><span class="linenos"> 218</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">floodplain_shale</span>
</span><span id="Faults-219"><a href="#-219"><span class="linenos"> 219</span></a>            <span class="p">)</span>
</span><span id="Faults-220"><a href="#-220"><span class="linenos"> 220</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">channel_fill</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_xyz_displacement</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">channel_fill</span><span class="p">)</span>
</span><span id="Faults-221"><a href="#-221"><span class="linenos"> 221</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">shale_channel_drape</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_xyz_displacement</span><span class="p">(</span>
</span><span id="Faults-222"><a href="#-222"><span class="linenos"> 222</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">shale_channel_drape</span>
</span><span id="Faults-223"><a href="#-223"><span class="linenos"> 223</span></a>            <span class="p">)</span>
</span><span id="Faults-224"><a href="#-224"><span class="linenos"> 224</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">levee</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_xyz_displacement</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">levee</span><span class="p">)</span>
</span><span id="Faults-225"><a href="#-225"><span class="linenos"> 225</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">crevasse</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_xyz_displacement</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">crevasse</span><span class="p">)</span>
</span><span id="Faults-226"><a href="#-226"><span class="linenos"> 226</span></a>
</span><span id="Faults-227"><a href="#-227"><span class="linenos"> 227</span></a>            <span class="p">(</span>
</span><span id="Faults-228"><a href="#-228"><span class="linenos"> 228</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">channel_segments</span><span class="p">,</span>
</span><span id="Faults-229"><a href="#-229"><span class="linenos"> 229</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">geologic_age</span><span class="p">,</span>
</span><span id="Faults-230"><a href="#-230"><span class="linenos"> 230</span></a>            <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reassign_channel_segment_encoding</span><span class="p">(</span>
</span><span id="Faults-231"><a href="#-231"><span class="linenos"> 231</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">geologic_age</span><span class="p">,</span>
</span><span id="Faults-232"><a href="#-232"><span class="linenos"> 232</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">floodplain_shale</span><span class="p">,</span>
</span><span id="Faults-233"><a href="#-233"><span class="linenos"> 233</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">channel_fill</span><span class="p">,</span>
</span><span id="Faults-234"><a href="#-234"><span class="linenos"> 234</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">shale_channel_drape</span><span class="p">,</span>
</span><span id="Faults-235"><a href="#-235"><span class="linenos"> 235</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">levee</span><span class="p">,</span>
</span><span id="Faults-236"><a href="#-236"><span class="linenos"> 236</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">crevasse</span><span class="p">,</span>
</span><span id="Faults-237"><a href="#-237"><span class="linenos"> 237</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">maps</span><span class="o">.</span><span class="n">channels</span><span class="p">,</span>
</span><span id="Faults-238"><a href="#-238"><span class="linenos"> 238</span></a>            <span class="p">)</span>
</span><span id="Faults-239"><a href="#-239"><span class="linenos"> 239</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">model_qc_volumes</span><span class="p">:</span>
</span><span id="Faults-240"><a href="#-240"><span class="linenos"> 240</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">write_cube_to_disk</span><span class="p">(</span>
</span><span id="Faults-241"><a href="#-241"><span class="linenos"> 241</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">channel_segments</span><span class="p">,</span> <span class="s2">&quot;channel_segments&quot;</span>
</span><span id="Faults-242"><a href="#-242"><span class="linenos"> 242</span></a>                <span class="p">)</span>
</span><span id="Faults-243"><a href="#-243"><span class="linenos"> 243</span></a>
</span><span id="Faults-244"><a href="#-244"><span class="linenos"> 244</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">model_qc_volumes</span><span class="p">:</span>
</span><span id="Faults-245"><a href="#-245"><span class="linenos"> 245</span></a>            <span class="c1"># Output files if qc volumes required</span>
</span><span id="Faults-246"><a href="#-246"><span class="linenos"> 246</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">write_cube_to_disk</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faulted_age_volume</span><span class="p">[:],</span> <span class="s2">&quot;geologic_age&quot;</span><span class="p">)</span>
</span><span id="Faults-247"><a href="#-247"><span class="linenos"> 247</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">write_cube_to_disk</span><span class="p">(</span>
</span><span id="Faults-248"><a href="#-248"><span class="linenos"> 248</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">faulted_onlap_segments</span><span class="p">[:],</span> <span class="s2">&quot;onlap_segments&quot;</span>
</span><span id="Faults-249"><a href="#-249"><span class="linenos"> 249</span></a>            <span class="p">)</span>
</span><span id="Faults-250"><a href="#-250"><span class="linenos"> 250</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">write_cube_to_disk</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fault_planes</span><span class="p">[:],</span> <span class="s2">&quot;fault_segments&quot;</span><span class="p">)</span>
</span><span id="Faults-251"><a href="#-251"><span class="linenos"> 251</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">write_cube_to_disk</span><span class="p">(</span>
</span><span id="Faults-252"><a href="#-252"><span class="linenos"> 252</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">fault_intersections</span><span class="p">[:],</span> <span class="s2">&quot;fault_intersection_segments&quot;</span>
</span><span id="Faults-253"><a href="#-253"><span class="linenos"> 253</span></a>            <span class="p">)</span>
</span><span id="Faults-254"><a href="#-254"><span class="linenos"> 254</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">write_cube_to_disk</span><span class="p">(</span>
</span><span id="Faults-255"><a href="#-255"><span class="linenos"> 255</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">fault_plane_throw</span><span class="p">[:],</span> <span class="s2">&quot;fault_segments_throw&quot;</span>
</span><span id="Faults-256"><a href="#-256"><span class="linenos"> 256</span></a>            <span class="p">)</span>
</span><span id="Faults-257"><a href="#-257"><span class="linenos"> 257</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">write_cube_to_disk</span><span class="p">(</span>
</span><span id="Faults-258"><a href="#-258"><span class="linenos"> 258</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">fault_plane_azimuth</span><span class="p">[:],</span> <span class="s2">&quot;fault_segments_azimuth&quot;</span>
</span><span id="Faults-259"><a href="#-259"><span class="linenos"> 259</span></a>            <span class="p">)</span>
</span><span id="Faults-260"><a href="#-260"><span class="linenos"> 260</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_store</span><span class="p">:</span>
</span><span id="Faults-261"><a href="#-261"><span class="linenos"> 261</span></a>            <span class="c1"># Write faulted age, onlap and fault segment cubes to hdf</span>
</span><span id="Faults-262"><a href="#-262"><span class="linenos"> 262</span></a>            <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
</span><span id="Faults-263"><a href="#-263"><span class="linenos"> 263</span></a>                <span class="p">[</span>
</span><span id="Faults-264"><a href="#-264"><span class="linenos"> 264</span></a>                    <span class="s2">&quot;geologic_age_faulted&quot;</span><span class="p">,</span>
</span><span id="Faults-265"><a href="#-265"><span class="linenos"> 265</span></a>                    <span class="s2">&quot;onlap_segments&quot;</span><span class="p">,</span>
</span><span id="Faults-266"><a href="#-266"><span class="linenos"> 266</span></a>                    <span class="s2">&quot;fault_segments&quot;</span><span class="p">,</span>
</span><span id="Faults-267"><a href="#-267"><span class="linenos"> 267</span></a>                    <span class="s2">&quot;fault_intersection_segments&quot;</span><span class="p">,</span>
</span><span id="Faults-268"><a href="#-268"><span class="linenos"> 268</span></a>                    <span class="s2">&quot;fault_segments_throw&quot;</span><span class="p">,</span>
</span><span id="Faults-269"><a href="#-269"><span class="linenos"> 269</span></a>                    <span class="s2">&quot;fault_segments_azimuth&quot;</span><span class="p">,</span>
</span><span id="Faults-270"><a href="#-270"><span class="linenos"> 270</span></a>                <span class="p">],</span>
</span><span id="Faults-271"><a href="#-271"><span class="linenos"> 271</span></a>                <span class="p">[</span>
</span><span id="Faults-272"><a href="#-272"><span class="linenos"> 272</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">faulted_age_volume</span><span class="p">,</span>
</span><span id="Faults-273"><a href="#-273"><span class="linenos"> 273</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">faulted_onlap_segments</span><span class="p">,</span>
</span><span id="Faults-274"><a href="#-274"><span class="linenos"> 274</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">fault_planes</span><span class="p">,</span>
</span><span id="Faults-275"><a href="#-275"><span class="linenos"> 275</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">fault_intersections</span><span class="p">,</span>
</span><span id="Faults-276"><a href="#-276"><span class="linenos"> 276</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">fault_plane_throw</span><span class="p">,</span>
</span><span id="Faults-277"><a href="#-277"><span class="linenos"> 277</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">fault_plane_azimuth</span><span class="p">,</span>
</span><span id="Faults-278"><a href="#-278"><span class="linenos"> 278</span></a>                <span class="p">],</span>
</span><span id="Faults-279"><a href="#-279"><span class="linenos"> 279</span></a>            <span class="p">):</span>
</span><span id="Faults-280"><a href="#-280"><span class="linenos"> 280</span></a>                <span class="n">write_data_to_hdf</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_master</span><span class="p">)</span>
</span><span id="Faults-281"><a href="#-281"><span class="linenos"> 281</span></a>
</span><span id="Faults-282"><a href="#-282"><span class="linenos"> 282</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">qc_plots</span><span class="p">:</span>
</span><span id="Faults-283"><a href="#-283"><span class="linenos"> 283</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">create_qc_plots</span><span class="p">()</span>
</span><span id="Faults-284"><a href="#-284"><span class="linenos"> 284</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="Faults-285"><a href="#-285"><span class="linenos"> 285</span></a>                <span class="c1"># Create 3D qc plot</span>
</span><span id="Faults-286"><a href="#-286"><span class="linenos"> 286</span></a>                <span class="n">plot_3D_faults_plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
</span><span id="Faults-287"><a href="#-287"><span class="linenos"> 287</span></a>            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
</span><span id="Faults-288"><a href="#-288"><span class="linenos"> 288</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span><span class="s2">&quot;3D Fault Plotting Failed&quot;</span><span class="p">)</span>
</span><span id="Faults-289"><a href="#-289"><span class="linenos"> 289</span></a>
</span><span id="Faults-290"><a href="#-290"><span class="linenos"> 290</span></a>    <span class="k">def</span> <span class="nf">build_faulted_property_geomodels</span><span class="p">(</span>
</span><span id="Faults-291"><a href="#-291"><span class="linenos"> 291</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Faults-292"><a href="#-292"><span class="linenos"> 292</span></a>        <span class="n">facies</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
</span><span id="Faults-293"><a href="#-293"><span class="linenos"> 293</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Faults-294"><a href="#-294"><span class="linenos"> 294</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="Faults-295"><a href="#-295"><span class="linenos"> 295</span></a><span class="sd">        Build Faulted Property Geomodels</span>
</span><span id="Faults-296"><a href="#-296"><span class="linenos"> 296</span></a><span class="sd">        ------------</span>
</span><span id="Faults-297"><a href="#-297"><span class="linenos"> 297</span></a><span class="sd">        Generates faulted property geomodels.</span>
</span><span id="Faults-298"><a href="#-298"><span class="linenos"> 298</span></a>
</span><span id="Faults-299"><a href="#-299"><span class="linenos"> 299</span></a><span class="sd">        **The method does the following:**</span>
</span><span id="Faults-300"><a href="#-300"><span class="linenos"> 300</span></a>
</span><span id="Faults-301"><a href="#-301"><span class="linenos"> 301</span></a><span class="sd">        Use faulted geologic_age cube, depth_maps and facies</span>
</span><span id="Faults-302"><a href="#-302"><span class="linenos"> 302</span></a><span class="sd">        to create geomodel properties (depth, lith)</span>
</span><span id="Faults-303"><a href="#-303"><span class="linenos"> 303</span></a>
</span><span id="Faults-304"><a href="#-304"><span class="linenos"> 304</span></a><span class="sd">        - lithology</span>
</span><span id="Faults-305"><a href="#-305"><span class="linenos"> 305</span></a><span class="sd">        - net_to_gross (to create effective sand layers)</span>
</span><span id="Faults-306"><a href="#-306"><span class="linenos"> 306</span></a><span class="sd">        - depth below mudline</span>
</span><span id="Faults-307"><a href="#-307"><span class="linenos"> 307</span></a><span class="sd">        - randomised depth below mudline (to </span>
</span><span id="Faults-308"><a href="#-308"><span class="linenos"> 308</span></a><span class="sd">          randomise the rock properties per layer)</span>
</span><span id="Faults-309"><a href="#-309"><span class="linenos"> 309</span></a>
</span><span id="Faults-310"><a href="#-310"><span class="linenos"> 310</span></a><span class="sd">        Parameters</span>
</span><span id="Faults-311"><a href="#-311"><span class="linenos"> 311</span></a><span class="sd">        ----------</span>
</span><span id="Faults-312"><a href="#-312"><span class="linenos"> 312</span></a><span class="sd">        facies : np.ndarray</span>
</span><span id="Faults-313"><a href="#-313"><span class="linenos"> 313</span></a><span class="sd">            The Horizons class used to build the faults.</span>
</span><span id="Faults-314"><a href="#-314"><span class="linenos"> 314</span></a>
</span><span id="Faults-315"><a href="#-315"><span class="linenos"> 315</span></a><span class="sd">        Returns</span>
</span><span id="Faults-316"><a href="#-316"><span class="linenos"> 316</span></a><span class="sd">        -------</span>
</span><span id="Faults-317"><a href="#-317"><span class="linenos"> 317</span></a><span class="sd">        None</span>
</span><span id="Faults-318"><a href="#-318"><span class="linenos"> 318</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Faults-319"><a href="#-319"><span class="linenos"> 319</span></a>        <span class="n">work_cube_lith</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="Faults-320"><a href="#-320"><span class="linenos"> 320</span></a>            <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faulted_age_volume</span><span class="p">)</span> <span class="o">*</span> <span class="o">-</span><span class="mi">1</span>
</span><span id="Faults-321"><a href="#-321"><span class="linenos"> 321</span></a>        <span class="p">)</span>  <span class="c1"># initialise lith cube to water</span>
</span><span id="Faults-322"><a href="#-322"><span class="linenos"> 322</span></a>        <span class="n">work_cube_sealed</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faulted_age_volume</span><span class="p">)</span>
</span><span id="Faults-323"><a href="#-323"><span class="linenos"> 323</span></a>        <span class="n">work_cube_net_to_gross</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faulted_age_volume</span><span class="p">)</span>
</span><span id="Faults-324"><a href="#-324"><span class="linenos"> 324</span></a>        <span class="n">work_cube_depth</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faulted_age_volume</span><span class="p">)</span>
</span><span id="Faults-325"><a href="#-325"><span class="linenos"> 325</span></a>        <span class="c1"># Also create a randomised depth cube for generating randomised rock properties</span>
</span><span id="Faults-326"><a href="#-326"><span class="linenos"> 326</span></a>        <span class="c1"># final dimension&#39;s shape is based on number of possible list types</span>
</span><span id="Faults-327"><a href="#-327"><span class="linenos"> 327</span></a>        <span class="c1"># currently  one of [&#39;seawater&#39;, &#39;shale&#39;, &#39;sand&#39;]</span>
</span><span id="Faults-328"><a href="#-328"><span class="linenos"> 328</span></a>        <span class="c1"># n_lith = len([&#39;shale&#39;, &#39;sand&#39;])</span>
</span><span id="Faults-329"><a href="#-329"><span class="linenos"> 329</span></a>        <span class="n">cube_shape</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">faulted_age_volume</span><span class="o">.</span><span class="n">shape</span>
</span><span id="Faults-330"><a href="#-330"><span class="linenos"> 330</span></a>        <span class="c1"># randomised_depth = np.zeros(cube_shape, &#39;float32&#39;)</span>
</span><span id="Faults-331"><a href="#-331"><span class="linenos"> 331</span></a>
</span><span id="Faults-332"><a href="#-332"><span class="linenos"> 332</span></a>        <span class="n">ii</span><span class="p">,</span> <span class="n">jj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">build_meshgrid</span><span class="p">()</span>
</span><span id="Faults-333"><a href="#-333"><span class="linenos"> 333</span></a>
</span><span id="Faults-334"><a href="#-334"><span class="linenos"> 334</span></a>        <span class="c1"># Loop over layers in reverse order, start at base</span>
</span><span id="Faults-335"><a href="#-335"><span class="linenos"> 335</span></a>        <span class="n">previous_depth_map</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">faulted_depth_maps</span><span class="p">[:,</span> <span class="p">:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="Faults-336"><a href="#-336"><span class="linenos"> 336</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">partial_voxels</span><span class="p">:</span>
</span><span id="Faults-337"><a href="#-337"><span class="linenos"> 337</span></a>            <span class="c1"># add .5 to consider partial voxels from half above and half below</span>
</span><span id="Faults-338"><a href="#-338"><span class="linenos"> 338</span></a>            <span class="n">previous_depth_map</span> <span class="o">+=</span> <span class="mf">0.5</span>
</span><span id="Faults-339"><a href="#-339"><span class="linenos"> 339</span></a>
</span><span id="Faults-340"><a href="#-340"><span class="linenos"> 340</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faulted_depth_maps</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
</span><span id="Faults-341"><a href="#-341"><span class="linenos"> 341</span></a>            <span class="c1"># Apply a random depth shift within the range as provided in config file</span>
</span><span id="Faults-342"><a href="#-342"><span class="linenos"> 342</span></a>            <span class="c1"># (provided in metres, so converted to samples here)</span>
</span><span id="Faults-343"><a href="#-343"><span class="linenos"> 343</span></a>
</span><span id="Faults-344"><a href="#-344"><span class="linenos"> 344</span></a>            <span class="n">current_depth_map</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">faulted_depth_maps</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">i</span><span class="p">]</span>
</span><span id="Faults-345"><a href="#-345"><span class="linenos"> 345</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">partial_voxels</span><span class="p">:</span>
</span><span id="Faults-346"><a href="#-346"><span class="linenos"> 346</span></a>                <span class="n">current_depth_map</span> <span class="o">+=</span> <span class="mf">0.5</span>
</span><span id="Faults-347"><a href="#-347"><span class="linenos"> 347</span></a>
</span><span id="Faults-348"><a href="#-348"><span class="linenos"> 348</span></a>            <span class="c1"># compute maps with indices of top map and base map to include partial voxels</span>
</span><span id="Faults-349"><a href="#-349"><span class="linenos"> 349</span></a>            <span class="n">top_map_index</span> <span class="o">=</span> <span class="n">current_depth_map</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;int&quot;</span><span class="p">)</span>
</span><span id="Faults-350"><a href="#-350"><span class="linenos"> 350</span></a>            <span class="n">base_map_index</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="Faults-351"><a href="#-351"><span class="linenos"> 351</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">faulted_depth_maps</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;int&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="Faults-352"><a href="#-352"><span class="linenos"> 352</span></a>            <span class="p">)</span>
</span><span id="Faults-353"><a href="#-353"><span class="linenos"> 353</span></a>
</span><span id="Faults-354"><a href="#-354"><span class="linenos"> 354</span></a>            <span class="c1"># compute thickness over which to iterate</span>
</span><span id="Faults-355"><a href="#-355"><span class="linenos"> 355</span></a>            <span class="n">thickness_map</span> <span class="o">=</span> <span class="n">base_map_index</span> <span class="o">-</span> <span class="n">top_map_index</span>
</span><span id="Faults-356"><a href="#-356"><span class="linenos"> 356</span></a>            <span class="n">thickness_map_max</span> <span class="o">=</span> <span class="n">thickness_map</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</span><span id="Faults-357"><a href="#-357"><span class="linenos"> 357</span></a>
</span><span id="Faults-358"><a href="#-358"><span class="linenos"> 358</span></a>            <span class="n">tvdml_map</span> <span class="o">=</span> <span class="n">previous_depth_map</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">faulted_depth_maps</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span>
</span><span id="Faults-359"><a href="#-359"><span class="linenos"> 359</span></a>            <span class="c1"># Net to Gross Map for layer</span>
</span><span id="Faults-360"><a href="#-360"><span class="linenos"> 360</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">variable_shale_ng</span><span class="p">:</span>
</span><span id="Faults-361"><a href="#-361"><span class="linenos"> 361</span></a>                <span class="n">ng_map</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span>
</span><span id="Faults-362"><a href="#-362"><span class="linenos"> 362</span></a>                    <span class="n">shape</span><span class="o">=</span><span class="p">(</span>
</span><span id="Faults-363"><a href="#-363"><span class="linenos"> 363</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">faulted_depth_maps</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
</span><span id="Faults-364"><a href="#-364"><span class="linenos"> 364</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">faulted_depth_maps</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
</span><span id="Faults-365"><a href="#-365"><span class="linenos"> 365</span></a>                    <span class="p">)</span>
</span><span id="Faults-366"><a href="#-366"><span class="linenos"> 366</span></a>                <span class="p">)</span>
</span><span id="Faults-367"><a href="#-367"><span class="linenos"> 367</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Faults-368"><a href="#-368"><span class="linenos"> 368</span></a>                <span class="k">if</span> <span class="p">(</span>
</span><span id="Faults-369"><a href="#-369"><span class="linenos"> 369</span></a>                    <span class="n">facies</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mf">0.0</span>
</span><span id="Faults-370"><a href="#-370"><span class="linenos"> 370</span></a>                <span class="p">):</span>  <span class="c1"># if shale layer, make non-zero N/G map for layer using a low average net to gross</span>
</span><span id="Faults-371"><a href="#-371"><span class="linenos"> 371</span></a>                    <span class="n">ng_map</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_random_net_over_gross_map</span><span class="p">(</span>
</span><span id="Faults-372"><a href="#-372"><span class="linenos"> 372</span></a>                        <span class="n">avg</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">),</span> <span class="n">stdev</span><span class="o">=</span><span class="p">(</span><span class="mf">0.001</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">),</span> <span class="n">octave</span><span class="o">=</span><span class="mi">3</span>
</span><span id="Faults-373"><a href="#-373"><span class="linenos"> 373</span></a>                    <span class="p">)</span>
</span><span id="Faults-374"><a href="#-374"><span class="linenos"> 374</span></a>            <span class="k">if</span> <span class="n">facies</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mf">1.0</span><span class="p">:</span>  <span class="c1"># if sand layer, make non-zero N/G map for layer</span>
</span><span id="Faults-375"><a href="#-375"><span class="linenos"> 375</span></a>                <span class="n">ng_map</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_random_net_over_gross_map</span><span class="p">()</span>
</span><span id="Faults-376"><a href="#-376"><span class="linenos"> 376</span></a>
</span><span id="Faults-377"><a href="#-377"><span class="linenos"> 377</span></a>            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">thickness_map_max</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="Faults-378"><a href="#-378"><span class="linenos"> 378</span></a>
</span><span id="Faults-379"><a href="#-379"><span class="linenos"> 379</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">partial_voxels</span><span class="p">:</span>
</span><span id="Faults-380"><a href="#-380"><span class="linenos"> 380</span></a>                    <span class="c1"># compute fraction of voxel containing layer</span>
</span><span id="Faults-381"><a href="#-381"><span class="linenos"> 381</span></a>                    <span class="n">top_map</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span>
</span><span id="Faults-382"><a href="#-382"><span class="linenos"> 382</span></a>                        <span class="n">np</span><span class="o">.</span><span class="n">dstack</span><span class="p">(</span>
</span><span id="Faults-383"><a href="#-383"><span class="linenos"> 383</span></a>                            <span class="p">(</span><span class="n">current_depth_map</span><span class="p">,</span> <span class="n">top_map_index</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;float32&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="n">k</span><span class="p">)</span>
</span><span id="Faults-384"><a href="#-384"><span class="linenos"> 384</span></a>                        <span class="p">),</span>
</span><span id="Faults-385"><a href="#-385"><span class="linenos"> 385</span></a>                        <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
</span><span id="Faults-386"><a href="#-386"><span class="linenos"> 386</span></a>                    <span class="p">)</span>
</span><span id="Faults-387"><a href="#-387"><span class="linenos"> 387</span></a>                    <span class="n">top_map</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dstack</span><span class="p">((</span><span class="n">top_map</span><span class="p">,</span> <span class="n">previous_depth_map</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="Faults-388"><a href="#-388"><span class="linenos"> 388</span></a>                    <span class="n">base_map</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span>
</span><span id="Faults-389"><a href="#-389"><span class="linenos"> 389</span></a>                        <span class="n">np</span><span class="o">.</span><span class="n">dstack</span><span class="p">(</span>
</span><span id="Faults-390"><a href="#-390"><span class="linenos"> 390</span></a>                            <span class="p">(</span>
</span><span id="Faults-391"><a href="#-391"><span class="linenos"> 391</span></a>                                <span class="n">previous_depth_map</span><span class="p">,</span>
</span><span id="Faults-392"><a href="#-392"><span class="linenos"> 392</span></a>                                <span class="n">top_map_index</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;float32&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="Faults-393"><a href="#-393"><span class="linenos"> 393</span></a>                            <span class="p">)</span>
</span><span id="Faults-394"><a href="#-394"><span class="linenos"> 394</span></a>                        <span class="p">),</span>
</span><span id="Faults-395"><a href="#-395"><span class="linenos"> 395</span></a>                        <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
</span><span id="Faults-396"><a href="#-396"><span class="linenos"> 396</span></a>                    <span class="p">)</span>
</span><span id="Faults-397"><a href="#-397"><span class="linenos"> 397</span></a>                    <span class="n">fraction_of_voxel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">base_map</span> <span class="o">-</span> <span class="n">top_map</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
</span><span id="Faults-398"><a href="#-398"><span class="linenos"> 398</span></a>                    <span class="n">valid_k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
</span><span id="Faults-399"><a href="#-399"><span class="linenos"> 399</span></a>                        <span class="p">(</span><span class="n">fraction_of_voxel</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">)</span>
</span><span id="Faults-400"><a href="#-400"><span class="linenos"> 400</span></a>                        <span class="o">&amp;</span> <span class="p">((</span><span class="n">top_map_index</span> <span class="o">+</span> <span class="n">k</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;int&quot;</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">cube_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span>
</span><span id="Faults-401"><a href="#-401"><span class="linenos"> 401</span></a>                        <span class="mi">1</span><span class="p">,</span>
</span><span id="Faults-402"><a href="#-402"><span class="linenos"> 402</span></a>                        <span class="mi">0</span><span class="p">,</span>
</span><span id="Faults-403"><a href="#-403"><span class="linenos"> 403</span></a>                    <span class="p">)</span>
</span><span id="Faults-404"><a href="#-404"><span class="linenos"> 404</span></a>
</span><span id="Faults-405"><a href="#-405"><span class="linenos"> 405</span></a>                    <span class="c1"># put layer properties in the cube for each case</span>
</span><span id="Faults-406"><a href="#-406"><span class="linenos"> 406</span></a>                    <span class="n">sublayer_ii</span> <span class="o">=</span> <span class="n">ii</span><span class="p">[</span><span class="n">valid_k</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="Faults-407"><a href="#-407"><span class="linenos"> 407</span></a>                    <span class="n">sublayer_jj</span> <span class="o">=</span> <span class="n">jj</span><span class="p">[</span><span class="n">valid_k</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="Faults-408"><a href="#-408"><span class="linenos"> 408</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Faults-409"><a href="#-409"><span class="linenos"> 409</span></a>                    <span class="n">sublayer_ii</span> <span class="o">=</span> <span class="n">ii</span><span class="p">[</span><span class="n">thickness_map</span> <span class="o">&gt;</span> <span class="n">k</span><span class="p">]</span>
</span><span id="Faults-410"><a href="#-410"><span class="linenos"> 410</span></a>                    <span class="n">sublayer_jj</span> <span class="o">=</span> <span class="n">jj</span><span class="p">[</span><span class="n">thickness_map</span> <span class="o">&gt;</span> <span class="n">k</span><span class="p">]</span>
</span><span id="Faults-411"><a href="#-411"><span class="linenos"> 411</span></a>
</span><span id="Faults-412"><a href="#-412"><span class="linenos"> 412</span></a>                <span class="k">if</span> <span class="n">sublayer_ii</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Faults-413"><a href="#-413"><span class="linenos"> 413</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">partial_voxels</span><span class="p">:</span>
</span><span id="Faults-414"><a href="#-414"><span class="linenos"> 414</span></a>                        <span class="n">sublayer_depth_map</span> <span class="o">=</span> <span class="p">(</span><span class="n">top_map_index</span> <span class="o">+</span> <span class="n">k</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;int&quot;</span><span class="p">)[</span>
</span><span id="Faults-415"><a href="#-415"><span class="linenos"> 415</span></a>                            <span class="n">valid_k</span> <span class="o">==</span> <span class="mi">1</span>
</span><span id="Faults-416"><a href="#-416"><span class="linenos"> 416</span></a>                        <span class="p">]</span>
</span><span id="Faults-417"><a href="#-417"><span class="linenos"> 417</span></a>                        <span class="n">sublayer_depth_map_int</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">sublayer_depth_map</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="Faults-418"><a href="#-418"><span class="linenos"> 418</span></a>                        <span class="n">sublayer_ng_map</span> <span class="o">=</span> <span class="n">ng_map</span><span class="p">[</span><span class="n">valid_k</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="Faults-419"><a href="#-419"><span class="linenos"> 419</span></a>                        <span class="n">sublayer_tvdml_map</span> <span class="o">=</span> <span class="n">tvdml_map</span><span class="p">[</span><span class="n">valid_k</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="Faults-420"><a href="#-420"><span class="linenos"> 420</span></a>                        <span class="n">sublayer_fraction</span> <span class="o">=</span> <span class="n">fraction_of_voxel</span><span class="p">[</span><span class="n">valid_k</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="Faults-421"><a href="#-421"><span class="linenos"> 421</span></a>
</span><span id="Faults-422"><a href="#-422"><span class="linenos"> 422</span></a>                        <span class="c1"># Lithology cube</span>
</span><span id="Faults-423"><a href="#-423"><span class="linenos"> 423</span></a>                        <span class="n">input_cube</span> <span class="o">=</span> <span class="n">work_cube_lith</span><span class="p">[</span>
</span><span id="Faults-424"><a href="#-424"><span class="linenos"> 424</span></a>                            <span class="n">sublayer_ii</span><span class="p">,</span> <span class="n">sublayer_jj</span><span class="p">,</span> <span class="n">sublayer_depth_map_int</span>
</span><span id="Faults-425"><a href="#-425"><span class="linenos"> 425</span></a>                        <span class="p">]</span>
</span><span id="Faults-426"><a href="#-426"><span class="linenos"> 426</span></a>                        <span class="n">values</span> <span class="o">=</span> <span class="n">facies</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">sublayer_fraction</span>
</span><span id="Faults-427"><a href="#-427"><span class="linenos"> 427</span></a>                        <span class="n">input_cube</span><span class="p">[</span><span class="n">input_cube</span> <span class="o">==</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="Faults-428"><a href="#-428"><span class="linenos"> 428</span></a>                            <span class="n">values</span><span class="p">[</span><span class="n">input_cube</span> <span class="o">==</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1.0</span>
</span><span id="Faults-429"><a href="#-429"><span class="linenos"> 429</span></a>                        <span class="p">)</span>
</span><span id="Faults-430"><a href="#-430"><span class="linenos"> 430</span></a>                        <span class="n">input_cube</span><span class="p">[</span><span class="n">input_cube</span> <span class="o">!=</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">]</span> <span class="o">+=</span> <span class="n">values</span><span class="p">[</span><span class="n">input_cube</span> <span class="o">!=</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">]</span>
</span><span id="Faults-431"><a href="#-431"><span class="linenos"> 431</span></a>                        <span class="n">work_cube_lith</span><span class="p">[</span>
</span><span id="Faults-432"><a href="#-432"><span class="linenos"> 432</span></a>                            <span class="n">sublayer_ii</span><span class="p">,</span> <span class="n">sublayer_jj</span><span class="p">,</span> <span class="n">sublayer_depth_map_int</span>
</span><span id="Faults-433"><a href="#-433"><span class="linenos"> 433</span></a>                        <span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">input_cube</span> <span class="o">*</span> <span class="mf">1.0</span><span class="p">)</span>
</span><span id="Faults-434"><a href="#-434"><span class="linenos"> 434</span></a>                        <span class="k">del</span> <span class="n">input_cube</span>
</span><span id="Faults-435"><a href="#-435"><span class="linenos"> 435</span></a>                        <span class="k">del</span> <span class="n">values</span>
</span><span id="Faults-436"><a href="#-436"><span class="linenos"> 436</span></a>
</span><span id="Faults-437"><a href="#-437"><span class="linenos"> 437</span></a>                        <span class="n">input_cube</span> <span class="o">=</span> <span class="n">work_cube_sealed</span><span class="p">[</span>
</span><span id="Faults-438"><a href="#-438"><span class="linenos"> 438</span></a>                            <span class="n">sublayer_ii</span><span class="p">,</span> <span class="n">sublayer_jj</span><span class="p">,</span> <span class="n">sublayer_depth_map_int</span>
</span><span id="Faults-439"><a href="#-439"><span class="linenos"> 439</span></a>                        <span class="p">]</span>
</span><span id="Faults-440"><a href="#-440"><span class="linenos"> 440</span></a>                        <span class="n">values</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">facies</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="n">sublayer_fraction</span>
</span><span id="Faults-441"><a href="#-441"><span class="linenos"> 441</span></a>                        <span class="n">input_cube</span><span class="p">[</span><span class="n">input_cube</span> <span class="o">==</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="Faults-442"><a href="#-442"><span class="linenos"> 442</span></a>                            <span class="n">values</span><span class="p">[</span><span class="n">input_cube</span> <span class="o">==</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1.0</span>
</span><span id="Faults-443"><a href="#-443"><span class="linenos"> 443</span></a>                        <span class="p">)</span>
</span><span id="Faults-444"><a href="#-444"><span class="linenos"> 444</span></a>                        <span class="n">input_cube</span><span class="p">[</span><span class="n">input_cube</span> <span class="o">!=</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">]</span> <span class="o">+=</span> <span class="n">values</span><span class="p">[</span><span class="n">input_cube</span> <span class="o">!=</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">]</span>
</span><span id="Faults-445"><a href="#-445"><span class="linenos"> 445</span></a>                        <span class="n">work_cube_sealed</span><span class="p">[</span>
</span><span id="Faults-446"><a href="#-446"><span class="linenos"> 446</span></a>                            <span class="n">sublayer_ii</span><span class="p">,</span> <span class="n">sublayer_jj</span><span class="p">,</span> <span class="n">sublayer_depth_map_int</span>
</span><span id="Faults-447"><a href="#-447"><span class="linenos"> 447</span></a>                        <span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">input_cube</span> <span class="o">*</span> <span class="mf">1.0</span><span class="p">)</span>
</span><span id="Faults-448"><a href="#-448"><span class="linenos"> 448</span></a>                        <span class="k">del</span> <span class="n">input_cube</span>
</span><span id="Faults-449"><a href="#-449"><span class="linenos"> 449</span></a>                        <span class="k">del</span> <span class="n">values</span>
</span><span id="Faults-450"><a href="#-450"><span class="linenos"> 450</span></a>
</span><span id="Faults-451"><a href="#-451"><span class="linenos"> 451</span></a>                        <span class="c1"># Depth cube</span>
</span><span id="Faults-452"><a href="#-452"><span class="linenos"> 452</span></a>                        <span class="n">work_cube_depth</span><span class="p">[</span>
</span><span id="Faults-453"><a href="#-453"><span class="linenos"> 453</span></a>                            <span class="n">sublayer_ii</span><span class="p">,</span> <span class="n">sublayer_jj</span><span class="p">,</span> <span class="n">sublayer_depth_map_int</span>
</span><span id="Faults-454"><a href="#-454"><span class="linenos"> 454</span></a>                        <span class="p">]</span> <span class="o">+=</span> <span class="p">(</span><span class="n">sublayer_tvdml_map</span> <span class="o">*</span> <span class="n">sublayer_fraction</span><span class="p">)</span>
</span><span id="Faults-455"><a href="#-455"><span class="linenos"> 455</span></a>                        <span class="c1"># Net to Gross cube</span>
</span><span id="Faults-456"><a href="#-456"><span class="linenos"> 456</span></a>                        <span class="n">work_cube_net_to_gross</span><span class="p">[</span>
</span><span id="Faults-457"><a href="#-457"><span class="linenos"> 457</span></a>                            <span class="n">sublayer_ii</span><span class="p">,</span> <span class="n">sublayer_jj</span><span class="p">,</span> <span class="n">sublayer_depth_map_int</span>
</span><span id="Faults-458"><a href="#-458"><span class="linenos"> 458</span></a>                        <span class="p">]</span> <span class="o">+=</span> <span class="p">(</span><span class="n">sublayer_ng_map</span> <span class="o">*</span> <span class="n">sublayer_fraction</span><span class="p">)</span>
</span><span id="Faults-459"><a href="#-459"><span class="linenos"> 459</span></a>
</span><span id="Faults-460"><a href="#-460"><span class="linenos"> 460</span></a>                        <span class="c1"># Randomised Depth Cube</span>
</span><span id="Faults-461"><a href="#-461"><span class="linenos"> 461</span></a>                        <span class="c1"># randomised_depth[sublayer_ii, sublayer_jj, sublayer_depth_map_int] += \</span>
</span><span id="Faults-462"><a href="#-462"><span class="linenos"> 462</span></a>                        <span class="c1">#     (sublayer_tvdml_map + random_z_perturbation) * sublayer_fraction</span>
</span><span id="Faults-463"><a href="#-463"><span class="linenos"> 463</span></a>
</span><span id="Faults-464"><a href="#-464"><span class="linenos"> 464</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="Faults-465"><a href="#-465"><span class="linenos"> 465</span></a>                        <span class="n">sublayer_depth_map_int</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="Faults-466"><a href="#-466"><span class="linenos"> 466</span></a>                            <span class="mf">0.5</span>
</span><span id="Faults-467"><a href="#-467"><span class="linenos"> 467</span></a>                            <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span>
</span><span id="Faults-468"><a href="#-468"><span class="linenos"> 468</span></a>                                <span class="n">previous_depth_map</span><span class="p">[</span><span class="n">thickness_map</span> <span class="o">&gt;</span> <span class="n">k</span><span class="p">],</span>
</span><span id="Faults-469"><a href="#-469"><span class="linenos"> 469</span></a>                                <span class="mi">0</span><span class="p">,</span>
</span><span id="Faults-470"><a href="#-470"><span class="linenos"> 470</span></a>                                <span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">geologic_age</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="Faults-471"><a href="#-471"><span class="linenos"> 471</span></a>                            <span class="p">)</span>
</span><span id="Faults-472"><a href="#-472"><span class="linenos"> 472</span></a>                        <span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;int&quot;</span><span class="p">)</span> <span class="o">-</span> <span class="n">k</span>
</span><span id="Faults-473"><a href="#-473"><span class="linenos"> 473</span></a>                        <span class="n">sublayer_tvdml_map</span> <span class="o">=</span> <span class="n">tvdml_map</span><span class="p">[</span><span class="n">thickness_map</span> <span class="o">&gt;</span> <span class="n">k</span><span class="p">]</span>
</span><span id="Faults-474"><a href="#-474"><span class="linenos"> 474</span></a>                        <span class="n">sublayer_ng_map</span> <span class="o">=</span> <span class="n">ng_map</span><span class="p">[</span><span class="n">thickness_map</span> <span class="o">&gt;</span> <span class="n">k</span><span class="p">]</span>
</span><span id="Faults-475"><a href="#-475"><span class="linenos"> 475</span></a>
</span><span id="Faults-476"><a href="#-476"><span class="linenos"> 476</span></a>                        <span class="n">work_cube_lith</span><span class="p">[</span>
</span><span id="Faults-477"><a href="#-477"><span class="linenos"> 477</span></a>                            <span class="n">sublayer_ii</span><span class="p">,</span> <span class="n">sublayer_jj</span><span class="p">,</span> <span class="n">sublayer_depth_map_int</span>
</span><span id="Faults-478"><a href="#-478"><span class="linenos"> 478</span></a>                        <span class="p">]</span> <span class="o">=</span> <span class="n">facies</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="Faults-479"><a href="#-479"><span class="linenos"> 479</span></a>                        <span class="n">work_cube_sealed</span><span class="p">[</span>
</span><span id="Faults-480"><a href="#-480"><span class="linenos"> 480</span></a>                            <span class="n">sublayer_ii</span><span class="p">,</span> <span class="n">sublayer_jj</span><span class="p">,</span> <span class="n">sublayer_depth_map_int</span>
</span><span id="Faults-481"><a href="#-481"><span class="linenos"> 481</span></a>                        <span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">facies</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span>
</span><span id="Faults-482"><a href="#-482"><span class="linenos"> 482</span></a>
</span><span id="Faults-483"><a href="#-483"><span class="linenos"> 483</span></a>                        <span class="n">work_cube_depth</span><span class="p">[</span>
</span><span id="Faults-484"><a href="#-484"><span class="linenos"> 484</span></a>                            <span class="n">sublayer_ii</span><span class="p">,</span> <span class="n">sublayer_jj</span><span class="p">,</span> <span class="n">sublayer_depth_map_int</span>
</span><span id="Faults-485"><a href="#-485"><span class="linenos"> 485</span></a>                        <span class="p">]</span> <span class="o">=</span> <span class="n">sublayer_tvdml_map</span>
</span><span id="Faults-486"><a href="#-486"><span class="linenos"> 486</span></a>                        <span class="n">work_cube_net_to_gross</span><span class="p">[</span>
</span><span id="Faults-487"><a href="#-487"><span class="linenos"> 487</span></a>                            <span class="n">sublayer_ii</span><span class="p">,</span> <span class="n">sublayer_jj</span><span class="p">,</span> <span class="n">sublayer_depth_map_int</span>
</span><span id="Faults-488"><a href="#-488"><span class="linenos"> 488</span></a>                        <span class="p">]</span> <span class="o">+=</span> <span class="n">sublayer_ng_map</span>
</span><span id="Faults-489"><a href="#-489"><span class="linenos"> 489</span></a>                        <span class="c1"># randomised_depth[sublayer_ii, sublayer_jj, sublayer_depth_map_int] += (sublayer_tvdml_map + random_z_perturbation)</span>
</span><span id="Faults-490"><a href="#-490"><span class="linenos"> 490</span></a>
</span><span id="Faults-491"><a href="#-491"><span class="linenos"> 491</span></a>            <span class="c1"># replace previous depth map for next iteration</span>
</span><span id="Faults-492"><a href="#-492"><span class="linenos"> 492</span></a>            <span class="n">previous_depth_map</span> <span class="o">=</span> <span class="n">current_depth_map</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Faults-493"><a href="#-493"><span class="linenos"> 493</span></a>
</span><span id="Faults-494"><a href="#-494"><span class="linenos"> 494</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Faults-495"><a href="#-495"><span class="linenos"> 495</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2"> ... After infilling ...&quot;</span><span class="p">)</span>
</span><span id="Faults-496"><a href="#-496"><span class="linenos"> 496</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">write_cube_to_disk</span><span class="p">(</span><span class="n">work_cube_sealed</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;uint8&quot;</span><span class="p">),</span> <span class="s2">&quot;sealed_label&quot;</span><span class="p">)</span>
</span><span id="Faults-497"><a href="#-497"><span class="linenos"> 497</span></a>
</span><span id="Faults-498"><a href="#-498"><span class="linenos"> 498</span></a>        <span class="c1"># Clip cubes and convert from samples to units</span>
</span><span id="Faults-499"><a href="#-499"><span class="linenos"> 499</span></a>        <span class="n">work_cube_lith</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">work_cube_lith</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>  <span class="c1"># clip lith to [-1, +1]</span>
</span><span id="Faults-500"><a href="#-500"><span class="linenos"> 500</span></a>        <span class="n">work_cube_net_to_gross</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span>
</span><span id="Faults-501"><a href="#-501"><span class="linenos"> 501</span></a>            <span class="n">work_cube_net_to_gross</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">1.0</span>
</span><span id="Faults-502"><a href="#-502"><span class="linenos"> 502</span></a>        <span class="p">)</span>  <span class="c1"># clip n/g to [0, 1]</span>
</span><span id="Faults-503"><a href="#-503"><span class="linenos"> 503</span></a>        <span class="n">work_cube_depth</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">work_cube_depth</span><span class="p">,</span> <span class="n">a_min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">a_max</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</span><span id="Faults-504"><a href="#-504"><span class="linenos"> 504</span></a>        <span class="n">work_cube_depth</span> <span class="o">*=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">digi</span>
</span><span id="Faults-505"><a href="#-505"><span class="linenos"> 505</span></a>
</span><span id="Faults-506"><a href="#-506"><span class="linenos"> 506</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">include_salt</span><span class="p">:</span>
</span><span id="Faults-507"><a href="#-507"><span class="linenos"> 507</span></a>            <span class="c1"># Update age model after horizons have been modified by salt inclusion</span>
</span><span id="Faults-508"><a href="#-508"><span class="linenos"> 508</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">faulted_age_volume</span><span class="p">[</span>
</span><span id="Faults-509"><a href="#-509"><span class="linenos"> 509</span></a>                <span class="p">:</span>
</span><span id="Faults-510"><a href="#-510"><span class="linenos"> 510</span></a>            <span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_geologic_age_3d_from_infilled_horizons</span><span class="p">(</span>
</span><span id="Faults-511"><a href="#-511"><span class="linenos"> 511</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">faulted_depth_maps</span><span class="p">[:]</span> <span class="o">*</span> <span class="mf">10.0</span>
</span><span id="Faults-512"><a href="#-512"><span class="linenos"> 512</span></a>            <span class="p">)</span>
</span><span id="Faults-513"><a href="#-513"><span class="linenos"> 513</span></a>            <span class="c1"># Set lith code for salt</span>
</span><span id="Faults-514"><a href="#-514"><span class="linenos"> 514</span></a>            <span class="n">work_cube_lith</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">salt_model</span><span class="o">.</span><span class="n">salt_segments</span><span class="p">[:]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">2.0</span>
</span><span id="Faults-515"><a href="#-515"><span class="linenos"> 515</span></a>            <span class="c1"># Fix deepest part of facies in case salt inclusion has shifted base horizon</span>
</span><span id="Faults-516"><a href="#-516"><span class="linenos"> 516</span></a>            <span class="c1"># This can leave default (water) facies codes at the base</span>
</span><span id="Faults-517"><a href="#-517"><span class="linenos"> 517</span></a>            <span class="n">last_50_samples</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">50</span>
</span><span id="Faults-518"><a href="#-518"><span class="linenos"> 518</span></a>            <span class="n">work_cube_lith</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">last_50_samples</span><span class="p">:][</span>
</span><span id="Faults-519"><a href="#-519"><span class="linenos"> 519</span></a>                <span class="n">work_cube_lith</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">last_50_samples</span><span class="p">:]</span> <span class="o">==</span> <span class="o">-</span><span class="mf">1.0</span>
</span><span id="Faults-520"><a href="#-520"><span class="linenos"> 520</span></a>            <span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="Faults-521"><a href="#-521"><span class="linenos"> 521</span></a>
</span><span id="Faults-522"><a href="#-522"><span class="linenos"> 522</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">qc_plots</span><span class="p">:</span>
</span><span id="Faults-523"><a href="#-523"><span class="linenos"> 523</span></a>            <span class="kn">from</span> <span class="nn">datagenerator.util</span> <span class="kn">import</span> <span class="n">plot_xsection</span>
</span><span id="Faults-524"><a href="#-524"><span class="linenos"> 524</span></a>            <span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>
</span><span id="Faults-525"><a href="#-525"><span class="linenos"> 525</span></a>
</span><span id="Faults-526"><a href="#-526"><span class="linenos"> 526</span></a>            <span class="n">line_number</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span>
</span><span id="Faults-527"><a href="#-527"><span class="linenos"> 527</span></a>                <span class="n">work_cube_lith</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span>
</span><span id="Faults-528"><a href="#-528"><span class="linenos"> 528</span></a>            <span class="p">)</span>  <span class="c1"># pick centre line for all plots</span>
</span><span id="Faults-529"><a href="#-529"><span class="linenos"> 529</span></a>
</span><span id="Faults-530"><a href="#-530"><span class="linenos"> 530</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">include_salt</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">work_cube_lith</span><span class="p">[</span><span class="n">line_number</span><span class="p">,</span> <span class="o">...</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Faults-531"><a href="#-531"><span class="linenos"> 531</span></a>                <span class="n">lith_cmap</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">ListedColormap</span><span class="p">(</span>
</span><span id="Faults-532"><a href="#-532"><span class="linenos"> 532</span></a>                    <span class="p">[</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="s2">&quot;saddlebrown&quot;</span><span class="p">,</span> <span class="s2">&quot;gold&quot;</span><span class="p">,</span> <span class="s2">&quot;grey&quot;</span><span class="p">]</span>
</span><span id="Faults-533"><a href="#-533"><span class="linenos"> 533</span></a>                <span class="p">)</span>
</span><span id="Faults-534"><a href="#-534"><span class="linenos"> 534</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Faults-535"><a href="#-535"><span class="linenos"> 535</span></a>                <span class="n">lith_cmap</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">ListedColormap</span><span class="p">([</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="s2">&quot;saddlebrown&quot;</span><span class="p">,</span> <span class="s2">&quot;gold&quot;</span><span class="p">])</span>
</span><span id="Faults-536"><a href="#-536"><span class="linenos"> 536</span></a>            <span class="n">plot_xsection</span><span class="p">(</span>
</span><span id="Faults-537"><a href="#-537"><span class="linenos"> 537</span></a>                <span class="n">work_cube_lith</span><span class="p">,</span>
</span><span id="Faults-538"><a href="#-538"><span class="linenos"> 538</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">faulted_depth_maps</span><span class="p">[:],</span>
</span><span id="Faults-539"><a href="#-539"><span class="linenos"> 539</span></a>                <span class="n">line_num</span><span class="o">=</span><span class="n">line_number</span><span class="p">,</span>
</span><span id="Faults-540"><a href="#-540"><span class="linenos"> 540</span></a>                <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Example Trav through 3D model</span><span class="se">\n</span><span class="s2">Lithology&quot;</span><span class="p">,</span>
</span><span id="Faults-541"><a href="#-541"><span class="linenos"> 541</span></a>                <span class="n">png_name</span><span class="o">=</span><span class="s2">&quot;QC_plot__AfterFaulting_lithology.png&quot;</span><span class="p">,</span>
</span><span id="Faults-542"><a href="#-542"><span class="linenos"> 542</span></a>                <span class="n">cfg</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="p">,</span>
</span><span id="Faults-543"><a href="#-543"><span class="linenos"> 543</span></a>                <span class="n">cmap</span><span class="o">=</span><span class="n">lith_cmap</span><span class="p">,</span>
</span><span id="Faults-544"><a href="#-544"><span class="linenos"> 544</span></a>            <span class="p">)</span>
</span><span id="Faults-545"><a href="#-545"><span class="linenos"> 545</span></a>            <span class="n">plot_xsection</span><span class="p">(</span>
</span><span id="Faults-546"><a href="#-546"><span class="linenos"> 546</span></a>                <span class="n">work_cube_depth</span><span class="p">,</span>
</span><span id="Faults-547"><a href="#-547"><span class="linenos"> 547</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">faulted_depth_maps</span><span class="p">,</span>
</span><span id="Faults-548"><a href="#-548"><span class="linenos"> 548</span></a>                <span class="n">line_num</span><span class="o">=</span><span class="n">line_number</span><span class="p">,</span>
</span><span id="Faults-549"><a href="#-549"><span class="linenos"> 549</span></a>                <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Example Trav through 3D model</span><span class="se">\n</span><span class="s2">Depth Below Mudline&quot;</span><span class="p">,</span>
</span><span id="Faults-550"><a href="#-550"><span class="linenos"> 550</span></a>                <span class="n">png_name</span><span class="o">=</span><span class="s2">&quot;QC_plot__AfterFaulting_depth_bml.png&quot;</span><span class="p">,</span>
</span><span id="Faults-551"><a href="#-551"><span class="linenos"> 551</span></a>                <span class="n">cfg</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="p">,</span>
</span><span id="Faults-552"><a href="#-552"><span class="linenos"> 552</span></a>                <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;cubehelix_r&quot;</span><span class="p">,</span>
</span><span id="Faults-553"><a href="#-553"><span class="linenos"> 553</span></a>            <span class="p">)</span>
</span><span id="Faults-554"><a href="#-554"><span class="linenos"> 554</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">faulted_lithology</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">work_cube_lith</span>
</span><span id="Faults-555"><a href="#-555"><span class="linenos"> 555</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">faulted_net_to_gross</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">work_cube_net_to_gross</span>
</span><span id="Faults-556"><a href="#-556"><span class="linenos"> 556</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">faulted_depth</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">work_cube_depth</span>
</span><span id="Faults-557"><a href="#-557"><span class="linenos"> 557</span></a>        <span class="c1"># self.randomised_depth[:] = randomised_depth</span>
</span><span id="Faults-558"><a href="#-558"><span class="linenos"> 558</span></a>
</span><span id="Faults-559"><a href="#-559"><span class="linenos"> 559</span></a>        <span class="c1"># Write the % sand in model to logfile</span>
</span><span id="Faults-560"><a href="#-560"><span class="linenos"> 560</span></a>        <span class="n">sand_fraction</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="Faults-561"><a href="#-561"><span class="linenos"> 561</span></a>            <span class="n">work_cube_lith</span><span class="p">[</span><span class="n">work_cube_lith</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="Faults-562"><a href="#-562"><span class="linenos"> 562</span></a>            <span class="o">/</span> <span class="n">work_cube_lith</span><span class="p">[</span><span class="n">work_cube_lith</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="Faults-563"><a href="#-563"><span class="linenos"> 563</span></a>        <span class="p">)</span>
</span><span id="Faults-564"><a href="#-564"><span class="linenos"> 564</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="Faults-565"><a href="#-565"><span class="linenos"> 565</span></a>            <span class="sa">f</span><span class="s2">&quot;Sand voxel % in model </span><span class="si">{</span><span class="mi">100</span> <span class="o">*</span> <span class="n">sand_fraction</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">,</span>
</span><span id="Faults-566"><a href="#-566"><span class="linenos"> 566</span></a>            <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span>
</span><span id="Faults-567"><a href="#-567"><span class="linenos"> 567</span></a>            <span class="n">subkey</span><span class="o">=</span><span class="s2">&quot;sand_voxel_pct&quot;</span><span class="p">,</span>
</span><span id="Faults-568"><a href="#-568"><span class="linenos"> 568</span></a>            <span class="n">val</span><span class="o">=</span><span class="mi">100</span> <span class="o">*</span> <span class="n">sand_fraction</span><span class="p">,</span>
</span><span id="Faults-569"><a href="#-569"><span class="linenos"> 569</span></a>        <span class="p">)</span>
</span><span id="Faults-570"><a href="#-570"><span class="linenos"> 570</span></a>
</span><span id="Faults-571"><a href="#-571"><span class="linenos"> 571</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_store</span><span class="p">:</span>
</span><span id="Faults-572"><a href="#-572"><span class="linenos"> 572</span></a>            <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
</span><span id="Faults-573"><a href="#-573"><span class="linenos"> 573</span></a>                <span class="p">[</span><span class="s2">&quot;lithology&quot;</span><span class="p">,</span> <span class="s2">&quot;net_to_gross&quot;</span><span class="p">,</span> <span class="s2">&quot;depth&quot;</span><span class="p">],</span>
</span><span id="Faults-574"><a href="#-574"><span class="linenos"> 574</span></a>                <span class="p">[</span>
</span><span id="Faults-575"><a href="#-575"><span class="linenos"> 575</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">faulted_lithology</span><span class="p">[:],</span>
</span><span id="Faults-576"><a href="#-576"><span class="linenos"> 576</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">faulted_net_to_gross</span><span class="p">[:],</span>
</span><span id="Faults-577"><a href="#-577"><span class="linenos"> 577</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">faulted_depth</span><span class="p">[:],</span>
</span><span id="Faults-578"><a href="#-578"><span class="linenos"> 578</span></a>                <span class="p">],</span>
</span><span id="Faults-579"><a href="#-579"><span class="linenos"> 579</span></a>            <span class="p">):</span>
</span><span id="Faults-580"><a href="#-580"><span class="linenos"> 580</span></a>                <span class="n">write_data_to_hdf</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_master</span><span class="p">)</span>
</span><span id="Faults-581"><a href="#-581"><span class="linenos"> 581</span></a>
</span><span id="Faults-582"><a href="#-582"><span class="linenos"> 582</span></a>        <span class="c1"># Save out reservoir volume for XAI-NBDT</span>
</span><span id="Faults-583"><a href="#-583"><span class="linenos"> 583</span></a>        <span class="n">reservoir</span> <span class="o">=</span> <span class="p">(</span><span class="n">work_cube_lith</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1.0</span>
</span><span id="Faults-584"><a href="#-584"><span class="linenos"> 584</span></a>        <span class="n">reservoir_dilated</span> <span class="o">=</span> <span class="n">binary_dilation</span><span class="p">(</span><span class="n">reservoir</span><span class="p">)</span>
</span><span id="Faults-585"><a href="#-585"><span class="linenos"> 585</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">reservoir</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">reservoir_dilated</span>
</span><span id="Faults-586"><a href="#-586"><span class="linenos"> 586</span></a>
</span><span id="Faults-587"><a href="#-587"><span class="linenos"> 587</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">model_qc_volumes</span><span class="p">:</span>
</span><span id="Faults-588"><a href="#-588"><span class="linenos"> 588</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">write_cube_to_disk</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faulted_lithology</span><span class="p">[:],</span> <span class="s2">&quot;faulted_lithology&quot;</span><span class="p">)</span>
</span><span id="Faults-589"><a href="#-589"><span class="linenos"> 589</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">write_cube_to_disk</span><span class="p">(</span>
</span><span id="Faults-590"><a href="#-590"><span class="linenos"> 590</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">faulted_net_to_gross</span><span class="p">[:],</span> <span class="s2">&quot;faulted_net_to_gross&quot;</span>
</span><span id="Faults-591"><a href="#-591"><span class="linenos"> 591</span></a>            <span class="p">)</span>
</span><span id="Faults-592"><a href="#-592"><span class="linenos"> 592</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">write_cube_to_disk</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faulted_depth</span><span class="p">[:],</span> <span class="s2">&quot;faulted_depth&quot;</span><span class="p">)</span>
</span><span id="Faults-593"><a href="#-593"><span class="linenos"> 593</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">write_cube_to_disk</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faulted_age_volume</span><span class="p">[:],</span> <span class="s2">&quot;faulted_age&quot;</span><span class="p">)</span>
</span><span id="Faults-594"><a href="#-594"><span class="linenos"> 594</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">include_salt</span><span class="p">:</span>
</span><span id="Faults-595"><a href="#-595"><span class="linenos"> 595</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">write_cube_to_disk</span><span class="p">(</span>
</span><span id="Faults-596"><a href="#-596"><span class="linenos"> 596</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">salt_model</span><span class="o">.</span><span class="n">salt_segments</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span>
</span><span id="Faults-597"><a href="#-597"><span class="linenos"> 597</span></a>                        <span class="s2">&quot;uint8&quot;</span>
</span><span id="Faults-598"><a href="#-598"><span class="linenos"> 598</span></a>                    <span class="p">),</span>
</span><span id="Faults-599"><a href="#-599"><span class="linenos"> 599</span></a>                    <span class="s2">&quot;salt&quot;</span><span class="p">,</span>
</span><span id="Faults-600"><a href="#-600"><span class="linenos"> 600</span></a>                <span class="p">)</span>
</span><span id="Faults-601"><a href="#-601"><span class="linenos"> 601</span></a>
</span><span id="Faults-602"><a href="#-602"><span class="linenos"> 602</span></a>    <span class="k">def</span> <span class="nf">create_qc_plots</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Faults-603"><a href="#-603"><span class="linenos"> 603</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="Faults-604"><a href="#-604"><span class="linenos"> 604</span></a><span class="sd">        Create QC Plots</span>
</span><span id="Faults-605"><a href="#-605"><span class="linenos"> 605</span></a><span class="sd">        ---------------</span>
</span><span id="Faults-606"><a href="#-606"><span class="linenos"> 606</span></a><span class="sd">        Creates QC Plots of faulted models and histograms of</span>
</span><span id="Faults-607"><a href="#-607"><span class="linenos"> 607</span></a><span class="sd">        voxels which are not in layers.</span>
</span><span id="Faults-608"><a href="#-608"><span class="linenos"> 608</span></a>
</span><span id="Faults-609"><a href="#-609"><span class="linenos"> 609</span></a><span class="sd">        Parameters</span>
</span><span id="Faults-610"><a href="#-610"><span class="linenos"> 610</span></a><span class="sd">        ----------</span>
</span><span id="Faults-611"><a href="#-611"><span class="linenos"> 611</span></a><span class="sd">        None</span>
</span><span id="Faults-612"><a href="#-612"><span class="linenos"> 612</span></a>
</span><span id="Faults-613"><a href="#-613"><span class="linenos"> 613</span></a><span class="sd">        Returns</span>
</span><span id="Faults-614"><a href="#-614"><span class="linenos"> 614</span></a><span class="sd">        -------</span>
</span><span id="Faults-615"><a href="#-615"><span class="linenos"> 615</span></a><span class="sd">        None</span>
</span><span id="Faults-616"><a href="#-616"><span class="linenos"> 616</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Faults-617"><a href="#-617"><span class="linenos"> 617</span></a>        <span class="kn">from</span> <span class="nn">datagenerator.util</span> <span class="kn">import</span> <span class="p">(</span>
</span><span id="Faults-618"><a href="#-618"><span class="linenos"> 618</span></a>            <span class="n">find_line_with_most_voxels</span><span class="p">,</span>
</span><span id="Faults-619"><a href="#-619"><span class="linenos"> 619</span></a>            <span class="n">plot_voxels_not_in_regular_layers</span><span class="p">,</span>
</span><span id="Faults-620"><a href="#-620"><span class="linenos"> 620</span></a>            <span class="n">plot_xsection</span><span class="p">,</span>
</span><span id="Faults-621"><a href="#-621"><span class="linenos"> 621</span></a>        <span class="p">)</span>
</span><span id="Faults-622"><a href="#-622"><span class="linenos"> 622</span></a>
</span><span id="Faults-623"><a href="#-623"><span class="linenos"> 623</span></a>        <span class="c1"># analyze voxel values not in regular layers</span>
</span><span id="Faults-624"><a href="#-624"><span class="linenos"> 624</span></a>        <span class="n">plot_voxels_not_in_regular_layers</span><span class="p">(</span>
</span><span id="Faults-625"><a href="#-625"><span class="linenos"> 625</span></a>            <span class="n">volume</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">faulted_age_volume</span><span class="p">[:],</span>
</span><span id="Faults-626"><a href="#-626"><span class="linenos"> 626</span></a>            <span class="n">threshold</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
</span><span id="Faults-627"><a href="#-627"><span class="linenos"> 627</span></a>            <span class="n">cfg</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="p">,</span>
</span><span id="Faults-628"><a href="#-628"><span class="linenos"> 628</span></a>            <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Example Trav through 3D model</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="Faults-629"><a href="#-629"><span class="linenos"> 629</span></a>            <span class="o">+</span> <span class="s2">&quot;histogram of layers after faulting, before inserting channel facies&quot;</span><span class="p">,</span>
</span><span id="Faults-630"><a href="#-630"><span class="linenos"> 630</span></a>            <span class="n">png_name</span><span class="o">=</span><span class="s2">&quot;QC_plot__Channels__histogram_FaultedLayersNoChannels.png&quot;</span><span class="p">,</span>
</span><span id="Faults-631"><a href="#-631"><span class="linenos"> 631</span></a>        <span class="p">)</span>
</span><span id="Faults-632"><a href="#-632"><span class="linenos"> 632</span></a>        <span class="k">try</span><span class="p">:</span>  <span class="c1"># if channel_segments exists</span>
</span><span id="Faults-633"><a href="#-633"><span class="linenos"> 633</span></a>            <span class="n">inline_index_channels</span> <span class="o">=</span> <span class="n">find_line_with_most_voxels</span><span class="p">(</span>
</span><span id="Faults-634"><a href="#-634"><span class="linenos"> 634</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">channel_segments</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span>
</span><span id="Faults-635"><a href="#-635"><span class="linenos"> 635</span></a>            <span class="p">)</span>
</span><span id="Faults-636"><a href="#-636"><span class="linenos"> 636</span></a>            <span class="n">plot_xsection</span><span class="p">(</span>
</span><span id="Faults-637"><a href="#-637"><span class="linenos"> 637</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">channel_segments</span><span class="p">,</span>
</span><span id="Faults-638"><a href="#-638"><span class="linenos"> 638</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">faulted_depth_maps</span><span class="p">,</span>
</span><span id="Faults-639"><a href="#-639"><span class="linenos"> 639</span></a>                <span class="n">inline_index_channels</span><span class="p">,</span>
</span><span id="Faults-640"><a href="#-640"><span class="linenos"> 640</span></a>                <span class="n">cfg</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="p">,</span>
</span><span id="Faults-641"><a href="#-641"><span class="linenos"> 641</span></a>                <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Example Trav through 3D model</span><span class="se">\n</span><span class="s2">channel_segments after faulting&quot;</span><span class="p">,</span>
</span><span id="Faults-642"><a href="#-642"><span class="linenos"> 642</span></a>                <span class="n">png_name</span><span class="o">=</span><span class="s2">&quot;QC_plot__AfterFaulting_channel_segments.png&quot;</span><span class="p">,</span>
</span><span id="Faults-643"><a href="#-643"><span class="linenos"> 643</span></a>            <span class="p">)</span>
</span><span id="Faults-644"><a href="#-644"><span class="linenos"> 644</span></a>            <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Example Trav through 3D model</span><span class="se">\n</span><span class="s2">Layers Filled With Layer Number / ChannelsAdded / Faulted&quot;</span>
</span><span id="Faults-645"><a href="#-645"><span class="linenos"> 645</span></a>            <span class="n">png_name</span> <span class="o">=</span> <span class="s2">&quot;QC_plot__LayersFilledWithLayerNumber_ChannelsAdded_Faulted.png&quot;</span>
</span><span id="Faults-646"><a href="#-646"><span class="linenos"> 646</span></a>        <span class="k">except</span> <span class="p">(</span><span class="ne">NameError</span><span class="p">,</span> <span class="ne">AttributeError</span><span class="p">):</span>  <span class="c1"># channel_segments does not exist</span>
</span><span id="Faults-647"><a href="#-647"><span class="linenos"> 647</span></a>            <span class="n">inline_index_channels</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faulted_age_volume</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="Faults-648"><a href="#-648"><span class="linenos"> 648</span></a>            <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Example Trav through 3D model</span><span class="se">\n</span><span class="s2">Layers Filled With Layer Number / Faulted&quot;</span>
</span><span id="Faults-649"><a href="#-649"><span class="linenos"> 649</span></a>            <span class="n">png_name</span> <span class="o">=</span> <span class="s2">&quot;QC_plot__LayersFilledWithLayerNumber_Faulted.png&quot;</span>
</span><span id="Faults-650"><a href="#-650"><span class="linenos"> 650</span></a>        <span class="n">plot_xsection</span><span class="p">(</span>
</span><span id="Faults-651"><a href="#-651"><span class="linenos"> 651</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">faulted_age_volume</span><span class="p">[:],</span>
</span><span id="Faults-652"><a href="#-652"><span class="linenos"> 652</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">faulted_depth_maps</span><span class="p">[:],</span>
</span><span id="Faults-653"><a href="#-653"><span class="linenos"> 653</span></a>            <span class="n">inline_index_channels</span><span class="p">,</span>
</span><span id="Faults-654"><a href="#-654"><span class="linenos"> 654</span></a>            <span class="n">title</span><span class="p">,</span>
</span><span id="Faults-655"><a href="#-655"><span class="linenos"> 655</span></a>            <span class="n">png_name</span><span class="p">,</span>
</span><span id="Faults-656"><a href="#-656"><span class="linenos"> 656</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="p">,</span>
</span><span id="Faults-657"><a href="#-657"><span class="linenos"> 657</span></a>        <span class="p">)</span>
</span><span id="Faults-658"><a href="#-658"><span class="linenos"> 658</span></a>
</span><span id="Faults-659"><a href="#-659"><span class="linenos"> 659</span></a>    <span class="k">def</span> <span class="nf">generate_faults</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="Faults-660"><a href="#-660"><span class="linenos"> 660</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="Faults-661"><a href="#-661"><span class="linenos"> 661</span></a><span class="sd">        Generate Faults</span>
</span><span id="Faults-662"><a href="#-662"><span class="linenos"> 662</span></a><span class="sd">        ---------------</span>
</span><span id="Faults-663"><a href="#-663"><span class="linenos"> 663</span></a><span class="sd">        Generates faults in the model.</span>
</span><span id="Faults-664"><a href="#-664"><span class="linenos"> 664</span></a>
</span><span id="Faults-665"><a href="#-665"><span class="linenos"> 665</span></a><span class="sd">        Parameters</span>
</span><span id="Faults-666"><a href="#-666"><span class="linenos"> 666</span></a><span class="sd">        ----------</span>
</span><span id="Faults-667"><a href="#-667"><span class="linenos"> 667</span></a><span class="sd">        None</span>
</span><span id="Faults-668"><a href="#-668"><span class="linenos"> 668</span></a>
</span><span id="Faults-669"><a href="#-669"><span class="linenos"> 669</span></a><span class="sd">        Returns</span>
</span><span id="Faults-670"><a href="#-670"><span class="linenos"> 670</span></a><span class="sd">        -------</span>
</span><span id="Faults-671"><a href="#-671"><span class="linenos"> 671</span></a><span class="sd">        displacements_classification : np.ndarray</span>
</span><span id="Faults-672"><a href="#-672"><span class="linenos"> 672</span></a><span class="sd">            Array of fault displacement classifications</span>
</span><span id="Faults-673"><a href="#-673"><span class="linenos"> 673</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Faults-674"><a href="#-674"><span class="linenos"> 674</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Faults-675"><a href="#-675"><span class="linenos"> 675</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; ... create </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">number_faults</span><span class="si">}</span><span class="s2"> faults&quot;</span><span class="p">)</span>
</span><span id="Faults-676"><a href="#-676"><span class="linenos"> 676</span></a>        <span class="n">fault_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fault_parameters</span><span class="p">()</span>
</span><span id="Faults-677"><a href="#-677"><span class="linenos"> 677</span></a>
</span><span id="Faults-678"><a href="#-678"><span class="linenos"> 678</span></a>        <span class="c1"># Write fault parameters to logfile</span>
</span><span id="Faults-679"><a href="#-679"><span class="linenos"> 679</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="Faults-680"><a href="#-680"><span class="linenos"> 680</span></a>            <span class="sa">f</span><span class="s2">&quot;Fault_mode: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">fmode</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="Faults-681"><a href="#-681"><span class="linenos"> 681</span></a>            <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span>
</span><span id="Faults-682"><a href="#-682"><span class="linenos"> 682</span></a>            <span class="n">subkey</span><span class="o">=</span><span class="s2">&quot;fault_mode&quot;</span><span class="p">,</span>
</span><span id="Faults-683"><a href="#-683"><span class="linenos"> 683</span></a>            <span class="n">val</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">fmode</span><span class="p">,</span>
</span><span id="Faults-684"><a href="#-684"><span class="linenos"> 684</span></a>        <span class="p">)</span>
</span><span id="Faults-685"><a href="#-685"><span class="linenos"> 685</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="Faults-686"><a href="#-686"><span class="linenos"> 686</span></a>            <span class="sa">f</span><span class="s2">&quot;Noise_level: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">fnoise</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="Faults-687"><a href="#-687"><span class="linenos"> 687</span></a>            <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span>
</span><span id="Faults-688"><a href="#-688"><span class="linenos"> 688</span></a>            <span class="n">subkey</span><span class="o">=</span><span class="s2">&quot;noise_level&quot;</span><span class="p">,</span>
</span><span id="Faults-689"><a href="#-689"><span class="linenos"> 689</span></a>            <span class="n">val</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">fnoise</span><span class="p">,</span>
</span><span id="Faults-690"><a href="#-690"><span class="linenos"> 690</span></a>        <span class="p">)</span>
</span><span id="Faults-691"><a href="#-691"><span class="linenos"> 691</span></a>
</span><span id="Faults-692"><a href="#-692"><span class="linenos"> 692</span></a>        <span class="c1"># Build faults, and sum displacements</span>
</span><span id="Faults-693"><a href="#-693"><span class="linenos"> 693</span></a>        <span class="n">displacements_classification</span><span class="p">,</span> <span class="n">hockeys</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">build_faults</span><span class="p">(</span><span class="n">fault_params</span><span class="p">)</span>
</span><span id="Faults-694"><a href="#-694"><span class="linenos"> 694</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">model_qc_volumes</span><span class="p">:</span>
</span><span id="Faults-695"><a href="#-695"><span class="linenos"> 695</span></a>            <span class="c1"># Write max fault throw cube to disk</span>
</span><span id="Faults-696"><a href="#-696"><span class="linenos"> 696</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">write_cube_to_disk</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_fault_throw</span><span class="p">[:],</span> <span class="s2">&quot;max_fault_throw&quot;</span><span class="p">)</span>
</span><span id="Faults-697"><a href="#-697"><span class="linenos"> 697</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="Faults-698"><a href="#-698"><span class="linenos"> 698</span></a>            <span class="sa">f</span><span class="s2">&quot;Hockey_Sticks generated: </span><span class="si">{</span><span class="nb">sum</span><span class="p">(</span><span class="n">hockeys</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="Faults-699"><a href="#-699"><span class="linenos"> 699</span></a>            <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span>
</span><span id="Faults-700"><a href="#-700"><span class="linenos"> 700</span></a>            <span class="n">subkey</span><span class="o">=</span><span class="s2">&quot;hockey_sticks_generated&quot;</span><span class="p">,</span>
</span><span id="Faults-701"><a href="#-701"><span class="linenos"> 701</span></a>            <span class="n">val</span><span class="o">=</span><span class="nb">sum</span><span class="p">(</span><span class="n">hockeys</span><span class="p">),</span>
</span><span id="Faults-702"><a href="#-702"><span class="linenos"> 702</span></a>        <span class="p">)</span>
</span><span id="Faults-703"><a href="#-703"><span class="linenos"> 703</span></a>
</span><span id="Faults-704"><a href="#-704"><span class="linenos"> 704</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="Faults-705"><a href="#-705"><span class="linenos"> 705</span></a>            <span class="sa">f</span><span class="s2">&quot;Fault Info: a, b, c, x0, y0, z0, throw/infill_factor, shear_zone_width,&quot;</span>
</span><span id="Faults-706"><a href="#-706"><span class="linenos"> 706</span></a>            <span class="s2">&quot; gouge_pctile, tilt_pct*100&quot;</span>
</span><span id="Faults-707"><a href="#-707"><span class="linenos"> 707</span></a>        <span class="p">)</span>
</span><span id="Faults-708"><a href="#-708"><span class="linenos"> 708</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">number_faults</span><span class="p">):</span>
</span><span id="Faults-709"><a href="#-709"><span class="linenos"> 709</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="Faults-710"><a href="#-710"><span class="linenos"> 710</span></a>                <span class="sa">f</span><span class="s2">&quot;Fault_</span><span class="si">{</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">fault_params</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">fault_params</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">fault_params</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">,&quot;</span>
</span><span id="Faults-711"><a href="#-711"><span class="linenos"> 711</span></a>                <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">fault_params</span><span class="p">[</span><span class="s1">&#39;x0&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="si">:</span><span class="s2">&gt;7.2f</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">fault_params</span><span class="p">[</span><span class="s1">&#39;y0&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="si">:</span><span class="s2">&gt;7.2f</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">fault_params</span><span class="p">[</span><span class="s1">&#39;z0&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="si">:</span><span class="s2">&gt;8.2f</span><span class="si">}</span><span class="s2">,&quot;</span>
</span><span id="Faults-712"><a href="#-712"><span class="linenos"> 712</span></a>                <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">fault_params</span><span class="p">[</span><span class="s1">&#39;throw&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">infill_factor</span><span class="si">:</span><span class="s2">&gt;6.2f</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">fault_params</span><span class="p">[</span><span class="s1">&#39;tilt_pct&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="mi">100</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Faults-713"><a href="#-713"><span class="linenos"> 713</span></a>            <span class="p">)</span>
</span><span id="Faults-714"><a href="#-714"><span class="linenos"> 714</span></a>
</span><span id="Faults-715"><a href="#-715"><span class="linenos"> 715</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="Faults-716"><a href="#-716"><span class="linenos"> 716</span></a>                <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="Faults-717"><a href="#-717"><span class="linenos"> 717</span></a>                <span class="n">mainkey</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;fault_</span><span class="si">{</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="Faults-718"><a href="#-718"><span class="linenos"> 718</span></a>                <span class="n">subkey</span><span class="o">=</span><span class="s2">&quot;model_id&quot;</span><span class="p">,</span>
</span><span id="Faults-719"><a href="#-719"><span class="linenos"> 719</span></a>                <span class="n">val</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">work_subfolder</span><span class="p">),</span>
</span><span id="Faults-720"><a href="#-720"><span class="linenos"> 720</span></a>            <span class="p">)</span>
</span><span id="Faults-721"><a href="#-721"><span class="linenos"> 721</span></a>            <span class="k">for</span> <span class="n">_subkey_name</span> <span class="ow">in</span> <span class="p">[</span>
</span><span id="Faults-722"><a href="#-722"><span class="linenos"> 722</span></a>                <span class="s2">&quot;a&quot;</span><span class="p">,</span>
</span><span id="Faults-723"><a href="#-723"><span class="linenos"> 723</span></a>                <span class="s2">&quot;b&quot;</span><span class="p">,</span>
</span><span id="Faults-724"><a href="#-724"><span class="linenos"> 724</span></a>                <span class="s2">&quot;c&quot;</span><span class="p">,</span>
</span><span id="Faults-725"><a href="#-725"><span class="linenos"> 725</span></a>                <span class="s2">&quot;x0&quot;</span><span class="p">,</span>
</span><span id="Faults-726"><a href="#-726"><span class="linenos"> 726</span></a>                <span class="s2">&quot;y0&quot;</span><span class="p">,</span>
</span><span id="Faults-727"><a href="#-727"><span class="linenos"> 727</span></a>                <span class="s2">&quot;z0&quot;</span><span class="p">,</span>
</span><span id="Faults-728"><a href="#-728"><span class="linenos"> 728</span></a>                <span class="s2">&quot;throw&quot;</span><span class="p">,</span>
</span><span id="Faults-729"><a href="#-729"><span class="linenos"> 729</span></a>                <span class="s2">&quot;tilt_pct&quot;</span><span class="p">,</span>
</span><span id="Faults-730"><a href="#-730"><span class="linenos"> 730</span></a>                <span class="s2">&quot;shear_zone_width&quot;</span><span class="p">,</span>
</span><span id="Faults-731"><a href="#-731"><span class="linenos"> 731</span></a>                <span class="s2">&quot;gouge_pctile&quot;</span><span class="p">,</span>
</span><span id="Faults-732"><a href="#-732"><span class="linenos"> 732</span></a>            <span class="p">]:</span>
</span><span id="Faults-733"><a href="#-733"><span class="linenos"> 733</span></a>                <span class="n">_val</span> <span class="o">=</span> <span class="n">fault_params</span><span class="p">[</span><span class="n">_subkey_name</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
</span><span id="Faults-734"><a href="#-734"><span class="linenos"> 734</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="Faults-735"><a href="#-735"><span class="linenos"> 735</span></a>                    <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mainkey</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;fault_</span><span class="si">{</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">subkey</span><span class="o">=</span><span class="n">_subkey_name</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">_val</span>
</span><span id="Faults-736"><a href="#-736"><span class="linenos"> 736</span></a>                <span class="p">)</span>
</span><span id="Faults-737"><a href="#-737"><span class="linenos"> 737</span></a>
</span><span id="Faults-738"><a href="#-738"><span class="linenos"> 738</span></a>        <span class="k">return</span> <span class="n">displacements_classification</span>
</span><span id="Faults-739"><a href="#-739"><span class="linenos"> 739</span></a>
</span><span id="Faults-740"><a href="#-740"><span class="linenos"> 740</span></a>    <span class="k">def</span> <span class="nf">fault_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Faults-741"><a href="#-741"><span class="linenos"> 741</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="Faults-742"><a href="#-742"><span class="linenos"> 742</span></a><span class="sd">        Get Fault Parameters</span>
</span><span id="Faults-743"><a href="#-743"><span class="linenos"> 743</span></a><span class="sd">        ---------------</span>
</span><span id="Faults-744"><a href="#-744"><span class="linenos"> 744</span></a><span class="sd">        Returns the fault parameters.</span>
</span><span id="Faults-745"><a href="#-745"><span class="linenos"> 745</span></a>
</span><span id="Faults-746"><a href="#-746"><span class="linenos"> 746</span></a><span class="sd">        Factory design pattern used to select fault parameters</span>
</span><span id="Faults-747"><a href="#-747"><span class="linenos"> 747</span></a>
</span><span id="Faults-748"><a href="#-748"><span class="linenos"> 748</span></a><span class="sd">        Parameters</span>
</span><span id="Faults-749"><a href="#-749"><span class="linenos"> 749</span></a><span class="sd">        ----------</span>
</span><span id="Faults-750"><a href="#-750"><span class="linenos"> 750</span></a><span class="sd">        None</span>
</span><span id="Faults-751"><a href="#-751"><span class="linenos"> 751</span></a>
</span><span id="Faults-752"><a href="#-752"><span class="linenos"> 752</span></a><span class="sd">        Returns</span>
</span><span id="Faults-753"><a href="#-753"><span class="linenos"> 753</span></a><span class="sd">        -------</span>
</span><span id="Faults-754"><a href="#-754"><span class="linenos"> 754</span></a><span class="sd">        fault_mode : dict</span>
</span><span id="Faults-755"><a href="#-755"><span class="linenos"> 755</span></a><span class="sd">            Dictionary containing the fault parameters.</span>
</span><span id="Faults-756"><a href="#-756"><span class="linenos"> 756</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Faults-757"><a href="#-757"><span class="linenos"> 757</span></a>        <span class="n">fault_mode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_fault_mode</span><span class="p">()</span>
</span><span id="Faults-758"><a href="#-758"><span class="linenos"> 758</span></a>        <span class="k">return</span> <span class="n">fault_mode</span><span class="p">()</span>
</span><span id="Faults-759"><a href="#-759"><span class="linenos"> 759</span></a>
</span><span id="Faults-760"><a href="#-760"><span class="linenos"> 760</span></a>    <span class="k">def</span> <span class="nf">build_faults</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fp</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="Faults-761"><a href="#-761"><span class="linenos"> 761</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="Faults-762"><a href="#-762"><span class="linenos"> 762</span></a><span class="sd">        Build Faults</span>
</span><span id="Faults-763"><a href="#-763"><span class="linenos"> 763</span></a><span class="sd">        ---------------</span>
</span><span id="Faults-764"><a href="#-764"><span class="linenos"> 764</span></a><span class="sd">        Creates faults in the model.</span>
</span><span id="Faults-765"><a href="#-765"><span class="linenos"> 765</span></a>
</span><span id="Faults-766"><a href="#-766"><span class="linenos"> 766</span></a><span class="sd">        Parameters</span>
</span><span id="Faults-767"><a href="#-767"><span class="linenos"> 767</span></a><span class="sd">        ----------</span>
</span><span id="Faults-768"><a href="#-768"><span class="linenos"> 768</span></a><span class="sd">        fp : dict</span>
</span><span id="Faults-769"><a href="#-769"><span class="linenos"> 769</span></a><span class="sd">            Dictionary containing the fault parameters.</span>
</span><span id="Faults-770"><a href="#-770"><span class="linenos"> 770</span></a><span class="sd">        verbose : bool</span>
</span><span id="Faults-771"><a href="#-771"><span class="linenos"> 771</span></a><span class="sd">            The level of verbosity to use.</span>
</span><span id="Faults-772"><a href="#-772"><span class="linenos"> 772</span></a>
</span><span id="Faults-773"><a href="#-773"><span class="linenos"> 773</span></a><span class="sd">        Returns</span>
</span><span id="Faults-774"><a href="#-774"><span class="linenos"> 774</span></a><span class="sd">        -------</span>
</span><span id="Faults-775"><a href="#-775"><span class="linenos"> 775</span></a><span class="sd">        dis_class : np.ndarray</span>
</span><span id="Faults-776"><a href="#-776"><span class="linenos"> 776</span></a><span class="sd">            Array of fault displacement classifications</span>
</span><span id="Faults-777"><a href="#-777"><span class="linenos"> 777</span></a><span class="sd">        hockey_sticks : list</span>
</span><span id="Faults-778"><a href="#-778"><span class="linenos"> 778</span></a><span class="sd">            List of hockey sticks</span>
</span><span id="Faults-779"><a href="#-779"><span class="linenos"> 779</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Faults-780"><a href="#-780"><span class="linenos"> 780</span></a>        <span class="k">def</span> <span class="nf">apply_faulting</span><span class="p">(</span><span class="n">traces</span><span class="p">,</span> <span class="n">stretch_times</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="Faults-781"><a href="#-781"><span class="linenos"> 781</span></a>            <span class="sd">&quot;&quot;&quot;</span>
</span><span id="Faults-782"><a href="#-782"><span class="linenos"> 782</span></a><span class="sd">            Apply Faulting</span>
</span><span id="Faults-783"><a href="#-783"><span class="linenos"> 783</span></a><span class="sd">            --------------</span>
</span><span id="Faults-784"><a href="#-784"><span class="linenos"> 784</span></a><span class="sd">            Applies faulting to the traces.</span>
</span><span id="Faults-785"><a href="#-785"><span class="linenos"> 785</span></a>
</span><span id="Faults-786"><a href="#-786"><span class="linenos"> 786</span></a><span class="sd">            The method does the following:</span>
</span><span id="Faults-787"><a href="#-787"><span class="linenos"> 787</span></a>
</span><span id="Faults-788"><a href="#-788"><span class="linenos"> 788</span></a><span class="sd">            Apply stretching and squeezing previously applied to the input cube</span>
</span><span id="Faults-789"><a href="#-789"><span class="linenos"> 789</span></a><span class="sd">            vertically to give all depths the same number of extrema.</span>
</span><span id="Faults-790"><a href="#-790"><span class="linenos"> 790</span></a><span class="sd">            This is intended to be a proxy for making the</span>
</span><span id="Faults-791"><a href="#-791"><span class="linenos"> 791</span></a><span class="sd">            dominant frequency the same everywhere.</span>
</span><span id="Faults-792"><a href="#-792"><span class="linenos"> 792</span></a><span class="sd">            Variables:</span>
</span><span id="Faults-793"><a href="#-793"><span class="linenos"> 793</span></a><span class="sd">            - traces - input, previously stretched/squeezed trace(s)</span>
</span><span id="Faults-794"><a href="#-794"><span class="linenos"> 794</span></a><span class="sd">            - stretch_times - input, LUT for stretching/squeezing trace(s),</span>
</span><span id="Faults-795"><a href="#-795"><span class="linenos"> 795</span></a><span class="sd">                              range is (0,number samples in last dimension of &#39;traces&#39;)</span>
</span><span id="Faults-796"><a href="#-796"><span class="linenos"> 796</span></a><span class="sd">            - unstretch_traces - output, un-stretched/un-squeezed trace(s)</span>
</span><span id="Faults-797"><a href="#-797"><span class="linenos"> 797</span></a>
</span><span id="Faults-798"><a href="#-798"><span class="linenos"> 798</span></a><span class="sd">            Parameters</span>
</span><span id="Faults-799"><a href="#-799"><span class="linenos"> 799</span></a><span class="sd">            ----------</span>
</span><span id="Faults-800"><a href="#-800"><span class="linenos"> 800</span></a><span class="sd">            traces : np.ndarray</span>
</span><span id="Faults-801"><a href="#-801"><span class="linenos"> 801</span></a><span class="sd">                Previously stretched/squeezed trace(s).</span>
</span><span id="Faults-802"><a href="#-802"><span class="linenos"> 802</span></a><span class="sd">            stretch_times : np.ndarray</span>
</span><span id="Faults-803"><a href="#-803"><span class="linenos"> 803</span></a><span class="sd">                A look up table for stretching and squeezing the traces.</span>
</span><span id="Faults-804"><a href="#-804"><span class="linenos"> 804</span></a><span class="sd">            verbose : bool, optional</span>
</span><span id="Faults-805"><a href="#-805"><span class="linenos"> 805</span></a><span class="sd">                The level of verbosity, by default False</span>
</span><span id="Faults-806"><a href="#-806"><span class="linenos"> 806</span></a>
</span><span id="Faults-807"><a href="#-807"><span class="linenos"> 807</span></a><span class="sd">            Returns</span>
</span><span id="Faults-808"><a href="#-808"><span class="linenos"> 808</span></a><span class="sd">            -------</span>
</span><span id="Faults-809"><a href="#-809"><span class="linenos"> 809</span></a><span class="sd">            np.ndarray</span>
</span><span id="Faults-810"><a href="#-810"><span class="linenos"> 810</span></a><span class="sd">                The un-stretched/un-squeezed trace(s).</span>
</span><span id="Faults-811"><a href="#-811"><span class="linenos"> 811</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="Faults-812"><a href="#-812"><span class="linenos"> 812</span></a>            <span class="n">unstretch_traces</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">traces</span><span class="p">)</span>
</span><span id="Faults-813"><a href="#-813"><span class="linenos"> 813</span></a>            <span class="n">origtime</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">traces</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</span><span id="Faults-814"><a href="#-814"><span class="linenos"> 814</span></a>
</span><span id="Faults-815"><a href="#-815"><span class="linenos"> 815</span></a>            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="Faults-816"><a href="#-816"><span class="linenos"> 816</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">   ... Cube parameters going into interpolation&quot;</span><span class="p">)</span>
</span><span id="Faults-817"><a href="#-817"><span class="linenos"> 817</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">   ... Origtime shape  = </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">origtime</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Faults-818"><a href="#-818"><span class="linenos"> 818</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">   ... stretch_times_effects shape  = </span><span class="si">{</span><span class="n">stretch_times</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Faults-819"><a href="#-819"><span class="linenos"> 819</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">   ... unstretch_times shape  = </span><span class="si">{</span><span class="n">unstretch_traces</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Faults-820"><a href="#-820"><span class="linenos"> 820</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">   ... traces shape  = </span><span class="si">{</span><span class="n">traces</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Faults-821"><a href="#-821"><span class="linenos"> 821</span></a>
</span><span id="Faults-822"><a href="#-822"><span class="linenos"> 822</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">traces</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="Faults-823"><a href="#-823"><span class="linenos"> 823</span></a>                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">traces</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
</span><span id="Faults-824"><a href="#-824"><span class="linenos"> 824</span></a>                    <span class="k">if</span> <span class="n">traces</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">!=</span> <span class="n">traces</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">max</span><span class="p">():</span>
</span><span id="Faults-825"><a href="#-825"><span class="linenos"> 825</span></a>                        <span class="n">unstretch_traces</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span>
</span><span id="Faults-826"><a href="#-826"><span class="linenos"> 826</span></a>                            <span class="n">stretch_times</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="p">:],</span> <span class="n">origtime</span><span class="p">,</span> <span class="n">traces</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="p">:]</span>
</span><span id="Faults-827"><a href="#-827"><span class="linenos"> 827</span></a>                        <span class="p">)</span>
</span><span id="Faults-828"><a href="#-828"><span class="linenos"> 828</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="Faults-829"><a href="#-829"><span class="linenos"> 829</span></a>                        <span class="n">unstretch_traces</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">traces</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="p">:]</span>
</span><span id="Faults-830"><a href="#-830"><span class="linenos"> 830</span></a>            <span class="k">return</span> <span class="n">unstretch_traces</span>
</span><span id="Faults-831"><a href="#-831"><span class="linenos"> 831</span></a>
</span><span id="Faults-832"><a href="#-832"><span class="linenos"> 832</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2"> . starting &#39;build_faults&#39;.&quot;</span><span class="p">)</span>
</span><span id="Faults-833"><a href="#-833"><span class="linenos"> 833</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   ... self.cfg.verbose = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">))</span>
</span><span id="Faults-834"><a href="#-834"><span class="linenos"> 834</span></a>        <span class="n">cube_shape</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">)</span>
</span><span id="Faults-835"><a href="#-835"><span class="linenos"> 835</span></a>        <span class="n">cube_shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">pad_samples</span>
</span><span id="Faults-836"><a href="#-836"><span class="linenos"> 836</span></a>        <span class="n">samples_in_cube</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">geologic_age</span><span class="p">[:]</span><span class="o">.</span><span class="n">size</span>
</span><span id="Faults-837"><a href="#-837"><span class="linenos"> 837</span></a>        <span class="n">wb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy_and_divide_depth_maps_by_infill</span><span class="p">(</span>
</span><span id="Faults-838"><a href="#-838"><span class="linenos"> 838</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">unfaulted_depth_maps</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
</span><span id="Faults-839"><a href="#-839"><span class="linenos"> 839</span></a>        <span class="p">)</span>
</span><span id="Faults-840"><a href="#-840"><span class="linenos"> 840</span></a>
</span><span id="Faults-841"><a href="#-841"><span class="linenos"> 841</span></a>        <span class="n">sum_displacements</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">geologic_age</span><span class="p">[:])</span>
</span><span id="Faults-842"><a href="#-842"><span class="linenos"> 842</span></a>        <span class="n">displacements_class</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">geologic_age</span><span class="p">[:])</span>
</span><span id="Faults-843"><a href="#-843"><span class="linenos"> 843</span></a>        <span class="n">hockey_sticks</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Faults-844"><a href="#-844"><span class="linenos"> 844</span></a>        <span class="n">fault_voxel_count_list</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Faults-845"><a href="#-845"><span class="linenos"> 845</span></a>        <span class="n">number_fault_intersections</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Faults-846"><a href="#-846"><span class="linenos"> 846</span></a>
</span><span id="Faults-847"><a href="#-847"><span class="linenos"> 847</span></a>        <span class="n">depth_maps_faulted_infilled</span> <span class="o">=</span> \
</span><span id="Faults-848"><a href="#-848"><span class="linenos"> 848</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">copy_and_divide_depth_maps_by_infill</span><span class="p">(</span>
</span><span id="Faults-849"><a href="#-849"><span class="linenos"> 849</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">unfaulted_depth_maps</span><span class="p">[:]</span>
</span><span id="Faults-850"><a href="#-850"><span class="linenos"> 850</span></a>            <span class="p">)</span>
</span><span id="Faults-851"><a href="#-851"><span class="linenos"> 851</span></a>        <span class="n">depth_maps_gaps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy_and_divide_depth_maps_by_infill</span><span class="p">(</span>
</span><span id="Faults-852"><a href="#-852"><span class="linenos"> 852</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">unfaulted_depth_maps</span><span class="p">[:]</span>
</span><span id="Faults-853"><a href="#-853"><span class="linenos"> 853</span></a>        <span class="p">)</span>
</span><span id="Faults-854"><a href="#-854"><span class="linenos"> 854</span></a>
</span><span id="Faults-855"><a href="#-855"><span class="linenos"> 855</span></a>        <span class="c1"># Create depth indices cube (moved from inside loop)</span>
</span><span id="Faults-856"><a href="#-856"><span class="linenos"> 856</span></a>        <span class="n">faulted_depths</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">geologic_age</span><span class="p">[:])</span>
</span><span id="Faults-857"><a href="#-857"><span class="linenos"> 857</span></a>        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">faulted_depths</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
</span><span id="Faults-858"><a href="#-858"><span class="linenos"> 858</span></a>            <span class="n">faulted_depths</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">k</span>
</span><span id="Faults-859"><a href="#-859"><span class="linenos"> 859</span></a>        <span class="n">unfaulted_depths</span> <span class="o">=</span> <span class="n">faulted_depths</span> <span class="o">*</span> <span class="mf">1.0</span>
</span><span id="Faults-860"><a href="#-860"><span class="linenos"> 860</span></a>        <span class="n">_faulted_depths</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="Faults-861"><a href="#-861"><span class="linenos"> 861</span></a>            <span class="n">unfaulted_depths</span> <span class="o">*</span> <span class="mf">1.0</span>
</span><span id="Faults-862"><a href="#-862"><span class="linenos"> 862</span></a>        <span class="p">)</span>  <span class="c1"># in case there are 0 faults, prepare _faulted_depths here</span>
</span><span id="Faults-863"><a href="#-863"><span class="linenos"> 863</span></a>
</span><span id="Faults-864"><a href="#-864"><span class="linenos"> 864</span></a>        <span class="k">for</span> <span class="n">ifault</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">number_faults</span><span class="p">)):</span>
</span><span id="Faults-865"><a href="#-865"><span class="linenos"> 865</span></a>            <span class="n">semi_axes</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="Faults-866"><a href="#-866"><span class="linenos"> 866</span></a>                <span class="n">fp</span><span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">][</span><span class="n">ifault</span><span class="p">],</span>
</span><span id="Faults-867"><a href="#-867"><span class="linenos"> 867</span></a>                <span class="n">fp</span><span class="p">[</span><span class="s2">&quot;b&quot;</span><span class="p">][</span><span class="n">ifault</span><span class="p">],</span>
</span><span id="Faults-868"><a href="#-868"><span class="linenos"> 868</span></a>                <span class="n">fp</span><span class="p">[</span><span class="s2">&quot;c&quot;</span><span class="p">][</span><span class="n">ifault</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">infill_factor</span> <span class="o">**</span> <span class="mi">2</span><span class="p">,</span>
</span><span id="Faults-869"><a href="#-869"><span class="linenos"> 869</span></a>            <span class="p">]</span>
</span><span id="Faults-870"><a href="#-870"><span class="linenos"> 870</span></a>            <span class="n">origin</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="Faults-871"><a href="#-871"><span class="linenos"> 871</span></a>                <span class="n">fp</span><span class="p">[</span><span class="s2">&quot;x0&quot;</span><span class="p">][</span><span class="n">ifault</span><span class="p">],</span>
</span><span id="Faults-872"><a href="#-872"><span class="linenos"> 872</span></a>                <span class="n">fp</span><span class="p">[</span><span class="s2">&quot;y0&quot;</span><span class="p">][</span><span class="n">ifault</span><span class="p">],</span>
</span><span id="Faults-873"><a href="#-873"><span class="linenos"> 873</span></a>                <span class="n">fp</span><span class="p">[</span><span class="s2">&quot;z0&quot;</span><span class="p">][</span><span class="n">ifault</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">infill_factor</span><span class="p">,</span>
</span><span id="Faults-874"><a href="#-874"><span class="linenos"> 874</span></a>            <span class="p">]</span>
</span><span id="Faults-875"><a href="#-875"><span class="linenos"> 875</span></a>            <span class="n">throw</span> <span class="o">=</span> <span class="n">fp</span><span class="p">[</span><span class="s2">&quot;throw&quot;</span><span class="p">][</span><span class="n">ifault</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">infill_factor</span>
</span><span id="Faults-876"><a href="#-876"><span class="linenos"> 876</span></a>            <span class="n">tilt</span> <span class="o">=</span> <span class="n">fp</span><span class="p">[</span><span class="s2">&quot;tilt_pct&quot;</span><span class="p">][</span><span class="n">ifault</span><span class="p">]</span>
</span><span id="Faults-877"><a href="#-877"><span class="linenos"> 877</span></a>
</span><span id="Faults-878"><a href="#-878"><span class="linenos"> 878</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2"> ... inserting fault </span><span class="si">{</span><span class="n">ifault</span><span class="si">}</span><span class="s2"> with throw </span><span class="si">{</span><span class="n">throw</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Faults-879"><a href="#-879"><span class="linenos"> 879</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="Faults-880"><a href="#-880"><span class="linenos"> 880</span></a>                <span class="sa">f</span><span class="s2">&quot;   ... fault ellipsoid semi-axes (a, b, c): </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">semi_axes</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, &quot;</span>
</span><span id="Faults-881"><a href="#-881"><span class="linenos"> 881</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">semi_axes</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">semi_axes</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Faults-882"><a href="#-882"><span class="linenos"> 882</span></a>            <span class="p">)</span>
</span><span id="Faults-883"><a href="#-883"><span class="linenos"> 883</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="Faults-884"><a href="#-884"><span class="linenos"> 884</span></a>                <span class="sa">f</span><span class="s2">&quot;   ... fault ellipsoid origin (x, y, z): </span><span class="si">{</span><span class="n">origin</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">origin</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">origin</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Faults-885"><a href="#-885"><span class="linenos"> 885</span></a>            <span class="p">)</span>
</span><span id="Faults-886"><a href="#-886"><span class="linenos"> 886</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   ... tilt_pct: </span><span class="si">{</span><span class="n">tilt</span> <span class="o">*</span> <span class="mi">100</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Faults-887"><a href="#-887"><span class="linenos"> 887</span></a>            <span class="n">z_base</span> <span class="o">=</span> <span class="n">origin</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">semi_axes</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</span><span id="Faults-888"><a href="#-888"><span class="linenos"> 888</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="Faults-889"><a href="#-889"><span class="linenos"> 889</span></a>                <span class="sa">f</span><span class="s2">&quot;   ...z for bottom of ellipsoid at depth (samples) = </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">z_base</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Faults-890"><a href="#-890"><span class="linenos"> 890</span></a>            <span class="p">)</span>
</span><span id="Faults-891"><a href="#-891"><span class="linenos"> 891</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   ...shape of output_cube = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">geologic_age</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Faults-892"><a href="#-892"><span class="linenos"> 892</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="Faults-893"><a href="#-893"><span class="linenos"> 893</span></a>                <span class="sa">f</span><span class="s2">&quot;   ...infill_factor, pad_samples = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">infill_factor</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">pad_samples</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Faults-894"><a href="#-894"><span class="linenos"> 894</span></a>            <span class="p">)</span>
</span><span id="Faults-895"><a href="#-895"><span class="linenos"> 895</span></a>
</span><span id="Faults-896"><a href="#-896"><span class="linenos"> 896</span></a>            <span class="c1"># add empty arrays for shear_zone_width and gouge_pctile to fault params dictionary</span>
</span><span id="Faults-897"><a href="#-897"><span class="linenos"> 897</span></a>            <span class="n">fp</span><span class="p">[</span><span class="s2">&quot;shear_zone_width&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">number_faults</span><span class="p">)</span>
</span><span id="Faults-898"><a href="#-898"><span class="linenos"> 898</span></a>            <span class="n">fp</span><span class="p">[</span><span class="s2">&quot;gouge_pctile&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">number_faults</span><span class="p">)</span>
</span><span id="Faults-899"><a href="#-899"><span class="linenos"> 899</span></a>            <span class="p">(</span>
</span><span id="Faults-900"><a href="#-900"><span class="linenos"> 900</span></a>                <span class="n">displacement</span><span class="p">,</span>
</span><span id="Faults-901"><a href="#-901"><span class="linenos"> 901</span></a>                <span class="n">displacement_classification</span><span class="p">,</span>
</span><span id="Faults-902"><a href="#-902"><span class="linenos"> 902</span></a>                <span class="n">interpolation</span><span class="p">,</span>
</span><span id="Faults-903"><a href="#-903"><span class="linenos"> 903</span></a>                <span class="n">hockey_stick</span><span class="p">,</span>
</span><span id="Faults-904"><a href="#-904"><span class="linenos"> 904</span></a>                <span class="n">fault_segm</span><span class="p">,</span>
</span><span id="Faults-905"><a href="#-905"><span class="linenos"> 905</span></a>                <span class="n">ellipsoid</span><span class="p">,</span>
</span><span id="Faults-906"><a href="#-906"><span class="linenos"> 906</span></a>                <span class="n">fp</span><span class="p">,</span>
</span><span id="Faults-907"><a href="#-907"><span class="linenos"> 907</span></a>            <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_displacement_vector</span><span class="p">(</span>
</span><span id="Faults-908"><a href="#-908"><span class="linenos"> 908</span></a>                <span class="n">semi_axes</span><span class="p">,</span> <span class="n">origin</span><span class="p">,</span> <span class="n">throw</span><span class="p">,</span> <span class="n">tilt</span><span class="p">,</span> <span class="n">wb</span><span class="p">,</span> <span class="n">ifault</span><span class="p">,</span> <span class="n">fp</span>
</span><span id="Faults-909"><a href="#-909"><span class="linenos"> 909</span></a>            <span class="p">)</span>
</span><span id="Faults-910"><a href="#-910"><span class="linenos"> 910</span></a>
</span><span id="Faults-911"><a href="#-911"><span class="linenos"> 911</span></a>            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="Faults-912"><a href="#-912"><span class="linenos"> 912</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;     ... hockey_stick = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">hockey_stick</span><span class="p">))</span>
</span><span id="Faults-913"><a href="#-913"><span class="linenos"> 913</span></a>                <span class="nb">print</span><span class="p">(</span>
</span><span id="Faults-914"><a href="#-914"><span class="linenos"> 914</span></a>                    <span class="s2">&quot;     ... Is displacement the same as displacement_classification? &quot;</span>
</span><span id="Faults-915"><a href="#-915"><span class="linenos"> 915</span></a>                    <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">displacement</span> <span class="o">==</span> <span class="n">displacement_classification</span><span class="p">))</span>
</span><span id="Faults-916"><a href="#-916"><span class="linenos"> 916</span></a>                <span class="p">)</span>
</span><span id="Faults-917"><a href="#-917"><span class="linenos"> 917</span></a>                <span class="nb">print</span><span class="p">(</span>
</span><span id="Faults-918"><a href="#-918"><span class="linenos"> 918</span></a>                    <span class="s2">&quot;     ... Sample count where displacement differs from displacement_classification? &quot;</span>
</span><span id="Faults-919"><a href="#-919"><span class="linenos"> 919</span></a>                    <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="Faults-920"><a href="#-920"><span class="linenos"> 920</span></a>                        <span class="n">displacement</span><span class="p">[</span><span class="n">displacement</span> <span class="o">!=</span> <span class="n">displacement_classification</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="Faults-921"><a href="#-921"><span class="linenos"> 921</span></a>                    <span class="p">)</span>
</span><span id="Faults-922"><a href="#-922"><span class="linenos"> 922</span></a>                <span class="p">)</span>
</span><span id="Faults-923"><a href="#-923"><span class="linenos"> 923</span></a>                <span class="nb">print</span><span class="p">(</span>
</span><span id="Faults-924"><a href="#-924"><span class="linenos"> 924</span></a>                    <span class="s2">&quot;     ... percent of samples where displacement differs from displacement_classification = &quot;</span>
</span><span id="Faults-925"><a href="#-925"><span class="linenos"> 925</span></a>                    <span class="o">+</span> <span class="nb">format</span><span class="p">(</span>
</span><span id="Faults-926"><a href="#-926"><span class="linenos"> 926</span></a>                        <span class="nb">float</span><span class="p">(</span>
</span><span id="Faults-927"><a href="#-927"><span class="linenos"> 927</span></a>                            <span class="n">displacement</span><span class="p">[</span>
</span><span id="Faults-928"><a href="#-928"><span class="linenos"> 928</span></a>                                <span class="n">displacement</span> <span class="o">!=</span> <span class="n">displacement_classification</span>
</span><span id="Faults-929"><a href="#-929"><span class="linenos"> 929</span></a>                            <span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="Faults-930"><a href="#-930"><span class="linenos"> 930</span></a>                        <span class="p">)</span>
</span><span id="Faults-931"><a href="#-931"><span class="linenos"> 931</span></a>                        <span class="o">/</span> <span class="n">samples_in_cube</span><span class="p">,</span>
</span><span id="Faults-932"><a href="#-932"><span class="linenos"> 932</span></a>                        <span class="s2">&quot;5.1%&quot;</span><span class="p">,</span>
</span><span id="Faults-933"><a href="#-933"><span class="linenos"> 933</span></a>                    <span class="p">)</span>
</span><span id="Faults-934"><a href="#-934"><span class="linenos"> 934</span></a>                <span class="p">)</span>
</span><span id="Faults-935"><a href="#-935"><span class="linenos"> 935</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="Faults-936"><a href="#-936"><span class="linenos"> 936</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="Faults-937"><a href="#-937"><span class="linenos"> 937</span></a>                        <span class="s2">&quot;     ... (displacement differs from displacement_classification).mean() &quot;</span>
</span><span id="Faults-938"><a href="#-938"><span class="linenos"> 938</span></a>                        <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="Faults-939"><a href="#-939"><span class="linenos"> 939</span></a>                            <span class="n">displacement</span><span class="p">[</span>
</span><span id="Faults-940"><a href="#-940"><span class="linenos"> 940</span></a>                                <span class="n">displacement</span> <span class="o">!=</span> <span class="n">displacement_classification</span>
</span><span id="Faults-941"><a href="#-941"><span class="linenos"> 941</span></a>                            <span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</span><span id="Faults-942"><a href="#-942"><span class="linenos"> 942</span></a>                        <span class="p">)</span>
</span><span id="Faults-943"><a href="#-943"><span class="linenos"> 943</span></a>                    <span class="p">)</span>
</span><span id="Faults-944"><a href="#-944"><span class="linenos"> 944</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="Faults-945"><a href="#-945"><span class="linenos"> 945</span></a>                        <span class="s2">&quot;     ... (displacement differs from displacement_classification).max() &quot;</span>
</span><span id="Faults-946"><a href="#-946"><span class="linenos"> 946</span></a>                        <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="Faults-947"><a href="#-947"><span class="linenos"> 947</span></a>                            <span class="n">displacement</span><span class="p">[</span>
</span><span id="Faults-948"><a href="#-948"><span class="linenos"> 948</span></a>                                <span class="n">displacement</span> <span class="o">!=</span> <span class="n">displacement_classification</span>
</span><span id="Faults-949"><a href="#-949"><span class="linenos"> 949</span></a>                            <span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</span><span id="Faults-950"><a href="#-950"><span class="linenos"> 950</span></a>                        <span class="p">)</span>
</span><span id="Faults-951"><a href="#-951"><span class="linenos"> 951</span></a>                    <span class="p">)</span>
</span><span id="Faults-952"><a href="#-952"><span class="linenos"> 952</span></a>                <span class="k">except</span><span class="p">:</span>
</span><span id="Faults-953"><a href="#-953"><span class="linenos"> 953</span></a>                    <span class="k">pass</span>
</span><span id="Faults-954"><a href="#-954"><span class="linenos"> 954</span></a>
</span><span id="Faults-955"><a href="#-955"><span class="linenos"> 955</span></a>                <span class="nb">print</span><span class="p">(</span>
</span><span id="Faults-956"><a href="#-956"><span class="linenos"> 956</span></a>                    <span class="s2">&quot;   ...displacement_classification.min() = &quot;</span>
</span><span id="Faults-957"><a href="#-957"><span class="linenos"> 957</span></a>                    <span class="o">+</span> <span class="s2">&quot;, &quot;</span>
</span><span id="Faults-958"><a href="#-958"><span class="linenos"> 958</span></a>                    <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">displacement_classification</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
</span><span id="Faults-959"><a href="#-959"><span class="linenos"> 959</span></a>                <span class="p">)</span>
</span><span id="Faults-960"><a href="#-960"><span class="linenos"> 960</span></a>                <span class="nb">print</span><span class="p">(</span>
</span><span id="Faults-961"><a href="#-961"><span class="linenos"> 961</span></a>                    <span class="s2">&quot;   ...displacement_classification.mean() = &quot;</span>
</span><span id="Faults-962"><a href="#-962"><span class="linenos"> 962</span></a>                    <span class="o">+</span> <span class="s2">&quot;, &quot;</span>
</span><span id="Faults-963"><a href="#-963"><span class="linenos"> 963</span></a>                    <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">displacement_classification</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
</span><span id="Faults-964"><a href="#-964"><span class="linenos"> 964</span></a>                <span class="p">)</span>
</span><span id="Faults-965"><a href="#-965"><span class="linenos"> 965</span></a>                <span class="nb">print</span><span class="p">(</span>
</span><span id="Faults-966"><a href="#-966"><span class="linenos"> 966</span></a>                    <span class="s2">&quot;   ...displacement_classification.max() = &quot;</span>
</span><span id="Faults-967"><a href="#-967"><span class="linenos"> 967</span></a>                    <span class="o">+</span> <span class="s2">&quot;, &quot;</span>
</span><span id="Faults-968"><a href="#-968"><span class="linenos"> 968</span></a>                    <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">displacement_classification</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
</span><span id="Faults-969"><a href="#-969"><span class="linenos"> 969</span></a>                <span class="p">)</span>
</span><span id="Faults-970"><a href="#-970"><span class="linenos"> 970</span></a>
</span><span id="Faults-971"><a href="#-971"><span class="linenos"> 971</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   ...displacement.min() = &quot;</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">displacement</span><span class="o">.</span><span class="n">min</span><span class="p">()))</span>
</span><span id="Faults-972"><a href="#-972"><span class="linenos"> 972</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   ...displacement.mean() = &quot;</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">displacement</span><span class="o">.</span><span class="n">mean</span><span class="p">()))</span>
</span><span id="Faults-973"><a href="#-973"><span class="linenos"> 973</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   ...displacement.max() = &quot;</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">displacement</span><span class="o">.</span><span class="n">max</span><span class="p">()))</span>
</span><span id="Faults-974"><a href="#-974"><span class="linenos"> 974</span></a>                <span class="k">if</span> <span class="n">fault_segm</span><span class="p">[</span><span class="n">fault_segm</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Faults-975"><a href="#-975"><span class="linenos"> 975</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="Faults-976"><a href="#-976"><span class="linenos"> 976</span></a>                        <span class="s2">&quot;   ...displacement[fault_segm &gt;0].min() = &quot;</span>
</span><span id="Faults-977"><a href="#-977"><span class="linenos"> 977</span></a>                        <span class="o">+</span> <span class="s2">&quot;, &quot;</span>
</span><span id="Faults-978"><a href="#-978"><span class="linenos"> 978</span></a>                        <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">displacement</span><span class="p">[</span><span class="n">fault_segm</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
</span><span id="Faults-979"><a href="#-979"><span class="linenos"> 979</span></a>                    <span class="p">)</span>
</span><span id="Faults-980"><a href="#-980"><span class="linenos"> 980</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="Faults-981"><a href="#-981"><span class="linenos"> 981</span></a>                        <span class="s2">&quot;   ...displacement[fault_segm &gt;0] P10 = &quot;</span>
</span><span id="Faults-982"><a href="#-982"><span class="linenos"> 982</span></a>                        <span class="o">+</span> <span class="s2">&quot;, &quot;</span>
</span><span id="Faults-983"><a href="#-983"><span class="linenos"> 983</span></a>                        <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">displacement</span><span class="p">[</span><span class="n">fault_segm</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">],</span> <span class="mi">10</span><span class="p">))</span>
</span><span id="Faults-984"><a href="#-984"><span class="linenos"> 984</span></a>                    <span class="p">)</span>
</span><span id="Faults-985"><a href="#-985"><span class="linenos"> 985</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="Faults-986"><a href="#-986"><span class="linenos"> 986</span></a>                        <span class="s2">&quot;   ...displacement[fault_segm &gt;0] P25 = &quot;</span>
</span><span id="Faults-987"><a href="#-987"><span class="linenos"> 987</span></a>                        <span class="o">+</span> <span class="s2">&quot;, &quot;</span>
</span><span id="Faults-988"><a href="#-988"><span class="linenos"> 988</span></a>                        <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">displacement</span><span class="p">[</span><span class="n">fault_segm</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">],</span> <span class="mi">25</span><span class="p">))</span>
</span><span id="Faults-989"><a href="#-989"><span class="linenos"> 989</span></a>                    <span class="p">)</span>
</span><span id="Faults-990"><a href="#-990"><span class="linenos"> 990</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="Faults-991"><a href="#-991"><span class="linenos"> 991</span></a>                        <span class="s2">&quot;   ...displacement[fault_segm &gt;0].mean() = &quot;</span>
</span><span id="Faults-992"><a href="#-992"><span class="linenos"> 992</span></a>                        <span class="o">+</span> <span class="s2">&quot;, &quot;</span>
</span><span id="Faults-993"><a href="#-993"><span class="linenos"> 993</span></a>                        <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">displacement</span><span class="p">[</span><span class="n">fault_segm</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
</span><span id="Faults-994"><a href="#-994"><span class="linenos"> 994</span></a>                    <span class="p">)</span>
</span><span id="Faults-995"><a href="#-995"><span class="linenos"> 995</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="Faults-996"><a href="#-996"><span class="linenos"> 996</span></a>                        <span class="s2">&quot;   ...displacement[fault_segm &gt;0] P75 = &quot;</span>
</span><span id="Faults-997"><a href="#-997"><span class="linenos"> 997</span></a>                        <span class="o">+</span> <span class="s2">&quot;, &quot;</span>
</span><span id="Faults-998"><a href="#-998"><span class="linenos"> 998</span></a>                        <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">displacement</span><span class="p">[</span><span class="n">fault_segm</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">],</span> <span class="mi">75</span><span class="p">))</span>
</span><span id="Faults-999"><a href="#-999"><span class="linenos"> 999</span></a>                    <span class="p">)</span>
</span><span id="Faults-1000"><a href="#-1000"><span class="linenos">1000</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="Faults-1001"><a href="#-1001"><span class="linenos">1001</span></a>                        <span class="s2">&quot;   ...displacement[fault_segm &gt;0] P90 = &quot;</span>
</span><span id="Faults-1002"><a href="#-1002"><span class="linenos">1002</span></a>                        <span class="o">+</span> <span class="s2">&quot;, &quot;</span>
</span><span id="Faults-1003"><a href="#-1003"><span class="linenos">1003</span></a>                        <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">displacement</span><span class="p">[</span><span class="n">fault_segm</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">],</span> <span class="mi">90</span><span class="p">))</span>
</span><span id="Faults-1004"><a href="#-1004"><span class="linenos">1004</span></a>                    <span class="p">)</span>
</span><span id="Faults-1005"><a href="#-1005"><span class="linenos">1005</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="Faults-1006"><a href="#-1006"><span class="linenos">1006</span></a>                        <span class="s2">&quot;   ...displacement[fault_segm &gt;0].max() = &quot;</span>
</span><span id="Faults-1007"><a href="#-1007"><span class="linenos">1007</span></a>                        <span class="o">+</span> <span class="s2">&quot;, &quot;</span>
</span><span id="Faults-1008"><a href="#-1008"><span class="linenos">1008</span></a>                        <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">displacement</span><span class="p">[</span><span class="n">fault_segm</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
</span><span id="Faults-1009"><a href="#-1009"><span class="linenos">1009</span></a>                    <span class="p">)</span>
</span><span id="Faults-1010"><a href="#-1010"><span class="linenos">1010</span></a>
</span><span id="Faults-1011"><a href="#-1011"><span class="linenos">1011</span></a>            <span class="n">inline</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">//</span> <span class="mi">2</span>
</span><span id="Faults-1012"><a href="#-1012"><span class="linenos">1012</span></a>
</span><span id="Faults-1013"><a href="#-1013"><span class="linenos">1013</span></a>            <span class="c1"># limit labels to portions of fault plane with throw above threshold</span>
</span><span id="Faults-1014"><a href="#-1014"><span class="linenos">1014</span></a>            <span class="n">throw_threshold_samples</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="Faults-1015"><a href="#-1015"><span class="linenos">1015</span></a>            <span class="n">footprint</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</span><span id="Faults-1016"><a href="#-1016"><span class="linenos">1016</span></a>            <span class="n">fp_i</span><span class="p">,</span> <span class="n">fp_j</span><span class="p">,</span> <span class="n">fp_k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
</span><span id="Faults-1017"><a href="#-1017"><span class="linenos">1017</span></a>                <span class="p">(</span><span class="n">fault_segm</span> <span class="o">&gt;</span> <span class="mf">0.25</span><span class="p">)</span>
</span><span id="Faults-1018"><a href="#-1018"><span class="linenos">1018</span></a>                <span class="o">&amp;</span> <span class="p">(</span><span class="n">displacement_classification</span> <span class="o">&gt;</span> <span class="n">throw_threshold_samples</span><span class="p">)</span>
</span><span id="Faults-1019"><a href="#-1019"><span class="linenos">1019</span></a>            <span class="p">)</span>
</span><span id="Faults-1020"><a href="#-1020"><span class="linenos">1020</span></a>            <span class="n">fault_segm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">fault_segm</span><span class="p">)</span>
</span><span id="Faults-1021"><a href="#-1021"><span class="linenos">1021</span></a>            <span class="n">fault_plane_displacement</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">fault_segm</span><span class="p">)</span>
</span><span id="Faults-1022"><a href="#-1022"><span class="linenos">1022</span></a>            <span class="n">fault_segm</span><span class="p">[</span><span class="n">fp_i</span><span class="p">,</span> <span class="n">fp_j</span><span class="p">,</span> <span class="n">fp_k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="Faults-1023"><a href="#-1023"><span class="linenos">1023</span></a>            <span class="n">fault_plane_displacement</span><span class="p">[</span><span class="n">fp_i</span><span class="p">,</span> <span class="n">fp_j</span><span class="p">,</span> <span class="n">fp_k</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="Faults-1024"><a href="#-1024"><span class="linenos">1024</span></a>                <span class="n">displacement_classification</span><span class="p">[</span><span class="n">fp_i</span><span class="p">,</span> <span class="n">fp_j</span><span class="p">,</span> <span class="n">fp_k</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1.0</span>
</span><span id="Faults-1025"><a href="#-1025"><span class="linenos">1025</span></a>            <span class="p">)</span>
</span><span id="Faults-1026"><a href="#-1026"><span class="linenos">1026</span></a>
</span><span id="Faults-1027"><a href="#-1027"><span class="linenos">1027</span></a>            <span class="n">fault_voxel_count_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fault_segm</span><span class="p">[</span><span class="n">fault_segm</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
</span><span id="Faults-1028"><a href="#-1028"><span class="linenos">1028</span></a>
</span><span id="Faults-1029"><a href="#-1029"><span class="linenos">1029</span></a>            <span class="c1"># create blended version of displacement that accounts for simulation of fault drag</span>
</span><span id="Faults-1030"><a href="#-1030"><span class="linenos">1030</span></a>            <span class="n">drag_factor</span> <span class="o">=</span> <span class="mf">0.5</span>
</span><span id="Faults-1031"><a href="#-1031"><span class="linenos">1031</span></a>            <span class="n">displacement</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="Faults-1032"><a href="#-1032"><span class="linenos">1032</span></a>                <span class="mf">1.0</span> <span class="o">-</span> <span class="n">drag_factor</span>
</span><span id="Faults-1033"><a href="#-1033"><span class="linenos">1033</span></a>            <span class="p">)</span> <span class="o">*</span> <span class="n">displacement</span> <span class="o">+</span> <span class="n">drag_factor</span> <span class="o">*</span> <span class="n">displacement_classification</span>
</span><span id="Faults-1034"><a href="#-1034"><span class="linenos">1034</span></a>
</span><span id="Faults-1035"><a href="#-1035"><span class="linenos">1035</span></a>            <span class="c1"># project fault depth on 2D map surface</span>
</span><span id="Faults-1036"><a href="#-1036"><span class="linenos">1036</span></a>            <span class="n">fault_plane_map</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">wb</span><span class="p">)</span>
</span><span id="Faults-1037"><a href="#-1037"><span class="linenos">1037</span></a>            <span class="n">depth_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">ellipsoid</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</span><span id="Faults-1038"><a href="#-1038"><span class="linenos">1038</span></a>            <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">fault_plane_map</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="Faults-1039"><a href="#-1039"><span class="linenos">1039</span></a>                <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">fault_plane_map</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
</span><span id="Faults-1040"><a href="#-1040"><span class="linenos">1040</span></a>                    <span class="n">fault_plane_map</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span> <span class="n">jj</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span>
</span><span id="Faults-1041"><a href="#-1041"><span class="linenos">1041</span></a>                        <span class="mf">1.0</span><span class="p">,</span> <span class="n">ellipsoid</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span> <span class="n">jj</span><span class="p">,</span> <span class="p">:],</span> <span class="n">depth_indices</span>
</span><span id="Faults-1042"><a href="#-1042"><span class="linenos">1042</span></a>                    <span class="p">)</span>
</span><span id="Faults-1043"><a href="#-1043"><span class="linenos">1043</span></a>            <span class="n">fault_plane_map</span> <span class="o">=</span> <span class="n">fault_plane_map</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">ellipsoid</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="Faults-1044"><a href="#-1044"><span class="linenos">1044</span></a>
</span><span id="Faults-1045"><a href="#-1045"><span class="linenos">1045</span></a>            <span class="c1"># compute fault azimuth (relative to i,j,k indices, not North)</span>
</span><span id="Faults-1046"><a href="#-1046"><span class="linenos">1046</span></a>            <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">gradient</span><span class="p">(</span><span class="n">fault_plane_map</span><span class="p">)</span>
</span><span id="Faults-1047"><a href="#-1047"><span class="linenos">1047</span></a>            <span class="n">strike_angle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">dy</span><span class="p">,</span> <span class="n">dx</span><span class="p">)</span> <span class="o">*</span> <span class="mf">180.0</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>  <span class="c1"># 2D</span>
</span><span id="Faults-1048"><a href="#-1048"><span class="linenos">1048</span></a>            <span class="k">del</span> <span class="n">dx</span>
</span><span id="Faults-1049"><a href="#-1049"><span class="linenos">1049</span></a>            <span class="k">del</span> <span class="n">dy</span>
</span><span id="Faults-1050"><a href="#-1050"><span class="linenos">1050</span></a>            <span class="n">strike_angle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">fault_segm</span><span class="p">)</span> <span class="o">+</span> <span class="n">strike_angle</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span>
</span><span id="Faults-1051"><a href="#-1051"><span class="linenos">1051</span></a>                <span class="n">fault_plane_map</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">fault_plane_map</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1</span>
</span><span id="Faults-1052"><a href="#-1052"><span class="linenos">1052</span></a>            <span class="p">)</span>
</span><span id="Faults-1053"><a href="#-1053"><span class="linenos">1053</span></a>            <span class="n">strike_angle</span><span class="p">[</span><span class="n">fault_segm</span> <span class="o">&lt;</span> <span class="mf">0.5</span><span class="p">]</span> <span class="o">=</span> <span class="mf">200.0</span>
</span><span id="Faults-1054"><a href="#-1054"><span class="linenos">1054</span></a>
</span><span id="Faults-1055"><a href="#-1055"><span class="linenos">1055</span></a>            <span class="c1"># - compute faulted depth as max of fault plane or faulted depth</span>
</span><span id="Faults-1056"><a href="#-1056"><span class="linenos">1056</span></a>            <span class="n">fault_plane</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">displacement</span><span class="p">)</span> <span class="o">+</span> <span class="n">fault_plane_map</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span>
</span><span id="Faults-1057"><a href="#-1057"><span class="linenos">1057</span></a>                <span class="n">fault_plane_map</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">fault_plane_map</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1</span>
</span><span id="Faults-1058"><a href="#-1058"><span class="linenos">1058</span></a>            <span class="p">)</span>
</span><span id="Faults-1059"><a href="#-1059"><span class="linenos">1059</span></a>
</span><span id="Faults-1060"><a href="#-1060"><span class="linenos">1060</span></a>            <span class="k">if</span> <span class="n">ifault</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Faults-1061"><a href="#-1061"><span class="linenos">1061</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;      .... set _unfaulted_depths to array with all zeros...&quot;</span><span class="p">)</span>
</span><span id="Faults-1062"><a href="#-1062"><span class="linenos">1062</span></a>                <span class="n">_faulted_depths</span> <span class="o">=</span> <span class="n">unfaulted_depths</span> <span class="o">*</span> <span class="mf">1.0</span>
</span><span id="Faults-1063"><a href="#-1063"><span class="linenos">1063</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">fault_plane_azimuth</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">strike_angle</span> <span class="o">*</span> <span class="mf">1.0</span>
</span><span id="Faults-1064"><a href="#-1064"><span class="linenos">1064</span></a>
</span><span id="Faults-1065"><a href="#-1065"><span class="linenos">1065</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   ... interpolation = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">interpolation</span><span class="p">))</span>
</span><span id="Faults-1066"><a href="#-1066"><span class="linenos">1066</span></a>
</span><span id="Faults-1067"><a href="#-1067"><span class="linenos">1067</span></a>            <span class="k">if</span> <span class="p">(</span>
</span><span id="Faults-1068"><a href="#-1068"><span class="linenos">1068</span></a>                <span class="n">interpolation</span>
</span><span id="Faults-1069"><a href="#-1069"><span class="linenos">1069</span></a>            <span class="p">):</span>  <span class="c1"># i.e. if the fault should be considered, apply the displacements and append fault plane</span>
</span><span id="Faults-1070"><a href="#-1070"><span class="linenos">1070</span></a>                <span class="n">faulted_depths2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span>
</span><span id="Faults-1071"><a href="#-1071"><span class="linenos">1071</span></a>                    <span class="p">(</span><span class="n">ellipsoid</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ellipsoid</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ellipsoid</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">2</span><span class="p">),</span>
</span><span id="Faults-1072"><a href="#-1072"><span class="linenos">1072</span></a>                    <span class="s2">&quot;float&quot;</span><span class="p">,</span>
</span><span id="Faults-1073"><a href="#-1073"><span class="linenos">1073</span></a>                <span class="p">)</span>
</span><span id="Faults-1074"><a href="#-1074"><span class="linenos">1074</span></a>                <span class="n">faulted_depths2</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">displacement</span> <span class="o">*</span> <span class="mf">1.0</span>
</span><span id="Faults-1075"><a href="#-1075"><span class="linenos">1075</span></a>                <span class="n">faulted_depths2</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">fault_plane</span> <span class="o">-</span> <span class="n">faulted_depths</span>
</span><span id="Faults-1076"><a href="#-1076"><span class="linenos">1076</span></a>                <span class="n">faulted_depths2</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="mi">1</span><span class="p">][</span><span class="n">ellipsoid</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="Faults-1077"><a href="#-1077"><span class="linenos">1077</span></a>                <span class="n">map_displacement_vector</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">faulted_depths2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span>
</span><span id="Faults-1078"><a href="#-1078"><span class="linenos">1078</span></a>                    <span class="mf">0.0</span><span class="p">,</span> <span class="kc">None</span>
</span><span id="Faults-1079"><a href="#-1079"><span class="linenos">1079</span></a>                <span class="p">)</span>
</span><span id="Faults-1080"><a href="#-1080"><span class="linenos">1080</span></a>                <span class="k">del</span> <span class="n">faulted_depths2</span>
</span><span id="Faults-1081"><a href="#-1081"><span class="linenos">1081</span></a>                <span class="n">map_displacement_vector</span><span class="p">[</span><span class="n">ellipsoid</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="Faults-1082"><a href="#-1082"><span class="linenos">1082</span></a>
</span><span id="Faults-1083"><a href="#-1083"><span class="linenos">1083</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">sum_map_displacements</span><span class="p">[:]</span> <span class="o">+=</span> <span class="n">map_displacement_vector</span>
</span><span id="Faults-1084"><a href="#-1084"><span class="linenos">1084</span></a>                <span class="n">displacements_class</span> <span class="o">+=</span> <span class="n">displacement_classification</span>
</span><span id="Faults-1085"><a href="#-1085"><span class="linenos">1085</span></a>                <span class="c1"># Set displacements outside ellipsoid to 0</span>
</span><span id="Faults-1086"><a href="#-1086"><span class="linenos">1086</span></a>                <span class="n">displacement</span><span class="p">[</span><span class="n">ellipsoid</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Faults-1087"><a href="#-1087"><span class="linenos">1087</span></a>
</span><span id="Faults-1088"><a href="#-1088"><span class="linenos">1088</span></a>                <span class="n">sum_displacements</span> <span class="o">+=</span> <span class="n">displacement</span>
</span><span id="Faults-1089"><a href="#-1089"><span class="linenos">1089</span></a>
</span><span id="Faults-1090"><a href="#-1090"><span class="linenos">1090</span></a>                <span class="c1"># apply fault to depth_cube</span>
</span><span id="Faults-1091"><a href="#-1091"><span class="linenos">1091</span></a>                <span class="k">if</span> <span class="n">ifault</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Faults-1092"><a href="#-1092"><span class="linenos">1092</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;      .... set _unfaulted_depths to array with all zeros...&quot;</span><span class="p">)</span>
</span><span id="Faults-1093"><a href="#-1093"><span class="linenos">1093</span></a>                    <span class="n">_faulted_depths</span> <span class="o">=</span> <span class="n">unfaulted_depths</span> <span class="o">*</span> <span class="mf">1.0</span>
</span><span id="Faults-1094"><a href="#-1094"><span class="linenos">1094</span></a>                    <span class="n">adjusted_faulted_depths</span> <span class="o">=</span> <span class="p">(</span><span class="n">unfaulted_depths</span> <span class="o">-</span> <span class="n">displacement</span><span class="p">)</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span>
</span><span id="Faults-1095"><a href="#-1095"><span class="linenos">1095</span></a>                        <span class="mi">0</span><span class="p">,</span> <span class="n">ellipsoid</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>
</span><span id="Faults-1096"><a href="#-1096"><span class="linenos">1096</span></a>                    <span class="p">)</span>
</span><span id="Faults-1097"><a href="#-1097"><span class="linenos">1097</span></a>                    <span class="n">_faulted_depths</span> <span class="o">=</span> <span class="n">apply_faulting</span><span class="p">(</span>
</span><span id="Faults-1098"><a href="#-1098"><span class="linenos">1098</span></a>                        <span class="n">_faulted_depths</span><span class="p">,</span> <span class="n">adjusted_faulted_depths</span>
</span><span id="Faults-1099"><a href="#-1099"><span class="linenos">1099</span></a>                    <span class="p">)</span>
</span><span id="Faults-1100"><a href="#-1100"><span class="linenos">1100</span></a>                    <span class="n">_mft</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_fault_throw</span><span class="p">[:]</span>
</span><span id="Faults-1101"><a href="#-1101"><span class="linenos">1101</span></a>                    <span class="n">_mft</span><span class="p">[</span><span class="n">ellipsoid</span> <span class="o">&lt;=</span> <span class="mf">1.0</span><span class="p">]</span> <span class="o">=</span> <span class="n">throw</span>
</span><span id="Faults-1102"><a href="#-1102"><span class="linenos">1102</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">max_fault_throw</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">_mft</span>
</span><span id="Faults-1103"><a href="#-1103"><span class="linenos">1103</span></a>                    <span class="k">del</span> <span class="n">_mft</span>
</span><span id="Faults-1104"><a href="#-1104"><span class="linenos">1104</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">fault_planes</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">fault_segm</span> <span class="o">*</span> <span class="mf">1.0</span>
</span><span id="Faults-1105"><a href="#-1105"><span class="linenos">1105</span></a>                    <span class="n">_fault_intersections</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fault_intersections</span><span class="p">[:]</span>
</span><span id="Faults-1106"><a href="#-1106"><span class="linenos">1106</span></a>                    <span class="n">previous_intersection_voxel_count</span> <span class="o">=</span> <span class="n">_fault_intersections</span><span class="p">[</span>
</span><span id="Faults-1107"><a href="#-1107"><span class="linenos">1107</span></a>                        <span class="n">_fault_intersections</span> <span class="o">&gt;</span> <span class="mf">1.1</span>
</span><span id="Faults-1108"><a href="#-1108"><span class="linenos">1108</span></a>                    <span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="Faults-1109"><a href="#-1109"><span class="linenos">1109</span></a>                    <span class="n">_fault_intersections</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fault_planes</span><span class="p">[:]</span> <span class="o">*</span> <span class="mf">1.0</span>
</span><span id="Faults-1110"><a href="#-1110"><span class="linenos">1110</span></a>                    <span class="k">if</span> <span class="p">(</span>
</span><span id="Faults-1111"><a href="#-1111"><span class="linenos">1111</span></a>                        <span class="n">_fault_intersections</span><span class="p">[</span><span class="n">_fault_intersections</span> <span class="o">&gt;</span> <span class="mf">1.1</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="Faults-1112"><a href="#-1112"><span class="linenos">1112</span></a>                        <span class="o">&gt;</span> <span class="n">previous_intersection_voxel_count</span>
</span><span id="Faults-1113"><a href="#-1113"><span class="linenos">1113</span></a>                    <span class="p">):</span>
</span><span id="Faults-1114"><a href="#-1114"><span class="linenos">1114</span></a>                        <span class="n">number_fault_intersections</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="Faults-1115"><a href="#-1115"><span class="linenos">1115</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">fault_intersections</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">_fault_intersections</span>
</span><span id="Faults-1116"><a href="#-1116"><span class="linenos">1116</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">fault_plane_throw</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">fault_plane_displacement</span> <span class="o">*</span> <span class="mf">1.0</span>
</span><span id="Faults-1117"><a href="#-1117"><span class="linenos">1117</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">fault_plane_azimuth</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">strike_angle</span> <span class="o">*</span> <span class="mf">1.0</span>
</span><span id="Faults-1118"><a href="#-1118"><span class="linenos">1118</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Faults-1119"><a href="#-1119"><span class="linenos">1119</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="Faults-1120"><a href="#-1120"><span class="linenos">1120</span></a>                        <span class="s2">&quot;      .... update _unfaulted_depths array using faulted depths...&quot;</span>
</span><span id="Faults-1121"><a href="#-1121"><span class="linenos">1121</span></a>                    <span class="p">)</span>
</span><span id="Faults-1122"><a href="#-1122"><span class="linenos">1122</span></a>                    <span class="k">try</span><span class="p">:</span>
</span><span id="Faults-1123"><a href="#-1123"><span class="linenos">1123</span></a>                        <span class="nb">print</span><span class="p">(</span>
</span><span id="Faults-1124"><a href="#-1124"><span class="linenos">1124</span></a>                            <span class="s2">&quot;          .... (before) _faulted_depths.mean() = &quot;</span>
</span><span id="Faults-1125"><a href="#-1125"><span class="linenos">1125</span></a>                            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">_faulted_depths</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
</span><span id="Faults-1126"><a href="#-1126"><span class="linenos">1126</span></a>                        <span class="p">)</span>
</span><span id="Faults-1127"><a href="#-1127"><span class="linenos">1127</span></a>                    <span class="k">except</span><span class="p">:</span>
</span><span id="Faults-1128"><a href="#-1128"><span class="linenos">1128</span></a>                        <span class="n">_faulted_depths</span> <span class="o">=</span> <span class="n">unfaulted_depths</span> <span class="o">*</span> <span class="mf">1.0</span>
</span><span id="Faults-1129"><a href="#-1129"><span class="linenos">1129</span></a>                    <span class="n">adjusted_faulted_depths</span> <span class="o">=</span> <span class="p">(</span><span class="n">unfaulted_depths</span> <span class="o">-</span> <span class="n">displacement</span><span class="p">)</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span>
</span><span id="Faults-1130"><a href="#-1130"><span class="linenos">1130</span></a>                        <span class="mi">0</span><span class="p">,</span> <span class="n">ellipsoid</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>
</span><span id="Faults-1131"><a href="#-1131"><span class="linenos">1131</span></a>                    <span class="p">)</span>
</span><span id="Faults-1132"><a href="#-1132"><span class="linenos">1132</span></a>                    <span class="n">_faulted_depths</span> <span class="o">=</span> <span class="n">apply_faulting</span><span class="p">(</span>
</span><span id="Faults-1133"><a href="#-1133"><span class="linenos">1133</span></a>                        <span class="n">_faulted_depths</span><span class="p">,</span> <span class="n">adjusted_faulted_depths</span>
</span><span id="Faults-1134"><a href="#-1134"><span class="linenos">1134</span></a>                    <span class="p">)</span>
</span><span id="Faults-1135"><a href="#-1135"><span class="linenos">1135</span></a>
</span><span id="Faults-1136"><a href="#-1136"><span class="linenos">1136</span></a>                    <span class="n">_fault_planes</span> <span class="o">=</span> <span class="n">apply_faulting</span><span class="p">(</span>
</span><span id="Faults-1137"><a href="#-1137"><span class="linenos">1137</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">fault_planes</span><span class="p">[:],</span> <span class="n">adjusted_faulted_depths</span>
</span><span id="Faults-1138"><a href="#-1138"><span class="linenos">1138</span></a>                    <span class="p">)</span>
</span><span id="Faults-1139"><a href="#-1139"><span class="linenos">1139</span></a>                    <span class="k">if</span> <span class="p">(</span>
</span><span id="Faults-1140"><a href="#-1140"><span class="linenos">1140</span></a>                        <span class="n">_fault_planes</span><span class="p">[</span>
</span><span id="Faults-1141"><a href="#-1141"><span class="linenos">1141</span></a>                            <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="mf">0.0</span> <span class="o">&lt;</span> <span class="n">_fault_planes</span><span class="p">,</span> <span class="n">_fault_planes</span> <span class="o">&lt;</span> <span class="mf">0.25</span><span class="p">)</span>
</span><span id="Faults-1142"><a href="#-1142"><span class="linenos">1142</span></a>                        <span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="Faults-1143"><a href="#-1143"><span class="linenos">1143</span></a>                        <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Faults-1144"><a href="#-1144"><span class="linenos">1144</span></a>                    <span class="p">):</span>
</span><span id="Faults-1145"><a href="#-1145"><span class="linenos">1145</span></a>                        <span class="n">_fault_planes</span><span class="p">[</span>
</span><span id="Faults-1146"><a href="#-1146"><span class="linenos">1146</span></a>                            <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="mf">0.0</span> <span class="o">&lt;</span> <span class="n">_fault_planes</span><span class="p">,</span> <span class="n">_fault_planes</span> <span class="o">&lt;</span> <span class="mf">0.25</span><span class="p">)</span>
</span><span id="Faults-1147"><a href="#-1147"><span class="linenos">1147</span></a>                        <span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="Faults-1148"><a href="#-1148"><span class="linenos">1148</span></a>                    <span class="k">if</span> <span class="p">(</span>
</span><span id="Faults-1149"><a href="#-1149"><span class="linenos">1149</span></a>                        <span class="n">_fault_planes</span><span class="p">[</span>
</span><span id="Faults-1150"><a href="#-1150"><span class="linenos">1150</span></a>                            <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="mf">0.25</span> <span class="o">&lt;</span> <span class="n">_fault_planes</span><span class="p">,</span> <span class="n">_fault_planes</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">)</span>
</span><span id="Faults-1151"><a href="#-1151"><span class="linenos">1151</span></a>                        <span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="Faults-1152"><a href="#-1152"><span class="linenos">1152</span></a>                        <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Faults-1153"><a href="#-1153"><span class="linenos">1153</span></a>                    <span class="p">):</span>
</span><span id="Faults-1154"><a href="#-1154"><span class="linenos">1154</span></a>                        <span class="n">_fault_planes</span><span class="p">[</span>
</span><span id="Faults-1155"><a href="#-1155"><span class="linenos">1155</span></a>                            <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="mf">0.25</span> <span class="o">&lt;</span> <span class="n">_fault_planes</span><span class="p">,</span> <span class="n">_fault_planes</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">)</span>
</span><span id="Faults-1156"><a href="#-1156"><span class="linenos">1156</span></a>                        <span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="Faults-1157"><a href="#-1157"><span class="linenos">1157</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">fault_planes</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">_fault_planes</span>
</span><span id="Faults-1158"><a href="#-1158"><span class="linenos">1158</span></a>                    <span class="k">del</span> <span class="n">_fault_planes</span>
</span><span id="Faults-1159"><a href="#-1159"><span class="linenos">1159</span></a>
</span><span id="Faults-1160"><a href="#-1160"><span class="linenos">1160</span></a>                    <span class="n">_fault_intersections</span> <span class="o">=</span> <span class="n">apply_faulting</span><span class="p">(</span>
</span><span id="Faults-1161"><a href="#-1161"><span class="linenos">1161</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">fault_intersections</span><span class="p">[:],</span> <span class="n">adjusted_faulted_depths</span>
</span><span id="Faults-1162"><a href="#-1162"><span class="linenos">1162</span></a>                    <span class="p">)</span>
</span><span id="Faults-1163"><a href="#-1163"><span class="linenos">1163</span></a>                    <span class="k">if</span> <span class="p">(</span>
</span><span id="Faults-1164"><a href="#-1164"><span class="linenos">1164</span></a>                        <span class="n">_fault_intersections</span><span class="p">[</span>
</span><span id="Faults-1165"><a href="#-1165"><span class="linenos">1165</span></a>                            <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span>
</span><span id="Faults-1166"><a href="#-1166"><span class="linenos">1166</span></a>                                <span class="mf">1.25</span> <span class="o">&lt;</span> <span class="n">_fault_intersections</span><span class="p">,</span> <span class="n">_fault_intersections</span> <span class="o">&lt;</span> <span class="mf">2.0</span>
</span><span id="Faults-1167"><a href="#-1167"><span class="linenos">1167</span></a>                            <span class="p">)</span>
</span><span id="Faults-1168"><a href="#-1168"><span class="linenos">1168</span></a>                        <span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="Faults-1169"><a href="#-1169"><span class="linenos">1169</span></a>                        <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Faults-1170"><a href="#-1170"><span class="linenos">1170</span></a>                    <span class="p">):</span>
</span><span id="Faults-1171"><a href="#-1171"><span class="linenos">1171</span></a>                        <span class="n">_fault_intersections</span><span class="p">[</span>
</span><span id="Faults-1172"><a href="#-1172"><span class="linenos">1172</span></a>                            <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span>
</span><span id="Faults-1173"><a href="#-1173"><span class="linenos">1173</span></a>                                <span class="mf">1.25</span> <span class="o">&lt;</span> <span class="n">_fault_intersections</span><span class="p">,</span> <span class="n">_fault_intersections</span> <span class="o">&lt;</span> <span class="mf">2.0</span>
</span><span id="Faults-1174"><a href="#-1174"><span class="linenos">1174</span></a>                            <span class="p">)</span>
</span><span id="Faults-1175"><a href="#-1175"><span class="linenos">1175</span></a>                        <span class="p">]</span> <span class="o">=</span> <span class="mf">2.0</span>
</span><span id="Faults-1176"><a href="#-1176"><span class="linenos">1176</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">fault_intersections</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">_fault_intersections</span>
</span><span id="Faults-1177"><a href="#-1177"><span class="linenos">1177</span></a>                    <span class="k">del</span> <span class="n">_fault_intersections</span>
</span><span id="Faults-1178"><a href="#-1178"><span class="linenos">1178</span></a>
</span><span id="Faults-1179"><a href="#-1179"><span class="linenos">1179</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">max_fault_throw</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">apply_faulting</span><span class="p">(</span>
</span><span id="Faults-1180"><a href="#-1180"><span class="linenos">1180</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">max_fault_throw</span><span class="p">[:],</span> <span class="n">adjusted_faulted_depths</span>
</span><span id="Faults-1181"><a href="#-1181"><span class="linenos">1181</span></a>                    <span class="p">)</span>
</span><span id="Faults-1182"><a href="#-1182"><span class="linenos">1182</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">fault_plane_throw</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">apply_faulting</span><span class="p">(</span>
</span><span id="Faults-1183"><a href="#-1183"><span class="linenos">1183</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">fault_plane_throw</span><span class="p">[:],</span> <span class="n">adjusted_faulted_depths</span>
</span><span id="Faults-1184"><a href="#-1184"><span class="linenos">1184</span></a>                    <span class="p">)</span>
</span><span id="Faults-1185"><a href="#-1185"><span class="linenos">1185</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">fault_plane_azimuth</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">apply_faulting</span><span class="p">(</span>
</span><span id="Faults-1186"><a href="#-1186"><span class="linenos">1186</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">fault_plane_azimuth</span><span class="p">[:],</span> <span class="n">adjusted_faulted_depths</span>
</span><span id="Faults-1187"><a href="#-1187"><span class="linenos">1187</span></a>                    <span class="p">)</span>
</span><span id="Faults-1188"><a href="#-1188"><span class="linenos">1188</span></a>
</span><span id="Faults-1189"><a href="#-1189"><span class="linenos">1189</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">fault_planes</span><span class="p">[:]</span> <span class="o">+=</span> <span class="n">fault_segm</span>
</span><span id="Faults-1190"><a href="#-1190"><span class="linenos">1190</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">fault_intersections</span><span class="p">[:]</span> <span class="o">+=</span> <span class="n">fault_segm</span>
</span><span id="Faults-1191"><a href="#-1191"><span class="linenos">1191</span></a>                    <span class="n">_mft</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_fault_throw</span><span class="p">[:]</span>
</span><span id="Faults-1192"><a href="#-1192"><span class="linenos">1192</span></a>                    <span class="n">_mft</span><span class="p">[</span><span class="n">ellipsoid</span> <span class="o">&lt;=</span> <span class="mf">1.0</span><span class="p">]</span> <span class="o">+=</span> <span class="n">throw</span>
</span><span id="Faults-1193"><a href="#-1193"><span class="linenos">1193</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">max_fault_throw</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">_mft</span>
</span><span id="Faults-1194"><a href="#-1194"><span class="linenos">1194</span></a>                    <span class="k">del</span> <span class="n">_mft</span>
</span><span id="Faults-1195"><a href="#-1195"><span class="linenos">1195</span></a>
</span><span id="Faults-1196"><a href="#-1196"><span class="linenos">1196</span></a>                    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="Faults-1197"><a href="#-1197"><span class="linenos">1197</span></a>                        <span class="nb">print</span><span class="p">(</span>
</span><span id="Faults-1198"><a href="#-1198"><span class="linenos">1198</span></a>                            <span class="s2">&quot;   ... fault_plane_displacement[fault_plane_displacement &gt; 0.].size = &quot;</span>
</span><span id="Faults-1199"><a href="#-1199"><span class="linenos">1199</span></a>                            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="Faults-1200"><a href="#-1200"><span class="linenos">1200</span></a>                                <span class="n">fault_plane_displacement</span><span class="p">[</span>
</span><span id="Faults-1201"><a href="#-1201"><span class="linenos">1201</span></a>                                    <span class="n">fault_plane_displacement</span> <span class="o">&gt;</span> <span class="mf">0.0</span>
</span><span id="Faults-1202"><a href="#-1202"><span class="linenos">1202</span></a>                                <span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="Faults-1203"><a href="#-1203"><span class="linenos">1203</span></a>                            <span class="p">)</span>
</span><span id="Faults-1204"><a href="#-1204"><span class="linenos">1204</span></a>                        <span class="p">)</span>
</span><span id="Faults-1205"><a href="#-1205"><span class="linenos">1205</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">fault_plane_throw</span><span class="p">[</span>
</span><span id="Faults-1206"><a href="#-1206"><span class="linenos">1206</span></a>                        <span class="n">fault_plane_displacement</span> <span class="o">&gt;</span> <span class="mf">0.0</span>
</span><span id="Faults-1207"><a href="#-1207"><span class="linenos">1207</span></a>                    <span class="p">]</span> <span class="o">=</span> <span class="n">fault_plane_displacement</span><span class="p">[</span><span class="n">fault_plane_displacement</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">]</span>
</span><span id="Faults-1208"><a href="#-1208"><span class="linenos">1208</span></a>                    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="Faults-1209"><a href="#-1209"><span class="linenos">1209</span></a>                        <span class="nb">print</span><span class="p">(</span>
</span><span id="Faults-1210"><a href="#-1210"><span class="linenos">1210</span></a>                            <span class="s2">&quot;   ... self.fault_plane_throw[self.fault_plane_throw &gt; 0.].size = &quot;</span>
</span><span id="Faults-1211"><a href="#-1211"><span class="linenos">1211</span></a>                            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="Faults-1212"><a href="#-1212"><span class="linenos">1212</span></a>                                <span class="bp">self</span><span class="o">.</span><span class="n">fault_plane_throw</span><span class="p">[</span>
</span><span id="Faults-1213"><a href="#-1213"><span class="linenos">1213</span></a>                                    <span class="bp">self</span><span class="o">.</span><span class="n">fault_plane_throw</span> <span class="o">&gt;</span> <span class="mf">0.0</span>
</span><span id="Faults-1214"><a href="#-1214"><span class="linenos">1214</span></a>                                <span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="Faults-1215"><a href="#-1215"><span class="linenos">1215</span></a>                            <span class="p">)</span>
</span><span id="Faults-1216"><a href="#-1216"><span class="linenos">1216</span></a>                        <span class="p">)</span>
</span><span id="Faults-1217"><a href="#-1217"><span class="linenos">1217</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">fault_plane_azimuth</span><span class="p">[</span><span class="n">fault_segm</span> <span class="o">&gt;</span> <span class="mf">0.9</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="Faults-1218"><a href="#-1218"><span class="linenos">1218</span></a>                        <span class="n">strike_angle</span><span class="p">[</span><span class="n">fault_segm</span> <span class="o">&gt;</span> <span class="mf">0.9</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1.0</span>
</span><span id="Faults-1219"><a href="#-1219"><span class="linenos">1219</span></a>                    <span class="p">)</span>
</span><span id="Faults-1220"><a href="#-1220"><span class="linenos">1220</span></a>
</span><span id="Faults-1221"><a href="#-1221"><span class="linenos">1221</span></a>                    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="Faults-1222"><a href="#-1222"><span class="linenos">1222</span></a>                        <span class="nb">print</span><span class="p">(</span>
</span><span id="Faults-1223"><a href="#-1223"><span class="linenos">1223</span></a>                            <span class="s2">&quot;          .... (after) _faulted_depths.mean() = &quot;</span>
</span><span id="Faults-1224"><a href="#-1224"><span class="linenos">1224</span></a>                            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">_faulted_depths</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
</span><span id="Faults-1225"><a href="#-1225"><span class="linenos">1225</span></a>                        <span class="p">)</span>
</span><span id="Faults-1226"><a href="#-1226"><span class="linenos">1226</span></a>
</span><span id="Faults-1227"><a href="#-1227"><span class="linenos">1227</span></a>                    <span class="c1"># fix interpolated values in max_fault_throw</span>
</span><span id="Faults-1228"><a href="#-1228"><span class="linenos">1228</span></a>                    <span class="n">max_fault_throw_list</span><span class="p">,</span> <span class="n">max_fault_throw_list_counts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span>
</span><span id="Faults-1229"><a href="#-1229"><span class="linenos">1229</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">max_fault_throw</span><span class="p">,</span> <span class="n">return_counts</span><span class="o">=</span><span class="kc">True</span>
</span><span id="Faults-1230"><a href="#-1230"><span class="linenos">1230</span></a>                    <span class="p">)</span>
</span><span id="Faults-1231"><a href="#-1231"><span class="linenos">1231</span></a>                    <span class="n">max_fault_throw_list</span> <span class="o">=</span> <span class="n">max_fault_throw_list</span><span class="p">[</span>
</span><span id="Faults-1232"><a href="#-1232"><span class="linenos">1232</span></a>                        <span class="n">max_fault_throw_list_counts</span> <span class="o">&gt;</span> <span class="mi">500</span>
</span><span id="Faults-1233"><a href="#-1233"><span class="linenos">1233</span></a>                    <span class="p">]</span>
</span><span id="Faults-1234"><a href="#-1234"><span class="linenos">1234</span></a>                    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="Faults-1235"><a href="#-1235"><span class="linenos">1235</span></a>                        <span class="nb">print</span><span class="p">(</span>
</span><span id="Faults-1236"><a href="#-1236"><span class="linenos">1236</span></a>                            <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">   ...max_fault_throw_list = &quot;</span>
</span><span id="Faults-1237"><a href="#-1237"><span class="linenos">1237</span></a>                            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">max_fault_throw_list</span><span class="p">)</span>
</span><span id="Faults-1238"><a href="#-1238"><span class="linenos">1238</span></a>                            <span class="o">+</span> <span class="s2">&quot;, &quot;</span>
</span><span id="Faults-1239"><a href="#-1239"><span class="linenos">1239</span></a>                            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">max_fault_throw_list_counts</span><span class="p">)</span>
</span><span id="Faults-1240"><a href="#-1240"><span class="linenos">1240</span></a>                        <span class="p">)</span>
</span><span id="Faults-1241"><a href="#-1241"><span class="linenos">1241</span></a>                    <span class="n">mfts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_fault_throw</span><span class="o">.</span><span class="n">shape</span>
</span><span id="Faults-1242"><a href="#-1242"><span class="linenos">1242</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_remove_node_list</span><span class="p">(</span><span class="s2">&quot;max_fault_throw_4d_diff&quot;</span><span class="p">)</span>
</span><span id="Faults-1243"><a href="#-1243"><span class="linenos">1243</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_remove_node_list</span><span class="p">(</span><span class="s2">&quot;max_fault_throw_4d&quot;</span><span class="p">)</span>
</span><span id="Faults-1244"><a href="#-1244"><span class="linenos">1244</span></a>                    <span class="n">max_fault_throw_4d_diff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="Faults-1245"><a href="#-1245"><span class="linenos">1245</span></a>                        <span class="s2">&quot;max_fault_throw_4d_diff&quot;</span><span class="p">,</span>
</span><span id="Faults-1246"><a href="#-1246"><span class="linenos">1246</span></a>                        <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">mfts</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">mfts</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">mfts</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">max_fault_throw_list</span><span class="o">.</span><span class="n">size</span><span class="p">),</span>
</span><span id="Faults-1247"><a href="#-1247"><span class="linenos">1247</span></a>                    <span class="p">)</span>
</span><span id="Faults-1248"><a href="#-1248"><span class="linenos">1248</span></a>                    <span class="n">max_fault_throw_4d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="Faults-1249"><a href="#-1249"><span class="linenos">1249</span></a>                        <span class="s2">&quot;max_fault_throw_4d&quot;</span><span class="p">,</span>
</span><span id="Faults-1250"><a href="#-1250"><span class="linenos">1250</span></a>                        <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">mfts</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">mfts</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">mfts</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">max_fault_throw_list</span><span class="o">.</span><span class="n">size</span><span class="p">),</span>
</span><span id="Faults-1251"><a href="#-1251"><span class="linenos">1251</span></a>                    <span class="p">)</span>
</span><span id="Faults-1252"><a href="#-1252"><span class="linenos">1252</span></a>                    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="Faults-1253"><a href="#-1253"><span class="linenos">1253</span></a>                        <span class="nb">print</span><span class="p">(</span>
</span><span id="Faults-1254"><a href="#-1254"><span class="linenos">1254</span></a>                            <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">   ...max_fault_throw_4d.shape = &quot;</span>
</span><span id="Faults-1255"><a href="#-1255"><span class="linenos">1255</span></a>                            <span class="o">+</span> <span class="s2">&quot;, &quot;</span>
</span><span id="Faults-1256"><a href="#-1256"><span class="linenos">1256</span></a>                            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">max_fault_throw_4d</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span><span id="Faults-1257"><a href="#-1257"><span class="linenos">1257</span></a>                        <span class="p">)</span>
</span><span id="Faults-1258"><a href="#-1258"><span class="linenos">1258</span></a>                    <span class="n">_max_fault_throw_4d_diff</span> <span class="o">=</span> <span class="n">max_fault_throw_4d_diff</span><span class="p">[:]</span>
</span><span id="Faults-1259"><a href="#-1259"><span class="linenos">1259</span></a>                    <span class="n">_max_fault_throw_4d</span> <span class="o">=</span> <span class="n">max_fault_throw_4d</span><span class="p">[:]</span>
</span><span id="Faults-1260"><a href="#-1260"><span class="linenos">1260</span></a>                    <span class="k">for</span> <span class="n">imft</span><span class="p">,</span> <span class="n">mft</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">max_fault_throw_list</span><span class="p">):</span>
</span><span id="Faults-1261"><a href="#-1261"><span class="linenos">1261</span></a>                        <span class="nb">print</span><span class="p">(</span>
</span><span id="Faults-1262"><a href="#-1262"><span class="linenos">1262</span></a>                            <span class="s2">&quot;      ... imft, mft, max_fault_throw_4d_diff[:,:,:,imft].shape = &quot;</span>
</span><span id="Faults-1263"><a href="#-1263"><span class="linenos">1263</span></a>                            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="Faults-1264"><a href="#-1264"><span class="linenos">1264</span></a>                                <span class="p">(</span>
</span><span id="Faults-1265"><a href="#-1265"><span class="linenos">1265</span></a>                                    <span class="n">imft</span><span class="p">,</span>
</span><span id="Faults-1266"><a href="#-1266"><span class="linenos">1266</span></a>                                    <span class="n">mft</span><span class="p">,</span>
</span><span id="Faults-1267"><a href="#-1267"><span class="linenos">1267</span></a>                                    <span class="n">max_fault_throw_4d_diff</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="n">imft</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
</span><span id="Faults-1268"><a href="#-1268"><span class="linenos">1268</span></a>                                <span class="p">)</span>
</span><span id="Faults-1269"><a href="#-1269"><span class="linenos">1269</span></a>                            <span class="p">)</span>
</span><span id="Faults-1270"><a href="#-1270"><span class="linenos">1270</span></a>                        <span class="p">)</span>
</span><span id="Faults-1271"><a href="#-1271"><span class="linenos">1271</span></a>                        <span class="n">_max_fault_throw_4d_diff</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="n">imft</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span>
</span><span id="Faults-1272"><a href="#-1272"><span class="linenos">1272</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">max_fault_throw</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">-</span> <span class="n">mft</span>
</span><span id="Faults-1273"><a href="#-1273"><span class="linenos">1273</span></a>                        <span class="p">)</span>
</span><span id="Faults-1274"><a href="#-1274"><span class="linenos">1274</span></a>                        <span class="n">_max_fault_throw_4d</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="n">imft</span><span class="p">]</span> <span class="o">=</span> <span class="n">mft</span>
</span><span id="Faults-1275"><a href="#-1275"><span class="linenos">1275</span></a>                    <span class="n">max_fault_throw_4d</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">_max_fault_throw_4d</span>
</span><span id="Faults-1276"><a href="#-1276"><span class="linenos">1276</span></a>                    <span class="n">max_fault_throw_4d_diff</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">_max_fault_throw_4d_diff</span>
</span><span id="Faults-1277"><a href="#-1277"><span class="linenos">1277</span></a>                    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="Faults-1278"><a href="#-1278"><span class="linenos">1278</span></a>                        <span class="nb">print</span><span class="p">(</span>
</span><span id="Faults-1279"><a href="#-1279"><span class="linenos">1279</span></a>                            <span class="s2">&quot;   ...np.argmin(max_fault_throw_4d_diff, axis=-1).shape = &quot;</span>
</span><span id="Faults-1280"><a href="#-1280"><span class="linenos">1280</span></a>                            <span class="o">+</span> <span class="s2">&quot;, &quot;</span>
</span><span id="Faults-1281"><a href="#-1281"><span class="linenos">1281</span></a>                            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">max_fault_throw_4d_diff</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span><span id="Faults-1282"><a href="#-1282"><span class="linenos">1282</span></a>                        <span class="p">)</span>
</span><span id="Faults-1283"><a href="#-1283"><span class="linenos">1283</span></a>                    <span class="n">indices_nearest_throw</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">max_fault_throw_4d_diff</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="Faults-1284"><a href="#-1284"><span class="linenos">1284</span></a>                    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="Faults-1285"><a href="#-1285"><span class="linenos">1285</span></a>                        <span class="nb">print</span><span class="p">(</span>
</span><span id="Faults-1286"><a href="#-1286"><span class="linenos">1286</span></a>                            <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">   ...indices_nearest_throw.shape = &quot;</span>
</span><span id="Faults-1287"><a href="#-1287"><span class="linenos">1287</span></a>                            <span class="o">+</span> <span class="s2">&quot;, &quot;</span>
</span><span id="Faults-1288"><a href="#-1288"><span class="linenos">1288</span></a>                            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">indices_nearest_throw</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span><span id="Faults-1289"><a href="#-1289"><span class="linenos">1289</span></a>                        <span class="p">)</span>
</span><span id="Faults-1290"><a href="#-1290"><span class="linenos">1290</span></a>                    <span class="n">_max_fault_throw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_fault_throw</span><span class="p">[:]</span>
</span><span id="Faults-1291"><a href="#-1291"><span class="linenos">1291</span></a>                    <span class="k">for</span> <span class="n">imft</span><span class="p">,</span> <span class="n">mft</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">max_fault_throw_list</span><span class="p">):</span>
</span><span id="Faults-1292"><a href="#-1292"><span class="linenos">1292</span></a>                        <span class="n">_max_fault_throw</span><span class="p">[</span><span class="n">indices_nearest_throw</span> <span class="o">==</span> <span class="n">imft</span><span class="p">]</span> <span class="o">=</span> <span class="n">mft</span>
</span><span id="Faults-1293"><a href="#-1293"><span class="linenos">1293</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">max_fault_throw</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">_max_fault_throw</span>
</span><span id="Faults-1294"><a href="#-1294"><span class="linenos">1294</span></a>
</span><span id="Faults-1295"><a href="#-1295"><span class="linenos">1295</span></a>                    <span class="k">del</span> <span class="n">_max_fault_throw</span>
</span><span id="Faults-1296"><a href="#-1296"><span class="linenos">1296</span></a>                    <span class="k">del</span> <span class="n">adjusted_faulted_depths</span>
</span><span id="Faults-1297"><a href="#-1297"><span class="linenos">1297</span></a>
</span><span id="Faults-1298"><a href="#-1298"><span class="linenos">1298</span></a>                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="Faults-1299"><a href="#-1299"><span class="linenos">1299</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="Faults-1300"><a href="#-1300"><span class="linenos">1300</span></a>                        <span class="s2">&quot;   ...fault_segm[fault_segm&gt;0.].size = &quot;</span>
</span><span id="Faults-1301"><a href="#-1301"><span class="linenos">1301</span></a>                        <span class="o">+</span> <span class="s2">&quot;, &quot;</span>
</span><span id="Faults-1302"><a href="#-1302"><span class="linenos">1302</span></a>                        <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">fault_segm</span><span class="p">[</span><span class="n">fault_segm</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
</span><span id="Faults-1303"><a href="#-1303"><span class="linenos">1303</span></a>                    <span class="p">)</span>
</span><span id="Faults-1304"><a href="#-1304"><span class="linenos">1304</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   ...fault_segm.min() = &quot;</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">fault_segm</span><span class="o">.</span><span class="n">min</span><span class="p">()))</span>
</span><span id="Faults-1305"><a href="#-1305"><span class="linenos">1305</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   ...fault_segm.max() = &quot;</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">fault_segm</span><span class="o">.</span><span class="n">max</span><span class="p">()))</span>
</span><span id="Faults-1306"><a href="#-1306"><span class="linenos">1306</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="Faults-1307"><a href="#-1307"><span class="linenos">1307</span></a>                        <span class="s2">&quot;   ...self.fault_planes.max() = &quot;</span>
</span><span id="Faults-1308"><a href="#-1308"><span class="linenos">1308</span></a>                        <span class="o">+</span> <span class="s2">&quot;, &quot;</span>
</span><span id="Faults-1309"><a href="#-1309"><span class="linenos">1309</span></a>                        <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fault_planes</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
</span><span id="Faults-1310"><a href="#-1310"><span class="linenos">1310</span></a>                    <span class="p">)</span>
</span><span id="Faults-1311"><a href="#-1311"><span class="linenos">1311</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="Faults-1312"><a href="#-1312"><span class="linenos">1312</span></a>                        <span class="s2">&quot;   ...self.fault_intersections.max() = &quot;</span>
</span><span id="Faults-1313"><a href="#-1313"><span class="linenos">1313</span></a>                        <span class="o">+</span> <span class="s2">&quot;, &quot;</span>
</span><span id="Faults-1314"><a href="#-1314"><span class="linenos">1314</span></a>                        <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fault_intersections</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
</span><span id="Faults-1315"><a href="#-1315"><span class="linenos">1315</span></a>                    <span class="p">)</span>
</span><span id="Faults-1316"><a href="#-1316"><span class="linenos">1316</span></a>
</span><span id="Faults-1317"><a href="#-1317"><span class="linenos">1317</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="Faults-1318"><a href="#-1318"><span class="linenos">1318</span></a>                        <span class="s2">&quot;   ...list of unique values in self.max_fault_throw = &quot;</span>
</span><span id="Faults-1319"><a href="#-1319"><span class="linenos">1319</span></a>                        <span class="o">+</span> <span class="s2">&quot;, &quot;</span>
</span><span id="Faults-1320"><a href="#-1320"><span class="linenos">1320</span></a>                        <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_fault_throw</span><span class="p">))</span>
</span><span id="Faults-1321"><a href="#-1321"><span class="linenos">1321</span></a>                    <span class="p">)</span>
</span><span id="Faults-1322"><a href="#-1322"><span class="linenos">1322</span></a>
</span><span id="Faults-1323"><a href="#-1323"><span class="linenos">1323</span></a>                <span class="c1"># TODO: remove this block after qc/tests complete</span>
</span><span id="Faults-1324"><a href="#-1324"><span class="linenos">1324</span></a>                <span class="kn">from</span> <span class="nn">datagenerator.util</span> <span class="kn">import</span> <span class="n">import_matplotlib</span>
</span><span id="Faults-1325"><a href="#-1325"><span class="linenos">1325</span></a>                <span class="n">plt</span> <span class="o">=</span> <span class="n">import_matplotlib</span><span class="p">()</span>
</span><span id="Faults-1326"><a href="#-1326"><span class="linenos">1326</span></a>
</span><span id="Faults-1327"><a href="#-1327"><span class="linenos">1327</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="mi">35</span><span class="p">)</span>
</span><span id="Faults-1328"><a href="#-1328"><span class="linenos">1328</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">35</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
</span><span id="Faults-1329"><a href="#-1329"><span class="linenos">1329</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
</span><span id="Faults-1330"><a href="#-1330"><span class="linenos">1330</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">_faulted_depths</span><span class="p">[</span><span class="n">inline</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;prism&quot;</span><span class="p">)</span>
</span><span id="Faults-1331"><a href="#-1331"><span class="linenos">1331</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</span><span id="Faults-1332"><a href="#-1332"><span class="linenos">1332</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span>
</span><span id="Faults-1333"><a href="#-1333"><span class="linenos">1333</span></a>                    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="Faults-1334"><a href="#-1334"><span class="linenos">1334</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">work_subfolder</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;faulted_depths_</span><span class="si">{</span><span class="n">ifault</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">.png&quot;</span>
</span><span id="Faults-1335"><a href="#-1335"><span class="linenos">1335</span></a>                    <span class="p">),</span>
</span><span id="Faults-1336"><a href="#-1336"><span class="linenos">1336</span></a>                    <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;png&quot;</span><span class="p">,</span>
</span><span id="Faults-1337"><a href="#-1337"><span class="linenos">1337</span></a>                <span class="p">)</span>
</span><span id="Faults-1338"><a href="#-1338"><span class="linenos">1338</span></a>
</span><span id="Faults-1339"><a href="#-1339"><span class="linenos">1339</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="mi">35</span><span class="p">)</span>
</span><span id="Faults-1340"><a href="#-1340"><span class="linenos">1340</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">36</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
</span><span id="Faults-1341"><a href="#-1341"><span class="linenos">1341</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
</span><span id="Faults-1342"><a href="#-1342"><span class="linenos">1342</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">displacement</span><span class="p">[</span><span class="n">inline</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;jet&quot;</span><span class="p">)</span>
</span><span id="Faults-1343"><a href="#-1343"><span class="linenos">1343</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</span><span id="Faults-1344"><a href="#-1344"><span class="linenos">1344</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span>
</span><span id="Faults-1345"><a href="#-1345"><span class="linenos">1345</span></a>                    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="Faults-1346"><a href="#-1346"><span class="linenos">1346</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">work_subfolder</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;displacement_</span><span class="si">{</span><span class="n">ifault</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">.png&quot;</span>
</span><span id="Faults-1347"><a href="#-1347"><span class="linenos">1347</span></a>                    <span class="p">),</span>
</span><span id="Faults-1348"><a href="#-1348"><span class="linenos">1348</span></a>                    <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;png&quot;</span><span class="p">,</span>
</span><span id="Faults-1349"><a href="#-1349"><span class="linenos">1349</span></a>                <span class="p">)</span>
</span><span id="Faults-1350"><a href="#-1350"><span class="linenos">1350</span></a>
</span><span id="Faults-1351"><a href="#-1351"><span class="linenos">1351</span></a>                <span class="c1"># TODO: remove this block after qc/tests complete</span>
</span><span id="Faults-1352"><a href="#-1352"><span class="linenos">1352</span></a>                <span class="n">_plotarray</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fault_planes</span><span class="p">[</span><span class="n">inline</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Faults-1353"><a href="#-1353"><span class="linenos">1353</span></a>                <span class="n">_plotarray</span><span class="p">[</span><span class="n">_plotarray</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
</span><span id="Faults-1354"><a href="#-1354"><span class="linenos">1354</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="mi">37</span><span class="p">)</span>
</span><span id="Faults-1355"><a href="#-1355"><span class="linenos">1355</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">37</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
</span><span id="Faults-1356"><a href="#-1356"><span class="linenos">1356</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
</span><span id="Faults-1357"><a href="#-1357"><span class="linenos">1357</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">_plotarray</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;gist_ncar&quot;</span><span class="p">)</span>
</span><span id="Faults-1358"><a href="#-1358"><span class="linenos">1358</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</span><span id="Faults-1359"><a href="#-1359"><span class="linenos">1359</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span>
</span><span id="Faults-1360"><a href="#-1360"><span class="linenos">1360</span></a>                    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">work_subfolder</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;fault_</span><span class="si">{</span><span class="n">ifault</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">.png&quot;</span><span class="p">),</span>
</span><span id="Faults-1361"><a href="#-1361"><span class="linenos">1361</span></a>                    <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;png&quot;</span><span class="p">,</span>
</span><span id="Faults-1362"><a href="#-1362"><span class="linenos">1362</span></a>                <span class="p">)</span>
</span><span id="Faults-1363"><a href="#-1363"><span class="linenos">1363</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="mi">37</span><span class="p">)</span>
</span><span id="Faults-1364"><a href="#-1364"><span class="linenos">1364</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">36</span><span class="p">)</span>
</span><span id="Faults-1365"><a href="#-1365"><span class="linenos">1365</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">_plotarray</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
</span><span id="Faults-1366"><a href="#-1366"><span class="linenos">1366</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</span><span id="Faults-1367"><a href="#-1367"><span class="linenos">1367</span></a>
</span><span id="Faults-1368"><a href="#-1368"><span class="linenos">1368</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span>
</span><span id="Faults-1369"><a href="#-1369"><span class="linenos">1369</span></a>                    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="Faults-1370"><a href="#-1370"><span class="linenos">1370</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">work_subfolder</span><span class="p">,</span>
</span><span id="Faults-1371"><a href="#-1371"><span class="linenos">1371</span></a>                        <span class="sa">f</span><span class="s2">&quot;displacement_fault_overlay_</span><span class="si">{</span><span class="n">ifault</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">.png&quot;</span><span class="p">,</span>
</span><span id="Faults-1372"><a href="#-1372"><span class="linenos">1372</span></a>                    <span class="p">),</span>
</span><span id="Faults-1373"><a href="#-1373"><span class="linenos">1373</span></a>                    <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;png&quot;</span><span class="p">,</span>
</span><span id="Faults-1374"><a href="#-1374"><span class="linenos">1374</span></a>                <span class="p">)</span>
</span><span id="Faults-1375"><a href="#-1375"><span class="linenos">1375</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="mi">36</span><span class="p">)</span>
</span><span id="Faults-1376"><a href="#-1376"><span class="linenos">1376</span></a>
</span><span id="Faults-1377"><a href="#-1377"><span class="linenos">1377</span></a>                <span class="n">hockey_sticks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hockey_stick</span><span class="p">)</span>
</span><span id="Faults-1378"><a href="#-1378"><span class="linenos">1378</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   ...hockey_sticks = &quot;</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">hockey_sticks</span><span class="p">))</span>
</span><span id="Faults-1379"><a href="#-1379"><span class="linenos">1379</span></a>
</span><span id="Faults-1380"><a href="#-1380"><span class="linenos">1380</span></a>        <span class="c1"># print final count</span>
</span><span id="Faults-1381"><a href="#-1381"><span class="linenos">1381</span></a>        <span class="n">max_fault_throw_list</span><span class="p">,</span> <span class="n">max_fault_throw_list_counts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span>
</span><span id="Faults-1382"><a href="#-1382"><span class="linenos">1382</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">max_fault_throw</span><span class="p">,</span> <span class="n">return_counts</span><span class="o">=</span><span class="kc">True</span>
</span><span id="Faults-1383"><a href="#-1383"><span class="linenos">1383</span></a>        <span class="p">)</span>
</span><span id="Faults-1384"><a href="#-1384"><span class="linenos">1384</span></a>        <span class="n">max_fault_throw_list</span> <span class="o">=</span> <span class="n">max_fault_throw_list</span><span class="p">[</span><span class="n">max_fault_throw_list_counts</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">]</span>
</span><span id="Faults-1385"><a href="#-1385"><span class="linenos">1385</span></a>        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="Faults-1386"><a href="#-1386"><span class="linenos">1386</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="Faults-1387"><a href="#-1387"><span class="linenos">1387</span></a>                <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">   ... ** final ** max_fault_throw_list = &quot;</span>
</span><span id="Faults-1388"><a href="#-1388"><span class="linenos">1388</span></a>                <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">max_fault_throw_list</span><span class="p">)</span>
</span><span id="Faults-1389"><a href="#-1389"><span class="linenos">1389</span></a>                <span class="o">+</span> <span class="s2">&quot;, &quot;</span>
</span><span id="Faults-1390"><a href="#-1390"><span class="linenos">1390</span></a>                <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">max_fault_throw_list_counts</span><span class="p">)</span>
</span><span id="Faults-1391"><a href="#-1391"><span class="linenos">1391</span></a>            <span class="p">)</span>
</span><span id="Faults-1392"><a href="#-1392"><span class="linenos">1392</span></a>
</span><span id="Faults-1393"><a href="#-1393"><span class="linenos">1393</span></a>        <span class="c1"># create fault intersections</span>
</span><span id="Faults-1394"><a href="#-1394"><span class="linenos">1394</span></a>        <span class="n">_fault_intersections</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fault_planes</span><span class="p">[:]</span> <span class="o">*</span> <span class="mf">1.0</span>
</span><span id="Faults-1395"><a href="#-1395"><span class="linenos">1395</span></a>        <span class="c1"># self.fault_intersections = self.fault_planes * 1.</span>
</span><span id="Faults-1396"><a href="#-1396"><span class="linenos">1396</span></a>        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="Faults-1397"><a href="#-1397"><span class="linenos">1397</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  ... line 592:&quot;</span><span class="p">)</span>
</span><span id="Faults-1398"><a href="#-1398"><span class="linenos">1398</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="Faults-1399"><a href="#-1399"><span class="linenos">1399</span></a>                <span class="s2">&quot;   ...self.fault_intersections.max() = &quot;</span>
</span><span id="Faults-1400"><a href="#-1400"><span class="linenos">1400</span></a>                <span class="o">+</span> <span class="s2">&quot;, &quot;</span>
</span><span id="Faults-1401"><a href="#-1401"><span class="linenos">1401</span></a>                <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">_fault_intersections</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
</span><span id="Faults-1402"><a href="#-1402"><span class="linenos">1402</span></a>            <span class="p">)</span>
</span><span id="Faults-1403"><a href="#-1403"><span class="linenos">1403</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="Faults-1404"><a href="#-1404"><span class="linenos">1404</span></a>                <span class="s2">&quot;   ...self.fault_intersections[self.fault_intersections&gt;0.].size = &quot;</span>
</span><span id="Faults-1405"><a href="#-1405"><span class="linenos">1405</span></a>                <span class="o">+</span> <span class="s2">&quot;, &quot;</span>
</span><span id="Faults-1406"><a href="#-1406"><span class="linenos">1406</span></a>                <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">_fault_intersections</span><span class="p">[</span><span class="n">_fault_intersections</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
</span><span id="Faults-1407"><a href="#-1407"><span class="linenos">1407</span></a>            <span class="p">)</span>
</span><span id="Faults-1408"><a href="#-1408"><span class="linenos">1408</span></a>
</span><span id="Faults-1409"><a href="#-1409"><span class="linenos">1409</span></a>        <span class="n">_fault_intersections</span><span class="p">[</span><span class="n">_fault_intersections</span> <span class="o">&lt;=</span> <span class="mf">1.0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="Faults-1410"><a href="#-1410"><span class="linenos">1410</span></a>        <span class="n">_fault_intersections</span><span class="p">[</span><span class="n">_fault_intersections</span> <span class="o">&gt;</span> <span class="mf">1.1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="Faults-1411"><a href="#-1411"><span class="linenos">1411</span></a>        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="Faults-1412"><a href="#-1412"><span class="linenos">1412</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  ... line 597:&quot;</span><span class="p">)</span>
</span><span id="Faults-1413"><a href="#-1413"><span class="linenos">1413</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="Faults-1414"><a href="#-1414"><span class="linenos">1414</span></a>                <span class="s2">&quot;   ...self.fault_intersections.max() = &quot;</span>
</span><span id="Faults-1415"><a href="#-1415"><span class="linenos">1415</span></a>                <span class="o">+</span> <span class="s2">&quot;, &quot;</span>
</span><span id="Faults-1416"><a href="#-1416"><span class="linenos">1416</span></a>                <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">_fault_intersections</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
</span><span id="Faults-1417"><a href="#-1417"><span class="linenos">1417</span></a>            <span class="p">)</span>
</span><span id="Faults-1418"><a href="#-1418"><span class="linenos">1418</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="Faults-1419"><a href="#-1419"><span class="linenos">1419</span></a>                <span class="s2">&quot;   ...self.fault_intersections[self.fault_intersections&gt;0.].size = &quot;</span>
</span><span id="Faults-1420"><a href="#-1420"><span class="linenos">1420</span></a>                <span class="o">+</span> <span class="s2">&quot;, &quot;</span>
</span><span id="Faults-1421"><a href="#-1421"><span class="linenos">1421</span></a>                <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">_fault_intersections</span><span class="p">[</span><span class="n">_fault_intersections</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
</span><span id="Faults-1422"><a href="#-1422"><span class="linenos">1422</span></a>            <span class="p">)</span>
</span><span id="Faults-1423"><a href="#-1423"><span class="linenos">1423</span></a>
</span><span id="Faults-1424"><a href="#-1424"><span class="linenos">1424</span></a>        <span class="c1"># make 2nd count of number of intersections between faults. write result to logfile.</span>
</span><span id="Faults-1425"><a href="#-1425"><span class="linenos">1425</span></a>        <span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
</span><span id="Faults-1426"><a href="#-1426"><span class="linenos">1426</span></a>
</span><span id="Faults-1427"><a href="#-1427"><span class="linenos">1427</span></a>        <span class="n">start_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
</span><span id="Faults-1428"><a href="#-1428"><span class="linenos">1428</span></a>        <span class="n">number_fault_intersections</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span>
</span><span id="Faults-1429"><a href="#-1429"><span class="linenos">1429</span></a>            <span class="n">number_fault_intersections</span><span class="p">,</span>
</span><span id="Faults-1430"><a href="#-1430"><span class="linenos">1430</span></a>            <span class="n">measure</span><span class="o">.</span><span class="n">label</span><span class="p">(</span><span class="n">_fault_intersections</span><span class="p">,</span> <span class="n">background</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span>
</span><span id="Faults-1431"><a href="#-1431"><span class="linenos">1431</span></a>        <span class="p">)</span>
</span><span id="Faults-1432"><a href="#-1432"><span class="linenos">1432</span></a>        <span class="nb">print</span><span class="p">(</span>
</span><span id="Faults-1433"><a href="#-1433"><span class="linenos">1433</span></a>            <span class="sa">f</span><span class="s2">&quot;   ... elapsed time for skimage.label = </span><span class="si">{</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Faults-1434"><a href="#-1434"><span class="linenos">1434</span></a>        <span class="p">)</span>
</span><span id="Faults-1435"><a href="#-1435"><span class="linenos">1435</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   ... number_fault_intersections = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">number_fault_intersections</span><span class="p">))</span>
</span><span id="Faults-1436"><a href="#-1436"><span class="linenos">1436</span></a>
</span><span id="Faults-1437"><a href="#-1437"><span class="linenos">1437</span></a>        <span class="c1"># dilate intersection values</span>
</span><span id="Faults-1438"><a href="#-1438"><span class="linenos">1438</span></a>        <span class="c1"># - window size of (5,5,15) is arbitrary. Should be based on isolating sections</span>
</span><span id="Faults-1439"><a href="#-1439"><span class="linenos">1439</span></a>        <span class="c1">#   of fault planes on real seismic</span>
</span><span id="Faults-1440"><a href="#-1440"><span class="linenos">1440</span></a>        <span class="n">_fault_intersections</span> <span class="o">=</span> <span class="n">maximum_filter</span><span class="p">(</span><span class="n">_fault_intersections</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">17</span><span class="p">))</span>
</span><span id="Faults-1441"><a href="#-1441"><span class="linenos">1441</span></a>
</span><span id="Faults-1442"><a href="#-1442"><span class="linenos">1442</span></a>        <span class="c1"># Fault intersection segments &gt; 1 at intersecting faults. Clip to 1</span>
</span><span id="Faults-1443"><a href="#-1443"><span class="linenos">1443</span></a>        <span class="n">_fault_intersections</span><span class="p">[</span><span class="n">_fault_intersections</span> <span class="o">&gt;</span> <span class="mf">0.05</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="Faults-1444"><a href="#-1444"><span class="linenos">1444</span></a>        <span class="n">_fault_intersections</span><span class="p">[</span><span class="n">_fault_intersections</span> <span class="o">!=</span> <span class="mf">1.0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="Faults-1445"><a href="#-1445"><span class="linenos">1445</span></a>        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="Faults-1446"><a href="#-1446"><span class="linenos">1446</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  ... line 607:&quot;</span><span class="p">)</span>
</span><span id="Faults-1447"><a href="#-1447"><span class="linenos">1447</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="Faults-1448"><a href="#-1448"><span class="linenos">1448</span></a>                <span class="s2">&quot;   ...self.fault_intersections.max() = &quot;</span>
</span><span id="Faults-1449"><a href="#-1449"><span class="linenos">1449</span></a>                <span class="o">+</span> <span class="s2">&quot;, &quot;</span>
</span><span id="Faults-1450"><a href="#-1450"><span class="linenos">1450</span></a>                <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">_fault_intersections</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
</span><span id="Faults-1451"><a href="#-1451"><span class="linenos">1451</span></a>            <span class="p">)</span>
</span><span id="Faults-1452"><a href="#-1452"><span class="linenos">1452</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="Faults-1453"><a href="#-1453"><span class="linenos">1453</span></a>                <span class="s2">&quot;   ...self.fault_intersections[self.fault_intersections&gt;0.].size = &quot;</span>
</span><span id="Faults-1454"><a href="#-1454"><span class="linenos">1454</span></a>                <span class="o">+</span> <span class="s2">&quot;, &quot;</span>
</span><span id="Faults-1455"><a href="#-1455"><span class="linenos">1455</span></a>                <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">_fault_intersections</span><span class="p">[</span><span class="n">_fault_intersections</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
</span><span id="Faults-1456"><a href="#-1456"><span class="linenos">1456</span></a>            <span class="p">)</span>
</span><span id="Faults-1457"><a href="#-1457"><span class="linenos">1457</span></a>
</span><span id="Faults-1458"><a href="#-1458"><span class="linenos">1458</span></a>        <span class="c1"># Fault segments = 1 at fault &gt; 1 at intersections. Clip intersecting fault voxels to 1</span>
</span><span id="Faults-1459"><a href="#-1459"><span class="linenos">1459</span></a>        <span class="n">_fault_planes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fault_planes</span><span class="p">[:]</span>
</span><span id="Faults-1460"><a href="#-1460"><span class="linenos">1460</span></a>        <span class="n">_fault_planes</span><span class="p">[</span><span class="n">_fault_planes</span> <span class="o">&gt;</span> <span class="mf">0.05</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="Faults-1461"><a href="#-1461"><span class="linenos">1461</span></a>        <span class="n">_fault_planes</span><span class="p">[</span><span class="n">_fault_planes</span> <span class="o">!=</span> <span class="mf">1.0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="Faults-1462"><a href="#-1462"><span class="linenos">1462</span></a>
</span><span id="Faults-1463"><a href="#-1463"><span class="linenos">1463</span></a>        <span class="c1"># make fault azi 3D and only retain voxels in fault plane</span>
</span><span id="Faults-1464"><a href="#-1464"><span class="linenos">1464</span></a>
</span><span id="Faults-1465"><a href="#-1465"><span class="linenos">1465</span></a>        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
</span><span id="Faults-1466"><a href="#-1466"><span class="linenos">1466</span></a>            <span class="p">[</span>
</span><span id="Faults-1467"><a href="#-1467"><span class="linenos">1467</span></a>                <span class="s2">&quot;n_voxels_faults&quot;</span><span class="p">,</span>
</span><span id="Faults-1468"><a href="#-1468"><span class="linenos">1468</span></a>                <span class="s2">&quot;n_voxels_fault_intersections&quot;</span><span class="p">,</span>
</span><span id="Faults-1469"><a href="#-1469"><span class="linenos">1469</span></a>                <span class="s2">&quot;number_fault_intersections&quot;</span><span class="p">,</span>
</span><span id="Faults-1470"><a href="#-1470"><span class="linenos">1470</span></a>                <span class="s2">&quot;fault_voxel_count_list&quot;</span><span class="p">,</span>
</span><span id="Faults-1471"><a href="#-1471"><span class="linenos">1471</span></a>                <span class="s2">&quot;hockey_sticks&quot;</span><span class="p">,</span>
</span><span id="Faults-1472"><a href="#-1472"><span class="linenos">1472</span></a>            <span class="p">],</span>
</span><span id="Faults-1473"><a href="#-1473"><span class="linenos">1473</span></a>            <span class="p">[</span>
</span><span id="Faults-1474"><a href="#-1474"><span class="linenos">1474</span></a>                <span class="n">_fault_planes</span><span class="p">[</span><span class="n">_fault_planes</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">,</span>
</span><span id="Faults-1475"><a href="#-1475"><span class="linenos">1475</span></a>                <span class="n">_fault_intersections</span><span class="p">[</span><span class="n">_fault_intersections</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">,</span>
</span><span id="Faults-1476"><a href="#-1476"><span class="linenos">1476</span></a>                <span class="n">number_fault_intersections</span><span class="p">,</span>
</span><span id="Faults-1477"><a href="#-1477"><span class="linenos">1477</span></a>                <span class="n">fault_voxel_count_list</span><span class="p">,</span>
</span><span id="Faults-1478"><a href="#-1478"><span class="linenos">1478</span></a>                <span class="n">hockey_sticks</span><span class="p">,</span>
</span><span id="Faults-1479"><a href="#-1479"><span class="linenos">1479</span></a>            <span class="p">],</span>
</span><span id="Faults-1480"><a href="#-1480"><span class="linenos">1480</span></a>        <span class="p">):</span>
</span><span id="Faults-1481"><a href="#-1481"><span class="linenos">1481</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Faults-1482"><a href="#-1482"><span class="linenos">1482</span></a>
</span><span id="Faults-1483"><a href="#-1483"><span class="linenos">1483</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="Faults-1484"><a href="#-1484"><span class="linenos">1484</span></a>                <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span> <span class="n">subkey</span><span class="o">=</span><span class="n">k</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">v</span>
</span><span id="Faults-1485"><a href="#-1485"><span class="linenos">1485</span></a>            <span class="p">)</span>
</span><span id="Faults-1486"><a href="#-1486"><span class="linenos">1486</span></a>
</span><span id="Faults-1487"><a href="#-1487"><span class="linenos">1487</span></a>        <span class="n">dis_class</span> <span class="o">=</span> <span class="n">_faulted_depths</span> <span class="o">*</span> <span class="mi">1</span>
</span><span id="Faults-1488"><a href="#-1488"><span class="linenos">1488</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fault_intersections</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">_fault_intersections</span>
</span><span id="Faults-1489"><a href="#-1489"><span class="linenos">1489</span></a>        <span class="k">del</span> <span class="n">_fault_intersections</span>
</span><span id="Faults-1490"><a href="#-1490"><span class="linenos">1490</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fault_planes</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">_fault_planes</span>
</span><span id="Faults-1491"><a href="#-1491"><span class="linenos">1491</span></a>        <span class="k">del</span> <span class="n">_fault_planes</span>
</span><span id="Faults-1492"><a href="#-1492"><span class="linenos">1492</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">displacement_vectors</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">_faulted_depths</span> <span class="o">*</span> <span class="mf">1.0</span>
</span><span id="Faults-1493"><a href="#-1493"><span class="linenos">1493</span></a>
</span><span id="Faults-1494"><a href="#-1494"><span class="linenos">1494</span></a>        <span class="c1"># TODO: check if next line of code modifies &#39;displacement&#39; properly</span>
</span><span id="Faults-1495"><a href="#-1495"><span class="linenos">1495</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sum_map_displacements</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">_faulted_depths</span> <span class="o">*</span> <span class="mf">1.0</span>
</span><span id="Faults-1496"><a href="#-1496"><span class="linenos">1496</span></a>
</span><span id="Faults-1497"><a href="#-1497"><span class="linenos">1497</span></a>        <span class="c1"># Save faulted maps</span>
</span><span id="Faults-1498"><a href="#-1498"><span class="linenos">1498</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">faulted_depth_maps</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">depth_maps_faulted_infilled</span>
</span><span id="Faults-1499"><a href="#-1499"><span class="linenos">1499</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">faulted_depth_maps_gaps</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">depth_maps_gaps</span>
</span><span id="Faults-1500"><a href="#-1500"><span class="linenos">1500</span></a>
</span><span id="Faults-1501"><a href="#-1501"><span class="linenos">1501</span></a>        <span class="c1"># perform faulting for fault_segments and fault_intersections</span>
</span><span id="Faults-1502"><a href="#-1502"><span class="linenos">1502</span></a>        <span class="k">return</span> <span class="n">dis_class</span><span class="p">,</span> <span class="n">hockey_sticks</span>
</span><span id="Faults-1503"><a href="#-1503"><span class="linenos">1503</span></a>
</span><span id="Faults-1504"><a href="#-1504"><span class="linenos">1504</span></a>    <span class="k">def</span> <span class="nf">_qc_plot_check_faulted_horizons_match_fault_segments</span><span class="p">(</span>
</span><span id="Faults-1505"><a href="#-1505"><span class="linenos">1505</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">faulted_depth_maps</span><span class="p">,</span> <span class="n">faulted_geologic_age</span>
</span><span id="Faults-1506"><a href="#-1506"><span class="linenos">1506</span></a>    <span class="p">):</span>
</span><span id="Faults-1507"><a href="#-1507"><span class="linenos">1507</span></a>        <span class="sd">&quot;&quot;&quot;_qc_plot_check_faulted_horizons_match_fault_segments _summary_</span>
</span><span id="Faults-1508"><a href="#-1508"><span class="linenos">1508</span></a>
</span><span id="Faults-1509"><a href="#-1509"><span class="linenos">1509</span></a><span class="sd">        Parameters</span>
</span><span id="Faults-1510"><a href="#-1510"><span class="linenos">1510</span></a><span class="sd">        ----------</span>
</span><span id="Faults-1511"><a href="#-1511"><span class="linenos">1511</span></a><span class="sd">        faulted_depth_maps : np.ndarray</span>
</span><span id="Faults-1512"><a href="#-1512"><span class="linenos">1512</span></a><span class="sd">            The faluted depth maps</span>
</span><span id="Faults-1513"><a href="#-1513"><span class="linenos">1513</span></a><span class="sd">        faulted_geologic_age : _type_</span>
</span><span id="Faults-1514"><a href="#-1514"><span class="linenos">1514</span></a><span class="sd">            _description_</span>
</span><span id="Faults-1515"><a href="#-1515"><span class="linenos">1515</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Faults-1516"><a href="#-1516"><span class="linenos">1516</span></a>        <span class="kn">import</span> <span class="nn">os</span>
</span><span id="Faults-1517"><a href="#-1517"><span class="linenos">1517</span></a>        <span class="kn">from</span> <span class="nn">datagenerator.util</span> <span class="kn">import</span> <span class="n">import_matplotlib</span>
</span><span id="Faults-1518"><a href="#-1518"><span class="linenos">1518</span></a>
</span><span id="Faults-1519"><a href="#-1519"><span class="linenos">1519</span></a>        <span class="n">plt</span> <span class="o">=</span> <span class="n">import_matplotlib</span><span class="p">()</span>
</span><span id="Faults-1520"><a href="#-1520"><span class="linenos">1520</span></a>
</span><span id="Faults-1521"><a href="#-1521"><span class="linenos">1521</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
</span><span id="Faults-1522"><a href="#-1522"><span class="linenos">1522</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
</span><span id="Faults-1523"><a href="#-1523"><span class="linenos">1523</span></a>        <span class="n">voxel_count_max</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Faults-1524"><a href="#-1524"><span class="linenos">1524</span></a>        <span class="n">inline</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">//</span> <span class="mi">2</span>
</span><span id="Faults-1525"><a href="#-1525"><span class="linenos">1525</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fault_planes</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">10</span><span class="p">):</span>
</span><span id="Faults-1526"><a href="#-1526"><span class="linenos">1526</span></a>            <span class="n">voxel_count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fault_planes</span><span class="p">[:,</span> <span class="n">i</span><span class="p">,</span> <span class="p">:]</span>
</span><span id="Faults-1527"><a href="#-1527"><span class="linenos">1527</span></a>            <span class="n">voxel_count</span> <span class="o">=</span> <span class="n">voxel_count</span><span class="p">[</span><span class="n">voxel_count</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="Faults-1528"><a href="#-1528"><span class="linenos">1528</span></a>            <span class="k">if</span> <span class="n">voxel_count</span> <span class="o">&gt;</span> <span class="n">voxel_count_max</span><span class="p">:</span>
</span><span id="Faults-1529"><a href="#-1529"><span class="linenos">1529</span></a>                <span class="n">inline</span> <span class="o">=</span> <span class="n">i</span>
</span><span id="Faults-1530"><a href="#-1530"><span class="linenos">1530</span></a>                <span class="n">voxel_count_max</span> <span class="o">=</span> <span class="n">voxel_count</span>
</span><span id="Faults-1531"><a href="#-1531"><span class="linenos">1531</span></a>        <span class="c1"># inline=50</span>
</span><span id="Faults-1532"><a href="#-1532"><span class="linenos">1532</span></a>        <span class="n">plotdata</span> <span class="o">=</span> <span class="p">(</span><span class="n">faulted_geologic_age</span><span class="p">[:,</span> <span class="n">inline</span><span class="p">,</span> <span class="p">:])</span><span class="o">.</span><span class="n">T</span>
</span><span id="Faults-1533"><a href="#-1533"><span class="linenos">1533</span></a>        <span class="n">plotdata_overlay</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fault_planes</span><span class="p">[:,</span> <span class="n">inline</span><span class="p">,</span> <span class="p">:])</span><span class="o">.</span><span class="n">T</span>
</span><span id="Faults-1534"><a href="#-1534"><span class="linenos">1534</span></a>        <span class="n">plotdata</span><span class="p">[</span><span class="n">plotdata_overlay</span> <span class="o">&gt;</span> <span class="mf">0.9</span><span class="p">]</span> <span class="o">=</span> <span class="n">plotdata</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</span><span id="Faults-1535"><a href="#-1535"><span class="linenos">1535</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">plotdata</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;prism&quot;</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">)</span>
</span><span id="Faults-1536"><a href="#-1536"><span class="linenos">1536</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span>
</span><span id="Faults-1537"><a href="#-1537"><span class="linenos">1537</span></a>            <span class="s2">&quot;QC plot: faulted layers with horizons and fault_segments overlain&quot;</span>
</span><span id="Faults-1538"><a href="#-1538"><span class="linenos">1538</span></a>            <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Inline &quot;</span>
</span><span id="Faults-1539"><a href="#-1539"><span class="linenos">1539</span></a>            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">inline</span><span class="p">)</span>
</span><span id="Faults-1540"><a href="#-1540"><span class="linenos">1540</span></a>        <span class="p">)</span>
</span><span id="Faults-1541"><a href="#-1541"><span class="linenos">1541</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
</span><span id="Faults-1542"><a href="#-1542"><span class="linenos">1542</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">faulted_depth_maps</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">10</span><span class="p">):</span>
</span><span id="Faults-1543"><a href="#-1543"><span class="linenos">1543</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
</span><span id="Faults-1544"><a href="#-1544"><span class="linenos">1544</span></a>                <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
</span><span id="Faults-1545"><a href="#-1545"><span class="linenos">1545</span></a>                <span class="n">faulted_depth_maps</span><span class="p">[:,</span> <span class="n">inline</span><span class="p">],</span>
</span><span id="Faults-1546"><a href="#-1546"><span class="linenos">1546</span></a>                <span class="s2">&quot;k-&quot;</span><span class="p">,</span>
</span><span id="Faults-1547"><a href="#-1547"><span class="linenos">1547</span></a>                <span class="n">lw</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span>
</span><span id="Faults-1548"><a href="#-1548"><span class="linenos">1548</span></a>            <span class="p">)</span>
</span><span id="Faults-1549"><a href="#-1549"><span class="linenos">1549</span></a>        <span class="n">plot_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="Faults-1550"><a href="#-1550"><span class="linenos">1550</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">work_subfolder</span><span class="p">,</span> <span class="s2">&quot;QC_horizons_from_geologic_age_isovalues.png&quot;</span>
</span><span id="Faults-1551"><a href="#-1551"><span class="linenos">1551</span></a>        <span class="p">)</span>
</span><span id="Faults-1552"><a href="#-1552"><span class="linenos">1552</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">plot_name</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;png&quot;</span><span class="p">)</span>
</span><span id="Faults-1553"><a href="#-1553"><span class="linenos">1553</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="Faults-1554"><a href="#-1554"><span class="linenos">1554</span></a>        <span class="c1">#</span>
</span><span id="Faults-1555"><a href="#-1555"><span class="linenos">1555</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
</span><span id="Faults-1556"><a href="#-1556"><span class="linenos">1556</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
</span><span id="Faults-1557"><a href="#-1557"><span class="linenos">1557</span></a>        <span class="n">voxel_count_max</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Faults-1558"><a href="#-1558"><span class="linenos">1558</span></a>        <span class="n">iz</span> <span class="o">=</span> <span class="n">faulted_geologic_age</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">//</span> <span class="mi">2</span>
</span><span id="Faults-1559"><a href="#-1559"><span class="linenos">1559</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fault_planes</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="mi">50</span><span class="p">):</span>
</span><span id="Faults-1560"><a href="#-1560"><span class="linenos">1560</span></a>            <span class="n">voxel_count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fault_planes</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">i</span><span class="p">]</span>
</span><span id="Faults-1561"><a href="#-1561"><span class="linenos">1561</span></a>            <span class="n">voxel_count</span> <span class="o">=</span> <span class="n">voxel_count</span><span class="p">[</span><span class="n">voxel_count</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="Faults-1562"><a href="#-1562"><span class="linenos">1562</span></a>            <span class="k">if</span> <span class="n">voxel_count</span> <span class="o">&gt;</span> <span class="n">voxel_count_max</span><span class="p">:</span>
</span><span id="Faults-1563"><a href="#-1563"><span class="linenos">1563</span></a>                <span class="n">iz</span> <span class="o">=</span> <span class="n">i</span>
</span><span id="Faults-1564"><a href="#-1564"><span class="linenos">1564</span></a>                <span class="n">voxel_count_max</span> <span class="o">=</span> <span class="n">voxel_count</span>
</span><span id="Faults-1565"><a href="#-1565"><span class="linenos">1565</span></a>
</span><span id="Faults-1566"><a href="#-1566"><span class="linenos">1566</span></a>        <span class="n">plotdata</span> <span class="o">=</span> <span class="n">faulted_geologic_age</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">iz</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Faults-1567"><a href="#-1567"><span class="linenos">1567</span></a>        <span class="n">plotdata2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fault_planes</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">iz</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Faults-1568"><a href="#-1568"><span class="linenos">1568</span></a>        <span class="n">plotdata</span><span class="p">[</span><span class="n">plotdata2</span> <span class="o">&gt;</span> <span class="mf">0.05</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="Faults-1569"><a href="#-1569"><span class="linenos">1569</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="Faults-1570"><a href="#-1570"><span class="linenos">1570</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">iz</span><span class="p">))</span>
</span><span id="Faults-1571"><a href="#-1571"><span class="linenos">1571</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">plotdata</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;prism&quot;</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">)</span>
</span><span id="Faults-1572"><a href="#-1572"><span class="linenos">1572</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="Faults-1573"><a href="#-1573"><span class="linenos">1573</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">plotdata2</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;jet&quot;</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">)</span>
</span><span id="Faults-1574"><a href="#-1574"><span class="linenos">1574</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
</span><span id="Faults-1575"><a href="#-1575"><span class="linenos">1575</span></a>        <span class="n">plot_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="Faults-1576"><a href="#-1576"><span class="linenos">1576</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">work_subfolder</span><span class="p">,</span> <span class="s2">&quot;QC_fault_segments_on_geologic_age_timeslice.png&quot;</span>
</span><span id="Faults-1577"><a href="#-1577"><span class="linenos">1577</span></a>        <span class="p">)</span>
</span><span id="Faults-1578"><a href="#-1578"><span class="linenos">1578</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">plot_name</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;png&quot;</span><span class="p">)</span>
</span><span id="Faults-1579"><a href="#-1579"><span class="linenos">1579</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="Faults-1580"><a href="#-1580"><span class="linenos">1580</span></a>
</span><span id="Faults-1581"><a href="#-1581"><span class="linenos">1581</span></a>    <span class="k">def</span> <span class="nf">improve_depth_maps_post_faulting</span><span class="p">(</span>
</span><span id="Faults-1582"><a href="#-1582"><span class="linenos">1582</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Faults-1583"><a href="#-1583"><span class="linenos">1583</span></a>        <span class="n">unfaulted_geologic_age</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
</span><span id="Faults-1584"><a href="#-1584"><span class="linenos">1584</span></a>        <span class="n">faulted_geologic_age</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
</span><span id="Faults-1585"><a href="#-1585"><span class="linenos">1585</span></a>        <span class="n">onlap_clips</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
</span><span id="Faults-1586"><a href="#-1586"><span class="linenos">1586</span></a>    <span class="p">):</span>
</span><span id="Faults-1587"><a href="#-1587"><span class="linenos">1587</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="Faults-1588"><a href="#-1588"><span class="linenos">1588</span></a><span class="sd">        Re-interpolates the depth maps using the faulted geologic age cube</span>
</span><span id="Faults-1589"><a href="#-1589"><span class="linenos">1589</span></a>
</span><span id="Faults-1590"><a href="#-1590"><span class="linenos">1590</span></a><span class="sd">        Parameters</span>
</span><span id="Faults-1591"><a href="#-1591"><span class="linenos">1591</span></a><span class="sd">        ----------</span>
</span><span id="Faults-1592"><a href="#-1592"><span class="linenos">1592</span></a><span class="sd">        unfaulted_geologic_age : np.ndarray</span>
</span><span id="Faults-1593"><a href="#-1593"><span class="linenos">1593</span></a><span class="sd">            The unfaulted geologic age cube</span>
</span><span id="Faults-1594"><a href="#-1594"><span class="linenos">1594</span></a><span class="sd">        faulted_geologic_age : np.ndarray</span>
</span><span id="Faults-1595"><a href="#-1595"><span class="linenos">1595</span></a><span class="sd">            The faulted geologic age cube</span>
</span><span id="Faults-1596"><a href="#-1596"><span class="linenos">1596</span></a><span class="sd">        onlap_clips : np.ndarray</span>
</span><span id="Faults-1597"><a href="#-1597"><span class="linenos">1597</span></a><span class="sd">            The onlap clips</span>
</span><span id="Faults-1598"><a href="#-1598"><span class="linenos">1598</span></a><span class="sd">        </span>
</span><span id="Faults-1599"><a href="#-1599"><span class="linenos">1599</span></a><span class="sd">        Returns</span>
</span><span id="Faults-1600"><a href="#-1600"><span class="linenos">1600</span></a><span class="sd">        -------</span>
</span><span id="Faults-1601"><a href="#-1601"><span class="linenos">1601</span></a><span class="sd">        depth_maps : np.ndarray</span>
</span><span id="Faults-1602"><a href="#-1602"><span class="linenos">1602</span></a><span class="sd">            The improved depth maps</span>
</span><span id="Faults-1603"><a href="#-1603"><span class="linenos">1603</span></a><span class="sd">        depth_maps_gaps : np.ndarray</span>
</span><span id="Faults-1604"><a href="#-1604"><span class="linenos">1604</span></a><span class="sd">            The improved depth maps with gaps</span>
</span><span id="Faults-1605"><a href="#-1605"><span class="linenos">1605</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Faults-1606"><a href="#-1606"><span class="linenos">1606</span></a>        <span class="n">faulted_depth_maps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faulted_depth_maps</span><span class="p">)</span>
</span><span id="Faults-1607"><a href="#-1607"><span class="linenos">1607</span></a>        <span class="n">origtime</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faulted_depth_maps</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</span><span id="Faults-1608"><a href="#-1608"><span class="linenos">1608</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faulted_depth_maps</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="Faults-1609"><a href="#-1609"><span class="linenos">1609</span></a>            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faulted_depth_maps</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
</span><span id="Faults-1610"><a href="#-1610"><span class="linenos">1610</span></a>                <span class="k">if</span> <span class="p">(</span>
</span><span id="Faults-1611"><a href="#-1611"><span class="linenos">1611</span></a>                    <span class="n">faulted_geologic_age</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
</span><span id="Faults-1612"><a href="#-1612"><span class="linenos">1612</span></a>                    <span class="o">!=</span> <span class="n">faulted_geologic_age</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</span><span id="Faults-1613"><a href="#-1613"><span class="linenos">1613</span></a>                <span class="p">):</span>
</span><span id="Faults-1614"><a href="#-1614"><span class="linenos">1614</span></a>                    <span class="n">faulted_depth_maps</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span>
</span><span id="Faults-1615"><a href="#-1615"><span class="linenos">1615</span></a>                        <span class="n">origtime</span><span class="p">,</span>
</span><span id="Faults-1616"><a href="#-1616"><span class="linenos">1616</span></a>                        <span class="n">faulted_geologic_age</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="p">:],</span>
</span><span id="Faults-1617"><a href="#-1617"><span class="linenos">1617</span></a>                        <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">faulted_geologic_age</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;float&quot;</span><span class="p">),</span>
</span><span id="Faults-1618"><a href="#-1618"><span class="linenos">1618</span></a>                    <span class="p">)</span>
</span><span id="Faults-1619"><a href="#-1619"><span class="linenos">1619</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Faults-1620"><a href="#-1620"><span class="linenos">1620</span></a>                    <span class="n">faulted_depth_maps</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">unfaulted_geologic_age</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="p">:]</span>
</span><span id="Faults-1621"><a href="#-1621"><span class="linenos">1621</span></a>        <span class="c1"># Waterbottom horizon has been set to 0. Re-insert this from the original depth_maps array</span>
</span><span id="Faults-1622"><a href="#-1622"><span class="linenos">1622</span></a>        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">count_nonzero</span><span class="p">(</span><span class="n">faulted_depth_maps</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Faults-1623"><a href="#-1623"><span class="linenos">1623</span></a>            <span class="n">faulted_depth_maps</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">faulted_depth_maps</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1.0</span>
</span><span id="Faults-1624"><a href="#-1624"><span class="linenos">1624</span></a>
</span><span id="Faults-1625"><a href="#-1625"><span class="linenos">1625</span></a>        <span class="c1"># Shift re-interpolated horizons to replace first horizon (of 0&#39;s) with the second, etc</span>
</span><span id="Faults-1626"><a href="#-1626"><span class="linenos">1626</span></a>        <span class="n">zmaps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">faulted_depth_maps</span><span class="p">)</span>
</span><span id="Faults-1627"><a href="#-1627"><span class="linenos">1627</span></a>        <span class="n">zmaps</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">faulted_depth_maps</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">:]</span>
</span><span id="Faults-1628"><a href="#-1628"><span class="linenos">1628</span></a>        <span class="c1"># Fix the deepest re-interpolated horizon by adding a constant thickness to the shallower horizon</span>
</span><span id="Faults-1629"><a href="#-1629"><span class="linenos">1629</span></a>        <span class="n">zmaps</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">faulted_depth_maps</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">10</span>
</span><span id="Faults-1630"><a href="#-1630"><span class="linenos">1630</span></a>        <span class="c1"># Clip this last horizon to the one above</span>
</span><span id="Faults-1631"><a href="#-1631"><span class="linenos">1631</span></a>        <span class="n">thickness_map</span> <span class="o">=</span> <span class="n">zmaps</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">zmaps</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">]</span>
</span><span id="Faults-1632"><a href="#-1632"><span class="linenos">1632</span></a>        <span class="n">zmaps</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">thickness_map</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">)]</span> <span class="o">=</span> <span class="n">zmaps</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">][</span>
</span><span id="Faults-1633"><a href="#-1633"><span class="linenos">1633</span></a>            <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">thickness_map</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">)</span>
</span><span id="Faults-1634"><a href="#-1634"><span class="linenos">1634</span></a>        <span class="p">]</span>
</span><span id="Faults-1635"><a href="#-1635"><span class="linenos">1635</span></a>        <span class="n">faulted_depth_maps</span> <span class="o">=</span> <span class="n">zmaps</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Faults-1636"><a href="#-1636"><span class="linenos">1636</span></a>
</span><span id="Faults-1637"><a href="#-1637"><span class="linenos">1637</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">qc_plots</span><span class="p">:</span>
</span><span id="Faults-1638"><a href="#-1638"><span class="linenos">1638</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_qc_plot_check_faulted_horizons_match_fault_segments</span><span class="p">(</span>
</span><span id="Faults-1639"><a href="#-1639"><span class="linenos">1639</span></a>                <span class="n">faulted_depth_maps</span><span class="p">,</span> <span class="n">faulted_geologic_age</span>
</span><span id="Faults-1640"><a href="#-1640"><span class="linenos">1640</span></a>            <span class="p">)</span>
</span><span id="Faults-1641"><a href="#-1641"><span class="linenos">1641</span></a>
</span><span id="Faults-1642"><a href="#-1642"><span class="linenos">1642</span></a>        <span class="c1"># Re-apply old gaps to improved depth_maps</span>
</span><span id="Faults-1643"><a href="#-1643"><span class="linenos">1643</span></a>        <span class="n">zmaps_imp</span> <span class="o">=</span> <span class="n">faulted_depth_maps</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Faults-1644"><a href="#-1644"><span class="linenos">1644</span></a>        <span class="n">merged</span> <span class="o">=</span> <span class="n">zmaps_imp</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Faults-1645"><a href="#-1645"><span class="linenos">1645</span></a>        <span class="n">_depth_maps_gaps_improved</span> <span class="o">=</span> <span class="n">merged</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Faults-1646"><a href="#-1646"><span class="linenos">1646</span></a>        <span class="n">_depth_maps_gaps_improved</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faulted_depth_maps_gaps</span><span class="p">)]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
</span><span id="Faults-1647"><a href="#-1647"><span class="linenos">1647</span></a>        <span class="n">depth_maps_gaps</span> <span class="o">=</span> <span class="n">_depth_maps_gaps_improved</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Faults-1648"><a href="#-1648"><span class="linenos">1648</span></a>
</span><span id="Faults-1649"><a href="#-1649"><span class="linenos">1649</span></a>        <span class="c1"># for zero-thickness layers, set depth_maps_gaps to nan</span>
</span><span id="Faults-1650"><a href="#-1650"><span class="linenos">1650</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">depth_maps_gaps</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="Faults-1651"><a href="#-1651"><span class="linenos">1651</span></a>            <span class="n">thickness_map</span> <span class="o">=</span> <span class="n">depth_maps_gaps</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">depth_maps_gaps</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">i</span><span class="p">]</span>
</span><span id="Faults-1652"><a href="#-1652"><span class="linenos">1652</span></a>            <span class="c1"># set thicknesses &lt; zero to NaN. Use NaNs in thickness_map to 0 to avoid runtime warning when indexing</span>
</span><span id="Faults-1653"><a href="#-1653"><span class="linenos">1653</span></a>            <span class="n">depth_maps_gaps</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">i</span><span class="p">][</span><span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">thickness_map</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
</span><span id="Faults-1654"><a href="#-1654"><span class="linenos">1654</span></a>
</span><span id="Faults-1655"><a href="#-1655"><span class="linenos">1655</span></a>        <span class="c1"># restore zero thickness from faulted horizons to improved (interpolated) depth maps</span>
</span><span id="Faults-1656"><a href="#-1656"><span class="linenos">1656</span></a>        <span class="n">ii</span><span class="p">,</span> <span class="n">jj</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span>
</span><span id="Faults-1657"><a href="#-1657"><span class="linenos">1657</span></a>            <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
</span><span id="Faults-1658"><a href="#-1658"><span class="linenos">1658</span></a>            <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
</span><span id="Faults-1659"><a href="#-1659"><span class="linenos">1659</span></a>            <span class="n">sparse</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="Faults-1660"><a href="#-1660"><span class="linenos">1660</span></a>            <span class="n">indexing</span><span class="o">=</span><span class="s2">&quot;ij&quot;</span><span class="p">,</span>
</span><span id="Faults-1661"><a href="#-1661"><span class="linenos">1661</span></a>        <span class="p">)</span>
</span><span id="Faults-1662"><a href="#-1662"><span class="linenos">1662</span></a>        <span class="n">merged</span> <span class="o">=</span> <span class="n">zmaps_imp</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Faults-1663"><a href="#-1663"><span class="linenos">1663</span></a>
</span><span id="Faults-1664"><a href="#-1664"><span class="linenos">1664</span></a>        <span class="c1"># create temporary copy of fault_segments with dilation</span>
</span><span id="Faults-1665"><a href="#-1665"><span class="linenos">1665</span></a>        <span class="kn">from</span> <span class="nn">scipy.ndimage.morphology</span> <span class="kn">import</span> <span class="n">grey_dilation</span>
</span><span id="Faults-1666"><a href="#-1666"><span class="linenos">1666</span></a>
</span><span id="Faults-1667"><a href="#-1667"><span class="linenos">1667</span></a>        <span class="n">_dilated_fault_planes</span> <span class="o">=</span> <span class="n">grey_dilation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fault_planes</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</span><span id="Faults-1668"><a href="#-1668"><span class="linenos">1668</span></a>
</span><span id="Faults-1669"><a href="#-1669"><span class="linenos">1669</span></a>        <span class="n">_onlap_segments</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">onlap_segments</span><span class="p">[:]</span>
</span><span id="Faults-1670"><a href="#-1670"><span class="linenos">1670</span></a>        <span class="k">for</span> <span class="n">ihor</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">depth_maps_gaps</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
</span><span id="Faults-1671"><a href="#-1671"><span class="linenos">1671</span></a>            <span class="c1"># filter upper horizon being used for thickness if shallower events onlap it, except at faults</span>
</span><span id="Faults-1672"><a href="#-1672"><span class="linenos">1672</span></a>            <span class="n">improved_zmap_thickness</span> <span class="o">=</span> <span class="n">merged</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">ihor</span><span class="p">]</span> <span class="o">-</span> <span class="n">merged</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">ihor</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="Faults-1673"><a href="#-1673"><span class="linenos">1673</span></a>            <span class="n">depth_map_int</span> <span class="o">=</span> <span class="p">((</span><span class="n">merged</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">ihor</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">))</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span>
</span><span id="Faults-1674"><a href="#-1674"><span class="linenos">1674</span></a>                <span class="mi">0</span><span class="p">,</span> <span class="n">_onlap_segments</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>
</span><span id="Faults-1675"><a href="#-1675"><span class="linenos">1675</span></a>            <span class="p">)</span>
</span><span id="Faults-1676"><a href="#-1676"><span class="linenos">1676</span></a>            <span class="n">improved_map_onlap_segments</span> <span class="o">=</span> <span class="n">_onlap_segments</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span> <span class="n">jj</span><span class="p">,</span> <span class="n">depth_map_int</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.0</span>
</span><span id="Faults-1677"><a href="#-1677"><span class="linenos">1677</span></a>            <span class="n">improved_map_fault_segments</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="Faults-1678"><a href="#-1678"><span class="linenos">1678</span></a>                <span class="n">_dilated_fault_planes</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span> <span class="n">jj</span><span class="p">,</span> <span class="n">depth_map_int</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.0</span>
</span><span id="Faults-1679"><a href="#-1679"><span class="linenos">1679</span></a>            <span class="p">)</span>
</span><span id="Faults-1680"><a href="#-1680"><span class="linenos">1680</span></a>            <span class="c1"># remember that self.maps.depth_maps has horizons with direct fault application</span>
</span><span id="Faults-1681"><a href="#-1681"><span class="linenos">1681</span></a>            <span class="n">faulted_infilled_map_thickness</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="Faults-1682"><a href="#-1682"><span class="linenos">1682</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">faulted_depth_maps</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">ihor</span><span class="p">]</span>
</span><span id="Faults-1683"><a href="#-1683"><span class="linenos">1683</span></a>                <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">faulted_depth_maps</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">ihor</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="Faults-1684"><a href="#-1684"><span class="linenos">1684</span></a>            <span class="p">)</span>
</span><span id="Faults-1685"><a href="#-1685"><span class="linenos">1685</span></a>            <span class="n">improved_zmap_thickness</span><span class="p">[</span>
</span><span id="Faults-1686"><a href="#-1686"><span class="linenos">1686</span></a>                <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
</span><span id="Faults-1687"><a href="#-1687"><span class="linenos">1687</span></a>                    <span class="p">(</span><span class="n">faulted_infilled_map_thickness</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">)</span>
</span><span id="Faults-1688"><a href="#-1688"><span class="linenos">1688</span></a>                    <span class="o">&amp;</span> <span class="p">(</span><span class="n">improved_map_onlap_segments</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">)</span>
</span><span id="Faults-1689"><a href="#-1689"><span class="linenos">1689</span></a>                    <span class="o">&amp;</span> <span class="p">(</span><span class="n">improved_map_fault_segments</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">)</span>
</span><span id="Faults-1690"><a href="#-1690"><span class="linenos">1690</span></a>                <span class="p">)</span>
</span><span id="Faults-1691"><a href="#-1691"><span class="linenos">1691</span></a>            <span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="Faults-1692"><a href="#-1692"><span class="linenos">1692</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="Faults-1693"><a href="#-1693"><span class="linenos">1693</span></a>                <span class="s2">&quot; ... ihor, improved_map_onlap_segments[improved_map_onlap_segments&gt;0.].shape,&quot;</span>
</span><span id="Faults-1694"><a href="#-1694"><span class="linenos">1694</span></a>                <span class="s2">&quot; improved_zmap_thickness[improved_zmap_thickness==0].shape = &quot;</span><span class="p">,</span>
</span><span id="Faults-1695"><a href="#-1695"><span class="linenos">1695</span></a>                <span class="n">ihor</span><span class="p">,</span>
</span><span id="Faults-1696"><a href="#-1696"><span class="linenos">1696</span></a>                <span class="n">improved_map_onlap_segments</span><span class="p">[</span><span class="n">improved_map_onlap_segments</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
</span><span id="Faults-1697"><a href="#-1697"><span class="linenos">1697</span></a>                <span class="n">improved_zmap_thickness</span><span class="p">[</span><span class="n">improved_zmap_thickness</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
</span><span id="Faults-1698"><a href="#-1698"><span class="linenos">1698</span></a>            <span class="p">)</span>
</span><span id="Faults-1699"><a href="#-1699"><span class="linenos">1699</span></a>            <span class="n">merged</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">ihor</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">merged</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">ihor</span><span class="p">]</span> <span class="o">-</span> <span class="n">improved_zmap_thickness</span>
</span><span id="Faults-1700"><a href="#-1700"><span class="linenos">1700</span></a>
</span><span id="Faults-1701"><a href="#-1701"><span class="linenos">1701</span></a>        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fan_horizon_list</span><span class="p">):</span>
</span><span id="Faults-1702"><a href="#-1702"><span class="linenos">1702</span></a>            <span class="c1"># Clip fans downwards when thickness map is zero</span>
</span><span id="Faults-1703"><a href="#-1703"><span class="linenos">1703</span></a>            <span class="k">for</span> <span class="n">count</span><span class="p">,</span> <span class="n">layer</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fan_horizon_list</span><span class="p">):</span>
</span><span id="Faults-1704"><a href="#-1704"><span class="linenos">1704</span></a>                <span class="n">merged</span> <span class="o">=</span> <span class="n">fix_zero_thickness_fan_layers</span><span class="p">(</span>
</span><span id="Faults-1705"><a href="#-1705"><span class="linenos">1705</span></a>                    <span class="n">merged</span><span class="p">,</span> <span class="n">layer</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fan_thickness</span><span class="p">[</span><span class="n">count</span><span class="p">]</span>
</span><span id="Faults-1706"><a href="#-1706"><span class="linenos">1706</span></a>                <span class="p">)</span>
</span><span id="Faults-1707"><a href="#-1707"><span class="linenos">1707</span></a>
</span><span id="Faults-1708"><a href="#-1708"><span class="linenos">1708</span></a>        <span class="c1"># Re-apply clipping to onlapping layers post faulting</span>
</span><span id="Faults-1709"><a href="#-1709"><span class="linenos">1709</span></a>        <span class="n">merged</span> <span class="o">=</span> <span class="n">fix_zero_thickness_onlap_layers</span><span class="p">(</span><span class="n">merged</span><span class="p">,</span> <span class="n">onlap_clips</span><span class="p">)</span>
</span><span id="Faults-1710"><a href="#-1710"><span class="linenos">1710</span></a>
</span><span id="Faults-1711"><a href="#-1711"><span class="linenos">1711</span></a>        <span class="k">del</span> <span class="n">_dilated_fault_planes</span>
</span><span id="Faults-1712"><a href="#-1712"><span class="linenos">1712</span></a>
</span><span id="Faults-1713"><a href="#-1713"><span class="linenos">1713</span></a>        <span class="c1"># Re-apply gaps to improved depth_maps</span>
</span><span id="Faults-1714"><a href="#-1714"><span class="linenos">1714</span></a>        <span class="n">_depth_maps_gaps_improved</span> <span class="o">=</span> <span class="n">merged</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Faults-1715"><a href="#-1715"><span class="linenos">1715</span></a>        <span class="n">_depth_maps_gaps_improved</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faulted_depth_maps_gaps</span><span class="p">)]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
</span><span id="Faults-1716"><a href="#-1716"><span class="linenos">1716</span></a>        <span class="n">depth_maps_gaps</span> <span class="o">=</span> <span class="n">_depth_maps_gaps_improved</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Faults-1717"><a href="#-1717"><span class="linenos">1717</span></a>
</span><span id="Faults-1718"><a href="#-1718"><span class="linenos">1718</span></a>        <span class="c1"># for zero-thickness layers, set depth_maps_gaps to nan</span>
</span><span id="Faults-1719"><a href="#-1719"><span class="linenos">1719</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">depth_maps_gaps</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="Faults-1720"><a href="#-1720"><span class="linenos">1720</span></a>            <span class="n">thickness_map</span> <span class="o">=</span> <span class="n">depth_maps_gaps</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">depth_maps_gaps</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">i</span><span class="p">]</span>
</span><span id="Faults-1721"><a href="#-1721"><span class="linenos">1721</span></a>            <span class="c1"># set nans in thickness_map to 0 to avoid runtime warning</span>
</span><span id="Faults-1722"><a href="#-1722"><span class="linenos">1722</span></a>            <span class="n">depth_maps_gaps</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">i</span><span class="p">][</span><span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">thickness_map</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
</span><span id="Faults-1723"><a href="#-1723"><span class="linenos">1723</span></a>
</span><span id="Faults-1724"><a href="#-1724"><span class="linenos">1724</span></a>        <span class="k">return</span> <span class="n">merged</span><span class="p">,</span> <span class="n">depth_maps_gaps</span>
</span><span id="Faults-1725"><a href="#-1725"><span class="linenos">1725</span></a>
</span><span id="Faults-1726"><a href="#-1726"><span class="linenos">1726</span></a>    <span class="nd">@staticmethod</span>
</span><span id="Faults-1727"><a href="#-1727"><span class="linenos">1727</span></a>    <span class="k">def</span> <span class="nf">partial_faulting</span><span class="p">(</span>
</span><span id="Faults-1728"><a href="#-1728"><span class="linenos">1728</span></a>        <span class="n">depth_map_gaps_faulted</span><span class="p">,</span>
</span><span id="Faults-1729"><a href="#-1729"><span class="linenos">1729</span></a>        <span class="n">fault_plane_classification</span><span class="p">,</span>
</span><span id="Faults-1730"><a href="#-1730"><span class="linenos">1730</span></a>        <span class="n">faulted_depth_map</span><span class="p">,</span>
</span><span id="Faults-1731"><a href="#-1731"><span class="linenos">1731</span></a>        <span class="n">ii</span><span class="p">,</span>
</span><span id="Faults-1732"><a href="#-1732"><span class="linenos">1732</span></a>        <span class="n">jj</span><span class="p">,</span>
</span><span id="Faults-1733"><a href="#-1733"><span class="linenos">1733</span></a>        <span class="n">max_throw</span><span class="p">,</span>
</span><span id="Faults-1734"><a href="#-1734"><span class="linenos">1734</span></a>        <span class="n">origtime_cube</span><span class="p">,</span>
</span><span id="Faults-1735"><a href="#-1735"><span class="linenos">1735</span></a>        <span class="n">unfaulted_depth_map</span><span class="p">,</span>
</span><span id="Faults-1736"><a href="#-1736"><span class="linenos">1736</span></a>    <span class="p">):</span>
</span><span id="Faults-1737"><a href="#-1737"><span class="linenos">1737</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="Faults-1738"><a href="#-1738"><span class="linenos">1738</span></a><span class="sd">        Partial faulting</span>
</span><span id="Faults-1739"><a href="#-1739"><span class="linenos">1739</span></a><span class="sd">        ----------------</span>
</span><span id="Faults-1740"><a href="#-1740"><span class="linenos">1740</span></a>
</span><span id="Faults-1741"><a href="#-1741"><span class="linenos">1741</span></a><span class="sd">        Executes partial faluting.</span>
</span><span id="Faults-1742"><a href="#-1742"><span class="linenos">1742</span></a>
</span><span id="Faults-1743"><a href="#-1743"><span class="linenos">1743</span></a><span class="sd">        The docstring of this function is a work in progress.</span>
</span><span id="Faults-1744"><a href="#-1744"><span class="linenos">1744</span></a>
</span><span id="Faults-1745"><a href="#-1745"><span class="linenos">1745</span></a><span class="sd">        Parameters</span>
</span><span id="Faults-1746"><a href="#-1746"><span class="linenos">1746</span></a><span class="sd">        ----------</span>
</span><span id="Faults-1747"><a href="#-1747"><span class="linenos">1747</span></a><span class="sd">        depth_map_gaps_faulted : np.ndarray</span>
</span><span id="Faults-1748"><a href="#-1748"><span class="linenos">1748</span></a><span class="sd">            The depth map.</span>
</span><span id="Faults-1749"><a href="#-1749"><span class="linenos">1749</span></a><span class="sd">        fault_plane_classification : np.ndarray</span>
</span><span id="Faults-1750"><a href="#-1750"><span class="linenos">1750</span></a><span class="sd">            Fault plane classifications.</span>
</span><span id="Faults-1751"><a href="#-1751"><span class="linenos">1751</span></a><span class="sd">        faulted_depth_map : _type_</span>
</span><span id="Faults-1752"><a href="#-1752"><span class="linenos">1752</span></a><span class="sd">            The faulted depth map.</span>
</span><span id="Faults-1753"><a href="#-1753"><span class="linenos">1753</span></a><span class="sd">        ii : int</span>
</span><span id="Faults-1754"><a href="#-1754"><span class="linenos">1754</span></a><span class="sd">            The i position</span>
</span><span id="Faults-1755"><a href="#-1755"><span class="linenos">1755</span></a><span class="sd">        jj : int</span>
</span><span id="Faults-1756"><a href="#-1756"><span class="linenos">1756</span></a><span class="sd">            The j position</span>
</span><span id="Faults-1757"><a href="#-1757"><span class="linenos">1757</span></a><span class="sd">        max_throw : float</span>
</span><span id="Faults-1758"><a href="#-1758"><span class="linenos">1758</span></a><span class="sd">            The maximum amount of throw for the faults.</span>
</span><span id="Faults-1759"><a href="#-1759"><span class="linenos">1759</span></a><span class="sd">        origtime_cube : np.ndarray</span>
</span><span id="Faults-1760"><a href="#-1760"><span class="linenos">1760</span></a><span class="sd">            Original time cube.</span>
</span><span id="Faults-1761"><a href="#-1761"><span class="linenos">1761</span></a><span class="sd">        unfaulted_depth_map : np.ndarray</span>
</span><span id="Faults-1762"><a href="#-1762"><span class="linenos">1762</span></a><span class="sd">            Unfaulted depth map.</span>
</span><span id="Faults-1763"><a href="#-1763"><span class="linenos">1763</span></a>
</span><span id="Faults-1764"><a href="#-1764"><span class="linenos">1764</span></a><span class="sd">        Returns</span>
</span><span id="Faults-1765"><a href="#-1765"><span class="linenos">1765</span></a><span class="sd">        -------</span>
</span><span id="Faults-1766"><a href="#-1766"><span class="linenos">1766</span></a><span class="sd">        faulted_depth_map : np.ndarray</span>
</span><span id="Faults-1767"><a href="#-1767"><span class="linenos">1767</span></a><span class="sd">            The faulted depth map</span>
</span><span id="Faults-1768"><a href="#-1768"><span class="linenos">1768</span></a><span class="sd">        depth_map_gaps_faulted : np.ndarray</span>
</span><span id="Faults-1769"><a href="#-1769"><span class="linenos">1769</span></a><span class="sd">            Depth map with gaps filled</span>
</span><span id="Faults-1770"><a href="#-1770"><span class="linenos">1770</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Faults-1771"><a href="#-1771"><span class="linenos">1771</span></a>        <span class="k">for</span> <span class="n">ithrow</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">max_throw</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="Faults-1772"><a href="#-1772"><span class="linenos">1772</span></a>            <span class="c1"># infilled</span>
</span><span id="Faults-1773"><a href="#-1773"><span class="linenos">1773</span></a>            <span class="n">partial_faulting_map</span> <span class="o">=</span> <span class="n">unfaulted_depth_map</span> <span class="o">+</span> <span class="n">ithrow</span>
</span><span id="Faults-1774"><a href="#-1774"><span class="linenos">1774</span></a>            <span class="n">partial_faulting_map_ii_jj</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="Faults-1775"><a href="#-1775"><span class="linenos">1775</span></a>                <span class="n">partial_faulting_map</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span> <span class="n">jj</span><span class="p">]</span>
</span><span id="Faults-1776"><a href="#-1776"><span class="linenos">1776</span></a>                <span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;int&quot;</span><span class="p">)</span>
</span><span id="Faults-1777"><a href="#-1777"><span class="linenos">1777</span></a>                <span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">origtime_cube</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="Faults-1778"><a href="#-1778"><span class="linenos">1778</span></a>            <span class="p">)</span>
</span><span id="Faults-1779"><a href="#-1779"><span class="linenos">1779</span></a>            <span class="n">partial_faulting_on_horizon</span> <span class="o">=</span> <span class="n">fault_plane_classification</span><span class="p">[</span>
</span><span id="Faults-1780"><a href="#-1780"><span class="linenos">1780</span></a>                <span class="n">ii</span><span class="p">,</span> <span class="n">jj</span><span class="p">,</span> <span class="n">partial_faulting_map_ii_jj</span>
</span><span id="Faults-1781"><a href="#-1781"><span class="linenos">1781</span></a>            <span class="p">][</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
</span><span id="Faults-1782"><a href="#-1782"><span class="linenos">1782</span></a>            <span class="n">origtime_on_horizon</span> <span class="o">=</span> <span class="n">origtime_cube</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span> <span class="n">jj</span><span class="p">,</span> <span class="n">partial_faulting_map_ii_jj</span><span class="p">][</span>
</span><span id="Faults-1783"><a href="#-1783"><span class="linenos">1783</span></a>                <span class="o">...</span><span class="p">,</span> <span class="mi">0</span>
</span><span id="Faults-1784"><a href="#-1784"><span class="linenos">1784</span></a>            <span class="p">]</span>
</span><span id="Faults-1785"><a href="#-1785"><span class="linenos">1785</span></a>            <span class="n">faulted_depth_map</span><span class="p">[</span><span class="n">partial_faulting_on_horizon</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dstack</span><span class="p">(</span>
</span><span id="Faults-1786"><a href="#-1786"><span class="linenos">1786</span></a>                <span class="p">(</span><span class="n">origtime_on_horizon</span><span class="p">,</span> <span class="n">partial_faulting_map</span><span class="p">)</span>
</span><span id="Faults-1787"><a href="#-1787"><span class="linenos">1787</span></a>            <span class="p">)</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)[</span><span class="n">partial_faulting_on_horizon</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="Faults-1788"><a href="#-1788"><span class="linenos">1788</span></a>            <span class="c1"># gaps</span>
</span><span id="Faults-1789"><a href="#-1789"><span class="linenos">1789</span></a>            <span class="n">depth_map_gaps_faulted</span><span class="p">[</span><span class="n">partial_faulting_on_horizon</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
</span><span id="Faults-1790"><a href="#-1790"><span class="linenos">1790</span></a>        <span class="k">return</span> <span class="n">faulted_depth_map</span><span class="p">,</span> <span class="n">depth_map_gaps_faulted</span>
</span><span id="Faults-1791"><a href="#-1791"><span class="linenos">1791</span></a>
</span><span id="Faults-1792"><a href="#-1792"><span class="linenos">1792</span></a>    <span class="k">def</span> <span class="nf">get_displacement_vector</span><span class="p">(</span>
</span><span id="Faults-1793"><a href="#-1793"><span class="linenos">1793</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Faults-1794"><a href="#-1794"><span class="linenos">1794</span></a>        <span class="n">semi_axes</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">,</span>
</span><span id="Faults-1795"><a href="#-1795"><span class="linenos">1795</span></a>        <span class="n">origin</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">,</span>
</span><span id="Faults-1796"><a href="#-1796"><span class="linenos">1796</span></a>        <span class="n">throw</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
</span><span id="Faults-1797"><a href="#-1797"><span class="linenos">1797</span></a>        <span class="n">tilt</span><span class="p">,</span>
</span><span id="Faults-1798"><a href="#-1798"><span class="linenos">1798</span></a>        <span class="n">wb</span><span class="p">,</span>
</span><span id="Faults-1799"><a href="#-1799"><span class="linenos">1799</span></a>        <span class="n">index</span><span class="p">,</span>
</span><span id="Faults-1800"><a href="#-1800"><span class="linenos">1800</span></a>        <span class="n">fp</span>
</span><span id="Faults-1801"><a href="#-1801"><span class="linenos">1801</span></a>    <span class="p">):</span>
</span><span id="Faults-1802"><a href="#-1802"><span class="linenos">1802</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="Faults-1803"><a href="#-1803"><span class="linenos">1803</span></a><span class="sd">        Gets a displacement vector.</span>
</span><span id="Faults-1804"><a href="#-1804"><span class="linenos">1804</span></a>
</span><span id="Faults-1805"><a href="#-1805"><span class="linenos">1805</span></a><span class="sd">        Parameters</span>
</span><span id="Faults-1806"><a href="#-1806"><span class="linenos">1806</span></a><span class="sd">        ----------</span>
</span><span id="Faults-1807"><a href="#-1807"><span class="linenos">1807</span></a><span class="sd">        semi_axes : tuple</span>
</span><span id="Faults-1808"><a href="#-1808"><span class="linenos">1808</span></a><span class="sd">            The semi axes.</span>
</span><span id="Faults-1809"><a href="#-1809"><span class="linenos">1809</span></a><span class="sd">        origin : tuple</span>
</span><span id="Faults-1810"><a href="#-1810"><span class="linenos">1810</span></a><span class="sd">            The origin.</span>
</span><span id="Faults-1811"><a href="#-1811"><span class="linenos">1811</span></a><span class="sd">        throw : float</span>
</span><span id="Faults-1812"><a href="#-1812"><span class="linenos">1812</span></a><span class="sd">            The throw of th fault to use.</span>
</span><span id="Faults-1813"><a href="#-1813"><span class="linenos">1813</span></a><span class="sd">        tilt : float</span>
</span><span id="Faults-1814"><a href="#-1814"><span class="linenos">1814</span></a><span class="sd">            The tilt of the fault.</span>
</span><span id="Faults-1815"><a href="#-1815"><span class="linenos">1815</span></a><span class="sd">        </span>
</span><span id="Faults-1816"><a href="#-1816"><span class="linenos">1816</span></a><span class="sd">        Returns</span>
</span><span id="Faults-1817"><a href="#-1817"><span class="linenos">1817</span></a><span class="sd">        -------</span>
</span><span id="Faults-1818"><a href="#-1818"><span class="linenos">1818</span></a><span class="sd">        stretch_times : np.ndarray</span>
</span><span id="Faults-1819"><a href="#-1819"><span class="linenos">1819</span></a><span class="sd">            The stretch times.</span>
</span><span id="Faults-1820"><a href="#-1820"><span class="linenos">1820</span></a><span class="sd">        stretch_times_classification : np.ndarray</span>
</span><span id="Faults-1821"><a href="#-1821"><span class="linenos">1821</span></a><span class="sd">            Stretch times classification.</span>
</span><span id="Faults-1822"><a href="#-1822"><span class="linenos">1822</span></a><span class="sd">        interpolation : bool</span>
</span><span id="Faults-1823"><a href="#-1823"><span class="linenos">1823</span></a><span class="sd">            Whether or not to interpolate.</span>
</span><span id="Faults-1824"><a href="#-1824"><span class="linenos">1824</span></a><span class="sd">        hockey_stick : int</span>
</span><span id="Faults-1825"><a href="#-1825"><span class="linenos">1825</span></a><span class="sd">            The hockey stick.</span>
</span><span id="Faults-1826"><a href="#-1826"><span class="linenos">1826</span></a><span class="sd">        fault_segments : np.ndarray</span>
</span><span id="Faults-1827"><a href="#-1827"><span class="linenos">1827</span></a>
</span><span id="Faults-1828"><a href="#-1828"><span class="linenos">1828</span></a><span class="sd">        ellipsoid : </span>
</span><span id="Faults-1829"><a href="#-1829"><span class="linenos">1829</span></a><span class="sd">        fp : </span>
</span><span id="Faults-1830"><a href="#-1830"><span class="linenos">1830</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Faults-1831"><a href="#-1831"><span class="linenos">1831</span></a>        <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">semi_axes</span>
</span><span id="Faults-1832"><a href="#-1832"><span class="linenos">1832</span></a>        <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">z0</span> <span class="o">=</span> <span class="n">origin</span>
</span><span id="Faults-1833"><a href="#-1833"><span class="linenos">1833</span></a>
</span><span id="Faults-1834"><a href="#-1834"><span class="linenos">1834</span></a>        <span class="n">random_shear_zone_width</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="Faults-1835"><a href="#-1835"><span class="linenos">1835</span></a>            <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="mf">0.75</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span> <span class="o">*</span> <span class="mi">200</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">200</span>
</span><span id="Faults-1836"><a href="#-1836"><span class="linenos">1836</span></a>        <span class="p">)</span>
</span><span id="Faults-1837"><a href="#-1837"><span class="linenos">1837</span></a>        <span class="k">if</span> <span class="n">random_shear_zone_width</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Faults-1838"><a href="#-1838"><span class="linenos">1838</span></a>            <span class="n">random_gouge_pctile</span> <span class="o">=</span> <span class="mi">100</span>
</span><span id="Faults-1839"><a href="#-1839"><span class="linenos">1839</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Faults-1840"><a href="#-1840"><span class="linenos">1840</span></a>            <span class="c1"># clip amplitudes inside shear_zone with this percentile of total (100 implies doing nothing)</span>
</span><span id="Faults-1841"><a href="#-1841"><span class="linenos">1841</span></a>            <span class="n">random_gouge_pctile</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">triangular</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
</span><span id="Faults-1842"><a href="#-1842"><span class="linenos">1842</span></a>        <span class="c1"># Store the random values</span>
</span><span id="Faults-1843"><a href="#-1843"><span class="linenos">1843</span></a>        <span class="n">fp</span><span class="p">[</span><span class="s2">&quot;shear_zone_width&quot;</span><span class="p">][</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">random_shear_zone_width</span>
</span><span id="Faults-1844"><a href="#-1844"><span class="linenos">1844</span></a>        <span class="n">fp</span><span class="p">[</span><span class="s2">&quot;gouge_pctile&quot;</span><span class="p">][</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">random_gouge_pctile</span>
</span><span id="Faults-1845"><a href="#-1845"><span class="linenos">1845</span></a>
</span><span id="Faults-1846"><a href="#-1846"><span class="linenos">1846</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Faults-1847"><a href="#-1847"><span class="linenos">1847</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   ...shear_zone_width (samples) = </span><span class="si">{</span><span class="n">random_shear_zone_width</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Faults-1848"><a href="#-1848"><span class="linenos">1848</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   ...gouge_pctile (percent*100) = </span><span class="si">{</span><span class="n">random_gouge_pctile</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Faults-1849"><a href="#-1849"><span class="linenos">1849</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   .... output_cube.shape = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">geologic_age</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Faults-1850"><a href="#-1850"><span class="linenos">1850</span></a>            <span class="n">_p</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="Faults-1851"><a href="#-1851"><span class="linenos">1851</span></a>                <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">geologic_age</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">infill_factor</span>
</span><span id="Faults-1852"><a href="#-1852"><span class="linenos">1852</span></a>            <span class="p">)</span><span class="o">.</span><span class="n">shape</span>
</span><span id="Faults-1853"><a href="#-1853"><span class="linenos">1853</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="Faults-1854"><a href="#-1854"><span class="linenos">1854</span></a>                <span class="sa">f</span><span class="s2">&quot;   .... (np.arange(output_cube.shape[2])*infill_factor).shape = </span><span class="si">{</span><span class="n">_p</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Faults-1855"><a href="#-1855"><span class="linenos">1855</span></a>            <span class="p">)</span>
</span><span id="Faults-1856"><a href="#-1856"><span class="linenos">1856</span></a>
</span><span id="Faults-1857"><a href="#-1857"><span class="linenos">1857</span></a>        <span class="n">ellipsoid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rotate_3d_ellipsoid</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">z0</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">tilt</span><span class="p">)</span>
</span><span id="Faults-1858"><a href="#-1858"><span class="linenos">1858</span></a>        <span class="n">fault_segments</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_fault_plane_sobel</span><span class="p">(</span><span class="n">ellipsoid</span><span class="p">)</span>
</span><span id="Faults-1859"><a href="#-1859"><span class="linenos">1859</span></a>        <span class="n">z_idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_fault_centre</span><span class="p">(</span><span class="n">ellipsoid</span><span class="p">,</span> <span class="n">wb</span><span class="p">,</span> <span class="n">fault_segments</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>
</span><span id="Faults-1860"><a href="#-1860"><span class="linenos">1860</span></a>
</span><span id="Faults-1861"><a href="#-1861"><span class="linenos">1861</span></a>        <span class="c1"># Initialise return objects in case z_idx size == 0</span>
</span><span id="Faults-1862"><a href="#-1862"><span class="linenos">1862</span></a>        <span class="n">interpolation</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Faults-1863"><a href="#-1863"><span class="linenos">1863</span></a>        <span class="n">hockey_stick</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Faults-1864"><a href="#-1864"><span class="linenos">1864</span></a>        <span class="c1"># displacement_cube = None</span>
</span><span id="Faults-1865"><a href="#-1865"><span class="linenos">1865</span></a>        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">z_idx</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Faults-1866"><a href="#-1866"><span class="linenos">1866</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    ... Computing fault depth at max displacement&quot;</span><span class="p">)</span>
</span><span id="Faults-1867"><a href="#-1867"><span class="linenos">1867</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    ... depth at max displacement  = </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">z_idx</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
</span><span id="Faults-1868"><a href="#-1868"><span class="linenos">1868</span></a>            <span class="n">down</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">ellipsoid</span><span class="p">[</span><span class="n">ellipsoid</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span>
</span><span id="Faults-1869"><a href="#-1869"><span class="linenos">1869</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">geologic_age</span><span class="p">[:]</span><span class="o">.</span><span class="n">shape</span>
</span><span id="Faults-1870"><a href="#-1870"><span class="linenos">1870</span></a>            <span class="p">)</span>
</span><span id="Faults-1871"><a href="#-1871"><span class="linenos">1871</span></a>            <span class="sd">&quot;&quot;&quot;</span>
</span><span id="Faults-1872"><a href="#-1872"><span class="linenos">1872</span></a><span class="sd">            down = np.int16(len(np.where(ellipsoid &lt; 1.)[0]) / 1.0 * (self.vols.geologic_age.shape[2] *</span>
</span><span id="Faults-1873"><a href="#-1873"><span class="linenos">1873</span></a><span class="sd">                                                                      self.vols.geologic_age.shape[1] *</span>
</span><span id="Faults-1874"><a href="#-1874"><span class="linenos">1874</span></a><span class="sd">                                                                      self.vols.geologic_age.shape[0]))</span>
</span><span id="Faults-1875"><a href="#-1875"><span class="linenos">1875</span></a><span class="sd">            print(&quot;    ... This fault has {!s} %% of downthrown samples&quot;.format(down))</span>
</span><span id="Faults-1876"><a href="#-1876"><span class="linenos">1876</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="Faults-1877"><a href="#-1877"><span class="linenos">1877</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="Faults-1878"><a href="#-1878"><span class="linenos">1878</span></a>                <span class="s2">&quot;    ... This fault has &quot;</span>
</span><span id="Faults-1879"><a href="#-1879"><span class="linenos">1879</span></a>                <span class="o">+</span> <span class="nb">format</span><span class="p">(</span><span class="n">down</span><span class="p">,</span> <span class="s2">&quot;5.1%&quot;</span><span class="p">)</span>
</span><span id="Faults-1880"><a href="#-1880"><span class="linenos">1880</span></a>                <span class="o">+</span> <span class="s2">&quot; of downthrown samples&quot;</span>
</span><span id="Faults-1881"><a href="#-1881"><span class="linenos">1881</span></a>            <span class="p">)</span>
</span><span id="Faults-1882"><a href="#-1882"><span class="linenos">1882</span></a>
</span><span id="Faults-1883"><a href="#-1883"><span class="linenos">1883</span></a>            <span class="p">(</span>
</span><span id="Faults-1884"><a href="#-1884"><span class="linenos">1884</span></a>                <span class="n">stretch_times</span><span class="p">,</span>
</span><span id="Faults-1885"><a href="#-1885"><span class="linenos">1885</span></a>                <span class="n">stretch_times_classification</span><span class="p">,</span>
</span><span id="Faults-1886"><a href="#-1886"><span class="linenos">1886</span></a>                <span class="n">interpolation</span><span class="p">,</span>
</span><span id="Faults-1887"><a href="#-1887"><span class="linenos">1887</span></a>                <span class="n">hockey_stick</span><span class="p">,</span>
</span><span id="Faults-1888"><a href="#-1888"><span class="linenos">1888</span></a>            <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xyz_dis</span><span class="p">(</span><span class="n">z_idx</span><span class="p">,</span> <span class="n">throw</span><span class="p">,</span> <span class="n">fault_segments</span><span class="p">,</span> <span class="n">ellipsoid</span><span class="p">,</span> <span class="n">wb</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>
</span><span id="Faults-1889"><a href="#-1889"><span class="linenos">1889</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Faults-1890"><a href="#-1890"><span class="linenos">1890</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  ... Ellipsoid larger than cube no fault inserted&quot;</span><span class="p">)</span>
</span><span id="Faults-1891"><a href="#-1891"><span class="linenos">1891</span></a>            <span class="n">stretch_times</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">ellipsoid</span><span class="p">)</span>
</span><span id="Faults-1892"><a href="#-1892"><span class="linenos">1892</span></a>            <span class="n">stretch_times_classification</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">geologic_age</span><span class="p">[:])</span>
</span><span id="Faults-1893"><a href="#-1893"><span class="linenos">1893</span></a>
</span><span id="Faults-1894"><a href="#-1894"><span class="linenos">1894</span></a>        <span class="n">max_fault_throw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_fault_throw</span><span class="p">[:]</span>
</span><span id="Faults-1895"><a href="#-1895"><span class="linenos">1895</span></a>        <span class="n">max_fault_throw</span><span class="p">[</span><span class="n">ellipsoid</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="n">throw</span><span class="p">)</span>
</span><span id="Faults-1896"><a href="#-1896"><span class="linenos">1896</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">max_fault_throw</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">max_fault_throw</span>
</span><span id="Faults-1897"><a href="#-1897"><span class="linenos">1897</span></a>
</span><span id="Faults-1898"><a href="#-1898"><span class="linenos">1898</span></a>        <span class="k">return</span> <span class="p">(</span>
</span><span id="Faults-1899"><a href="#-1899"><span class="linenos">1899</span></a>            <span class="n">stretch_times</span><span class="p">,</span>
</span><span id="Faults-1900"><a href="#-1900"><span class="linenos">1900</span></a>            <span class="n">stretch_times_classification</span><span class="p">,</span>
</span><span id="Faults-1901"><a href="#-1901"><span class="linenos">1901</span></a>            <span class="n">interpolation</span><span class="p">,</span>
</span><span id="Faults-1902"><a href="#-1902"><span class="linenos">1902</span></a>            <span class="n">hockey_stick</span><span class="p">,</span>
</span><span id="Faults-1903"><a href="#-1903"><span class="linenos">1903</span></a>            <span class="n">fault_segments</span><span class="p">,</span>
</span><span id="Faults-1904"><a href="#-1904"><span class="linenos">1904</span></a>            <span class="n">ellipsoid</span><span class="p">,</span>
</span><span id="Faults-1905"><a href="#-1905"><span class="linenos">1905</span></a>            <span class="n">fp</span><span class="p">,</span>
</span><span id="Faults-1906"><a href="#-1906"><span class="linenos">1906</span></a>        <span class="p">)</span>
</span><span id="Faults-1907"><a href="#-1907"><span class="linenos">1907</span></a>
</span><span id="Faults-1908"><a href="#-1908"><span class="linenos">1908</span></a>    <span class="k">def</span> <span class="nf">apply_xyz_displacement</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">traces</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="Faults-1909"><a href="#-1909"><span class="linenos">1909</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="Faults-1910"><a href="#-1910"><span class="linenos">1910</span></a><span class="sd">        Applies XYZ Displacement.</span>
</span><span id="Faults-1911"><a href="#-1911"><span class="linenos">1911</span></a><span class="sd">        </span>
</span><span id="Faults-1912"><a href="#-1912"><span class="linenos">1912</span></a><span class="sd">        Apply stretching and squeezing previously applied to the input cube</span>
</span><span id="Faults-1913"><a href="#-1913"><span class="linenos">1913</span></a><span class="sd">        vertically to give all depths the same number of extrema.</span>
</span><span id="Faults-1914"><a href="#-1914"><span class="linenos">1914</span></a>
</span><span id="Faults-1915"><a href="#-1915"><span class="linenos">1915</span></a><span class="sd">        This is intended to be a proxy for making the</span>
</span><span id="Faults-1916"><a href="#-1916"><span class="linenos">1916</span></a><span class="sd">        dominant frequency the same everywhere.</span>
</span><span id="Faults-1917"><a href="#-1917"><span class="linenos">1917</span></a>
</span><span id="Faults-1918"><a href="#-1918"><span class="linenos">1918</span></a><span class="sd">        Parameters</span>
</span><span id="Faults-1919"><a href="#-1919"><span class="linenos">1919</span></a><span class="sd">        ----------</span>
</span><span id="Faults-1920"><a href="#-1920"><span class="linenos">1920</span></a><span class="sd">        traces : np.ndarray</span>
</span><span id="Faults-1921"><a href="#-1921"><span class="linenos">1921</span></a><span class="sd">            Previously stretched/squeezed trace(s)</span>
</span><span id="Faults-1922"><a href="#-1922"><span class="linenos">1922</span></a>
</span><span id="Faults-1923"><a href="#-1923"><span class="linenos">1923</span></a><span class="sd">        Returns</span>
</span><span id="Faults-1924"><a href="#-1924"><span class="linenos">1924</span></a><span class="sd">        -------</span>
</span><span id="Faults-1925"><a href="#-1925"><span class="linenos">1925</span></a><span class="sd">        unstretch_traces: np.ndarray</span>
</span><span id="Faults-1926"><a href="#-1926"><span class="linenos">1926</span></a><span class="sd">            Un-stretched/un-squeezed trace(s)</span>
</span><span id="Faults-1927"><a href="#-1927"><span class="linenos">1927</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Faults-1928"><a href="#-1928"><span class="linenos">1928</span></a>        <span class="n">unstretch_traces</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">traces</span><span class="p">)</span>
</span><span id="Faults-1929"><a href="#-1929"><span class="linenos">1929</span></a>        <span class="n">origtime</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">traces</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</span><span id="Faults-1930"><a href="#-1930"><span class="linenos">1930</span></a>
</span><span id="Faults-1931"><a href="#-1931"><span class="linenos">1931</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">   ... Cube parameters going into interpolation&quot;</span><span class="p">)</span>
</span><span id="Faults-1932"><a href="#-1932"><span class="linenos">1932</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">   ... Origtime shape  = </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">origtime</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Faults-1933"><a href="#-1933"><span class="linenos">1933</span></a>        <span class="nb">print</span><span class="p">(</span>
</span><span id="Faults-1934"><a href="#-1934"><span class="linenos">1934</span></a>            <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">   ... stretch_times_effects shape  = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">displacement_vectors</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Faults-1935"><a href="#-1935"><span class="linenos">1935</span></a>        <span class="p">)</span>
</span><span id="Faults-1936"><a href="#-1936"><span class="linenos">1936</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">   ... unstretch_times shape  = </span><span class="si">{</span><span class="n">unstretch_traces</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Faults-1937"><a href="#-1937"><span class="linenos">1937</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">   ... traces shape  = </span><span class="si">{</span><span class="n">traces</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Faults-1938"><a href="#-1938"><span class="linenos">1938</span></a>
</span><span id="Faults-1939"><a href="#-1939"><span class="linenos">1939</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">traces</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="Faults-1940"><a href="#-1940"><span class="linenos">1940</span></a>            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">traces</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
</span><span id="Faults-1941"><a href="#-1941"><span class="linenos">1941</span></a>                <span class="k">if</span> <span class="n">traces</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">!=</span> <span class="n">traces</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">max</span><span class="p">():</span>
</span><span id="Faults-1942"><a href="#-1942"><span class="linenos">1942</span></a>                    <span class="n">unstretch_traces</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span>
</span><span id="Faults-1943"><a href="#-1943"><span class="linenos">1943</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">displacement_vectors</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="p">:],</span> <span class="n">origtime</span><span class="p">,</span> <span class="n">traces</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="p">:]</span>
</span><span id="Faults-1944"><a href="#-1944"><span class="linenos">1944</span></a>                    <span class="p">)</span>
</span><span id="Faults-1945"><a href="#-1945"><span class="linenos">1945</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Faults-1946"><a href="#-1946"><span class="linenos">1946</span></a>                    <span class="n">unstretch_traces</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">traces</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="p">:]</span>
</span><span id="Faults-1947"><a href="#-1947"><span class="linenos">1947</span></a>        <span class="k">return</span> <span class="n">unstretch_traces</span>
</span><span id="Faults-1948"><a href="#-1948"><span class="linenos">1948</span></a>
</span><span id="Faults-1949"><a href="#-1949"><span class="linenos">1949</span></a>    <span class="k">def</span> <span class="nf">copy_and_divide_depth_maps_by_infill</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zmaps</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="Faults-1950"><a href="#-1950"><span class="linenos">1950</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="Faults-1951"><a href="#-1951"><span class="linenos">1951</span></a><span class="sd">        Copy and divide depth maps by infill factor</span>
</span><span id="Faults-1952"><a href="#-1952"><span class="linenos">1952</span></a><span class="sd">        -------------------------------------------</span>
</span><span id="Faults-1953"><a href="#-1953"><span class="linenos">1953</span></a>
</span><span id="Faults-1954"><a href="#-1954"><span class="linenos">1954</span></a><span class="sd">        Copies and divides depth maps by infill factor.</span>
</span><span id="Faults-1955"><a href="#-1955"><span class="linenos">1955</span></a>
</span><span id="Faults-1956"><a href="#-1956"><span class="linenos">1956</span></a><span class="sd">        Parameters</span>
</span><span id="Faults-1957"><a href="#-1957"><span class="linenos">1957</span></a><span class="sd">        ----------</span>
</span><span id="Faults-1958"><a href="#-1958"><span class="linenos">1958</span></a><span class="sd">        zmaps : np.array</span>
</span><span id="Faults-1959"><a href="#-1959"><span class="linenos">1959</span></a><span class="sd">            The depth maps to copy and divide.</span>
</span><span id="Faults-1960"><a href="#-1960"><span class="linenos">1960</span></a>
</span><span id="Faults-1961"><a href="#-1961"><span class="linenos">1961</span></a><span class="sd">        Returns</span>
</span><span id="Faults-1962"><a href="#-1962"><span class="linenos">1962</span></a><span class="sd">        -------</span>
</span><span id="Faults-1963"><a href="#-1963"><span class="linenos">1963</span></a><span class="sd">        np.ndarray</span>
</span><span id="Faults-1964"><a href="#-1964"><span class="linenos">1964</span></a><span class="sd">            The result of the division</span>
</span><span id="Faults-1965"><a href="#-1965"><span class="linenos">1965</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Faults-1966"><a href="#-1966"><span class="linenos">1966</span></a>        <span class="k">return</span> <span class="n">zmaps</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">infill_factor</span>
</span><span id="Faults-1967"><a href="#-1967"><span class="linenos">1967</span></a>
</span><span id="Faults-1968"><a href="#-1968"><span class="linenos">1968</span></a>    <span class="k">def</span> <span class="nf">rotate_3d_ellipsoid</span><span class="p">(</span>
</span><span id="Faults-1969"><a href="#-1969"><span class="linenos">1969</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">z0</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">fraction</span>
</span><span id="Faults-1970"><a href="#-1970"><span class="linenos">1970</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="Faults-1971"><a href="#-1971"><span class="linenos">1971</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="Faults-1972"><a href="#-1972"><span class="linenos">1972</span></a><span class="sd">        Rotate a 3D ellipsoid</span>
</span><span id="Faults-1973"><a href="#-1973"><span class="linenos">1973</span></a><span class="sd">        ---------------------</span>
</span><span id="Faults-1974"><a href="#-1974"><span class="linenos">1974</span></a>
</span><span id="Faults-1975"><a href="#-1975"><span class="linenos">1975</span></a><span class="sd">        Parameters</span>
</span><span id="Faults-1976"><a href="#-1976"><span class="linenos">1976</span></a><span class="sd">        ----------</span>
</span><span id="Faults-1977"><a href="#-1977"><span class="linenos">1977</span></a><span class="sd">        x0 : _type_</span>
</span><span id="Faults-1978"><a href="#-1978"><span class="linenos">1978</span></a><span class="sd">            _description_</span>
</span><span id="Faults-1979"><a href="#-1979"><span class="linenos">1979</span></a><span class="sd">        y0 : _type_</span>
</span><span id="Faults-1980"><a href="#-1980"><span class="linenos">1980</span></a><span class="sd">            _description_</span>
</span><span id="Faults-1981"><a href="#-1981"><span class="linenos">1981</span></a><span class="sd">        z0 : _type_</span>
</span><span id="Faults-1982"><a href="#-1982"><span class="linenos">1982</span></a><span class="sd">            _description_</span>
</span><span id="Faults-1983"><a href="#-1983"><span class="linenos">1983</span></a><span class="sd">        a : _type_</span>
</span><span id="Faults-1984"><a href="#-1984"><span class="linenos">1984</span></a><span class="sd">            _description_</span>
</span><span id="Faults-1985"><a href="#-1985"><span class="linenos">1985</span></a><span class="sd">        b : _type_</span>
</span><span id="Faults-1986"><a href="#-1986"><span class="linenos">1986</span></a><span class="sd">            _description_</span>
</span><span id="Faults-1987"><a href="#-1987"><span class="linenos">1987</span></a><span class="sd">        c : _type_</span>
</span><span id="Faults-1988"><a href="#-1988"><span class="linenos">1988</span></a><span class="sd">            _description_</span>
</span><span id="Faults-1989"><a href="#-1989"><span class="linenos">1989</span></a><span class="sd">        fraction : _type_</span>
</span><span id="Faults-1990"><a href="#-1990"><span class="linenos">1990</span></a><span class="sd">            _description_</span>
</span><span id="Faults-1991"><a href="#-1991"><span class="linenos">1991</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Faults-1992"><a href="#-1992"><span class="linenos">1992</span></a>        <span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">z1</span><span class="p">,</span> <span class="n">x_0</span><span class="p">,</span> <span class="n">y_0</span><span class="p">,</span> <span class="n">z_0</span><span class="p">,</span> <span class="n">a1</span><span class="p">,</span> <span class="n">b1</span><span class="p">,</span> <span class="n">c1</span><span class="p">):</span>
</span><span id="Faults-1993"><a href="#-1993"><span class="linenos">1993</span></a>            <span class="k">return</span> <span class="p">(</span>
</span><span id="Faults-1994"><a href="#-1994"><span class="linenos">1994</span></a>                <span class="p">((</span><span class="n">x1</span> <span class="o">-</span> <span class="n">x_0</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="n">a1</span> <span class="o">+</span> <span class="p">((</span><span class="n">y1</span> <span class="o">-</span> <span class="n">y_0</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="n">b1</span> <span class="o">+</span> <span class="p">((</span><span class="n">z1</span> <span class="o">-</span> <span class="n">z_0</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="n">c1</span>
</span><span id="Faults-1995"><a href="#-1995"><span class="linenos">1995</span></a>            <span class="p">)</span>
</span><span id="Faults-1996"><a href="#-1996"><span class="linenos">1996</span></a>
</span><span id="Faults-1997"><a href="#-1997"><span class="linenos">1997</span></a>        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">geologic_age</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;float&quot;</span><span class="p">)</span>
</span><span id="Faults-1998"><a href="#-1998"><span class="linenos">1998</span></a>        <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">geologic_age</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;float&quot;</span><span class="p">)</span>
</span><span id="Faults-1999"><a href="#-1999"><span class="linenos">1999</span></a>        <span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">geologic_age</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;float&quot;</span><span class="p">)</span>
</span><span id="Faults-2000"><a href="#-2000"><span class="linenos">2000</span></a>
</span><span id="Faults-2001"><a href="#-2001"><span class="linenos">2001</span></a>        <span class="n">xx</span><span class="p">,</span> <span class="n">yy</span><span class="p">,</span> <span class="n">zz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">indexing</span><span class="o">=</span><span class="s2">&quot;ij&quot;</span><span class="p">,</span> <span class="n">sparse</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="Faults-2002"><a href="#-2002"><span class="linenos">2002</span></a>
</span><span id="Faults-2003"><a href="#-2003"><span class="linenos">2003</span></a>        <span class="n">xyz</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="Faults-2004"><a href="#-2004"><span class="linenos">2004</span></a>            <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">xx</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">yy</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">zz</span><span class="o">.</span><span class="n">flatten</span><span class="p">()))</span>
</span><span id="Faults-2005"><a href="#-2005"><span class="linenos">2005</span></a>            <span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="Faults-2006"><a href="#-2006"><span class="linenos">2006</span></a>            <span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;float&quot;</span><span class="p">)</span>
</span><span id="Faults-2007"><a href="#-2007"><span class="linenos">2007</span></a>        <span class="p">)</span>
</span><span id="Faults-2008"><a href="#-2008"><span class="linenos">2008</span></a>
</span><span id="Faults-2009"><a href="#-2009"><span class="linenos">2009</span></a>        <span class="n">xyz_rotated</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_3d_rotation</span><span class="p">(</span>
</span><span id="Faults-2010"><a href="#-2010"><span class="linenos">2010</span></a>            <span class="n">xyz</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">geologic_age</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">fraction</span>
</span><span id="Faults-2011"><a href="#-2011"><span class="linenos">2011</span></a>        <span class="p">)</span>
</span><span id="Faults-2012"><a href="#-2012"><span class="linenos">2012</span></a>
</span><span id="Faults-2013"><a href="#-2013"><span class="linenos">2013</span></a>        <span class="n">xx_rotated</span> <span class="o">=</span> <span class="n">xyz_rotated</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">geologic_age</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span><span id="Faults-2014"><a href="#-2014"><span class="linenos">2014</span></a>        <span class="n">yy_rotated</span> <span class="o">=</span> <span class="n">xyz_rotated</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">geologic_age</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span><span id="Faults-2015"><a href="#-2015"><span class="linenos">2015</span></a>        <span class="n">zz_rotated</span> <span class="o">=</span> <span class="n">xyz_rotated</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">geologic_age</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span><span id="Faults-2016"><a href="#-2016"><span class="linenos">2016</span></a>
</span><span id="Faults-2017"><a href="#-2017"><span class="linenos">2017</span></a>        <span class="n">ellipsoid</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">xx_rotated</span><span class="p">,</span> <span class="n">yy_rotated</span><span class="p">,</span> <span class="n">zz_rotated</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">z0</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span>
</span><span id="Faults-2018"><a href="#-2018"><span class="linenos">2018</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">geologic_age</span><span class="o">.</span><span class="n">shape</span>
</span><span id="Faults-2019"><a href="#-2019"><span class="linenos">2019</span></a>        <span class="p">)</span>
</span><span id="Faults-2020"><a href="#-2020"><span class="linenos">2020</span></a>
</span><span id="Faults-2021"><a href="#-2021"><span class="linenos">2021</span></a>        <span class="k">return</span> <span class="n">ellipsoid</span>
</span><span id="Faults-2022"><a href="#-2022"><span class="linenos">2022</span></a>
</span><span id="Faults-2023"><a href="#-2023"><span class="linenos">2023</span></a>    <span class="nd">@staticmethod</span>
</span><span id="Faults-2024"><a href="#-2024"><span class="linenos">2024</span></a>    <span class="k">def</span> <span class="nf">apply_3d_rotation</span><span class="p">(</span><span class="n">inarray</span><span class="p">,</span> <span class="n">array_shape</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">fraction</span><span class="p">):</span>
</span><span id="Faults-2025"><a href="#-2025"><span class="linenos">2025</span></a>        <span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">sqrt</span><span class="p">,</span> <span class="n">sin</span><span class="p">,</span> <span class="n">cos</span><span class="p">,</span> <span class="n">atan2</span>
</span><span id="Faults-2026"><a href="#-2026"><span class="linenos">2026</span></a>        <span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">cross</span><span class="p">,</span> <span class="n">eye</span>
</span><span id="Faults-2027"><a href="#-2027"><span class="linenos">2027</span></a>
</span><span id="Faults-2028"><a href="#-2028"><span class="linenos">2028</span></a>        <span class="c1"># expm3 deprecated, changed to &#39;more robust&#39; expm (TM)</span>
</span><span id="Faults-2029"><a href="#-2029"><span class="linenos">2029</span></a>        <span class="kn">from</span> <span class="nn">scipy.linalg</span> <span class="kn">import</span> <span class="n">expm</span><span class="p">,</span> <span class="n">norm</span>
</span><span id="Faults-2030"><a href="#-2030"><span class="linenos">2030</span></a>
</span><span id="Faults-2031"><a href="#-2031"><span class="linenos">2031</span></a>        <span class="k">def</span> <span class="nf">m</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="n">angle</span><span class="p">):</span>
</span><span id="Faults-2032"><a href="#-2032"><span class="linenos">2032</span></a>            <span class="k">return</span> <span class="n">expm</span><span class="p">(</span><span class="n">cross</span><span class="p">(</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">axis</span> <span class="o">/</span> <span class="n">norm</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span> <span class="o">*</span> <span class="n">angle</span><span class="p">))</span>
</span><span id="Faults-2033"><a href="#-2033"><span class="linenos">2033</span></a>
</span><span id="Faults-2034"><a href="#-2034"><span class="linenos">2034</span></a>        <span class="n">theta</span> <span class="o">=</span> <span class="n">atan2</span><span class="p">(</span>
</span><span id="Faults-2035"><a href="#-2035"><span class="linenos">2035</span></a>            <span class="n">fraction</span>
</span><span id="Faults-2036"><a href="#-2036"><span class="linenos">2036</span></a>            <span class="o">*</span> <span class="n">sqrt</span><span class="p">((</span><span class="n">x0</span> <span class="o">-</span> <span class="n">array_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">y0</span> <span class="o">-</span> <span class="n">array_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">),</span>
</span><span id="Faults-2037"><a href="#-2037"><span class="linenos">2037</span></a>            <span class="n">array_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
</span><span id="Faults-2038"><a href="#-2038"><span class="linenos">2038</span></a>        <span class="p">)</span>
</span><span id="Faults-2039"><a href="#-2039"><span class="linenos">2039</span></a>        <span class="n">dip_angle</span> <span class="o">=</span> <span class="n">atan2</span><span class="p">(</span><span class="n">y0</span> <span class="o">-</span> <span class="n">array_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">x0</span> <span class="o">-</span> <span class="n">array_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="Faults-2040"><a href="#-2040"><span class="linenos">2040</span></a>
</span><span id="Faults-2041"><a href="#-2041"><span class="linenos">2041</span></a>        <span class="n">strike_unitvector</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
</span><span id="Faults-2042"><a href="#-2042"><span class="linenos">2042</span></a>            <span class="p">(</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">-</span> <span class="n">dip_angle</span><span class="p">),</span> <span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">-</span> <span class="n">dip_angle</span><span class="p">),</span> <span class="mf">0.0</span><span class="p">)</span>
</span><span id="Faults-2043"><a href="#-2043"><span class="linenos">2043</span></a>        <span class="p">)</span>
</span><span id="Faults-2044"><a href="#-2044"><span class="linenos">2044</span></a>        <span class="n">m0</span> <span class="o">=</span> <span class="n">m</span><span class="p">(</span><span class="n">strike_unitvector</span><span class="p">,</span> <span class="n">theta</span><span class="p">)</span>
</span><span id="Faults-2045"><a href="#-2045"><span class="linenos">2045</span></a>
</span><span id="Faults-2046"><a href="#-2046"><span class="linenos">2046</span></a>        <span class="n">outarray</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">m0</span><span class="p">,</span> <span class="n">inarray</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
</span><span id="Faults-2047"><a href="#-2047"><span class="linenos">2047</span></a>
</span><span id="Faults-2048"><a href="#-2048"><span class="linenos">2048</span></a>        <span class="k">return</span> <span class="n">outarray</span>
</span><span id="Faults-2049"><a href="#-2049"><span class="linenos">2049</span></a>
</span><span id="Faults-2050"><a href="#-2050"><span class="linenos">2050</span></a>    <span class="nd">@staticmethod</span>
</span><span id="Faults-2051"><a href="#-2051"><span class="linenos">2051</span></a>    <span class="k">def</span> <span class="nf">get_fault_plane_sobel</span><span class="p">(</span><span class="n">test_ellipsoid</span><span class="p">):</span>
</span><span id="Faults-2052"><a href="#-2052"><span class="linenos">2052</span></a>        <span class="kn">from</span> <span class="nn">scipy.ndimage</span> <span class="kn">import</span> <span class="n">sobel</span>
</span><span id="Faults-2053"><a href="#-2053"><span class="linenos">2053</span></a>        <span class="kn">from</span> <span class="nn">scipy.ndimage</span> <span class="kn">import</span> <span class="n">maximum_filter</span>
</span><span id="Faults-2054"><a href="#-2054"><span class="linenos">2054</span></a>
</span><span id="Faults-2055"><a href="#-2055"><span class="linenos">2055</span></a>        <span class="n">test_ellipsoid</span><span class="p">[</span><span class="n">test_ellipsoid</span> <span class="o">&lt;=</span> <span class="mf">1.0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="Faults-2056"><a href="#-2056"><span class="linenos">2056</span></a>        <span class="n">inside</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">test_ellipsoid</span><span class="p">)</span>
</span><span id="Faults-2057"><a href="#-2057"><span class="linenos">2057</span></a>        <span class="n">inside</span><span class="p">[</span><span class="n">test_ellipsoid</span> <span class="o">&lt;=</span> <span class="mf">1.0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="Faults-2058"><a href="#-2058"><span class="linenos">2058</span></a>        <span class="c1"># method 2</span>
</span><span id="Faults-2059"><a href="#-2059"><span class="linenos">2059</span></a>        <span class="n">edge</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="Faults-2060"><a href="#-2060"><span class="linenos">2060</span></a>            <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">sobel</span><span class="p">(</span><span class="n">inside</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
</span><span id="Faults-2061"><a href="#-2061"><span class="linenos">2061</span></a>            <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">sobel</span><span class="p">(</span><span class="n">inside</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
</span><span id="Faults-2062"><a href="#-2062"><span class="linenos">2062</span></a>            <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">sobel</span><span class="p">(</span><span class="n">inside</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">))</span>
</span><span id="Faults-2063"><a href="#-2063"><span class="linenos">2063</span></a>        <span class="p">)</span>
</span><span id="Faults-2064"><a href="#-2064"><span class="linenos">2064</span></a>        <span class="n">edge_max</span> <span class="o">=</span> <span class="n">maximum_filter</span><span class="p">(</span><span class="n">edge</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
</span><span id="Faults-2065"><a href="#-2065"><span class="linenos">2065</span></a>        <span class="n">edge_max</span><span class="p">[</span><span class="n">edge_max</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1e6</span>
</span><span id="Faults-2066"><a href="#-2066"><span class="linenos">2066</span></a>        <span class="n">fault_segments</span> <span class="o">=</span> <span class="n">edge</span> <span class="o">/</span> <span class="n">edge_max</span>
</span><span id="Faults-2067"><a href="#-2067"><span class="linenos">2067</span></a>        <span class="n">fault_segments</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">fault_segments</span><span class="p">)]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="Faults-2068"><a href="#-2068"><span class="linenos">2068</span></a>        <span class="n">fault_segments</span><span class="p">[</span><span class="n">fault_segments</span> <span class="o">&lt;</span> <span class="mf">0.5</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="Faults-2069"><a href="#-2069"><span class="linenos">2069</span></a>        <span class="n">fault_segments</span><span class="p">[</span><span class="n">fault_segments</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="Faults-2070"><a href="#-2070"><span class="linenos">2070</span></a>        <span class="k">return</span> <span class="n">fault_segments</span>
</span><span id="Faults-2071"><a href="#-2071"><span class="linenos">2071</span></a>
</span><span id="Faults-2072"><a href="#-2072"><span class="linenos">2072</span></a>    <span class="k">def</span> <span class="nf">get_fault_centre</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ellipsoid</span><span class="p">,</span> <span class="n">wb_time_map</span><span class="p">,</span> <span class="n">z_on_ellipse</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
</span><span id="Faults-2073"><a href="#-2073"><span class="linenos">2073</span></a>        <span class="k">def</span> <span class="nf">find_nearest</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
</span><span id="Faults-2074"><a href="#-2074"><span class="linenos">2074</span></a>            <span class="n">idx</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">array</span> <span class="o">-</span> <span class="n">value</span><span class="p">))</span><span class="o">.</span><span class="n">argmin</span><span class="p">()</span>
</span><span id="Faults-2075"><a href="#-2075"><span class="linenos">2075</span></a>            <span class="k">return</span> <span class="n">array</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
</span><span id="Faults-2076"><a href="#-2076"><span class="linenos">2076</span></a>
</span><span id="Faults-2077"><a href="#-2077"><span class="linenos">2077</span></a>        <span class="k">def</span> <span class="nf">intersec</span><span class="p">(</span><span class="n">ell</span><span class="p">,</span> <span class="n">thresh</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">):</span>
</span><span id="Faults-2078"><a href="#-2078"><span class="linenos">2078</span></a>            <span class="n">abc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
</span><span id="Faults-2079"><a href="#-2079"><span class="linenos">2079</span></a>                <span class="p">(</span><span class="n">ell</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">thresh</span><span class="p">))</span>
</span><span id="Faults-2080"><a href="#-2080"><span class="linenos">2080</span></a>                <span class="o">&amp;</span> <span class="p">(</span><span class="n">ell</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">thresh</span><span class="p">))</span>
</span><span id="Faults-2081"><a href="#-2081"><span class="linenos">2081</span></a>            <span class="p">)</span>
</span><span id="Faults-2082"><a href="#-2082"><span class="linenos">2082</span></a>            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">abc</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Faults-2083"><a href="#-2083"><span class="linenos">2083</span></a>                <span class="n">direction</span> <span class="o">=</span> <span class="n">find_nearest</span><span class="p">(</span><span class="n">abc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="Faults-2084"><a href="#-2084"><span class="linenos">2084</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Faults-2085"><a href="#-2085"><span class="linenos">2085</span></a>                <span class="n">direction</span> <span class="o">=</span> <span class="mi">9999</span>
</span><span id="Faults-2086"><a href="#-2086"><span class="linenos">2086</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="Faults-2087"><a href="#-2087"><span class="linenos">2087</span></a>                <span class="s2">&quot;   ... computing intersection points between ellipsoid and cube, raise error if none found&quot;</span>
</span><span id="Faults-2088"><a href="#-2088"><span class="linenos">2088</span></a>            <span class="p">)</span>
</span><span id="Faults-2089"><a href="#-2089"><span class="linenos">2089</span></a>            <span class="n">xdir_min</span> <span class="o">=</span> <span class="n">intersec</span><span class="p">(</span><span class="n">ell</span><span class="p">,</span> <span class="n">thresh</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">z</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="Faults-2090"><a href="#-2090"><span class="linenos">2090</span></a>            <span class="n">xdir_max</span> <span class="o">=</span> <span class="n">intersec</span><span class="p">(</span><span class="n">ell</span><span class="p">,</span> <span class="n">thresh</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">z</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="Faults-2091"><a href="#-2091"><span class="linenos">2091</span></a>            <span class="n">ydir_min</span> <span class="o">=</span> <span class="n">intersec</span><span class="p">(</span><span class="n">ell</span><span class="p">,</span> <span class="n">thresh</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="Faults-2092"><a href="#-2092"><span class="linenos">2092</span></a>            <span class="n">ydir_max</span> <span class="o">=</span> <span class="n">intersec</span><span class="p">(</span><span class="n">ell</span><span class="p">,</span> <span class="n">thresh</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="Faults-2093"><a href="#-2093"><span class="linenos">2093</span></a>
</span><span id="Faults-2094"><a href="#-2094"><span class="linenos">2094</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    ... xdir_min coord = &quot;</span><span class="p">,</span> <span class="n">xdir_min</span><span class="p">,</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">z</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="Faults-2095"><a href="#-2095"><span class="linenos">2095</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    ... xdir_max coord = &quot;</span><span class="p">,</span> <span class="n">xdir_max</span><span class="p">,</span> <span class="n">y</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">z</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="Faults-2096"><a href="#-2096"><span class="linenos">2096</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    ... ydir_min coord = &quot;</span><span class="p">,</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ydir_min</span><span class="p">,</span> <span class="n">z</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="Faults-2097"><a href="#-2097"><span class="linenos">2097</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    ... ydir_max coord = &quot;</span><span class="p">,</span> <span class="n">y</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">ydir_max</span><span class="p">,</span> <span class="n">z</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="Faults-2098"><a href="#-2098"><span class="linenos">2098</span></a>            <span class="k">return</span> <span class="n">direction</span>
</span><span id="Faults-2099"><a href="#-2099"><span class="linenos">2099</span></a>
</span><span id="Faults-2100"><a href="#-2100"><span class="linenos">2100</span></a>        <span class="k">def</span> <span class="nf">get_middle_z</span><span class="p">(</span><span class="n">ellipse</span><span class="p">,</span> <span class="n">wb_map</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="Faults-2101"><a href="#-2101"><span class="linenos">2101</span></a>            <span class="c1"># Retrieve indices and cube of point on the ellipsoid and under the sea bed</span>
</span><span id="Faults-2102"><a href="#-2102"><span class="linenos">2102</span></a>
</span><span id="Faults-2103"><a href="#-2103"><span class="linenos">2103</span></a>            <span class="n">random_idx</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Faults-2104"><a href="#-2104"><span class="linenos">2104</span></a>            <span class="n">do_it</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Faults-2105"><a href="#-2105"><span class="linenos">2105</span></a>            <span class="n">origtime</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">ellipse</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
</span><span id="Faults-2106"><a href="#-2106"><span class="linenos">2106</span></a>            <span class="n">wb_time_cube</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span>
</span><span id="Faults-2107"><a href="#-2107"><span class="linenos">2107</span></a>                <span class="n">wb_map</span><span class="p">,</span> <span class="p">(</span><span class="n">wb_map</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">wb_map</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="Faults-2108"><a href="#-2108"><span class="linenos">2108</span></a>            <span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">origtime</span><span class="p">)</span>
</span><span id="Faults-2109"><a href="#-2109"><span class="linenos">2109</span></a>            <span class="n">abc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">z_on_ellipse</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">((</span><span class="n">wb_time_cube</span> <span class="o">-</span> <span class="n">origtime</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">))</span>
</span><span id="Faults-2110"><a href="#-2110"><span class="linenos">2110</span></a>            <span class="n">xyz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span><span class="n">abc</span><span class="p">)</span>
</span><span id="Faults-2111"><a href="#-2111"><span class="linenos">2111</span></a>            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="Faults-2112"><a href="#-2112"><span class="linenos">2112</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;     ... xyz.shape  = &quot;</span><span class="p">,</span> <span class="n">xyz</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span><span id="Faults-2113"><a href="#-2113"><span class="linenos">2113</span></a>            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">abc</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Faults-2114"><a href="#-2114"><span class="linenos">2114</span></a>                <span class="n">xyz_xyz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
</span><span id="Faults-2115"><a href="#-2115"><span class="linenos">2115</span></a>                <span class="n">threshold_center</span> <span class="o">=</span> <span class="mi">5</span>
</span><span id="Faults-2116"><a href="#-2116"><span class="linenos">2116</span></a>                <span class="k">while</span> <span class="n">xyz_xyz</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Faults-2117"><a href="#-2117"><span class="linenos">2117</span></a>                    <span class="k">if</span> <span class="n">threshold_center</span> <span class="o">&lt;</span> <span class="n">z_on_ellipse</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
</span><span id="Faults-2118"><a href="#-2118"><span class="linenos">2118</span></a>                        <span class="n">z_middle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
</span><span id="Faults-2119"><a href="#-2119"><span class="linenos">2119</span></a>                            <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">xyz</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="nb">int</span><span class="p">((</span><span class="n">xyz</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">+</span> <span class="n">xyz</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
</span><span id="Faults-2120"><a href="#-2120"><span class="linenos">2120</span></a>                            <span class="o">&lt;</span> <span class="n">threshold_center</span>
</span><span id="Faults-2121"><a href="#-2121"><span class="linenos">2121</span></a>                        <span class="p">)</span>
</span><span id="Faults-2122"><a href="#-2122"><span class="linenos">2122</span></a>                        <span class="n">xyz_z</span> <span class="o">=</span> <span class="n">xyz</span><span class="p">[:,</span> <span class="n">z_middle</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Faults-2123"><a href="#-2123"><span class="linenos">2123</span></a>                        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="Faults-2124"><a href="#-2124"><span class="linenos">2124</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;     ... xyz_z.shape  = &quot;</span><span class="p">,</span> <span class="n">xyz_z</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span><span id="Faults-2125"><a href="#-2125"><span class="linenos">2125</span></a>                        <span class="k">if</span> <span class="n">xyz_z</span><span class="o">.</span><span class="n">size</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Faults-2126"><a href="#-2126"><span class="linenos">2126</span></a>                            <span class="n">x_middle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
</span><span id="Faults-2127"><a href="#-2127"><span class="linenos">2127</span></a>                                <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span>
</span><span id="Faults-2128"><a href="#-2128"><span class="linenos">2128</span></a>                                    <span class="n">xyz_z</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Faults-2129"><a href="#-2129"><span class="linenos">2129</span></a>                                    <span class="o">-</span> <span class="nb">int</span><span class="p">((</span><span class="n">xyz_z</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">+</span> <span class="n">xyz_z</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="Faults-2130"><a href="#-2130"><span class="linenos">2130</span></a>                                <span class="p">)</span>
</span><span id="Faults-2131"><a href="#-2131"><span class="linenos">2131</span></a>                                <span class="o">&lt;</span> <span class="n">threshold_center</span>
</span><span id="Faults-2132"><a href="#-2132"><span class="linenos">2132</span></a>                            <span class="p">)</span>
</span><span id="Faults-2133"><a href="#-2133"><span class="linenos">2133</span></a>                            <span class="n">xyz_xz</span> <span class="o">=</span> <span class="n">xyz_z</span><span class="p">[:,</span> <span class="n">x_middle</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Faults-2134"><a href="#-2134"><span class="linenos">2134</span></a>                            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="Faults-2135"><a href="#-2135"><span class="linenos">2135</span></a>                                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;     ... xyz_xz.shape  = &quot;</span><span class="p">,</span> <span class="n">xyz_xz</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span><span id="Faults-2136"><a href="#-2136"><span class="linenos">2136</span></a>                            <span class="k">if</span> <span class="n">xyz_xz</span><span class="o">.</span><span class="n">size</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Faults-2137"><a href="#-2137"><span class="linenos">2137</span></a>                                <span class="n">y_middle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
</span><span id="Faults-2138"><a href="#-2138"><span class="linenos">2138</span></a>                                    <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span>
</span><span id="Faults-2139"><a href="#-2139"><span class="linenos">2139</span></a>                                        <span class="n">xyz_xz</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="Faults-2140"><a href="#-2140"><span class="linenos">2140</span></a>                                        <span class="o">-</span> <span class="nb">int</span><span class="p">((</span><span class="n">xyz_xz</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">+</span> <span class="n">xyz_xz</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="Faults-2141"><a href="#-2141"><span class="linenos">2141</span></a>                                    <span class="p">)</span>
</span><span id="Faults-2142"><a href="#-2142"><span class="linenos">2142</span></a>                                    <span class="o">&lt;</span> <span class="n">threshold_center</span>
</span><span id="Faults-2143"><a href="#-2143"><span class="linenos">2143</span></a>                                <span class="p">)</span>
</span><span id="Faults-2144"><a href="#-2144"><span class="linenos">2144</span></a>                                <span class="n">xyz_xyz</span> <span class="o">=</span> <span class="n">xyz_xz</span><span class="p">[:,</span> <span class="n">y_middle</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Faults-2145"><a href="#-2145"><span class="linenos">2145</span></a>                                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="Faults-2146"><a href="#-2146"><span class="linenos">2146</span></a>                                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;     ... xyz_xyz.shape  = &quot;</span><span class="p">,</span> <span class="n">xyz_xyz</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span><span id="Faults-2147"><a href="#-2147"><span class="linenos">2147</span></a>                        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="Faults-2148"><a href="#-2148"><span class="linenos">2148</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;     ... z for upper intersection  = &quot;</span><span class="p">,</span> <span class="n">xyz</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
</span><span id="Faults-2149"><a href="#-2149"><span class="linenos">2149</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;     ... z for lower intersection  = &quot;</span><span class="p">,</span> <span class="n">xyz</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
</span><span id="Faults-2150"><a href="#-2150"><span class="linenos">2150</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;     ... threshold_center used = &quot;</span><span class="p">,</span> <span class="n">threshold_center</span><span class="p">)</span>
</span><span id="Faults-2151"><a href="#-2151"><span class="linenos">2151</span></a>                        <span class="n">threshold_center</span> <span class="o">+=</span> <span class="mi">5</span>
</span><span id="Faults-2152"><a href="#-2152"><span class="linenos">2152</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="Faults-2153"><a href="#-2153"><span class="linenos">2153</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   ... Break the loop, could not find a suitable point&quot;</span><span class="p">)</span>
</span><span id="Faults-2154"><a href="#-2154"><span class="linenos">2154</span></a>                        <span class="n">random_idx</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Faults-2155"><a href="#-2155"><span class="linenos">2155</span></a>                        <span class="n">do_it</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Faults-2156"><a href="#-2156"><span class="linenos">2156</span></a>                        <span class="k">break</span>
</span><span id="Faults-2157"><a href="#-2157"><span class="linenos">2157</span></a>                <span class="k">if</span> <span class="n">do_it</span><span class="p">:</span>
</span><span id="Faults-2158"><a href="#-2158"><span class="linenos">2158</span></a>                    <span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">random</span>
</span><span id="Faults-2159"><a href="#-2159"><span class="linenos">2159</span></a>
</span><span id="Faults-2160"><a href="#-2160"><span class="linenos">2160</span></a>                    <span class="n">random_idx</span> <span class="o">=</span> <span class="n">xyz_xyz</span><span class="p">[:,</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">xyz_xyz</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>
</span><span id="Faults-2161"><a href="#-2161"><span class="linenos">2161</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="Faults-2162"><a href="#-2162"><span class="linenos">2162</span></a>                        <span class="s2">&quot;   ... Computing fault middle to hang max displacement function&quot;</span>
</span><span id="Faults-2163"><a href="#-2163"><span class="linenos">2163</span></a>                    <span class="p">)</span>
</span><span id="Faults-2164"><a href="#-2164"><span class="linenos">2164</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    ... x idx for max displacement  = &quot;</span><span class="p">,</span> <span class="n">random_idx</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="Faults-2165"><a href="#-2165"><span class="linenos">2165</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    ... y idx for max displacement  = &quot;</span><span class="p">,</span> <span class="n">random_idx</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="Faults-2166"><a href="#-2166"><span class="linenos">2166</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    ... z idx for max displacement  = &quot;</span><span class="p">,</span> <span class="n">random_idx</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</span><span id="Faults-2167"><a href="#-2167"><span class="linenos">2167</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="Faults-2168"><a href="#-2168"><span class="linenos">2168</span></a>                        <span class="s2">&quot;    ... ellipsoid value  = &quot;</span><span class="p">,</span>
</span><span id="Faults-2169"><a href="#-2169"><span class="linenos">2169</span></a>                        <span class="n">ellipse</span><span class="p">[</span><span class="n">random_idx</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">random_idx</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">random_idx</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span>
</span><span id="Faults-2170"><a href="#-2170"><span class="linenos">2170</span></a>                    <span class="p">)</span>
</span><span id="Faults-2171"><a href="#-2171"><span class="linenos">2171</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Faults-2172"><a href="#-2172"><span class="linenos">2172</span></a>                <span class="nb">print</span><span class="p">(</span>
</span><span id="Faults-2173"><a href="#-2173"><span class="linenos">2173</span></a>                    <span class="s2">&quot;    ... Empty intersection between fault and cube, assign d-max at cube lower corner&quot;</span>
</span><span id="Faults-2174"><a href="#-2174"><span class="linenos">2174</span></a>                <span class="p">)</span>
</span><span id="Faults-2175"><a href="#-2175"><span class="linenos">2175</span></a>
</span><span id="Faults-2176"><a href="#-2176"><span class="linenos">2176</span></a>            <span class="k">return</span> <span class="n">random_idx</span>
</span><span id="Faults-2177"><a href="#-2177"><span class="linenos">2177</span></a>
</span><span id="Faults-2178"><a href="#-2178"><span class="linenos">2178</span></a>        <span class="n">z_idx</span> <span class="o">=</span> <span class="n">get_middle_z</span><span class="p">(</span><span class="n">ellipsoid</span><span class="p">,</span> <span class="n">wb_time_map</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>
</span><span id="Faults-2179"><a href="#-2179"><span class="linenos">2179</span></a>        <span class="k">return</span> <span class="n">z_idx</span>
</span><span id="Faults-2180"><a href="#-2180"><span class="linenos">2180</span></a>
</span><span id="Faults-2181"><a href="#-2181"><span class="linenos">2181</span></a>    <span class="k">def</span> <span class="nf">xyz_dis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">z_idx</span><span class="p">,</span> <span class="n">throw</span><span class="p">,</span> <span class="n">z_on_ellipse</span><span class="p">,</span> <span class="n">ellipsoid</span><span class="p">,</span> <span class="n">wb</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
</span><span id="Faults-2182"><a href="#-2182"><span class="linenos">2182</span></a>        <span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">interpolate</span><span class="p">,</span> <span class="n">signal</span>
</span><span id="Faults-2183"><a href="#-2183"><span class="linenos">2183</span></a>        <span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">atan2</span><span class="p">,</span> <span class="n">degrees</span>
</span><span id="Faults-2184"><a href="#-2184"><span class="linenos">2184</span></a>        <span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">multivariate_normal</span>
</span><span id="Faults-2185"><a href="#-2185"><span class="linenos">2185</span></a>        <span class="kn">from</span> <span class="nn">scipy.ndimage.interpolation</span> <span class="kn">import</span> <span class="n">rotate</span>
</span><span id="Faults-2186"><a href="#-2186"><span class="linenos">2186</span></a>
</span><span id="Faults-2187"><a href="#-2187"><span class="linenos">2187</span></a>        <span class="n">cube_shape</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">geologic_age</span><span class="o">.</span><span class="n">shape</span>
</span><span id="Faults-2188"><a href="#-2188"><span class="linenos">2188</span></a>
</span><span id="Faults-2189"><a href="#-2189"><span class="linenos">2189</span></a>        <span class="k">def</span> <span class="nf">u_gaussian</span><span class="p">(</span><span class="n">d_max</span><span class="p">,</span> <span class="n">sig</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span> <span class="n">points</span><span class="p">):</span>
</span><span id="Faults-2190"><a href="#-2190"><span class="linenos">2190</span></a>            <span class="kn">from</span> <span class="nn">scipy.signal.windows</span> <span class="kn">import</span> <span class="n">general_gaussian</span>
</span><span id="Faults-2191"><a href="#-2191"><span class="linenos">2191</span></a>
</span><span id="Faults-2192"><a href="#-2192"><span class="linenos">2192</span></a>            <span class="k">return</span> <span class="n">d_max</span> <span class="o">*</span> <span class="n">general_gaussian</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">(</span><span class="n">sig</span><span class="p">))</span>
</span><span id="Faults-2193"><a href="#-2193"><span class="linenos">2193</span></a>
</span><span id="Faults-2194"><a href="#-2194"><span class="linenos">2194</span></a>        <span class="c1"># Choose random values sigma, p and coef</span>
</span><span id="Faults-2195"><a href="#-2195"><span class="linenos">2195</span></a>        <span class="n">sigma</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="mi">10</span> <span class="o">*</span> <span class="n">throw</span> <span class="o">-</span> <span class="mi">50</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
</span><span id="Faults-2196"><a href="#-2196"><span class="linenos">2196</span></a>        <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</span><span id="Faults-2197"><a href="#-2197"><span class="linenos">2197</span></a>        <span class="n">coef</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">1.3</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">)</span>
</span><span id="Faults-2198"><a href="#-2198"><span class="linenos">2198</span></a>
</span><span id="Faults-2199"><a href="#-2199"><span class="linenos">2199</span></a>        <span class="c1"># Fault plane</span>
</span><span id="Faults-2200"><a href="#-2200"><span class="linenos">2200</span></a>        <span class="n">infill_factor</span> <span class="o">=</span> <span class="mf">0.5</span>
</span><span id="Faults-2201"><a href="#-2201"><span class="linenos">2201</span></a>        <span class="n">origtime</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">cube_shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</span><span id="Faults-2202"><a href="#-2202"><span class="linenos">2202</span></a>        <span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;int&quot;</span><span class="p">)</span>
</span><span id="Faults-2203"><a href="#-2203"><span class="linenos">2203</span></a>        <span class="c1"># Define Gaussian max throw and roll it to chosen z</span>
</span><span id="Faults-2204"><a href="#-2204"><span class="linenos">2204</span></a>        <span class="c1"># Gaussian should be defined on at least 5 sigma on each side</span>
</span><span id="Faults-2205"><a href="#-2205"><span class="linenos">2205</span></a>        <span class="n">roll_int</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">10</span> <span class="o">*</span> <span class="n">sigma</span><span class="p">)</span>
</span><span id="Faults-2206"><a href="#-2206"><span class="linenos">2206</span></a>        <span class="n">g</span> <span class="o">=</span> <span class="n">u_gaussian</span><span class="p">(</span><span class="n">throw</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">cube_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">roll_int</span><span class="p">)</span>
</span><span id="Faults-2207"><a href="#-2207"><span class="linenos">2207</span></a>        <span class="c1"># Pad signal by 10*sigma before rolling</span>
</span><span id="Faults-2208"><a href="#-2208"><span class="linenos">2208</span></a>        <span class="n">g_padded_rolled</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">(</span><span class="n">z_idx</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">g</span><span class="o">.</span><span class="n">argmax</span><span class="p">()</span> <span class="o">+</span> <span class="n">roll_int</span><span class="p">))</span>
</span><span id="Faults-2209"><a href="#-2209"><span class="linenos">2209</span></a>        <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Faults-2210"><a href="#-2210"><span class="linenos">2210</span></a>        <span class="n">wb_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">z_on_ellipse</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Faults-2211"><a href="#-2211"><span class="linenos">2211</span></a>        <span class="n">wb_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">z_on_ellipse</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="Faults-2212"><a href="#-2212"><span class="linenos">2212</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   ... Taper fault so it doesn&#39;t reach seabed&quot;</span><span class="p">)</span>
</span><span id="Faults-2213"><a href="#-2213"><span class="linenos">2213</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    ... Sea floor max = </span><span class="si">{</span><span class="n">wb</span><span class="p">[</span><span class="n">wb_x</span><span class="p">,</span> <span class="n">wb_y</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Faults-2214"><a href="#-2214"><span class="linenos">2214</span></a>        <span class="c1"># Shift Z throw so that id doesn&#39;t cross sea bed</span>
</span><span id="Faults-2215"><a href="#-2215"><span class="linenos">2215</span></a>        <span class="k">while</span> <span class="n">g_padded_rolled</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">roll_int</span> <span class="o">+</span> <span class="n">wb</span><span class="p">[</span><span class="n">wb_x</span><span class="p">,</span> <span class="n">wb_y</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Faults-2216"><a href="#-2216"><span class="linenos">2216</span></a>            <span class="n">g_padded_rolled</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">g_padded_rolled</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
</span><span id="Faults-2217"><a href="#-2217"><span class="linenos">2217</span></a>            <span class="n">count</span> <span class="o">+=</span> <span class="mi">5</span>
</span><span id="Faults-2218"><a href="#-2218"><span class="linenos">2218</span></a>            <span class="c1"># Break loop if can&#39;t find spot</span>
</span><span id="Faults-2219"><a href="#-2219"><span class="linenos">2219</span></a>            <span class="k">if</span> <span class="n">count</span> <span class="o">&gt;</span> <span class="n">cube_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">wb</span><span class="p">[</span><span class="n">wb_x</span><span class="p">,</span> <span class="n">wb_y</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">():</span>
</span><span id="Faults-2220"><a href="#-2220"><span class="linenos">2220</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    ... Too many rolled sample, seafloor will not have 0 throw&quot;</span><span class="p">)</span>
</span><span id="Faults-2221"><a href="#-2221"><span class="linenos">2221</span></a>                <span class="k">break</span>
</span><span id="Faults-2222"><a href="#-2222"><span class="linenos">2222</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   ... Vertical throw shifted by </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">count</span><span class="p">)</span><span class="si">}</span><span class="s2"> samples&quot;</span><span class="p">)</span>
</span><span id="Faults-2223"><a href="#-2223"><span class="linenos">2223</span></a>        <span class="n">g_centered</span> <span class="o">=</span> <span class="n">g_padded_rolled</span><span class="p">[</span><span class="n">roll_int</span> <span class="p">:</span> <span class="n">cube_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">roll_int</span><span class="p">]</span>
</span><span id="Faults-2224"><a href="#-2224"><span class="linenos">2224</span></a>
</span><span id="Faults-2225"><a href="#-2225"><span class="linenos">2225</span></a>        <span class="n">ff</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">g_centered</span><span class="p">)</span>
</span><span id="Faults-2226"><a href="#-2226"><span class="linenos">2226</span></a>        <span class="n">z_shift</span> <span class="o">=</span> <span class="n">ff</span>
</span><span id="Faults-2227"><a href="#-2227"><span class="linenos">2227</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   ... Computing Gaussian distribution function&quot;</span><span class="p">)</span>
</span><span id="Faults-2228"><a href="#-2228"><span class="linenos">2228</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    ... Max displacement  = </span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">throw</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Faults-2229"><a href="#-2229"><span class="linenos">2229</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    ... Sigma  = </span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">sigma</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Faults-2230"><a href="#-2230"><span class="linenos">2230</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    ... P  = </span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Faults-2231"><a href="#-2231"><span class="linenos">2231</span></a>
</span><span id="Faults-2232"><a href="#-2232"><span class="linenos">2232</span></a>        <span class="n">low_fault_throw</span> <span class="o">=</span> <span class="mi">5</span>
</span><span id="Faults-2233"><a href="#-2233"><span class="linenos">2233</span></a>        <span class="n">high_fault_throw</span> <span class="o">=</span> <span class="mi">35</span>
</span><span id="Faults-2234"><a href="#-2234"><span class="linenos">2234</span></a>        <span class="c1"># Parameters to set ratio of 1.4 seems to be optimal for a 1500x1500 grid</span>
</span><span id="Faults-2235"><a href="#-2235"><span class="linenos">2235</span></a>        <span class="n">mu_x</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Faults-2236"><a href="#-2236"><span class="linenos">2236</span></a>        <span class="n">mu_y</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Faults-2237"><a href="#-2237"><span class="linenos">2237</span></a>
</span><span id="Faults-2238"><a href="#-2238"><span class="linenos">2238</span></a>        <span class="c1"># Use throw to get length</span>
</span><span id="Faults-2239"><a href="#-2239"><span class="linenos">2239</span></a>        <span class="n">throw_range</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">low_fault_throw</span><span class="p">,</span> <span class="n">high_fault_throw</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="Faults-2240"><a href="#-2240"><span class="linenos">2240</span></a>        <span class="c1"># Max throw vs length relationship</span>
</span><span id="Faults-2241"><a href="#-2241"><span class="linenos">2241</span></a>        <span class="n">fault_length</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="mf">0.0013</span> <span class="o">*</span> <span class="n">throw_range</span><span class="p">,</span> <span class="mf">1.3258</span><span class="p">)</span>
</span><span id="Faults-2242"><a href="#-2242"><span class="linenos">2242</span></a>        <span class="c1"># Max throw == 16000</span>
</span><span id="Faults-2243"><a href="#-2243"><span class="linenos">2243</span></a>        <span class="n">scale_factor</span> <span class="o">=</span> <span class="mi">16000</span> <span class="o">/</span> <span class="n">fault_length</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="Faults-2244"><a href="#-2244"><span class="linenos">2244</span></a>        <span class="c1"># Coef random selection moved to top of function</span>
</span><span id="Faults-2245"><a href="#-2245"><span class="linenos">2245</span></a>        <span class="n">variance_x</span> <span class="o">=</span> <span class="n">scale_factor</span> <span class="o">*</span> <span class="n">fault_length</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">throw_range</span> <span class="o">==</span> <span class="nb">int</span><span class="p">(</span><span class="n">throw</span><span class="p">))]</span>
</span><span id="Faults-2246"><a href="#-2246"><span class="linenos">2246</span></a>        <span class="n">variance_y</span> <span class="o">=</span> <span class="n">variance_x</span> <span class="o">*</span> <span class="n">coef</span>
</span><span id="Faults-2247"><a href="#-2247"><span class="linenos">2247</span></a>        <span class="c1"># Do the same for the drag zone area</span>
</span><span id="Faults-2248"><a href="#-2248"><span class="linenos">2248</span></a>        <span class="n">fault_length_drag</span> <span class="o">=</span> <span class="n">fault_length</span> <span class="o">/</span> <span class="mi">10000</span>
</span><span id="Faults-2249"><a href="#-2249"><span class="linenos">2249</span></a>        <span class="n">variance_x_drag</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="Faults-2250"><a href="#-2250"><span class="linenos">2250</span></a>            <span class="n">scale_factor</span> <span class="o">*</span> <span class="n">fault_length_drag</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">throw_range</span> <span class="o">==</span> <span class="nb">int</span><span class="p">(</span><span class="n">throw</span><span class="p">))]</span>
</span><span id="Faults-2251"><a href="#-2251"><span class="linenos">2251</span></a>        <span class="p">)</span>
</span><span id="Faults-2252"><a href="#-2252"><span class="linenos">2252</span></a>        <span class="n">variance_y_drag</span> <span class="o">=</span> <span class="n">variance_x_drag</span> <span class="o">*</span> <span class="n">coef</span>
</span><span id="Faults-2253"><a href="#-2253"><span class="linenos">2253</span></a>        <span class="c1"># Rotation from z_idx to center</span>
</span><span id="Faults-2254"><a href="#-2254"><span class="linenos">2254</span></a>        <span class="n">alpha</span> <span class="o">=</span> <span class="n">atan2</span><span class="p">(</span><span class="n">z_idx</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">cube_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">z_idx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">cube_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="Faults-2255"><a href="#-2255"><span class="linenos">2255</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    ... Variance_x, Variance_y = </span><span class="si">{</span><span class="n">variance_x</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">variance_y</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Faults-2256"><a href="#-2256"><span class="linenos">2256</span></a>        <span class="nb">print</span><span class="p">(</span>
</span><span id="Faults-2257"><a href="#-2257"><span class="linenos">2257</span></a>            <span class="sa">f</span><span class="s2">&quot;    ... Angle between max displacement point tangent plane and cube = </span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">degrees</span><span class="p">(</span><span class="n">alpha</span><span class="p">))</span><span class="si">}</span><span class="s2"> Degrees&quot;</span>
</span><span id="Faults-2258"><a href="#-2258"><span class="linenos">2258</span></a>        <span class="p">)</span>
</span><span id="Faults-2259"><a href="#-2259"><span class="linenos">2259</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    ... Max displacement point at x,y,z = </span><span class="si">{</span><span class="n">z_idx</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Faults-2260"><a href="#-2260"><span class="linenos">2260</span></a>
</span><span id="Faults-2261"><a href="#-2261"><span class="linenos">2261</span></a>        <span class="c1"># Create grid and multivariate normal</span>
</span><span id="Faults-2262"><a href="#-2262"><span class="linenos">2262</span></a>        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span>
</span><span id="Faults-2263"><a href="#-2263"><span class="linenos">2263</span></a>            <span class="o">-</span><span class="nb">int</span><span class="p">(</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mf">1.5</span> <span class="o">*</span> <span class="n">cube_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
</span><span id="Faults-2264"><a href="#-2264"><span class="linenos">2264</span></a>            <span class="nb">int</span><span class="p">(</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mf">1.5</span> <span class="o">*</span> <span class="n">cube_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
</span><span id="Faults-2265"><a href="#-2265"><span class="linenos">2265</span></a>            <span class="mi">2</span> <span class="o">*</span> <span class="nb">int</span><span class="p">(</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mf">1.5</span> <span class="o">*</span> <span class="n">cube_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
</span><span id="Faults-2266"><a href="#-2266"><span class="linenos">2266</span></a>        <span class="p">)</span>
</span><span id="Faults-2267"><a href="#-2267"><span class="linenos">2267</span></a>        <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span>
</span><span id="Faults-2268"><a href="#-2268"><span class="linenos">2268</span></a>            <span class="o">-</span><span class="nb">int</span><span class="p">(</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mf">1.5</span> <span class="o">*</span> <span class="n">cube_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
</span><span id="Faults-2269"><a href="#-2269"><span class="linenos">2269</span></a>            <span class="nb">int</span><span class="p">(</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mf">1.5</span> <span class="o">*</span> <span class="n">cube_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
</span><span id="Faults-2270"><a href="#-2270"><span class="linenos">2270</span></a>            <span class="mi">2</span> <span class="o">*</span> <span class="nb">int</span><span class="p">(</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mf">1.5</span> <span class="o">*</span> <span class="n">cube_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
</span><span id="Faults-2271"><a href="#-2271"><span class="linenos">2271</span></a>        <span class="p">)</span>
</span><span id="Faults-2272"><a href="#-2272"><span class="linenos">2272</span></a>        <span class="n">_x</span><span class="p">,</span> <span class="n">_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</span><span id="Faults-2273"><a href="#-2273"><span class="linenos">2273</span></a>        <span class="n">pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">_x</span><span class="o">.</span><span class="n">shape</span> <span class="o">+</span> <span class="p">(</span><span class="mi">2</span><span class="p">,))</span>
</span><span id="Faults-2274"><a href="#-2274"><span class="linenos">2274</span></a>        <span class="n">pos</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">_x</span>
</span><span id="Faults-2275"><a href="#-2275"><span class="linenos">2275</span></a>        <span class="n">pos</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">_y</span>
</span><span id="Faults-2276"><a href="#-2276"><span class="linenos">2276</span></a>        <span class="n">rv</span> <span class="o">=</span> <span class="n">multivariate_normal</span><span class="p">([</span><span class="n">mu_x</span><span class="p">,</span> <span class="n">mu_y</span><span class="p">],</span> <span class="p">[[</span><span class="n">variance_x</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">variance_y</span><span class="p">]])</span>
</span><span id="Faults-2277"><a href="#-2277"><span class="linenos">2277</span></a>        <span class="n">rv_drag</span> <span class="o">=</span> <span class="n">multivariate_normal</span><span class="p">(</span>
</span><span id="Faults-2278"><a href="#-2278"><span class="linenos">2278</span></a>            <span class="p">[</span><span class="n">mu_x</span><span class="p">,</span> <span class="n">mu_y</span><span class="p">],</span> <span class="p">[[</span><span class="n">variance_x_drag</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">variance_y_drag</span><span class="p">]]</span>
</span><span id="Faults-2279"><a href="#-2279"><span class="linenos">2279</span></a>        <span class="p">)</span>
</span><span id="Faults-2280"><a href="#-2280"><span class="linenos">2280</span></a>        <span class="c1"># Scale up by mu order of magnitude and swap axes</span>
</span><span id="Faults-2281"><a href="#-2281"><span class="linenos">2281</span></a>        <span class="n">xy_dis</span> <span class="o">=</span> <span class="mi">10000</span> <span class="o">*</span> <span class="p">(</span><span class="n">rv</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">pos</span><span class="p">))</span>
</span><span id="Faults-2282"><a href="#-2282"><span class="linenos">2282</span></a>        <span class="n">xy_dis_drag</span> <span class="o">=</span> <span class="mi">10000</span> <span class="o">*</span> <span class="p">(</span><span class="n">rv_drag</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">pos</span><span class="p">))</span>
</span><span id="Faults-2283"><a href="#-2283"><span class="linenos">2283</span></a>
</span><span id="Faults-2284"><a href="#-2284"><span class="linenos">2284</span></a>        <span class="c1"># Normalize</span>
</span><span id="Faults-2285"><a href="#-2285"><span class="linenos">2285</span></a>        <span class="n">xy_dis</span> <span class="o">=</span> <span class="n">xy_dis</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="n">xy_dis</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span>
</span><span id="Faults-2286"><a href="#-2286"><span class="linenos">2286</span></a>        <span class="n">xy_dis_drag</span> <span class="o">=</span> <span class="p">(</span><span class="n">xy_dis_drag</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="n">xy_dis_drag</span><span class="o">.</span><span class="n">flatten</span><span class="p">()))</span> <span class="o">*</span> <span class="mf">0.99</span>
</span><span id="Faults-2287"><a href="#-2287"><span class="linenos">2287</span></a>
</span><span id="Faults-2288"><a href="#-2288"><span class="linenos">2288</span></a>        <span class="c1"># Rotate plane by alpha</span>
</span><span id="Faults-2289"><a href="#-2289"><span class="linenos">2289</span></a>        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">cube_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cube_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="Faults-2290"><a href="#-2290"><span class="linenos">2290</span></a>        <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">cube_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">cube_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="Faults-2291"><a href="#-2291"><span class="linenos">2291</span></a>        <span class="n">_x</span><span class="p">,</span> <span class="n">_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</span><span id="Faults-2292"><a href="#-2292"><span class="linenos">2292</span></a>        <span class="n">xy_dis_rotated</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">xy_dis</span><span class="p">)</span>
</span><span id="Faults-2293"><a href="#-2293"><span class="linenos">2293</span></a>        <span class="n">xy_dis_drag_rotated</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">xy_dis</span><span class="p">)</span>
</span><span id="Faults-2294"><a href="#-2294"><span class="linenos">2294</span></a>        <span class="n">rotate</span><span class="p">(</span>
</span><span id="Faults-2295"><a href="#-2295"><span class="linenos">2295</span></a>            <span class="n">xy_dis_drag</span><span class="p">,</span>
</span><span id="Faults-2296"><a href="#-2296"><span class="linenos">2296</span></a>            <span class="n">degrees</span><span class="p">(</span><span class="n">alpha</span><span class="p">),</span>
</span><span id="Faults-2297"><a href="#-2297"><span class="linenos">2297</span></a>            <span class="n">reshape</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="Faults-2298"><a href="#-2298"><span class="linenos">2298</span></a>            <span class="n">output</span><span class="o">=</span><span class="n">xy_dis_drag_rotated</span><span class="p">,</span>
</span><span id="Faults-2299"><a href="#-2299"><span class="linenos">2299</span></a>            <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;nearest&quot;</span><span class="p">,</span>
</span><span id="Faults-2300"><a href="#-2300"><span class="linenos">2300</span></a>        <span class="p">)</span>
</span><span id="Faults-2301"><a href="#-2301"><span class="linenos">2301</span></a>        <span class="n">rotate</span><span class="p">(</span>
</span><span id="Faults-2302"><a href="#-2302"><span class="linenos">2302</span></a>            <span class="n">xy_dis</span><span class="p">,</span> <span class="n">degrees</span><span class="p">(</span><span class="n">alpha</span><span class="p">),</span> <span class="n">reshape</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="n">xy_dis_rotated</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;nearest&quot;</span>
</span><span id="Faults-2303"><a href="#-2303"><span class="linenos">2303</span></a>        <span class="p">)</span>
</span><span id="Faults-2304"><a href="#-2304"><span class="linenos">2304</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   ...&quot;</span><span class="p">,</span> <span class="n">xy_dis_rotated</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">xy_dis</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span><span id="Faults-2305"><a href="#-2305"><span class="linenos">2305</span></a>        <span class="n">xy_dis</span> <span class="o">=</span> <span class="n">xy_dis</span><span class="p">[</span>
</span><span id="Faults-2306"><a href="#-2306"><span class="linenos">2306</span></a>            <span class="nb">int</span><span class="p">(</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="mi">2</span> <span class="p">:</span> <span class="n">cube_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span>
</span><span id="Faults-2307"><a href="#-2307"><span class="linenos">2307</span></a>            <span class="nb">int</span><span class="p">(</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="mi">2</span> <span class="p">:</span> <span class="n">cube_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span>
</span><span id="Faults-2308"><a href="#-2308"><span class="linenos">2308</span></a>        <span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Faults-2309"><a href="#-2309"><span class="linenos">2309</span></a>        <span class="n">xy_dis_drag</span> <span class="o">=</span> <span class="n">xy_dis_drag</span><span class="p">[</span>
</span><span id="Faults-2310"><a href="#-2310"><span class="linenos">2310</span></a>            <span class="nb">int</span><span class="p">(</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="mi">2</span> <span class="p">:</span> <span class="n">cube_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span>
</span><span id="Faults-2311"><a href="#-2311"><span class="linenos">2311</span></a>            <span class="nb">int</span><span class="p">(</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="mi">2</span> <span class="p">:</span> <span class="n">cube_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span>
</span><span id="Faults-2312"><a href="#-2312"><span class="linenos">2312</span></a>        <span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Faults-2313"><a href="#-2313"><span class="linenos">2313</span></a>
</span><span id="Faults-2314"><a href="#-2314"><span class="linenos">2314</span></a>        <span class="c1"># taper edges of xy_dis_drag in 2d to avoid edge artifacts in fft</span>
</span><span id="Faults-2315"><a href="#-2315"><span class="linenos">2315</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    ... xy_dis_drag.shape = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">xy_dis_drag</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
</span><span id="Faults-2316"><a href="#-2316"><span class="linenos">2316</span></a>        <span class="nb">print</span><span class="p">(</span>
</span><span id="Faults-2317"><a href="#-2317"><span class="linenos">2317</span></a>            <span class="s2">&quot;    ... xy_dis_drag[xy_dis_drag&gt;0.].size = &quot;</span>
</span><span id="Faults-2318"><a href="#-2318"><span class="linenos">2318</span></a>            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">xy_dis_drag</span><span class="p">[</span><span class="n">xy_dis_drag</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
</span><span id="Faults-2319"><a href="#-2319"><span class="linenos">2319</span></a>        <span class="p">)</span>
</span><span id="Faults-2320"><a href="#-2320"><span class="linenos">2320</span></a>        <span class="nb">print</span><span class="p">(</span>
</span><span id="Faults-2321"><a href="#-2321"><span class="linenos">2321</span></a>            <span class="s2">&quot;    ... xy_dis_drag.shape min/mean/max= &quot;</span>
</span><span id="Faults-2322"><a href="#-2322"><span class="linenos">2322</span></a>            <span class="o">+</span> <span class="nb">str</span><span class="p">((</span><span class="n">xy_dis_drag</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">xy_dis_drag</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">xy_dis_drag</span><span class="o">.</span><span class="n">max</span><span class="p">()))</span>
</span><span id="Faults-2323"><a href="#-2323"><span class="linenos">2323</span></a>        <span class="p">)</span>
</span><span id="Faults-2324"><a href="#-2324"><span class="linenos">2324</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="Faults-2325"><a href="#-2325"><span class="linenos">2325</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">plot_counter</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="Faults-2326"><a href="#-2326"><span class="linenos">2326</span></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="Faults-2327"><a href="#-2327"><span class="linenos">2327</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">plot_counter</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Faults-2328"><a href="#-2328"><span class="linenos">2328</span></a>
</span><span id="Faults-2329"><a href="#-2329"><span class="linenos">2329</span></a>        <span class="c1"># xy_dis_rotated = rotate(xy_dis, degrees(alpha), mode=&#39;constant&#39;)</span>
</span><span id="Faults-2330"><a href="#-2330"><span class="linenos">2330</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   ...&quot;</span><span class="p">,</span> <span class="n">xy_dis_rotated</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">xy_dis</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span><span id="Faults-2331"><a href="#-2331"><span class="linenos">2331</span></a>
</span><span id="Faults-2332"><a href="#-2332"><span class="linenos">2332</span></a>        <span class="c1"># Normalize</span>
</span><span id="Faults-2333"><a href="#-2333"><span class="linenos">2333</span></a>        <span class="c1"># xy_dis_rotated = rotate(xy_dis, degrees(alpha), mode=&#39;constant&#39;)</span>
</span><span id="Faults-2334"><a href="#-2334"><span class="linenos">2334</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   ...&quot;</span><span class="p">,</span> <span class="n">xy_dis_rotated</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">xy_dis</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span><span id="Faults-2335"><a href="#-2335"><span class="linenos">2335</span></a>        <span class="c1"># Normalize</span>
</span><span id="Faults-2336"><a href="#-2336"><span class="linenos">2336</span></a>        <span class="n">new_matrix</span> <span class="o">=</span> <span class="n">xy_dis_rotated</span>
</span><span id="Faults-2337"><a href="#-2337"><span class="linenos">2337</span></a>        <span class="n">xy_dis_norm</span> <span class="o">=</span> <span class="n">xy_dis</span>
</span><span id="Faults-2338"><a href="#-2338"><span class="linenos">2338</span></a>        <span class="n">x_center</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">new_matrix</span> <span class="o">==</span> <span class="n">new_matrix</span><span class="o">.</span><span class="n">max</span><span class="p">())[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Faults-2339"><a href="#-2339"><span class="linenos">2339</span></a>        <span class="n">y_center</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">new_matrix</span> <span class="o">==</span> <span class="n">new_matrix</span><span class="o">.</span><span class="n">max</span><span class="p">())[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Faults-2340"><a href="#-2340"><span class="linenos">2340</span></a>
</span><span id="Faults-2341"><a href="#-2341"><span class="linenos">2341</span></a>        <span class="c1"># Pad event and move it to maximum depth location</span>
</span><span id="Faults-2342"><a href="#-2342"><span class="linenos">2342</span></a>        <span class="n">x_pad</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Faults-2343"><a href="#-2343"><span class="linenos">2343</span></a>        <span class="n">y_pad</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Faults-2344"><a href="#-2344"><span class="linenos">2344</span></a>        <span class="n">x_roll</span> <span class="o">=</span> <span class="n">z_idx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">x_center</span>
</span><span id="Faults-2345"><a href="#-2345"><span class="linenos">2345</span></a>        <span class="n">y_roll</span> <span class="o">=</span> <span class="n">z_idx</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">y_center</span>
</span><span id="Faults-2346"><a href="#-2346"><span class="linenos">2346</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    ... padding x,y and roll x,y = </span><span class="si">{</span><span class="n">x_pad</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">y_pad</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">x_roll</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">y_roll</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Faults-2347"><a href="#-2347"><span class="linenos">2347</span></a>        <span class="nb">print</span><span class="p">(</span>
</span><span id="Faults-2348"><a href="#-2348"><span class="linenos">2348</span></a>            <span class="sa">f</span><span class="s2">&quot;    ... Max displacement point before rotation and adding of padding x,y = </span><span class="si">{</span><span class="n">x_center</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">y_center</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Faults-2349"><a href="#-2349"><span class="linenos">2349</span></a>        <span class="p">)</span>
</span><span id="Faults-2350"><a href="#-2350"><span class="linenos">2350</span></a>        <span class="n">new_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span>
</span><span id="Faults-2351"><a href="#-2351"><span class="linenos">2351</span></a>            <span class="n">new_matrix</span><span class="p">,</span> <span class="p">((</span><span class="nb">abs</span><span class="p">(</span><span class="n">x_pad</span><span class="p">),</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x_pad</span><span class="p">)),</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">y_pad</span><span class="p">),</span> <span class="nb">abs</span><span class="p">(</span><span class="n">y_pad</span><span class="p">))),</span> <span class="s2">&quot;edge&quot;</span>
</span><span id="Faults-2352"><a href="#-2352"><span class="linenos">2352</span></a>        <span class="p">)</span>
</span><span id="Faults-2353"><a href="#-2353"><span class="linenos">2353</span></a>        <span class="n">new_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">new_matrix</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">x_roll</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="Faults-2354"><a href="#-2354"><span class="linenos">2354</span></a>        <span class="n">new_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">new_matrix</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">y_roll</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="Faults-2355"><a href="#-2355"><span class="linenos">2355</span></a>        <span class="n">new_matrix</span> <span class="o">=</span> <span class="n">new_matrix</span><span class="p">[</span>
</span><span id="Faults-2356"><a href="#-2356"><span class="linenos">2356</span></a>            <span class="nb">abs</span><span class="p">(</span><span class="n">x_pad</span><span class="p">)</span> <span class="p">:</span> <span class="n">cube_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x_pad</span><span class="p">),</span>
</span><span id="Faults-2357"><a href="#-2357"><span class="linenos">2357</span></a>            <span class="nb">abs</span><span class="p">(</span><span class="n">y_pad</span><span class="p">)</span> <span class="p">:</span> <span class="n">cube_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="nb">abs</span><span class="p">(</span><span class="n">y_pad</span><span class="p">),</span>
</span><span id="Faults-2358"><a href="#-2358"><span class="linenos">2358</span></a>        <span class="p">]</span>
</span><span id="Faults-2359"><a href="#-2359"><span class="linenos">2359</span></a>        <span class="c1"># Check that fault center is at the right place</span>
</span><span id="Faults-2360"><a href="#-2360"><span class="linenos">2360</span></a>        <span class="n">x_center</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">new_matrix</span> <span class="o">==</span> <span class="n">new_matrix</span><span class="o">.</span><span class="n">max</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Faults-2361"><a href="#-2361"><span class="linenos">2361</span></a>        <span class="n">y_center</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">new_matrix</span> <span class="o">==</span> <span class="n">new_matrix</span><span class="o">.</span><span class="n">max</span><span class="p">())[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="Faults-2362"><a href="#-2362"><span class="linenos">2362</span></a>        <span class="nb">print</span><span class="p">(</span>
</span><span id="Faults-2363"><a href="#-2363"><span class="linenos">2363</span></a>            <span class="sa">f</span><span class="s2">&quot;    ... Max displacement point after rotation and removal of padding x,y = </span><span class="si">{</span><span class="n">x_center</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">y_center</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Faults-2364"><a href="#-2364"><span class="linenos">2364</span></a>        <span class="p">)</span>
</span><span id="Faults-2365"><a href="#-2365"><span class="linenos">2365</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    ... z_idx = </span><span class="si">{</span><span class="n">z_idx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">z_idx</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Faults-2366"><a href="#-2366"><span class="linenos">2366</span></a>        <span class="nb">print</span><span class="p">(</span>
</span><span id="Faults-2367"><a href="#-2367"><span class="linenos">2367</span></a>            <span class="sa">f</span><span class="s2">&quot;    ... Difference from origin z_idx = </span><span class="si">{</span><span class="n">x_center</span> <span class="o">-</span> <span class="n">z_idx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">y_center</span> <span class="o">-</span> <span class="n">z_idx</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Faults-2368"><a href="#-2368"><span class="linenos">2368</span></a>        <span class="p">)</span>
</span><span id="Faults-2369"><a href="#-2369"><span class="linenos">2369</span></a>
</span><span id="Faults-2370"><a href="#-2370"><span class="linenos">2370</span></a>        <span class="c1"># Build cube of lateral variable displacement</span>
</span><span id="Faults-2371"><a href="#-2371"><span class="linenos">2371</span></a>        <span class="n">xy_dis</span> <span class="o">=</span> <span class="n">new_matrix</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cube_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="Faults-2372"><a href="#-2372"><span class="linenos">2372</span></a>        <span class="c1"># Get enlarged fault plane</span>
</span><span id="Faults-2373"><a href="#-2373"><span class="linenos">2373</span></a>        <span class="n">bb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">ellipsoid</span><span class="p">)</span>
</span><span id="Faults-2374"><a href="#-2374"><span class="linenos">2374</span></a>        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">bb</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
</span><span id="Faults-2375"><a href="#-2375"><span class="linenos">2375</span></a>            <span class="n">bb</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">j</span>
</span><span id="Faults-2376"><a href="#-2376"><span class="linenos">2376</span></a>        <span class="n">stretch_times_effects_drag</span> <span class="o">=</span> <span class="n">bb</span> <span class="o">-</span> <span class="n">xy_dis</span> <span class="o">*</span> <span class="n">z_shift</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
</span><span id="Faults-2377"><a href="#-2377"><span class="linenos">2377</span></a>        <span class="n">fault_plane_classification</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
</span><span id="Faults-2378"><a href="#-2378"><span class="linenos">2378</span></a>            <span class="p">(</span><span class="n">z_on_ellipse</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="Faults-2379"><a href="#-2379"><span class="linenos">2379</span></a>            <span class="o">&amp;</span> <span class="p">((</span><span class="n">origtime</span> <span class="o">-</span> <span class="n">stretch_times_effects_drag</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">infill_factor</span><span class="p">),</span>
</span><span id="Faults-2380"><a href="#-2380"><span class="linenos">2380</span></a>            <span class="mi">1</span><span class="p">,</span>
</span><span id="Faults-2381"><a href="#-2381"><span class="linenos">2381</span></a>            <span class="mi">0</span><span class="p">,</span>
</span><span id="Faults-2382"><a href="#-2382"><span class="linenos">2382</span></a>        <span class="p">)</span>
</span><span id="Faults-2383"><a href="#-2383"><span class="linenos">2383</span></a>        <span class="n">hockey_stick</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Faults-2384"><a href="#-2384"><span class="linenos">2384</span></a>        <span class="c1"># Define as 0&#39;s, to be updated if necessary</span>
</span><span id="Faults-2385"><a href="#-2385"><span class="linenos">2385</span></a>        <span class="n">fault_plane_classification_drag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">z_on_ellipse</span><span class="p">)</span>
</span><span id="Faults-2386"><a href="#-2386"><span class="linenos">2386</span></a>        <span class="k">if</span> <span class="n">throw</span> <span class="o">&gt;=</span> <span class="mf">0.85</span> <span class="o">*</span> <span class="n">high_fault_throw</span><span class="p">:</span>
</span><span id="Faults-2387"><a href="#-2387"><span class="linenos">2387</span></a>            <span class="n">hockey_stick</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="Faults-2388"><a href="#-2388"><span class="linenos">2388</span></a>            <span class="c1"># Check for non zero fault_plane_classification, to avoid division by 0</span>
</span><span id="Faults-2389"><a href="#-2389"><span class="linenos">2389</span></a>            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">count_nonzero</span><span class="p">(</span><span class="n">fault_plane_classification</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Faults-2390"><a href="#-2390"><span class="linenos">2390</span></a>                <span class="c1"># Generate Hockey sticks by convolving small xy displacement with fault segment</span>
</span><span id="Faults-2391"><a href="#-2391"><span class="linenos">2391</span></a>                <span class="n">fault_plane_classification_drag</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">fftconvolve</span><span class="p">(</span>
</span><span id="Faults-2392"><a href="#-2392"><span class="linenos">2392</span></a>                    <span class="n">fault_plane_classification</span><span class="p">,</span>
</span><span id="Faults-2393"><a href="#-2393"><span class="linenos">2393</span></a>                    <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">xy_dis_drag</span><span class="p">,</span> <span class="p">(</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cube_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1</span><span class="p">)),</span>
</span><span id="Faults-2394"><a href="#-2394"><span class="linenos">2394</span></a>                    <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;same&quot;</span><span class="p">,</span>
</span><span id="Faults-2395"><a href="#-2395"><span class="linenos">2395</span></a>                <span class="p">)</span>
</span><span id="Faults-2396"><a href="#-2396"><span class="linenos">2396</span></a>                <span class="n">fault_plane_classification_drag</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="Faults-2397"><a href="#-2397"><span class="linenos">2397</span></a>                    <span class="n">fault_plane_classification_drag</span>
</span><span id="Faults-2398"><a href="#-2398"><span class="linenos">2398</span></a>                    <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="n">fault_plane_classification_drag</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span>
</span><span id="Faults-2399"><a href="#-2399"><span class="linenos">2399</span></a>                <span class="p">)</span>
</span><span id="Faults-2400"><a href="#-2400"><span class="linenos">2400</span></a>
</span><span id="Faults-2401"><a href="#-2401"><span class="linenos">2401</span></a>        <span class="n">xy_dis</span> <span class="o">=</span> <span class="n">xy_dis</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">geologic_age</span><span class="p">)</span>
</span><span id="Faults-2402"><a href="#-2402"><span class="linenos">2402</span></a>        <span class="n">xy_dis_classification</span> <span class="o">=</span> <span class="n">xy_dis</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Faults-2403"><a href="#-2403"><span class="linenos">2403</span></a>        <span class="n">interpolation</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Faults-2404"><a href="#-2404"><span class="linenos">2404</span></a>
</span><span id="Faults-2405"><a href="#-2405"><span class="linenos">2405</span></a>        <span class="n">xy_dis</span> <span class="o">=</span> <span class="n">xy_dis</span> <span class="o">-</span> <span class="n">fault_plane_classification_drag</span>
</span><span id="Faults-2406"><a href="#-2406"><span class="linenos">2406</span></a>        <span class="n">xy_dis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">xy_dis</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">xy_dis</span><span class="p">)</span>
</span><span id="Faults-2407"><a href="#-2407"><span class="linenos">2407</span></a>        <span class="n">stretch_times</span> <span class="o">=</span> <span class="n">xy_dis</span> <span class="o">*</span> <span class="n">z_shift</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
</span><span id="Faults-2408"><a href="#-2408"><span class="linenos">2408</span></a>        <span class="n">stretch_times_classification</span> <span class="o">=</span> <span class="n">xy_dis_classification</span> <span class="o">*</span> <span class="n">z_shift</span><span class="p">(</span>
</span><span id="Faults-2409"><a href="#-2409"><span class="linenos">2409</span></a>            <span class="nb">range</span><span class="p">(</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</span><span id="Faults-2410"><a href="#-2410"><span class="linenos">2410</span></a>        <span class="p">)</span>
</span><span id="Faults-2411"><a href="#-2411"><span class="linenos">2411</span></a>
</span><span id="Faults-2412"><a href="#-2412"><span class="linenos">2412</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">qc_plots</span><span class="p">:</span>
</span><span id="Faults-2413"><a href="#-2413"><span class="linenos">2413</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">fault_summary_plot</span><span class="p">(</span>
</span><span id="Faults-2414"><a href="#-2414"><span class="linenos">2414</span></a>                <span class="n">ff</span><span class="p">,</span>
</span><span id="Faults-2415"><a href="#-2415"><span class="linenos">2415</span></a>                <span class="n">z</span><span class="p">,</span>
</span><span id="Faults-2416"><a href="#-2416"><span class="linenos">2416</span></a>                <span class="n">throw</span><span class="p">,</span>
</span><span id="Faults-2417"><a href="#-2417"><span class="linenos">2417</span></a>                <span class="n">sigma</span><span class="p">,</span>
</span><span id="Faults-2418"><a href="#-2418"><span class="linenos">2418</span></a>                <span class="n">_x</span><span class="p">,</span>
</span><span id="Faults-2419"><a href="#-2419"><span class="linenos">2419</span></a>                <span class="n">_y</span><span class="p">,</span>
</span><span id="Faults-2420"><a href="#-2420"><span class="linenos">2420</span></a>                <span class="n">xy_dis_norm</span><span class="p">,</span>
</span><span id="Faults-2421"><a href="#-2421"><span class="linenos">2421</span></a>                <span class="n">ellipsoid</span><span class="p">,</span>
</span><span id="Faults-2422"><a href="#-2422"><span class="linenos">2422</span></a>                <span class="n">z_idx</span><span class="p">,</span>
</span><span id="Faults-2423"><a href="#-2423"><span class="linenos">2423</span></a>                <span class="n">xy_dis</span><span class="p">,</span>
</span><span id="Faults-2424"><a href="#-2424"><span class="linenos">2424</span></a>                <span class="n">index</span><span class="p">,</span>
</span><span id="Faults-2425"><a href="#-2425"><span class="linenos">2425</span></a>                <span class="n">alpha</span><span class="p">,</span>
</span><span id="Faults-2426"><a href="#-2426"><span class="linenos">2426</span></a>            <span class="p">)</span>
</span><span id="Faults-2427"><a href="#-2427"><span class="linenos">2427</span></a>
</span><span id="Faults-2428"><a href="#-2428"><span class="linenos">2428</span></a>        <span class="k">return</span> <span class="n">stretch_times</span><span class="p">,</span> <span class="n">stretch_times_classification</span><span class="p">,</span> <span class="n">interpolation</span><span class="p">,</span> <span class="n">hockey_stick</span>
</span><span id="Faults-2429"><a href="#-2429"><span class="linenos">2429</span></a>
</span><span id="Faults-2430"><a href="#-2430"><span class="linenos">2430</span></a>    <span class="k">def</span> <span class="nf">fault_summary_plot</span><span class="p">(</span>
</span><span id="Faults-2431"><a href="#-2431"><span class="linenos">2431</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Faults-2432"><a href="#-2432"><span class="linenos">2432</span></a>        <span class="n">ff</span><span class="p">,</span>
</span><span id="Faults-2433"><a href="#-2433"><span class="linenos">2433</span></a>        <span class="n">z</span><span class="p">,</span>
</span><span id="Faults-2434"><a href="#-2434"><span class="linenos">2434</span></a>        <span class="n">throw</span><span class="p">,</span>
</span><span id="Faults-2435"><a href="#-2435"><span class="linenos">2435</span></a>        <span class="n">sigma</span><span class="p">,</span>
</span><span id="Faults-2436"><a href="#-2436"><span class="linenos">2436</span></a>        <span class="n">x</span><span class="p">,</span>
</span><span id="Faults-2437"><a href="#-2437"><span class="linenos">2437</span></a>        <span class="n">y</span><span class="p">,</span>
</span><span id="Faults-2438"><a href="#-2438"><span class="linenos">2438</span></a>        <span class="n">xy_dis_norm</span><span class="p">,</span>
</span><span id="Faults-2439"><a href="#-2439"><span class="linenos">2439</span></a>        <span class="n">ellipsoid</span><span class="p">,</span>
</span><span id="Faults-2440"><a href="#-2440"><span class="linenos">2440</span></a>        <span class="n">z_idx</span><span class="p">,</span>
</span><span id="Faults-2441"><a href="#-2441"><span class="linenos">2441</span></a>        <span class="n">xy_dis</span><span class="p">,</span>
</span><span id="Faults-2442"><a href="#-2442"><span class="linenos">2442</span></a>        <span class="n">index</span><span class="p">,</span>
</span><span id="Faults-2443"><a href="#-2443"><span class="linenos">2443</span></a>        <span class="n">alpha</span><span class="p">,</span>
</span><span id="Faults-2444"><a href="#-2444"><span class="linenos">2444</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Faults-2445"><a href="#-2445"><span class="linenos">2445</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="Faults-2446"><a href="#-2446"><span class="linenos">2446</span></a><span class="sd">        Fault Summary Plot</span>
</span><span id="Faults-2447"><a href="#-2447"><span class="linenos">2447</span></a><span class="sd">        ------------------</span>
</span><span id="Faults-2448"><a href="#-2448"><span class="linenos">2448</span></a>
</span><span id="Faults-2449"><a href="#-2449"><span class="linenos">2449</span></a><span class="sd">        Generates a fault summary plot.</span>
</span><span id="Faults-2450"><a href="#-2450"><span class="linenos">2450</span></a>
</span><span id="Faults-2451"><a href="#-2451"><span class="linenos">2451</span></a><span class="sd">        Parameters</span>
</span><span id="Faults-2452"><a href="#-2452"><span class="linenos">2452</span></a><span class="sd">        ----------</span>
</span><span id="Faults-2453"><a href="#-2453"><span class="linenos">2453</span></a><span class="sd">        ff : _type_</span>
</span><span id="Faults-2454"><a href="#-2454"><span class="linenos">2454</span></a><span class="sd">            _description_</span>
</span><span id="Faults-2455"><a href="#-2455"><span class="linenos">2455</span></a><span class="sd">        z : _type_</span>
</span><span id="Faults-2456"><a href="#-2456"><span class="linenos">2456</span></a><span class="sd">            _description_</span>
</span><span id="Faults-2457"><a href="#-2457"><span class="linenos">2457</span></a><span class="sd">        throw : _type_</span>
</span><span id="Faults-2458"><a href="#-2458"><span class="linenos">2458</span></a><span class="sd">            _description_</span>
</span><span id="Faults-2459"><a href="#-2459"><span class="linenos">2459</span></a><span class="sd">        sigma : _type_</span>
</span><span id="Faults-2460"><a href="#-2460"><span class="linenos">2460</span></a><span class="sd">            _description_</span>
</span><span id="Faults-2461"><a href="#-2461"><span class="linenos">2461</span></a><span class="sd">        x : _type_</span>
</span><span id="Faults-2462"><a href="#-2462"><span class="linenos">2462</span></a><span class="sd">            _description_</span>
</span><span id="Faults-2463"><a href="#-2463"><span class="linenos">2463</span></a><span class="sd">        y : _type_</span>
</span><span id="Faults-2464"><a href="#-2464"><span class="linenos">2464</span></a><span class="sd">            _description_</span>
</span><span id="Faults-2465"><a href="#-2465"><span class="linenos">2465</span></a><span class="sd">        xy_dis_norm : _type_</span>
</span><span id="Faults-2466"><a href="#-2466"><span class="linenos">2466</span></a><span class="sd">            _description_</span>
</span><span id="Faults-2467"><a href="#-2467"><span class="linenos">2467</span></a><span class="sd">        ellipsoid : _type_</span>
</span><span id="Faults-2468"><a href="#-2468"><span class="linenos">2468</span></a><span class="sd">            _description_</span>
</span><span id="Faults-2469"><a href="#-2469"><span class="linenos">2469</span></a><span class="sd">        z_idx : _type_</span>
</span><span id="Faults-2470"><a href="#-2470"><span class="linenos">2470</span></a><span class="sd">            _description_</span>
</span><span id="Faults-2471"><a href="#-2471"><span class="linenos">2471</span></a><span class="sd">        xy_dis : _type_</span>
</span><span id="Faults-2472"><a href="#-2472"><span class="linenos">2472</span></a><span class="sd">            _description_</span>
</span><span id="Faults-2473"><a href="#-2473"><span class="linenos">2473</span></a><span class="sd">        index : _type_</span>
</span><span id="Faults-2474"><a href="#-2474"><span class="linenos">2474</span></a><span class="sd">            _description_</span>
</span><span id="Faults-2475"><a href="#-2475"><span class="linenos">2475</span></a><span class="sd">        alpha : _type_</span>
</span><span id="Faults-2476"><a href="#-2476"><span class="linenos">2476</span></a><span class="sd">            _description_</span>
</span><span id="Faults-2477"><a href="#-2477"><span class="linenos">2477</span></a><span class="sd">        </span>
</span><span id="Faults-2478"><a href="#-2478"><span class="linenos">2478</span></a><span class="sd">        Returns</span>
</span><span id="Faults-2479"><a href="#-2479"><span class="linenos">2479</span></a><span class="sd">        -------</span>
</span><span id="Faults-2480"><a href="#-2480"><span class="linenos">2480</span></a><span class="sd">        None</span>
</span><span id="Faults-2481"><a href="#-2481"><span class="linenos">2481</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Faults-2482"><a href="#-2482"><span class="linenos">2482</span></a>        <span class="kn">import</span> <span class="nn">os</span>
</span><span id="Faults-2483"><a href="#-2483"><span class="linenos">2483</span></a>        <span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">degrees</span>
</span><span id="Faults-2484"><a href="#-2484"><span class="linenos">2484</span></a>        <span class="kn">from</span> <span class="nn">datagenerator.util</span> <span class="kn">import</span> <span class="n">import_matplotlib</span>
</span><span id="Faults-2485"><a href="#-2485"><span class="linenos">2485</span></a>
</span><span id="Faults-2486"><a href="#-2486"><span class="linenos">2486</span></a>        <span class="n">plt</span> <span class="o">=</span> <span class="n">import_matplotlib</span><span class="p">()</span>
</span><span id="Faults-2487"><a href="#-2487"><span class="linenos">2487</span></a>        <span class="c1"># Import axes3d, required to create plot with projection=&#39;3d&#39; below. DO NOT REMOVE!</span>
</span><span id="Faults-2488"><a href="#-2488"><span class="linenos">2488</span></a>        <span class="kn">from</span> <span class="nn">mpl_toolkits.mplot3d</span> <span class="kn">import</span> <span class="n">axes3d</span>
</span><span id="Faults-2489"><a href="#-2489"><span class="linenos">2489</span></a>        <span class="kn">from</span> <span class="nn">mpl_toolkits.axes_grid1</span> <span class="kn">import</span> <span class="n">make_axes_locatable</span>
</span><span id="Faults-2490"><a href="#-2490"><span class="linenos">2490</span></a>
</span><span id="Faults-2491"><a href="#-2491"><span class="linenos">2491</span></a>        <span class="c1"># Make summary picture</span>
</span><span id="Faults-2492"><a href="#-2492"><span class="linenos">2492</span></a>        <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span><span id="Faults-2493"><a href="#-2493"><span class="linenos">2493</span></a>        <span class="n">ax0</span><span class="p">,</span> <span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">,</span> <span class="n">ax3</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
</span><span id="Faults-2494"><a href="#-2494"><span class="linenos">2494</span></a>        <span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
</span><span id="Faults-2495"><a href="#-2495"><span class="linenos">2495</span></a>        <span class="c1"># PLot Z displacement</span>
</span><span id="Faults-2496"><a href="#-2496"><span class="linenos">2496</span></a>        <span class="n">ax0</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ff</span><span class="p">(</span><span class="n">z</span><span class="p">))</span>
</span><span id="Faults-2497"><a href="#-2497"><span class="linenos">2497</span></a>        <span class="n">ax0</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Fault with throw </span><span class="si">%s</span><span class="s2"> and sigma </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">throw</span><span class="p">,</span> <span class="n">sigma</span><span class="p">))</span>
</span><span id="Faults-2498"><a href="#-2498"><span class="linenos">2498</span></a>        <span class="n">ax0</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Z axis&quot;</span><span class="p">)</span>
</span><span id="Faults-2499"><a href="#-2499"><span class="linenos">2499</span></a>        <span class="n">ax0</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Throw&quot;</span><span class="p">)</span>
</span><span id="Faults-2500"><a href="#-2500"><span class="linenos">2500</span></a>        <span class="c1"># Plot 3D XY displacement</span>
</span><span id="Faults-2501"><a href="#-2501"><span class="linenos">2501</span></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>
</span><span id="Faults-2502"><a href="#-2502"><span class="linenos">2502</span></a>        <span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">222</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s2">&quot;3d&quot;</span><span class="p">)</span>
</span><span id="Faults-2503"><a href="#-2503"><span class="linenos">2503</span></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">plot_surface</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">xy_dis_norm</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;Spectral&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="Faults-2504"><a href="#-2504"><span class="linenos">2504</span></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;X axis&quot;</span><span class="p">)</span>
</span><span id="Faults-2505"><a href="#-2505"><span class="linenos">2505</span></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Y axis&quot;</span><span class="p">)</span>
</span><span id="Faults-2506"><a href="#-2506"><span class="linenos">2506</span></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">set_zlabel</span><span class="p">(</span><span class="s2">&quot;Throw fraction&quot;</span><span class="p">)</span>
</span><span id="Faults-2507"><a href="#-2507"><span class="linenos">2507</span></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;3D XY displacement&quot;</span><span class="p">)</span>
</span><span id="Faults-2508"><a href="#-2508"><span class="linenos">2508</span></a>        <span class="c1"># Ellipsoid location</span>
</span><span id="Faults-2509"><a href="#-2509"><span class="linenos">2509</span></a>        <span class="n">weights</span> <span class="o">=</span> <span class="n">ellipsoid</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">z_idx</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>
</span><span id="Faults-2510"><a href="#-2510"><span class="linenos">2510</span></a>        <span class="c1"># Plot un-rotated XY displacement</span>
</span><span id="Faults-2511"><a href="#-2511"><span class="linenos">2511</span></a>        <span class="n">cax2</span> <span class="o">=</span> <span class="n">ax2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">rot90</span><span class="p">(</span><span class="n">xy_dis_norm</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
</span><span id="Faults-2512"><a href="#-2512"><span class="linenos">2512</span></a>        <span class="c1"># Levels for imshow contour</span>
</span><span id="Faults-2513"><a href="#-2513"><span class="linenos">2513</span></a>        <span class="n">levels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span>
</span><span id="Faults-2514"><a href="#-2514"><span class="linenos">2514</span></a>        <span class="c1"># Plot contour</span>
</span><span id="Faults-2515"><a href="#-2515"><span class="linenos">2515</span></a>        <span class="n">ax2</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">rot90</span><span class="p">(</span><span class="n">xy_dis_norm</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">levels</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="n">linestyles</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">)</span>
</span><span id="Faults-2516"><a href="#-2516"><span class="linenos">2516</span></a>        <span class="n">divider</span> <span class="o">=</span> <span class="n">make_axes_locatable</span><span class="p">(</span><span class="n">ax2</span><span class="p">)</span>
</span><span id="Faults-2517"><a href="#-2517"><span class="linenos">2517</span></a>        <span class="n">cax4</span> <span class="o">=</span> <span class="n">divider</span><span class="o">.</span><span class="n">append_axes</span><span class="p">(</span><span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s2">&quot;5%&quot;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
</span><span id="Faults-2518"><a href="#-2518"><span class="linenos">2518</span></a>        <span class="n">cbar2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">cax2</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">cax4</span><span class="p">)</span>
</span><span id="Faults-2519"><a href="#-2519"><span class="linenos">2519</span></a>        <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;X axis&quot;</span><span class="p">)</span>
</span><span id="Faults-2520"><a href="#-2520"><span class="linenos">2520</span></a>        <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Y axis&quot;</span><span class="p">)</span>
</span><span id="Faults-2521"><a href="#-2521"><span class="linenos">2521</span></a>        <span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;2D projection of XY displacement unrotated&quot;</span><span class="p">)</span>
</span><span id="Faults-2522"><a href="#-2522"><span class="linenos">2522</span></a>        <span class="c1">############################################################</span>
</span><span id="Faults-2523"><a href="#-2523"><span class="linenos">2523</span></a>        <span class="c1"># Plot rotated displacement and contour</span>
</span><span id="Faults-2524"><a href="#-2524"><span class="linenos">2524</span></a>        <span class="n">cax3</span> <span class="o">=</span> <span class="n">ax3</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">rot90</span><span class="p">(</span><span class="n">xy_dis</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">z_idx</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span> <span class="mi">3</span><span class="p">))</span>
</span><span id="Faults-2525"><a href="#-2525"><span class="linenos">2525</span></a>        <span class="n">ax3</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span>
</span><span id="Faults-2526"><a href="#-2526"><span class="linenos">2526</span></a>            <span class="n">np</span><span class="o">.</span><span class="n">rot90</span><span class="p">(</span><span class="n">xy_dis</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">z_idx</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span> <span class="mi">3</span><span class="p">),</span> <span class="n">levels</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="n">linestyles</span><span class="o">=</span><span class="s2">&quot;-&quot;</span>
</span><span id="Faults-2527"><a href="#-2527"><span class="linenos">2527</span></a>        <span class="p">)</span>
</span><span id="Faults-2528"><a href="#-2528"><span class="linenos">2528</span></a>        <span class="c1"># Add ellipsoid shape</span>
</span><span id="Faults-2529"><a href="#-2529"><span class="linenos">2529</span></a>        <span class="n">ax3</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">rot90</span><span class="p">(</span><span class="n">weights</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">levels</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">colors</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">linestyles</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">)</span>
</span><span id="Faults-2530"><a href="#-2530"><span class="linenos">2530</span></a>        <span class="n">divider</span> <span class="o">=</span> <span class="n">make_axes_locatable</span><span class="p">(</span><span class="n">ax3</span><span class="p">)</span>
</span><span id="Faults-2531"><a href="#-2531"><span class="linenos">2531</span></a>        <span class="n">cax5</span> <span class="o">=</span> <span class="n">divider</span><span class="o">.</span><span class="n">append_axes</span><span class="p">(</span><span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s2">&quot;5%&quot;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
</span><span id="Faults-2532"><a href="#-2532"><span class="linenos">2532</span></a>        <span class="n">cbar3</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">cax3</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">cax5</span><span class="p">)</span>
</span><span id="Faults-2533"><a href="#-2533"><span class="linenos">2533</span></a>        <span class="n">ax3</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;X axis&quot;</span><span class="p">)</span>
</span><span id="Faults-2534"><a href="#-2534"><span class="linenos">2534</span></a>        <span class="n">ax3</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Y axis&quot;</span><span class="p">)</span>
</span><span id="Faults-2535"><a href="#-2535"><span class="linenos">2535</span></a>        <span class="n">ax3</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span>
</span><span id="Faults-2536"><a href="#-2536"><span class="linenos">2536</span></a>            <span class="s2">&quot;2D projection of XY displacement rotated by </span><span class="si">%s</span><span class="s2"> degrees&quot;</span>
</span><span id="Faults-2537"><a href="#-2537"><span class="linenos">2537</span></a>            <span class="o">%</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">degrees</span><span class="p">(</span><span class="n">alpha</span><span class="p">)))</span>
</span><span id="Faults-2538"><a href="#-2538"><span class="linenos">2538</span></a>        <span class="p">)</span>
</span><span id="Faults-2539"><a href="#-2539"><span class="linenos">2539</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span>
</span><span id="Faults-2540"><a href="#-2540"><span class="linenos">2540</span></a>            <span class="s2">&quot;XYZ displacement parameters for fault Nr </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">),</span>
</span><span id="Faults-2541"><a href="#-2541"><span class="linenos">2541</span></a>            <span class="n">fontweight</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span><span class="p">,</span>
</span><span id="Faults-2542"><a href="#-2542"><span class="linenos">2542</span></a>        <span class="p">)</span>
</span><span id="Faults-2543"><a href="#-2543"><span class="linenos">2543</span></a>        <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</span><span id="Faults-2544"><a href="#-2544"><span class="linenos">2544</span></a>        <span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">top</span><span class="o">=</span><span class="mf">0.94</span><span class="p">)</span>
</span><span id="Faults-2545"><a href="#-2545"><span class="linenos">2545</span></a>        <span class="n">image_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="Faults-2546"><a href="#-2546"><span class="linenos">2546</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">work_subfolder</span><span class="p">,</span> <span class="s2">&quot;QC_plot__Fault_</span><span class="si">%s</span><span class="s2">.png&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
</span><span id="Faults-2547"><a href="#-2547"><span class="linenos">2547</span></a>        <span class="p">)</span>
</span><span id="Faults-2548"><a href="#-2548"><span class="linenos">2548</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">image_path</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;png&quot;</span><span class="p">)</span>
</span><span id="Faults-2549"><a href="#-2549"><span class="linenos">2549</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
</span><span id="Faults-2550"><a href="#-2550"><span class="linenos">2550</span></a>
</span><span id="Faults-2551"><a href="#-2551"><span class="linenos">2551</span></a>    <span class="nd">@staticmethod</span>
</span><span id="Faults-2552"><a href="#-2552"><span class="linenos">2552</span></a>    <span class="k">def</span> <span class="nf">create_binary_segmentations_post_faulting</span><span class="p">(</span><span class="n">cube</span><span class="p">,</span> <span class="n">segmentation_threshold</span><span class="p">):</span>
</span><span id="Faults-2553"><a href="#-2553"><span class="linenos">2553</span></a>        <span class="n">cube</span><span class="p">[</span><span class="n">cube</span> <span class="o">&gt;=</span> <span class="n">segmentation_threshold</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="Faults-2554"><a href="#-2554"><span class="linenos">2554</span></a>        <span class="k">return</span> <span class="n">cube</span>
</span><span id="Faults-2555"><a href="#-2555"><span class="linenos">2555</span></a>
</span><span id="Faults-2556"><a href="#-2556"><span class="linenos">2556</span></a>    <span class="k">def</span> <span class="nf">reassign_channel_segment_encoding</span><span class="p">(</span>
</span><span id="Faults-2557"><a href="#-2557"><span class="linenos">2557</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Faults-2558"><a href="#-2558"><span class="linenos">2558</span></a>        <span class="n">faulted_age</span><span class="p">,</span>
</span><span id="Faults-2559"><a href="#-2559"><span class="linenos">2559</span></a>        <span class="n">floodplain_shale</span><span class="p">,</span>
</span><span id="Faults-2560"><a href="#-2560"><span class="linenos">2560</span></a>        <span class="n">channel_fill</span><span class="p">,</span>
</span><span id="Faults-2561"><a href="#-2561"><span class="linenos">2561</span></a>        <span class="n">shale_channel_drape</span><span class="p">,</span>
</span><span id="Faults-2562"><a href="#-2562"><span class="linenos">2562</span></a>        <span class="n">levee</span><span class="p">,</span>
</span><span id="Faults-2563"><a href="#-2563"><span class="linenos">2563</span></a>        <span class="n">crevasse</span><span class="p">,</span>
</span><span id="Faults-2564"><a href="#-2564"><span class="linenos">2564</span></a>        <span class="n">channel_flag_lut</span><span class="p">,</span>
</span><span id="Faults-2565"><a href="#-2565"><span class="linenos">2565</span></a>    <span class="p">):</span>
</span><span id="Faults-2566"><a href="#-2566"><span class="linenos">2566</span></a>        <span class="c1"># Generate list of horizons with channel episodes</span>
</span><span id="Faults-2567"><a href="#-2567"><span class="linenos">2567</span></a>        <span class="n">channel_segments</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">floodplain_shale</span><span class="p">)</span>
</span><span id="Faults-2568"><a href="#-2568"><span class="linenos">2568</span></a>        <span class="n">channel_horizons_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
</span><span id="Faults-2569"><a href="#-2569"><span class="linenos">2569</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faulted_depth_maps</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="mi">7</span><span class="p">):</span>
</span><span id="Faults-2570"><a href="#-2570"><span class="linenos">2570</span></a>            <span class="k">if</span> <span class="n">channel_flag_lut</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Faults-2571"><a href="#-2571"><span class="linenos">2571</span></a>                <span class="n">channel_horizons_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</span><span id="Faults-2572"><a href="#-2572"><span class="linenos">2572</span></a>        <span class="n">channel_horizons_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">999</span><span class="p">)</span>
</span><span id="Faults-2573"><a href="#-2573"><span class="linenos">2573</span></a>
</span><span id="Faults-2574"><a href="#-2574"><span class="linenos">2574</span></a>        <span class="c1"># Re-assign correct channel segments encoding</span>
</span><span id="Faults-2575"><a href="#-2575"><span class="linenos">2575</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">iLayer</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">channel_horizons_list</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
</span><span id="Faults-2576"><a href="#-2576"><span class="linenos">2576</span></a>            <span class="k">if</span> <span class="n">iLayer</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">iLayer</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">faulted_depth_maps</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
</span><span id="Faults-2577"><a href="#-2577"><span class="linenos">2577</span></a>                <span class="c1"># loop through channel facies</span>
</span><span id="Faults-2578"><a href="#-2578"><span class="linenos">2578</span></a>                <span class="c1">#    --- 0  is floodplain shale</span>
</span><span id="Faults-2579"><a href="#-2579"><span class="linenos">2579</span></a>                <span class="c1">#    --- 1  is channel fill (sand)</span>
</span><span id="Faults-2580"><a href="#-2580"><span class="linenos">2580</span></a>                <span class="c1">#    --- 2  is shale channel drape</span>
</span><span id="Faults-2581"><a href="#-2581"><span class="linenos">2581</span></a>                <span class="c1">#    --- 3  is levee (mid quality sand)</span>
</span><span id="Faults-2582"><a href="#-2582"><span class="linenos">2582</span></a>                <span class="c1">#    --- 4  is crevasse (low quality sand)</span>
</span><span id="Faults-2583"><a href="#-2583"><span class="linenos">2583</span></a>                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">4001</span><span class="p">,</span> <span class="mi">1000</span><span class="p">):</span>
</span><span id="Faults-2584"><a href="#-2584"><span class="linenos">2584</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="Faults-2585"><a href="#-2585"><span class="linenos">2585</span></a>                        <span class="s2">&quot; ... re-assign channel segments after faulting: i, iLayer, j = &quot;</span><span class="p">,</span>
</span><span id="Faults-2586"><a href="#-2586"><span class="linenos">2586</span></a>                        <span class="n">i</span><span class="p">,</span>
</span><span id="Faults-2587"><a href="#-2587"><span class="linenos">2587</span></a>                        <span class="n">iLayer</span><span class="p">,</span>
</span><span id="Faults-2588"><a href="#-2588"><span class="linenos">2588</span></a>                        <span class="n">j</span><span class="p">,</span>
</span><span id="Faults-2589"><a href="#-2589"><span class="linenos">2589</span></a>                    <span class="p">)</span>
</span><span id="Faults-2590"><a href="#-2590"><span class="linenos">2590</span></a>                    <span class="n">channel_facies_code</span> <span class="o">=</span> <span class="n">j</span> <span class="o">+</span> <span class="n">iLayer</span>
</span><span id="Faults-2591"><a href="#-2591"><span class="linenos">2591</span></a>                    <span class="n">layers_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
</span><span id="Faults-2592"><a href="#-2592"><span class="linenos">2592</span></a>                        <span class="p">(</span>
</span><span id="Faults-2593"><a href="#-2593"><span class="linenos">2593</span></a>                            <span class="p">(</span><span class="n">faulted_age</span> <span class="o">&gt;=</span> <span class="n">iLayer</span><span class="p">)</span>
</span><span id="Faults-2594"><a href="#-2594"><span class="linenos">2594</span></a>                            <span class="o">&amp;</span> <span class="p">(</span><span class="n">faulted_age</span> <span class="o">&lt;</span> <span class="n">channel_horizons_list</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
</span><span id="Faults-2595"><a href="#-2595"><span class="linenos">2595</span></a>                        <span class="p">),</span>
</span><span id="Faults-2596"><a href="#-2596"><span class="linenos">2596</span></a>                        <span class="mi">1</span><span class="p">,</span>
</span><span id="Faults-2597"><a href="#-2597"><span class="linenos">2597</span></a>                        <span class="mi">0</span><span class="p">,</span>
</span><span id="Faults-2598"><a href="#-2598"><span class="linenos">2598</span></a>                    <span class="p">)</span>
</span><span id="Faults-2599"><a href="#-2599"><span class="linenos">2599</span></a>                    <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="mi">1000</span><span class="p">:</span>
</span><span id="Faults-2600"><a href="#-2600"><span class="linenos">2600</span></a>                        <span class="n">channel_segments</span><span class="p">[</span>
</span><span id="Faults-2601"><a href="#-2601"><span class="linenos">2601</span></a>                            <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">layers_mask</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="n">channel_fill</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="Faults-2602"><a href="#-2602"><span class="linenos">2602</span></a>                        <span class="p">]</span> <span class="o">=</span> <span class="n">channel_facies_code</span>
</span><span id="Faults-2603"><a href="#-2603"><span class="linenos">2603</span></a>                        <span class="n">faulted_age</span><span class="p">[</span>
</span><span id="Faults-2604"><a href="#-2604"><span class="linenos">2604</span></a>                            <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">layers_mask</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="n">channel_fill</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="Faults-2605"><a href="#-2605"><span class="linenos">2605</span></a>                        <span class="p">]</span> <span class="o">=</span> <span class="n">channel_facies_code</span>
</span><span id="Faults-2606"><a href="#-2606"><span class="linenos">2606</span></a>                    <span class="k">elif</span> <span class="n">j</span> <span class="o">==</span> <span class="mi">2000</span><span class="p">:</span>
</span><span id="Faults-2607"><a href="#-2607"><span class="linenos">2607</span></a>                        <span class="n">channel_segments</span><span class="p">[</span>
</span><span id="Faults-2608"><a href="#-2608"><span class="linenos">2608</span></a>                            <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">layers_mask</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="n">shale_channel_drape</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="Faults-2609"><a href="#-2609"><span class="linenos">2609</span></a>                        <span class="p">]</span> <span class="o">=</span> <span class="n">channel_facies_code</span>
</span><span id="Faults-2610"><a href="#-2610"><span class="linenos">2610</span></a>                        <span class="n">faulted_age</span><span class="p">[</span>
</span><span id="Faults-2611"><a href="#-2611"><span class="linenos">2611</span></a>                            <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">layers_mask</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="n">shale_channel_drape</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="Faults-2612"><a href="#-2612"><span class="linenos">2612</span></a>                        <span class="p">]</span> <span class="o">=</span> <span class="n">channel_facies_code</span>
</span><span id="Faults-2613"><a href="#-2613"><span class="linenos">2613</span></a>                    <span class="k">elif</span> <span class="n">j</span> <span class="o">==</span> <span class="mi">3000</span><span class="p">:</span>
</span><span id="Faults-2614"><a href="#-2614"><span class="linenos">2614</span></a>                        <span class="n">channel_segments</span><span class="p">[</span>
</span><span id="Faults-2615"><a href="#-2615"><span class="linenos">2615</span></a>                            <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">layers_mask</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="n">levee</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="Faults-2616"><a href="#-2616"><span class="linenos">2616</span></a>                        <span class="p">]</span> <span class="o">=</span> <span class="n">channel_facies_code</span>
</span><span id="Faults-2617"><a href="#-2617"><span class="linenos">2617</span></a>                        <span class="n">faulted_age</span><span class="p">[</span>
</span><span id="Faults-2618"><a href="#-2618"><span class="linenos">2618</span></a>                            <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">layers_mask</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="n">levee</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="Faults-2619"><a href="#-2619"><span class="linenos">2619</span></a>                        <span class="p">]</span> <span class="o">=</span> <span class="n">channel_facies_code</span>
</span><span id="Faults-2620"><a href="#-2620"><span class="linenos">2620</span></a>                    <span class="k">elif</span> <span class="n">j</span> <span class="o">==</span> <span class="mi">4000</span><span class="p">:</span>
</span><span id="Faults-2621"><a href="#-2621"><span class="linenos">2621</span></a>                        <span class="n">channel_segments</span><span class="p">[</span>
</span><span id="Faults-2622"><a href="#-2622"><span class="linenos">2622</span></a>                            <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">layers_mask</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="n">crevasse</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="Faults-2623"><a href="#-2623"><span class="linenos">2623</span></a>                        <span class="p">]</span> <span class="o">=</span> <span class="n">channel_facies_code</span>
</span><span id="Faults-2624"><a href="#-2624"><span class="linenos">2624</span></a>                        <span class="n">faulted_age</span><span class="p">[</span>
</span><span id="Faults-2625"><a href="#-2625"><span class="linenos">2625</span></a>                            <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">layers_mask</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="n">crevasse</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="Faults-2626"><a href="#-2626"><span class="linenos">2626</span></a>                        <span class="p">]</span> <span class="o">=</span> <span class="n">channel_facies_code</span>
</span><span id="Faults-2627"><a href="#-2627"><span class="linenos">2627</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; ... finished Re-assign correct channel segments&quot;</span><span class="p">)</span>
</span><span id="Faults-2628"><a href="#-2628"><span class="linenos">2628</span></a>        <span class="k">return</span> <span class="n">channel_segments</span><span class="p">,</span> <span class="n">faulted_age</span>
</span><span id="Faults-2629"><a href="#-2629"><span class="linenos">2629</span></a>
</span><span id="Faults-2630"><a href="#-2630"><span class="linenos">2630</span></a>    <span class="k">def</span> <span class="nf">_get_fault_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Faults-2631"><a href="#-2631"><span class="linenos">2631</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Faults-2632"><a href="#-2632"><span class="linenos">2632</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fault_params_random</span>
</span><span id="Faults-2633"><a href="#-2633"><span class="linenos">2633</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="mf">1.0</span><span class="p">:</span>
</span><span id="Faults-2634"><a href="#-2634"><span class="linenos">2634</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">clustering</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Faults-2635"><a href="#-2635"><span class="linenos">2635</span></a>                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fault_params_self_branching</span>
</span><span id="Faults-2636"><a href="#-2636"><span class="linenos">2636</span></a>            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">clustering</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Faults-2637"><a href="#-2637"><span class="linenos">2637</span></a>                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fault_params_stairs</span>
</span><span id="Faults-2638"><a href="#-2638"><span class="linenos">2638</span></a>            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">clustering</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="Faults-2639"><a href="#-2639"><span class="linenos">2639</span></a>                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fault_params_relay_ramps</span>
</span><span id="Faults-2640"><a href="#-2640"><span class="linenos">2640</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Faults-2641"><a href="#-2641"><span class="linenos">2641</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">clustering</span><span class="p">)</span>
</span><span id="Faults-2642"><a href="#-2642"><span class="linenos">2642</span></a>
</span><span id="Faults-2643"><a href="#-2643"><span class="linenos">2643</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="mf">2.0</span><span class="p">:</span>
</span><span id="Faults-2644"><a href="#-2644"><span class="linenos">2644</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fault_params_horst_graben</span>
</span><span id="Faults-2645"><a href="#-2645"><span class="linenos">2645</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Faults-2646"><a href="#-2646"><span class="linenos">2646</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">mode</span><span class="p">)</span>
</span><span id="Faults-2647"><a href="#-2647"><span class="linenos">2647</span></a>
</span><span id="Faults-2648"><a href="#-2648"><span class="linenos">2648</span></a>    <span class="k">def</span> <span class="nf">_fault_params_random</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Faults-2649"><a href="#-2649"><span class="linenos">2649</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; ... </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">number_faults</span><span class="si">}</span><span class="s2"> faults will be inserted randomly&quot;</span><span class="p">)</span>
</span><span id="Faults-2650"><a href="#-2650"><span class="linenos">2650</span></a>
</span><span id="Faults-2651"><a href="#-2651"><span class="linenos">2651</span></a>        <span class="c1"># Fault origin</span>
</span><span id="Faults-2652"><a href="#-2652"><span class="linenos">2652</span></a>        <span class="n">x0_min</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mf">4.0</span><span class="p">)</span>
</span><span id="Faults-2653"><a href="#-2653"><span class="linenos">2653</span></a>        <span class="n">x0_max</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">)</span>
</span><span id="Faults-2654"><a href="#-2654"><span class="linenos">2654</span></a>        <span class="n">y0_min</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="mf">4.0</span><span class="p">)</span>
</span><span id="Faults-2655"><a href="#-2655"><span class="linenos">2655</span></a>        <span class="n">y0_max</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">)</span>
</span><span id="Faults-2656"><a href="#-2656"><span class="linenos">2656</span></a>
</span><span id="Faults-2657"><a href="#-2657"><span class="linenos">2657</span></a>        <span class="c1"># Principal semi-axes location of fault ellipsoid</span>
</span><span id="Faults-2658"><a href="#-2658"><span class="linenos">2658</span></a>        <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">600</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">number_faults</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
</span><span id="Faults-2659"><a href="#-2659"><span class="linenos">2659</span></a>        <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">600</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">number_faults</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
</span><span id="Faults-2660"><a href="#-2660"><span class="linenos">2660</span></a>        <span class="n">x0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span>
</span><span id="Faults-2661"><a href="#-2661"><span class="linenos">2661</span></a>            <span class="n">x0_min</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">+</span> <span class="n">x0_max</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">number_faults</span>
</span><span id="Faults-2662"><a href="#-2662"><span class="linenos">2662</span></a>        <span class="p">)</span>
</span><span id="Faults-2663"><a href="#-2663"><span class="linenos">2663</span></a>        <span class="n">y0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span>
</span><span id="Faults-2664"><a href="#-2664"><span class="linenos">2664</span></a>            <span class="n">y0_min</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">b</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="o">+</span> <span class="n">y0_max</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">number_faults</span>
</span><span id="Faults-2665"><a href="#-2665"><span class="linenos">2665</span></a>        <span class="p">)</span>
</span><span id="Faults-2666"><a href="#-2666"><span class="linenos">2666</span></a>        <span class="n">z0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span>
</span><span id="Faults-2667"><a href="#-2667"><span class="linenos">2667</span></a>            <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="mf">2.0</span><span class="p">,</span>
</span><span id="Faults-2668"><a href="#-2668"><span class="linenos">2668</span></a>            <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="mf">6.0</span><span class="p">,</span>
</span><span id="Faults-2669"><a href="#-2669"><span class="linenos">2669</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">number_faults</span><span class="p">,</span>
</span><span id="Faults-2670"><a href="#-2670"><span class="linenos">2670</span></a>        <span class="p">)</span>
</span><span id="Faults-2671"><a href="#-2671"><span class="linenos">2671</span></a>        <span class="n">_c0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">infill_factor</span> <span class="o">*</span> <span class="mf">4.0</span> <span class="o">-</span> <span class="n">z0</span>
</span><span id="Faults-2672"><a href="#-2672"><span class="linenos">2672</span></a>        <span class="n">_c1</span> <span class="o">=</span> <span class="n">_c0</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">infill_factor</span> <span class="o">/</span> <span class="mf">4.0</span>
</span><span id="Faults-2673"><a href="#-2673"><span class="linenos">2673</span></a>        <span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">_c0</span><span class="p">,</span> <span class="n">_c1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">number_faults</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
</span><span id="Faults-2674"><a href="#-2674"><span class="linenos">2674</span></a>        <span class="n">tilt_pct</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">number_faults</span><span class="p">)</span>
</span><span id="Faults-2675"><a href="#-2675"><span class="linenos">2675</span></a>        <span class="n">throw_lut</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span>
</span><span id="Faults-2676"><a href="#-2676"><span class="linenos">2676</span></a>            <span class="n">low</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">low_fault_throw</span><span class="p">,</span>
</span><span id="Faults-2677"><a href="#-2677"><span class="linenos">2677</span></a>            <span class="n">high</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">high_fault_throw</span><span class="p">,</span>
</span><span id="Faults-2678"><a href="#-2678"><span class="linenos">2678</span></a>            <span class="n">size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">number_faults</span><span class="p">,</span>
</span><span id="Faults-2679"><a href="#-2679"><span class="linenos">2679</span></a>        <span class="p">)</span>
</span><span id="Faults-2680"><a href="#-2680"><span class="linenos">2680</span></a>
</span><span id="Faults-2681"><a href="#-2681"><span class="linenos">2681</span></a>        <span class="n">fault_param_dict</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="Faults-2682"><a href="#-2682"><span class="linenos">2682</span></a>            <span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="n">a</span><span class="p">,</span>
</span><span id="Faults-2683"><a href="#-2683"><span class="linenos">2683</span></a>            <span class="s2">&quot;b&quot;</span><span class="p">:</span> <span class="n">b</span><span class="p">,</span>
</span><span id="Faults-2684"><a href="#-2684"><span class="linenos">2684</span></a>            <span class="s2">&quot;c&quot;</span><span class="p">:</span> <span class="n">c</span><span class="p">,</span>
</span><span id="Faults-2685"><a href="#-2685"><span class="linenos">2685</span></a>            <span class="s2">&quot;x0&quot;</span><span class="p">:</span> <span class="n">x0</span><span class="p">,</span>
</span><span id="Faults-2686"><a href="#-2686"><span class="linenos">2686</span></a>            <span class="s2">&quot;y0&quot;</span><span class="p">:</span> <span class="n">y0</span><span class="p">,</span>
</span><span id="Faults-2687"><a href="#-2687"><span class="linenos">2687</span></a>            <span class="s2">&quot;z0&quot;</span><span class="p">:</span> <span class="n">z0</span><span class="p">,</span>
</span><span id="Faults-2688"><a href="#-2688"><span class="linenos">2688</span></a>            <span class="s2">&quot;tilt_pct&quot;</span><span class="p">:</span> <span class="n">tilt_pct</span><span class="p">,</span>
</span><span id="Faults-2689"><a href="#-2689"><span class="linenos">2689</span></a>            <span class="s2">&quot;throw&quot;</span><span class="p">:</span> <span class="n">throw_lut</span><span class="p">,</span>
</span><span id="Faults-2690"><a href="#-2690"><span class="linenos">2690</span></a>        <span class="p">}</span>
</span><span id="Faults-2691"><a href="#-2691"><span class="linenos">2691</span></a>
</span><span id="Faults-2692"><a href="#-2692"><span class="linenos">2692</span></a>        <span class="k">return</span> <span class="n">fault_param_dict</span>
</span><span id="Faults-2693"><a href="#-2693"><span class="linenos">2693</span></a>
</span><span id="Faults-2694"><a href="#-2694"><span class="linenos">2694</span></a>    <span class="k">def</span> <span class="nf">_fault_params_self_branching</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Faults-2695"><a href="#-2695"><span class="linenos">2695</span></a>        <span class="nb">print</span><span class="p">(</span>
</span><span id="Faults-2696"><a href="#-2696"><span class="linenos">2696</span></a>            <span class="sa">f</span><span class="s2">&quot; ... </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">number_faults</span><span class="si">}</span><span class="s2"> faults will be inserted in clustered mode with&quot;</span>
</span><span id="Faults-2697"><a href="#-2697"><span class="linenos">2697</span></a>        <span class="p">)</span>
</span><span id="Faults-2698"><a href="#-2698"><span class="linenos">2698</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; ... Self branching&quot;</span><span class="p">)</span>
</span><span id="Faults-2699"><a href="#-2699"><span class="linenos">2699</span></a>        <span class="n">x0_min</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Faults-2700"><a href="#-2700"><span class="linenos">2700</span></a>        <span class="n">x0_max</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="Faults-2701"><a href="#-2701"><span class="linenos">2701</span></a>        <span class="n">y0_min</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Faults-2702"><a href="#-2702"><span class="linenos">2702</span></a>        <span class="n">y0_max</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="Faults-2703"><a href="#-2703"><span class="linenos">2703</span></a>        <span class="c1"># Self Branching mode means that faults are inserted side by side with no separation.</span>
</span><span id="Faults-2704"><a href="#-2704"><span class="linenos">2704</span></a>        <span class="n">number_of_branches</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">number_faults</span> <span class="o">/</span> <span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span>
</span><span id="Faults-2705"><a href="#-2705"><span class="linenos">2705</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">number_faults</span> <span class="o">%</span> <span class="mi">3</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Faults-2706"><a href="#-2706"><span class="linenos">2706</span></a>        <span class="p">)</span>
</span><span id="Faults-2707"><a href="#-2707"><span class="linenos">2707</span></a>
</span><span id="Faults-2708"><a href="#-2708"><span class="linenos">2708</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">number_of_branches</span><span class="p">):</span>
</span><span id="Faults-2709"><a href="#-2709"><span class="linenos">2709</span></a>            <span class="c1"># Initialize first fault center, offset center between each branch</span>
</span><span id="Faults-2710"><a href="#-2710"><span class="linenos">2710</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; ... Computing branch number &quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
</span><span id="Faults-2711"><a href="#-2711"><span class="linenos">2711</span></a>            <span class="n">b_ini</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">600</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="Faults-2712"><a href="#-2712"><span class="linenos">2712</span></a>            <span class="n">a_ini</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">600</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="Faults-2713"><a href="#-2713"><span class="linenos">2713</span></a>            <span class="k">if</span> <span class="n">a_ini</span> <span class="o">&gt;</span> <span class="n">b_ini</span><span class="p">:</span>
</span><span id="Faults-2714"><a href="#-2714"><span class="linenos">2714</span></a>                <span class="k">while</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">b_ini</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
</span><span id="Faults-2715"><a href="#-2715"><span class="linenos">2715</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; ... Recomputing b_ini for better branching&quot;</span><span class="p">)</span>
</span><span id="Faults-2716"><a href="#-2716"><span class="linenos">2716</span></a>                    <span class="n">b_ini</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">600</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="Faults-2717"><a href="#-2717"><span class="linenos">2717</span></a>                <span class="n">x0_ini</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">x0_min</span><span class="p">,</span> <span class="n">x0_max</span><span class="p">))</span>
</span><span id="Faults-2718"><a href="#-2718"><span class="linenos">2718</span></a>                <span class="n">range_1</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">y0_min</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">b_ini</span><span class="p">)),</span> <span class="mi">0</span><span class="p">))</span>
</span><span id="Faults-2719"><a href="#-2719"><span class="linenos">2719</span></a>                <span class="n">range_2</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])))</span>
</span><span id="Faults-2720"><a href="#-2720"><span class="linenos">2720</span></a>                <span class="n">y0_ini</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
</span><span id="Faults-2721"><a href="#-2721"><span class="linenos">2721</span></a>                    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">range_1</span> <span class="o">+</span> <span class="n">range_2</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">b_ini</span><span class="p">)</span> <span class="o">+</span> <span class="n">y0_max</span><span class="p">))</span>
</span><span id="Faults-2722"><a href="#-2722"><span class="linenos">2722</span></a>                <span class="p">)</span>
</span><span id="Faults-2723"><a href="#-2723"><span class="linenos">2723</span></a>                <span class="n">side</span> <span class="o">=</span> <span class="s2">&quot;x&quot;</span>
</span><span id="Faults-2724"><a href="#-2724"><span class="linenos">2724</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Faults-2725"><a href="#-2725"><span class="linenos">2725</span></a>                <span class="k">while</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">a_ini</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
</span><span id="Faults-2726"><a href="#-2726"><span class="linenos">2726</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; ... Recomputing a_ini for better branching&quot;</span><span class="p">)</span>
</span><span id="Faults-2727"><a href="#-2727"><span class="linenos">2727</span></a>                    <span class="n">a_ini</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">600</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="Faults-2728"><a href="#-2728"><span class="linenos">2728</span></a>                <span class="n">range_1</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">x0_min</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">a_ini</span><span class="p">)),</span> <span class="mi">0</span><span class="p">))</span>
</span><span id="Faults-2729"><a href="#-2729"><span class="linenos">2729</span></a>                <span class="n">range_2</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])))</span>
</span><span id="Faults-2730"><a href="#-2730"><span class="linenos">2730</span></a>                <span class="n">x0_ini</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
</span><span id="Faults-2731"><a href="#-2731"><span class="linenos">2731</span></a>                    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
</span><span id="Faults-2732"><a href="#-2732"><span class="linenos">2732</span></a>                        <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span>
</span><span id="Faults-2733"><a href="#-2733"><span class="linenos">2733</span></a>                            <span class="n">range_1</span> <span class="o">+</span> <span class="n">range_2</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">a_ini</span><span class="p">)</span> <span class="o">+</span> <span class="n">x0_max</span><span class="p">)</span>
</span><span id="Faults-2734"><a href="#-2734"><span class="linenos">2734</span></a>                        <span class="p">)</span>
</span><span id="Faults-2735"><a href="#-2735"><span class="linenos">2735</span></a>                    <span class="p">)</span>
</span><span id="Faults-2736"><a href="#-2736"><span class="linenos">2736</span></a>                <span class="p">)</span>
</span><span id="Faults-2737"><a href="#-2737"><span class="linenos">2737</span></a>                <span class="n">y0_ini</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">y0_min</span><span class="p">,</span> <span class="n">y0_max</span><span class="p">))</span>
</span><span id="Faults-2738"><a href="#-2738"><span class="linenos">2738</span></a>                <span class="n">side</span> <span class="o">=</span> <span class="s2">&quot;y&quot;</span>
</span><span id="Faults-2739"><a href="#-2739"><span class="linenos">2739</span></a>            <span class="c1"># Compute the rest of the initial parameters normally</span>
</span><span id="Faults-2740"><a href="#-2740"><span class="linenos">2740</span></a>            <span class="n">z0_ini</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
</span><span id="Faults-2741"><a href="#-2741"><span class="linenos">2741</span></a>                <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span>
</span><span id="Faults-2742"><a href="#-2742"><span class="linenos">2742</span></a>                    <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="mf">2.0</span><span class="p">,</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="mf">6.0</span>
</span><span id="Faults-2743"><a href="#-2743"><span class="linenos">2743</span></a>                <span class="p">)</span>
</span><span id="Faults-2744"><a href="#-2744"><span class="linenos">2744</span></a>            <span class="p">)</span>
</span><span id="Faults-2745"><a href="#-2745"><span class="linenos">2745</span></a>
</span><span id="Faults-2746"><a href="#-2746"><span class="linenos">2746</span></a>            <span class="n">_c0_ini</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">infill_factor</span> <span class="o">*</span> <span class="mf">4.0</span> <span class="o">-</span> <span class="n">z0_ini</span>
</span><span id="Faults-2747"><a href="#-2747"><span class="linenos">2747</span></a>            <span class="n">_c1_ini</span> <span class="o">=</span> <span class="n">_c0_ini</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">infill_factor</span> <span class="o">/</span> <span class="mf">4.0</span>
</span><span id="Faults-2748"><a href="#-2748"><span class="linenos">2748</span></a>            <span class="n">c_ini</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">_c0_ini</span><span class="p">,</span> <span class="n">_c1_ini</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="Faults-2749"><a href="#-2749"><span class="linenos">2749</span></a>            <span class="n">tilt_pct_ini</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">))</span>
</span><span id="Faults-2750"><a href="#-2750"><span class="linenos">2750</span></a>            <span class="c1"># direction = np.random.choice([-1, 1])</span>
</span><span id="Faults-2751"><a href="#-2751"><span class="linenos">2751</span></a>            <span class="n">throw_lut_ini</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
</span><span id="Faults-2752"><a href="#-2752"><span class="linenos">2752</span></a>                <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span>
</span><span id="Faults-2753"><a href="#-2753"><span class="linenos">2753</span></a>                    <span class="n">low</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">low_fault_throw</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">high_fault_throw</span>
</span><span id="Faults-2754"><a href="#-2754"><span class="linenos">2754</span></a>                <span class="p">)</span>
</span><span id="Faults-2755"><a href="#-2755"><span class="linenos">2755</span></a>            <span class="p">)</span>
</span><span id="Faults-2756"><a href="#-2756"><span class="linenos">2756</span></a>            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Faults-2757"><a href="#-2757"><span class="linenos">2757</span></a>                <span class="c1"># Initialize return parameters</span>
</span><span id="Faults-2758"><a href="#-2758"><span class="linenos">2758</span></a>                <span class="n">a</span> <span class="o">=</span> <span class="n">a_ini</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Faults-2759"><a href="#-2759"><span class="linenos">2759</span></a>                <span class="n">b</span> <span class="o">=</span> <span class="n">b_ini</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Faults-2760"><a href="#-2760"><span class="linenos">2760</span></a>                <span class="n">c</span> <span class="o">=</span> <span class="n">c_ini</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Faults-2761"><a href="#-2761"><span class="linenos">2761</span></a>                <span class="n">x0</span> <span class="o">=</span> <span class="n">x0_ini</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Faults-2762"><a href="#-2762"><span class="linenos">2762</span></a>                <span class="n">y0</span> <span class="o">=</span> <span class="n">y0_ini</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Faults-2763"><a href="#-2763"><span class="linenos">2763</span></a>                <span class="n">z0</span> <span class="o">=</span> <span class="n">z0_ini</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Faults-2764"><a href="#-2764"><span class="linenos">2764</span></a>                <span class="n">tilt_pct</span> <span class="o">=</span> <span class="n">tilt_pct_ini</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Faults-2765"><a href="#-2765"><span class="linenos">2765</span></a>                <span class="n">throw_lut</span> <span class="o">=</span> <span class="n">throw_lut_ini</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Faults-2766"><a href="#-2766"><span class="linenos">2766</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Faults-2767"><a href="#-2767"><span class="linenos">2767</span></a>                <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">a_ini</span><span class="p">)</span>
</span><span id="Faults-2768"><a href="#-2768"><span class="linenos">2768</span></a>                <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">b_ini</span><span class="p">)</span>
</span><span id="Faults-2769"><a href="#-2769"><span class="linenos">2769</span></a>                <span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">c_ini</span><span class="p">)</span>
</span><span id="Faults-2770"><a href="#-2770"><span class="linenos">2770</span></a>                <span class="n">x0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">x0_ini</span><span class="p">)</span>
</span><span id="Faults-2771"><a href="#-2771"><span class="linenos">2771</span></a>                <span class="n">y0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y0</span><span class="p">,</span> <span class="n">y0_ini</span><span class="p">)</span>
</span><span id="Faults-2772"><a href="#-2772"><span class="linenos">2772</span></a>                <span class="n">z0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">z0</span><span class="p">,</span> <span class="n">z0_ini</span><span class="p">)</span>
</span><span id="Faults-2773"><a href="#-2773"><span class="linenos">2773</span></a>                <span class="n">tilt_pct</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tilt_pct</span><span class="p">,</span> <span class="n">tilt_pct_ini</span><span class="p">)</span>
</span><span id="Faults-2774"><a href="#-2774"><span class="linenos">2774</span></a>                <span class="n">throw_lut</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">throw_lut</span><span class="p">,</span> <span class="n">throw_lut_ini</span><span class="p">)</span>
</span><span id="Faults-2775"><a href="#-2775"><span class="linenos">2775</span></a>            <span class="c1"># Construct fault in branch</span>
</span><span id="Faults-2776"><a href="#-2776"><span class="linenos">2776</span></a>            <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">number_of_branches</span> <span class="o">-</span> <span class="mi">1</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">number_faults</span> <span class="o">%</span> <span class="mi">3</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Faults-2777"><a href="#-2777"><span class="linenos">2777</span></a>                <span class="n">fault_in_branch</span> <span class="o">=</span> <span class="mi">2</span>
</span><span id="Faults-2778"><a href="#-2778"><span class="linenos">2778</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Faults-2779"><a href="#-2779"><span class="linenos">2779</span></a>                <span class="n">fault_in_branch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">number_faults</span> <span class="o">%</span> <span class="mi">3</span>
</span><span id="Faults-2780"><a href="#-2780"><span class="linenos">2780</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; ... Branch along axis &quot;</span><span class="p">,</span> <span class="n">side</span><span class="p">)</span>
</span><span id="Faults-2781"><a href="#-2781"><span class="linenos">2781</span></a>
</span><span id="Faults-2782"><a href="#-2782"><span class="linenos">2782</span></a>            <span class="n">direction</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="Faults-2783"><a href="#-2783"><span class="linenos">2783</span></a>            <span class="k">if</span> <span class="n">side</span> <span class="o">==</span> <span class="s2">&quot;x&quot;</span><span class="p">:</span>
</span><span id="Faults-2784"><a href="#-2784"><span class="linenos">2784</span></a>                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">y0_ini</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">y0_ini</span><span class="p">)):</span>
</span><span id="Faults-2785"><a href="#-2785"><span class="linenos">2785</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;     ... Building from right to left&quot;</span><span class="p">)</span>
</span><span id="Faults-2786"><a href="#-2786"><span class="linenos">2786</span></a>                    <span class="n">direction</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
</span><span id="Faults-2787"><a href="#-2787"><span class="linenos">2787</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Faults-2788"><a href="#-2788"><span class="linenos">2788</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;     ... Building from left to right&quot;</span><span class="p">)</span>
</span><span id="Faults-2789"><a href="#-2789"><span class="linenos">2789</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Faults-2790"><a href="#-2790"><span class="linenos">2790</span></a>                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">x0_ini</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">x0_ini</span><span class="p">)):</span>
</span><span id="Faults-2791"><a href="#-2791"><span class="linenos">2791</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;     ... Building from left to right&quot;</span><span class="p">)</span>
</span><span id="Faults-2792"><a href="#-2792"><span class="linenos">2792</span></a>                    <span class="n">direction</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
</span><span id="Faults-2793"><a href="#-2793"><span class="linenos">2793</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Faults-2794"><a href="#-2794"><span class="linenos">2794</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;     ... Building from right to left&quot;</span><span class="p">)</span>
</span><span id="Faults-2795"><a href="#-2795"><span class="linenos">2795</span></a>            <span class="n">move</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="Faults-2796"><a href="#-2796"><span class="linenos">2796</span></a>            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span>
</span><span id="Faults-2797"><a href="#-2797"><span class="linenos">2797</span></a>                <span class="n">i</span> <span class="o">*</span> <span class="n">number_of_branches</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">fault_in_branch</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="n">number_of_branches</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="Faults-2798"><a href="#-2798"><span class="linenos">2798</span></a>            <span class="p">):</span>
</span><span id="Faults-2799"><a href="#-2799"><span class="linenos">2799</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;     ... Computing fault number &quot;</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
</span><span id="Faults-2800"><a href="#-2800"><span class="linenos">2800</span></a>                <span class="c1"># Allow 20% deviation from initial fault parameter</span>
</span><span id="Faults-2801"><a href="#-2801"><span class="linenos">2801</span></a>                <span class="n">a_ramp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">)</span> <span class="o">*</span> <span class="n">a_ini</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Faults-2802"><a href="#-2802"><span class="linenos">2802</span></a>                <span class="n">b_ramp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">)</span> <span class="o">*</span> <span class="n">b_ini</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Faults-2803"><a href="#-2803"><span class="linenos">2803</span></a>                <span class="n">c_ramp</span> <span class="o">=</span> <span class="n">c_ini</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Faults-2804"><a href="#-2804"><span class="linenos">2804</span></a>                <span class="k">if</span> <span class="n">side</span> <span class="o">==</span> <span class="s2">&quot;x&quot;</span><span class="p">:</span>
</span><span id="Faults-2805"><a href="#-2805"><span class="linenos">2805</span></a>                    <span class="n">x0_ramp</span> <span class="o">=</span> <span class="n">x0_ini</span> <span class="o">+</span> <span class="n">direction</span> <span class="o">*</span> <span class="n">move</span> <span class="o">*</span> <span class="nb">int</span><span class="p">(</span>
</span><span id="Faults-2806"><a href="#-2806"><span class="linenos">2806</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mf">3.0</span>
</span><span id="Faults-2807"><a href="#-2807"><span class="linenos">2807</span></a>                    <span class="p">)</span>
</span><span id="Faults-2808"><a href="#-2808"><span class="linenos">2808</span></a>                    <span class="n">y0_ramp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.9</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">)</span> <span class="o">*</span> <span class="n">y0_ini</span>
</span><span id="Faults-2809"><a href="#-2809"><span class="linenos">2809</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Faults-2810"><a href="#-2810"><span class="linenos">2810</span></a>                    <span class="n">y0_ramp</span> <span class="o">=</span> <span class="n">y0_ini</span> <span class="o">+</span> <span class="n">direction</span> <span class="o">*</span> <span class="n">move</span> <span class="o">*</span> <span class="nb">int</span><span class="p">(</span>
</span><span id="Faults-2811"><a href="#-2811"><span class="linenos">2811</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mf">3.0</span>
</span><span id="Faults-2812"><a href="#-2812"><span class="linenos">2812</span></a>                    <span class="p">)</span>
</span><span id="Faults-2813"><a href="#-2813"><span class="linenos">2813</span></a>                    <span class="n">x0_ramp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.9</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">)</span> <span class="o">*</span> <span class="n">x0_ini</span>
</span><span id="Faults-2814"><a href="#-2814"><span class="linenos">2814</span></a>                <span class="n">z0_ramp</span> <span class="o">=</span> <span class="n">z0_ini</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Faults-2815"><a href="#-2815"><span class="linenos">2815</span></a>                <span class="n">tilt_pct_ramp</span> <span class="o">=</span> <span class="n">tilt_pct_ini</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.85</span><span class="p">,</span> <span class="mf">1.15</span><span class="p">)</span>
</span><span id="Faults-2816"><a href="#-2816"><span class="linenos">2816</span></a>                <span class="c1"># Add to existing</span>
</span><span id="Faults-2817"><a href="#-2817"><span class="linenos">2817</span></a>                <span class="n">throw_lut_ramp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span>
</span><span id="Faults-2818"><a href="#-2818"><span class="linenos">2818</span></a>                    <span class="n">low</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">low_fault_throw</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">high_fault_throw</span>
</span><span id="Faults-2819"><a href="#-2819"><span class="linenos">2819</span></a>                <span class="p">)</span>
</span><span id="Faults-2820"><a href="#-2820"><span class="linenos">2820</span></a>                <span class="n">throw_lut</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">throw_lut</span><span class="p">,</span> <span class="n">throw_lut_ramp</span><span class="p">)</span>
</span><span id="Faults-2821"><a href="#-2821"><span class="linenos">2821</span></a>                <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">a_ramp</span><span class="p">)</span>
</span><span id="Faults-2822"><a href="#-2822"><span class="linenos">2822</span></a>                <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">b_ramp</span><span class="p">)</span>
</span><span id="Faults-2823"><a href="#-2823"><span class="linenos">2823</span></a>                <span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">c_ramp</span><span class="p">)</span>
</span><span id="Faults-2824"><a href="#-2824"><span class="linenos">2824</span></a>                <span class="n">x0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">x0_ramp</span><span class="p">)</span>
</span><span id="Faults-2825"><a href="#-2825"><span class="linenos">2825</span></a>                <span class="n">y0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y0</span><span class="p">,</span> <span class="n">y0_ramp</span><span class="p">)</span>
</span><span id="Faults-2826"><a href="#-2826"><span class="linenos">2826</span></a>                <span class="n">z0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">z0</span><span class="p">,</span> <span class="n">z0_ramp</span><span class="p">)</span>
</span><span id="Faults-2827"><a href="#-2827"><span class="linenos">2827</span></a>                <span class="n">tilt_pct</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tilt_pct</span><span class="p">,</span> <span class="n">tilt_pct_ramp</span><span class="p">)</span>
</span><span id="Faults-2828"><a href="#-2828"><span class="linenos">2828</span></a>                <span class="n">move</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="Faults-2829"><a href="#-2829"><span class="linenos">2829</span></a>
</span><span id="Faults-2830"><a href="#-2830"><span class="linenos">2830</span></a>        <span class="n">fault_param_dict</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="Faults-2831"><a href="#-2831"><span class="linenos">2831</span></a>            <span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="n">a</span><span class="p">,</span>
</span><span id="Faults-2832"><a href="#-2832"><span class="linenos">2832</span></a>            <span class="s2">&quot;b&quot;</span><span class="p">:</span> <span class="n">b</span><span class="p">,</span>
</span><span id="Faults-2833"><a href="#-2833"><span class="linenos">2833</span></a>            <span class="s2">&quot;c&quot;</span><span class="p">:</span> <span class="n">c</span><span class="p">,</span>
</span><span id="Faults-2834"><a href="#-2834"><span class="linenos">2834</span></a>            <span class="s2">&quot;x0&quot;</span><span class="p">:</span> <span class="n">x0</span><span class="p">,</span>
</span><span id="Faults-2835"><a href="#-2835"><span class="linenos">2835</span></a>            <span class="s2">&quot;y0&quot;</span><span class="p">:</span> <span class="n">y0</span><span class="p">,</span>
</span><span id="Faults-2836"><a href="#-2836"><span class="linenos">2836</span></a>            <span class="s2">&quot;z0&quot;</span><span class="p">:</span> <span class="n">z0</span><span class="p">,</span>
</span><span id="Faults-2837"><a href="#-2837"><span class="linenos">2837</span></a>            <span class="s2">&quot;tilt_pct&quot;</span><span class="p">:</span> <span class="n">tilt_pct</span><span class="p">,</span>
</span><span id="Faults-2838"><a href="#-2838"><span class="linenos">2838</span></a>            <span class="s2">&quot;throw&quot;</span><span class="p">:</span> <span class="n">throw_lut</span><span class="p">,</span>
</span><span id="Faults-2839"><a href="#-2839"><span class="linenos">2839</span></a>        <span class="p">}</span>
</span><span id="Faults-2840"><a href="#-2840"><span class="linenos">2840</span></a>        <span class="k">return</span> <span class="n">fault_param_dict</span>
</span><span id="Faults-2841"><a href="#-2841"><span class="linenos">2841</span></a>
</span><span id="Faults-2842"><a href="#-2842"><span class="linenos">2842</span></a>    <span class="k">def</span> <span class="nf">_fault_params_stairs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Faults-2843"><a href="#-2843"><span class="linenos">2843</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; ... Stairs like feature&quot;</span><span class="p">)</span>
</span><span id="Faults-2844"><a href="#-2844"><span class="linenos">2844</span></a>        <span class="c1"># Initialize value for first fault</span>
</span><span id="Faults-2845"><a href="#-2845"><span class="linenos">2845</span></a>        <span class="n">x0_min</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mf">4.0</span><span class="p">)</span>
</span><span id="Faults-2846"><a href="#-2846"><span class="linenos">2846</span></a>        <span class="n">x0_max</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">)</span>
</span><span id="Faults-2847"><a href="#-2847"><span class="linenos">2847</span></a>        <span class="n">y0_min</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="mf">4.0</span><span class="p">)</span>
</span><span id="Faults-2848"><a href="#-2848"><span class="linenos">2848</span></a>        <span class="n">y0_max</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">)</span>
</span><span id="Faults-2849"><a href="#-2849"><span class="linenos">2849</span></a>
</span><span id="Faults-2850"><a href="#-2850"><span class="linenos">2850</span></a>        <span class="n">b_ini</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">600</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="Faults-2851"><a href="#-2851"><span class="linenos">2851</span></a>        <span class="n">a_ini</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">600</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="Faults-2852"><a href="#-2852"><span class="linenos">2852</span></a>        <span class="n">x0_ini</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
</span><span id="Faults-2853"><a href="#-2853"><span class="linenos">2853</span></a>            <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">x0_min</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">a_ini</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">a_ini</span><span class="p">)</span> <span class="o">+</span> <span class="n">x0_max</span><span class="p">)</span>
</span><span id="Faults-2854"><a href="#-2854"><span class="linenos">2854</span></a>        <span class="p">)</span>
</span><span id="Faults-2855"><a href="#-2855"><span class="linenos">2855</span></a>        <span class="n">y0_ini</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
</span><span id="Faults-2856"><a href="#-2856"><span class="linenos">2856</span></a>            <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">y0_min</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">b_ini</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">b_ini</span><span class="p">)</span> <span class="o">+</span> <span class="n">y0_max</span><span class="p">)</span>
</span><span id="Faults-2857"><a href="#-2857"><span class="linenos">2857</span></a>        <span class="p">)</span>
</span><span id="Faults-2858"><a href="#-2858"><span class="linenos">2858</span></a>        <span class="n">z0_ini</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
</span><span id="Faults-2859"><a href="#-2859"><span class="linenos">2859</span></a>            <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span>
</span><span id="Faults-2860"><a href="#-2860"><span class="linenos">2860</span></a>                <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="mf">2.0</span><span class="p">,</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="mf">6.0</span>
</span><span id="Faults-2861"><a href="#-2861"><span class="linenos">2861</span></a>            <span class="p">)</span>
</span><span id="Faults-2862"><a href="#-2862"><span class="linenos">2862</span></a>        <span class="p">)</span>
</span><span id="Faults-2863"><a href="#-2863"><span class="linenos">2863</span></a>
</span><span id="Faults-2864"><a href="#-2864"><span class="linenos">2864</span></a>        <span class="n">_c0_ini</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">infill_factor</span> <span class="o">*</span> <span class="mf">4.0</span> <span class="o">-</span> <span class="n">z0_ini</span>
</span><span id="Faults-2865"><a href="#-2865"><span class="linenos">2865</span></a>        <span class="n">_c1_ini</span> <span class="o">=</span> <span class="n">_c0_ini</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">infill_factor</span> <span class="o">/</span> <span class="mf">4.0</span>
</span><span id="Faults-2866"><a href="#-2866"><span class="linenos">2866</span></a>        <span class="n">c_ini</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">_c0_ini</span><span class="p">,</span> <span class="n">_c1_ini</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="Faults-2867"><a href="#-2867"><span class="linenos">2867</span></a>
</span><span id="Faults-2868"><a href="#-2868"><span class="linenos">2868</span></a>        <span class="n">tilt_pct_ini</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">))</span>
</span><span id="Faults-2869"><a href="#-2869"><span class="linenos">2869</span></a>        <span class="n">throw_lut</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span>
</span><span id="Faults-2870"><a href="#-2870"><span class="linenos">2870</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">low_fault_throw</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">high_fault_throw</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">number_faults</span>
</span><span id="Faults-2871"><a href="#-2871"><span class="linenos">2871</span></a>        <span class="p">)</span>
</span><span id="Faults-2872"><a href="#-2872"><span class="linenos">2872</span></a>        <span class="n">direction</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
</span><span id="Faults-2873"><a href="#-2873"><span class="linenos">2873</span></a>        <span class="n">separation_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
</span><span id="Faults-2874"><a href="#-2874"><span class="linenos">2874</span></a>        <span class="n">separation_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
</span><span id="Faults-2875"><a href="#-2875"><span class="linenos">2875</span></a>        <span class="c1"># Initialize return parameters</span>
</span><span id="Faults-2876"><a href="#-2876"><span class="linenos">2876</span></a>        <span class="n">a</span> <span class="o">=</span> <span class="n">a_ini</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Faults-2877"><a href="#-2877"><span class="linenos">2877</span></a>        <span class="n">b</span> <span class="o">=</span> <span class="n">b_ini</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Faults-2878"><a href="#-2878"><span class="linenos">2878</span></a>        <span class="n">c</span> <span class="o">=</span> <span class="n">c_ini</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Faults-2879"><a href="#-2879"><span class="linenos">2879</span></a>        <span class="n">x0</span> <span class="o">=</span> <span class="n">x0_ini</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Faults-2880"><a href="#-2880"><span class="linenos">2880</span></a>        <span class="n">y0</span> <span class="o">=</span> <span class="n">y0_ini</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Faults-2881"><a href="#-2881"><span class="linenos">2881</span></a>        <span class="n">z0</span> <span class="o">=</span> <span class="n">z0_ini</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Faults-2882"><a href="#-2882"><span class="linenos">2882</span></a>        <span class="n">x0_prec</span> <span class="o">=</span> <span class="n">x0_ini</span>
</span><span id="Faults-2883"><a href="#-2883"><span class="linenos">2883</span></a>        <span class="n">y0_prec</span> <span class="o">=</span> <span class="n">y0_ini</span>
</span><span id="Faults-2884"><a href="#-2884"><span class="linenos">2884</span></a>        <span class="n">tilt_pct</span> <span class="o">=</span> <span class="n">tilt_pct_ini</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Faults-2885"><a href="#-2885"><span class="linenos">2885</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">number_faults</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="Faults-2886"><a href="#-2886"><span class="linenos">2886</span></a>            <span class="n">a_ramp</span> <span class="o">=</span> <span class="n">a_ini</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">)</span>
</span><span id="Faults-2887"><a href="#-2887"><span class="linenos">2887</span></a>            <span class="n">b_ramp</span> <span class="o">=</span> <span class="n">b_ini</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">)</span>
</span><span id="Faults-2888"><a href="#-2888"><span class="linenos">2888</span></a>            <span class="n">c_ramp</span> <span class="o">=</span> <span class="n">c_ini</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">)</span>
</span><span id="Faults-2889"><a href="#-2889"><span class="linenos">2889</span></a>            <span class="n">direction</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
</span><span id="Faults-2890"><a href="#-2890"><span class="linenos">2890</span></a>            <span class="n">x0_ramp</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="Faults-2891"><a href="#-2891"><span class="linenos">2891</span></a>                <span class="n">x0_prec</span> <span class="o">+</span> <span class="n">separation_x</span> <span class="o">*</span> <span class="n">direction</span> <span class="o">*</span> <span class="n">x0_ini</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">number_faults</span>
</span><span id="Faults-2892"><a href="#-2892"><span class="linenos">2892</span></a>            <span class="p">)</span>
</span><span id="Faults-2893"><a href="#-2893"><span class="linenos">2893</span></a>            <span class="n">y0_ramp</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="Faults-2894"><a href="#-2894"><span class="linenos">2894</span></a>                <span class="n">y0_prec</span> <span class="o">+</span> <span class="n">separation_y</span> <span class="o">*</span> <span class="n">direction</span> <span class="o">*</span> <span class="n">y0_ini</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">number_faults</span>
</span><span id="Faults-2895"><a href="#-2895"><span class="linenos">2895</span></a>            <span class="p">)</span>
</span><span id="Faults-2896"><a href="#-2896"><span class="linenos">2896</span></a>            <span class="n">z0_ramp</span> <span class="o">=</span> <span class="n">z0_ini</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Faults-2897"><a href="#-2897"><span class="linenos">2897</span></a>            <span class="n">tilt_pct_ramp</span> <span class="o">=</span> <span class="n">tilt_pct_ini</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.85</span><span class="p">,</span> <span class="mf">1.15</span><span class="p">)</span>
</span><span id="Faults-2898"><a href="#-2898"><span class="linenos">2898</span></a>            <span class="n">x0_prec</span> <span class="o">=</span> <span class="n">x0_ramp</span>
</span><span id="Faults-2899"><a href="#-2899"><span class="linenos">2899</span></a>            <span class="n">y0_prec</span> <span class="o">=</span> <span class="n">y0_ramp</span>
</span><span id="Faults-2900"><a href="#-2900"><span class="linenos">2900</span></a>            <span class="c1"># Add to existing</span>
</span><span id="Faults-2901"><a href="#-2901"><span class="linenos">2901</span></a>            <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">a_ramp</span><span class="p">)</span>
</span><span id="Faults-2902"><a href="#-2902"><span class="linenos">2902</span></a>            <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">b_ramp</span><span class="p">)</span>
</span><span id="Faults-2903"><a href="#-2903"><span class="linenos">2903</span></a>            <span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">c_ramp</span><span class="p">)</span>
</span><span id="Faults-2904"><a href="#-2904"><span class="linenos">2904</span></a>            <span class="n">x0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">x0_ramp</span><span class="p">)</span>
</span><span id="Faults-2905"><a href="#-2905"><span class="linenos">2905</span></a>            <span class="n">y0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y0</span><span class="p">,</span> <span class="n">y0_ramp</span><span class="p">)</span>
</span><span id="Faults-2906"><a href="#-2906"><span class="linenos">2906</span></a>            <span class="n">z0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">z0</span><span class="p">,</span> <span class="n">z0_ramp</span><span class="p">)</span>
</span><span id="Faults-2907"><a href="#-2907"><span class="linenos">2907</span></a>            <span class="n">tilt_pct</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tilt_pct</span><span class="p">,</span> <span class="n">tilt_pct_ramp</span><span class="p">)</span>
</span><span id="Faults-2908"><a href="#-2908"><span class="linenos">2908</span></a>
</span><span id="Faults-2909"><a href="#-2909"><span class="linenos">2909</span></a>        <span class="n">fault_param_dict</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="Faults-2910"><a href="#-2910"><span class="linenos">2910</span></a>            <span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="n">a</span><span class="p">,</span>
</span><span id="Faults-2911"><a href="#-2911"><span class="linenos">2911</span></a>            <span class="s2">&quot;b&quot;</span><span class="p">:</span> <span class="n">b</span><span class="p">,</span>
</span><span id="Faults-2912"><a href="#-2912"><span class="linenos">2912</span></a>            <span class="s2">&quot;c&quot;</span><span class="p">:</span> <span class="n">c</span><span class="p">,</span>
</span><span id="Faults-2913"><a href="#-2913"><span class="linenos">2913</span></a>            <span class="s2">&quot;x0&quot;</span><span class="p">:</span> <span class="n">x0</span><span class="p">,</span>
</span><span id="Faults-2914"><a href="#-2914"><span class="linenos">2914</span></a>            <span class="s2">&quot;y0&quot;</span><span class="p">:</span> <span class="n">y0</span><span class="p">,</span>
</span><span id="Faults-2915"><a href="#-2915"><span class="linenos">2915</span></a>            <span class="s2">&quot;z0&quot;</span><span class="p">:</span> <span class="n">z0</span><span class="p">,</span>
</span><span id="Faults-2916"><a href="#-2916"><span class="linenos">2916</span></a>            <span class="s2">&quot;tilt_pct&quot;</span><span class="p">:</span> <span class="n">tilt_pct</span><span class="p">,</span>
</span><span id="Faults-2917"><a href="#-2917"><span class="linenos">2917</span></a>            <span class="s2">&quot;throw&quot;</span><span class="p">:</span> <span class="n">throw_lut</span><span class="p">,</span>
</span><span id="Faults-2918"><a href="#-2918"><span class="linenos">2918</span></a>        <span class="p">}</span>
</span><span id="Faults-2919"><a href="#-2919"><span class="linenos">2919</span></a>        <span class="k">return</span> <span class="n">fault_param_dict</span>
</span><span id="Faults-2920"><a href="#-2920"><span class="linenos">2920</span></a>
</span><span id="Faults-2921"><a href="#-2921"><span class="linenos">2921</span></a>    <span class="k">def</span> <span class="nf">_fault_params_relay_ramps</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Faults-2922"><a href="#-2922"><span class="linenos">2922</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; ... relay ramps&quot;</span><span class="p">)</span>
</span><span id="Faults-2923"><a href="#-2923"><span class="linenos">2923</span></a>        <span class="c1"># Initialize value for first fault</span>
</span><span id="Faults-2924"><a href="#-2924"><span class="linenos">2924</span></a>        <span class="c1"># Maximum of 3 fault per ramp</span>
</span><span id="Faults-2925"><a href="#-2925"><span class="linenos">2925</span></a>        <span class="n">x0_min</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mf">4.0</span><span class="p">)</span>
</span><span id="Faults-2926"><a href="#-2926"><span class="linenos">2926</span></a>        <span class="n">x0_max</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">)</span>
</span><span id="Faults-2927"><a href="#-2927"><span class="linenos">2927</span></a>        <span class="n">y0_min</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="mf">4.0</span><span class="p">)</span>
</span><span id="Faults-2928"><a href="#-2928"><span class="linenos">2928</span></a>        <span class="n">y0_max</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">)</span>
</span><span id="Faults-2929"><a href="#-2929"><span class="linenos">2929</span></a>        <span class="n">number_of_branches</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">number_faults</span> <span class="o">/</span> <span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span>
</span><span id="Faults-2930"><a href="#-2930"><span class="linenos">2930</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">number_faults</span> <span class="o">%</span> <span class="mi">3</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Faults-2931"><a href="#-2931"><span class="linenos">2931</span></a>        <span class="p">)</span>
</span><span id="Faults-2932"><a href="#-2932"><span class="linenos">2932</span></a>
</span><span id="Faults-2933"><a href="#-2933"><span class="linenos">2933</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">number_of_branches</span><span class="p">):</span>
</span><span id="Faults-2934"><a href="#-2934"><span class="linenos">2934</span></a>            <span class="c1"># Initialize first fault center, offset center between each branch</span>
</span><span id="Faults-2935"><a href="#-2935"><span class="linenos">2935</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; ... Computing branch number &quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
</span><span id="Faults-2936"><a href="#-2936"><span class="linenos">2936</span></a>            <span class="n">b_ini</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">600</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="Faults-2937"><a href="#-2937"><span class="linenos">2937</span></a>            <span class="n">a_ini</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">600</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="Faults-2938"><a href="#-2938"><span class="linenos">2938</span></a>            <span class="n">x0_ini</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
</span><span id="Faults-2939"><a href="#-2939"><span class="linenos">2939</span></a>                <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">x0_min</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">a_ini</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">a_ini</span><span class="p">)</span> <span class="o">+</span> <span class="n">x0_max</span><span class="p">)</span>
</span><span id="Faults-2940"><a href="#-2940"><span class="linenos">2940</span></a>                <span class="o">/</span> <span class="mi">2</span>
</span><span id="Faults-2941"><a href="#-2941"><span class="linenos">2941</span></a>            <span class="p">)</span>
</span><span id="Faults-2942"><a href="#-2942"><span class="linenos">2942</span></a>            <span class="n">y0_ini</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
</span><span id="Faults-2943"><a href="#-2943"><span class="linenos">2943</span></a>                <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">y0_min</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">b_ini</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">b_ini</span><span class="p">)</span> <span class="o">+</span> <span class="n">y0_max</span><span class="p">)</span>
</span><span id="Faults-2944"><a href="#-2944"><span class="linenos">2944</span></a>                <span class="o">/</span> <span class="mi">2</span>
</span><span id="Faults-2945"><a href="#-2945"><span class="linenos">2945</span></a>            <span class="p">)</span>
</span><span id="Faults-2946"><a href="#-2946"><span class="linenos">2946</span></a>            <span class="c1"># Compute the rest of the initial parameters normally</span>
</span><span id="Faults-2947"><a href="#-2947"><span class="linenos">2947</span></a>            <span class="n">z0_ini</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
</span><span id="Faults-2948"><a href="#-2948"><span class="linenos">2948</span></a>                <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span>
</span><span id="Faults-2949"><a href="#-2949"><span class="linenos">2949</span></a>                    <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="mf">2.0</span><span class="p">,</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="mf">6.0</span>
</span><span id="Faults-2950"><a href="#-2950"><span class="linenos">2950</span></a>                <span class="p">)</span>
</span><span id="Faults-2951"><a href="#-2951"><span class="linenos">2951</span></a>            <span class="p">)</span>
</span><span id="Faults-2952"><a href="#-2952"><span class="linenos">2952</span></a>            <span class="n">c_ini</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
</span><span id="Faults-2953"><a href="#-2953"><span class="linenos">2953</span></a>                <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span>
</span><span id="Faults-2954"><a href="#-2954"><span class="linenos">2954</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">infill_factor</span> <span class="o">*</span> <span class="mf">4.0</span> <span class="o">-</span> <span class="n">z0_ini</span><span class="p">,</span>
</span><span id="Faults-2955"><a href="#-2955"><span class="linenos">2955</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">infill_factor</span> <span class="o">*</span> <span class="mf">4.0</span>
</span><span id="Faults-2956"><a href="#-2956"><span class="linenos">2956</span></a>                    <span class="o">-</span> <span class="n">z0_ini</span>
</span><span id="Faults-2957"><a href="#-2957"><span class="linenos">2957</span></a>                    <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">infill_factor</span> <span class="o">/</span> <span class="mf">4.0</span><span class="p">,</span>
</span><span id="Faults-2958"><a href="#-2958"><span class="linenos">2958</span></a>                <span class="p">)</span>
</span><span id="Faults-2959"><a href="#-2959"><span class="linenos">2959</span></a>                <span class="o">**</span> <span class="mi">2</span>
</span><span id="Faults-2960"><a href="#-2960"><span class="linenos">2960</span></a>            <span class="p">)</span>
</span><span id="Faults-2961"><a href="#-2961"><span class="linenos">2961</span></a>            <span class="n">tilt_pct_ini</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">))</span>
</span><span id="Faults-2962"><a href="#-2962"><span class="linenos">2962</span></a>            <span class="n">throw_lut</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span>
</span><span id="Faults-2963"><a href="#-2963"><span class="linenos">2963</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">low_fault_throw</span><span class="p">,</span>
</span><span id="Faults-2964"><a href="#-2964"><span class="linenos">2964</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">high_fault_throw</span><span class="p">,</span>
</span><span id="Faults-2965"><a href="#-2965"><span class="linenos">2965</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">number_faults</span><span class="p">,</span>
</span><span id="Faults-2966"><a href="#-2966"><span class="linenos">2966</span></a>            <span class="p">)</span>
</span><span id="Faults-2967"><a href="#-2967"><span class="linenos">2967</span></a>            <span class="c1"># Initialize return parameters</span>
</span><span id="Faults-2968"><a href="#-2968"><span class="linenos">2968</span></a>            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Faults-2969"><a href="#-2969"><span class="linenos">2969</span></a>                <span class="n">a</span> <span class="o">=</span> <span class="n">a_ini</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Faults-2970"><a href="#-2970"><span class="linenos">2970</span></a>                <span class="n">b</span> <span class="o">=</span> <span class="n">b_ini</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Faults-2971"><a href="#-2971"><span class="linenos">2971</span></a>                <span class="n">c</span> <span class="o">=</span> <span class="n">c_ini</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Faults-2972"><a href="#-2972"><span class="linenos">2972</span></a>                <span class="n">x0</span> <span class="o">=</span> <span class="n">x0_ini</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Faults-2973"><a href="#-2973"><span class="linenos">2973</span></a>                <span class="n">y0</span> <span class="o">=</span> <span class="n">y0_ini</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Faults-2974"><a href="#-2974"><span class="linenos">2974</span></a>                <span class="n">z0</span> <span class="o">=</span> <span class="n">z0_ini</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Faults-2975"><a href="#-2975"><span class="linenos">2975</span></a>                <span class="n">tilt_pct</span> <span class="o">=</span> <span class="n">tilt_pct_ini</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Faults-2976"><a href="#-2976"><span class="linenos">2976</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Faults-2977"><a href="#-2977"><span class="linenos">2977</span></a>                <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">a_ini</span><span class="p">)</span>
</span><span id="Faults-2978"><a href="#-2978"><span class="linenos">2978</span></a>                <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">b_ini</span><span class="p">)</span>
</span><span id="Faults-2979"><a href="#-2979"><span class="linenos">2979</span></a>                <span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">c_ini</span><span class="p">)</span>
</span><span id="Faults-2980"><a href="#-2980"><span class="linenos">2980</span></a>                <span class="n">x0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">x0_ini</span><span class="p">)</span>
</span><span id="Faults-2981"><a href="#-2981"><span class="linenos">2981</span></a>                <span class="n">y0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y0</span><span class="p">,</span> <span class="n">y0_ini</span><span class="p">)</span>
</span><span id="Faults-2982"><a href="#-2982"><span class="linenos">2982</span></a>                <span class="n">z0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">z0</span><span class="p">,</span> <span class="n">z0_ini</span><span class="p">)</span>
</span><span id="Faults-2983"><a href="#-2983"><span class="linenos">2983</span></a>                <span class="n">tilt_pct</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tilt_pct</span><span class="p">,</span> <span class="n">tilt_pct_ini</span><span class="p">)</span>
</span><span id="Faults-2984"><a href="#-2984"><span class="linenos">2984</span></a>                <span class="c1"># Construct fault in branch</span>
</span><span id="Faults-2985"><a href="#-2985"><span class="linenos">2985</span></a>            <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">number_of_branches</span> <span class="o">-</span> <span class="mi">1</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">number_faults</span> <span class="o">%</span> <span class="mi">3</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Faults-2986"><a href="#-2986"><span class="linenos">2986</span></a>                <span class="n">fault_in_branche</span> <span class="o">=</span> <span class="mi">2</span>
</span><span id="Faults-2987"><a href="#-2987"><span class="linenos">2987</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Faults-2988"><a href="#-2988"><span class="linenos">2988</span></a>                <span class="n">fault_in_branche</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">number_faults</span> <span class="o">%</span> <span class="mi">3</span>
</span><span id="Faults-2989"><a href="#-2989"><span class="linenos">2989</span></a>
</span><span id="Faults-2990"><a href="#-2990"><span class="linenos">2990</span></a>            <span class="n">direction</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
</span><span id="Faults-2991"><a href="#-2991"><span class="linenos">2991</span></a>            <span class="n">move</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="Faults-2992"><a href="#-2992"><span class="linenos">2992</span></a>            <span class="n">x0_prec</span> <span class="o">=</span> <span class="n">x0_ini</span>
</span><span id="Faults-2993"><a href="#-2993"><span class="linenos">2993</span></a>            <span class="n">y0_prec</span> <span class="o">=</span> <span class="n">y0_ini</span>
</span><span id="Faults-2994"><a href="#-2994"><span class="linenos">2994</span></a>            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span>
</span><span id="Faults-2995"><a href="#-2995"><span class="linenos">2995</span></a>                <span class="n">i</span> <span class="o">*</span> <span class="n">number_of_branches</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="Faults-2996"><a href="#-2996"><span class="linenos">2996</span></a>                <span class="n">fault_in_branche</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="n">number_of_branches</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="Faults-2997"><a href="#-2997"><span class="linenos">2997</span></a>            <span class="p">):</span>
</span><span id="Faults-2998"><a href="#-2998"><span class="linenos">2998</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;     ... Computing fault number &quot;</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
</span><span id="Faults-2999"><a href="#-2999"><span class="linenos">2999</span></a>                <span class="c1"># Allow 20% deviation from initial fault parameter</span>
</span><span id="Faults-3000"><a href="#-3000"><span class="linenos">3000</span></a>                <span class="n">a_ramp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">)</span> <span class="o">*</span> <span class="n">a_ini</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Faults-3001"><a href="#-3001"><span class="linenos">3001</span></a>                <span class="n">b_ramp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">)</span> <span class="o">*</span> <span class="n">b_ini</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Faults-3002"><a href="#-3002"><span class="linenos">3002</span></a>                <span class="n">c_ramp</span> <span class="o">=</span> <span class="n">c_ini</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Faults-3003"><a href="#-3003"><span class="linenos">3003</span></a>                <span class="n">direction</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
</span><span id="Faults-3004"><a href="#-3004"><span class="linenos">3004</span></a>                <span class="n">x0_ramp</span> <span class="o">=</span> <span class="n">x0_prec</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">)</span> <span class="o">+</span> <span class="n">direction</span> <span class="o">*</span> <span class="n">x0_ini</span> <span class="o">/</span> <span class="p">(</span>
</span><span id="Faults-3005"><a href="#-3005"><span class="linenos">3005</span></a>                    <span class="n">fault_in_branche</span>
</span><span id="Faults-3006"><a href="#-3006"><span class="linenos">3006</span></a>                <span class="p">)</span>
</span><span id="Faults-3007"><a href="#-3007"><span class="linenos">3007</span></a>                <span class="n">y0_ramp</span> <span class="o">=</span> <span class="n">y0_prec</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">)</span> <span class="o">+</span> <span class="n">direction</span> <span class="o">*</span> <span class="n">y0_ini</span> <span class="o">/</span> <span class="p">(</span>
</span><span id="Faults-3008"><a href="#-3008"><span class="linenos">3008</span></a>                    <span class="n">fault_in_branche</span>
</span><span id="Faults-3009"><a href="#-3009"><span class="linenos">3009</span></a>                <span class="p">)</span>
</span><span id="Faults-3010"><a href="#-3010"><span class="linenos">3010</span></a>                <span class="n">z0_ramp</span> <span class="o">=</span> <span class="n">z0_ini</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Faults-3011"><a href="#-3011"><span class="linenos">3011</span></a>                <span class="n">tilt_pct_ramp</span> <span class="o">=</span> <span class="n">tilt_pct_ini</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.85</span><span class="p">,</span> <span class="mf">1.15</span><span class="p">)</span>
</span><span id="Faults-3012"><a href="#-3012"><span class="linenos">3012</span></a>                <span class="c1"># Add to existing</span>
</span><span id="Faults-3013"><a href="#-3013"><span class="linenos">3013</span></a>                <span class="n">throw_LUT_ramp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span>
</span><span id="Faults-3014"><a href="#-3014"><span class="linenos">3014</span></a>                    <span class="n">low</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">low_fault_throw</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">high_fault_throw</span>
</span><span id="Faults-3015"><a href="#-3015"><span class="linenos">3015</span></a>                <span class="p">)</span>
</span><span id="Faults-3016"><a href="#-3016"><span class="linenos">3016</span></a>                <span class="n">throw_lut</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">throw_lut</span><span class="p">,</span> <span class="n">throw_LUT_ramp</span><span class="p">)</span>
</span><span id="Faults-3017"><a href="#-3017"><span class="linenos">3017</span></a>                <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">a_ramp</span><span class="p">)</span>
</span><span id="Faults-3018"><a href="#-3018"><span class="linenos">3018</span></a>                <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">b_ramp</span><span class="p">)</span>
</span><span id="Faults-3019"><a href="#-3019"><span class="linenos">3019</span></a>                <span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">c_ramp</span><span class="p">)</span>
</span><span id="Faults-3020"><a href="#-3020"><span class="linenos">3020</span></a>                <span class="n">x0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">x0_ramp</span><span class="p">)</span>
</span><span id="Faults-3021"><a href="#-3021"><span class="linenos">3021</span></a>                <span class="n">y0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y0</span><span class="p">,</span> <span class="n">y0_ramp</span><span class="p">)</span>
</span><span id="Faults-3022"><a href="#-3022"><span class="linenos">3022</span></a>                <span class="n">z0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">z0</span><span class="p">,</span> <span class="n">z0_ramp</span><span class="p">)</span>
</span><span id="Faults-3023"><a href="#-3023"><span class="linenos">3023</span></a>                <span class="n">tilt_pct</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tilt_pct</span><span class="p">,</span> <span class="n">tilt_pct_ramp</span><span class="p">)</span>
</span><span id="Faults-3024"><a href="#-3024"><span class="linenos">3024</span></a>                <span class="n">x0_prec</span> <span class="o">=</span> <span class="n">x0_ramp</span>
</span><span id="Faults-3025"><a href="#-3025"><span class="linenos">3025</span></a>                <span class="n">y0_prec</span> <span class="o">=</span> <span class="n">y0_ramp</span>
</span><span id="Faults-3026"><a href="#-3026"><span class="linenos">3026</span></a>                <span class="n">move</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="Faults-3027"><a href="#-3027"><span class="linenos">3027</span></a>
</span><span id="Faults-3028"><a href="#-3028"><span class="linenos">3028</span></a>        <span class="n">fault_param_dict</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="Faults-3029"><a href="#-3029"><span class="linenos">3029</span></a>            <span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="n">a</span><span class="p">,</span>
</span><span id="Faults-3030"><a href="#-3030"><span class="linenos">3030</span></a>            <span class="s2">&quot;b&quot;</span><span class="p">:</span> <span class="n">b</span><span class="p">,</span>
</span><span id="Faults-3031"><a href="#-3031"><span class="linenos">3031</span></a>            <span class="s2">&quot;c&quot;</span><span class="p">:</span> <span class="n">c</span><span class="p">,</span>
</span><span id="Faults-3032"><a href="#-3032"><span class="linenos">3032</span></a>            <span class="s2">&quot;x0&quot;</span><span class="p">:</span> <span class="n">x0</span><span class="p">,</span>
</span><span id="Faults-3033"><a href="#-3033"><span class="linenos">3033</span></a>            <span class="s2">&quot;y0&quot;</span><span class="p">:</span> <span class="n">y0</span><span class="p">,</span>
</span><span id="Faults-3034"><a href="#-3034"><span class="linenos">3034</span></a>            <span class="s2">&quot;z0&quot;</span><span class="p">:</span> <span class="n">z0</span><span class="p">,</span>
</span><span id="Faults-3035"><a href="#-3035"><span class="linenos">3035</span></a>            <span class="s2">&quot;tilt_pct&quot;</span><span class="p">:</span> <span class="n">tilt_pct</span><span class="p">,</span>
</span><span id="Faults-3036"><a href="#-3036"><span class="linenos">3036</span></a>            <span class="s2">&quot;throw&quot;</span><span class="p">:</span> <span class="n">throw_lut</span><span class="p">,</span>
</span><span id="Faults-3037"><a href="#-3037"><span class="linenos">3037</span></a>        <span class="p">}</span>
</span><span id="Faults-3038"><a href="#-3038"><span class="linenos">3038</span></a>        <span class="k">return</span> <span class="n">fault_param_dict</span>
</span><span id="Faults-3039"><a href="#-3039"><span class="linenos">3039</span></a>
</span><span id="Faults-3040"><a href="#-3040"><span class="linenos">3040</span></a>    <span class="k">def</span> <span class="nf">_fault_params_horst_graben</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Faults-3041"><a href="#-3041"><span class="linenos">3041</span></a>        <span class="nb">print</span><span class="p">(</span>
</span><span id="Faults-3042"><a href="#-3042"><span class="linenos">3042</span></a>            <span class="s2">&quot;   ... </span><span class="si">%s</span><span class="s2"> faults will be inserted as Horst and Graben&quot;</span>
</span><span id="Faults-3043"><a href="#-3043"><span class="linenos">3043</span></a>            <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">number_faults</span><span class="p">)</span>
</span><span id="Faults-3044"><a href="#-3044"><span class="linenos">3044</span></a>        <span class="p">)</span>
</span><span id="Faults-3045"><a href="#-3045"><span class="linenos">3045</span></a>        <span class="c1"># Initialize value for first fault</span>
</span><span id="Faults-3046"><a href="#-3046"><span class="linenos">3046</span></a>        <span class="n">x0_min</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">)</span>
</span><span id="Faults-3047"><a href="#-3047"><span class="linenos">3047</span></a>        <span class="n">x0_max</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="Faults-3048"><a href="#-3048"><span class="linenos">3048</span></a>        <span class="n">y0_min</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">)</span>
</span><span id="Faults-3049"><a href="#-3049"><span class="linenos">3049</span></a>        <span class="n">y0_max</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="Faults-3050"><a href="#-3050"><span class="linenos">3050</span></a>
</span><span id="Faults-3051"><a href="#-3051"><span class="linenos">3051</span></a>        <span class="n">b_ini</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">600</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="Faults-3052"><a href="#-3052"><span class="linenos">3052</span></a>        <span class="n">a_ini</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">600</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="Faults-3053"><a href="#-3053"><span class="linenos">3053</span></a>        <span class="k">if</span> <span class="n">a_ini</span> <span class="o">&gt;</span> <span class="n">b_ini</span><span class="p">:</span>
</span><span id="Faults-3054"><a href="#-3054"><span class="linenos">3054</span></a>            <span class="n">side</span> <span class="o">=</span> <span class="s2">&quot;x&quot;</span>
</span><span id="Faults-3055"><a href="#-3055"><span class="linenos">3055</span></a>            <span class="k">while</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">b_ini</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
</span><span id="Faults-3056"><a href="#-3056"><span class="linenos">3056</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   ... Recomputing b_ini for better branching&quot;</span><span class="p">)</span>
</span><span id="Faults-3057"><a href="#-3057"><span class="linenos">3057</span></a>                <span class="n">b_ini</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">600</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="Faults-3058"><a href="#-3058"><span class="linenos">3058</span></a>            <span class="n">x0_ini</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</span><span id="Faults-3059"><a href="#-3059"><span class="linenos">3059</span></a>            <span class="c1"># Compute so that first is near center</span>
</span><span id="Faults-3060"><a href="#-3060"><span class="linenos">3060</span></a>            <span class="n">range_1</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
</span><span id="Faults-3061"><a href="#-3061"><span class="linenos">3061</span></a>                <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">y0_min</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">b_ini</span><span class="p">)),</span> <span class="nb">int</span><span class="p">(</span><span class="n">y0_max</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">b_ini</span><span class="p">)))</span>
</span><span id="Faults-3062"><a href="#-3062"><span class="linenos">3062</span></a>            <span class="p">)</span>
</span><span id="Faults-3063"><a href="#-3063"><span class="linenos">3063</span></a>            <span class="n">range_2</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
</span><span id="Faults-3064"><a href="#-3064"><span class="linenos">3064</span></a>                <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">y0_min</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">b_ini</span><span class="p">)),</span> <span class="nb">int</span><span class="p">(</span><span class="n">y0_max</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">b_ini</span><span class="p">)))</span>
</span><span id="Faults-3065"><a href="#-3065"><span class="linenos">3065</span></a>            <span class="p">)</span>
</span><span id="Faults-3066"><a href="#-3066"><span class="linenos">3066</span></a>            <span class="n">y0_ini</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">range_1</span> <span class="o">+</span> <span class="n">range_2</span><span class="p">))</span>
</span><span id="Faults-3067"><a href="#-3067"><span class="linenos">3067</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Faults-3068"><a href="#-3068"><span class="linenos">3068</span></a>            <span class="n">side</span> <span class="o">=</span> <span class="s2">&quot;y&quot;</span>
</span><span id="Faults-3069"><a href="#-3069"><span class="linenos">3069</span></a>            <span class="k">while</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">a_ini</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
</span><span id="Faults-3070"><a href="#-3070"><span class="linenos">3070</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; ... Recomputing a_ini for better branching&quot;</span><span class="p">)</span>
</span><span id="Faults-3071"><a href="#-3071"><span class="linenos">3071</span></a>                <span class="n">a_ini</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">600</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="Faults-3072"><a href="#-3072"><span class="linenos">3072</span></a>            <span class="c1"># compute so that first is near center</span>
</span><span id="Faults-3073"><a href="#-3073"><span class="linenos">3073</span></a>            <span class="n">range_1</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
</span><span id="Faults-3074"><a href="#-3074"><span class="linenos">3074</span></a>                <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">x0_min</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">a_ini</span><span class="p">)),</span> <span class="nb">int</span><span class="p">(</span><span class="n">x0_max</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">a_ini</span><span class="p">)))</span>
</span><span id="Faults-3075"><a href="#-3075"><span class="linenos">3075</span></a>            <span class="p">)</span>
</span><span id="Faults-3076"><a href="#-3076"><span class="linenos">3076</span></a>            <span class="n">range_2</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
</span><span id="Faults-3077"><a href="#-3077"><span class="linenos">3077</span></a>                <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">x0_min</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">a_ini</span><span class="p">)),</span> <span class="nb">int</span><span class="p">(</span><span class="n">x0_max</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">a_ini</span><span class="p">)))</span>
</span><span id="Faults-3078"><a href="#-3078"><span class="linenos">3078</span></a>            <span class="p">)</span>
</span><span id="Faults-3079"><a href="#-3079"><span class="linenos">3079</span></a>            <span class="n">x0_ini</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">range_1</span> <span class="o">+</span> <span class="n">range_2</span><span class="p">))</span>
</span><span id="Faults-3080"><a href="#-3080"><span class="linenos">3080</span></a>            <span class="n">y0_ini</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
</span><span id="Faults-3081"><a href="#-3081"><span class="linenos">3081</span></a>        <span class="n">z0_ini</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
</span><span id="Faults-3082"><a href="#-3082"><span class="linenos">3082</span></a>            <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span>
</span><span id="Faults-3083"><a href="#-3083"><span class="linenos">3083</span></a>                <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="mf">2.0</span><span class="p">,</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="mf">6.0</span>
</span><span id="Faults-3084"><a href="#-3084"><span class="linenos">3084</span></a>            <span class="p">)</span>
</span><span id="Faults-3085"><a href="#-3085"><span class="linenos">3085</span></a>        <span class="p">)</span>
</span><span id="Faults-3086"><a href="#-3086"><span class="linenos">3086</span></a>        <span class="n">c_ini</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
</span><span id="Faults-3087"><a href="#-3087"><span class="linenos">3087</span></a>            <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span>
</span><span id="Faults-3088"><a href="#-3088"><span class="linenos">3088</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">infill_factor</span> <span class="o">*</span> <span class="mf">4.0</span> <span class="o">-</span> <span class="n">z0_ini</span><span class="p">,</span>
</span><span id="Faults-3089"><a href="#-3089"><span class="linenos">3089</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">infill_factor</span> <span class="o">*</span> <span class="mf">4.0</span>
</span><span id="Faults-3090"><a href="#-3090"><span class="linenos">3090</span></a>                <span class="o">-</span> <span class="n">z0_ini</span>
</span><span id="Faults-3091"><a href="#-3091"><span class="linenos">3091</span></a>                <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">infill_factor</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">,</span>
</span><span id="Faults-3092"><a href="#-3092"><span class="linenos">3092</span></a>            <span class="p">)</span>
</span><span id="Faults-3093"><a href="#-3093"><span class="linenos">3093</span></a>            <span class="o">**</span> <span class="mi">2</span>
</span><span id="Faults-3094"><a href="#-3094"><span class="linenos">3094</span></a>        <span class="p">)</span>
</span><span id="Faults-3095"><a href="#-3095"><span class="linenos">3095</span></a>        <span class="n">tilt_pct_ini</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">))</span>
</span><span id="Faults-3096"><a href="#-3096"><span class="linenos">3096</span></a>        <span class="n">throw_lut</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span>
</span><span id="Faults-3097"><a href="#-3097"><span class="linenos">3097</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">low_fault_throw</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">high_fault_throw</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">number_faults</span>
</span><span id="Faults-3098"><a href="#-3098"><span class="linenos">3098</span></a>        <span class="p">)</span>
</span><span id="Faults-3099"><a href="#-3099"><span class="linenos">3099</span></a>        <span class="c1"># Initialize return parameters</span>
</span><span id="Faults-3100"><a href="#-3100"><span class="linenos">3100</span></a>        <span class="n">a</span> <span class="o">=</span> <span class="n">a_ini</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Faults-3101"><a href="#-3101"><span class="linenos">3101</span></a>        <span class="n">b</span> <span class="o">=</span> <span class="n">b_ini</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Faults-3102"><a href="#-3102"><span class="linenos">3102</span></a>        <span class="n">c</span> <span class="o">=</span> <span class="n">c_ini</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Faults-3103"><a href="#-3103"><span class="linenos">3103</span></a>        <span class="n">x0</span> <span class="o">=</span> <span class="n">x0_ini</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Faults-3104"><a href="#-3104"><span class="linenos">3104</span></a>        <span class="n">y0</span> <span class="o">=</span> <span class="n">y0_ini</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Faults-3105"><a href="#-3105"><span class="linenos">3105</span></a>        <span class="n">z0</span> <span class="o">=</span> <span class="n">z0_ini</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Faults-3106"><a href="#-3106"><span class="linenos">3106</span></a>
</span><span id="Faults-3107"><a href="#-3107"><span class="linenos">3107</span></a>        <span class="n">tilt_pct</span> <span class="o">=</span> <span class="n">tilt_pct_ini</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Faults-3108"><a href="#-3108"><span class="linenos">3108</span></a>        <span class="n">direction</span> <span class="o">=</span> <span class="s2">&quot;odd&quot;</span>
</span><span id="Faults-3109"><a href="#-3109"><span class="linenos">3109</span></a>        <span class="n">mod</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;new&quot;</span><span class="p">]</span>
</span><span id="Faults-3110"><a href="#-3110"><span class="linenos">3110</span></a>
</span><span id="Faults-3111"><a href="#-3111"><span class="linenos">3111</span></a>        <span class="n">x0_even</span> <span class="o">=</span> <span class="n">x0_ini</span>
</span><span id="Faults-3112"><a href="#-3112"><span class="linenos">3112</span></a>        <span class="n">y0_even</span> <span class="o">=</span> <span class="n">y0_ini</span>
</span><span id="Faults-3113"><a href="#-3113"><span class="linenos">3113</span></a>        <span class="k">if</span> <span class="n">side</span> <span class="o">==</span> <span class="s2">&quot;x&quot;</span><span class="p">:</span>
</span><span id="Faults-3114"><a href="#-3114"><span class="linenos">3114</span></a>            <span class="c1"># X only moves marginally</span>
</span><span id="Faults-3115"><a href="#-3115"><span class="linenos">3115</span></a>            <span class="n">y0_odd</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="n">y0_even</span>
</span><span id="Faults-3116"><a href="#-3116"><span class="linenos">3116</span></a>            <span class="n">x0_odd</span> <span class="o">=</span> <span class="n">x0_even</span>
</span><span id="Faults-3117"><a href="#-3117"><span class="linenos">3117</span></a>            <span class="n">direction_sign</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">y0_ini</span><span class="p">)</span>
</span><span id="Faults-3118"><a href="#-3118"><span class="linenos">3118</span></a>            <span class="n">direction_sidex</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Faults-3119"><a href="#-3119"><span class="linenos">3119</span></a>            <span class="n">direction_sidey</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="Faults-3120"><a href="#-3120"><span class="linenos">3120</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Faults-3121"><a href="#-3121"><span class="linenos">3121</span></a>            <span class="c1"># Y only moves marginally</span>
</span><span id="Faults-3122"><a href="#-3122"><span class="linenos">3122</span></a>            <span class="n">x0_odd</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">-</span> <span class="n">x0_even</span>
</span><span id="Faults-3123"><a href="#-3123"><span class="linenos">3123</span></a>            <span class="n">y0_odd</span> <span class="o">=</span> <span class="n">y0_even</span>
</span><span id="Faults-3124"><a href="#-3124"><span class="linenos">3124</span></a>            <span class="n">direction_sign</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">x0_ini</span><span class="p">)</span>
</span><span id="Faults-3125"><a href="#-3125"><span class="linenos">3125</span></a>            <span class="n">direction_sidex</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="Faults-3126"><a href="#-3126"><span class="linenos">3126</span></a>            <span class="n">direction_sidey</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Faults-3127"><a href="#-3127"><span class="linenos">3127</span></a>
</span><span id="Faults-3128"><a href="#-3128"><span class="linenos">3128</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">number_faults</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="Faults-3129"><a href="#-3129"><span class="linenos">3129</span></a>            <span class="k">if</span> <span class="n">direction</span> <span class="o">==</span> <span class="s2">&quot;odd&quot;</span><span class="p">:</span>
</span><span id="Faults-3130"><a href="#-3130"><span class="linenos">3130</span></a>                <span class="c1"># Put the next point as a mirror shifted by maximal shift and go backward</span>
</span><span id="Faults-3131"><a href="#-3131"><span class="linenos">3131</span></a>                <span class="n">a_ramp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">)</span> <span class="o">*</span> <span class="n">a_ini</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Faults-3132"><a href="#-3132"><span class="linenos">3132</span></a>                <span class="n">b_ramp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">)</span> <span class="o">*</span> <span class="n">b_ini</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Faults-3133"><a href="#-3133"><span class="linenos">3133</span></a>                <span class="n">c_ramp</span> <span class="o">=</span> <span class="n">c_ini</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Faults-3134"><a href="#-3134"><span class="linenos">3134</span></a>                <span class="n">x0_ramp</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="Faults-3135"><a href="#-3135"><span class="linenos">3135</span></a>                    <span class="o">-</span><span class="mi">1</span>
</span><span id="Faults-3136"><a href="#-3136"><span class="linenos">3136</span></a>                    <span class="o">*</span> <span class="n">direction_sign</span>
</span><span id="Faults-3137"><a href="#-3137"><span class="linenos">3137</span></a>                    <span class="o">*</span> <span class="n">direction_sidex</span>
</span><span id="Faults-3138"><a href="#-3138"><span class="linenos">3138</span></a>                    <span class="o">*</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="Faults-3139"><a href="#-3139"><span class="linenos">3139</span></a>                    <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="Faults-3140"><a href="#-3140"><span class="linenos">3140</span></a>                    <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">number_faults</span>
</span><span id="Faults-3141"><a href="#-3141"><span class="linenos">3141</span></a>                <span class="p">)</span> <span class="o">+</span> <span class="n">x0_odd</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">)</span>
</span><span id="Faults-3142"><a href="#-3142"><span class="linenos">3142</span></a>                <span class="n">y0_ramp</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="Faults-3143"><a href="#-3143"><span class="linenos">3143</span></a>                    <span class="o">-</span><span class="mi">1</span>
</span><span id="Faults-3144"><a href="#-3144"><span class="linenos">3144</span></a>                    <span class="o">*</span> <span class="n">direction_sign</span>
</span><span id="Faults-3145"><a href="#-3145"><span class="linenos">3145</span></a>                    <span class="o">*</span> <span class="n">direction_sidey</span>
</span><span id="Faults-3146"><a href="#-3146"><span class="linenos">3146</span></a>                    <span class="o">*</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="Faults-3147"><a href="#-3147"><span class="linenos">3147</span></a>                    <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="Faults-3148"><a href="#-3148"><span class="linenos">3148</span></a>                    <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">number_faults</span>
</span><span id="Faults-3149"><a href="#-3149"><span class="linenos">3149</span></a>                <span class="p">)</span> <span class="o">+</span> <span class="n">y0_odd</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">)</span>
</span><span id="Faults-3150"><a href="#-3150"><span class="linenos">3150</span></a>                <span class="n">z0_ramp</span> <span class="o">=</span> <span class="n">z0_ini</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Faults-3151"><a href="#-3151"><span class="linenos">3151</span></a>                <span class="n">tilt_pct_ramp</span> <span class="o">=</span> <span class="n">tilt_pct_ini</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.85</span><span class="p">,</span> <span class="mf">1.15</span><span class="p">)</span>
</span><span id="Faults-3152"><a href="#-3152"><span class="linenos">3152</span></a>                <span class="n">x0_prec</span> <span class="o">=</span> <span class="n">x0_ramp</span>
</span><span id="Faults-3153"><a href="#-3153"><span class="linenos">3153</span></a>                <span class="n">y0_prec</span> <span class="o">=</span> <span class="n">y0_ramp</span>
</span><span id="Faults-3154"><a href="#-3154"><span class="linenos">3154</span></a>                <span class="c1"># Add to existing</span>
</span><span id="Faults-3155"><a href="#-3155"><span class="linenos">3155</span></a>                <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">a_ramp</span><span class="p">)</span>
</span><span id="Faults-3156"><a href="#-3156"><span class="linenos">3156</span></a>                <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">b_ramp</span><span class="p">)</span>
</span><span id="Faults-3157"><a href="#-3157"><span class="linenos">3157</span></a>                <span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">c_ramp</span><span class="p">)</span>
</span><span id="Faults-3158"><a href="#-3158"><span class="linenos">3158</span></a>                <span class="n">x0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">x0_ramp</span><span class="p">)</span>
</span><span id="Faults-3159"><a href="#-3159"><span class="linenos">3159</span></a>                <span class="n">y0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y0</span><span class="p">,</span> <span class="n">y0_ramp</span><span class="p">)</span>
</span><span id="Faults-3160"><a href="#-3160"><span class="linenos">3160</span></a>                <span class="n">z0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">z0</span><span class="p">,</span> <span class="n">z0_ramp</span><span class="p">)</span>
</span><span id="Faults-3161"><a href="#-3161"><span class="linenos">3161</span></a>                <span class="n">tilt_pct</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tilt_pct</span><span class="p">,</span> <span class="n">tilt_pct_ramp</span><span class="p">)</span>
</span><span id="Faults-3162"><a href="#-3162"><span class="linenos">3162</span></a>                <span class="n">direction</span> <span class="o">=</span> <span class="s2">&quot;even&quot;</span>
</span><span id="Faults-3163"><a href="#-3163"><span class="linenos">3163</span></a>                <span class="n">mod</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;old&quot;</span><span class="p">)</span>
</span><span id="Faults-3164"><a href="#-3164"><span class="linenos">3164</span></a>            <span class="k">elif</span> <span class="n">direction</span> <span class="o">==</span> <span class="s2">&quot;even&quot;</span><span class="p">:</span>
</span><span id="Faults-3165"><a href="#-3165"><span class="linenos">3165</span></a>                <span class="c1"># Put next to ini</span>
</span><span id="Faults-3166"><a href="#-3166"><span class="linenos">3166</span></a>                <span class="n">a_ramp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">)</span> <span class="o">*</span> <span class="n">a_ini</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Faults-3167"><a href="#-3167"><span class="linenos">3167</span></a>                <span class="n">b_ramp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">)</span> <span class="o">*</span> <span class="n">b_ini</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Faults-3168"><a href="#-3168"><span class="linenos">3168</span></a>                <span class="n">c_ramp</span> <span class="o">=</span> <span class="n">c_ini</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Faults-3169"><a href="#-3169"><span class="linenos">3169</span></a>                <span class="n">x0_ramp</span> <span class="o">=</span> <span class="n">direction_sign</span> <span class="o">*</span> <span class="n">direction_sidex</span> <span class="o">*</span> <span class="nb">int</span><span class="p">(</span>
</span><span id="Faults-3170"><a href="#-3170"><span class="linenos">3170</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Faults-3171"><a href="#-3171"><span class="linenos">3171</span></a>                <span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">number_faults</span> <span class="o">+</span> <span class="n">x0_even</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span>
</span><span id="Faults-3172"><a href="#-3172"><span class="linenos">3172</span></a>                    <span class="mf">0.8</span><span class="p">,</span> <span class="mf">1.2</span>
</span><span id="Faults-3173"><a href="#-3173"><span class="linenos">3173</span></a>                <span class="p">)</span>
</span><span id="Faults-3174"><a href="#-3174"><span class="linenos">3174</span></a>                <span class="n">y0_ramp</span> <span class="o">=</span> <span class="n">direction_sign</span> <span class="o">*</span> <span class="n">direction_sidey</span> <span class="o">*</span> <span class="nb">int</span><span class="p">(</span>
</span><span id="Faults-3175"><a href="#-3175"><span class="linenos">3175</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Faults-3176"><a href="#-3176"><span class="linenos">3176</span></a>                <span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">number_faults</span> <span class="o">+</span> <span class="n">y0_even</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span>
</span><span id="Faults-3177"><a href="#-3177"><span class="linenos">3177</span></a>                    <span class="mf">0.8</span><span class="p">,</span> <span class="mf">1.2</span>
</span><span id="Faults-3178"><a href="#-3178"><span class="linenos">3178</span></a>                <span class="p">)</span>
</span><span id="Faults-3179"><a href="#-3179"><span class="linenos">3179</span></a>                <span class="n">z0_ramp</span> <span class="o">=</span> <span class="n">z0_ini</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Faults-3180"><a href="#-3180"><span class="linenos">3180</span></a>                <span class="n">tilt_pct_ramp</span> <span class="o">=</span> <span class="n">tilt_pct_ini</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.85</span><span class="p">,</span> <span class="mf">1.15</span><span class="p">)</span>
</span><span id="Faults-3181"><a href="#-3181"><span class="linenos">3181</span></a>                <span class="c1"># Add to existing</span>
</span><span id="Faults-3182"><a href="#-3182"><span class="linenos">3182</span></a>                <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">a_ramp</span><span class="p">)</span>
</span><span id="Faults-3183"><a href="#-3183"><span class="linenos">3183</span></a>                <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">b_ramp</span><span class="p">)</span>
</span><span id="Faults-3184"><a href="#-3184"><span class="linenos">3184</span></a>                <span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">c_ramp</span><span class="p">)</span>
</span><span id="Faults-3185"><a href="#-3185"><span class="linenos">3185</span></a>                <span class="n">x0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">x0_ramp</span><span class="p">)</span>
</span><span id="Faults-3186"><a href="#-3186"><span class="linenos">3186</span></a>                <span class="n">y0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y0</span><span class="p">,</span> <span class="n">y0_ramp</span><span class="p">)</span>
</span><span id="Faults-3187"><a href="#-3187"><span class="linenos">3187</span></a>                <span class="n">z0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">z0</span><span class="p">,</span> <span class="n">z0_ramp</span><span class="p">)</span>
</span><span id="Faults-3188"><a href="#-3188"><span class="linenos">3188</span></a>                <span class="n">tilt_pct</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tilt_pct</span><span class="p">,</span> <span class="n">tilt_pct_ramp</span><span class="p">)</span>
</span><span id="Faults-3189"><a href="#-3189"><span class="linenos">3189</span></a>                <span class="n">direction</span> <span class="o">=</span> <span class="s2">&quot;odd&quot;</span>
</span><span id="Faults-3190"><a href="#-3190"><span class="linenos">3190</span></a>                <span class="n">mod</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;new&quot;</span><span class="p">)</span>
</span><span id="Faults-3191"><a href="#-3191"><span class="linenos">3191</span></a>
</span><span id="Faults-3192"><a href="#-3192"><span class="linenos">3192</span></a>        <span class="n">fault_param_dict</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="Faults-3193"><a href="#-3193"><span class="linenos">3193</span></a>            <span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="n">a</span><span class="p">,</span>
</span><span id="Faults-3194"><a href="#-3194"><span class="linenos">3194</span></a>            <span class="s2">&quot;b&quot;</span><span class="p">:</span> <span class="n">b</span><span class="p">,</span>
</span><span id="Faults-3195"><a href="#-3195"><span class="linenos">3195</span></a>            <span class="s2">&quot;c&quot;</span><span class="p">:</span> <span class="n">c</span><span class="p">,</span>
</span><span id="Faults-3196"><a href="#-3196"><span class="linenos">3196</span></a>            <span class="s2">&quot;x0&quot;</span><span class="p">:</span> <span class="n">x0</span><span class="p">,</span>
</span><span id="Faults-3197"><a href="#-3197"><span class="linenos">3197</span></a>            <span class="s2">&quot;y0&quot;</span><span class="p">:</span> <span class="n">y0</span><span class="p">,</span>
</span><span id="Faults-3198"><a href="#-3198"><span class="linenos">3198</span></a>            <span class="s2">&quot;z0&quot;</span><span class="p">:</span> <span class="n">z0</span><span class="p">,</span>
</span><span id="Faults-3199"><a href="#-3199"><span class="linenos">3199</span></a>            <span class="s2">&quot;tilt_pct&quot;</span><span class="p">:</span> <span class="n">tilt_pct</span><span class="p">,</span>
</span><span id="Faults-3200"><a href="#-3200"><span class="linenos">3200</span></a>            <span class="s2">&quot;throw&quot;</span><span class="p">:</span> <span class="n">throw_lut</span><span class="p">,</span>
</span><span id="Faults-3201"><a href="#-3201"><span class="linenos">3201</span></a>        <span class="p">}</span>
</span><span id="Faults-3202"><a href="#-3202"><span class="linenos">3202</span></a>        <span class="k">return</span> <span class="n">fault_param_dict</span>
</span></pre></div>


            <div class="docstring"><h6 id="faults-class">Faults Class</h6>

<p>Describes the class for faulting the model.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>Horizons</strong> (<a href="Horizons.html">datagenerator.Horizons</a>):
The Horizons class used to build the faults.</li>
<li><strong>Geomodel</strong> (data_generator.Geomodels):
The Geomodel class used to build the faults.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>None</strong></li>
</ul>
</div>


                            <div id="Faults.__init__" class="classattr">
                                        <input id="Faults.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">Faults</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">parameters</span><span class="p">:</span> <span class="n"><a href="Parameters.html#Parameters">datagenerator.Parameters.Parameters</a></span>,</span><span class="param">	<span class="n">unfaulted_depth_maps</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span>,</span><span class="param">	<span class="n">onlap_horizon_list</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span>,</span><span class="param">	<span class="n">geomodels</span><span class="p">:</span> <span class="n"><a href="Geomodels.html#Geomodel">datagenerator.Geomodels.Geomodel</a></span>,</span><span class="param">	<span class="n">fan_horizon_list</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span>,</span><span class="param">	<span class="n">fan_thickness</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span></span>)</span>

                <label class="view-source-button" for="Faults.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Faults.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Faults.__init__-30"><a href="#-30"><span class="linenos"> 30</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="Faults.__init__-31"><a href="#-31"><span class="linenos"> 31</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Faults.__init__-32"><a href="#-32"><span class="linenos"> 32</span></a>        <span class="n">parameters</span><span class="p">:</span> <span class="n">Parameters</span><span class="p">,</span>
</span><span id="Faults.__init__-33"><a href="#-33"><span class="linenos"> 33</span></a>        <span class="n">unfaulted_depth_maps</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
</span><span id="Faults.__init__-34"><a href="#-34"><span class="linenos"> 34</span></a>        <span class="n">onlap_horizon_list</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
</span><span id="Faults.__init__-35"><a href="#-35"><span class="linenos"> 35</span></a>        <span class="n">geomodels</span><span class="p">:</span> <span class="n">Geomodel</span><span class="p">,</span>
</span><span id="Faults.__init__-36"><a href="#-36"><span class="linenos"> 36</span></a>        <span class="n">fan_horizon_list</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
</span><span id="Faults.__init__-37"><a href="#-37"><span class="linenos"> 37</span></a>        <span class="n">fan_thickness</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
</span><span id="Faults.__init__-38"><a href="#-38"><span class="linenos"> 38</span></a>    <span class="p">):</span>
</span><span id="Faults.__init__-39"><a href="#-39"><span class="linenos"> 39</span></a>        <span class="sd">&quot;&quot;&quot;__init__</span>
</span><span id="Faults.__init__-40"><a href="#-40"><span class="linenos"> 40</span></a>
</span><span id="Faults.__init__-41"><a href="#-41"><span class="linenos"> 41</span></a><span class="sd">        Initializes the Faults class..</span>
</span><span id="Faults.__init__-42"><a href="#-42"><span class="linenos"> 42</span></a>
</span><span id="Faults.__init__-43"><a href="#-43"><span class="linenos"> 43</span></a><span class="sd">        Parameters</span>
</span><span id="Faults.__init__-44"><a href="#-44"><span class="linenos"> 44</span></a><span class="sd">        ----------</span>
</span><span id="Faults.__init__-45"><a href="#-45"><span class="linenos"> 45</span></a><span class="sd">        parameters : Parameters</span>
</span><span id="Faults.__init__-46"><a href="#-46"><span class="linenos"> 46</span></a><span class="sd">            The parameters class.</span>
</span><span id="Faults.__init__-47"><a href="#-47"><span class="linenos"> 47</span></a><span class="sd">        unfaulted_depth_maps : np.ndarray</span>
</span><span id="Faults.__init__-48"><a href="#-48"><span class="linenos"> 48</span></a><span class="sd">            The depth maps to be faulted.</span>
</span><span id="Faults.__init__-49"><a href="#-49"><span class="linenos"> 49</span></a><span class="sd">        onlap_horizon_list : np.ndarray</span>
</span><span id="Faults.__init__-50"><a href="#-50"><span class="linenos"> 50</span></a><span class="sd">            The onlap horizon list.</span>
</span><span id="Faults.__init__-51"><a href="#-51"><span class="linenos"> 51</span></a><span class="sd">        geomodels : Geomodel</span>
</span><span id="Faults.__init__-52"><a href="#-52"><span class="linenos"> 52</span></a><span class="sd">            The geomodels class.</span>
</span><span id="Faults.__init__-53"><a href="#-53"><span class="linenos"> 53</span></a><span class="sd">        fan_horizon_list : np.ndarray</span>
</span><span id="Faults.__init__-54"><a href="#-54"><span class="linenos"> 54</span></a><span class="sd">            The fan horizon list.</span>
</span><span id="Faults.__init__-55"><a href="#-55"><span class="linenos"> 55</span></a><span class="sd">        fan_thickness : np.ndarray</span>
</span><span id="Faults.__init__-56"><a href="#-56"><span class="linenos"> 56</span></a><span class="sd">            The fan thickness list.</span>
</span><span id="Faults.__init__-57"><a href="#-57"><span class="linenos"> 57</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Faults.__init__-58"><a href="#-58"><span class="linenos"> 58</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span> <span class="o">=</span> <span class="n">parameters</span>
</span><span id="Faults.__init__-59"><a href="#-59"><span class="linenos"> 59</span></a>        <span class="c1"># Horizons</span>
</span><span id="Faults.__init__-60"><a href="#-60"><span class="linenos"> 60</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">unfaulted_depth_maps</span> <span class="o">=</span> <span class="n">unfaulted_depth_maps</span>
</span><span id="Faults.__init__-61"><a href="#-61"><span class="linenos"> 61</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">onlap_horizon_list</span> <span class="o">=</span> <span class="n">onlap_horizon_list</span>
</span><span id="Faults.__init__-62"><a href="#-62"><span class="linenos"> 62</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fan_horizon_list</span> <span class="o">=</span> <span class="n">fan_horizon_list</span>
</span><span id="Faults.__init__-63"><a href="#-63"><span class="linenos"> 63</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fan_thickness</span> <span class="o">=</span> <span class="n">fan_thickness</span>
</span><span id="Faults.__init__-64"><a href="#-64"><span class="linenos"> 64</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">faulted_depth_maps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="Faults.__init__-65"><a href="#-65"><span class="linenos"> 65</span></a>            <span class="s2">&quot;faulted_depth_maps&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">unfaulted_depth_maps</span><span class="o">.</span><span class="n">shape</span>
</span><span id="Faults.__init__-66"><a href="#-66"><span class="linenos"> 66</span></a>        <span class="p">)</span>
</span><span id="Faults.__init__-67"><a href="#-67"><span class="linenos"> 67</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">faulted_depth_maps_gaps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="Faults.__init__-68"><a href="#-68"><span class="linenos"> 68</span></a>            <span class="s2">&quot;faulted_depth_maps_gaps&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">unfaulted_depth_maps</span><span class="o">.</span><span class="n">shape</span>
</span><span id="Faults.__init__-69"><a href="#-69"><span class="linenos"> 69</span></a>        <span class="p">)</span>
</span><span id="Faults.__init__-70"><a href="#-70"><span class="linenos"> 70</span></a>        <span class="c1"># Volumes</span>
</span><span id="Faults.__init__-71"><a href="#-71"><span class="linenos"> 71</span></a>        <span class="n">cube_shape</span> <span class="o">=</span> <span class="n">geomodels</span><span class="o">.</span><span class="n">geologic_age</span><span class="p">[:]</span><span class="o">.</span><span class="n">shape</span>
</span><span id="Faults.__init__-72"><a href="#-72"><span class="linenos"> 72</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vols</span> <span class="o">=</span> <span class="n">geomodels</span>
</span><span id="Faults.__init__-73"><a href="#-73"><span class="linenos"> 73</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">faulted_age_volume</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="Faults.__init__-74"><a href="#-74"><span class="linenos"> 74</span></a>            <span class="s2">&quot;faulted_age_volume&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">cube_shape</span>
</span><span id="Faults.__init__-75"><a href="#-75"><span class="linenos"> 75</span></a>        <span class="p">)</span>
</span><span id="Faults.__init__-76"><a href="#-76"><span class="linenos"> 76</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">faulted_net_to_gross</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="Faults.__init__-77"><a href="#-77"><span class="linenos"> 77</span></a>            <span class="s2">&quot;faulted_net_to_gross&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">cube_shape</span>
</span><span id="Faults.__init__-78"><a href="#-78"><span class="linenos"> 78</span></a>        <span class="p">)</span>
</span><span id="Faults.__init__-79"><a href="#-79"><span class="linenos"> 79</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">faulted_lithology</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="Faults.__init__-80"><a href="#-80"><span class="linenos"> 80</span></a>            <span class="s2">&quot;faulted_lithology&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">cube_shape</span>
</span><span id="Faults.__init__-81"><a href="#-81"><span class="linenos"> 81</span></a>        <span class="p">)</span>
</span><span id="Faults.__init__-82"><a href="#-82"><span class="linenos"> 82</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">reservoir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span><span class="s2">&quot;reservoir&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">cube_shape</span><span class="p">)</span>
</span><span id="Faults.__init__-83"><a href="#-83"><span class="linenos"> 83</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">faulted_depth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span><span class="s2">&quot;faulted_depth&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">cube_shape</span><span class="p">)</span>
</span><span id="Faults.__init__-84"><a href="#-84"><span class="linenos"> 84</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">faulted_onlap_segments</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="Faults.__init__-85"><a href="#-85"><span class="linenos"> 85</span></a>            <span class="s2">&quot;faulted_onlap_segments&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">cube_shape</span>
</span><span id="Faults.__init__-86"><a href="#-86"><span class="linenos"> 86</span></a>        <span class="p">)</span>
</span><span id="Faults.__init__-87"><a href="#-87"><span class="linenos"> 87</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fault_planes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span><span class="s2">&quot;fault_planes&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">cube_shape</span><span class="p">)</span>
</span><span id="Faults.__init__-88"><a href="#-88"><span class="linenos"> 88</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">displacement_vectors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="Faults.__init__-89"><a href="#-89"><span class="linenos"> 89</span></a>            <span class="s2">&quot;displacement_vectors&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">cube_shape</span>
</span><span id="Faults.__init__-90"><a href="#-90"><span class="linenos"> 90</span></a>        <span class="p">)</span>
</span><span id="Faults.__init__-91"><a href="#-91"><span class="linenos"> 91</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sum_map_displacements</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="Faults.__init__-92"><a href="#-92"><span class="linenos"> 92</span></a>            <span class="s2">&quot;sum_map_displacements&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">cube_shape</span>
</span><span id="Faults.__init__-93"><a href="#-93"><span class="linenos"> 93</span></a>        <span class="p">)</span>
</span><span id="Faults.__init__-94"><a href="#-94"><span class="linenos"> 94</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fault_intersections</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="Faults.__init__-95"><a href="#-95"><span class="linenos"> 95</span></a>            <span class="s2">&quot;fault_intersections&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">cube_shape</span>
</span><span id="Faults.__init__-96"><a href="#-96"><span class="linenos"> 96</span></a>        <span class="p">)</span>
</span><span id="Faults.__init__-97"><a href="#-97"><span class="linenos"> 97</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fault_plane_throw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="Faults.__init__-98"><a href="#-98"><span class="linenos"> 98</span></a>            <span class="s2">&quot;fault_plane_throw&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">cube_shape</span>
</span><span id="Faults.__init__-99"><a href="#-99"><span class="linenos"> 99</span></a>        <span class="p">)</span>
</span><span id="Faults.__init__-100"><a href="#-100"><span class="linenos">100</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">max_fault_throw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span><span class="s2">&quot;max_fault_throw&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">cube_shape</span><span class="p">)</span>
</span><span id="Faults.__init__-101"><a href="#-101"><span class="linenos">101</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fault_plane_azimuth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="Faults.__init__-102"><a href="#-102"><span class="linenos">102</span></a>            <span class="s2">&quot;fault_plane_azimuth&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">cube_shape</span>
</span><span id="Faults.__init__-103"><a href="#-103"><span class="linenos">103</span></a>        <span class="p">)</span>
</span><span id="Faults.__init__-104"><a href="#-104"><span class="linenos">104</span></a>        <span class="c1"># Salt</span>
</span><span id="Faults.__init__-105"><a href="#-105"><span class="linenos">105</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">salt_model</span> <span class="o">=</span> <span class="kc">None</span>
</span></pre></div>


            <div class="docstring"><p>__init__</p>

<p>Initializes the Faults class..</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>parameters</strong> (Parameters):
The parameters class.</li>
<li><strong>unfaulted_depth_maps</strong> (np.ndarray):
The depth maps to be faulted.</li>
<li><strong>onlap_horizon_list</strong> (np.ndarray):
The onlap horizon list.</li>
<li><strong>geomodels</strong> (Geomodel):
The geomodels class.</li>
<li><strong>fan_horizon_list</strong> (np.ndarray):
The fan horizon list.</li>
<li><strong>fan_thickness</strong> (np.ndarray):
The fan thickness list.</li>
</ul>
</div>


                            </div>
                            <div id="Faults.apply_faulting_to_geomodels_and_depth_maps" class="classattr">
                                        <input id="Faults.apply_faulting_to_geomodels_and_depth_maps-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">apply_faulting_to_geomodels_and_depth_maps</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="Faults.apply_faulting_to_geomodels_and_depth_maps-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Faults.apply_faulting_to_geomodels_and_depth_maps"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-107"><a href="#-107"><span class="linenos">107</span></a>    <span class="k">def</span> <span class="nf">apply_faulting_to_geomodels_and_depth_maps</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-108"><a href="#-108"><span class="linenos">108</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-109"><a href="#-109"><span class="linenos">109</span></a><span class="sd">        Apply faulting to horizons and cubes</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-110"><a href="#-110"><span class="linenos">110</span></a><span class="sd">        ------------------------------------</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-111"><a href="#-111"><span class="linenos">111</span></a><span class="sd">        Generates random faults and applies faulting to horizons and cubes.</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-112"><a href="#-112"><span class="linenos">112</span></a>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-113"><a href="#-113"><span class="linenos">113</span></a><span class="sd">        The method does the following:</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-114"><a href="#-114"><span class="linenos">114</span></a>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-115"><a href="#-115"><span class="linenos">115</span></a><span class="sd">        * Generate faults and sum the displacements</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-116"><a href="#-116"><span class="linenos">116</span></a><span class="sd">        * Apply faulting to horizons</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-117"><a href="#-117"><span class="linenos">117</span></a><span class="sd">        * Write faulted depth maps to disk</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-118"><a href="#-118"><span class="linenos">118</span></a><span class="sd">        * Write faulted depth maps with gaps at faults to disk</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-119"><a href="#-119"><span class="linenos">119</span></a><span class="sd">        * Write onlapping horizons to disk</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-120"><a href="#-120"><span class="linenos">120</span></a><span class="sd">        * Apply faulting to geomodels</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-121"><a href="#-121"><span class="linenos">121</span></a><span class="sd">        * Make segmentation results conform to binary values after</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-122"><a href="#-122"><span class="linenos">122</span></a><span class="sd">          faulting and interpolation.</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-123"><a href="#-123"><span class="linenos">123</span></a><span class="sd">        * Write cubes to file (if qc_volumes turned on in config.json)</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-124"><a href="#-124"><span class="linenos">124</span></a>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-125"><a href="#-125"><span class="linenos">125</span></a><span class="sd">        (If segmentation is not reset to binary, the multiple </span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-126"><a href="#-126"><span class="linenos">126</span></a><span class="sd">        interpolations for successive faults destroys the crisp</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-127"><a href="#-127"><span class="linenos">127</span></a><span class="sd">        localization of the labels. Subjective observation suggests</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-128"><a href="#-128"><span class="linenos">128</span></a><span class="sd">        that slightly different thresholds for different </span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-129"><a href="#-129"><span class="linenos">129</span></a><span class="sd">        features provide superior results)</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-130"><a href="#-130"><span class="linenos">130</span></a>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-131"><a href="#-131"><span class="linenos">131</span></a><span class="sd">        Parameters</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-132"><a href="#-132"><span class="linenos">132</span></a><span class="sd">        ----------</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-133"><a href="#-133"><span class="linenos">133</span></a><span class="sd">        None</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-134"><a href="#-134"><span class="linenos">134</span></a>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-135"><a href="#-135"><span class="linenos">135</span></a><span class="sd">        Returns</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-136"><a href="#-136"><span class="linenos">136</span></a><span class="sd">        -------</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-137"><a href="#-137"><span class="linenos">137</span></a><span class="sd">        None</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-138"><a href="#-138"><span class="linenos">138</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-139"><a href="#-139"><span class="linenos">139</span></a>        <span class="c1"># Make a dictionary of zero-thickness onlapping layers before faulting</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-140"><a href="#-140"><span class="linenos">140</span></a>        <span class="n">onlap_clip_dict</span> <span class="o">=</span> <span class="n">find_zero_thickness_onlapping_layers</span><span class="p">(</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-141"><a href="#-141"><span class="linenos">141</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">unfaulted_depth_maps</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">onlap_horizon_list</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-142"><a href="#-142"><span class="linenos">142</span></a>        <span class="p">)</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-143"><a href="#-143"><span class="linenos">143</span></a>        <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_faults</span><span class="p">()</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-144"><a href="#-144"><span class="linenos">144</span></a>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-145"><a href="#-145"><span class="linenos">145</span></a>        <span class="c1"># Apply faulting to age model, net_to_gross cube &amp; onlap segments</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-146"><a href="#-146"><span class="linenos">146</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">faulted_age_volume</span><span class="p">[:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_xyz_displacement</span><span class="p">(</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-147"><a href="#-147"><span class="linenos">147</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">geologic_age</span><span class="p">[:]</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-148"><a href="#-148"><span class="linenos">148</span></a>        <span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;float&quot;</span><span class="p">)</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-149"><a href="#-149"><span class="linenos">149</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">faulted_onlap_segments</span><span class="p">[:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_xyz_displacement</span><span class="p">(</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-150"><a href="#-150"><span class="linenos">150</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">onlap_segments</span><span class="p">[:]</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-151"><a href="#-151"><span class="linenos">151</span></a>        <span class="p">)</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-152"><a href="#-152"><span class="linenos">152</span></a>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-153"><a href="#-153"><span class="linenos">153</span></a>        <span class="c1"># Improve the depth maps post faulting by</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-154"><a href="#-154"><span class="linenos">154</span></a>        <span class="c1"># re-interpolating across faulted age model</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-155"><a href="#-155"><span class="linenos">155</span></a>        <span class="p">(</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-156"><a href="#-156"><span class="linenos">156</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">faulted_depth_maps</span><span class="p">[:],</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-157"><a href="#-157"><span class="linenos">157</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">faulted_depth_maps_gaps</span><span class="p">[:],</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-158"><a href="#-158"><span class="linenos">158</span></a>        <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">improve_depth_maps_post_faulting</span><span class="p">(</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-159"><a href="#-159"><span class="linenos">159</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">geologic_age</span><span class="p">[:],</span> <span class="bp">self</span><span class="o">.</span><span class="n">faulted_age_volume</span><span class="p">[:],</span> <span class="n">onlap_clip_dict</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-160"><a href="#-160"><span class="linenos">160</span></a>        <span class="p">)</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-161"><a href="#-161"><span class="linenos">161</span></a>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-162"><a href="#-162"><span class="linenos">162</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">include_salt</span><span class="p">:</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-163"><a href="#-163"><span class="linenos">163</span></a>            <span class="kn">from</span> <span class="nn">datagenerator.Salt</span> <span class="kn">import</span> <span class="n">SaltModel</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-164"><a href="#-164"><span class="linenos">164</span></a>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-165"><a href="#-165"><span class="linenos">165</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">salt_model</span> <span class="o">=</span> <span class="n">SaltModel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="p">)</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-166"><a href="#-166"><span class="linenos">166</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">salt_model</span><span class="o">.</span><span class="n">compute_salt_body_segmentation</span><span class="p">()</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-167"><a href="#-167"><span class="linenos">167</span></a>            <span class="p">(</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-168"><a href="#-168"><span class="linenos">168</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">faulted_depth_maps</span><span class="p">[:],</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-169"><a href="#-169"><span class="linenos">169</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">faulted_depth_maps_gaps</span><span class="p">[:],</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-170"><a href="#-170"><span class="linenos">170</span></a>            <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">salt_model</span><span class="o">.</span><span class="n">update_depth_maps_with_salt_segments_drag</span><span class="p">()</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-171"><a href="#-171"><span class="linenos">171</span></a>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-172"><a href="#-172"><span class="linenos">172</span></a>        <span class="c1"># # Write the faulted maps to disk</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-173"><a href="#-173"><span class="linenos">173</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">write_maps_to_disk</span><span class="p">(</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-174"><a href="#-174"><span class="linenos">174</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">faulted_depth_maps</span><span class="p">[:]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">digi</span><span class="p">,</span> <span class="s2">&quot;depth_maps&quot;</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-175"><a href="#-175"><span class="linenos">175</span></a>        <span class="p">)</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-176"><a href="#-176"><span class="linenos">176</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">write_maps_to_disk</span><span class="p">(</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-177"><a href="#-177"><span class="linenos">177</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">faulted_depth_maps_gaps</span><span class="p">[:]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">digi</span><span class="p">,</span> <span class="s2">&quot;depth_maps_gaps&quot;</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-178"><a href="#-178"><span class="linenos">178</span></a>        <span class="p">)</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-179"><a href="#-179"><span class="linenos">179</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">write_onlap_episodes</span><span class="p">(</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-180"><a href="#-180"><span class="linenos">180</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">onlap_horizon_list</span><span class="p">[:],</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-181"><a href="#-181"><span class="linenos">181</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">faulted_depth_maps_gaps</span><span class="p">[:],</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-182"><a href="#-182"><span class="linenos">182</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">faulted_depth_maps</span><span class="p">[:],</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-183"><a href="#-183"><span class="linenos">183</span></a>        <span class="p">)</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-184"><a href="#-184"><span class="linenos">184</span></a>        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fan_horizon_list</span><span class="p">):</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-185"><a href="#-185"><span class="linenos">185</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">write_fan_horizons</span><span class="p">(</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-186"><a href="#-186"><span class="linenos">186</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">fan_horizon_list</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">faulted_depth_maps</span><span class="p">[:]</span> <span class="o">*</span> <span class="mf">4.0</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-187"><a href="#-187"><span class="linenos">187</span></a>            <span class="p">)</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-188"><a href="#-188"><span class="linenos">188</span></a>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-189"><a href="#-189"><span class="linenos">189</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_store</span><span class="p">:</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-190"><a href="#-190"><span class="linenos">190</span></a>            <span class="c1"># Write faulted maps to hdf</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-191"><a href="#-191"><span class="linenos">191</span></a>            <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-192"><a href="#-192"><span class="linenos">192</span></a>                <span class="p">[</span><span class="s2">&quot;depth_maps&quot;</span><span class="p">,</span> <span class="s2">&quot;depth_maps_gaps&quot;</span><span class="p">],</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-193"><a href="#-193"><span class="linenos">193</span></a>                <span class="p">[</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-194"><a href="#-194"><span class="linenos">194</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">faulted_depth_maps</span><span class="p">[:]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">digi</span><span class="p">,</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-195"><a href="#-195"><span class="linenos">195</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">faulted_depth_maps_gaps</span><span class="p">[:]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">digi</span><span class="p">,</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-196"><a href="#-196"><span class="linenos">196</span></a>                <span class="p">],</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-197"><a href="#-197"><span class="linenos">197</span></a>            <span class="p">):</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-198"><a href="#-198"><span class="linenos">198</span></a>                <span class="n">write_data_to_hdf</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_master</span><span class="p">)</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-199"><a href="#-199"><span class="linenos">199</span></a>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-200"><a href="#-200"><span class="linenos">200</span></a>        <span class="c1"># Create faulted binary segmentation volumes</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-201"><a href="#-201"><span class="linenos">201</span></a>        <span class="n">_fault_planes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fault_planes</span><span class="p">[:]</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-202"><a href="#-202"><span class="linenos">202</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fault_planes</span><span class="p">[:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_binary_segmentations_post_faulting</span><span class="p">(</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-203"><a href="#-203"><span class="linenos">203</span></a>            <span class="n">_fault_planes</span><span class="p">,</span> <span class="mf">0.45</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-204"><a href="#-204"><span class="linenos">204</span></a>        <span class="p">)</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-205"><a href="#-205"><span class="linenos">205</span></a>        <span class="k">del</span> <span class="n">_fault_planes</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-206"><a href="#-206"><span class="linenos">206</span></a>        <span class="n">_fault_intersections</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fault_intersections</span><span class="p">[:]</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-207"><a href="#-207"><span class="linenos">207</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fault_intersections</span><span class="p">[:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_binary_segmentations_post_faulting</span><span class="p">(</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-208"><a href="#-208"><span class="linenos">208</span></a>            <span class="n">_fault_intersections</span><span class="p">,</span> <span class="mf">0.45</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-209"><a href="#-209"><span class="linenos">209</span></a>        <span class="p">)</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-210"><a href="#-210"><span class="linenos">210</span></a>        <span class="k">del</span> <span class="n">_fault_intersections</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-211"><a href="#-211"><span class="linenos">211</span></a>        <span class="n">_faulted_onlap_segments</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">faulted_onlap_segments</span><span class="p">[:]</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-212"><a href="#-212"><span class="linenos">212</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">faulted_onlap_segments</span><span class="p">[:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_binary_segmentations_post_faulting</span><span class="p">(</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-213"><a href="#-213"><span class="linenos">213</span></a>            <span class="n">_faulted_onlap_segments</span><span class="p">,</span> <span class="mf">0.45</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-214"><a href="#-214"><span class="linenos">214</span></a>        <span class="p">)</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-215"><a href="#-215"><span class="linenos">215</span></a>        <span class="k">del</span> <span class="n">_faulted_onlap_segments</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-216"><a href="#-216"><span class="linenos">216</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">include_channels</span><span class="p">:</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-217"><a href="#-217"><span class="linenos">217</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">floodplain_shale</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_xyz_displacement</span><span class="p">(</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-218"><a href="#-218"><span class="linenos">218</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">floodplain_shale</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-219"><a href="#-219"><span class="linenos">219</span></a>            <span class="p">)</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-220"><a href="#-220"><span class="linenos">220</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">channel_fill</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_xyz_displacement</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">channel_fill</span><span class="p">)</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-221"><a href="#-221"><span class="linenos">221</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">shale_channel_drape</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_xyz_displacement</span><span class="p">(</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-222"><a href="#-222"><span class="linenos">222</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">shale_channel_drape</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-223"><a href="#-223"><span class="linenos">223</span></a>            <span class="p">)</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-224"><a href="#-224"><span class="linenos">224</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">levee</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_xyz_displacement</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">levee</span><span class="p">)</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-225"><a href="#-225"><span class="linenos">225</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">crevasse</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_xyz_displacement</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">crevasse</span><span class="p">)</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-226"><a href="#-226"><span class="linenos">226</span></a>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-227"><a href="#-227"><span class="linenos">227</span></a>            <span class="p">(</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-228"><a href="#-228"><span class="linenos">228</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">channel_segments</span><span class="p">,</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-229"><a href="#-229"><span class="linenos">229</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">geologic_age</span><span class="p">,</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-230"><a href="#-230"><span class="linenos">230</span></a>            <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reassign_channel_segment_encoding</span><span class="p">(</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-231"><a href="#-231"><span class="linenos">231</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">geologic_age</span><span class="p">,</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-232"><a href="#-232"><span class="linenos">232</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">floodplain_shale</span><span class="p">,</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-233"><a href="#-233"><span class="linenos">233</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">channel_fill</span><span class="p">,</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-234"><a href="#-234"><span class="linenos">234</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">shale_channel_drape</span><span class="p">,</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-235"><a href="#-235"><span class="linenos">235</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">levee</span><span class="p">,</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-236"><a href="#-236"><span class="linenos">236</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">crevasse</span><span class="p">,</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-237"><a href="#-237"><span class="linenos">237</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">maps</span><span class="o">.</span><span class="n">channels</span><span class="p">,</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-238"><a href="#-238"><span class="linenos">238</span></a>            <span class="p">)</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-239"><a href="#-239"><span class="linenos">239</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">model_qc_volumes</span><span class="p">:</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-240"><a href="#-240"><span class="linenos">240</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">write_cube_to_disk</span><span class="p">(</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-241"><a href="#-241"><span class="linenos">241</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">channel_segments</span><span class="p">,</span> <span class="s2">&quot;channel_segments&quot;</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-242"><a href="#-242"><span class="linenos">242</span></a>                <span class="p">)</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-243"><a href="#-243"><span class="linenos">243</span></a>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-244"><a href="#-244"><span class="linenos">244</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">model_qc_volumes</span><span class="p">:</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-245"><a href="#-245"><span class="linenos">245</span></a>            <span class="c1"># Output files if qc volumes required</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-246"><a href="#-246"><span class="linenos">246</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">write_cube_to_disk</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faulted_age_volume</span><span class="p">[:],</span> <span class="s2">&quot;geologic_age&quot;</span><span class="p">)</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-247"><a href="#-247"><span class="linenos">247</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">write_cube_to_disk</span><span class="p">(</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-248"><a href="#-248"><span class="linenos">248</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">faulted_onlap_segments</span><span class="p">[:],</span> <span class="s2">&quot;onlap_segments&quot;</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-249"><a href="#-249"><span class="linenos">249</span></a>            <span class="p">)</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-250"><a href="#-250"><span class="linenos">250</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">write_cube_to_disk</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fault_planes</span><span class="p">[:],</span> <span class="s2">&quot;fault_segments&quot;</span><span class="p">)</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-251"><a href="#-251"><span class="linenos">251</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">write_cube_to_disk</span><span class="p">(</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-252"><a href="#-252"><span class="linenos">252</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">fault_intersections</span><span class="p">[:],</span> <span class="s2">&quot;fault_intersection_segments&quot;</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-253"><a href="#-253"><span class="linenos">253</span></a>            <span class="p">)</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-254"><a href="#-254"><span class="linenos">254</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">write_cube_to_disk</span><span class="p">(</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-255"><a href="#-255"><span class="linenos">255</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">fault_plane_throw</span><span class="p">[:],</span> <span class="s2">&quot;fault_segments_throw&quot;</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-256"><a href="#-256"><span class="linenos">256</span></a>            <span class="p">)</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-257"><a href="#-257"><span class="linenos">257</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">write_cube_to_disk</span><span class="p">(</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-258"><a href="#-258"><span class="linenos">258</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">fault_plane_azimuth</span><span class="p">[:],</span> <span class="s2">&quot;fault_segments_azimuth&quot;</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-259"><a href="#-259"><span class="linenos">259</span></a>            <span class="p">)</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-260"><a href="#-260"><span class="linenos">260</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_store</span><span class="p">:</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-261"><a href="#-261"><span class="linenos">261</span></a>            <span class="c1"># Write faulted age, onlap and fault segment cubes to hdf</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-262"><a href="#-262"><span class="linenos">262</span></a>            <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-263"><a href="#-263"><span class="linenos">263</span></a>                <span class="p">[</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-264"><a href="#-264"><span class="linenos">264</span></a>                    <span class="s2">&quot;geologic_age_faulted&quot;</span><span class="p">,</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-265"><a href="#-265"><span class="linenos">265</span></a>                    <span class="s2">&quot;onlap_segments&quot;</span><span class="p">,</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-266"><a href="#-266"><span class="linenos">266</span></a>                    <span class="s2">&quot;fault_segments&quot;</span><span class="p">,</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-267"><a href="#-267"><span class="linenos">267</span></a>                    <span class="s2">&quot;fault_intersection_segments&quot;</span><span class="p">,</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-268"><a href="#-268"><span class="linenos">268</span></a>                    <span class="s2">&quot;fault_segments_throw&quot;</span><span class="p">,</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-269"><a href="#-269"><span class="linenos">269</span></a>                    <span class="s2">&quot;fault_segments_azimuth&quot;</span><span class="p">,</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-270"><a href="#-270"><span class="linenos">270</span></a>                <span class="p">],</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-271"><a href="#-271"><span class="linenos">271</span></a>                <span class="p">[</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-272"><a href="#-272"><span class="linenos">272</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">faulted_age_volume</span><span class="p">,</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-273"><a href="#-273"><span class="linenos">273</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">faulted_onlap_segments</span><span class="p">,</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-274"><a href="#-274"><span class="linenos">274</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">fault_planes</span><span class="p">,</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-275"><a href="#-275"><span class="linenos">275</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">fault_intersections</span><span class="p">,</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-276"><a href="#-276"><span class="linenos">276</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">fault_plane_throw</span><span class="p">,</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-277"><a href="#-277"><span class="linenos">277</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">fault_plane_azimuth</span><span class="p">,</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-278"><a href="#-278"><span class="linenos">278</span></a>                <span class="p">],</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-279"><a href="#-279"><span class="linenos">279</span></a>            <span class="p">):</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-280"><a href="#-280"><span class="linenos">280</span></a>                <span class="n">write_data_to_hdf</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_master</span><span class="p">)</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-281"><a href="#-281"><span class="linenos">281</span></a>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-282"><a href="#-282"><span class="linenos">282</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">qc_plots</span><span class="p">:</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-283"><a href="#-283"><span class="linenos">283</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">create_qc_plots</span><span class="p">()</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-284"><a href="#-284"><span class="linenos">284</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-285"><a href="#-285"><span class="linenos">285</span></a>                <span class="c1"># Create 3D qc plot</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-286"><a href="#-286"><span class="linenos">286</span></a>                <span class="n">plot_3D_faults_plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-287"><a href="#-287"><span class="linenos">287</span></a>            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
</span><span id="Faults.apply_faulting_to_geomodels_and_depth_maps-288"><a href="#-288"><span class="linenos">288</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span><span class="s2">&quot;3D Fault Plotting Failed&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><h6 id="apply-faulting-to-horizons-and-cubes">Apply faulting to horizons and cubes</h6>

<p>Generates random faults and applies faulting to horizons and cubes.</p>

<p>The method does the following:</p>

<ul>
<li>Generate faults and sum the displacements</li>
<li>Apply faulting to horizons</li>
<li>Write faulted depth maps to disk</li>
<li>Write faulted depth maps with gaps at faults to disk</li>
<li>Write onlapping horizons to disk</li>
<li>Apply faulting to geomodels</li>
<li>Make segmentation results conform to binary values after
faulting and interpolation.</li>
<li>Write cubes to file (if qc_volumes turned on in config.json)</li>
</ul>

<p>(If segmentation is not reset to binary, the multiple 
interpolations for successive faults destroys the crisp
localization of the labels. Subjective observation suggests
that slightly different thresholds for different 
features provide superior results)</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>None</strong></li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>None</strong></li>
</ul>
</div>


                            </div>
                            <div id="Faults.build_faulted_property_geomodels" class="classattr">
                                        <input id="Faults.build_faulted_property_geomodels-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">build_faulted_property_geomodels</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">facies</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="Faults.build_faulted_property_geomodels-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Faults.build_faulted_property_geomodels"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Faults.build_faulted_property_geomodels-290"><a href="#-290"><span class="linenos">290</span></a>    <span class="k">def</span> <span class="nf">build_faulted_property_geomodels</span><span class="p">(</span>
</span><span id="Faults.build_faulted_property_geomodels-291"><a href="#-291"><span class="linenos">291</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Faults.build_faulted_property_geomodels-292"><a href="#-292"><span class="linenos">292</span></a>        <span class="n">facies</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
</span><span id="Faults.build_faulted_property_geomodels-293"><a href="#-293"><span class="linenos">293</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Faults.build_faulted_property_geomodels-294"><a href="#-294"><span class="linenos">294</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="Faults.build_faulted_property_geomodels-295"><a href="#-295"><span class="linenos">295</span></a><span class="sd">        Build Faulted Property Geomodels</span>
</span><span id="Faults.build_faulted_property_geomodels-296"><a href="#-296"><span class="linenos">296</span></a><span class="sd">        ------------</span>
</span><span id="Faults.build_faulted_property_geomodels-297"><a href="#-297"><span class="linenos">297</span></a><span class="sd">        Generates faulted property geomodels.</span>
</span><span id="Faults.build_faulted_property_geomodels-298"><a href="#-298"><span class="linenos">298</span></a>
</span><span id="Faults.build_faulted_property_geomodels-299"><a href="#-299"><span class="linenos">299</span></a><span class="sd">        **The method does the following:**</span>
</span><span id="Faults.build_faulted_property_geomodels-300"><a href="#-300"><span class="linenos">300</span></a>
</span><span id="Faults.build_faulted_property_geomodels-301"><a href="#-301"><span class="linenos">301</span></a><span class="sd">        Use faulted geologic_age cube, depth_maps and facies</span>
</span><span id="Faults.build_faulted_property_geomodels-302"><a href="#-302"><span class="linenos">302</span></a><span class="sd">        to create geomodel properties (depth, lith)</span>
</span><span id="Faults.build_faulted_property_geomodels-303"><a href="#-303"><span class="linenos">303</span></a>
</span><span id="Faults.build_faulted_property_geomodels-304"><a href="#-304"><span class="linenos">304</span></a><span class="sd">        - lithology</span>
</span><span id="Faults.build_faulted_property_geomodels-305"><a href="#-305"><span class="linenos">305</span></a><span class="sd">        - net_to_gross (to create effective sand layers)</span>
</span><span id="Faults.build_faulted_property_geomodels-306"><a href="#-306"><span class="linenos">306</span></a><span class="sd">        - depth below mudline</span>
</span><span id="Faults.build_faulted_property_geomodels-307"><a href="#-307"><span class="linenos">307</span></a><span class="sd">        - randomised depth below mudline (to </span>
</span><span id="Faults.build_faulted_property_geomodels-308"><a href="#-308"><span class="linenos">308</span></a><span class="sd">          randomise the rock properties per layer)</span>
</span><span id="Faults.build_faulted_property_geomodels-309"><a href="#-309"><span class="linenos">309</span></a>
</span><span id="Faults.build_faulted_property_geomodels-310"><a href="#-310"><span class="linenos">310</span></a><span class="sd">        Parameters</span>
</span><span id="Faults.build_faulted_property_geomodels-311"><a href="#-311"><span class="linenos">311</span></a><span class="sd">        ----------</span>
</span><span id="Faults.build_faulted_property_geomodels-312"><a href="#-312"><span class="linenos">312</span></a><span class="sd">        facies : np.ndarray</span>
</span><span id="Faults.build_faulted_property_geomodels-313"><a href="#-313"><span class="linenos">313</span></a><span class="sd">            The Horizons class used to build the faults.</span>
</span><span id="Faults.build_faulted_property_geomodels-314"><a href="#-314"><span class="linenos">314</span></a>
</span><span id="Faults.build_faulted_property_geomodels-315"><a href="#-315"><span class="linenos">315</span></a><span class="sd">        Returns</span>
</span><span id="Faults.build_faulted_property_geomodels-316"><a href="#-316"><span class="linenos">316</span></a><span class="sd">        -------</span>
</span><span id="Faults.build_faulted_property_geomodels-317"><a href="#-317"><span class="linenos">317</span></a><span class="sd">        None</span>
</span><span id="Faults.build_faulted_property_geomodels-318"><a href="#-318"><span class="linenos">318</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Faults.build_faulted_property_geomodels-319"><a href="#-319"><span class="linenos">319</span></a>        <span class="n">work_cube_lith</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="Faults.build_faulted_property_geomodels-320"><a href="#-320"><span class="linenos">320</span></a>            <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faulted_age_volume</span><span class="p">)</span> <span class="o">*</span> <span class="o">-</span><span class="mi">1</span>
</span><span id="Faults.build_faulted_property_geomodels-321"><a href="#-321"><span class="linenos">321</span></a>        <span class="p">)</span>  <span class="c1"># initialise lith cube to water</span>
</span><span id="Faults.build_faulted_property_geomodels-322"><a href="#-322"><span class="linenos">322</span></a>        <span class="n">work_cube_sealed</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faulted_age_volume</span><span class="p">)</span>
</span><span id="Faults.build_faulted_property_geomodels-323"><a href="#-323"><span class="linenos">323</span></a>        <span class="n">work_cube_net_to_gross</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faulted_age_volume</span><span class="p">)</span>
</span><span id="Faults.build_faulted_property_geomodels-324"><a href="#-324"><span class="linenos">324</span></a>        <span class="n">work_cube_depth</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faulted_age_volume</span><span class="p">)</span>
</span><span id="Faults.build_faulted_property_geomodels-325"><a href="#-325"><span class="linenos">325</span></a>        <span class="c1"># Also create a randomised depth cube for generating randomised rock properties</span>
</span><span id="Faults.build_faulted_property_geomodels-326"><a href="#-326"><span class="linenos">326</span></a>        <span class="c1"># final dimension&#39;s shape is based on number of possible list types</span>
</span><span id="Faults.build_faulted_property_geomodels-327"><a href="#-327"><span class="linenos">327</span></a>        <span class="c1"># currently  one of [&#39;seawater&#39;, &#39;shale&#39;, &#39;sand&#39;]</span>
</span><span id="Faults.build_faulted_property_geomodels-328"><a href="#-328"><span class="linenos">328</span></a>        <span class="c1"># n_lith = len([&#39;shale&#39;, &#39;sand&#39;])</span>
</span><span id="Faults.build_faulted_property_geomodels-329"><a href="#-329"><span class="linenos">329</span></a>        <span class="n">cube_shape</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">faulted_age_volume</span><span class="o">.</span><span class="n">shape</span>
</span><span id="Faults.build_faulted_property_geomodels-330"><a href="#-330"><span class="linenos">330</span></a>        <span class="c1"># randomised_depth = np.zeros(cube_shape, &#39;float32&#39;)</span>
</span><span id="Faults.build_faulted_property_geomodels-331"><a href="#-331"><span class="linenos">331</span></a>
</span><span id="Faults.build_faulted_property_geomodels-332"><a href="#-332"><span class="linenos">332</span></a>        <span class="n">ii</span><span class="p">,</span> <span class="n">jj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">build_meshgrid</span><span class="p">()</span>
</span><span id="Faults.build_faulted_property_geomodels-333"><a href="#-333"><span class="linenos">333</span></a>
</span><span id="Faults.build_faulted_property_geomodels-334"><a href="#-334"><span class="linenos">334</span></a>        <span class="c1"># Loop over layers in reverse order, start at base</span>
</span><span id="Faults.build_faulted_property_geomodels-335"><a href="#-335"><span class="linenos">335</span></a>        <span class="n">previous_depth_map</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">faulted_depth_maps</span><span class="p">[:,</span> <span class="p">:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="Faults.build_faulted_property_geomodels-336"><a href="#-336"><span class="linenos">336</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">partial_voxels</span><span class="p">:</span>
</span><span id="Faults.build_faulted_property_geomodels-337"><a href="#-337"><span class="linenos">337</span></a>            <span class="c1"># add .5 to consider partial voxels from half above and half below</span>
</span><span id="Faults.build_faulted_property_geomodels-338"><a href="#-338"><span class="linenos">338</span></a>            <span class="n">previous_depth_map</span> <span class="o">+=</span> <span class="mf">0.5</span>
</span><span id="Faults.build_faulted_property_geomodels-339"><a href="#-339"><span class="linenos">339</span></a>
</span><span id="Faults.build_faulted_property_geomodels-340"><a href="#-340"><span class="linenos">340</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faulted_depth_maps</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
</span><span id="Faults.build_faulted_property_geomodels-341"><a href="#-341"><span class="linenos">341</span></a>            <span class="c1"># Apply a random depth shift within the range as provided in config file</span>
</span><span id="Faults.build_faulted_property_geomodels-342"><a href="#-342"><span class="linenos">342</span></a>            <span class="c1"># (provided in metres, so converted to samples here)</span>
</span><span id="Faults.build_faulted_property_geomodels-343"><a href="#-343"><span class="linenos">343</span></a>
</span><span id="Faults.build_faulted_property_geomodels-344"><a href="#-344"><span class="linenos">344</span></a>            <span class="n">current_depth_map</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">faulted_depth_maps</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">i</span><span class="p">]</span>
</span><span id="Faults.build_faulted_property_geomodels-345"><a href="#-345"><span class="linenos">345</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">partial_voxels</span><span class="p">:</span>
</span><span id="Faults.build_faulted_property_geomodels-346"><a href="#-346"><span class="linenos">346</span></a>                <span class="n">current_depth_map</span> <span class="o">+=</span> <span class="mf">0.5</span>
</span><span id="Faults.build_faulted_property_geomodels-347"><a href="#-347"><span class="linenos">347</span></a>
</span><span id="Faults.build_faulted_property_geomodels-348"><a href="#-348"><span class="linenos">348</span></a>            <span class="c1"># compute maps with indices of top map and base map to include partial voxels</span>
</span><span id="Faults.build_faulted_property_geomodels-349"><a href="#-349"><span class="linenos">349</span></a>            <span class="n">top_map_index</span> <span class="o">=</span> <span class="n">current_depth_map</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;int&quot;</span><span class="p">)</span>
</span><span id="Faults.build_faulted_property_geomodels-350"><a href="#-350"><span class="linenos">350</span></a>            <span class="n">base_map_index</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="Faults.build_faulted_property_geomodels-351"><a href="#-351"><span class="linenos">351</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">faulted_depth_maps</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;int&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="Faults.build_faulted_property_geomodels-352"><a href="#-352"><span class="linenos">352</span></a>            <span class="p">)</span>
</span><span id="Faults.build_faulted_property_geomodels-353"><a href="#-353"><span class="linenos">353</span></a>
</span><span id="Faults.build_faulted_property_geomodels-354"><a href="#-354"><span class="linenos">354</span></a>            <span class="c1"># compute thickness over which to iterate</span>
</span><span id="Faults.build_faulted_property_geomodels-355"><a href="#-355"><span class="linenos">355</span></a>            <span class="n">thickness_map</span> <span class="o">=</span> <span class="n">base_map_index</span> <span class="o">-</span> <span class="n">top_map_index</span>
</span><span id="Faults.build_faulted_property_geomodels-356"><a href="#-356"><span class="linenos">356</span></a>            <span class="n">thickness_map_max</span> <span class="o">=</span> <span class="n">thickness_map</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</span><span id="Faults.build_faulted_property_geomodels-357"><a href="#-357"><span class="linenos">357</span></a>
</span><span id="Faults.build_faulted_property_geomodels-358"><a href="#-358"><span class="linenos">358</span></a>            <span class="n">tvdml_map</span> <span class="o">=</span> <span class="n">previous_depth_map</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">faulted_depth_maps</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span>
</span><span id="Faults.build_faulted_property_geomodels-359"><a href="#-359"><span class="linenos">359</span></a>            <span class="c1"># Net to Gross Map for layer</span>
</span><span id="Faults.build_faulted_property_geomodels-360"><a href="#-360"><span class="linenos">360</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">variable_shale_ng</span><span class="p">:</span>
</span><span id="Faults.build_faulted_property_geomodels-361"><a href="#-361"><span class="linenos">361</span></a>                <span class="n">ng_map</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span>
</span><span id="Faults.build_faulted_property_geomodels-362"><a href="#-362"><span class="linenos">362</span></a>                    <span class="n">shape</span><span class="o">=</span><span class="p">(</span>
</span><span id="Faults.build_faulted_property_geomodels-363"><a href="#-363"><span class="linenos">363</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">faulted_depth_maps</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
</span><span id="Faults.build_faulted_property_geomodels-364"><a href="#-364"><span class="linenos">364</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">faulted_depth_maps</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
</span><span id="Faults.build_faulted_property_geomodels-365"><a href="#-365"><span class="linenos">365</span></a>                    <span class="p">)</span>
</span><span id="Faults.build_faulted_property_geomodels-366"><a href="#-366"><span class="linenos">366</span></a>                <span class="p">)</span>
</span><span id="Faults.build_faulted_property_geomodels-367"><a href="#-367"><span class="linenos">367</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Faults.build_faulted_property_geomodels-368"><a href="#-368"><span class="linenos">368</span></a>                <span class="k">if</span> <span class="p">(</span>
</span><span id="Faults.build_faulted_property_geomodels-369"><a href="#-369"><span class="linenos">369</span></a>                    <span class="n">facies</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mf">0.0</span>
</span><span id="Faults.build_faulted_property_geomodels-370"><a href="#-370"><span class="linenos">370</span></a>                <span class="p">):</span>  <span class="c1"># if shale layer, make non-zero N/G map for layer using a low average net to gross</span>
</span><span id="Faults.build_faulted_property_geomodels-371"><a href="#-371"><span class="linenos">371</span></a>                    <span class="n">ng_map</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_random_net_over_gross_map</span><span class="p">(</span>
</span><span id="Faults.build_faulted_property_geomodels-372"><a href="#-372"><span class="linenos">372</span></a>                        <span class="n">avg</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">),</span> <span class="n">stdev</span><span class="o">=</span><span class="p">(</span><span class="mf">0.001</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">),</span> <span class="n">octave</span><span class="o">=</span><span class="mi">3</span>
</span><span id="Faults.build_faulted_property_geomodels-373"><a href="#-373"><span class="linenos">373</span></a>                    <span class="p">)</span>
</span><span id="Faults.build_faulted_property_geomodels-374"><a href="#-374"><span class="linenos">374</span></a>            <span class="k">if</span> <span class="n">facies</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mf">1.0</span><span class="p">:</span>  <span class="c1"># if sand layer, make non-zero N/G map for layer</span>
</span><span id="Faults.build_faulted_property_geomodels-375"><a href="#-375"><span class="linenos">375</span></a>                <span class="n">ng_map</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_random_net_over_gross_map</span><span class="p">()</span>
</span><span id="Faults.build_faulted_property_geomodels-376"><a href="#-376"><span class="linenos">376</span></a>
</span><span id="Faults.build_faulted_property_geomodels-377"><a href="#-377"><span class="linenos">377</span></a>            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">thickness_map_max</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="Faults.build_faulted_property_geomodels-378"><a href="#-378"><span class="linenos">378</span></a>
</span><span id="Faults.build_faulted_property_geomodels-379"><a href="#-379"><span class="linenos">379</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">partial_voxels</span><span class="p">:</span>
</span><span id="Faults.build_faulted_property_geomodels-380"><a href="#-380"><span class="linenos">380</span></a>                    <span class="c1"># compute fraction of voxel containing layer</span>
</span><span id="Faults.build_faulted_property_geomodels-381"><a href="#-381"><span class="linenos">381</span></a>                    <span class="n">top_map</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span>
</span><span id="Faults.build_faulted_property_geomodels-382"><a href="#-382"><span class="linenos">382</span></a>                        <span class="n">np</span><span class="o">.</span><span class="n">dstack</span><span class="p">(</span>
</span><span id="Faults.build_faulted_property_geomodels-383"><a href="#-383"><span class="linenos">383</span></a>                            <span class="p">(</span><span class="n">current_depth_map</span><span class="p">,</span> <span class="n">top_map_index</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;float32&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="n">k</span><span class="p">)</span>
</span><span id="Faults.build_faulted_property_geomodels-384"><a href="#-384"><span class="linenos">384</span></a>                        <span class="p">),</span>
</span><span id="Faults.build_faulted_property_geomodels-385"><a href="#-385"><span class="linenos">385</span></a>                        <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
</span><span id="Faults.build_faulted_property_geomodels-386"><a href="#-386"><span class="linenos">386</span></a>                    <span class="p">)</span>
</span><span id="Faults.build_faulted_property_geomodels-387"><a href="#-387"><span class="linenos">387</span></a>                    <span class="n">top_map</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dstack</span><span class="p">((</span><span class="n">top_map</span><span class="p">,</span> <span class="n">previous_depth_map</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="Faults.build_faulted_property_geomodels-388"><a href="#-388"><span class="linenos">388</span></a>                    <span class="n">base_map</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span>
</span><span id="Faults.build_faulted_property_geomodels-389"><a href="#-389"><span class="linenos">389</span></a>                        <span class="n">np</span><span class="o">.</span><span class="n">dstack</span><span class="p">(</span>
</span><span id="Faults.build_faulted_property_geomodels-390"><a href="#-390"><span class="linenos">390</span></a>                            <span class="p">(</span>
</span><span id="Faults.build_faulted_property_geomodels-391"><a href="#-391"><span class="linenos">391</span></a>                                <span class="n">previous_depth_map</span><span class="p">,</span>
</span><span id="Faults.build_faulted_property_geomodels-392"><a href="#-392"><span class="linenos">392</span></a>                                <span class="n">top_map_index</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;float32&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="Faults.build_faulted_property_geomodels-393"><a href="#-393"><span class="linenos">393</span></a>                            <span class="p">)</span>
</span><span id="Faults.build_faulted_property_geomodels-394"><a href="#-394"><span class="linenos">394</span></a>                        <span class="p">),</span>
</span><span id="Faults.build_faulted_property_geomodels-395"><a href="#-395"><span class="linenos">395</span></a>                        <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
</span><span id="Faults.build_faulted_property_geomodels-396"><a href="#-396"><span class="linenos">396</span></a>                    <span class="p">)</span>
</span><span id="Faults.build_faulted_property_geomodels-397"><a href="#-397"><span class="linenos">397</span></a>                    <span class="n">fraction_of_voxel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">base_map</span> <span class="o">-</span> <span class="n">top_map</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
</span><span id="Faults.build_faulted_property_geomodels-398"><a href="#-398"><span class="linenos">398</span></a>                    <span class="n">valid_k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
</span><span id="Faults.build_faulted_property_geomodels-399"><a href="#-399"><span class="linenos">399</span></a>                        <span class="p">(</span><span class="n">fraction_of_voxel</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">)</span>
</span><span id="Faults.build_faulted_property_geomodels-400"><a href="#-400"><span class="linenos">400</span></a>                        <span class="o">&amp;</span> <span class="p">((</span><span class="n">top_map_index</span> <span class="o">+</span> <span class="n">k</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;int&quot;</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">cube_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span>
</span><span id="Faults.build_faulted_property_geomodels-401"><a href="#-401"><span class="linenos">401</span></a>                        <span class="mi">1</span><span class="p">,</span>
</span><span id="Faults.build_faulted_property_geomodels-402"><a href="#-402"><span class="linenos">402</span></a>                        <span class="mi">0</span><span class="p">,</span>
</span><span id="Faults.build_faulted_property_geomodels-403"><a href="#-403"><span class="linenos">403</span></a>                    <span class="p">)</span>
</span><span id="Faults.build_faulted_property_geomodels-404"><a href="#-404"><span class="linenos">404</span></a>
</span><span id="Faults.build_faulted_property_geomodels-405"><a href="#-405"><span class="linenos">405</span></a>                    <span class="c1"># put layer properties in the cube for each case</span>
</span><span id="Faults.build_faulted_property_geomodels-406"><a href="#-406"><span class="linenos">406</span></a>                    <span class="n">sublayer_ii</span> <span class="o">=</span> <span class="n">ii</span><span class="p">[</span><span class="n">valid_k</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="Faults.build_faulted_property_geomodels-407"><a href="#-407"><span class="linenos">407</span></a>                    <span class="n">sublayer_jj</span> <span class="o">=</span> <span class="n">jj</span><span class="p">[</span><span class="n">valid_k</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="Faults.build_faulted_property_geomodels-408"><a href="#-408"><span class="linenos">408</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Faults.build_faulted_property_geomodels-409"><a href="#-409"><span class="linenos">409</span></a>                    <span class="n">sublayer_ii</span> <span class="o">=</span> <span class="n">ii</span><span class="p">[</span><span class="n">thickness_map</span> <span class="o">&gt;</span> <span class="n">k</span><span class="p">]</span>
</span><span id="Faults.build_faulted_property_geomodels-410"><a href="#-410"><span class="linenos">410</span></a>                    <span class="n">sublayer_jj</span> <span class="o">=</span> <span class="n">jj</span><span class="p">[</span><span class="n">thickness_map</span> <span class="o">&gt;</span> <span class="n">k</span><span class="p">]</span>
</span><span id="Faults.build_faulted_property_geomodels-411"><a href="#-411"><span class="linenos">411</span></a>
</span><span id="Faults.build_faulted_property_geomodels-412"><a href="#-412"><span class="linenos">412</span></a>                <span class="k">if</span> <span class="n">sublayer_ii</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Faults.build_faulted_property_geomodels-413"><a href="#-413"><span class="linenos">413</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">partial_voxels</span><span class="p">:</span>
</span><span id="Faults.build_faulted_property_geomodels-414"><a href="#-414"><span class="linenos">414</span></a>                        <span class="n">sublayer_depth_map</span> <span class="o">=</span> <span class="p">(</span><span class="n">top_map_index</span> <span class="o">+</span> <span class="n">k</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;int&quot;</span><span class="p">)[</span>
</span><span id="Faults.build_faulted_property_geomodels-415"><a href="#-415"><span class="linenos">415</span></a>                            <span class="n">valid_k</span> <span class="o">==</span> <span class="mi">1</span>
</span><span id="Faults.build_faulted_property_geomodels-416"><a href="#-416"><span class="linenos">416</span></a>                        <span class="p">]</span>
</span><span id="Faults.build_faulted_property_geomodels-417"><a href="#-417"><span class="linenos">417</span></a>                        <span class="n">sublayer_depth_map_int</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">sublayer_depth_map</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="Faults.build_faulted_property_geomodels-418"><a href="#-418"><span class="linenos">418</span></a>                        <span class="n">sublayer_ng_map</span> <span class="o">=</span> <span class="n">ng_map</span><span class="p">[</span><span class="n">valid_k</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="Faults.build_faulted_property_geomodels-419"><a href="#-419"><span class="linenos">419</span></a>                        <span class="n">sublayer_tvdml_map</span> <span class="o">=</span> <span class="n">tvdml_map</span><span class="p">[</span><span class="n">valid_k</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="Faults.build_faulted_property_geomodels-420"><a href="#-420"><span class="linenos">420</span></a>                        <span class="n">sublayer_fraction</span> <span class="o">=</span> <span class="n">fraction_of_voxel</span><span class="p">[</span><span class="n">valid_k</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="Faults.build_faulted_property_geomodels-421"><a href="#-421"><span class="linenos">421</span></a>
</span><span id="Faults.build_faulted_property_geomodels-422"><a href="#-422"><span class="linenos">422</span></a>                        <span class="c1"># Lithology cube</span>
</span><span id="Faults.build_faulted_property_geomodels-423"><a href="#-423"><span class="linenos">423</span></a>                        <span class="n">input_cube</span> <span class="o">=</span> <span class="n">work_cube_lith</span><span class="p">[</span>
</span><span id="Faults.build_faulted_property_geomodels-424"><a href="#-424"><span class="linenos">424</span></a>                            <span class="n">sublayer_ii</span><span class="p">,</span> <span class="n">sublayer_jj</span><span class="p">,</span> <span class="n">sublayer_depth_map_int</span>
</span><span id="Faults.build_faulted_property_geomodels-425"><a href="#-425"><span class="linenos">425</span></a>                        <span class="p">]</span>
</span><span id="Faults.build_faulted_property_geomodels-426"><a href="#-426"><span class="linenos">426</span></a>                        <span class="n">values</span> <span class="o">=</span> <span class="n">facies</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">sublayer_fraction</span>
</span><span id="Faults.build_faulted_property_geomodels-427"><a href="#-427"><span class="linenos">427</span></a>                        <span class="n">input_cube</span><span class="p">[</span><span class="n">input_cube</span> <span class="o">==</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="Faults.build_faulted_property_geomodels-428"><a href="#-428"><span class="linenos">428</span></a>                            <span class="n">values</span><span class="p">[</span><span class="n">input_cube</span> <span class="o">==</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1.0</span>
</span><span id="Faults.build_faulted_property_geomodels-429"><a href="#-429"><span class="linenos">429</span></a>                        <span class="p">)</span>
</span><span id="Faults.build_faulted_property_geomodels-430"><a href="#-430"><span class="linenos">430</span></a>                        <span class="n">input_cube</span><span class="p">[</span><span class="n">input_cube</span> <span class="o">!=</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">]</span> <span class="o">+=</span> <span class="n">values</span><span class="p">[</span><span class="n">input_cube</span> <span class="o">!=</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">]</span>
</span><span id="Faults.build_faulted_property_geomodels-431"><a href="#-431"><span class="linenos">431</span></a>                        <span class="n">work_cube_lith</span><span class="p">[</span>
</span><span id="Faults.build_faulted_property_geomodels-432"><a href="#-432"><span class="linenos">432</span></a>                            <span class="n">sublayer_ii</span><span class="p">,</span> <span class="n">sublayer_jj</span><span class="p">,</span> <span class="n">sublayer_depth_map_int</span>
</span><span id="Faults.build_faulted_property_geomodels-433"><a href="#-433"><span class="linenos">433</span></a>                        <span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">input_cube</span> <span class="o">*</span> <span class="mf">1.0</span><span class="p">)</span>
</span><span id="Faults.build_faulted_property_geomodels-434"><a href="#-434"><span class="linenos">434</span></a>                        <span class="k">del</span> <span class="n">input_cube</span>
</span><span id="Faults.build_faulted_property_geomodels-435"><a href="#-435"><span class="linenos">435</span></a>                        <span class="k">del</span> <span class="n">values</span>
</span><span id="Faults.build_faulted_property_geomodels-436"><a href="#-436"><span class="linenos">436</span></a>
</span><span id="Faults.build_faulted_property_geomodels-437"><a href="#-437"><span class="linenos">437</span></a>                        <span class="n">input_cube</span> <span class="o">=</span> <span class="n">work_cube_sealed</span><span class="p">[</span>
</span><span id="Faults.build_faulted_property_geomodels-438"><a href="#-438"><span class="linenos">438</span></a>                            <span class="n">sublayer_ii</span><span class="p">,</span> <span class="n">sublayer_jj</span><span class="p">,</span> <span class="n">sublayer_depth_map_int</span>
</span><span id="Faults.build_faulted_property_geomodels-439"><a href="#-439"><span class="linenos">439</span></a>                        <span class="p">]</span>
</span><span id="Faults.build_faulted_property_geomodels-440"><a href="#-440"><span class="linenos">440</span></a>                        <span class="n">values</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">facies</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="n">sublayer_fraction</span>
</span><span id="Faults.build_faulted_property_geomodels-441"><a href="#-441"><span class="linenos">441</span></a>                        <span class="n">input_cube</span><span class="p">[</span><span class="n">input_cube</span> <span class="o">==</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="Faults.build_faulted_property_geomodels-442"><a href="#-442"><span class="linenos">442</span></a>                            <span class="n">values</span><span class="p">[</span><span class="n">input_cube</span> <span class="o">==</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1.0</span>
</span><span id="Faults.build_faulted_property_geomodels-443"><a href="#-443"><span class="linenos">443</span></a>                        <span class="p">)</span>
</span><span id="Faults.build_faulted_property_geomodels-444"><a href="#-444"><span class="linenos">444</span></a>                        <span class="n">input_cube</span><span class="p">[</span><span class="n">input_cube</span> <span class="o">!=</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">]</span> <span class="o">+=</span> <span class="n">values</span><span class="p">[</span><span class="n">input_cube</span> <span class="o">!=</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">]</span>
</span><span id="Faults.build_faulted_property_geomodels-445"><a href="#-445"><span class="linenos">445</span></a>                        <span class="n">work_cube_sealed</span><span class="p">[</span>
</span><span id="Faults.build_faulted_property_geomodels-446"><a href="#-446"><span class="linenos">446</span></a>                            <span class="n">sublayer_ii</span><span class="p">,</span> <span class="n">sublayer_jj</span><span class="p">,</span> <span class="n">sublayer_depth_map_int</span>
</span><span id="Faults.build_faulted_property_geomodels-447"><a href="#-447"><span class="linenos">447</span></a>                        <span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">input_cube</span> <span class="o">*</span> <span class="mf">1.0</span><span class="p">)</span>
</span><span id="Faults.build_faulted_property_geomodels-448"><a href="#-448"><span class="linenos">448</span></a>                        <span class="k">del</span> <span class="n">input_cube</span>
</span><span id="Faults.build_faulted_property_geomodels-449"><a href="#-449"><span class="linenos">449</span></a>                        <span class="k">del</span> <span class="n">values</span>
</span><span id="Faults.build_faulted_property_geomodels-450"><a href="#-450"><span class="linenos">450</span></a>
</span><span id="Faults.build_faulted_property_geomodels-451"><a href="#-451"><span class="linenos">451</span></a>                        <span class="c1"># Depth cube</span>
</span><span id="Faults.build_faulted_property_geomodels-452"><a href="#-452"><span class="linenos">452</span></a>                        <span class="n">work_cube_depth</span><span class="p">[</span>
</span><span id="Faults.build_faulted_property_geomodels-453"><a href="#-453"><span class="linenos">453</span></a>                            <span class="n">sublayer_ii</span><span class="p">,</span> <span class="n">sublayer_jj</span><span class="p">,</span> <span class="n">sublayer_depth_map_int</span>
</span><span id="Faults.build_faulted_property_geomodels-454"><a href="#-454"><span class="linenos">454</span></a>                        <span class="p">]</span> <span class="o">+=</span> <span class="p">(</span><span class="n">sublayer_tvdml_map</span> <span class="o">*</span> <span class="n">sublayer_fraction</span><span class="p">)</span>
</span><span id="Faults.build_faulted_property_geomodels-455"><a href="#-455"><span class="linenos">455</span></a>                        <span class="c1"># Net to Gross cube</span>
</span><span id="Faults.build_faulted_property_geomodels-456"><a href="#-456"><span class="linenos">456</span></a>                        <span class="n">work_cube_net_to_gross</span><span class="p">[</span>
</span><span id="Faults.build_faulted_property_geomodels-457"><a href="#-457"><span class="linenos">457</span></a>                            <span class="n">sublayer_ii</span><span class="p">,</span> <span class="n">sublayer_jj</span><span class="p">,</span> <span class="n">sublayer_depth_map_int</span>
</span><span id="Faults.build_faulted_property_geomodels-458"><a href="#-458"><span class="linenos">458</span></a>                        <span class="p">]</span> <span class="o">+=</span> <span class="p">(</span><span class="n">sublayer_ng_map</span> <span class="o">*</span> <span class="n">sublayer_fraction</span><span class="p">)</span>
</span><span id="Faults.build_faulted_property_geomodels-459"><a href="#-459"><span class="linenos">459</span></a>
</span><span id="Faults.build_faulted_property_geomodels-460"><a href="#-460"><span class="linenos">460</span></a>                        <span class="c1"># Randomised Depth Cube</span>
</span><span id="Faults.build_faulted_property_geomodels-461"><a href="#-461"><span class="linenos">461</span></a>                        <span class="c1"># randomised_depth[sublayer_ii, sublayer_jj, sublayer_depth_map_int] += \</span>
</span><span id="Faults.build_faulted_property_geomodels-462"><a href="#-462"><span class="linenos">462</span></a>                        <span class="c1">#     (sublayer_tvdml_map + random_z_perturbation) * sublayer_fraction</span>
</span><span id="Faults.build_faulted_property_geomodels-463"><a href="#-463"><span class="linenos">463</span></a>
</span><span id="Faults.build_faulted_property_geomodels-464"><a href="#-464"><span class="linenos">464</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="Faults.build_faulted_property_geomodels-465"><a href="#-465"><span class="linenos">465</span></a>                        <span class="n">sublayer_depth_map_int</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="Faults.build_faulted_property_geomodels-466"><a href="#-466"><span class="linenos">466</span></a>                            <span class="mf">0.5</span>
</span><span id="Faults.build_faulted_property_geomodels-467"><a href="#-467"><span class="linenos">467</span></a>                            <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span>
</span><span id="Faults.build_faulted_property_geomodels-468"><a href="#-468"><span class="linenos">468</span></a>                                <span class="n">previous_depth_map</span><span class="p">[</span><span class="n">thickness_map</span> <span class="o">&gt;</span> <span class="n">k</span><span class="p">],</span>
</span><span id="Faults.build_faulted_property_geomodels-469"><a href="#-469"><span class="linenos">469</span></a>                                <span class="mi">0</span><span class="p">,</span>
</span><span id="Faults.build_faulted_property_geomodels-470"><a href="#-470"><span class="linenos">470</span></a>                                <span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">geologic_age</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="Faults.build_faulted_property_geomodels-471"><a href="#-471"><span class="linenos">471</span></a>                            <span class="p">)</span>
</span><span id="Faults.build_faulted_property_geomodels-472"><a href="#-472"><span class="linenos">472</span></a>                        <span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;int&quot;</span><span class="p">)</span> <span class="o">-</span> <span class="n">k</span>
</span><span id="Faults.build_faulted_property_geomodels-473"><a href="#-473"><span class="linenos">473</span></a>                        <span class="n">sublayer_tvdml_map</span> <span class="o">=</span> <span class="n">tvdml_map</span><span class="p">[</span><span class="n">thickness_map</span> <span class="o">&gt;</span> <span class="n">k</span><span class="p">]</span>
</span><span id="Faults.build_faulted_property_geomodels-474"><a href="#-474"><span class="linenos">474</span></a>                        <span class="n">sublayer_ng_map</span> <span class="o">=</span> <span class="n">ng_map</span><span class="p">[</span><span class="n">thickness_map</span> <span class="o">&gt;</span> <span class="n">k</span><span class="p">]</span>
</span><span id="Faults.build_faulted_property_geomodels-475"><a href="#-475"><span class="linenos">475</span></a>
</span><span id="Faults.build_faulted_property_geomodels-476"><a href="#-476"><span class="linenos">476</span></a>                        <span class="n">work_cube_lith</span><span class="p">[</span>
</span><span id="Faults.build_faulted_property_geomodels-477"><a href="#-477"><span class="linenos">477</span></a>                            <span class="n">sublayer_ii</span><span class="p">,</span> <span class="n">sublayer_jj</span><span class="p">,</span> <span class="n">sublayer_depth_map_int</span>
</span><span id="Faults.build_faulted_property_geomodels-478"><a href="#-478"><span class="linenos">478</span></a>                        <span class="p">]</span> <span class="o">=</span> <span class="n">facies</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="Faults.build_faulted_property_geomodels-479"><a href="#-479"><span class="linenos">479</span></a>                        <span class="n">work_cube_sealed</span><span class="p">[</span>
</span><span id="Faults.build_faulted_property_geomodels-480"><a href="#-480"><span class="linenos">480</span></a>                            <span class="n">sublayer_ii</span><span class="p">,</span> <span class="n">sublayer_jj</span><span class="p">,</span> <span class="n">sublayer_depth_map_int</span>
</span><span id="Faults.build_faulted_property_geomodels-481"><a href="#-481"><span class="linenos">481</span></a>                        <span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">facies</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span>
</span><span id="Faults.build_faulted_property_geomodels-482"><a href="#-482"><span class="linenos">482</span></a>
</span><span id="Faults.build_faulted_property_geomodels-483"><a href="#-483"><span class="linenos">483</span></a>                        <span class="n">work_cube_depth</span><span class="p">[</span>
</span><span id="Faults.build_faulted_property_geomodels-484"><a href="#-484"><span class="linenos">484</span></a>                            <span class="n">sublayer_ii</span><span class="p">,</span> <span class="n">sublayer_jj</span><span class="p">,</span> <span class="n">sublayer_depth_map_int</span>
</span><span id="Faults.build_faulted_property_geomodels-485"><a href="#-485"><span class="linenos">485</span></a>                        <span class="p">]</span> <span class="o">=</span> <span class="n">sublayer_tvdml_map</span>
</span><span id="Faults.build_faulted_property_geomodels-486"><a href="#-486"><span class="linenos">486</span></a>                        <span class="n">work_cube_net_to_gross</span><span class="p">[</span>
</span><span id="Faults.build_faulted_property_geomodels-487"><a href="#-487"><span class="linenos">487</span></a>                            <span class="n">sublayer_ii</span><span class="p">,</span> <span class="n">sublayer_jj</span><span class="p">,</span> <span class="n">sublayer_depth_map_int</span>
</span><span id="Faults.build_faulted_property_geomodels-488"><a href="#-488"><span class="linenos">488</span></a>                        <span class="p">]</span> <span class="o">+=</span> <span class="n">sublayer_ng_map</span>
</span><span id="Faults.build_faulted_property_geomodels-489"><a href="#-489"><span class="linenos">489</span></a>                        <span class="c1"># randomised_depth[sublayer_ii, sublayer_jj, sublayer_depth_map_int] += (sublayer_tvdml_map + random_z_perturbation)</span>
</span><span id="Faults.build_faulted_property_geomodels-490"><a href="#-490"><span class="linenos">490</span></a>
</span><span id="Faults.build_faulted_property_geomodels-491"><a href="#-491"><span class="linenos">491</span></a>            <span class="c1"># replace previous depth map for next iteration</span>
</span><span id="Faults.build_faulted_property_geomodels-492"><a href="#-492"><span class="linenos">492</span></a>            <span class="n">previous_depth_map</span> <span class="o">=</span> <span class="n">current_depth_map</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Faults.build_faulted_property_geomodels-493"><a href="#-493"><span class="linenos">493</span></a>
</span><span id="Faults.build_faulted_property_geomodels-494"><a href="#-494"><span class="linenos">494</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Faults.build_faulted_property_geomodels-495"><a href="#-495"><span class="linenos">495</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2"> ... After infilling ...&quot;</span><span class="p">)</span>
</span><span id="Faults.build_faulted_property_geomodels-496"><a href="#-496"><span class="linenos">496</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">write_cube_to_disk</span><span class="p">(</span><span class="n">work_cube_sealed</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;uint8&quot;</span><span class="p">),</span> <span class="s2">&quot;sealed_label&quot;</span><span class="p">)</span>
</span><span id="Faults.build_faulted_property_geomodels-497"><a href="#-497"><span class="linenos">497</span></a>
</span><span id="Faults.build_faulted_property_geomodels-498"><a href="#-498"><span class="linenos">498</span></a>        <span class="c1"># Clip cubes and convert from samples to units</span>
</span><span id="Faults.build_faulted_property_geomodels-499"><a href="#-499"><span class="linenos">499</span></a>        <span class="n">work_cube_lith</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">work_cube_lith</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>  <span class="c1"># clip lith to [-1, +1]</span>
</span><span id="Faults.build_faulted_property_geomodels-500"><a href="#-500"><span class="linenos">500</span></a>        <span class="n">work_cube_net_to_gross</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span>
</span><span id="Faults.build_faulted_property_geomodels-501"><a href="#-501"><span class="linenos">501</span></a>            <span class="n">work_cube_net_to_gross</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">1.0</span>
</span><span id="Faults.build_faulted_property_geomodels-502"><a href="#-502"><span class="linenos">502</span></a>        <span class="p">)</span>  <span class="c1"># clip n/g to [0, 1]</span>
</span><span id="Faults.build_faulted_property_geomodels-503"><a href="#-503"><span class="linenos">503</span></a>        <span class="n">work_cube_depth</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">work_cube_depth</span><span class="p">,</span> <span class="n">a_min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">a_max</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</span><span id="Faults.build_faulted_property_geomodels-504"><a href="#-504"><span class="linenos">504</span></a>        <span class="n">work_cube_depth</span> <span class="o">*=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">digi</span>
</span><span id="Faults.build_faulted_property_geomodels-505"><a href="#-505"><span class="linenos">505</span></a>
</span><span id="Faults.build_faulted_property_geomodels-506"><a href="#-506"><span class="linenos">506</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">include_salt</span><span class="p">:</span>
</span><span id="Faults.build_faulted_property_geomodels-507"><a href="#-507"><span class="linenos">507</span></a>            <span class="c1"># Update age model after horizons have been modified by salt inclusion</span>
</span><span id="Faults.build_faulted_property_geomodels-508"><a href="#-508"><span class="linenos">508</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">faulted_age_volume</span><span class="p">[</span>
</span><span id="Faults.build_faulted_property_geomodels-509"><a href="#-509"><span class="linenos">509</span></a>                <span class="p">:</span>
</span><span id="Faults.build_faulted_property_geomodels-510"><a href="#-510"><span class="linenos">510</span></a>            <span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_geologic_age_3d_from_infilled_horizons</span><span class="p">(</span>
</span><span id="Faults.build_faulted_property_geomodels-511"><a href="#-511"><span class="linenos">511</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">faulted_depth_maps</span><span class="p">[:]</span> <span class="o">*</span> <span class="mf">10.0</span>
</span><span id="Faults.build_faulted_property_geomodels-512"><a href="#-512"><span class="linenos">512</span></a>            <span class="p">)</span>
</span><span id="Faults.build_faulted_property_geomodels-513"><a href="#-513"><span class="linenos">513</span></a>            <span class="c1"># Set lith code for salt</span>
</span><span id="Faults.build_faulted_property_geomodels-514"><a href="#-514"><span class="linenos">514</span></a>            <span class="n">work_cube_lith</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">salt_model</span><span class="o">.</span><span class="n">salt_segments</span><span class="p">[:]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">2.0</span>
</span><span id="Faults.build_faulted_property_geomodels-515"><a href="#-515"><span class="linenos">515</span></a>            <span class="c1"># Fix deepest part of facies in case salt inclusion has shifted base horizon</span>
</span><span id="Faults.build_faulted_property_geomodels-516"><a href="#-516"><span class="linenos">516</span></a>            <span class="c1"># This can leave default (water) facies codes at the base</span>
</span><span id="Faults.build_faulted_property_geomodels-517"><a href="#-517"><span class="linenos">517</span></a>            <span class="n">last_50_samples</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">50</span>
</span><span id="Faults.build_faulted_property_geomodels-518"><a href="#-518"><span class="linenos">518</span></a>            <span class="n">work_cube_lith</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">last_50_samples</span><span class="p">:][</span>
</span><span id="Faults.build_faulted_property_geomodels-519"><a href="#-519"><span class="linenos">519</span></a>                <span class="n">work_cube_lith</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">last_50_samples</span><span class="p">:]</span> <span class="o">==</span> <span class="o">-</span><span class="mf">1.0</span>
</span><span id="Faults.build_faulted_property_geomodels-520"><a href="#-520"><span class="linenos">520</span></a>            <span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="Faults.build_faulted_property_geomodels-521"><a href="#-521"><span class="linenos">521</span></a>
</span><span id="Faults.build_faulted_property_geomodels-522"><a href="#-522"><span class="linenos">522</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">qc_plots</span><span class="p">:</span>
</span><span id="Faults.build_faulted_property_geomodels-523"><a href="#-523"><span class="linenos">523</span></a>            <span class="kn">from</span> <span class="nn">datagenerator.util</span> <span class="kn">import</span> <span class="n">plot_xsection</span>
</span><span id="Faults.build_faulted_property_geomodels-524"><a href="#-524"><span class="linenos">524</span></a>            <span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>
</span><span id="Faults.build_faulted_property_geomodels-525"><a href="#-525"><span class="linenos">525</span></a>
</span><span id="Faults.build_faulted_property_geomodels-526"><a href="#-526"><span class="linenos">526</span></a>            <span class="n">line_number</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span>
</span><span id="Faults.build_faulted_property_geomodels-527"><a href="#-527"><span class="linenos">527</span></a>                <span class="n">work_cube_lith</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span>
</span><span id="Faults.build_faulted_property_geomodels-528"><a href="#-528"><span class="linenos">528</span></a>            <span class="p">)</span>  <span class="c1"># pick centre line for all plots</span>
</span><span id="Faults.build_faulted_property_geomodels-529"><a href="#-529"><span class="linenos">529</span></a>
</span><span id="Faults.build_faulted_property_geomodels-530"><a href="#-530"><span class="linenos">530</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">include_salt</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">work_cube_lith</span><span class="p">[</span><span class="n">line_number</span><span class="p">,</span> <span class="o">...</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Faults.build_faulted_property_geomodels-531"><a href="#-531"><span class="linenos">531</span></a>                <span class="n">lith_cmap</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">ListedColormap</span><span class="p">(</span>
</span><span id="Faults.build_faulted_property_geomodels-532"><a href="#-532"><span class="linenos">532</span></a>                    <span class="p">[</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="s2">&quot;saddlebrown&quot;</span><span class="p">,</span> <span class="s2">&quot;gold&quot;</span><span class="p">,</span> <span class="s2">&quot;grey&quot;</span><span class="p">]</span>
</span><span id="Faults.build_faulted_property_geomodels-533"><a href="#-533"><span class="linenos">533</span></a>                <span class="p">)</span>
</span><span id="Faults.build_faulted_property_geomodels-534"><a href="#-534"><span class="linenos">534</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Faults.build_faulted_property_geomodels-535"><a href="#-535"><span class="linenos">535</span></a>                <span class="n">lith_cmap</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">ListedColormap</span><span class="p">([</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="s2">&quot;saddlebrown&quot;</span><span class="p">,</span> <span class="s2">&quot;gold&quot;</span><span class="p">])</span>
</span><span id="Faults.build_faulted_property_geomodels-536"><a href="#-536"><span class="linenos">536</span></a>            <span class="n">plot_xsection</span><span class="p">(</span>
</span><span id="Faults.build_faulted_property_geomodels-537"><a href="#-537"><span class="linenos">537</span></a>                <span class="n">work_cube_lith</span><span class="p">,</span>
</span><span id="Faults.build_faulted_property_geomodels-538"><a href="#-538"><span class="linenos">538</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">faulted_depth_maps</span><span class="p">[:],</span>
</span><span id="Faults.build_faulted_property_geomodels-539"><a href="#-539"><span class="linenos">539</span></a>                <span class="n">line_num</span><span class="o">=</span><span class="n">line_number</span><span class="p">,</span>
</span><span id="Faults.build_faulted_property_geomodels-540"><a href="#-540"><span class="linenos">540</span></a>                <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Example Trav through 3D model</span><span class="se">\n</span><span class="s2">Lithology&quot;</span><span class="p">,</span>
</span><span id="Faults.build_faulted_property_geomodels-541"><a href="#-541"><span class="linenos">541</span></a>                <span class="n">png_name</span><span class="o">=</span><span class="s2">&quot;QC_plot__AfterFaulting_lithology.png&quot;</span><span class="p">,</span>
</span><span id="Faults.build_faulted_property_geomodels-542"><a href="#-542"><span class="linenos">542</span></a>                <span class="n">cfg</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="p">,</span>
</span><span id="Faults.build_faulted_property_geomodels-543"><a href="#-543"><span class="linenos">543</span></a>                <span class="n">cmap</span><span class="o">=</span><span class="n">lith_cmap</span><span class="p">,</span>
</span><span id="Faults.build_faulted_property_geomodels-544"><a href="#-544"><span class="linenos">544</span></a>            <span class="p">)</span>
</span><span id="Faults.build_faulted_property_geomodels-545"><a href="#-545"><span class="linenos">545</span></a>            <span class="n">plot_xsection</span><span class="p">(</span>
</span><span id="Faults.build_faulted_property_geomodels-546"><a href="#-546"><span class="linenos">546</span></a>                <span class="n">work_cube_depth</span><span class="p">,</span>
</span><span id="Faults.build_faulted_property_geomodels-547"><a href="#-547"><span class="linenos">547</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">faulted_depth_maps</span><span class="p">,</span>
</span><span id="Faults.build_faulted_property_geomodels-548"><a href="#-548"><span class="linenos">548</span></a>                <span class="n">line_num</span><span class="o">=</span><span class="n">line_number</span><span class="p">,</span>
</span><span id="Faults.build_faulted_property_geomodels-549"><a href="#-549"><span class="linenos">549</span></a>                <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Example Trav through 3D model</span><span class="se">\n</span><span class="s2">Depth Below Mudline&quot;</span><span class="p">,</span>
</span><span id="Faults.build_faulted_property_geomodels-550"><a href="#-550"><span class="linenos">550</span></a>                <span class="n">png_name</span><span class="o">=</span><span class="s2">&quot;QC_plot__AfterFaulting_depth_bml.png&quot;</span><span class="p">,</span>
</span><span id="Faults.build_faulted_property_geomodels-551"><a href="#-551"><span class="linenos">551</span></a>                <span class="n">cfg</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="p">,</span>
</span><span id="Faults.build_faulted_property_geomodels-552"><a href="#-552"><span class="linenos">552</span></a>                <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;cubehelix_r&quot;</span><span class="p">,</span>
</span><span id="Faults.build_faulted_property_geomodels-553"><a href="#-553"><span class="linenos">553</span></a>            <span class="p">)</span>
</span><span id="Faults.build_faulted_property_geomodels-554"><a href="#-554"><span class="linenos">554</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">faulted_lithology</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">work_cube_lith</span>
</span><span id="Faults.build_faulted_property_geomodels-555"><a href="#-555"><span class="linenos">555</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">faulted_net_to_gross</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">work_cube_net_to_gross</span>
</span><span id="Faults.build_faulted_property_geomodels-556"><a href="#-556"><span class="linenos">556</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">faulted_depth</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">work_cube_depth</span>
</span><span id="Faults.build_faulted_property_geomodels-557"><a href="#-557"><span class="linenos">557</span></a>        <span class="c1"># self.randomised_depth[:] = randomised_depth</span>
</span><span id="Faults.build_faulted_property_geomodels-558"><a href="#-558"><span class="linenos">558</span></a>
</span><span id="Faults.build_faulted_property_geomodels-559"><a href="#-559"><span class="linenos">559</span></a>        <span class="c1"># Write the % sand in model to logfile</span>
</span><span id="Faults.build_faulted_property_geomodels-560"><a href="#-560"><span class="linenos">560</span></a>        <span class="n">sand_fraction</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="Faults.build_faulted_property_geomodels-561"><a href="#-561"><span class="linenos">561</span></a>            <span class="n">work_cube_lith</span><span class="p">[</span><span class="n">work_cube_lith</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="Faults.build_faulted_property_geomodels-562"><a href="#-562"><span class="linenos">562</span></a>            <span class="o">/</span> <span class="n">work_cube_lith</span><span class="p">[</span><span class="n">work_cube_lith</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="Faults.build_faulted_property_geomodels-563"><a href="#-563"><span class="linenos">563</span></a>        <span class="p">)</span>
</span><span id="Faults.build_faulted_property_geomodels-564"><a href="#-564"><span class="linenos">564</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="Faults.build_faulted_property_geomodels-565"><a href="#-565"><span class="linenos">565</span></a>            <span class="sa">f</span><span class="s2">&quot;Sand voxel % in model </span><span class="si">{</span><span class="mi">100</span> <span class="o">*</span> <span class="n">sand_fraction</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">,</span>
</span><span id="Faults.build_faulted_property_geomodels-566"><a href="#-566"><span class="linenos">566</span></a>            <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span>
</span><span id="Faults.build_faulted_property_geomodels-567"><a href="#-567"><span class="linenos">567</span></a>            <span class="n">subkey</span><span class="o">=</span><span class="s2">&quot;sand_voxel_pct&quot;</span><span class="p">,</span>
</span><span id="Faults.build_faulted_property_geomodels-568"><a href="#-568"><span class="linenos">568</span></a>            <span class="n">val</span><span class="o">=</span><span class="mi">100</span> <span class="o">*</span> <span class="n">sand_fraction</span><span class="p">,</span>
</span><span id="Faults.build_faulted_property_geomodels-569"><a href="#-569"><span class="linenos">569</span></a>        <span class="p">)</span>
</span><span id="Faults.build_faulted_property_geomodels-570"><a href="#-570"><span class="linenos">570</span></a>
</span><span id="Faults.build_faulted_property_geomodels-571"><a href="#-571"><span class="linenos">571</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_store</span><span class="p">:</span>
</span><span id="Faults.build_faulted_property_geomodels-572"><a href="#-572"><span class="linenos">572</span></a>            <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
</span><span id="Faults.build_faulted_property_geomodels-573"><a href="#-573"><span class="linenos">573</span></a>                <span class="p">[</span><span class="s2">&quot;lithology&quot;</span><span class="p">,</span> <span class="s2">&quot;net_to_gross&quot;</span><span class="p">,</span> <span class="s2">&quot;depth&quot;</span><span class="p">],</span>
</span><span id="Faults.build_faulted_property_geomodels-574"><a href="#-574"><span class="linenos">574</span></a>                <span class="p">[</span>
</span><span id="Faults.build_faulted_property_geomodels-575"><a href="#-575"><span class="linenos">575</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">faulted_lithology</span><span class="p">[:],</span>
</span><span id="Faults.build_faulted_property_geomodels-576"><a href="#-576"><span class="linenos">576</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">faulted_net_to_gross</span><span class="p">[:],</span>
</span><span id="Faults.build_faulted_property_geomodels-577"><a href="#-577"><span class="linenos">577</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">faulted_depth</span><span class="p">[:],</span>
</span><span id="Faults.build_faulted_property_geomodels-578"><a href="#-578"><span class="linenos">578</span></a>                <span class="p">],</span>
</span><span id="Faults.build_faulted_property_geomodels-579"><a href="#-579"><span class="linenos">579</span></a>            <span class="p">):</span>
</span><span id="Faults.build_faulted_property_geomodels-580"><a href="#-580"><span class="linenos">580</span></a>                <span class="n">write_data_to_hdf</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_master</span><span class="p">)</span>
</span><span id="Faults.build_faulted_property_geomodels-581"><a href="#-581"><span class="linenos">581</span></a>
</span><span id="Faults.build_faulted_property_geomodels-582"><a href="#-582"><span class="linenos">582</span></a>        <span class="c1"># Save out reservoir volume for XAI-NBDT</span>
</span><span id="Faults.build_faulted_property_geomodels-583"><a href="#-583"><span class="linenos">583</span></a>        <span class="n">reservoir</span> <span class="o">=</span> <span class="p">(</span><span class="n">work_cube_lith</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1.0</span>
</span><span id="Faults.build_faulted_property_geomodels-584"><a href="#-584"><span class="linenos">584</span></a>        <span class="n">reservoir_dilated</span> <span class="o">=</span> <span class="n">binary_dilation</span><span class="p">(</span><span class="n">reservoir</span><span class="p">)</span>
</span><span id="Faults.build_faulted_property_geomodels-585"><a href="#-585"><span class="linenos">585</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">reservoir</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">reservoir_dilated</span>
</span><span id="Faults.build_faulted_property_geomodels-586"><a href="#-586"><span class="linenos">586</span></a>
</span><span id="Faults.build_faulted_property_geomodels-587"><a href="#-587"><span class="linenos">587</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">model_qc_volumes</span><span class="p">:</span>
</span><span id="Faults.build_faulted_property_geomodels-588"><a href="#-588"><span class="linenos">588</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">write_cube_to_disk</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faulted_lithology</span><span class="p">[:],</span> <span class="s2">&quot;faulted_lithology&quot;</span><span class="p">)</span>
</span><span id="Faults.build_faulted_property_geomodels-589"><a href="#-589"><span class="linenos">589</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">write_cube_to_disk</span><span class="p">(</span>
</span><span id="Faults.build_faulted_property_geomodels-590"><a href="#-590"><span class="linenos">590</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">faulted_net_to_gross</span><span class="p">[:],</span> <span class="s2">&quot;faulted_net_to_gross&quot;</span>
</span><span id="Faults.build_faulted_property_geomodels-591"><a href="#-591"><span class="linenos">591</span></a>            <span class="p">)</span>
</span><span id="Faults.build_faulted_property_geomodels-592"><a href="#-592"><span class="linenos">592</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">write_cube_to_disk</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faulted_depth</span><span class="p">[:],</span> <span class="s2">&quot;faulted_depth&quot;</span><span class="p">)</span>
</span><span id="Faults.build_faulted_property_geomodels-593"><a href="#-593"><span class="linenos">593</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">write_cube_to_disk</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faulted_age_volume</span><span class="p">[:],</span> <span class="s2">&quot;faulted_age&quot;</span><span class="p">)</span>
</span><span id="Faults.build_faulted_property_geomodels-594"><a href="#-594"><span class="linenos">594</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">include_salt</span><span class="p">:</span>
</span><span id="Faults.build_faulted_property_geomodels-595"><a href="#-595"><span class="linenos">595</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">write_cube_to_disk</span><span class="p">(</span>
</span><span id="Faults.build_faulted_property_geomodels-596"><a href="#-596"><span class="linenos">596</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">salt_model</span><span class="o">.</span><span class="n">salt_segments</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span>
</span><span id="Faults.build_faulted_property_geomodels-597"><a href="#-597"><span class="linenos">597</span></a>                        <span class="s2">&quot;uint8&quot;</span>
</span><span id="Faults.build_faulted_property_geomodels-598"><a href="#-598"><span class="linenos">598</span></a>                    <span class="p">),</span>
</span><span id="Faults.build_faulted_property_geomodels-599"><a href="#-599"><span class="linenos">599</span></a>                    <span class="s2">&quot;salt&quot;</span><span class="p">,</span>
</span><span id="Faults.build_faulted_property_geomodels-600"><a href="#-600"><span class="linenos">600</span></a>                <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><h6 id="build-faulted-property-geomodels">Build Faulted Property Geomodels</h6>

<p>Generates faulted property geomodels.</p>

<p><strong>The method does the following:</strong></p>

<p>Use faulted geologic_age cube, depth_maps and facies
to create geomodel properties (depth, lith)</p>

<ul>
<li>lithology</li>
<li>net_to_gross (to create effective sand layers)</li>
<li>depth below mudline</li>
<li>randomised depth below mudline (to 
randomise the rock properties per layer)</li>
</ul>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>facies</strong> (np.ndarray):
The Horizons class used to build the faults.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>None</strong></li>
</ul>
</div>


                            </div>
                            <div id="Faults.create_qc_plots" class="classattr">
                                        <input id="Faults.create_qc_plots-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">create_qc_plots</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="Faults.create_qc_plots-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Faults.create_qc_plots"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Faults.create_qc_plots-602"><a href="#-602"><span class="linenos">602</span></a>    <span class="k">def</span> <span class="nf">create_qc_plots</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Faults.create_qc_plots-603"><a href="#-603"><span class="linenos">603</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="Faults.create_qc_plots-604"><a href="#-604"><span class="linenos">604</span></a><span class="sd">        Create QC Plots</span>
</span><span id="Faults.create_qc_plots-605"><a href="#-605"><span class="linenos">605</span></a><span class="sd">        ---------------</span>
</span><span id="Faults.create_qc_plots-606"><a href="#-606"><span class="linenos">606</span></a><span class="sd">        Creates QC Plots of faulted models and histograms of</span>
</span><span id="Faults.create_qc_plots-607"><a href="#-607"><span class="linenos">607</span></a><span class="sd">        voxels which are not in layers.</span>
</span><span id="Faults.create_qc_plots-608"><a href="#-608"><span class="linenos">608</span></a>
</span><span id="Faults.create_qc_plots-609"><a href="#-609"><span class="linenos">609</span></a><span class="sd">        Parameters</span>
</span><span id="Faults.create_qc_plots-610"><a href="#-610"><span class="linenos">610</span></a><span class="sd">        ----------</span>
</span><span id="Faults.create_qc_plots-611"><a href="#-611"><span class="linenos">611</span></a><span class="sd">        None</span>
</span><span id="Faults.create_qc_plots-612"><a href="#-612"><span class="linenos">612</span></a>
</span><span id="Faults.create_qc_plots-613"><a href="#-613"><span class="linenos">613</span></a><span class="sd">        Returns</span>
</span><span id="Faults.create_qc_plots-614"><a href="#-614"><span class="linenos">614</span></a><span class="sd">        -------</span>
</span><span id="Faults.create_qc_plots-615"><a href="#-615"><span class="linenos">615</span></a><span class="sd">        None</span>
</span><span id="Faults.create_qc_plots-616"><a href="#-616"><span class="linenos">616</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Faults.create_qc_plots-617"><a href="#-617"><span class="linenos">617</span></a>        <span class="kn">from</span> <span class="nn">datagenerator.util</span> <span class="kn">import</span> <span class="p">(</span>
</span><span id="Faults.create_qc_plots-618"><a href="#-618"><span class="linenos">618</span></a>            <span class="n">find_line_with_most_voxels</span><span class="p">,</span>
</span><span id="Faults.create_qc_plots-619"><a href="#-619"><span class="linenos">619</span></a>            <span class="n">plot_voxels_not_in_regular_layers</span><span class="p">,</span>
</span><span id="Faults.create_qc_plots-620"><a href="#-620"><span class="linenos">620</span></a>            <span class="n">plot_xsection</span><span class="p">,</span>
</span><span id="Faults.create_qc_plots-621"><a href="#-621"><span class="linenos">621</span></a>        <span class="p">)</span>
</span><span id="Faults.create_qc_plots-622"><a href="#-622"><span class="linenos">622</span></a>
</span><span id="Faults.create_qc_plots-623"><a href="#-623"><span class="linenos">623</span></a>        <span class="c1"># analyze voxel values not in regular layers</span>
</span><span id="Faults.create_qc_plots-624"><a href="#-624"><span class="linenos">624</span></a>        <span class="n">plot_voxels_not_in_regular_layers</span><span class="p">(</span>
</span><span id="Faults.create_qc_plots-625"><a href="#-625"><span class="linenos">625</span></a>            <span class="n">volume</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">faulted_age_volume</span><span class="p">[:],</span>
</span><span id="Faults.create_qc_plots-626"><a href="#-626"><span class="linenos">626</span></a>            <span class="n">threshold</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
</span><span id="Faults.create_qc_plots-627"><a href="#-627"><span class="linenos">627</span></a>            <span class="n">cfg</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="p">,</span>
</span><span id="Faults.create_qc_plots-628"><a href="#-628"><span class="linenos">628</span></a>            <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Example Trav through 3D model</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="Faults.create_qc_plots-629"><a href="#-629"><span class="linenos">629</span></a>            <span class="o">+</span> <span class="s2">&quot;histogram of layers after faulting, before inserting channel facies&quot;</span><span class="p">,</span>
</span><span id="Faults.create_qc_plots-630"><a href="#-630"><span class="linenos">630</span></a>            <span class="n">png_name</span><span class="o">=</span><span class="s2">&quot;QC_plot__Channels__histogram_FaultedLayersNoChannels.png&quot;</span><span class="p">,</span>
</span><span id="Faults.create_qc_plots-631"><a href="#-631"><span class="linenos">631</span></a>        <span class="p">)</span>
</span><span id="Faults.create_qc_plots-632"><a href="#-632"><span class="linenos">632</span></a>        <span class="k">try</span><span class="p">:</span>  <span class="c1"># if channel_segments exists</span>
</span><span id="Faults.create_qc_plots-633"><a href="#-633"><span class="linenos">633</span></a>            <span class="n">inline_index_channels</span> <span class="o">=</span> <span class="n">find_line_with_most_voxels</span><span class="p">(</span>
</span><span id="Faults.create_qc_plots-634"><a href="#-634"><span class="linenos">634</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">channel_segments</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span>
</span><span id="Faults.create_qc_plots-635"><a href="#-635"><span class="linenos">635</span></a>            <span class="p">)</span>
</span><span id="Faults.create_qc_plots-636"><a href="#-636"><span class="linenos">636</span></a>            <span class="n">plot_xsection</span><span class="p">(</span>
</span><span id="Faults.create_qc_plots-637"><a href="#-637"><span class="linenos">637</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">channel_segments</span><span class="p">,</span>
</span><span id="Faults.create_qc_plots-638"><a href="#-638"><span class="linenos">638</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">faulted_depth_maps</span><span class="p">,</span>
</span><span id="Faults.create_qc_plots-639"><a href="#-639"><span class="linenos">639</span></a>                <span class="n">inline_index_channels</span><span class="p">,</span>
</span><span id="Faults.create_qc_plots-640"><a href="#-640"><span class="linenos">640</span></a>                <span class="n">cfg</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="p">,</span>
</span><span id="Faults.create_qc_plots-641"><a href="#-641"><span class="linenos">641</span></a>                <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Example Trav through 3D model</span><span class="se">\n</span><span class="s2">channel_segments after faulting&quot;</span><span class="p">,</span>
</span><span id="Faults.create_qc_plots-642"><a href="#-642"><span class="linenos">642</span></a>                <span class="n">png_name</span><span class="o">=</span><span class="s2">&quot;QC_plot__AfterFaulting_channel_segments.png&quot;</span><span class="p">,</span>
</span><span id="Faults.create_qc_plots-643"><a href="#-643"><span class="linenos">643</span></a>            <span class="p">)</span>
</span><span id="Faults.create_qc_plots-644"><a href="#-644"><span class="linenos">644</span></a>            <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Example Trav through 3D model</span><span class="se">\n</span><span class="s2">Layers Filled With Layer Number / ChannelsAdded / Faulted&quot;</span>
</span><span id="Faults.create_qc_plots-645"><a href="#-645"><span class="linenos">645</span></a>            <span class="n">png_name</span> <span class="o">=</span> <span class="s2">&quot;QC_plot__LayersFilledWithLayerNumber_ChannelsAdded_Faulted.png&quot;</span>
</span><span id="Faults.create_qc_plots-646"><a href="#-646"><span class="linenos">646</span></a>        <span class="k">except</span> <span class="p">(</span><span class="ne">NameError</span><span class="p">,</span> <span class="ne">AttributeError</span><span class="p">):</span>  <span class="c1"># channel_segments does not exist</span>
</span><span id="Faults.create_qc_plots-647"><a href="#-647"><span class="linenos">647</span></a>            <span class="n">inline_index_channels</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faulted_age_volume</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="Faults.create_qc_plots-648"><a href="#-648"><span class="linenos">648</span></a>            <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Example Trav through 3D model</span><span class="se">\n</span><span class="s2">Layers Filled With Layer Number / Faulted&quot;</span>
</span><span id="Faults.create_qc_plots-649"><a href="#-649"><span class="linenos">649</span></a>            <span class="n">png_name</span> <span class="o">=</span> <span class="s2">&quot;QC_plot__LayersFilledWithLayerNumber_Faulted.png&quot;</span>
</span><span id="Faults.create_qc_plots-650"><a href="#-650"><span class="linenos">650</span></a>        <span class="n">plot_xsection</span><span class="p">(</span>
</span><span id="Faults.create_qc_plots-651"><a href="#-651"><span class="linenos">651</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">faulted_age_volume</span><span class="p">[:],</span>
</span><span id="Faults.create_qc_plots-652"><a href="#-652"><span class="linenos">652</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">faulted_depth_maps</span><span class="p">[:],</span>
</span><span id="Faults.create_qc_plots-653"><a href="#-653"><span class="linenos">653</span></a>            <span class="n">inline_index_channels</span><span class="p">,</span>
</span><span id="Faults.create_qc_plots-654"><a href="#-654"><span class="linenos">654</span></a>            <span class="n">title</span><span class="p">,</span>
</span><span id="Faults.create_qc_plots-655"><a href="#-655"><span class="linenos">655</span></a>            <span class="n">png_name</span><span class="p">,</span>
</span><span id="Faults.create_qc_plots-656"><a href="#-656"><span class="linenos">656</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="p">,</span>
</span><span id="Faults.create_qc_plots-657"><a href="#-657"><span class="linenos">657</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><h6 id="create-qc-plots">Create QC Plots</h6>

<p>Creates QC Plots of faulted models and histograms of
voxels which are not in layers.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>None</strong></li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>None</strong></li>
</ul>
</div>


                            </div>
                            <div id="Faults.generate_faults" class="classattr">
                                        <input id="Faults.generate_faults-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">generate_faults</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span>:</span></span>

                <label class="view-source-button" for="Faults.generate_faults-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Faults.generate_faults"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Faults.generate_faults-659"><a href="#-659"><span class="linenos">659</span></a>    <span class="k">def</span> <span class="nf">generate_faults</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="Faults.generate_faults-660"><a href="#-660"><span class="linenos">660</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="Faults.generate_faults-661"><a href="#-661"><span class="linenos">661</span></a><span class="sd">        Generate Faults</span>
</span><span id="Faults.generate_faults-662"><a href="#-662"><span class="linenos">662</span></a><span class="sd">        ---------------</span>
</span><span id="Faults.generate_faults-663"><a href="#-663"><span class="linenos">663</span></a><span class="sd">        Generates faults in the model.</span>
</span><span id="Faults.generate_faults-664"><a href="#-664"><span class="linenos">664</span></a>
</span><span id="Faults.generate_faults-665"><a href="#-665"><span class="linenos">665</span></a><span class="sd">        Parameters</span>
</span><span id="Faults.generate_faults-666"><a href="#-666"><span class="linenos">666</span></a><span class="sd">        ----------</span>
</span><span id="Faults.generate_faults-667"><a href="#-667"><span class="linenos">667</span></a><span class="sd">        None</span>
</span><span id="Faults.generate_faults-668"><a href="#-668"><span class="linenos">668</span></a>
</span><span id="Faults.generate_faults-669"><a href="#-669"><span class="linenos">669</span></a><span class="sd">        Returns</span>
</span><span id="Faults.generate_faults-670"><a href="#-670"><span class="linenos">670</span></a><span class="sd">        -------</span>
</span><span id="Faults.generate_faults-671"><a href="#-671"><span class="linenos">671</span></a><span class="sd">        displacements_classification : np.ndarray</span>
</span><span id="Faults.generate_faults-672"><a href="#-672"><span class="linenos">672</span></a><span class="sd">            Array of fault displacement classifications</span>
</span><span id="Faults.generate_faults-673"><a href="#-673"><span class="linenos">673</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Faults.generate_faults-674"><a href="#-674"><span class="linenos">674</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Faults.generate_faults-675"><a href="#-675"><span class="linenos">675</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; ... create </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">number_faults</span><span class="si">}</span><span class="s2"> faults&quot;</span><span class="p">)</span>
</span><span id="Faults.generate_faults-676"><a href="#-676"><span class="linenos">676</span></a>        <span class="n">fault_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fault_parameters</span><span class="p">()</span>
</span><span id="Faults.generate_faults-677"><a href="#-677"><span class="linenos">677</span></a>
</span><span id="Faults.generate_faults-678"><a href="#-678"><span class="linenos">678</span></a>        <span class="c1"># Write fault parameters to logfile</span>
</span><span id="Faults.generate_faults-679"><a href="#-679"><span class="linenos">679</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="Faults.generate_faults-680"><a href="#-680"><span class="linenos">680</span></a>            <span class="sa">f</span><span class="s2">&quot;Fault_mode: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">fmode</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="Faults.generate_faults-681"><a href="#-681"><span class="linenos">681</span></a>            <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span>
</span><span id="Faults.generate_faults-682"><a href="#-682"><span class="linenos">682</span></a>            <span class="n">subkey</span><span class="o">=</span><span class="s2">&quot;fault_mode&quot;</span><span class="p">,</span>
</span><span id="Faults.generate_faults-683"><a href="#-683"><span class="linenos">683</span></a>            <span class="n">val</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">fmode</span><span class="p">,</span>
</span><span id="Faults.generate_faults-684"><a href="#-684"><span class="linenos">684</span></a>        <span class="p">)</span>
</span><span id="Faults.generate_faults-685"><a href="#-685"><span class="linenos">685</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="Faults.generate_faults-686"><a href="#-686"><span class="linenos">686</span></a>            <span class="sa">f</span><span class="s2">&quot;Noise_level: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">fnoise</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="Faults.generate_faults-687"><a href="#-687"><span class="linenos">687</span></a>            <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span>
</span><span id="Faults.generate_faults-688"><a href="#-688"><span class="linenos">688</span></a>            <span class="n">subkey</span><span class="o">=</span><span class="s2">&quot;noise_level&quot;</span><span class="p">,</span>
</span><span id="Faults.generate_faults-689"><a href="#-689"><span class="linenos">689</span></a>            <span class="n">val</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">fnoise</span><span class="p">,</span>
</span><span id="Faults.generate_faults-690"><a href="#-690"><span class="linenos">690</span></a>        <span class="p">)</span>
</span><span id="Faults.generate_faults-691"><a href="#-691"><span class="linenos">691</span></a>
</span><span id="Faults.generate_faults-692"><a href="#-692"><span class="linenos">692</span></a>        <span class="c1"># Build faults, and sum displacements</span>
</span><span id="Faults.generate_faults-693"><a href="#-693"><span class="linenos">693</span></a>        <span class="n">displacements_classification</span><span class="p">,</span> <span class="n">hockeys</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">build_faults</span><span class="p">(</span><span class="n">fault_params</span><span class="p">)</span>
</span><span id="Faults.generate_faults-694"><a href="#-694"><span class="linenos">694</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">model_qc_volumes</span><span class="p">:</span>
</span><span id="Faults.generate_faults-695"><a href="#-695"><span class="linenos">695</span></a>            <span class="c1"># Write max fault throw cube to disk</span>
</span><span id="Faults.generate_faults-696"><a href="#-696"><span class="linenos">696</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">write_cube_to_disk</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_fault_throw</span><span class="p">[:],</span> <span class="s2">&quot;max_fault_throw&quot;</span><span class="p">)</span>
</span><span id="Faults.generate_faults-697"><a href="#-697"><span class="linenos">697</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="Faults.generate_faults-698"><a href="#-698"><span class="linenos">698</span></a>            <span class="sa">f</span><span class="s2">&quot;Hockey_Sticks generated: </span><span class="si">{</span><span class="nb">sum</span><span class="p">(</span><span class="n">hockeys</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="Faults.generate_faults-699"><a href="#-699"><span class="linenos">699</span></a>            <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span>
</span><span id="Faults.generate_faults-700"><a href="#-700"><span class="linenos">700</span></a>            <span class="n">subkey</span><span class="o">=</span><span class="s2">&quot;hockey_sticks_generated&quot;</span><span class="p">,</span>
</span><span id="Faults.generate_faults-701"><a href="#-701"><span class="linenos">701</span></a>            <span class="n">val</span><span class="o">=</span><span class="nb">sum</span><span class="p">(</span><span class="n">hockeys</span><span class="p">),</span>
</span><span id="Faults.generate_faults-702"><a href="#-702"><span class="linenos">702</span></a>        <span class="p">)</span>
</span><span id="Faults.generate_faults-703"><a href="#-703"><span class="linenos">703</span></a>
</span><span id="Faults.generate_faults-704"><a href="#-704"><span class="linenos">704</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="Faults.generate_faults-705"><a href="#-705"><span class="linenos">705</span></a>            <span class="sa">f</span><span class="s2">&quot;Fault Info: a, b, c, x0, y0, z0, throw/infill_factor, shear_zone_width,&quot;</span>
</span><span id="Faults.generate_faults-706"><a href="#-706"><span class="linenos">706</span></a>            <span class="s2">&quot; gouge_pctile, tilt_pct*100&quot;</span>
</span><span id="Faults.generate_faults-707"><a href="#-707"><span class="linenos">707</span></a>        <span class="p">)</span>
</span><span id="Faults.generate_faults-708"><a href="#-708"><span class="linenos">708</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">number_faults</span><span class="p">):</span>
</span><span id="Faults.generate_faults-709"><a href="#-709"><span class="linenos">709</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="Faults.generate_faults-710"><a href="#-710"><span class="linenos">710</span></a>                <span class="sa">f</span><span class="s2">&quot;Fault_</span><span class="si">{</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">fault_params</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">fault_params</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">fault_params</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">,&quot;</span>
</span><span id="Faults.generate_faults-711"><a href="#-711"><span class="linenos">711</span></a>                <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">fault_params</span><span class="p">[</span><span class="s1">&#39;x0&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="si">:</span><span class="s2">&gt;7.2f</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">fault_params</span><span class="p">[</span><span class="s1">&#39;y0&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="si">:</span><span class="s2">&gt;7.2f</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">fault_params</span><span class="p">[</span><span class="s1">&#39;z0&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="si">:</span><span class="s2">&gt;8.2f</span><span class="si">}</span><span class="s2">,&quot;</span>
</span><span id="Faults.generate_faults-712"><a href="#-712"><span class="linenos">712</span></a>                <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">fault_params</span><span class="p">[</span><span class="s1">&#39;throw&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">infill_factor</span><span class="si">:</span><span class="s2">&gt;6.2f</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">fault_params</span><span class="p">[</span><span class="s1">&#39;tilt_pct&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="mi">100</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Faults.generate_faults-713"><a href="#-713"><span class="linenos">713</span></a>            <span class="p">)</span>
</span><span id="Faults.generate_faults-714"><a href="#-714"><span class="linenos">714</span></a>
</span><span id="Faults.generate_faults-715"><a href="#-715"><span class="linenos">715</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="Faults.generate_faults-716"><a href="#-716"><span class="linenos">716</span></a>                <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="Faults.generate_faults-717"><a href="#-717"><span class="linenos">717</span></a>                <span class="n">mainkey</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;fault_</span><span class="si">{</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="Faults.generate_faults-718"><a href="#-718"><span class="linenos">718</span></a>                <span class="n">subkey</span><span class="o">=</span><span class="s2">&quot;model_id&quot;</span><span class="p">,</span>
</span><span id="Faults.generate_faults-719"><a href="#-719"><span class="linenos">719</span></a>                <span class="n">val</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">work_subfolder</span><span class="p">),</span>
</span><span id="Faults.generate_faults-720"><a href="#-720"><span class="linenos">720</span></a>            <span class="p">)</span>
</span><span id="Faults.generate_faults-721"><a href="#-721"><span class="linenos">721</span></a>            <span class="k">for</span> <span class="n">_subkey_name</span> <span class="ow">in</span> <span class="p">[</span>
</span><span id="Faults.generate_faults-722"><a href="#-722"><span class="linenos">722</span></a>                <span class="s2">&quot;a&quot;</span><span class="p">,</span>
</span><span id="Faults.generate_faults-723"><a href="#-723"><span class="linenos">723</span></a>                <span class="s2">&quot;b&quot;</span><span class="p">,</span>
</span><span id="Faults.generate_faults-724"><a href="#-724"><span class="linenos">724</span></a>                <span class="s2">&quot;c&quot;</span><span class="p">,</span>
</span><span id="Faults.generate_faults-725"><a href="#-725"><span class="linenos">725</span></a>                <span class="s2">&quot;x0&quot;</span><span class="p">,</span>
</span><span id="Faults.generate_faults-726"><a href="#-726"><span class="linenos">726</span></a>                <span class="s2">&quot;y0&quot;</span><span class="p">,</span>
</span><span id="Faults.generate_faults-727"><a href="#-727"><span class="linenos">727</span></a>                <span class="s2">&quot;z0&quot;</span><span class="p">,</span>
</span><span id="Faults.generate_faults-728"><a href="#-728"><span class="linenos">728</span></a>                <span class="s2">&quot;throw&quot;</span><span class="p">,</span>
</span><span id="Faults.generate_faults-729"><a href="#-729"><span class="linenos">729</span></a>                <span class="s2">&quot;tilt_pct&quot;</span><span class="p">,</span>
</span><span id="Faults.generate_faults-730"><a href="#-730"><span class="linenos">730</span></a>                <span class="s2">&quot;shear_zone_width&quot;</span><span class="p">,</span>
</span><span id="Faults.generate_faults-731"><a href="#-731"><span class="linenos">731</span></a>                <span class="s2">&quot;gouge_pctile&quot;</span><span class="p">,</span>
</span><span id="Faults.generate_faults-732"><a href="#-732"><span class="linenos">732</span></a>            <span class="p">]:</span>
</span><span id="Faults.generate_faults-733"><a href="#-733"><span class="linenos">733</span></a>                <span class="n">_val</span> <span class="o">=</span> <span class="n">fault_params</span><span class="p">[</span><span class="n">_subkey_name</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
</span><span id="Faults.generate_faults-734"><a href="#-734"><span class="linenos">734</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="Faults.generate_faults-735"><a href="#-735"><span class="linenos">735</span></a>                    <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mainkey</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;fault_</span><span class="si">{</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">subkey</span><span class="o">=</span><span class="n">_subkey_name</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">_val</span>
</span><span id="Faults.generate_faults-736"><a href="#-736"><span class="linenos">736</span></a>                <span class="p">)</span>
</span><span id="Faults.generate_faults-737"><a href="#-737"><span class="linenos">737</span></a>
</span><span id="Faults.generate_faults-738"><a href="#-738"><span class="linenos">738</span></a>        <span class="k">return</span> <span class="n">displacements_classification</span>
</span></pre></div>


            <div class="docstring"><h6 id="generate-faults">Generate Faults</h6>

<p>Generates faults in the model.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>None</strong></li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>displacements_classification</strong> (np.ndarray):
Array of fault displacement classifications</li>
</ul>
</div>


                            </div>
                            <div id="Faults.fault_parameters" class="classattr">
                                        <input id="Faults.fault_parameters-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">fault_parameters</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Faults.fault_parameters-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Faults.fault_parameters"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Faults.fault_parameters-740"><a href="#-740"><span class="linenos">740</span></a>    <span class="k">def</span> <span class="nf">fault_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Faults.fault_parameters-741"><a href="#-741"><span class="linenos">741</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="Faults.fault_parameters-742"><a href="#-742"><span class="linenos">742</span></a><span class="sd">        Get Fault Parameters</span>
</span><span id="Faults.fault_parameters-743"><a href="#-743"><span class="linenos">743</span></a><span class="sd">        ---------------</span>
</span><span id="Faults.fault_parameters-744"><a href="#-744"><span class="linenos">744</span></a><span class="sd">        Returns the fault parameters.</span>
</span><span id="Faults.fault_parameters-745"><a href="#-745"><span class="linenos">745</span></a>
</span><span id="Faults.fault_parameters-746"><a href="#-746"><span class="linenos">746</span></a><span class="sd">        Factory design pattern used to select fault parameters</span>
</span><span id="Faults.fault_parameters-747"><a href="#-747"><span class="linenos">747</span></a>
</span><span id="Faults.fault_parameters-748"><a href="#-748"><span class="linenos">748</span></a><span class="sd">        Parameters</span>
</span><span id="Faults.fault_parameters-749"><a href="#-749"><span class="linenos">749</span></a><span class="sd">        ----------</span>
</span><span id="Faults.fault_parameters-750"><a href="#-750"><span class="linenos">750</span></a><span class="sd">        None</span>
</span><span id="Faults.fault_parameters-751"><a href="#-751"><span class="linenos">751</span></a>
</span><span id="Faults.fault_parameters-752"><a href="#-752"><span class="linenos">752</span></a><span class="sd">        Returns</span>
</span><span id="Faults.fault_parameters-753"><a href="#-753"><span class="linenos">753</span></a><span class="sd">        -------</span>
</span><span id="Faults.fault_parameters-754"><a href="#-754"><span class="linenos">754</span></a><span class="sd">        fault_mode : dict</span>
</span><span id="Faults.fault_parameters-755"><a href="#-755"><span class="linenos">755</span></a><span class="sd">            Dictionary containing the fault parameters.</span>
</span><span id="Faults.fault_parameters-756"><a href="#-756"><span class="linenos">756</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Faults.fault_parameters-757"><a href="#-757"><span class="linenos">757</span></a>        <span class="n">fault_mode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_fault_mode</span><span class="p">()</span>
</span><span id="Faults.fault_parameters-758"><a href="#-758"><span class="linenos">758</span></a>        <span class="k">return</span> <span class="n">fault_mode</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><h6 id="get-fault-parameters">Get Fault Parameters</h6>

<p>Returns the fault parameters.</p>

<p>Factory design pattern used to select fault parameters</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>None</strong></li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>fault_mode</strong> (dict):
Dictionary containing the fault parameters.</li>
</ul>
</div>


                            </div>
                            <div id="Faults.build_faults" class="classattr">
                                        <input id="Faults.build_faults-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">build_faults</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">fp</span><span class="p">:</span> <span class="nb">dict</span>, </span><span class="param"><span class="n">verbose</span><span class="o">=</span><span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Faults.build_faults-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Faults.build_faults"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Faults.build_faults-760"><a href="#-760"><span class="linenos"> 760</span></a>    <span class="k">def</span> <span class="nf">build_faults</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fp</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="Faults.build_faults-761"><a href="#-761"><span class="linenos"> 761</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="Faults.build_faults-762"><a href="#-762"><span class="linenos"> 762</span></a><span class="sd">        Build Faults</span>
</span><span id="Faults.build_faults-763"><a href="#-763"><span class="linenos"> 763</span></a><span class="sd">        ---------------</span>
</span><span id="Faults.build_faults-764"><a href="#-764"><span class="linenos"> 764</span></a><span class="sd">        Creates faults in the model.</span>
</span><span id="Faults.build_faults-765"><a href="#-765"><span class="linenos"> 765</span></a>
</span><span id="Faults.build_faults-766"><a href="#-766"><span class="linenos"> 766</span></a><span class="sd">        Parameters</span>
</span><span id="Faults.build_faults-767"><a href="#-767"><span class="linenos"> 767</span></a><span class="sd">        ----------</span>
</span><span id="Faults.build_faults-768"><a href="#-768"><span class="linenos"> 768</span></a><span class="sd">        fp : dict</span>
</span><span id="Faults.build_faults-769"><a href="#-769"><span class="linenos"> 769</span></a><span class="sd">            Dictionary containing the fault parameters.</span>
</span><span id="Faults.build_faults-770"><a href="#-770"><span class="linenos"> 770</span></a><span class="sd">        verbose : bool</span>
</span><span id="Faults.build_faults-771"><a href="#-771"><span class="linenos"> 771</span></a><span class="sd">            The level of verbosity to use.</span>
</span><span id="Faults.build_faults-772"><a href="#-772"><span class="linenos"> 772</span></a>
</span><span id="Faults.build_faults-773"><a href="#-773"><span class="linenos"> 773</span></a><span class="sd">        Returns</span>
</span><span id="Faults.build_faults-774"><a href="#-774"><span class="linenos"> 774</span></a><span class="sd">        -------</span>
</span><span id="Faults.build_faults-775"><a href="#-775"><span class="linenos"> 775</span></a><span class="sd">        dis_class : np.ndarray</span>
</span><span id="Faults.build_faults-776"><a href="#-776"><span class="linenos"> 776</span></a><span class="sd">            Array of fault displacement classifications</span>
</span><span id="Faults.build_faults-777"><a href="#-777"><span class="linenos"> 777</span></a><span class="sd">        hockey_sticks : list</span>
</span><span id="Faults.build_faults-778"><a href="#-778"><span class="linenos"> 778</span></a><span class="sd">            List of hockey sticks</span>
</span><span id="Faults.build_faults-779"><a href="#-779"><span class="linenos"> 779</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Faults.build_faults-780"><a href="#-780"><span class="linenos"> 780</span></a>        <span class="k">def</span> <span class="nf">apply_faulting</span><span class="p">(</span><span class="n">traces</span><span class="p">,</span> <span class="n">stretch_times</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="Faults.build_faults-781"><a href="#-781"><span class="linenos"> 781</span></a>            <span class="sd">&quot;&quot;&quot;</span>
</span><span id="Faults.build_faults-782"><a href="#-782"><span class="linenos"> 782</span></a><span class="sd">            Apply Faulting</span>
</span><span id="Faults.build_faults-783"><a href="#-783"><span class="linenos"> 783</span></a><span class="sd">            --------------</span>
</span><span id="Faults.build_faults-784"><a href="#-784"><span class="linenos"> 784</span></a><span class="sd">            Applies faulting to the traces.</span>
</span><span id="Faults.build_faults-785"><a href="#-785"><span class="linenos"> 785</span></a>
</span><span id="Faults.build_faults-786"><a href="#-786"><span class="linenos"> 786</span></a><span class="sd">            The method does the following:</span>
</span><span id="Faults.build_faults-787"><a href="#-787"><span class="linenos"> 787</span></a>
</span><span id="Faults.build_faults-788"><a href="#-788"><span class="linenos"> 788</span></a><span class="sd">            Apply stretching and squeezing previously applied to the input cube</span>
</span><span id="Faults.build_faults-789"><a href="#-789"><span class="linenos"> 789</span></a><span class="sd">            vertically to give all depths the same number of extrema.</span>
</span><span id="Faults.build_faults-790"><a href="#-790"><span class="linenos"> 790</span></a><span class="sd">            This is intended to be a proxy for making the</span>
</span><span id="Faults.build_faults-791"><a href="#-791"><span class="linenos"> 791</span></a><span class="sd">            dominant frequency the same everywhere.</span>
</span><span id="Faults.build_faults-792"><a href="#-792"><span class="linenos"> 792</span></a><span class="sd">            Variables:</span>
</span><span id="Faults.build_faults-793"><a href="#-793"><span class="linenos"> 793</span></a><span class="sd">            - traces - input, previously stretched/squeezed trace(s)</span>
</span><span id="Faults.build_faults-794"><a href="#-794"><span class="linenos"> 794</span></a><span class="sd">            - stretch_times - input, LUT for stretching/squeezing trace(s),</span>
</span><span id="Faults.build_faults-795"><a href="#-795"><span class="linenos"> 795</span></a><span class="sd">                              range is (0,number samples in last dimension of &#39;traces&#39;)</span>
</span><span id="Faults.build_faults-796"><a href="#-796"><span class="linenos"> 796</span></a><span class="sd">            - unstretch_traces - output, un-stretched/un-squeezed trace(s)</span>
</span><span id="Faults.build_faults-797"><a href="#-797"><span class="linenos"> 797</span></a>
</span><span id="Faults.build_faults-798"><a href="#-798"><span class="linenos"> 798</span></a><span class="sd">            Parameters</span>
</span><span id="Faults.build_faults-799"><a href="#-799"><span class="linenos"> 799</span></a><span class="sd">            ----------</span>
</span><span id="Faults.build_faults-800"><a href="#-800"><span class="linenos"> 800</span></a><span class="sd">            traces : np.ndarray</span>
</span><span id="Faults.build_faults-801"><a href="#-801"><span class="linenos"> 801</span></a><span class="sd">                Previously stretched/squeezed trace(s).</span>
</span><span id="Faults.build_faults-802"><a href="#-802"><span class="linenos"> 802</span></a><span class="sd">            stretch_times : np.ndarray</span>
</span><span id="Faults.build_faults-803"><a href="#-803"><span class="linenos"> 803</span></a><span class="sd">                A look up table for stretching and squeezing the traces.</span>
</span><span id="Faults.build_faults-804"><a href="#-804"><span class="linenos"> 804</span></a><span class="sd">            verbose : bool, optional</span>
</span><span id="Faults.build_faults-805"><a href="#-805"><span class="linenos"> 805</span></a><span class="sd">                The level of verbosity, by default False</span>
</span><span id="Faults.build_faults-806"><a href="#-806"><span class="linenos"> 806</span></a>
</span><span id="Faults.build_faults-807"><a href="#-807"><span class="linenos"> 807</span></a><span class="sd">            Returns</span>
</span><span id="Faults.build_faults-808"><a href="#-808"><span class="linenos"> 808</span></a><span class="sd">            -------</span>
</span><span id="Faults.build_faults-809"><a href="#-809"><span class="linenos"> 809</span></a><span class="sd">            np.ndarray</span>
</span><span id="Faults.build_faults-810"><a href="#-810"><span class="linenos"> 810</span></a><span class="sd">                The un-stretched/un-squeezed trace(s).</span>
</span><span id="Faults.build_faults-811"><a href="#-811"><span class="linenos"> 811</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="Faults.build_faults-812"><a href="#-812"><span class="linenos"> 812</span></a>            <span class="n">unstretch_traces</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">traces</span><span class="p">)</span>
</span><span id="Faults.build_faults-813"><a href="#-813"><span class="linenos"> 813</span></a>            <span class="n">origtime</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">traces</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</span><span id="Faults.build_faults-814"><a href="#-814"><span class="linenos"> 814</span></a>
</span><span id="Faults.build_faults-815"><a href="#-815"><span class="linenos"> 815</span></a>            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="Faults.build_faults-816"><a href="#-816"><span class="linenos"> 816</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">   ... Cube parameters going into interpolation&quot;</span><span class="p">)</span>
</span><span id="Faults.build_faults-817"><a href="#-817"><span class="linenos"> 817</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">   ... Origtime shape  = </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">origtime</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Faults.build_faults-818"><a href="#-818"><span class="linenos"> 818</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">   ... stretch_times_effects shape  = </span><span class="si">{</span><span class="n">stretch_times</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Faults.build_faults-819"><a href="#-819"><span class="linenos"> 819</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">   ... unstretch_times shape  = </span><span class="si">{</span><span class="n">unstretch_traces</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Faults.build_faults-820"><a href="#-820"><span class="linenos"> 820</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">   ... traces shape  = </span><span class="si">{</span><span class="n">traces</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Faults.build_faults-821"><a href="#-821"><span class="linenos"> 821</span></a>
</span><span id="Faults.build_faults-822"><a href="#-822"><span class="linenos"> 822</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">traces</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="Faults.build_faults-823"><a href="#-823"><span class="linenos"> 823</span></a>                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">traces</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
</span><span id="Faults.build_faults-824"><a href="#-824"><span class="linenos"> 824</span></a>                    <span class="k">if</span> <span class="n">traces</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">!=</span> <span class="n">traces</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">max</span><span class="p">():</span>
</span><span id="Faults.build_faults-825"><a href="#-825"><span class="linenos"> 825</span></a>                        <span class="n">unstretch_traces</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span>
</span><span id="Faults.build_faults-826"><a href="#-826"><span class="linenos"> 826</span></a>                            <span class="n">stretch_times</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="p">:],</span> <span class="n">origtime</span><span class="p">,</span> <span class="n">traces</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="p">:]</span>
</span><span id="Faults.build_faults-827"><a href="#-827"><span class="linenos"> 827</span></a>                        <span class="p">)</span>
</span><span id="Faults.build_faults-828"><a href="#-828"><span class="linenos"> 828</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="Faults.build_faults-829"><a href="#-829"><span class="linenos"> 829</span></a>                        <span class="n">unstretch_traces</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">traces</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="p">:]</span>
</span><span id="Faults.build_faults-830"><a href="#-830"><span class="linenos"> 830</span></a>            <span class="k">return</span> <span class="n">unstretch_traces</span>
</span><span id="Faults.build_faults-831"><a href="#-831"><span class="linenos"> 831</span></a>
</span><span id="Faults.build_faults-832"><a href="#-832"><span class="linenos"> 832</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2"> . starting &#39;build_faults&#39;.&quot;</span><span class="p">)</span>
</span><span id="Faults.build_faults-833"><a href="#-833"><span class="linenos"> 833</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   ... self.cfg.verbose = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">))</span>
</span><span id="Faults.build_faults-834"><a href="#-834"><span class="linenos"> 834</span></a>        <span class="n">cube_shape</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">)</span>
</span><span id="Faults.build_faults-835"><a href="#-835"><span class="linenos"> 835</span></a>        <span class="n">cube_shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">pad_samples</span>
</span><span id="Faults.build_faults-836"><a href="#-836"><span class="linenos"> 836</span></a>        <span class="n">samples_in_cube</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">geologic_age</span><span class="p">[:]</span><span class="o">.</span><span class="n">size</span>
</span><span id="Faults.build_faults-837"><a href="#-837"><span class="linenos"> 837</span></a>        <span class="n">wb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy_and_divide_depth_maps_by_infill</span><span class="p">(</span>
</span><span id="Faults.build_faults-838"><a href="#-838"><span class="linenos"> 838</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">unfaulted_depth_maps</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
</span><span id="Faults.build_faults-839"><a href="#-839"><span class="linenos"> 839</span></a>        <span class="p">)</span>
</span><span id="Faults.build_faults-840"><a href="#-840"><span class="linenos"> 840</span></a>
</span><span id="Faults.build_faults-841"><a href="#-841"><span class="linenos"> 841</span></a>        <span class="n">sum_displacements</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">geologic_age</span><span class="p">[:])</span>
</span><span id="Faults.build_faults-842"><a href="#-842"><span class="linenos"> 842</span></a>        <span class="n">displacements_class</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">geologic_age</span><span class="p">[:])</span>
</span><span id="Faults.build_faults-843"><a href="#-843"><span class="linenos"> 843</span></a>        <span class="n">hockey_sticks</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Faults.build_faults-844"><a href="#-844"><span class="linenos"> 844</span></a>        <span class="n">fault_voxel_count_list</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Faults.build_faults-845"><a href="#-845"><span class="linenos"> 845</span></a>        <span class="n">number_fault_intersections</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Faults.build_faults-846"><a href="#-846"><span class="linenos"> 846</span></a>
</span><span id="Faults.build_faults-847"><a href="#-847"><span class="linenos"> 847</span></a>        <span class="n">depth_maps_faulted_infilled</span> <span class="o">=</span> \
</span><span id="Faults.build_faults-848"><a href="#-848"><span class="linenos"> 848</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">copy_and_divide_depth_maps_by_infill</span><span class="p">(</span>
</span><span id="Faults.build_faults-849"><a href="#-849"><span class="linenos"> 849</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">unfaulted_depth_maps</span><span class="p">[:]</span>
</span><span id="Faults.build_faults-850"><a href="#-850"><span class="linenos"> 850</span></a>            <span class="p">)</span>
</span><span id="Faults.build_faults-851"><a href="#-851"><span class="linenos"> 851</span></a>        <span class="n">depth_maps_gaps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy_and_divide_depth_maps_by_infill</span><span class="p">(</span>
</span><span id="Faults.build_faults-852"><a href="#-852"><span class="linenos"> 852</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">unfaulted_depth_maps</span><span class="p">[:]</span>
</span><span id="Faults.build_faults-853"><a href="#-853"><span class="linenos"> 853</span></a>        <span class="p">)</span>
</span><span id="Faults.build_faults-854"><a href="#-854"><span class="linenos"> 854</span></a>
</span><span id="Faults.build_faults-855"><a href="#-855"><span class="linenos"> 855</span></a>        <span class="c1"># Create depth indices cube (moved from inside loop)</span>
</span><span id="Faults.build_faults-856"><a href="#-856"><span class="linenos"> 856</span></a>        <span class="n">faulted_depths</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">geologic_age</span><span class="p">[:])</span>
</span><span id="Faults.build_faults-857"><a href="#-857"><span class="linenos"> 857</span></a>        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">faulted_depths</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
</span><span id="Faults.build_faults-858"><a href="#-858"><span class="linenos"> 858</span></a>            <span class="n">faulted_depths</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">k</span>
</span><span id="Faults.build_faults-859"><a href="#-859"><span class="linenos"> 859</span></a>        <span class="n">unfaulted_depths</span> <span class="o">=</span> <span class="n">faulted_depths</span> <span class="o">*</span> <span class="mf">1.0</span>
</span><span id="Faults.build_faults-860"><a href="#-860"><span class="linenos"> 860</span></a>        <span class="n">_faulted_depths</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="Faults.build_faults-861"><a href="#-861"><span class="linenos"> 861</span></a>            <span class="n">unfaulted_depths</span> <span class="o">*</span> <span class="mf">1.0</span>
</span><span id="Faults.build_faults-862"><a href="#-862"><span class="linenos"> 862</span></a>        <span class="p">)</span>  <span class="c1"># in case there are 0 faults, prepare _faulted_depths here</span>
</span><span id="Faults.build_faults-863"><a href="#-863"><span class="linenos"> 863</span></a>
</span><span id="Faults.build_faults-864"><a href="#-864"><span class="linenos"> 864</span></a>        <span class="k">for</span> <span class="n">ifault</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">number_faults</span><span class="p">)):</span>
</span><span id="Faults.build_faults-865"><a href="#-865"><span class="linenos"> 865</span></a>            <span class="n">semi_axes</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="Faults.build_faults-866"><a href="#-866"><span class="linenos"> 866</span></a>                <span class="n">fp</span><span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">][</span><span class="n">ifault</span><span class="p">],</span>
</span><span id="Faults.build_faults-867"><a href="#-867"><span class="linenos"> 867</span></a>                <span class="n">fp</span><span class="p">[</span><span class="s2">&quot;b&quot;</span><span class="p">][</span><span class="n">ifault</span><span class="p">],</span>
</span><span id="Faults.build_faults-868"><a href="#-868"><span class="linenos"> 868</span></a>                <span class="n">fp</span><span class="p">[</span><span class="s2">&quot;c&quot;</span><span class="p">][</span><span class="n">ifault</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">infill_factor</span> <span class="o">**</span> <span class="mi">2</span><span class="p">,</span>
</span><span id="Faults.build_faults-869"><a href="#-869"><span class="linenos"> 869</span></a>            <span class="p">]</span>
</span><span id="Faults.build_faults-870"><a href="#-870"><span class="linenos"> 870</span></a>            <span class="n">origin</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="Faults.build_faults-871"><a href="#-871"><span class="linenos"> 871</span></a>                <span class="n">fp</span><span class="p">[</span><span class="s2">&quot;x0&quot;</span><span class="p">][</span><span class="n">ifault</span><span class="p">],</span>
</span><span id="Faults.build_faults-872"><a href="#-872"><span class="linenos"> 872</span></a>                <span class="n">fp</span><span class="p">[</span><span class="s2">&quot;y0&quot;</span><span class="p">][</span><span class="n">ifault</span><span class="p">],</span>
</span><span id="Faults.build_faults-873"><a href="#-873"><span class="linenos"> 873</span></a>                <span class="n">fp</span><span class="p">[</span><span class="s2">&quot;z0&quot;</span><span class="p">][</span><span class="n">ifault</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">infill_factor</span><span class="p">,</span>
</span><span id="Faults.build_faults-874"><a href="#-874"><span class="linenos"> 874</span></a>            <span class="p">]</span>
</span><span id="Faults.build_faults-875"><a href="#-875"><span class="linenos"> 875</span></a>            <span class="n">throw</span> <span class="o">=</span> <span class="n">fp</span><span class="p">[</span><span class="s2">&quot;throw&quot;</span><span class="p">][</span><span class="n">ifault</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">infill_factor</span>
</span><span id="Faults.build_faults-876"><a href="#-876"><span class="linenos"> 876</span></a>            <span class="n">tilt</span> <span class="o">=</span> <span class="n">fp</span><span class="p">[</span><span class="s2">&quot;tilt_pct&quot;</span><span class="p">][</span><span class="n">ifault</span><span class="p">]</span>
</span><span id="Faults.build_faults-877"><a href="#-877"><span class="linenos"> 877</span></a>
</span><span id="Faults.build_faults-878"><a href="#-878"><span class="linenos"> 878</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2"> ... inserting fault </span><span class="si">{</span><span class="n">ifault</span><span class="si">}</span><span class="s2"> with throw </span><span class="si">{</span><span class="n">throw</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Faults.build_faults-879"><a href="#-879"><span class="linenos"> 879</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="Faults.build_faults-880"><a href="#-880"><span class="linenos"> 880</span></a>                <span class="sa">f</span><span class="s2">&quot;   ... fault ellipsoid semi-axes (a, b, c): </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">semi_axes</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, &quot;</span>
</span><span id="Faults.build_faults-881"><a href="#-881"><span class="linenos"> 881</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">semi_axes</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">semi_axes</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Faults.build_faults-882"><a href="#-882"><span class="linenos"> 882</span></a>            <span class="p">)</span>
</span><span id="Faults.build_faults-883"><a href="#-883"><span class="linenos"> 883</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="Faults.build_faults-884"><a href="#-884"><span class="linenos"> 884</span></a>                <span class="sa">f</span><span class="s2">&quot;   ... fault ellipsoid origin (x, y, z): </span><span class="si">{</span><span class="n">origin</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">origin</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">origin</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Faults.build_faults-885"><a href="#-885"><span class="linenos"> 885</span></a>            <span class="p">)</span>
</span><span id="Faults.build_faults-886"><a href="#-886"><span class="linenos"> 886</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   ... tilt_pct: </span><span class="si">{</span><span class="n">tilt</span> <span class="o">*</span> <span class="mi">100</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Faults.build_faults-887"><a href="#-887"><span class="linenos"> 887</span></a>            <span class="n">z_base</span> <span class="o">=</span> <span class="n">origin</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">semi_axes</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</span><span id="Faults.build_faults-888"><a href="#-888"><span class="linenos"> 888</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="Faults.build_faults-889"><a href="#-889"><span class="linenos"> 889</span></a>                <span class="sa">f</span><span class="s2">&quot;   ...z for bottom of ellipsoid at depth (samples) = </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">z_base</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Faults.build_faults-890"><a href="#-890"><span class="linenos"> 890</span></a>            <span class="p">)</span>
</span><span id="Faults.build_faults-891"><a href="#-891"><span class="linenos"> 891</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   ...shape of output_cube = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">geologic_age</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Faults.build_faults-892"><a href="#-892"><span class="linenos"> 892</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="Faults.build_faults-893"><a href="#-893"><span class="linenos"> 893</span></a>                <span class="sa">f</span><span class="s2">&quot;   ...infill_factor, pad_samples = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">infill_factor</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">pad_samples</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Faults.build_faults-894"><a href="#-894"><span class="linenos"> 894</span></a>            <span class="p">)</span>
</span><span id="Faults.build_faults-895"><a href="#-895"><span class="linenos"> 895</span></a>
</span><span id="Faults.build_faults-896"><a href="#-896"><span class="linenos"> 896</span></a>            <span class="c1"># add empty arrays for shear_zone_width and gouge_pctile to fault params dictionary</span>
</span><span id="Faults.build_faults-897"><a href="#-897"><span class="linenos"> 897</span></a>            <span class="n">fp</span><span class="p">[</span><span class="s2">&quot;shear_zone_width&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">number_faults</span><span class="p">)</span>
</span><span id="Faults.build_faults-898"><a href="#-898"><span class="linenos"> 898</span></a>            <span class="n">fp</span><span class="p">[</span><span class="s2">&quot;gouge_pctile&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">number_faults</span><span class="p">)</span>
</span><span id="Faults.build_faults-899"><a href="#-899"><span class="linenos"> 899</span></a>            <span class="p">(</span>
</span><span id="Faults.build_faults-900"><a href="#-900"><span class="linenos"> 900</span></a>                <span class="n">displacement</span><span class="p">,</span>
</span><span id="Faults.build_faults-901"><a href="#-901"><span class="linenos"> 901</span></a>                <span class="n">displacement_classification</span><span class="p">,</span>
</span><span id="Faults.build_faults-902"><a href="#-902"><span class="linenos"> 902</span></a>                <span class="n">interpolation</span><span class="p">,</span>
</span><span id="Faults.build_faults-903"><a href="#-903"><span class="linenos"> 903</span></a>                <span class="n">hockey_stick</span><span class="p">,</span>
</span><span id="Faults.build_faults-904"><a href="#-904"><span class="linenos"> 904</span></a>                <span class="n">fault_segm</span><span class="p">,</span>
</span><span id="Faults.build_faults-905"><a href="#-905"><span class="linenos"> 905</span></a>                <span class="n">ellipsoid</span><span class="p">,</span>
</span><span id="Faults.build_faults-906"><a href="#-906"><span class="linenos"> 906</span></a>                <span class="n">fp</span><span class="p">,</span>
</span><span id="Faults.build_faults-907"><a href="#-907"><span class="linenos"> 907</span></a>            <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_displacement_vector</span><span class="p">(</span>
</span><span id="Faults.build_faults-908"><a href="#-908"><span class="linenos"> 908</span></a>                <span class="n">semi_axes</span><span class="p">,</span> <span class="n">origin</span><span class="p">,</span> <span class="n">throw</span><span class="p">,</span> <span class="n">tilt</span><span class="p">,</span> <span class="n">wb</span><span class="p">,</span> <span class="n">ifault</span><span class="p">,</span> <span class="n">fp</span>
</span><span id="Faults.build_faults-909"><a href="#-909"><span class="linenos"> 909</span></a>            <span class="p">)</span>
</span><span id="Faults.build_faults-910"><a href="#-910"><span class="linenos"> 910</span></a>
</span><span id="Faults.build_faults-911"><a href="#-911"><span class="linenos"> 911</span></a>            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="Faults.build_faults-912"><a href="#-912"><span class="linenos"> 912</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;     ... hockey_stick = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">hockey_stick</span><span class="p">))</span>
</span><span id="Faults.build_faults-913"><a href="#-913"><span class="linenos"> 913</span></a>                <span class="nb">print</span><span class="p">(</span>
</span><span id="Faults.build_faults-914"><a href="#-914"><span class="linenos"> 914</span></a>                    <span class="s2">&quot;     ... Is displacement the same as displacement_classification? &quot;</span>
</span><span id="Faults.build_faults-915"><a href="#-915"><span class="linenos"> 915</span></a>                    <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">displacement</span> <span class="o">==</span> <span class="n">displacement_classification</span><span class="p">))</span>
</span><span id="Faults.build_faults-916"><a href="#-916"><span class="linenos"> 916</span></a>                <span class="p">)</span>
</span><span id="Faults.build_faults-917"><a href="#-917"><span class="linenos"> 917</span></a>                <span class="nb">print</span><span class="p">(</span>
</span><span id="Faults.build_faults-918"><a href="#-918"><span class="linenos"> 918</span></a>                    <span class="s2">&quot;     ... Sample count where displacement differs from displacement_classification? &quot;</span>
</span><span id="Faults.build_faults-919"><a href="#-919"><span class="linenos"> 919</span></a>                    <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="Faults.build_faults-920"><a href="#-920"><span class="linenos"> 920</span></a>                        <span class="n">displacement</span><span class="p">[</span><span class="n">displacement</span> <span class="o">!=</span> <span class="n">displacement_classification</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="Faults.build_faults-921"><a href="#-921"><span class="linenos"> 921</span></a>                    <span class="p">)</span>
</span><span id="Faults.build_faults-922"><a href="#-922"><span class="linenos"> 922</span></a>                <span class="p">)</span>
</span><span id="Faults.build_faults-923"><a href="#-923"><span class="linenos"> 923</span></a>                <span class="nb">print</span><span class="p">(</span>
</span><span id="Faults.build_faults-924"><a href="#-924"><span class="linenos"> 924</span></a>                    <span class="s2">&quot;     ... percent of samples where displacement differs from displacement_classification = &quot;</span>
</span><span id="Faults.build_faults-925"><a href="#-925"><span class="linenos"> 925</span></a>                    <span class="o">+</span> <span class="nb">format</span><span class="p">(</span>
</span><span id="Faults.build_faults-926"><a href="#-926"><span class="linenos"> 926</span></a>                        <span class="nb">float</span><span class="p">(</span>
</span><span id="Faults.build_faults-927"><a href="#-927"><span class="linenos"> 927</span></a>                            <span class="n">displacement</span><span class="p">[</span>
</span><span id="Faults.build_faults-928"><a href="#-928"><span class="linenos"> 928</span></a>                                <span class="n">displacement</span> <span class="o">!=</span> <span class="n">displacement_classification</span>
</span><span id="Faults.build_faults-929"><a href="#-929"><span class="linenos"> 929</span></a>                            <span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="Faults.build_faults-930"><a href="#-930"><span class="linenos"> 930</span></a>                        <span class="p">)</span>
</span><span id="Faults.build_faults-931"><a href="#-931"><span class="linenos"> 931</span></a>                        <span class="o">/</span> <span class="n">samples_in_cube</span><span class="p">,</span>
</span><span id="Faults.build_faults-932"><a href="#-932"><span class="linenos"> 932</span></a>                        <span class="s2">&quot;5.1%&quot;</span><span class="p">,</span>
</span><span id="Faults.build_faults-933"><a href="#-933"><span class="linenos"> 933</span></a>                    <span class="p">)</span>
</span><span id="Faults.build_faults-934"><a href="#-934"><span class="linenos"> 934</span></a>                <span class="p">)</span>
</span><span id="Faults.build_faults-935"><a href="#-935"><span class="linenos"> 935</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="Faults.build_faults-936"><a href="#-936"><span class="linenos"> 936</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="Faults.build_faults-937"><a href="#-937"><span class="linenos"> 937</span></a>                        <span class="s2">&quot;     ... (displacement differs from displacement_classification).mean() &quot;</span>
</span><span id="Faults.build_faults-938"><a href="#-938"><span class="linenos"> 938</span></a>                        <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="Faults.build_faults-939"><a href="#-939"><span class="linenos"> 939</span></a>                            <span class="n">displacement</span><span class="p">[</span>
</span><span id="Faults.build_faults-940"><a href="#-940"><span class="linenos"> 940</span></a>                                <span class="n">displacement</span> <span class="o">!=</span> <span class="n">displacement_classification</span>
</span><span id="Faults.build_faults-941"><a href="#-941"><span class="linenos"> 941</span></a>                            <span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</span><span id="Faults.build_faults-942"><a href="#-942"><span class="linenos"> 942</span></a>                        <span class="p">)</span>
</span><span id="Faults.build_faults-943"><a href="#-943"><span class="linenos"> 943</span></a>                    <span class="p">)</span>
</span><span id="Faults.build_faults-944"><a href="#-944"><span class="linenos"> 944</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="Faults.build_faults-945"><a href="#-945"><span class="linenos"> 945</span></a>                        <span class="s2">&quot;     ... (displacement differs from displacement_classification).max() &quot;</span>
</span><span id="Faults.build_faults-946"><a href="#-946"><span class="linenos"> 946</span></a>                        <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="Faults.build_faults-947"><a href="#-947"><span class="linenos"> 947</span></a>                            <span class="n">displacement</span><span class="p">[</span>
</span><span id="Faults.build_faults-948"><a href="#-948"><span class="linenos"> 948</span></a>                                <span class="n">displacement</span> <span class="o">!=</span> <span class="n">displacement_classification</span>
</span><span id="Faults.build_faults-949"><a href="#-949"><span class="linenos"> 949</span></a>                            <span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</span><span id="Faults.build_faults-950"><a href="#-950"><span class="linenos"> 950</span></a>                        <span class="p">)</span>
</span><span id="Faults.build_faults-951"><a href="#-951"><span class="linenos"> 951</span></a>                    <span class="p">)</span>
</span><span id="Faults.build_faults-952"><a href="#-952"><span class="linenos"> 952</span></a>                <span class="k">except</span><span class="p">:</span>
</span><span id="Faults.build_faults-953"><a href="#-953"><span class="linenos"> 953</span></a>                    <span class="k">pass</span>
</span><span id="Faults.build_faults-954"><a href="#-954"><span class="linenos"> 954</span></a>
</span><span id="Faults.build_faults-955"><a href="#-955"><span class="linenos"> 955</span></a>                <span class="nb">print</span><span class="p">(</span>
</span><span id="Faults.build_faults-956"><a href="#-956"><span class="linenos"> 956</span></a>                    <span class="s2">&quot;   ...displacement_classification.min() = &quot;</span>
</span><span id="Faults.build_faults-957"><a href="#-957"><span class="linenos"> 957</span></a>                    <span class="o">+</span> <span class="s2">&quot;, &quot;</span>
</span><span id="Faults.build_faults-958"><a href="#-958"><span class="linenos"> 958</span></a>                    <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">displacement_classification</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
</span><span id="Faults.build_faults-959"><a href="#-959"><span class="linenos"> 959</span></a>                <span class="p">)</span>
</span><span id="Faults.build_faults-960"><a href="#-960"><span class="linenos"> 960</span></a>                <span class="nb">print</span><span class="p">(</span>
</span><span id="Faults.build_faults-961"><a href="#-961"><span class="linenos"> 961</span></a>                    <span class="s2">&quot;   ...displacement_classification.mean() = &quot;</span>
</span><span id="Faults.build_faults-962"><a href="#-962"><span class="linenos"> 962</span></a>                    <span class="o">+</span> <span class="s2">&quot;, &quot;</span>
</span><span id="Faults.build_faults-963"><a href="#-963"><span class="linenos"> 963</span></a>                    <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">displacement_classification</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
</span><span id="Faults.build_faults-964"><a href="#-964"><span class="linenos"> 964</span></a>                <span class="p">)</span>
</span><span id="Faults.build_faults-965"><a href="#-965"><span class="linenos"> 965</span></a>                <span class="nb">print</span><span class="p">(</span>
</span><span id="Faults.build_faults-966"><a href="#-966"><span class="linenos"> 966</span></a>                    <span class="s2">&quot;   ...displacement_classification.max() = &quot;</span>
</span><span id="Faults.build_faults-967"><a href="#-967"><span class="linenos"> 967</span></a>                    <span class="o">+</span> <span class="s2">&quot;, &quot;</span>
</span><span id="Faults.build_faults-968"><a href="#-968"><span class="linenos"> 968</span></a>                    <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">displacement_classification</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
</span><span id="Faults.build_faults-969"><a href="#-969"><span class="linenos"> 969</span></a>                <span class="p">)</span>
</span><span id="Faults.build_faults-970"><a href="#-970"><span class="linenos"> 970</span></a>
</span><span id="Faults.build_faults-971"><a href="#-971"><span class="linenos"> 971</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   ...displacement.min() = &quot;</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">displacement</span><span class="o">.</span><span class="n">min</span><span class="p">()))</span>
</span><span id="Faults.build_faults-972"><a href="#-972"><span class="linenos"> 972</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   ...displacement.mean() = &quot;</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">displacement</span><span class="o">.</span><span class="n">mean</span><span class="p">()))</span>
</span><span id="Faults.build_faults-973"><a href="#-973"><span class="linenos"> 973</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   ...displacement.max() = &quot;</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">displacement</span><span class="o">.</span><span class="n">max</span><span class="p">()))</span>
</span><span id="Faults.build_faults-974"><a href="#-974"><span class="linenos"> 974</span></a>                <span class="k">if</span> <span class="n">fault_segm</span><span class="p">[</span><span class="n">fault_segm</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Faults.build_faults-975"><a href="#-975"><span class="linenos"> 975</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="Faults.build_faults-976"><a href="#-976"><span class="linenos"> 976</span></a>                        <span class="s2">&quot;   ...displacement[fault_segm &gt;0].min() = &quot;</span>
</span><span id="Faults.build_faults-977"><a href="#-977"><span class="linenos"> 977</span></a>                        <span class="o">+</span> <span class="s2">&quot;, &quot;</span>
</span><span id="Faults.build_faults-978"><a href="#-978"><span class="linenos"> 978</span></a>                        <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">displacement</span><span class="p">[</span><span class="n">fault_segm</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
</span><span id="Faults.build_faults-979"><a href="#-979"><span class="linenos"> 979</span></a>                    <span class="p">)</span>
</span><span id="Faults.build_faults-980"><a href="#-980"><span class="linenos"> 980</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="Faults.build_faults-981"><a href="#-981"><span class="linenos"> 981</span></a>                        <span class="s2">&quot;   ...displacement[fault_segm &gt;0] P10 = &quot;</span>
</span><span id="Faults.build_faults-982"><a href="#-982"><span class="linenos"> 982</span></a>                        <span class="o">+</span> <span class="s2">&quot;, &quot;</span>
</span><span id="Faults.build_faults-983"><a href="#-983"><span class="linenos"> 983</span></a>                        <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">displacement</span><span class="p">[</span><span class="n">fault_segm</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">],</span> <span class="mi">10</span><span class="p">))</span>
</span><span id="Faults.build_faults-984"><a href="#-984"><span class="linenos"> 984</span></a>                    <span class="p">)</span>
</span><span id="Faults.build_faults-985"><a href="#-985"><span class="linenos"> 985</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="Faults.build_faults-986"><a href="#-986"><span class="linenos"> 986</span></a>                        <span class="s2">&quot;   ...displacement[fault_segm &gt;0] P25 = &quot;</span>
</span><span id="Faults.build_faults-987"><a href="#-987"><span class="linenos"> 987</span></a>                        <span class="o">+</span> <span class="s2">&quot;, &quot;</span>
</span><span id="Faults.build_faults-988"><a href="#-988"><span class="linenos"> 988</span></a>                        <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">displacement</span><span class="p">[</span><span class="n">fault_segm</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">],</span> <span class="mi">25</span><span class="p">))</span>
</span><span id="Faults.build_faults-989"><a href="#-989"><span class="linenos"> 989</span></a>                    <span class="p">)</span>
</span><span id="Faults.build_faults-990"><a href="#-990"><span class="linenos"> 990</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="Faults.build_faults-991"><a href="#-991"><span class="linenos"> 991</span></a>                        <span class="s2">&quot;   ...displacement[fault_segm &gt;0].mean() = &quot;</span>
</span><span id="Faults.build_faults-992"><a href="#-992"><span class="linenos"> 992</span></a>                        <span class="o">+</span> <span class="s2">&quot;, &quot;</span>
</span><span id="Faults.build_faults-993"><a href="#-993"><span class="linenos"> 993</span></a>                        <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">displacement</span><span class="p">[</span><span class="n">fault_segm</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
</span><span id="Faults.build_faults-994"><a href="#-994"><span class="linenos"> 994</span></a>                    <span class="p">)</span>
</span><span id="Faults.build_faults-995"><a href="#-995"><span class="linenos"> 995</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="Faults.build_faults-996"><a href="#-996"><span class="linenos"> 996</span></a>                        <span class="s2">&quot;   ...displacement[fault_segm &gt;0] P75 = &quot;</span>
</span><span id="Faults.build_faults-997"><a href="#-997"><span class="linenos"> 997</span></a>                        <span class="o">+</span> <span class="s2">&quot;, &quot;</span>
</span><span id="Faults.build_faults-998"><a href="#-998"><span class="linenos"> 998</span></a>                        <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">displacement</span><span class="p">[</span><span class="n">fault_segm</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">],</span> <span class="mi">75</span><span class="p">))</span>
</span><span id="Faults.build_faults-999"><a href="#-999"><span class="linenos"> 999</span></a>                    <span class="p">)</span>
</span><span id="Faults.build_faults-1000"><a href="#-1000"><span class="linenos">1000</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="Faults.build_faults-1001"><a href="#-1001"><span class="linenos">1001</span></a>                        <span class="s2">&quot;   ...displacement[fault_segm &gt;0] P90 = &quot;</span>
</span><span id="Faults.build_faults-1002"><a href="#-1002"><span class="linenos">1002</span></a>                        <span class="o">+</span> <span class="s2">&quot;, &quot;</span>
</span><span id="Faults.build_faults-1003"><a href="#-1003"><span class="linenos">1003</span></a>                        <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">displacement</span><span class="p">[</span><span class="n">fault_segm</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">],</span> <span class="mi">90</span><span class="p">))</span>
</span><span id="Faults.build_faults-1004"><a href="#-1004"><span class="linenos">1004</span></a>                    <span class="p">)</span>
</span><span id="Faults.build_faults-1005"><a href="#-1005"><span class="linenos">1005</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="Faults.build_faults-1006"><a href="#-1006"><span class="linenos">1006</span></a>                        <span class="s2">&quot;   ...displacement[fault_segm &gt;0].max() = &quot;</span>
</span><span id="Faults.build_faults-1007"><a href="#-1007"><span class="linenos">1007</span></a>                        <span class="o">+</span> <span class="s2">&quot;, &quot;</span>
</span><span id="Faults.build_faults-1008"><a href="#-1008"><span class="linenos">1008</span></a>                        <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">displacement</span><span class="p">[</span><span class="n">fault_segm</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
</span><span id="Faults.build_faults-1009"><a href="#-1009"><span class="linenos">1009</span></a>                    <span class="p">)</span>
</span><span id="Faults.build_faults-1010"><a href="#-1010"><span class="linenos">1010</span></a>
</span><span id="Faults.build_faults-1011"><a href="#-1011"><span class="linenos">1011</span></a>            <span class="n">inline</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">//</span> <span class="mi">2</span>
</span><span id="Faults.build_faults-1012"><a href="#-1012"><span class="linenos">1012</span></a>
</span><span id="Faults.build_faults-1013"><a href="#-1013"><span class="linenos">1013</span></a>            <span class="c1"># limit labels to portions of fault plane with throw above threshold</span>
</span><span id="Faults.build_faults-1014"><a href="#-1014"><span class="linenos">1014</span></a>            <span class="n">throw_threshold_samples</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="Faults.build_faults-1015"><a href="#-1015"><span class="linenos">1015</span></a>            <span class="n">footprint</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</span><span id="Faults.build_faults-1016"><a href="#-1016"><span class="linenos">1016</span></a>            <span class="n">fp_i</span><span class="p">,</span> <span class="n">fp_j</span><span class="p">,</span> <span class="n">fp_k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
</span><span id="Faults.build_faults-1017"><a href="#-1017"><span class="linenos">1017</span></a>                <span class="p">(</span><span class="n">fault_segm</span> <span class="o">&gt;</span> <span class="mf">0.25</span><span class="p">)</span>
</span><span id="Faults.build_faults-1018"><a href="#-1018"><span class="linenos">1018</span></a>                <span class="o">&amp;</span> <span class="p">(</span><span class="n">displacement_classification</span> <span class="o">&gt;</span> <span class="n">throw_threshold_samples</span><span class="p">)</span>
</span><span id="Faults.build_faults-1019"><a href="#-1019"><span class="linenos">1019</span></a>            <span class="p">)</span>
</span><span id="Faults.build_faults-1020"><a href="#-1020"><span class="linenos">1020</span></a>            <span class="n">fault_segm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">fault_segm</span><span class="p">)</span>
</span><span id="Faults.build_faults-1021"><a href="#-1021"><span class="linenos">1021</span></a>            <span class="n">fault_plane_displacement</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">fault_segm</span><span class="p">)</span>
</span><span id="Faults.build_faults-1022"><a href="#-1022"><span class="linenos">1022</span></a>            <span class="n">fault_segm</span><span class="p">[</span><span class="n">fp_i</span><span class="p">,</span> <span class="n">fp_j</span><span class="p">,</span> <span class="n">fp_k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="Faults.build_faults-1023"><a href="#-1023"><span class="linenos">1023</span></a>            <span class="n">fault_plane_displacement</span><span class="p">[</span><span class="n">fp_i</span><span class="p">,</span> <span class="n">fp_j</span><span class="p">,</span> <span class="n">fp_k</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="Faults.build_faults-1024"><a href="#-1024"><span class="linenos">1024</span></a>                <span class="n">displacement_classification</span><span class="p">[</span><span class="n">fp_i</span><span class="p">,</span> <span class="n">fp_j</span><span class="p">,</span> <span class="n">fp_k</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1.0</span>
</span><span id="Faults.build_faults-1025"><a href="#-1025"><span class="linenos">1025</span></a>            <span class="p">)</span>
</span><span id="Faults.build_faults-1026"><a href="#-1026"><span class="linenos">1026</span></a>
</span><span id="Faults.build_faults-1027"><a href="#-1027"><span class="linenos">1027</span></a>            <span class="n">fault_voxel_count_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fault_segm</span><span class="p">[</span><span class="n">fault_segm</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
</span><span id="Faults.build_faults-1028"><a href="#-1028"><span class="linenos">1028</span></a>
</span><span id="Faults.build_faults-1029"><a href="#-1029"><span class="linenos">1029</span></a>            <span class="c1"># create blended version of displacement that accounts for simulation of fault drag</span>
</span><span id="Faults.build_faults-1030"><a href="#-1030"><span class="linenos">1030</span></a>            <span class="n">drag_factor</span> <span class="o">=</span> <span class="mf">0.5</span>
</span><span id="Faults.build_faults-1031"><a href="#-1031"><span class="linenos">1031</span></a>            <span class="n">displacement</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="Faults.build_faults-1032"><a href="#-1032"><span class="linenos">1032</span></a>                <span class="mf">1.0</span> <span class="o">-</span> <span class="n">drag_factor</span>
</span><span id="Faults.build_faults-1033"><a href="#-1033"><span class="linenos">1033</span></a>            <span class="p">)</span> <span class="o">*</span> <span class="n">displacement</span> <span class="o">+</span> <span class="n">drag_factor</span> <span class="o">*</span> <span class="n">displacement_classification</span>
</span><span id="Faults.build_faults-1034"><a href="#-1034"><span class="linenos">1034</span></a>
</span><span id="Faults.build_faults-1035"><a href="#-1035"><span class="linenos">1035</span></a>            <span class="c1"># project fault depth on 2D map surface</span>
</span><span id="Faults.build_faults-1036"><a href="#-1036"><span class="linenos">1036</span></a>            <span class="n">fault_plane_map</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">wb</span><span class="p">)</span>
</span><span id="Faults.build_faults-1037"><a href="#-1037"><span class="linenos">1037</span></a>            <span class="n">depth_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">ellipsoid</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</span><span id="Faults.build_faults-1038"><a href="#-1038"><span class="linenos">1038</span></a>            <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">fault_plane_map</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="Faults.build_faults-1039"><a href="#-1039"><span class="linenos">1039</span></a>                <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">fault_plane_map</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
</span><span id="Faults.build_faults-1040"><a href="#-1040"><span class="linenos">1040</span></a>                    <span class="n">fault_plane_map</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span> <span class="n">jj</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span>
</span><span id="Faults.build_faults-1041"><a href="#-1041"><span class="linenos">1041</span></a>                        <span class="mf">1.0</span><span class="p">,</span> <span class="n">ellipsoid</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span> <span class="n">jj</span><span class="p">,</span> <span class="p">:],</span> <span class="n">depth_indices</span>
</span><span id="Faults.build_faults-1042"><a href="#-1042"><span class="linenos">1042</span></a>                    <span class="p">)</span>
</span><span id="Faults.build_faults-1043"><a href="#-1043"><span class="linenos">1043</span></a>            <span class="n">fault_plane_map</span> <span class="o">=</span> <span class="n">fault_plane_map</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">ellipsoid</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="Faults.build_faults-1044"><a href="#-1044"><span class="linenos">1044</span></a>
</span><span id="Faults.build_faults-1045"><a href="#-1045"><span class="linenos">1045</span></a>            <span class="c1"># compute fault azimuth (relative to i,j,k indices, not North)</span>
</span><span id="Faults.build_faults-1046"><a href="#-1046"><span class="linenos">1046</span></a>            <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">gradient</span><span class="p">(</span><span class="n">fault_plane_map</span><span class="p">)</span>
</span><span id="Faults.build_faults-1047"><a href="#-1047"><span class="linenos">1047</span></a>            <span class="n">strike_angle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">dy</span><span class="p">,</span> <span class="n">dx</span><span class="p">)</span> <span class="o">*</span> <span class="mf">180.0</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>  <span class="c1"># 2D</span>
</span><span id="Faults.build_faults-1048"><a href="#-1048"><span class="linenos">1048</span></a>            <span class="k">del</span> <span class="n">dx</span>
</span><span id="Faults.build_faults-1049"><a href="#-1049"><span class="linenos">1049</span></a>            <span class="k">del</span> <span class="n">dy</span>
</span><span id="Faults.build_faults-1050"><a href="#-1050"><span class="linenos">1050</span></a>            <span class="n">strike_angle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">fault_segm</span><span class="p">)</span> <span class="o">+</span> <span class="n">strike_angle</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span>
</span><span id="Faults.build_faults-1051"><a href="#-1051"><span class="linenos">1051</span></a>                <span class="n">fault_plane_map</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">fault_plane_map</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1</span>
</span><span id="Faults.build_faults-1052"><a href="#-1052"><span class="linenos">1052</span></a>            <span class="p">)</span>
</span><span id="Faults.build_faults-1053"><a href="#-1053"><span class="linenos">1053</span></a>            <span class="n">strike_angle</span><span class="p">[</span><span class="n">fault_segm</span> <span class="o">&lt;</span> <span class="mf">0.5</span><span class="p">]</span> <span class="o">=</span> <span class="mf">200.0</span>
</span><span id="Faults.build_faults-1054"><a href="#-1054"><span class="linenos">1054</span></a>
</span><span id="Faults.build_faults-1055"><a href="#-1055"><span class="linenos">1055</span></a>            <span class="c1"># - compute faulted depth as max of fault plane or faulted depth</span>
</span><span id="Faults.build_faults-1056"><a href="#-1056"><span class="linenos">1056</span></a>            <span class="n">fault_plane</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">displacement</span><span class="p">)</span> <span class="o">+</span> <span class="n">fault_plane_map</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span>
</span><span id="Faults.build_faults-1057"><a href="#-1057"><span class="linenos">1057</span></a>                <span class="n">fault_plane_map</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">fault_plane_map</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1</span>
</span><span id="Faults.build_faults-1058"><a href="#-1058"><span class="linenos">1058</span></a>            <span class="p">)</span>
</span><span id="Faults.build_faults-1059"><a href="#-1059"><span class="linenos">1059</span></a>
</span><span id="Faults.build_faults-1060"><a href="#-1060"><span class="linenos">1060</span></a>            <span class="k">if</span> <span class="n">ifault</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Faults.build_faults-1061"><a href="#-1061"><span class="linenos">1061</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;      .... set _unfaulted_depths to array with all zeros...&quot;</span><span class="p">)</span>
</span><span id="Faults.build_faults-1062"><a href="#-1062"><span class="linenos">1062</span></a>                <span class="n">_faulted_depths</span> <span class="o">=</span> <span class="n">unfaulted_depths</span> <span class="o">*</span> <span class="mf">1.0</span>
</span><span id="Faults.build_faults-1063"><a href="#-1063"><span class="linenos">1063</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">fault_plane_azimuth</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">strike_angle</span> <span class="o">*</span> <span class="mf">1.0</span>
</span><span id="Faults.build_faults-1064"><a href="#-1064"><span class="linenos">1064</span></a>
</span><span id="Faults.build_faults-1065"><a href="#-1065"><span class="linenos">1065</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   ... interpolation = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">interpolation</span><span class="p">))</span>
</span><span id="Faults.build_faults-1066"><a href="#-1066"><span class="linenos">1066</span></a>
</span><span id="Faults.build_faults-1067"><a href="#-1067"><span class="linenos">1067</span></a>            <span class="k">if</span> <span class="p">(</span>
</span><span id="Faults.build_faults-1068"><a href="#-1068"><span class="linenos">1068</span></a>                <span class="n">interpolation</span>
</span><span id="Faults.build_faults-1069"><a href="#-1069"><span class="linenos">1069</span></a>            <span class="p">):</span>  <span class="c1"># i.e. if the fault should be considered, apply the displacements and append fault plane</span>
</span><span id="Faults.build_faults-1070"><a href="#-1070"><span class="linenos">1070</span></a>                <span class="n">faulted_depths2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span>
</span><span id="Faults.build_faults-1071"><a href="#-1071"><span class="linenos">1071</span></a>                    <span class="p">(</span><span class="n">ellipsoid</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ellipsoid</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ellipsoid</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">2</span><span class="p">),</span>
</span><span id="Faults.build_faults-1072"><a href="#-1072"><span class="linenos">1072</span></a>                    <span class="s2">&quot;float&quot;</span><span class="p">,</span>
</span><span id="Faults.build_faults-1073"><a href="#-1073"><span class="linenos">1073</span></a>                <span class="p">)</span>
</span><span id="Faults.build_faults-1074"><a href="#-1074"><span class="linenos">1074</span></a>                <span class="n">faulted_depths2</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">displacement</span> <span class="o">*</span> <span class="mf">1.0</span>
</span><span id="Faults.build_faults-1075"><a href="#-1075"><span class="linenos">1075</span></a>                <span class="n">faulted_depths2</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">fault_plane</span> <span class="o">-</span> <span class="n">faulted_depths</span>
</span><span id="Faults.build_faults-1076"><a href="#-1076"><span class="linenos">1076</span></a>                <span class="n">faulted_depths2</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="mi">1</span><span class="p">][</span><span class="n">ellipsoid</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="Faults.build_faults-1077"><a href="#-1077"><span class="linenos">1077</span></a>                <span class="n">map_displacement_vector</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">faulted_depths2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span>
</span><span id="Faults.build_faults-1078"><a href="#-1078"><span class="linenos">1078</span></a>                    <span class="mf">0.0</span><span class="p">,</span> <span class="kc">None</span>
</span><span id="Faults.build_faults-1079"><a href="#-1079"><span class="linenos">1079</span></a>                <span class="p">)</span>
</span><span id="Faults.build_faults-1080"><a href="#-1080"><span class="linenos">1080</span></a>                <span class="k">del</span> <span class="n">faulted_depths2</span>
</span><span id="Faults.build_faults-1081"><a href="#-1081"><span class="linenos">1081</span></a>                <span class="n">map_displacement_vector</span><span class="p">[</span><span class="n">ellipsoid</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="Faults.build_faults-1082"><a href="#-1082"><span class="linenos">1082</span></a>
</span><span id="Faults.build_faults-1083"><a href="#-1083"><span class="linenos">1083</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">sum_map_displacements</span><span class="p">[:]</span> <span class="o">+=</span> <span class="n">map_displacement_vector</span>
</span><span id="Faults.build_faults-1084"><a href="#-1084"><span class="linenos">1084</span></a>                <span class="n">displacements_class</span> <span class="o">+=</span> <span class="n">displacement_classification</span>
</span><span id="Faults.build_faults-1085"><a href="#-1085"><span class="linenos">1085</span></a>                <span class="c1"># Set displacements outside ellipsoid to 0</span>
</span><span id="Faults.build_faults-1086"><a href="#-1086"><span class="linenos">1086</span></a>                <span class="n">displacement</span><span class="p">[</span><span class="n">ellipsoid</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Faults.build_faults-1087"><a href="#-1087"><span class="linenos">1087</span></a>
</span><span id="Faults.build_faults-1088"><a href="#-1088"><span class="linenos">1088</span></a>                <span class="n">sum_displacements</span> <span class="o">+=</span> <span class="n">displacement</span>
</span><span id="Faults.build_faults-1089"><a href="#-1089"><span class="linenos">1089</span></a>
</span><span id="Faults.build_faults-1090"><a href="#-1090"><span class="linenos">1090</span></a>                <span class="c1"># apply fault to depth_cube</span>
</span><span id="Faults.build_faults-1091"><a href="#-1091"><span class="linenos">1091</span></a>                <span class="k">if</span> <span class="n">ifault</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Faults.build_faults-1092"><a href="#-1092"><span class="linenos">1092</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;      .... set _unfaulted_depths to array with all zeros...&quot;</span><span class="p">)</span>
</span><span id="Faults.build_faults-1093"><a href="#-1093"><span class="linenos">1093</span></a>                    <span class="n">_faulted_depths</span> <span class="o">=</span> <span class="n">unfaulted_depths</span> <span class="o">*</span> <span class="mf">1.0</span>
</span><span id="Faults.build_faults-1094"><a href="#-1094"><span class="linenos">1094</span></a>                    <span class="n">adjusted_faulted_depths</span> <span class="o">=</span> <span class="p">(</span><span class="n">unfaulted_depths</span> <span class="o">-</span> <span class="n">displacement</span><span class="p">)</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span>
</span><span id="Faults.build_faults-1095"><a href="#-1095"><span class="linenos">1095</span></a>                        <span class="mi">0</span><span class="p">,</span> <span class="n">ellipsoid</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>
</span><span id="Faults.build_faults-1096"><a href="#-1096"><span class="linenos">1096</span></a>                    <span class="p">)</span>
</span><span id="Faults.build_faults-1097"><a href="#-1097"><span class="linenos">1097</span></a>                    <span class="n">_faulted_depths</span> <span class="o">=</span> <span class="n">apply_faulting</span><span class="p">(</span>
</span><span id="Faults.build_faults-1098"><a href="#-1098"><span class="linenos">1098</span></a>                        <span class="n">_faulted_depths</span><span class="p">,</span> <span class="n">adjusted_faulted_depths</span>
</span><span id="Faults.build_faults-1099"><a href="#-1099"><span class="linenos">1099</span></a>                    <span class="p">)</span>
</span><span id="Faults.build_faults-1100"><a href="#-1100"><span class="linenos">1100</span></a>                    <span class="n">_mft</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_fault_throw</span><span class="p">[:]</span>
</span><span id="Faults.build_faults-1101"><a href="#-1101"><span class="linenos">1101</span></a>                    <span class="n">_mft</span><span class="p">[</span><span class="n">ellipsoid</span> <span class="o">&lt;=</span> <span class="mf">1.0</span><span class="p">]</span> <span class="o">=</span> <span class="n">throw</span>
</span><span id="Faults.build_faults-1102"><a href="#-1102"><span class="linenos">1102</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">max_fault_throw</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">_mft</span>
</span><span id="Faults.build_faults-1103"><a href="#-1103"><span class="linenos">1103</span></a>                    <span class="k">del</span> <span class="n">_mft</span>
</span><span id="Faults.build_faults-1104"><a href="#-1104"><span class="linenos">1104</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">fault_planes</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">fault_segm</span> <span class="o">*</span> <span class="mf">1.0</span>
</span><span id="Faults.build_faults-1105"><a href="#-1105"><span class="linenos">1105</span></a>                    <span class="n">_fault_intersections</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fault_intersections</span><span class="p">[:]</span>
</span><span id="Faults.build_faults-1106"><a href="#-1106"><span class="linenos">1106</span></a>                    <span class="n">previous_intersection_voxel_count</span> <span class="o">=</span> <span class="n">_fault_intersections</span><span class="p">[</span>
</span><span id="Faults.build_faults-1107"><a href="#-1107"><span class="linenos">1107</span></a>                        <span class="n">_fault_intersections</span> <span class="o">&gt;</span> <span class="mf">1.1</span>
</span><span id="Faults.build_faults-1108"><a href="#-1108"><span class="linenos">1108</span></a>                    <span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="Faults.build_faults-1109"><a href="#-1109"><span class="linenos">1109</span></a>                    <span class="n">_fault_intersections</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fault_planes</span><span class="p">[:]</span> <span class="o">*</span> <span class="mf">1.0</span>
</span><span id="Faults.build_faults-1110"><a href="#-1110"><span class="linenos">1110</span></a>                    <span class="k">if</span> <span class="p">(</span>
</span><span id="Faults.build_faults-1111"><a href="#-1111"><span class="linenos">1111</span></a>                        <span class="n">_fault_intersections</span><span class="p">[</span><span class="n">_fault_intersections</span> <span class="o">&gt;</span> <span class="mf">1.1</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="Faults.build_faults-1112"><a href="#-1112"><span class="linenos">1112</span></a>                        <span class="o">&gt;</span> <span class="n">previous_intersection_voxel_count</span>
</span><span id="Faults.build_faults-1113"><a href="#-1113"><span class="linenos">1113</span></a>                    <span class="p">):</span>
</span><span id="Faults.build_faults-1114"><a href="#-1114"><span class="linenos">1114</span></a>                        <span class="n">number_fault_intersections</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="Faults.build_faults-1115"><a href="#-1115"><span class="linenos">1115</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">fault_intersections</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">_fault_intersections</span>
</span><span id="Faults.build_faults-1116"><a href="#-1116"><span class="linenos">1116</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">fault_plane_throw</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">fault_plane_displacement</span> <span class="o">*</span> <span class="mf">1.0</span>
</span><span id="Faults.build_faults-1117"><a href="#-1117"><span class="linenos">1117</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">fault_plane_azimuth</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">strike_angle</span> <span class="o">*</span> <span class="mf">1.0</span>
</span><span id="Faults.build_faults-1118"><a href="#-1118"><span class="linenos">1118</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Faults.build_faults-1119"><a href="#-1119"><span class="linenos">1119</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="Faults.build_faults-1120"><a href="#-1120"><span class="linenos">1120</span></a>                        <span class="s2">&quot;      .... update _unfaulted_depths array using faulted depths...&quot;</span>
</span><span id="Faults.build_faults-1121"><a href="#-1121"><span class="linenos">1121</span></a>                    <span class="p">)</span>
</span><span id="Faults.build_faults-1122"><a href="#-1122"><span class="linenos">1122</span></a>                    <span class="k">try</span><span class="p">:</span>
</span><span id="Faults.build_faults-1123"><a href="#-1123"><span class="linenos">1123</span></a>                        <span class="nb">print</span><span class="p">(</span>
</span><span id="Faults.build_faults-1124"><a href="#-1124"><span class="linenos">1124</span></a>                            <span class="s2">&quot;          .... (before) _faulted_depths.mean() = &quot;</span>
</span><span id="Faults.build_faults-1125"><a href="#-1125"><span class="linenos">1125</span></a>                            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">_faulted_depths</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
</span><span id="Faults.build_faults-1126"><a href="#-1126"><span class="linenos">1126</span></a>                        <span class="p">)</span>
</span><span id="Faults.build_faults-1127"><a href="#-1127"><span class="linenos">1127</span></a>                    <span class="k">except</span><span class="p">:</span>
</span><span id="Faults.build_faults-1128"><a href="#-1128"><span class="linenos">1128</span></a>                        <span class="n">_faulted_depths</span> <span class="o">=</span> <span class="n">unfaulted_depths</span> <span class="o">*</span> <span class="mf">1.0</span>
</span><span id="Faults.build_faults-1129"><a href="#-1129"><span class="linenos">1129</span></a>                    <span class="n">adjusted_faulted_depths</span> <span class="o">=</span> <span class="p">(</span><span class="n">unfaulted_depths</span> <span class="o">-</span> <span class="n">displacement</span><span class="p">)</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span>
</span><span id="Faults.build_faults-1130"><a href="#-1130"><span class="linenos">1130</span></a>                        <span class="mi">0</span><span class="p">,</span> <span class="n">ellipsoid</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>
</span><span id="Faults.build_faults-1131"><a href="#-1131"><span class="linenos">1131</span></a>                    <span class="p">)</span>
</span><span id="Faults.build_faults-1132"><a href="#-1132"><span class="linenos">1132</span></a>                    <span class="n">_faulted_depths</span> <span class="o">=</span> <span class="n">apply_faulting</span><span class="p">(</span>
</span><span id="Faults.build_faults-1133"><a href="#-1133"><span class="linenos">1133</span></a>                        <span class="n">_faulted_depths</span><span class="p">,</span> <span class="n">adjusted_faulted_depths</span>
</span><span id="Faults.build_faults-1134"><a href="#-1134"><span class="linenos">1134</span></a>                    <span class="p">)</span>
</span><span id="Faults.build_faults-1135"><a href="#-1135"><span class="linenos">1135</span></a>
</span><span id="Faults.build_faults-1136"><a href="#-1136"><span class="linenos">1136</span></a>                    <span class="n">_fault_planes</span> <span class="o">=</span> <span class="n">apply_faulting</span><span class="p">(</span>
</span><span id="Faults.build_faults-1137"><a href="#-1137"><span class="linenos">1137</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">fault_planes</span><span class="p">[:],</span> <span class="n">adjusted_faulted_depths</span>
</span><span id="Faults.build_faults-1138"><a href="#-1138"><span class="linenos">1138</span></a>                    <span class="p">)</span>
</span><span id="Faults.build_faults-1139"><a href="#-1139"><span class="linenos">1139</span></a>                    <span class="k">if</span> <span class="p">(</span>
</span><span id="Faults.build_faults-1140"><a href="#-1140"><span class="linenos">1140</span></a>                        <span class="n">_fault_planes</span><span class="p">[</span>
</span><span id="Faults.build_faults-1141"><a href="#-1141"><span class="linenos">1141</span></a>                            <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="mf">0.0</span> <span class="o">&lt;</span> <span class="n">_fault_planes</span><span class="p">,</span> <span class="n">_fault_planes</span> <span class="o">&lt;</span> <span class="mf">0.25</span><span class="p">)</span>
</span><span id="Faults.build_faults-1142"><a href="#-1142"><span class="linenos">1142</span></a>                        <span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="Faults.build_faults-1143"><a href="#-1143"><span class="linenos">1143</span></a>                        <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Faults.build_faults-1144"><a href="#-1144"><span class="linenos">1144</span></a>                    <span class="p">):</span>
</span><span id="Faults.build_faults-1145"><a href="#-1145"><span class="linenos">1145</span></a>                        <span class="n">_fault_planes</span><span class="p">[</span>
</span><span id="Faults.build_faults-1146"><a href="#-1146"><span class="linenos">1146</span></a>                            <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="mf">0.0</span> <span class="o">&lt;</span> <span class="n">_fault_planes</span><span class="p">,</span> <span class="n">_fault_planes</span> <span class="o">&lt;</span> <span class="mf">0.25</span><span class="p">)</span>
</span><span id="Faults.build_faults-1147"><a href="#-1147"><span class="linenos">1147</span></a>                        <span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="Faults.build_faults-1148"><a href="#-1148"><span class="linenos">1148</span></a>                    <span class="k">if</span> <span class="p">(</span>
</span><span id="Faults.build_faults-1149"><a href="#-1149"><span class="linenos">1149</span></a>                        <span class="n">_fault_planes</span><span class="p">[</span>
</span><span id="Faults.build_faults-1150"><a href="#-1150"><span class="linenos">1150</span></a>                            <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="mf">0.25</span> <span class="o">&lt;</span> <span class="n">_fault_planes</span><span class="p">,</span> <span class="n">_fault_planes</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">)</span>
</span><span id="Faults.build_faults-1151"><a href="#-1151"><span class="linenos">1151</span></a>                        <span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="Faults.build_faults-1152"><a href="#-1152"><span class="linenos">1152</span></a>                        <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Faults.build_faults-1153"><a href="#-1153"><span class="linenos">1153</span></a>                    <span class="p">):</span>
</span><span id="Faults.build_faults-1154"><a href="#-1154"><span class="linenos">1154</span></a>                        <span class="n">_fault_planes</span><span class="p">[</span>
</span><span id="Faults.build_faults-1155"><a href="#-1155"><span class="linenos">1155</span></a>                            <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="mf">0.25</span> <span class="o">&lt;</span> <span class="n">_fault_planes</span><span class="p">,</span> <span class="n">_fault_planes</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">)</span>
</span><span id="Faults.build_faults-1156"><a href="#-1156"><span class="linenos">1156</span></a>                        <span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="Faults.build_faults-1157"><a href="#-1157"><span class="linenos">1157</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">fault_planes</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">_fault_planes</span>
</span><span id="Faults.build_faults-1158"><a href="#-1158"><span class="linenos">1158</span></a>                    <span class="k">del</span> <span class="n">_fault_planes</span>
</span><span id="Faults.build_faults-1159"><a href="#-1159"><span class="linenos">1159</span></a>
</span><span id="Faults.build_faults-1160"><a href="#-1160"><span class="linenos">1160</span></a>                    <span class="n">_fault_intersections</span> <span class="o">=</span> <span class="n">apply_faulting</span><span class="p">(</span>
</span><span id="Faults.build_faults-1161"><a href="#-1161"><span class="linenos">1161</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">fault_intersections</span><span class="p">[:],</span> <span class="n">adjusted_faulted_depths</span>
</span><span id="Faults.build_faults-1162"><a href="#-1162"><span class="linenos">1162</span></a>                    <span class="p">)</span>
</span><span id="Faults.build_faults-1163"><a href="#-1163"><span class="linenos">1163</span></a>                    <span class="k">if</span> <span class="p">(</span>
</span><span id="Faults.build_faults-1164"><a href="#-1164"><span class="linenos">1164</span></a>                        <span class="n">_fault_intersections</span><span class="p">[</span>
</span><span id="Faults.build_faults-1165"><a href="#-1165"><span class="linenos">1165</span></a>                            <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span>
</span><span id="Faults.build_faults-1166"><a href="#-1166"><span class="linenos">1166</span></a>                                <span class="mf">1.25</span> <span class="o">&lt;</span> <span class="n">_fault_intersections</span><span class="p">,</span> <span class="n">_fault_intersections</span> <span class="o">&lt;</span> <span class="mf">2.0</span>
</span><span id="Faults.build_faults-1167"><a href="#-1167"><span class="linenos">1167</span></a>                            <span class="p">)</span>
</span><span id="Faults.build_faults-1168"><a href="#-1168"><span class="linenos">1168</span></a>                        <span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="Faults.build_faults-1169"><a href="#-1169"><span class="linenos">1169</span></a>                        <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Faults.build_faults-1170"><a href="#-1170"><span class="linenos">1170</span></a>                    <span class="p">):</span>
</span><span id="Faults.build_faults-1171"><a href="#-1171"><span class="linenos">1171</span></a>                        <span class="n">_fault_intersections</span><span class="p">[</span>
</span><span id="Faults.build_faults-1172"><a href="#-1172"><span class="linenos">1172</span></a>                            <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span>
</span><span id="Faults.build_faults-1173"><a href="#-1173"><span class="linenos">1173</span></a>                                <span class="mf">1.25</span> <span class="o">&lt;</span> <span class="n">_fault_intersections</span><span class="p">,</span> <span class="n">_fault_intersections</span> <span class="o">&lt;</span> <span class="mf">2.0</span>
</span><span id="Faults.build_faults-1174"><a href="#-1174"><span class="linenos">1174</span></a>                            <span class="p">)</span>
</span><span id="Faults.build_faults-1175"><a href="#-1175"><span class="linenos">1175</span></a>                        <span class="p">]</span> <span class="o">=</span> <span class="mf">2.0</span>
</span><span id="Faults.build_faults-1176"><a href="#-1176"><span class="linenos">1176</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">fault_intersections</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">_fault_intersections</span>
</span><span id="Faults.build_faults-1177"><a href="#-1177"><span class="linenos">1177</span></a>                    <span class="k">del</span> <span class="n">_fault_intersections</span>
</span><span id="Faults.build_faults-1178"><a href="#-1178"><span class="linenos">1178</span></a>
</span><span id="Faults.build_faults-1179"><a href="#-1179"><span class="linenos">1179</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">max_fault_throw</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">apply_faulting</span><span class="p">(</span>
</span><span id="Faults.build_faults-1180"><a href="#-1180"><span class="linenos">1180</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">max_fault_throw</span><span class="p">[:],</span> <span class="n">adjusted_faulted_depths</span>
</span><span id="Faults.build_faults-1181"><a href="#-1181"><span class="linenos">1181</span></a>                    <span class="p">)</span>
</span><span id="Faults.build_faults-1182"><a href="#-1182"><span class="linenos">1182</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">fault_plane_throw</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">apply_faulting</span><span class="p">(</span>
</span><span id="Faults.build_faults-1183"><a href="#-1183"><span class="linenos">1183</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">fault_plane_throw</span><span class="p">[:],</span> <span class="n">adjusted_faulted_depths</span>
</span><span id="Faults.build_faults-1184"><a href="#-1184"><span class="linenos">1184</span></a>                    <span class="p">)</span>
</span><span id="Faults.build_faults-1185"><a href="#-1185"><span class="linenos">1185</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">fault_plane_azimuth</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">apply_faulting</span><span class="p">(</span>
</span><span id="Faults.build_faults-1186"><a href="#-1186"><span class="linenos">1186</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">fault_plane_azimuth</span><span class="p">[:],</span> <span class="n">adjusted_faulted_depths</span>
</span><span id="Faults.build_faults-1187"><a href="#-1187"><span class="linenos">1187</span></a>                    <span class="p">)</span>
</span><span id="Faults.build_faults-1188"><a href="#-1188"><span class="linenos">1188</span></a>
</span><span id="Faults.build_faults-1189"><a href="#-1189"><span class="linenos">1189</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">fault_planes</span><span class="p">[:]</span> <span class="o">+=</span> <span class="n">fault_segm</span>
</span><span id="Faults.build_faults-1190"><a href="#-1190"><span class="linenos">1190</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">fault_intersections</span><span class="p">[:]</span> <span class="o">+=</span> <span class="n">fault_segm</span>
</span><span id="Faults.build_faults-1191"><a href="#-1191"><span class="linenos">1191</span></a>                    <span class="n">_mft</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_fault_throw</span><span class="p">[:]</span>
</span><span id="Faults.build_faults-1192"><a href="#-1192"><span class="linenos">1192</span></a>                    <span class="n">_mft</span><span class="p">[</span><span class="n">ellipsoid</span> <span class="o">&lt;=</span> <span class="mf">1.0</span><span class="p">]</span> <span class="o">+=</span> <span class="n">throw</span>
</span><span id="Faults.build_faults-1193"><a href="#-1193"><span class="linenos">1193</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">max_fault_throw</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">_mft</span>
</span><span id="Faults.build_faults-1194"><a href="#-1194"><span class="linenos">1194</span></a>                    <span class="k">del</span> <span class="n">_mft</span>
</span><span id="Faults.build_faults-1195"><a href="#-1195"><span class="linenos">1195</span></a>
</span><span id="Faults.build_faults-1196"><a href="#-1196"><span class="linenos">1196</span></a>                    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="Faults.build_faults-1197"><a href="#-1197"><span class="linenos">1197</span></a>                        <span class="nb">print</span><span class="p">(</span>
</span><span id="Faults.build_faults-1198"><a href="#-1198"><span class="linenos">1198</span></a>                            <span class="s2">&quot;   ... fault_plane_displacement[fault_plane_displacement &gt; 0.].size = &quot;</span>
</span><span id="Faults.build_faults-1199"><a href="#-1199"><span class="linenos">1199</span></a>                            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="Faults.build_faults-1200"><a href="#-1200"><span class="linenos">1200</span></a>                                <span class="n">fault_plane_displacement</span><span class="p">[</span>
</span><span id="Faults.build_faults-1201"><a href="#-1201"><span class="linenos">1201</span></a>                                    <span class="n">fault_plane_displacement</span> <span class="o">&gt;</span> <span class="mf">0.0</span>
</span><span id="Faults.build_faults-1202"><a href="#-1202"><span class="linenos">1202</span></a>                                <span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="Faults.build_faults-1203"><a href="#-1203"><span class="linenos">1203</span></a>                            <span class="p">)</span>
</span><span id="Faults.build_faults-1204"><a href="#-1204"><span class="linenos">1204</span></a>                        <span class="p">)</span>
</span><span id="Faults.build_faults-1205"><a href="#-1205"><span class="linenos">1205</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">fault_plane_throw</span><span class="p">[</span>
</span><span id="Faults.build_faults-1206"><a href="#-1206"><span class="linenos">1206</span></a>                        <span class="n">fault_plane_displacement</span> <span class="o">&gt;</span> <span class="mf">0.0</span>
</span><span id="Faults.build_faults-1207"><a href="#-1207"><span class="linenos">1207</span></a>                    <span class="p">]</span> <span class="o">=</span> <span class="n">fault_plane_displacement</span><span class="p">[</span><span class="n">fault_plane_displacement</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">]</span>
</span><span id="Faults.build_faults-1208"><a href="#-1208"><span class="linenos">1208</span></a>                    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="Faults.build_faults-1209"><a href="#-1209"><span class="linenos">1209</span></a>                        <span class="nb">print</span><span class="p">(</span>
</span><span id="Faults.build_faults-1210"><a href="#-1210"><span class="linenos">1210</span></a>                            <span class="s2">&quot;   ... self.fault_plane_throw[self.fault_plane_throw &gt; 0.].size = &quot;</span>
</span><span id="Faults.build_faults-1211"><a href="#-1211"><span class="linenos">1211</span></a>                            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="Faults.build_faults-1212"><a href="#-1212"><span class="linenos">1212</span></a>                                <span class="bp">self</span><span class="o">.</span><span class="n">fault_plane_throw</span><span class="p">[</span>
</span><span id="Faults.build_faults-1213"><a href="#-1213"><span class="linenos">1213</span></a>                                    <span class="bp">self</span><span class="o">.</span><span class="n">fault_plane_throw</span> <span class="o">&gt;</span> <span class="mf">0.0</span>
</span><span id="Faults.build_faults-1214"><a href="#-1214"><span class="linenos">1214</span></a>                                <span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="Faults.build_faults-1215"><a href="#-1215"><span class="linenos">1215</span></a>                            <span class="p">)</span>
</span><span id="Faults.build_faults-1216"><a href="#-1216"><span class="linenos">1216</span></a>                        <span class="p">)</span>
</span><span id="Faults.build_faults-1217"><a href="#-1217"><span class="linenos">1217</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">fault_plane_azimuth</span><span class="p">[</span><span class="n">fault_segm</span> <span class="o">&gt;</span> <span class="mf">0.9</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="Faults.build_faults-1218"><a href="#-1218"><span class="linenos">1218</span></a>                        <span class="n">strike_angle</span><span class="p">[</span><span class="n">fault_segm</span> <span class="o">&gt;</span> <span class="mf">0.9</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1.0</span>
</span><span id="Faults.build_faults-1219"><a href="#-1219"><span class="linenos">1219</span></a>                    <span class="p">)</span>
</span><span id="Faults.build_faults-1220"><a href="#-1220"><span class="linenos">1220</span></a>
</span><span id="Faults.build_faults-1221"><a href="#-1221"><span class="linenos">1221</span></a>                    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="Faults.build_faults-1222"><a href="#-1222"><span class="linenos">1222</span></a>                        <span class="nb">print</span><span class="p">(</span>
</span><span id="Faults.build_faults-1223"><a href="#-1223"><span class="linenos">1223</span></a>                            <span class="s2">&quot;          .... (after) _faulted_depths.mean() = &quot;</span>
</span><span id="Faults.build_faults-1224"><a href="#-1224"><span class="linenos">1224</span></a>                            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">_faulted_depths</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
</span><span id="Faults.build_faults-1225"><a href="#-1225"><span class="linenos">1225</span></a>                        <span class="p">)</span>
</span><span id="Faults.build_faults-1226"><a href="#-1226"><span class="linenos">1226</span></a>
</span><span id="Faults.build_faults-1227"><a href="#-1227"><span class="linenos">1227</span></a>                    <span class="c1"># fix interpolated values in max_fault_throw</span>
</span><span id="Faults.build_faults-1228"><a href="#-1228"><span class="linenos">1228</span></a>                    <span class="n">max_fault_throw_list</span><span class="p">,</span> <span class="n">max_fault_throw_list_counts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span>
</span><span id="Faults.build_faults-1229"><a href="#-1229"><span class="linenos">1229</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">max_fault_throw</span><span class="p">,</span> <span class="n">return_counts</span><span class="o">=</span><span class="kc">True</span>
</span><span id="Faults.build_faults-1230"><a href="#-1230"><span class="linenos">1230</span></a>                    <span class="p">)</span>
</span><span id="Faults.build_faults-1231"><a href="#-1231"><span class="linenos">1231</span></a>                    <span class="n">max_fault_throw_list</span> <span class="o">=</span> <span class="n">max_fault_throw_list</span><span class="p">[</span>
</span><span id="Faults.build_faults-1232"><a href="#-1232"><span class="linenos">1232</span></a>                        <span class="n">max_fault_throw_list_counts</span> <span class="o">&gt;</span> <span class="mi">500</span>
</span><span id="Faults.build_faults-1233"><a href="#-1233"><span class="linenos">1233</span></a>                    <span class="p">]</span>
</span><span id="Faults.build_faults-1234"><a href="#-1234"><span class="linenos">1234</span></a>                    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="Faults.build_faults-1235"><a href="#-1235"><span class="linenos">1235</span></a>                        <span class="nb">print</span><span class="p">(</span>
</span><span id="Faults.build_faults-1236"><a href="#-1236"><span class="linenos">1236</span></a>                            <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">   ...max_fault_throw_list = &quot;</span>
</span><span id="Faults.build_faults-1237"><a href="#-1237"><span class="linenos">1237</span></a>                            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">max_fault_throw_list</span><span class="p">)</span>
</span><span id="Faults.build_faults-1238"><a href="#-1238"><span class="linenos">1238</span></a>                            <span class="o">+</span> <span class="s2">&quot;, &quot;</span>
</span><span id="Faults.build_faults-1239"><a href="#-1239"><span class="linenos">1239</span></a>                            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">max_fault_throw_list_counts</span><span class="p">)</span>
</span><span id="Faults.build_faults-1240"><a href="#-1240"><span class="linenos">1240</span></a>                        <span class="p">)</span>
</span><span id="Faults.build_faults-1241"><a href="#-1241"><span class="linenos">1241</span></a>                    <span class="n">mfts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_fault_throw</span><span class="o">.</span><span class="n">shape</span>
</span><span id="Faults.build_faults-1242"><a href="#-1242"><span class="linenos">1242</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_remove_node_list</span><span class="p">(</span><span class="s2">&quot;max_fault_throw_4d_diff&quot;</span><span class="p">)</span>
</span><span id="Faults.build_faults-1243"><a href="#-1243"><span class="linenos">1243</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_remove_node_list</span><span class="p">(</span><span class="s2">&quot;max_fault_throw_4d&quot;</span><span class="p">)</span>
</span><span id="Faults.build_faults-1244"><a href="#-1244"><span class="linenos">1244</span></a>                    <span class="n">max_fault_throw_4d_diff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="Faults.build_faults-1245"><a href="#-1245"><span class="linenos">1245</span></a>                        <span class="s2">&quot;max_fault_throw_4d_diff&quot;</span><span class="p">,</span>
</span><span id="Faults.build_faults-1246"><a href="#-1246"><span class="linenos">1246</span></a>                        <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">mfts</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">mfts</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">mfts</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">max_fault_throw_list</span><span class="o">.</span><span class="n">size</span><span class="p">),</span>
</span><span id="Faults.build_faults-1247"><a href="#-1247"><span class="linenos">1247</span></a>                    <span class="p">)</span>
</span><span id="Faults.build_faults-1248"><a href="#-1248"><span class="linenos">1248</span></a>                    <span class="n">max_fault_throw_4d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="Faults.build_faults-1249"><a href="#-1249"><span class="linenos">1249</span></a>                        <span class="s2">&quot;max_fault_throw_4d&quot;</span><span class="p">,</span>
</span><span id="Faults.build_faults-1250"><a href="#-1250"><span class="linenos">1250</span></a>                        <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">mfts</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">mfts</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">mfts</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">max_fault_throw_list</span><span class="o">.</span><span class="n">size</span><span class="p">),</span>
</span><span id="Faults.build_faults-1251"><a href="#-1251"><span class="linenos">1251</span></a>                    <span class="p">)</span>
</span><span id="Faults.build_faults-1252"><a href="#-1252"><span class="linenos">1252</span></a>                    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="Faults.build_faults-1253"><a href="#-1253"><span class="linenos">1253</span></a>                        <span class="nb">print</span><span class="p">(</span>
</span><span id="Faults.build_faults-1254"><a href="#-1254"><span class="linenos">1254</span></a>                            <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">   ...max_fault_throw_4d.shape = &quot;</span>
</span><span id="Faults.build_faults-1255"><a href="#-1255"><span class="linenos">1255</span></a>                            <span class="o">+</span> <span class="s2">&quot;, &quot;</span>
</span><span id="Faults.build_faults-1256"><a href="#-1256"><span class="linenos">1256</span></a>                            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">max_fault_throw_4d</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span><span id="Faults.build_faults-1257"><a href="#-1257"><span class="linenos">1257</span></a>                        <span class="p">)</span>
</span><span id="Faults.build_faults-1258"><a href="#-1258"><span class="linenos">1258</span></a>                    <span class="n">_max_fault_throw_4d_diff</span> <span class="o">=</span> <span class="n">max_fault_throw_4d_diff</span><span class="p">[:]</span>
</span><span id="Faults.build_faults-1259"><a href="#-1259"><span class="linenos">1259</span></a>                    <span class="n">_max_fault_throw_4d</span> <span class="o">=</span> <span class="n">max_fault_throw_4d</span><span class="p">[:]</span>
</span><span id="Faults.build_faults-1260"><a href="#-1260"><span class="linenos">1260</span></a>                    <span class="k">for</span> <span class="n">imft</span><span class="p">,</span> <span class="n">mft</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">max_fault_throw_list</span><span class="p">):</span>
</span><span id="Faults.build_faults-1261"><a href="#-1261"><span class="linenos">1261</span></a>                        <span class="nb">print</span><span class="p">(</span>
</span><span id="Faults.build_faults-1262"><a href="#-1262"><span class="linenos">1262</span></a>                            <span class="s2">&quot;      ... imft, mft, max_fault_throw_4d_diff[:,:,:,imft].shape = &quot;</span>
</span><span id="Faults.build_faults-1263"><a href="#-1263"><span class="linenos">1263</span></a>                            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="Faults.build_faults-1264"><a href="#-1264"><span class="linenos">1264</span></a>                                <span class="p">(</span>
</span><span id="Faults.build_faults-1265"><a href="#-1265"><span class="linenos">1265</span></a>                                    <span class="n">imft</span><span class="p">,</span>
</span><span id="Faults.build_faults-1266"><a href="#-1266"><span class="linenos">1266</span></a>                                    <span class="n">mft</span><span class="p">,</span>
</span><span id="Faults.build_faults-1267"><a href="#-1267"><span class="linenos">1267</span></a>                                    <span class="n">max_fault_throw_4d_diff</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="n">imft</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
</span><span id="Faults.build_faults-1268"><a href="#-1268"><span class="linenos">1268</span></a>                                <span class="p">)</span>
</span><span id="Faults.build_faults-1269"><a href="#-1269"><span class="linenos">1269</span></a>                            <span class="p">)</span>
</span><span id="Faults.build_faults-1270"><a href="#-1270"><span class="linenos">1270</span></a>                        <span class="p">)</span>
</span><span id="Faults.build_faults-1271"><a href="#-1271"><span class="linenos">1271</span></a>                        <span class="n">_max_fault_throw_4d_diff</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="n">imft</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span>
</span><span id="Faults.build_faults-1272"><a href="#-1272"><span class="linenos">1272</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">max_fault_throw</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">-</span> <span class="n">mft</span>
</span><span id="Faults.build_faults-1273"><a href="#-1273"><span class="linenos">1273</span></a>                        <span class="p">)</span>
</span><span id="Faults.build_faults-1274"><a href="#-1274"><span class="linenos">1274</span></a>                        <span class="n">_max_fault_throw_4d</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="n">imft</span><span class="p">]</span> <span class="o">=</span> <span class="n">mft</span>
</span><span id="Faults.build_faults-1275"><a href="#-1275"><span class="linenos">1275</span></a>                    <span class="n">max_fault_throw_4d</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">_max_fault_throw_4d</span>
</span><span id="Faults.build_faults-1276"><a href="#-1276"><span class="linenos">1276</span></a>                    <span class="n">max_fault_throw_4d_diff</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">_max_fault_throw_4d_diff</span>
</span><span id="Faults.build_faults-1277"><a href="#-1277"><span class="linenos">1277</span></a>                    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="Faults.build_faults-1278"><a href="#-1278"><span class="linenos">1278</span></a>                        <span class="nb">print</span><span class="p">(</span>
</span><span id="Faults.build_faults-1279"><a href="#-1279"><span class="linenos">1279</span></a>                            <span class="s2">&quot;   ...np.argmin(max_fault_throw_4d_diff, axis=-1).shape = &quot;</span>
</span><span id="Faults.build_faults-1280"><a href="#-1280"><span class="linenos">1280</span></a>                            <span class="o">+</span> <span class="s2">&quot;, &quot;</span>
</span><span id="Faults.build_faults-1281"><a href="#-1281"><span class="linenos">1281</span></a>                            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">max_fault_throw_4d_diff</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span><span id="Faults.build_faults-1282"><a href="#-1282"><span class="linenos">1282</span></a>                        <span class="p">)</span>
</span><span id="Faults.build_faults-1283"><a href="#-1283"><span class="linenos">1283</span></a>                    <span class="n">indices_nearest_throw</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">max_fault_throw_4d_diff</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="Faults.build_faults-1284"><a href="#-1284"><span class="linenos">1284</span></a>                    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="Faults.build_faults-1285"><a href="#-1285"><span class="linenos">1285</span></a>                        <span class="nb">print</span><span class="p">(</span>
</span><span id="Faults.build_faults-1286"><a href="#-1286"><span class="linenos">1286</span></a>                            <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">   ...indices_nearest_throw.shape = &quot;</span>
</span><span id="Faults.build_faults-1287"><a href="#-1287"><span class="linenos">1287</span></a>                            <span class="o">+</span> <span class="s2">&quot;, &quot;</span>
</span><span id="Faults.build_faults-1288"><a href="#-1288"><span class="linenos">1288</span></a>                            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">indices_nearest_throw</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span><span id="Faults.build_faults-1289"><a href="#-1289"><span class="linenos">1289</span></a>                        <span class="p">)</span>
</span><span id="Faults.build_faults-1290"><a href="#-1290"><span class="linenos">1290</span></a>                    <span class="n">_max_fault_throw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_fault_throw</span><span class="p">[:]</span>
</span><span id="Faults.build_faults-1291"><a href="#-1291"><span class="linenos">1291</span></a>                    <span class="k">for</span> <span class="n">imft</span><span class="p">,</span> <span class="n">mft</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">max_fault_throw_list</span><span class="p">):</span>
</span><span id="Faults.build_faults-1292"><a href="#-1292"><span class="linenos">1292</span></a>                        <span class="n">_max_fault_throw</span><span class="p">[</span><span class="n">indices_nearest_throw</span> <span class="o">==</span> <span class="n">imft</span><span class="p">]</span> <span class="o">=</span> <span class="n">mft</span>
</span><span id="Faults.build_faults-1293"><a href="#-1293"><span class="linenos">1293</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">max_fault_throw</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">_max_fault_throw</span>
</span><span id="Faults.build_faults-1294"><a href="#-1294"><span class="linenos">1294</span></a>
</span><span id="Faults.build_faults-1295"><a href="#-1295"><span class="linenos">1295</span></a>                    <span class="k">del</span> <span class="n">_max_fault_throw</span>
</span><span id="Faults.build_faults-1296"><a href="#-1296"><span class="linenos">1296</span></a>                    <span class="k">del</span> <span class="n">adjusted_faulted_depths</span>
</span><span id="Faults.build_faults-1297"><a href="#-1297"><span class="linenos">1297</span></a>
</span><span id="Faults.build_faults-1298"><a href="#-1298"><span class="linenos">1298</span></a>                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="Faults.build_faults-1299"><a href="#-1299"><span class="linenos">1299</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="Faults.build_faults-1300"><a href="#-1300"><span class="linenos">1300</span></a>                        <span class="s2">&quot;   ...fault_segm[fault_segm&gt;0.].size = &quot;</span>
</span><span id="Faults.build_faults-1301"><a href="#-1301"><span class="linenos">1301</span></a>                        <span class="o">+</span> <span class="s2">&quot;, &quot;</span>
</span><span id="Faults.build_faults-1302"><a href="#-1302"><span class="linenos">1302</span></a>                        <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">fault_segm</span><span class="p">[</span><span class="n">fault_segm</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
</span><span id="Faults.build_faults-1303"><a href="#-1303"><span class="linenos">1303</span></a>                    <span class="p">)</span>
</span><span id="Faults.build_faults-1304"><a href="#-1304"><span class="linenos">1304</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   ...fault_segm.min() = &quot;</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">fault_segm</span><span class="o">.</span><span class="n">min</span><span class="p">()))</span>
</span><span id="Faults.build_faults-1305"><a href="#-1305"><span class="linenos">1305</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   ...fault_segm.max() = &quot;</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">fault_segm</span><span class="o">.</span><span class="n">max</span><span class="p">()))</span>
</span><span id="Faults.build_faults-1306"><a href="#-1306"><span class="linenos">1306</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="Faults.build_faults-1307"><a href="#-1307"><span class="linenos">1307</span></a>                        <span class="s2">&quot;   ...self.fault_planes.max() = &quot;</span>
</span><span id="Faults.build_faults-1308"><a href="#-1308"><span class="linenos">1308</span></a>                        <span class="o">+</span> <span class="s2">&quot;, &quot;</span>
</span><span id="Faults.build_faults-1309"><a href="#-1309"><span class="linenos">1309</span></a>                        <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fault_planes</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
</span><span id="Faults.build_faults-1310"><a href="#-1310"><span class="linenos">1310</span></a>                    <span class="p">)</span>
</span><span id="Faults.build_faults-1311"><a href="#-1311"><span class="linenos">1311</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="Faults.build_faults-1312"><a href="#-1312"><span class="linenos">1312</span></a>                        <span class="s2">&quot;   ...self.fault_intersections.max() = &quot;</span>
</span><span id="Faults.build_faults-1313"><a href="#-1313"><span class="linenos">1313</span></a>                        <span class="o">+</span> <span class="s2">&quot;, &quot;</span>
</span><span id="Faults.build_faults-1314"><a href="#-1314"><span class="linenos">1314</span></a>                        <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fault_intersections</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
</span><span id="Faults.build_faults-1315"><a href="#-1315"><span class="linenos">1315</span></a>                    <span class="p">)</span>
</span><span id="Faults.build_faults-1316"><a href="#-1316"><span class="linenos">1316</span></a>
</span><span id="Faults.build_faults-1317"><a href="#-1317"><span class="linenos">1317</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="Faults.build_faults-1318"><a href="#-1318"><span class="linenos">1318</span></a>                        <span class="s2">&quot;   ...list of unique values in self.max_fault_throw = &quot;</span>
</span><span id="Faults.build_faults-1319"><a href="#-1319"><span class="linenos">1319</span></a>                        <span class="o">+</span> <span class="s2">&quot;, &quot;</span>
</span><span id="Faults.build_faults-1320"><a href="#-1320"><span class="linenos">1320</span></a>                        <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_fault_throw</span><span class="p">))</span>
</span><span id="Faults.build_faults-1321"><a href="#-1321"><span class="linenos">1321</span></a>                    <span class="p">)</span>
</span><span id="Faults.build_faults-1322"><a href="#-1322"><span class="linenos">1322</span></a>
</span><span id="Faults.build_faults-1323"><a href="#-1323"><span class="linenos">1323</span></a>                <span class="c1"># TODO: remove this block after qc/tests complete</span>
</span><span id="Faults.build_faults-1324"><a href="#-1324"><span class="linenos">1324</span></a>                <span class="kn">from</span> <span class="nn">datagenerator.util</span> <span class="kn">import</span> <span class="n">import_matplotlib</span>
</span><span id="Faults.build_faults-1325"><a href="#-1325"><span class="linenos">1325</span></a>                <span class="n">plt</span> <span class="o">=</span> <span class="n">import_matplotlib</span><span class="p">()</span>
</span><span id="Faults.build_faults-1326"><a href="#-1326"><span class="linenos">1326</span></a>
</span><span id="Faults.build_faults-1327"><a href="#-1327"><span class="linenos">1327</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="mi">35</span><span class="p">)</span>
</span><span id="Faults.build_faults-1328"><a href="#-1328"><span class="linenos">1328</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">35</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
</span><span id="Faults.build_faults-1329"><a href="#-1329"><span class="linenos">1329</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
</span><span id="Faults.build_faults-1330"><a href="#-1330"><span class="linenos">1330</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">_faulted_depths</span><span class="p">[</span><span class="n">inline</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;prism&quot;</span><span class="p">)</span>
</span><span id="Faults.build_faults-1331"><a href="#-1331"><span class="linenos">1331</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</span><span id="Faults.build_faults-1332"><a href="#-1332"><span class="linenos">1332</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span>
</span><span id="Faults.build_faults-1333"><a href="#-1333"><span class="linenos">1333</span></a>                    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="Faults.build_faults-1334"><a href="#-1334"><span class="linenos">1334</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">work_subfolder</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;faulted_depths_</span><span class="si">{</span><span class="n">ifault</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">.png&quot;</span>
</span><span id="Faults.build_faults-1335"><a href="#-1335"><span class="linenos">1335</span></a>                    <span class="p">),</span>
</span><span id="Faults.build_faults-1336"><a href="#-1336"><span class="linenos">1336</span></a>                    <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;png&quot;</span><span class="p">,</span>
</span><span id="Faults.build_faults-1337"><a href="#-1337"><span class="linenos">1337</span></a>                <span class="p">)</span>
</span><span id="Faults.build_faults-1338"><a href="#-1338"><span class="linenos">1338</span></a>
</span><span id="Faults.build_faults-1339"><a href="#-1339"><span class="linenos">1339</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="mi">35</span><span class="p">)</span>
</span><span id="Faults.build_faults-1340"><a href="#-1340"><span class="linenos">1340</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">36</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
</span><span id="Faults.build_faults-1341"><a href="#-1341"><span class="linenos">1341</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
</span><span id="Faults.build_faults-1342"><a href="#-1342"><span class="linenos">1342</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">displacement</span><span class="p">[</span><span class="n">inline</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;jet&quot;</span><span class="p">)</span>
</span><span id="Faults.build_faults-1343"><a href="#-1343"><span class="linenos">1343</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</span><span id="Faults.build_faults-1344"><a href="#-1344"><span class="linenos">1344</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span>
</span><span id="Faults.build_faults-1345"><a href="#-1345"><span class="linenos">1345</span></a>                    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="Faults.build_faults-1346"><a href="#-1346"><span class="linenos">1346</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">work_subfolder</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;displacement_</span><span class="si">{</span><span class="n">ifault</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">.png&quot;</span>
</span><span id="Faults.build_faults-1347"><a href="#-1347"><span class="linenos">1347</span></a>                    <span class="p">),</span>
</span><span id="Faults.build_faults-1348"><a href="#-1348"><span class="linenos">1348</span></a>                    <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;png&quot;</span><span class="p">,</span>
</span><span id="Faults.build_faults-1349"><a href="#-1349"><span class="linenos">1349</span></a>                <span class="p">)</span>
</span><span id="Faults.build_faults-1350"><a href="#-1350"><span class="linenos">1350</span></a>
</span><span id="Faults.build_faults-1351"><a href="#-1351"><span class="linenos">1351</span></a>                <span class="c1"># TODO: remove this block after qc/tests complete</span>
</span><span id="Faults.build_faults-1352"><a href="#-1352"><span class="linenos">1352</span></a>                <span class="n">_plotarray</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fault_planes</span><span class="p">[</span><span class="n">inline</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Faults.build_faults-1353"><a href="#-1353"><span class="linenos">1353</span></a>                <span class="n">_plotarray</span><span class="p">[</span><span class="n">_plotarray</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
</span><span id="Faults.build_faults-1354"><a href="#-1354"><span class="linenos">1354</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="mi">37</span><span class="p">)</span>
</span><span id="Faults.build_faults-1355"><a href="#-1355"><span class="linenos">1355</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">37</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
</span><span id="Faults.build_faults-1356"><a href="#-1356"><span class="linenos">1356</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
</span><span id="Faults.build_faults-1357"><a href="#-1357"><span class="linenos">1357</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">_plotarray</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;gist_ncar&quot;</span><span class="p">)</span>
</span><span id="Faults.build_faults-1358"><a href="#-1358"><span class="linenos">1358</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</span><span id="Faults.build_faults-1359"><a href="#-1359"><span class="linenos">1359</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span>
</span><span id="Faults.build_faults-1360"><a href="#-1360"><span class="linenos">1360</span></a>                    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">work_subfolder</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;fault_</span><span class="si">{</span><span class="n">ifault</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">.png&quot;</span><span class="p">),</span>
</span><span id="Faults.build_faults-1361"><a href="#-1361"><span class="linenos">1361</span></a>                    <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;png&quot;</span><span class="p">,</span>
</span><span id="Faults.build_faults-1362"><a href="#-1362"><span class="linenos">1362</span></a>                <span class="p">)</span>
</span><span id="Faults.build_faults-1363"><a href="#-1363"><span class="linenos">1363</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="mi">37</span><span class="p">)</span>
</span><span id="Faults.build_faults-1364"><a href="#-1364"><span class="linenos">1364</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">36</span><span class="p">)</span>
</span><span id="Faults.build_faults-1365"><a href="#-1365"><span class="linenos">1365</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">_plotarray</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
</span><span id="Faults.build_faults-1366"><a href="#-1366"><span class="linenos">1366</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</span><span id="Faults.build_faults-1367"><a href="#-1367"><span class="linenos">1367</span></a>
</span><span id="Faults.build_faults-1368"><a href="#-1368"><span class="linenos">1368</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span>
</span><span id="Faults.build_faults-1369"><a href="#-1369"><span class="linenos">1369</span></a>                    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="Faults.build_faults-1370"><a href="#-1370"><span class="linenos">1370</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">work_subfolder</span><span class="p">,</span>
</span><span id="Faults.build_faults-1371"><a href="#-1371"><span class="linenos">1371</span></a>                        <span class="sa">f</span><span class="s2">&quot;displacement_fault_overlay_</span><span class="si">{</span><span class="n">ifault</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">.png&quot;</span><span class="p">,</span>
</span><span id="Faults.build_faults-1372"><a href="#-1372"><span class="linenos">1372</span></a>                    <span class="p">),</span>
</span><span id="Faults.build_faults-1373"><a href="#-1373"><span class="linenos">1373</span></a>                    <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;png&quot;</span><span class="p">,</span>
</span><span id="Faults.build_faults-1374"><a href="#-1374"><span class="linenos">1374</span></a>                <span class="p">)</span>
</span><span id="Faults.build_faults-1375"><a href="#-1375"><span class="linenos">1375</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="mi">36</span><span class="p">)</span>
</span><span id="Faults.build_faults-1376"><a href="#-1376"><span class="linenos">1376</span></a>
</span><span id="Faults.build_faults-1377"><a href="#-1377"><span class="linenos">1377</span></a>                <span class="n">hockey_sticks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hockey_stick</span><span class="p">)</span>
</span><span id="Faults.build_faults-1378"><a href="#-1378"><span class="linenos">1378</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   ...hockey_sticks = &quot;</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">hockey_sticks</span><span class="p">))</span>
</span><span id="Faults.build_faults-1379"><a href="#-1379"><span class="linenos">1379</span></a>
</span><span id="Faults.build_faults-1380"><a href="#-1380"><span class="linenos">1380</span></a>        <span class="c1"># print final count</span>
</span><span id="Faults.build_faults-1381"><a href="#-1381"><span class="linenos">1381</span></a>        <span class="n">max_fault_throw_list</span><span class="p">,</span> <span class="n">max_fault_throw_list_counts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span>
</span><span id="Faults.build_faults-1382"><a href="#-1382"><span class="linenos">1382</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">max_fault_throw</span><span class="p">,</span> <span class="n">return_counts</span><span class="o">=</span><span class="kc">True</span>
</span><span id="Faults.build_faults-1383"><a href="#-1383"><span class="linenos">1383</span></a>        <span class="p">)</span>
</span><span id="Faults.build_faults-1384"><a href="#-1384"><span class="linenos">1384</span></a>        <span class="n">max_fault_throw_list</span> <span class="o">=</span> <span class="n">max_fault_throw_list</span><span class="p">[</span><span class="n">max_fault_throw_list_counts</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">]</span>
</span><span id="Faults.build_faults-1385"><a href="#-1385"><span class="linenos">1385</span></a>        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="Faults.build_faults-1386"><a href="#-1386"><span class="linenos">1386</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="Faults.build_faults-1387"><a href="#-1387"><span class="linenos">1387</span></a>                <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">   ... ** final ** max_fault_throw_list = &quot;</span>
</span><span id="Faults.build_faults-1388"><a href="#-1388"><span class="linenos">1388</span></a>                <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">max_fault_throw_list</span><span class="p">)</span>
</span><span id="Faults.build_faults-1389"><a href="#-1389"><span class="linenos">1389</span></a>                <span class="o">+</span> <span class="s2">&quot;, &quot;</span>
</span><span id="Faults.build_faults-1390"><a href="#-1390"><span class="linenos">1390</span></a>                <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">max_fault_throw_list_counts</span><span class="p">)</span>
</span><span id="Faults.build_faults-1391"><a href="#-1391"><span class="linenos">1391</span></a>            <span class="p">)</span>
</span><span id="Faults.build_faults-1392"><a href="#-1392"><span class="linenos">1392</span></a>
</span><span id="Faults.build_faults-1393"><a href="#-1393"><span class="linenos">1393</span></a>        <span class="c1"># create fault intersections</span>
</span><span id="Faults.build_faults-1394"><a href="#-1394"><span class="linenos">1394</span></a>        <span class="n">_fault_intersections</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fault_planes</span><span class="p">[:]</span> <span class="o">*</span> <span class="mf">1.0</span>
</span><span id="Faults.build_faults-1395"><a href="#-1395"><span class="linenos">1395</span></a>        <span class="c1"># self.fault_intersections = self.fault_planes * 1.</span>
</span><span id="Faults.build_faults-1396"><a href="#-1396"><span class="linenos">1396</span></a>        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="Faults.build_faults-1397"><a href="#-1397"><span class="linenos">1397</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  ... line 592:&quot;</span><span class="p">)</span>
</span><span id="Faults.build_faults-1398"><a href="#-1398"><span class="linenos">1398</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="Faults.build_faults-1399"><a href="#-1399"><span class="linenos">1399</span></a>                <span class="s2">&quot;   ...self.fault_intersections.max() = &quot;</span>
</span><span id="Faults.build_faults-1400"><a href="#-1400"><span class="linenos">1400</span></a>                <span class="o">+</span> <span class="s2">&quot;, &quot;</span>
</span><span id="Faults.build_faults-1401"><a href="#-1401"><span class="linenos">1401</span></a>                <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">_fault_intersections</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
</span><span id="Faults.build_faults-1402"><a href="#-1402"><span class="linenos">1402</span></a>            <span class="p">)</span>
</span><span id="Faults.build_faults-1403"><a href="#-1403"><span class="linenos">1403</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="Faults.build_faults-1404"><a href="#-1404"><span class="linenos">1404</span></a>                <span class="s2">&quot;   ...self.fault_intersections[self.fault_intersections&gt;0.].size = &quot;</span>
</span><span id="Faults.build_faults-1405"><a href="#-1405"><span class="linenos">1405</span></a>                <span class="o">+</span> <span class="s2">&quot;, &quot;</span>
</span><span id="Faults.build_faults-1406"><a href="#-1406"><span class="linenos">1406</span></a>                <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">_fault_intersections</span><span class="p">[</span><span class="n">_fault_intersections</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
</span><span id="Faults.build_faults-1407"><a href="#-1407"><span class="linenos">1407</span></a>            <span class="p">)</span>
</span><span id="Faults.build_faults-1408"><a href="#-1408"><span class="linenos">1408</span></a>
</span><span id="Faults.build_faults-1409"><a href="#-1409"><span class="linenos">1409</span></a>        <span class="n">_fault_intersections</span><span class="p">[</span><span class="n">_fault_intersections</span> <span class="o">&lt;=</span> <span class="mf">1.0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="Faults.build_faults-1410"><a href="#-1410"><span class="linenos">1410</span></a>        <span class="n">_fault_intersections</span><span class="p">[</span><span class="n">_fault_intersections</span> <span class="o">&gt;</span> <span class="mf">1.1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="Faults.build_faults-1411"><a href="#-1411"><span class="linenos">1411</span></a>        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="Faults.build_faults-1412"><a href="#-1412"><span class="linenos">1412</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  ... line 597:&quot;</span><span class="p">)</span>
</span><span id="Faults.build_faults-1413"><a href="#-1413"><span class="linenos">1413</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="Faults.build_faults-1414"><a href="#-1414"><span class="linenos">1414</span></a>                <span class="s2">&quot;   ...self.fault_intersections.max() = &quot;</span>
</span><span id="Faults.build_faults-1415"><a href="#-1415"><span class="linenos">1415</span></a>                <span class="o">+</span> <span class="s2">&quot;, &quot;</span>
</span><span id="Faults.build_faults-1416"><a href="#-1416"><span class="linenos">1416</span></a>                <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">_fault_intersections</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
</span><span id="Faults.build_faults-1417"><a href="#-1417"><span class="linenos">1417</span></a>            <span class="p">)</span>
</span><span id="Faults.build_faults-1418"><a href="#-1418"><span class="linenos">1418</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="Faults.build_faults-1419"><a href="#-1419"><span class="linenos">1419</span></a>                <span class="s2">&quot;   ...self.fault_intersections[self.fault_intersections&gt;0.].size = &quot;</span>
</span><span id="Faults.build_faults-1420"><a href="#-1420"><span class="linenos">1420</span></a>                <span class="o">+</span> <span class="s2">&quot;, &quot;</span>
</span><span id="Faults.build_faults-1421"><a href="#-1421"><span class="linenos">1421</span></a>                <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">_fault_intersections</span><span class="p">[</span><span class="n">_fault_intersections</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
</span><span id="Faults.build_faults-1422"><a href="#-1422"><span class="linenos">1422</span></a>            <span class="p">)</span>
</span><span id="Faults.build_faults-1423"><a href="#-1423"><span class="linenos">1423</span></a>
</span><span id="Faults.build_faults-1424"><a href="#-1424"><span class="linenos">1424</span></a>        <span class="c1"># make 2nd count of number of intersections between faults. write result to logfile.</span>
</span><span id="Faults.build_faults-1425"><a href="#-1425"><span class="linenos">1425</span></a>        <span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
</span><span id="Faults.build_faults-1426"><a href="#-1426"><span class="linenos">1426</span></a>
</span><span id="Faults.build_faults-1427"><a href="#-1427"><span class="linenos">1427</span></a>        <span class="n">start_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
</span><span id="Faults.build_faults-1428"><a href="#-1428"><span class="linenos">1428</span></a>        <span class="n">number_fault_intersections</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span>
</span><span id="Faults.build_faults-1429"><a href="#-1429"><span class="linenos">1429</span></a>            <span class="n">number_fault_intersections</span><span class="p">,</span>
</span><span id="Faults.build_faults-1430"><a href="#-1430"><span class="linenos">1430</span></a>            <span class="n">measure</span><span class="o">.</span><span class="n">label</span><span class="p">(</span><span class="n">_fault_intersections</span><span class="p">,</span> <span class="n">background</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span>
</span><span id="Faults.build_faults-1431"><a href="#-1431"><span class="linenos">1431</span></a>        <span class="p">)</span>
</span><span id="Faults.build_faults-1432"><a href="#-1432"><span class="linenos">1432</span></a>        <span class="nb">print</span><span class="p">(</span>
</span><span id="Faults.build_faults-1433"><a href="#-1433"><span class="linenos">1433</span></a>            <span class="sa">f</span><span class="s2">&quot;   ... elapsed time for skimage.label = </span><span class="si">{</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Faults.build_faults-1434"><a href="#-1434"><span class="linenos">1434</span></a>        <span class="p">)</span>
</span><span id="Faults.build_faults-1435"><a href="#-1435"><span class="linenos">1435</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   ... number_fault_intersections = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">number_fault_intersections</span><span class="p">))</span>
</span><span id="Faults.build_faults-1436"><a href="#-1436"><span class="linenos">1436</span></a>
</span><span id="Faults.build_faults-1437"><a href="#-1437"><span class="linenos">1437</span></a>        <span class="c1"># dilate intersection values</span>
</span><span id="Faults.build_faults-1438"><a href="#-1438"><span class="linenos">1438</span></a>        <span class="c1"># - window size of (5,5,15) is arbitrary. Should be based on isolating sections</span>
</span><span id="Faults.build_faults-1439"><a href="#-1439"><span class="linenos">1439</span></a>        <span class="c1">#   of fault planes on real seismic</span>
</span><span id="Faults.build_faults-1440"><a href="#-1440"><span class="linenos">1440</span></a>        <span class="n">_fault_intersections</span> <span class="o">=</span> <span class="n">maximum_filter</span><span class="p">(</span><span class="n">_fault_intersections</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">17</span><span class="p">))</span>
</span><span id="Faults.build_faults-1441"><a href="#-1441"><span class="linenos">1441</span></a>
</span><span id="Faults.build_faults-1442"><a href="#-1442"><span class="linenos">1442</span></a>        <span class="c1"># Fault intersection segments &gt; 1 at intersecting faults. Clip to 1</span>
</span><span id="Faults.build_faults-1443"><a href="#-1443"><span class="linenos">1443</span></a>        <span class="n">_fault_intersections</span><span class="p">[</span><span class="n">_fault_intersections</span> <span class="o">&gt;</span> <span class="mf">0.05</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="Faults.build_faults-1444"><a href="#-1444"><span class="linenos">1444</span></a>        <span class="n">_fault_intersections</span><span class="p">[</span><span class="n">_fault_intersections</span> <span class="o">!=</span> <span class="mf">1.0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="Faults.build_faults-1445"><a href="#-1445"><span class="linenos">1445</span></a>        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="Faults.build_faults-1446"><a href="#-1446"><span class="linenos">1446</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  ... line 607:&quot;</span><span class="p">)</span>
</span><span id="Faults.build_faults-1447"><a href="#-1447"><span class="linenos">1447</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="Faults.build_faults-1448"><a href="#-1448"><span class="linenos">1448</span></a>                <span class="s2">&quot;   ...self.fault_intersections.max() = &quot;</span>
</span><span id="Faults.build_faults-1449"><a href="#-1449"><span class="linenos">1449</span></a>                <span class="o">+</span> <span class="s2">&quot;, &quot;</span>
</span><span id="Faults.build_faults-1450"><a href="#-1450"><span class="linenos">1450</span></a>                <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">_fault_intersections</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
</span><span id="Faults.build_faults-1451"><a href="#-1451"><span class="linenos">1451</span></a>            <span class="p">)</span>
</span><span id="Faults.build_faults-1452"><a href="#-1452"><span class="linenos">1452</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="Faults.build_faults-1453"><a href="#-1453"><span class="linenos">1453</span></a>                <span class="s2">&quot;   ...self.fault_intersections[self.fault_intersections&gt;0.].size = &quot;</span>
</span><span id="Faults.build_faults-1454"><a href="#-1454"><span class="linenos">1454</span></a>                <span class="o">+</span> <span class="s2">&quot;, &quot;</span>
</span><span id="Faults.build_faults-1455"><a href="#-1455"><span class="linenos">1455</span></a>                <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">_fault_intersections</span><span class="p">[</span><span class="n">_fault_intersections</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
</span><span id="Faults.build_faults-1456"><a href="#-1456"><span class="linenos">1456</span></a>            <span class="p">)</span>
</span><span id="Faults.build_faults-1457"><a href="#-1457"><span class="linenos">1457</span></a>
</span><span id="Faults.build_faults-1458"><a href="#-1458"><span class="linenos">1458</span></a>        <span class="c1"># Fault segments = 1 at fault &gt; 1 at intersections. Clip intersecting fault voxels to 1</span>
</span><span id="Faults.build_faults-1459"><a href="#-1459"><span class="linenos">1459</span></a>        <span class="n">_fault_planes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fault_planes</span><span class="p">[:]</span>
</span><span id="Faults.build_faults-1460"><a href="#-1460"><span class="linenos">1460</span></a>        <span class="n">_fault_planes</span><span class="p">[</span><span class="n">_fault_planes</span> <span class="o">&gt;</span> <span class="mf">0.05</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="Faults.build_faults-1461"><a href="#-1461"><span class="linenos">1461</span></a>        <span class="n">_fault_planes</span><span class="p">[</span><span class="n">_fault_planes</span> <span class="o">!=</span> <span class="mf">1.0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="Faults.build_faults-1462"><a href="#-1462"><span class="linenos">1462</span></a>
</span><span id="Faults.build_faults-1463"><a href="#-1463"><span class="linenos">1463</span></a>        <span class="c1"># make fault azi 3D and only retain voxels in fault plane</span>
</span><span id="Faults.build_faults-1464"><a href="#-1464"><span class="linenos">1464</span></a>
</span><span id="Faults.build_faults-1465"><a href="#-1465"><span class="linenos">1465</span></a>        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
</span><span id="Faults.build_faults-1466"><a href="#-1466"><span class="linenos">1466</span></a>            <span class="p">[</span>
</span><span id="Faults.build_faults-1467"><a href="#-1467"><span class="linenos">1467</span></a>                <span class="s2">&quot;n_voxels_faults&quot;</span><span class="p">,</span>
</span><span id="Faults.build_faults-1468"><a href="#-1468"><span class="linenos">1468</span></a>                <span class="s2">&quot;n_voxels_fault_intersections&quot;</span><span class="p">,</span>
</span><span id="Faults.build_faults-1469"><a href="#-1469"><span class="linenos">1469</span></a>                <span class="s2">&quot;number_fault_intersections&quot;</span><span class="p">,</span>
</span><span id="Faults.build_faults-1470"><a href="#-1470"><span class="linenos">1470</span></a>                <span class="s2">&quot;fault_voxel_count_list&quot;</span><span class="p">,</span>
</span><span id="Faults.build_faults-1471"><a href="#-1471"><span class="linenos">1471</span></a>                <span class="s2">&quot;hockey_sticks&quot;</span><span class="p">,</span>
</span><span id="Faults.build_faults-1472"><a href="#-1472"><span class="linenos">1472</span></a>            <span class="p">],</span>
</span><span id="Faults.build_faults-1473"><a href="#-1473"><span class="linenos">1473</span></a>            <span class="p">[</span>
</span><span id="Faults.build_faults-1474"><a href="#-1474"><span class="linenos">1474</span></a>                <span class="n">_fault_planes</span><span class="p">[</span><span class="n">_fault_planes</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">,</span>
</span><span id="Faults.build_faults-1475"><a href="#-1475"><span class="linenos">1475</span></a>                <span class="n">_fault_intersections</span><span class="p">[</span><span class="n">_fault_intersections</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">,</span>
</span><span id="Faults.build_faults-1476"><a href="#-1476"><span class="linenos">1476</span></a>                <span class="n">number_fault_intersections</span><span class="p">,</span>
</span><span id="Faults.build_faults-1477"><a href="#-1477"><span class="linenos">1477</span></a>                <span class="n">fault_voxel_count_list</span><span class="p">,</span>
</span><span id="Faults.build_faults-1478"><a href="#-1478"><span class="linenos">1478</span></a>                <span class="n">hockey_sticks</span><span class="p">,</span>
</span><span id="Faults.build_faults-1479"><a href="#-1479"><span class="linenos">1479</span></a>            <span class="p">],</span>
</span><span id="Faults.build_faults-1480"><a href="#-1480"><span class="linenos">1480</span></a>        <span class="p">):</span>
</span><span id="Faults.build_faults-1481"><a href="#-1481"><span class="linenos">1481</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Faults.build_faults-1482"><a href="#-1482"><span class="linenos">1482</span></a>
</span><span id="Faults.build_faults-1483"><a href="#-1483"><span class="linenos">1483</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="Faults.build_faults-1484"><a href="#-1484"><span class="linenos">1484</span></a>                <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span> <span class="n">subkey</span><span class="o">=</span><span class="n">k</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">v</span>
</span><span id="Faults.build_faults-1485"><a href="#-1485"><span class="linenos">1485</span></a>            <span class="p">)</span>
</span><span id="Faults.build_faults-1486"><a href="#-1486"><span class="linenos">1486</span></a>
</span><span id="Faults.build_faults-1487"><a href="#-1487"><span class="linenos">1487</span></a>        <span class="n">dis_class</span> <span class="o">=</span> <span class="n">_faulted_depths</span> <span class="o">*</span> <span class="mi">1</span>
</span><span id="Faults.build_faults-1488"><a href="#-1488"><span class="linenos">1488</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fault_intersections</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">_fault_intersections</span>
</span><span id="Faults.build_faults-1489"><a href="#-1489"><span class="linenos">1489</span></a>        <span class="k">del</span> <span class="n">_fault_intersections</span>
</span><span id="Faults.build_faults-1490"><a href="#-1490"><span class="linenos">1490</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fault_planes</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">_fault_planes</span>
</span><span id="Faults.build_faults-1491"><a href="#-1491"><span class="linenos">1491</span></a>        <span class="k">del</span> <span class="n">_fault_planes</span>
</span><span id="Faults.build_faults-1492"><a href="#-1492"><span class="linenos">1492</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">displacement_vectors</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">_faulted_depths</span> <span class="o">*</span> <span class="mf">1.0</span>
</span><span id="Faults.build_faults-1493"><a href="#-1493"><span class="linenos">1493</span></a>
</span><span id="Faults.build_faults-1494"><a href="#-1494"><span class="linenos">1494</span></a>        <span class="c1"># TODO: check if next line of code modifies &#39;displacement&#39; properly</span>
</span><span id="Faults.build_faults-1495"><a href="#-1495"><span class="linenos">1495</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sum_map_displacements</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">_faulted_depths</span> <span class="o">*</span> <span class="mf">1.0</span>
</span><span id="Faults.build_faults-1496"><a href="#-1496"><span class="linenos">1496</span></a>
</span><span id="Faults.build_faults-1497"><a href="#-1497"><span class="linenos">1497</span></a>        <span class="c1"># Save faulted maps</span>
</span><span id="Faults.build_faults-1498"><a href="#-1498"><span class="linenos">1498</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">faulted_depth_maps</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">depth_maps_faulted_infilled</span>
</span><span id="Faults.build_faults-1499"><a href="#-1499"><span class="linenos">1499</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">faulted_depth_maps_gaps</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">depth_maps_gaps</span>
</span><span id="Faults.build_faults-1500"><a href="#-1500"><span class="linenos">1500</span></a>
</span><span id="Faults.build_faults-1501"><a href="#-1501"><span class="linenos">1501</span></a>        <span class="c1"># perform faulting for fault_segments and fault_intersections</span>
</span><span id="Faults.build_faults-1502"><a href="#-1502"><span class="linenos">1502</span></a>        <span class="k">return</span> <span class="n">dis_class</span><span class="p">,</span> <span class="n">hockey_sticks</span>
</span></pre></div>


            <div class="docstring"><h6 id="build-faults">Build Faults</h6>

<p>Creates faults in the model.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>fp</strong> (dict):
Dictionary containing the fault parameters.</li>
<li><strong>verbose</strong> (bool):
The level of verbosity to use.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>dis_class</strong> (np.ndarray):
Array of fault displacement classifications</li>
<li><strong>hockey_sticks</strong> (list):
List of hockey sticks</li>
</ul>
</div>


                            </div>
                            <div id="Faults.improve_depth_maps_post_faulting" class="classattr">
                                        <input id="Faults.improve_depth_maps_post_faulting-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">improve_depth_maps_post_faulting</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">unfaulted_geologic_age</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span>,</span><span class="param">	<span class="n">faulted_geologic_age</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span>,</span><span class="param">	<span class="n">onlap_clips</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Faults.improve_depth_maps_post_faulting-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Faults.improve_depth_maps_post_faulting"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Faults.improve_depth_maps_post_faulting-1581"><a href="#-1581"><span class="linenos">1581</span></a>    <span class="k">def</span> <span class="nf">improve_depth_maps_post_faulting</span><span class="p">(</span>
</span><span id="Faults.improve_depth_maps_post_faulting-1582"><a href="#-1582"><span class="linenos">1582</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Faults.improve_depth_maps_post_faulting-1583"><a href="#-1583"><span class="linenos">1583</span></a>        <span class="n">unfaulted_geologic_age</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
</span><span id="Faults.improve_depth_maps_post_faulting-1584"><a href="#-1584"><span class="linenos">1584</span></a>        <span class="n">faulted_geologic_age</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
</span><span id="Faults.improve_depth_maps_post_faulting-1585"><a href="#-1585"><span class="linenos">1585</span></a>        <span class="n">onlap_clips</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
</span><span id="Faults.improve_depth_maps_post_faulting-1586"><a href="#-1586"><span class="linenos">1586</span></a>    <span class="p">):</span>
</span><span id="Faults.improve_depth_maps_post_faulting-1587"><a href="#-1587"><span class="linenos">1587</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="Faults.improve_depth_maps_post_faulting-1588"><a href="#-1588"><span class="linenos">1588</span></a><span class="sd">        Re-interpolates the depth maps using the faulted geologic age cube</span>
</span><span id="Faults.improve_depth_maps_post_faulting-1589"><a href="#-1589"><span class="linenos">1589</span></a>
</span><span id="Faults.improve_depth_maps_post_faulting-1590"><a href="#-1590"><span class="linenos">1590</span></a><span class="sd">        Parameters</span>
</span><span id="Faults.improve_depth_maps_post_faulting-1591"><a href="#-1591"><span class="linenos">1591</span></a><span class="sd">        ----------</span>
</span><span id="Faults.improve_depth_maps_post_faulting-1592"><a href="#-1592"><span class="linenos">1592</span></a><span class="sd">        unfaulted_geologic_age : np.ndarray</span>
</span><span id="Faults.improve_depth_maps_post_faulting-1593"><a href="#-1593"><span class="linenos">1593</span></a><span class="sd">            The unfaulted geologic age cube</span>
</span><span id="Faults.improve_depth_maps_post_faulting-1594"><a href="#-1594"><span class="linenos">1594</span></a><span class="sd">        faulted_geologic_age : np.ndarray</span>
</span><span id="Faults.improve_depth_maps_post_faulting-1595"><a href="#-1595"><span class="linenos">1595</span></a><span class="sd">            The faulted geologic age cube</span>
</span><span id="Faults.improve_depth_maps_post_faulting-1596"><a href="#-1596"><span class="linenos">1596</span></a><span class="sd">        onlap_clips : np.ndarray</span>
</span><span id="Faults.improve_depth_maps_post_faulting-1597"><a href="#-1597"><span class="linenos">1597</span></a><span class="sd">            The onlap clips</span>
</span><span id="Faults.improve_depth_maps_post_faulting-1598"><a href="#-1598"><span class="linenos">1598</span></a><span class="sd">        </span>
</span><span id="Faults.improve_depth_maps_post_faulting-1599"><a href="#-1599"><span class="linenos">1599</span></a><span class="sd">        Returns</span>
</span><span id="Faults.improve_depth_maps_post_faulting-1600"><a href="#-1600"><span class="linenos">1600</span></a><span class="sd">        -------</span>
</span><span id="Faults.improve_depth_maps_post_faulting-1601"><a href="#-1601"><span class="linenos">1601</span></a><span class="sd">        depth_maps : np.ndarray</span>
</span><span id="Faults.improve_depth_maps_post_faulting-1602"><a href="#-1602"><span class="linenos">1602</span></a><span class="sd">            The improved depth maps</span>
</span><span id="Faults.improve_depth_maps_post_faulting-1603"><a href="#-1603"><span class="linenos">1603</span></a><span class="sd">        depth_maps_gaps : np.ndarray</span>
</span><span id="Faults.improve_depth_maps_post_faulting-1604"><a href="#-1604"><span class="linenos">1604</span></a><span class="sd">            The improved depth maps with gaps</span>
</span><span id="Faults.improve_depth_maps_post_faulting-1605"><a href="#-1605"><span class="linenos">1605</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Faults.improve_depth_maps_post_faulting-1606"><a href="#-1606"><span class="linenos">1606</span></a>        <span class="n">faulted_depth_maps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faulted_depth_maps</span><span class="p">)</span>
</span><span id="Faults.improve_depth_maps_post_faulting-1607"><a href="#-1607"><span class="linenos">1607</span></a>        <span class="n">origtime</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faulted_depth_maps</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</span><span id="Faults.improve_depth_maps_post_faulting-1608"><a href="#-1608"><span class="linenos">1608</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faulted_depth_maps</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="Faults.improve_depth_maps_post_faulting-1609"><a href="#-1609"><span class="linenos">1609</span></a>            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faulted_depth_maps</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
</span><span id="Faults.improve_depth_maps_post_faulting-1610"><a href="#-1610"><span class="linenos">1610</span></a>                <span class="k">if</span> <span class="p">(</span>
</span><span id="Faults.improve_depth_maps_post_faulting-1611"><a href="#-1611"><span class="linenos">1611</span></a>                    <span class="n">faulted_geologic_age</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
</span><span id="Faults.improve_depth_maps_post_faulting-1612"><a href="#-1612"><span class="linenos">1612</span></a>                    <span class="o">!=</span> <span class="n">faulted_geologic_age</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</span><span id="Faults.improve_depth_maps_post_faulting-1613"><a href="#-1613"><span class="linenos">1613</span></a>                <span class="p">):</span>
</span><span id="Faults.improve_depth_maps_post_faulting-1614"><a href="#-1614"><span class="linenos">1614</span></a>                    <span class="n">faulted_depth_maps</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span>
</span><span id="Faults.improve_depth_maps_post_faulting-1615"><a href="#-1615"><span class="linenos">1615</span></a>                        <span class="n">origtime</span><span class="p">,</span>
</span><span id="Faults.improve_depth_maps_post_faulting-1616"><a href="#-1616"><span class="linenos">1616</span></a>                        <span class="n">faulted_geologic_age</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="p">:],</span>
</span><span id="Faults.improve_depth_maps_post_faulting-1617"><a href="#-1617"><span class="linenos">1617</span></a>                        <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">faulted_geologic_age</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;float&quot;</span><span class="p">),</span>
</span><span id="Faults.improve_depth_maps_post_faulting-1618"><a href="#-1618"><span class="linenos">1618</span></a>                    <span class="p">)</span>
</span><span id="Faults.improve_depth_maps_post_faulting-1619"><a href="#-1619"><span class="linenos">1619</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Faults.improve_depth_maps_post_faulting-1620"><a href="#-1620"><span class="linenos">1620</span></a>                    <span class="n">faulted_depth_maps</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">unfaulted_geologic_age</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="p">:]</span>
</span><span id="Faults.improve_depth_maps_post_faulting-1621"><a href="#-1621"><span class="linenos">1621</span></a>        <span class="c1"># Waterbottom horizon has been set to 0. Re-insert this from the original depth_maps array</span>
</span><span id="Faults.improve_depth_maps_post_faulting-1622"><a href="#-1622"><span class="linenos">1622</span></a>        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">count_nonzero</span><span class="p">(</span><span class="n">faulted_depth_maps</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Faults.improve_depth_maps_post_faulting-1623"><a href="#-1623"><span class="linenos">1623</span></a>            <span class="n">faulted_depth_maps</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">faulted_depth_maps</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1.0</span>
</span><span id="Faults.improve_depth_maps_post_faulting-1624"><a href="#-1624"><span class="linenos">1624</span></a>
</span><span id="Faults.improve_depth_maps_post_faulting-1625"><a href="#-1625"><span class="linenos">1625</span></a>        <span class="c1"># Shift re-interpolated horizons to replace first horizon (of 0&#39;s) with the second, etc</span>
</span><span id="Faults.improve_depth_maps_post_faulting-1626"><a href="#-1626"><span class="linenos">1626</span></a>        <span class="n">zmaps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">faulted_depth_maps</span><span class="p">)</span>
</span><span id="Faults.improve_depth_maps_post_faulting-1627"><a href="#-1627"><span class="linenos">1627</span></a>        <span class="n">zmaps</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">faulted_depth_maps</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">:]</span>
</span><span id="Faults.improve_depth_maps_post_faulting-1628"><a href="#-1628"><span class="linenos">1628</span></a>        <span class="c1"># Fix the deepest re-interpolated horizon by adding a constant thickness to the shallower horizon</span>
</span><span id="Faults.improve_depth_maps_post_faulting-1629"><a href="#-1629"><span class="linenos">1629</span></a>        <span class="n">zmaps</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">faulted_depth_maps</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">10</span>
</span><span id="Faults.improve_depth_maps_post_faulting-1630"><a href="#-1630"><span class="linenos">1630</span></a>        <span class="c1"># Clip this last horizon to the one above</span>
</span><span id="Faults.improve_depth_maps_post_faulting-1631"><a href="#-1631"><span class="linenos">1631</span></a>        <span class="n">thickness_map</span> <span class="o">=</span> <span class="n">zmaps</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">zmaps</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">]</span>
</span><span id="Faults.improve_depth_maps_post_faulting-1632"><a href="#-1632"><span class="linenos">1632</span></a>        <span class="n">zmaps</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">thickness_map</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">)]</span> <span class="o">=</span> <span class="n">zmaps</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">][</span>
</span><span id="Faults.improve_depth_maps_post_faulting-1633"><a href="#-1633"><span class="linenos">1633</span></a>            <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">thickness_map</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">)</span>
</span><span id="Faults.improve_depth_maps_post_faulting-1634"><a href="#-1634"><span class="linenos">1634</span></a>        <span class="p">]</span>
</span><span id="Faults.improve_depth_maps_post_faulting-1635"><a href="#-1635"><span class="linenos">1635</span></a>        <span class="n">faulted_depth_maps</span> <span class="o">=</span> <span class="n">zmaps</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Faults.improve_depth_maps_post_faulting-1636"><a href="#-1636"><span class="linenos">1636</span></a>
</span><span id="Faults.improve_depth_maps_post_faulting-1637"><a href="#-1637"><span class="linenos">1637</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">qc_plots</span><span class="p">:</span>
</span><span id="Faults.improve_depth_maps_post_faulting-1638"><a href="#-1638"><span class="linenos">1638</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_qc_plot_check_faulted_horizons_match_fault_segments</span><span class="p">(</span>
</span><span id="Faults.improve_depth_maps_post_faulting-1639"><a href="#-1639"><span class="linenos">1639</span></a>                <span class="n">faulted_depth_maps</span><span class="p">,</span> <span class="n">faulted_geologic_age</span>
</span><span id="Faults.improve_depth_maps_post_faulting-1640"><a href="#-1640"><span class="linenos">1640</span></a>            <span class="p">)</span>
</span><span id="Faults.improve_depth_maps_post_faulting-1641"><a href="#-1641"><span class="linenos">1641</span></a>
</span><span id="Faults.improve_depth_maps_post_faulting-1642"><a href="#-1642"><span class="linenos">1642</span></a>        <span class="c1"># Re-apply old gaps to improved depth_maps</span>
</span><span id="Faults.improve_depth_maps_post_faulting-1643"><a href="#-1643"><span class="linenos">1643</span></a>        <span class="n">zmaps_imp</span> <span class="o">=</span> <span class="n">faulted_depth_maps</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Faults.improve_depth_maps_post_faulting-1644"><a href="#-1644"><span class="linenos">1644</span></a>        <span class="n">merged</span> <span class="o">=</span> <span class="n">zmaps_imp</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Faults.improve_depth_maps_post_faulting-1645"><a href="#-1645"><span class="linenos">1645</span></a>        <span class="n">_depth_maps_gaps_improved</span> <span class="o">=</span> <span class="n">merged</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Faults.improve_depth_maps_post_faulting-1646"><a href="#-1646"><span class="linenos">1646</span></a>        <span class="n">_depth_maps_gaps_improved</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faulted_depth_maps_gaps</span><span class="p">)]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
</span><span id="Faults.improve_depth_maps_post_faulting-1647"><a href="#-1647"><span class="linenos">1647</span></a>        <span class="n">depth_maps_gaps</span> <span class="o">=</span> <span class="n">_depth_maps_gaps_improved</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Faults.improve_depth_maps_post_faulting-1648"><a href="#-1648"><span class="linenos">1648</span></a>
</span><span id="Faults.improve_depth_maps_post_faulting-1649"><a href="#-1649"><span class="linenos">1649</span></a>        <span class="c1"># for zero-thickness layers, set depth_maps_gaps to nan</span>
</span><span id="Faults.improve_depth_maps_post_faulting-1650"><a href="#-1650"><span class="linenos">1650</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">depth_maps_gaps</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="Faults.improve_depth_maps_post_faulting-1651"><a href="#-1651"><span class="linenos">1651</span></a>            <span class="n">thickness_map</span> <span class="o">=</span> <span class="n">depth_maps_gaps</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">depth_maps_gaps</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">i</span><span class="p">]</span>
</span><span id="Faults.improve_depth_maps_post_faulting-1652"><a href="#-1652"><span class="linenos">1652</span></a>            <span class="c1"># set thicknesses &lt; zero to NaN. Use NaNs in thickness_map to 0 to avoid runtime warning when indexing</span>
</span><span id="Faults.improve_depth_maps_post_faulting-1653"><a href="#-1653"><span class="linenos">1653</span></a>            <span class="n">depth_maps_gaps</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">i</span><span class="p">][</span><span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">thickness_map</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
</span><span id="Faults.improve_depth_maps_post_faulting-1654"><a href="#-1654"><span class="linenos">1654</span></a>
</span><span id="Faults.improve_depth_maps_post_faulting-1655"><a href="#-1655"><span class="linenos">1655</span></a>        <span class="c1"># restore zero thickness from faulted horizons to improved (interpolated) depth maps</span>
</span><span id="Faults.improve_depth_maps_post_faulting-1656"><a href="#-1656"><span class="linenos">1656</span></a>        <span class="n">ii</span><span class="p">,</span> <span class="n">jj</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span>
</span><span id="Faults.improve_depth_maps_post_faulting-1657"><a href="#-1657"><span class="linenos">1657</span></a>            <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
</span><span id="Faults.improve_depth_maps_post_faulting-1658"><a href="#-1658"><span class="linenos">1658</span></a>            <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
</span><span id="Faults.improve_depth_maps_post_faulting-1659"><a href="#-1659"><span class="linenos">1659</span></a>            <span class="n">sparse</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="Faults.improve_depth_maps_post_faulting-1660"><a href="#-1660"><span class="linenos">1660</span></a>            <span class="n">indexing</span><span class="o">=</span><span class="s2">&quot;ij&quot;</span><span class="p">,</span>
</span><span id="Faults.improve_depth_maps_post_faulting-1661"><a href="#-1661"><span class="linenos">1661</span></a>        <span class="p">)</span>
</span><span id="Faults.improve_depth_maps_post_faulting-1662"><a href="#-1662"><span class="linenos">1662</span></a>        <span class="n">merged</span> <span class="o">=</span> <span class="n">zmaps_imp</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Faults.improve_depth_maps_post_faulting-1663"><a href="#-1663"><span class="linenos">1663</span></a>
</span><span id="Faults.improve_depth_maps_post_faulting-1664"><a href="#-1664"><span class="linenos">1664</span></a>        <span class="c1"># create temporary copy of fault_segments with dilation</span>
</span><span id="Faults.improve_depth_maps_post_faulting-1665"><a href="#-1665"><span class="linenos">1665</span></a>        <span class="kn">from</span> <span class="nn">scipy.ndimage.morphology</span> <span class="kn">import</span> <span class="n">grey_dilation</span>
</span><span id="Faults.improve_depth_maps_post_faulting-1666"><a href="#-1666"><span class="linenos">1666</span></a>
</span><span id="Faults.improve_depth_maps_post_faulting-1667"><a href="#-1667"><span class="linenos">1667</span></a>        <span class="n">_dilated_fault_planes</span> <span class="o">=</span> <span class="n">grey_dilation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fault_planes</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</span><span id="Faults.improve_depth_maps_post_faulting-1668"><a href="#-1668"><span class="linenos">1668</span></a>
</span><span id="Faults.improve_depth_maps_post_faulting-1669"><a href="#-1669"><span class="linenos">1669</span></a>        <span class="n">_onlap_segments</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">onlap_segments</span><span class="p">[:]</span>
</span><span id="Faults.improve_depth_maps_post_faulting-1670"><a href="#-1670"><span class="linenos">1670</span></a>        <span class="k">for</span> <span class="n">ihor</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">depth_maps_gaps</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
</span><span id="Faults.improve_depth_maps_post_faulting-1671"><a href="#-1671"><span class="linenos">1671</span></a>            <span class="c1"># filter upper horizon being used for thickness if shallower events onlap it, except at faults</span>
</span><span id="Faults.improve_depth_maps_post_faulting-1672"><a href="#-1672"><span class="linenos">1672</span></a>            <span class="n">improved_zmap_thickness</span> <span class="o">=</span> <span class="n">merged</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">ihor</span><span class="p">]</span> <span class="o">-</span> <span class="n">merged</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">ihor</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="Faults.improve_depth_maps_post_faulting-1673"><a href="#-1673"><span class="linenos">1673</span></a>            <span class="n">depth_map_int</span> <span class="o">=</span> <span class="p">((</span><span class="n">merged</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">ihor</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">))</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span>
</span><span id="Faults.improve_depth_maps_post_faulting-1674"><a href="#-1674"><span class="linenos">1674</span></a>                <span class="mi">0</span><span class="p">,</span> <span class="n">_onlap_segments</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>
</span><span id="Faults.improve_depth_maps_post_faulting-1675"><a href="#-1675"><span class="linenos">1675</span></a>            <span class="p">)</span>
</span><span id="Faults.improve_depth_maps_post_faulting-1676"><a href="#-1676"><span class="linenos">1676</span></a>            <span class="n">improved_map_onlap_segments</span> <span class="o">=</span> <span class="n">_onlap_segments</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span> <span class="n">jj</span><span class="p">,</span> <span class="n">depth_map_int</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.0</span>
</span><span id="Faults.improve_depth_maps_post_faulting-1677"><a href="#-1677"><span class="linenos">1677</span></a>            <span class="n">improved_map_fault_segments</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="Faults.improve_depth_maps_post_faulting-1678"><a href="#-1678"><span class="linenos">1678</span></a>                <span class="n">_dilated_fault_planes</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span> <span class="n">jj</span><span class="p">,</span> <span class="n">depth_map_int</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.0</span>
</span><span id="Faults.improve_depth_maps_post_faulting-1679"><a href="#-1679"><span class="linenos">1679</span></a>            <span class="p">)</span>
</span><span id="Faults.improve_depth_maps_post_faulting-1680"><a href="#-1680"><span class="linenos">1680</span></a>            <span class="c1"># remember that self.maps.depth_maps has horizons with direct fault application</span>
</span><span id="Faults.improve_depth_maps_post_faulting-1681"><a href="#-1681"><span class="linenos">1681</span></a>            <span class="n">faulted_infilled_map_thickness</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="Faults.improve_depth_maps_post_faulting-1682"><a href="#-1682"><span class="linenos">1682</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">faulted_depth_maps</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">ihor</span><span class="p">]</span>
</span><span id="Faults.improve_depth_maps_post_faulting-1683"><a href="#-1683"><span class="linenos">1683</span></a>                <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">faulted_depth_maps</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">ihor</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="Faults.improve_depth_maps_post_faulting-1684"><a href="#-1684"><span class="linenos">1684</span></a>            <span class="p">)</span>
</span><span id="Faults.improve_depth_maps_post_faulting-1685"><a href="#-1685"><span class="linenos">1685</span></a>            <span class="n">improved_zmap_thickness</span><span class="p">[</span>
</span><span id="Faults.improve_depth_maps_post_faulting-1686"><a href="#-1686"><span class="linenos">1686</span></a>                <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
</span><span id="Faults.improve_depth_maps_post_faulting-1687"><a href="#-1687"><span class="linenos">1687</span></a>                    <span class="p">(</span><span class="n">faulted_infilled_map_thickness</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">)</span>
</span><span id="Faults.improve_depth_maps_post_faulting-1688"><a href="#-1688"><span class="linenos">1688</span></a>                    <span class="o">&amp;</span> <span class="p">(</span><span class="n">improved_map_onlap_segments</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">)</span>
</span><span id="Faults.improve_depth_maps_post_faulting-1689"><a href="#-1689"><span class="linenos">1689</span></a>                    <span class="o">&amp;</span> <span class="p">(</span><span class="n">improved_map_fault_segments</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">)</span>
</span><span id="Faults.improve_depth_maps_post_faulting-1690"><a href="#-1690"><span class="linenos">1690</span></a>                <span class="p">)</span>
</span><span id="Faults.improve_depth_maps_post_faulting-1691"><a href="#-1691"><span class="linenos">1691</span></a>            <span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="Faults.improve_depth_maps_post_faulting-1692"><a href="#-1692"><span class="linenos">1692</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="Faults.improve_depth_maps_post_faulting-1693"><a href="#-1693"><span class="linenos">1693</span></a>                <span class="s2">&quot; ... ihor, improved_map_onlap_segments[improved_map_onlap_segments&gt;0.].shape,&quot;</span>
</span><span id="Faults.improve_depth_maps_post_faulting-1694"><a href="#-1694"><span class="linenos">1694</span></a>                <span class="s2">&quot; improved_zmap_thickness[improved_zmap_thickness==0].shape = &quot;</span><span class="p">,</span>
</span><span id="Faults.improve_depth_maps_post_faulting-1695"><a href="#-1695"><span class="linenos">1695</span></a>                <span class="n">ihor</span><span class="p">,</span>
</span><span id="Faults.improve_depth_maps_post_faulting-1696"><a href="#-1696"><span class="linenos">1696</span></a>                <span class="n">improved_map_onlap_segments</span><span class="p">[</span><span class="n">improved_map_onlap_segments</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
</span><span id="Faults.improve_depth_maps_post_faulting-1697"><a href="#-1697"><span class="linenos">1697</span></a>                <span class="n">improved_zmap_thickness</span><span class="p">[</span><span class="n">improved_zmap_thickness</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
</span><span id="Faults.improve_depth_maps_post_faulting-1698"><a href="#-1698"><span class="linenos">1698</span></a>            <span class="p">)</span>
</span><span id="Faults.improve_depth_maps_post_faulting-1699"><a href="#-1699"><span class="linenos">1699</span></a>            <span class="n">merged</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">ihor</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">merged</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">ihor</span><span class="p">]</span> <span class="o">-</span> <span class="n">improved_zmap_thickness</span>
</span><span id="Faults.improve_depth_maps_post_faulting-1700"><a href="#-1700"><span class="linenos">1700</span></a>
</span><span id="Faults.improve_depth_maps_post_faulting-1701"><a href="#-1701"><span class="linenos">1701</span></a>        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fan_horizon_list</span><span class="p">):</span>
</span><span id="Faults.improve_depth_maps_post_faulting-1702"><a href="#-1702"><span class="linenos">1702</span></a>            <span class="c1"># Clip fans downwards when thickness map is zero</span>
</span><span id="Faults.improve_depth_maps_post_faulting-1703"><a href="#-1703"><span class="linenos">1703</span></a>            <span class="k">for</span> <span class="n">count</span><span class="p">,</span> <span class="n">layer</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fan_horizon_list</span><span class="p">):</span>
</span><span id="Faults.improve_depth_maps_post_faulting-1704"><a href="#-1704"><span class="linenos">1704</span></a>                <span class="n">merged</span> <span class="o">=</span> <span class="n">fix_zero_thickness_fan_layers</span><span class="p">(</span>
</span><span id="Faults.improve_depth_maps_post_faulting-1705"><a href="#-1705"><span class="linenos">1705</span></a>                    <span class="n">merged</span><span class="p">,</span> <span class="n">layer</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fan_thickness</span><span class="p">[</span><span class="n">count</span><span class="p">]</span>
</span><span id="Faults.improve_depth_maps_post_faulting-1706"><a href="#-1706"><span class="linenos">1706</span></a>                <span class="p">)</span>
</span><span id="Faults.improve_depth_maps_post_faulting-1707"><a href="#-1707"><span class="linenos">1707</span></a>
</span><span id="Faults.improve_depth_maps_post_faulting-1708"><a href="#-1708"><span class="linenos">1708</span></a>        <span class="c1"># Re-apply clipping to onlapping layers post faulting</span>
</span><span id="Faults.improve_depth_maps_post_faulting-1709"><a href="#-1709"><span class="linenos">1709</span></a>        <span class="n">merged</span> <span class="o">=</span> <span class="n">fix_zero_thickness_onlap_layers</span><span class="p">(</span><span class="n">merged</span><span class="p">,</span> <span class="n">onlap_clips</span><span class="p">)</span>
</span><span id="Faults.improve_depth_maps_post_faulting-1710"><a href="#-1710"><span class="linenos">1710</span></a>
</span><span id="Faults.improve_depth_maps_post_faulting-1711"><a href="#-1711"><span class="linenos">1711</span></a>        <span class="k">del</span> <span class="n">_dilated_fault_planes</span>
</span><span id="Faults.improve_depth_maps_post_faulting-1712"><a href="#-1712"><span class="linenos">1712</span></a>
</span><span id="Faults.improve_depth_maps_post_faulting-1713"><a href="#-1713"><span class="linenos">1713</span></a>        <span class="c1"># Re-apply gaps to improved depth_maps</span>
</span><span id="Faults.improve_depth_maps_post_faulting-1714"><a href="#-1714"><span class="linenos">1714</span></a>        <span class="n">_depth_maps_gaps_improved</span> <span class="o">=</span> <span class="n">merged</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Faults.improve_depth_maps_post_faulting-1715"><a href="#-1715"><span class="linenos">1715</span></a>        <span class="n">_depth_maps_gaps_improved</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faulted_depth_maps_gaps</span><span class="p">)]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
</span><span id="Faults.improve_depth_maps_post_faulting-1716"><a href="#-1716"><span class="linenos">1716</span></a>        <span class="n">depth_maps_gaps</span> <span class="o">=</span> <span class="n">_depth_maps_gaps_improved</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Faults.improve_depth_maps_post_faulting-1717"><a href="#-1717"><span class="linenos">1717</span></a>
</span><span id="Faults.improve_depth_maps_post_faulting-1718"><a href="#-1718"><span class="linenos">1718</span></a>        <span class="c1"># for zero-thickness layers, set depth_maps_gaps to nan</span>
</span><span id="Faults.improve_depth_maps_post_faulting-1719"><a href="#-1719"><span class="linenos">1719</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">depth_maps_gaps</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="Faults.improve_depth_maps_post_faulting-1720"><a href="#-1720"><span class="linenos">1720</span></a>            <span class="n">thickness_map</span> <span class="o">=</span> <span class="n">depth_maps_gaps</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">depth_maps_gaps</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">i</span><span class="p">]</span>
</span><span id="Faults.improve_depth_maps_post_faulting-1721"><a href="#-1721"><span class="linenos">1721</span></a>            <span class="c1"># set nans in thickness_map to 0 to avoid runtime warning</span>
</span><span id="Faults.improve_depth_maps_post_faulting-1722"><a href="#-1722"><span class="linenos">1722</span></a>            <span class="n">depth_maps_gaps</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">i</span><span class="p">][</span><span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">thickness_map</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
</span><span id="Faults.improve_depth_maps_post_faulting-1723"><a href="#-1723"><span class="linenos">1723</span></a>
</span><span id="Faults.improve_depth_maps_post_faulting-1724"><a href="#-1724"><span class="linenos">1724</span></a>        <span class="k">return</span> <span class="n">merged</span><span class="p">,</span> <span class="n">depth_maps_gaps</span>
</span></pre></div>


            <div class="docstring"><p>Re-interpolates the depth maps using the faulted geologic age cube</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>unfaulted_geologic_age</strong> (np.ndarray):
The unfaulted geologic age cube</li>
<li><strong>faulted_geologic_age</strong> (np.ndarray):
The faulted geologic age cube</li>
<li><strong>onlap_clips</strong> (np.ndarray):
The onlap clips</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>depth_maps</strong> (np.ndarray):
The improved depth maps</li>
<li><strong>depth_maps_gaps</strong> (np.ndarray):
The improved depth maps with gaps</li>
</ul>
</div>


                            </div>
                            <div id="Faults.partial_faulting" class="classattr">
                                        <input id="Faults.partial_faulting-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">partial_faulting</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">depth_map_gaps_faulted</span>,</span><span class="param">	<span class="n">fault_plane_classification</span>,</span><span class="param">	<span class="n">faulted_depth_map</span>,</span><span class="param">	<span class="n">ii</span>,</span><span class="param">	<span class="n">jj</span>,</span><span class="param">	<span class="n">max_throw</span>,</span><span class="param">	<span class="n">origtime_cube</span>,</span><span class="param">	<span class="n">unfaulted_depth_map</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Faults.partial_faulting-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Faults.partial_faulting"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Faults.partial_faulting-1726"><a href="#-1726"><span class="linenos">1726</span></a>    <span class="nd">@staticmethod</span>
</span><span id="Faults.partial_faulting-1727"><a href="#-1727"><span class="linenos">1727</span></a>    <span class="k">def</span> <span class="nf">partial_faulting</span><span class="p">(</span>
</span><span id="Faults.partial_faulting-1728"><a href="#-1728"><span class="linenos">1728</span></a>        <span class="n">depth_map_gaps_faulted</span><span class="p">,</span>
</span><span id="Faults.partial_faulting-1729"><a href="#-1729"><span class="linenos">1729</span></a>        <span class="n">fault_plane_classification</span><span class="p">,</span>
</span><span id="Faults.partial_faulting-1730"><a href="#-1730"><span class="linenos">1730</span></a>        <span class="n">faulted_depth_map</span><span class="p">,</span>
</span><span id="Faults.partial_faulting-1731"><a href="#-1731"><span class="linenos">1731</span></a>        <span class="n">ii</span><span class="p">,</span>
</span><span id="Faults.partial_faulting-1732"><a href="#-1732"><span class="linenos">1732</span></a>        <span class="n">jj</span><span class="p">,</span>
</span><span id="Faults.partial_faulting-1733"><a href="#-1733"><span class="linenos">1733</span></a>        <span class="n">max_throw</span><span class="p">,</span>
</span><span id="Faults.partial_faulting-1734"><a href="#-1734"><span class="linenos">1734</span></a>        <span class="n">origtime_cube</span><span class="p">,</span>
</span><span id="Faults.partial_faulting-1735"><a href="#-1735"><span class="linenos">1735</span></a>        <span class="n">unfaulted_depth_map</span><span class="p">,</span>
</span><span id="Faults.partial_faulting-1736"><a href="#-1736"><span class="linenos">1736</span></a>    <span class="p">):</span>
</span><span id="Faults.partial_faulting-1737"><a href="#-1737"><span class="linenos">1737</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="Faults.partial_faulting-1738"><a href="#-1738"><span class="linenos">1738</span></a><span class="sd">        Partial faulting</span>
</span><span id="Faults.partial_faulting-1739"><a href="#-1739"><span class="linenos">1739</span></a><span class="sd">        ----------------</span>
</span><span id="Faults.partial_faulting-1740"><a href="#-1740"><span class="linenos">1740</span></a>
</span><span id="Faults.partial_faulting-1741"><a href="#-1741"><span class="linenos">1741</span></a><span class="sd">        Executes partial faluting.</span>
</span><span id="Faults.partial_faulting-1742"><a href="#-1742"><span class="linenos">1742</span></a>
</span><span id="Faults.partial_faulting-1743"><a href="#-1743"><span class="linenos">1743</span></a><span class="sd">        The docstring of this function is a work in progress.</span>
</span><span id="Faults.partial_faulting-1744"><a href="#-1744"><span class="linenos">1744</span></a>
</span><span id="Faults.partial_faulting-1745"><a href="#-1745"><span class="linenos">1745</span></a><span class="sd">        Parameters</span>
</span><span id="Faults.partial_faulting-1746"><a href="#-1746"><span class="linenos">1746</span></a><span class="sd">        ----------</span>
</span><span id="Faults.partial_faulting-1747"><a href="#-1747"><span class="linenos">1747</span></a><span class="sd">        depth_map_gaps_faulted : np.ndarray</span>
</span><span id="Faults.partial_faulting-1748"><a href="#-1748"><span class="linenos">1748</span></a><span class="sd">            The depth map.</span>
</span><span id="Faults.partial_faulting-1749"><a href="#-1749"><span class="linenos">1749</span></a><span class="sd">        fault_plane_classification : np.ndarray</span>
</span><span id="Faults.partial_faulting-1750"><a href="#-1750"><span class="linenos">1750</span></a><span class="sd">            Fault plane classifications.</span>
</span><span id="Faults.partial_faulting-1751"><a href="#-1751"><span class="linenos">1751</span></a><span class="sd">        faulted_depth_map : _type_</span>
</span><span id="Faults.partial_faulting-1752"><a href="#-1752"><span class="linenos">1752</span></a><span class="sd">            The faulted depth map.</span>
</span><span id="Faults.partial_faulting-1753"><a href="#-1753"><span class="linenos">1753</span></a><span class="sd">        ii : int</span>
</span><span id="Faults.partial_faulting-1754"><a href="#-1754"><span class="linenos">1754</span></a><span class="sd">            The i position</span>
</span><span id="Faults.partial_faulting-1755"><a href="#-1755"><span class="linenos">1755</span></a><span class="sd">        jj : int</span>
</span><span id="Faults.partial_faulting-1756"><a href="#-1756"><span class="linenos">1756</span></a><span class="sd">            The j position</span>
</span><span id="Faults.partial_faulting-1757"><a href="#-1757"><span class="linenos">1757</span></a><span class="sd">        max_throw : float</span>
</span><span id="Faults.partial_faulting-1758"><a href="#-1758"><span class="linenos">1758</span></a><span class="sd">            The maximum amount of throw for the faults.</span>
</span><span id="Faults.partial_faulting-1759"><a href="#-1759"><span class="linenos">1759</span></a><span class="sd">        origtime_cube : np.ndarray</span>
</span><span id="Faults.partial_faulting-1760"><a href="#-1760"><span class="linenos">1760</span></a><span class="sd">            Original time cube.</span>
</span><span id="Faults.partial_faulting-1761"><a href="#-1761"><span class="linenos">1761</span></a><span class="sd">        unfaulted_depth_map : np.ndarray</span>
</span><span id="Faults.partial_faulting-1762"><a href="#-1762"><span class="linenos">1762</span></a><span class="sd">            Unfaulted depth map.</span>
</span><span id="Faults.partial_faulting-1763"><a href="#-1763"><span class="linenos">1763</span></a>
</span><span id="Faults.partial_faulting-1764"><a href="#-1764"><span class="linenos">1764</span></a><span class="sd">        Returns</span>
</span><span id="Faults.partial_faulting-1765"><a href="#-1765"><span class="linenos">1765</span></a><span class="sd">        -------</span>
</span><span id="Faults.partial_faulting-1766"><a href="#-1766"><span class="linenos">1766</span></a><span class="sd">        faulted_depth_map : np.ndarray</span>
</span><span id="Faults.partial_faulting-1767"><a href="#-1767"><span class="linenos">1767</span></a><span class="sd">            The faulted depth map</span>
</span><span id="Faults.partial_faulting-1768"><a href="#-1768"><span class="linenos">1768</span></a><span class="sd">        depth_map_gaps_faulted : np.ndarray</span>
</span><span id="Faults.partial_faulting-1769"><a href="#-1769"><span class="linenos">1769</span></a><span class="sd">            Depth map with gaps filled</span>
</span><span id="Faults.partial_faulting-1770"><a href="#-1770"><span class="linenos">1770</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Faults.partial_faulting-1771"><a href="#-1771"><span class="linenos">1771</span></a>        <span class="k">for</span> <span class="n">ithrow</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">max_throw</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="Faults.partial_faulting-1772"><a href="#-1772"><span class="linenos">1772</span></a>            <span class="c1"># infilled</span>
</span><span id="Faults.partial_faulting-1773"><a href="#-1773"><span class="linenos">1773</span></a>            <span class="n">partial_faulting_map</span> <span class="o">=</span> <span class="n">unfaulted_depth_map</span> <span class="o">+</span> <span class="n">ithrow</span>
</span><span id="Faults.partial_faulting-1774"><a href="#-1774"><span class="linenos">1774</span></a>            <span class="n">partial_faulting_map_ii_jj</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="Faults.partial_faulting-1775"><a href="#-1775"><span class="linenos">1775</span></a>                <span class="n">partial_faulting_map</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span> <span class="n">jj</span><span class="p">]</span>
</span><span id="Faults.partial_faulting-1776"><a href="#-1776"><span class="linenos">1776</span></a>                <span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;int&quot;</span><span class="p">)</span>
</span><span id="Faults.partial_faulting-1777"><a href="#-1777"><span class="linenos">1777</span></a>                <span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">origtime_cube</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="Faults.partial_faulting-1778"><a href="#-1778"><span class="linenos">1778</span></a>            <span class="p">)</span>
</span><span id="Faults.partial_faulting-1779"><a href="#-1779"><span class="linenos">1779</span></a>            <span class="n">partial_faulting_on_horizon</span> <span class="o">=</span> <span class="n">fault_plane_classification</span><span class="p">[</span>
</span><span id="Faults.partial_faulting-1780"><a href="#-1780"><span class="linenos">1780</span></a>                <span class="n">ii</span><span class="p">,</span> <span class="n">jj</span><span class="p">,</span> <span class="n">partial_faulting_map_ii_jj</span>
</span><span id="Faults.partial_faulting-1781"><a href="#-1781"><span class="linenos">1781</span></a>            <span class="p">][</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
</span><span id="Faults.partial_faulting-1782"><a href="#-1782"><span class="linenos">1782</span></a>            <span class="n">origtime_on_horizon</span> <span class="o">=</span> <span class="n">origtime_cube</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span> <span class="n">jj</span><span class="p">,</span> <span class="n">partial_faulting_map_ii_jj</span><span class="p">][</span>
</span><span id="Faults.partial_faulting-1783"><a href="#-1783"><span class="linenos">1783</span></a>                <span class="o">...</span><span class="p">,</span> <span class="mi">0</span>
</span><span id="Faults.partial_faulting-1784"><a href="#-1784"><span class="linenos">1784</span></a>            <span class="p">]</span>
</span><span id="Faults.partial_faulting-1785"><a href="#-1785"><span class="linenos">1785</span></a>            <span class="n">faulted_depth_map</span><span class="p">[</span><span class="n">partial_faulting_on_horizon</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dstack</span><span class="p">(</span>
</span><span id="Faults.partial_faulting-1786"><a href="#-1786"><span class="linenos">1786</span></a>                <span class="p">(</span><span class="n">origtime_on_horizon</span><span class="p">,</span> <span class="n">partial_faulting_map</span><span class="p">)</span>
</span><span id="Faults.partial_faulting-1787"><a href="#-1787"><span class="linenos">1787</span></a>            <span class="p">)</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)[</span><span class="n">partial_faulting_on_horizon</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="Faults.partial_faulting-1788"><a href="#-1788"><span class="linenos">1788</span></a>            <span class="c1"># gaps</span>
</span><span id="Faults.partial_faulting-1789"><a href="#-1789"><span class="linenos">1789</span></a>            <span class="n">depth_map_gaps_faulted</span><span class="p">[</span><span class="n">partial_faulting_on_horizon</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
</span><span id="Faults.partial_faulting-1790"><a href="#-1790"><span class="linenos">1790</span></a>        <span class="k">return</span> <span class="n">faulted_depth_map</span><span class="p">,</span> <span class="n">depth_map_gaps_faulted</span>
</span></pre></div>


            <div class="docstring"><h6 id="partial-faulting">Partial faulting</h6>

<p>Executes partial faluting.</p>

<p>The docstring of this function is a work in progress.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>depth_map_gaps_faulted</strong> (np.ndarray):
The depth map.</li>
<li><strong>fault_plane_classification</strong> (np.ndarray):
Fault plane classifications.</li>
<li><strong>faulted_depth_map</strong> (_type_):
The faulted depth map.</li>
<li><strong>ii</strong> (int):
The i position</li>
<li><strong>jj</strong> (int):
The j position</li>
<li><strong>max_throw</strong> (float):
The maximum amount of throw for the faults.</li>
<li><strong>origtime_cube</strong> (np.ndarray):
Original time cube.</li>
<li><strong>unfaulted_depth_map</strong> (np.ndarray):
Unfaulted depth map.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>faulted_depth_map</strong> (np.ndarray):
The faulted depth map</li>
<li><strong>depth_map_gaps_faulted</strong> (np.ndarray):
Depth map with gaps filled</li>
</ul>
</div>


                            </div>
                            <div id="Faults.get_displacement_vector" class="classattr">
                                        <input id="Faults.get_displacement_vector-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_displacement_vector</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">semi_axes</span><span class="p">:</span> <span class="nb">tuple</span>,</span><span class="param">	<span class="n">origin</span><span class="p">:</span> <span class="nb">tuple</span>,</span><span class="param">	<span class="n">throw</span><span class="p">:</span> <span class="nb">float</span>,</span><span class="param">	<span class="n">tilt</span>,</span><span class="param">	<span class="n">wb</span>,</span><span class="param">	<span class="n">index</span>,</span><span class="param">	<span class="n">fp</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Faults.get_displacement_vector-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Faults.get_displacement_vector"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Faults.get_displacement_vector-1792"><a href="#-1792"><span class="linenos">1792</span></a>    <span class="k">def</span> <span class="nf">get_displacement_vector</span><span class="p">(</span>
</span><span id="Faults.get_displacement_vector-1793"><a href="#-1793"><span class="linenos">1793</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Faults.get_displacement_vector-1794"><a href="#-1794"><span class="linenos">1794</span></a>        <span class="n">semi_axes</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">,</span>
</span><span id="Faults.get_displacement_vector-1795"><a href="#-1795"><span class="linenos">1795</span></a>        <span class="n">origin</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">,</span>
</span><span id="Faults.get_displacement_vector-1796"><a href="#-1796"><span class="linenos">1796</span></a>        <span class="n">throw</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
</span><span id="Faults.get_displacement_vector-1797"><a href="#-1797"><span class="linenos">1797</span></a>        <span class="n">tilt</span><span class="p">,</span>
</span><span id="Faults.get_displacement_vector-1798"><a href="#-1798"><span class="linenos">1798</span></a>        <span class="n">wb</span><span class="p">,</span>
</span><span id="Faults.get_displacement_vector-1799"><a href="#-1799"><span class="linenos">1799</span></a>        <span class="n">index</span><span class="p">,</span>
</span><span id="Faults.get_displacement_vector-1800"><a href="#-1800"><span class="linenos">1800</span></a>        <span class="n">fp</span>
</span><span id="Faults.get_displacement_vector-1801"><a href="#-1801"><span class="linenos">1801</span></a>    <span class="p">):</span>
</span><span id="Faults.get_displacement_vector-1802"><a href="#-1802"><span class="linenos">1802</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="Faults.get_displacement_vector-1803"><a href="#-1803"><span class="linenos">1803</span></a><span class="sd">        Gets a displacement vector.</span>
</span><span id="Faults.get_displacement_vector-1804"><a href="#-1804"><span class="linenos">1804</span></a>
</span><span id="Faults.get_displacement_vector-1805"><a href="#-1805"><span class="linenos">1805</span></a><span class="sd">        Parameters</span>
</span><span id="Faults.get_displacement_vector-1806"><a href="#-1806"><span class="linenos">1806</span></a><span class="sd">        ----------</span>
</span><span id="Faults.get_displacement_vector-1807"><a href="#-1807"><span class="linenos">1807</span></a><span class="sd">        semi_axes : tuple</span>
</span><span id="Faults.get_displacement_vector-1808"><a href="#-1808"><span class="linenos">1808</span></a><span class="sd">            The semi axes.</span>
</span><span id="Faults.get_displacement_vector-1809"><a href="#-1809"><span class="linenos">1809</span></a><span class="sd">        origin : tuple</span>
</span><span id="Faults.get_displacement_vector-1810"><a href="#-1810"><span class="linenos">1810</span></a><span class="sd">            The origin.</span>
</span><span id="Faults.get_displacement_vector-1811"><a href="#-1811"><span class="linenos">1811</span></a><span class="sd">        throw : float</span>
</span><span id="Faults.get_displacement_vector-1812"><a href="#-1812"><span class="linenos">1812</span></a><span class="sd">            The throw of th fault to use.</span>
</span><span id="Faults.get_displacement_vector-1813"><a href="#-1813"><span class="linenos">1813</span></a><span class="sd">        tilt : float</span>
</span><span id="Faults.get_displacement_vector-1814"><a href="#-1814"><span class="linenos">1814</span></a><span class="sd">            The tilt of the fault.</span>
</span><span id="Faults.get_displacement_vector-1815"><a href="#-1815"><span class="linenos">1815</span></a><span class="sd">        </span>
</span><span id="Faults.get_displacement_vector-1816"><a href="#-1816"><span class="linenos">1816</span></a><span class="sd">        Returns</span>
</span><span id="Faults.get_displacement_vector-1817"><a href="#-1817"><span class="linenos">1817</span></a><span class="sd">        -------</span>
</span><span id="Faults.get_displacement_vector-1818"><a href="#-1818"><span class="linenos">1818</span></a><span class="sd">        stretch_times : np.ndarray</span>
</span><span id="Faults.get_displacement_vector-1819"><a href="#-1819"><span class="linenos">1819</span></a><span class="sd">            The stretch times.</span>
</span><span id="Faults.get_displacement_vector-1820"><a href="#-1820"><span class="linenos">1820</span></a><span class="sd">        stretch_times_classification : np.ndarray</span>
</span><span id="Faults.get_displacement_vector-1821"><a href="#-1821"><span class="linenos">1821</span></a><span class="sd">            Stretch times classification.</span>
</span><span id="Faults.get_displacement_vector-1822"><a href="#-1822"><span class="linenos">1822</span></a><span class="sd">        interpolation : bool</span>
</span><span id="Faults.get_displacement_vector-1823"><a href="#-1823"><span class="linenos">1823</span></a><span class="sd">            Whether or not to interpolate.</span>
</span><span id="Faults.get_displacement_vector-1824"><a href="#-1824"><span class="linenos">1824</span></a><span class="sd">        hockey_stick : int</span>
</span><span id="Faults.get_displacement_vector-1825"><a href="#-1825"><span class="linenos">1825</span></a><span class="sd">            The hockey stick.</span>
</span><span id="Faults.get_displacement_vector-1826"><a href="#-1826"><span class="linenos">1826</span></a><span class="sd">        fault_segments : np.ndarray</span>
</span><span id="Faults.get_displacement_vector-1827"><a href="#-1827"><span class="linenos">1827</span></a>
</span><span id="Faults.get_displacement_vector-1828"><a href="#-1828"><span class="linenos">1828</span></a><span class="sd">        ellipsoid : </span>
</span><span id="Faults.get_displacement_vector-1829"><a href="#-1829"><span class="linenos">1829</span></a><span class="sd">        fp : </span>
</span><span id="Faults.get_displacement_vector-1830"><a href="#-1830"><span class="linenos">1830</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Faults.get_displacement_vector-1831"><a href="#-1831"><span class="linenos">1831</span></a>        <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">semi_axes</span>
</span><span id="Faults.get_displacement_vector-1832"><a href="#-1832"><span class="linenos">1832</span></a>        <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">z0</span> <span class="o">=</span> <span class="n">origin</span>
</span><span id="Faults.get_displacement_vector-1833"><a href="#-1833"><span class="linenos">1833</span></a>
</span><span id="Faults.get_displacement_vector-1834"><a href="#-1834"><span class="linenos">1834</span></a>        <span class="n">random_shear_zone_width</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="Faults.get_displacement_vector-1835"><a href="#-1835"><span class="linenos">1835</span></a>            <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="mf">0.75</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span> <span class="o">*</span> <span class="mi">200</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">200</span>
</span><span id="Faults.get_displacement_vector-1836"><a href="#-1836"><span class="linenos">1836</span></a>        <span class="p">)</span>
</span><span id="Faults.get_displacement_vector-1837"><a href="#-1837"><span class="linenos">1837</span></a>        <span class="k">if</span> <span class="n">random_shear_zone_width</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Faults.get_displacement_vector-1838"><a href="#-1838"><span class="linenos">1838</span></a>            <span class="n">random_gouge_pctile</span> <span class="o">=</span> <span class="mi">100</span>
</span><span id="Faults.get_displacement_vector-1839"><a href="#-1839"><span class="linenos">1839</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Faults.get_displacement_vector-1840"><a href="#-1840"><span class="linenos">1840</span></a>            <span class="c1"># clip amplitudes inside shear_zone with this percentile of total (100 implies doing nothing)</span>
</span><span id="Faults.get_displacement_vector-1841"><a href="#-1841"><span class="linenos">1841</span></a>            <span class="n">random_gouge_pctile</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">triangular</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
</span><span id="Faults.get_displacement_vector-1842"><a href="#-1842"><span class="linenos">1842</span></a>        <span class="c1"># Store the random values</span>
</span><span id="Faults.get_displacement_vector-1843"><a href="#-1843"><span class="linenos">1843</span></a>        <span class="n">fp</span><span class="p">[</span><span class="s2">&quot;shear_zone_width&quot;</span><span class="p">][</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">random_shear_zone_width</span>
</span><span id="Faults.get_displacement_vector-1844"><a href="#-1844"><span class="linenos">1844</span></a>        <span class="n">fp</span><span class="p">[</span><span class="s2">&quot;gouge_pctile&quot;</span><span class="p">][</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">random_gouge_pctile</span>
</span><span id="Faults.get_displacement_vector-1845"><a href="#-1845"><span class="linenos">1845</span></a>
</span><span id="Faults.get_displacement_vector-1846"><a href="#-1846"><span class="linenos">1846</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Faults.get_displacement_vector-1847"><a href="#-1847"><span class="linenos">1847</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   ...shear_zone_width (samples) = </span><span class="si">{</span><span class="n">random_shear_zone_width</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Faults.get_displacement_vector-1848"><a href="#-1848"><span class="linenos">1848</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   ...gouge_pctile (percent*100) = </span><span class="si">{</span><span class="n">random_gouge_pctile</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Faults.get_displacement_vector-1849"><a href="#-1849"><span class="linenos">1849</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   .... output_cube.shape = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">geologic_age</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Faults.get_displacement_vector-1850"><a href="#-1850"><span class="linenos">1850</span></a>            <span class="n">_p</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="Faults.get_displacement_vector-1851"><a href="#-1851"><span class="linenos">1851</span></a>                <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">geologic_age</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">infill_factor</span>
</span><span id="Faults.get_displacement_vector-1852"><a href="#-1852"><span class="linenos">1852</span></a>            <span class="p">)</span><span class="o">.</span><span class="n">shape</span>
</span><span id="Faults.get_displacement_vector-1853"><a href="#-1853"><span class="linenos">1853</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="Faults.get_displacement_vector-1854"><a href="#-1854"><span class="linenos">1854</span></a>                <span class="sa">f</span><span class="s2">&quot;   .... (np.arange(output_cube.shape[2])*infill_factor).shape = </span><span class="si">{</span><span class="n">_p</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Faults.get_displacement_vector-1855"><a href="#-1855"><span class="linenos">1855</span></a>            <span class="p">)</span>
</span><span id="Faults.get_displacement_vector-1856"><a href="#-1856"><span class="linenos">1856</span></a>
</span><span id="Faults.get_displacement_vector-1857"><a href="#-1857"><span class="linenos">1857</span></a>        <span class="n">ellipsoid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rotate_3d_ellipsoid</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">z0</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">tilt</span><span class="p">)</span>
</span><span id="Faults.get_displacement_vector-1858"><a href="#-1858"><span class="linenos">1858</span></a>        <span class="n">fault_segments</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_fault_plane_sobel</span><span class="p">(</span><span class="n">ellipsoid</span><span class="p">)</span>
</span><span id="Faults.get_displacement_vector-1859"><a href="#-1859"><span class="linenos">1859</span></a>        <span class="n">z_idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_fault_centre</span><span class="p">(</span><span class="n">ellipsoid</span><span class="p">,</span> <span class="n">wb</span><span class="p">,</span> <span class="n">fault_segments</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>
</span><span id="Faults.get_displacement_vector-1860"><a href="#-1860"><span class="linenos">1860</span></a>
</span><span id="Faults.get_displacement_vector-1861"><a href="#-1861"><span class="linenos">1861</span></a>        <span class="c1"># Initialise return objects in case z_idx size == 0</span>
</span><span id="Faults.get_displacement_vector-1862"><a href="#-1862"><span class="linenos">1862</span></a>        <span class="n">interpolation</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Faults.get_displacement_vector-1863"><a href="#-1863"><span class="linenos">1863</span></a>        <span class="n">hockey_stick</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Faults.get_displacement_vector-1864"><a href="#-1864"><span class="linenos">1864</span></a>        <span class="c1"># displacement_cube = None</span>
</span><span id="Faults.get_displacement_vector-1865"><a href="#-1865"><span class="linenos">1865</span></a>        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">z_idx</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Faults.get_displacement_vector-1866"><a href="#-1866"><span class="linenos">1866</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    ... Computing fault depth at max displacement&quot;</span><span class="p">)</span>
</span><span id="Faults.get_displacement_vector-1867"><a href="#-1867"><span class="linenos">1867</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    ... depth at max displacement  = </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">z_idx</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
</span><span id="Faults.get_displacement_vector-1868"><a href="#-1868"><span class="linenos">1868</span></a>            <span class="n">down</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">ellipsoid</span><span class="p">[</span><span class="n">ellipsoid</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span>
</span><span id="Faults.get_displacement_vector-1869"><a href="#-1869"><span class="linenos">1869</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">geologic_age</span><span class="p">[:]</span><span class="o">.</span><span class="n">shape</span>
</span><span id="Faults.get_displacement_vector-1870"><a href="#-1870"><span class="linenos">1870</span></a>            <span class="p">)</span>
</span><span id="Faults.get_displacement_vector-1871"><a href="#-1871"><span class="linenos">1871</span></a>            <span class="sd">&quot;&quot;&quot;</span>
</span><span id="Faults.get_displacement_vector-1872"><a href="#-1872"><span class="linenos">1872</span></a><span class="sd">            down = np.int16(len(np.where(ellipsoid &lt; 1.)[0]) / 1.0 * (self.vols.geologic_age.shape[2] *</span>
</span><span id="Faults.get_displacement_vector-1873"><a href="#-1873"><span class="linenos">1873</span></a><span class="sd">                                                                      self.vols.geologic_age.shape[1] *</span>
</span><span id="Faults.get_displacement_vector-1874"><a href="#-1874"><span class="linenos">1874</span></a><span class="sd">                                                                      self.vols.geologic_age.shape[0]))</span>
</span><span id="Faults.get_displacement_vector-1875"><a href="#-1875"><span class="linenos">1875</span></a><span class="sd">            print(&quot;    ... This fault has {!s} %% of downthrown samples&quot;.format(down))</span>
</span><span id="Faults.get_displacement_vector-1876"><a href="#-1876"><span class="linenos">1876</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="Faults.get_displacement_vector-1877"><a href="#-1877"><span class="linenos">1877</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="Faults.get_displacement_vector-1878"><a href="#-1878"><span class="linenos">1878</span></a>                <span class="s2">&quot;    ... This fault has &quot;</span>
</span><span id="Faults.get_displacement_vector-1879"><a href="#-1879"><span class="linenos">1879</span></a>                <span class="o">+</span> <span class="nb">format</span><span class="p">(</span><span class="n">down</span><span class="p">,</span> <span class="s2">&quot;5.1%&quot;</span><span class="p">)</span>
</span><span id="Faults.get_displacement_vector-1880"><a href="#-1880"><span class="linenos">1880</span></a>                <span class="o">+</span> <span class="s2">&quot; of downthrown samples&quot;</span>
</span><span id="Faults.get_displacement_vector-1881"><a href="#-1881"><span class="linenos">1881</span></a>            <span class="p">)</span>
</span><span id="Faults.get_displacement_vector-1882"><a href="#-1882"><span class="linenos">1882</span></a>
</span><span id="Faults.get_displacement_vector-1883"><a href="#-1883"><span class="linenos">1883</span></a>            <span class="p">(</span>
</span><span id="Faults.get_displacement_vector-1884"><a href="#-1884"><span class="linenos">1884</span></a>                <span class="n">stretch_times</span><span class="p">,</span>
</span><span id="Faults.get_displacement_vector-1885"><a href="#-1885"><span class="linenos">1885</span></a>                <span class="n">stretch_times_classification</span><span class="p">,</span>
</span><span id="Faults.get_displacement_vector-1886"><a href="#-1886"><span class="linenos">1886</span></a>                <span class="n">interpolation</span><span class="p">,</span>
</span><span id="Faults.get_displacement_vector-1887"><a href="#-1887"><span class="linenos">1887</span></a>                <span class="n">hockey_stick</span><span class="p">,</span>
</span><span id="Faults.get_displacement_vector-1888"><a href="#-1888"><span class="linenos">1888</span></a>            <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xyz_dis</span><span class="p">(</span><span class="n">z_idx</span><span class="p">,</span> <span class="n">throw</span><span class="p">,</span> <span class="n">fault_segments</span><span class="p">,</span> <span class="n">ellipsoid</span><span class="p">,</span> <span class="n">wb</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>
</span><span id="Faults.get_displacement_vector-1889"><a href="#-1889"><span class="linenos">1889</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Faults.get_displacement_vector-1890"><a href="#-1890"><span class="linenos">1890</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  ... Ellipsoid larger than cube no fault inserted&quot;</span><span class="p">)</span>
</span><span id="Faults.get_displacement_vector-1891"><a href="#-1891"><span class="linenos">1891</span></a>            <span class="n">stretch_times</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">ellipsoid</span><span class="p">)</span>
</span><span id="Faults.get_displacement_vector-1892"><a href="#-1892"><span class="linenos">1892</span></a>            <span class="n">stretch_times_classification</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">geologic_age</span><span class="p">[:])</span>
</span><span id="Faults.get_displacement_vector-1893"><a href="#-1893"><span class="linenos">1893</span></a>
</span><span id="Faults.get_displacement_vector-1894"><a href="#-1894"><span class="linenos">1894</span></a>        <span class="n">max_fault_throw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_fault_throw</span><span class="p">[:]</span>
</span><span id="Faults.get_displacement_vector-1895"><a href="#-1895"><span class="linenos">1895</span></a>        <span class="n">max_fault_throw</span><span class="p">[</span><span class="n">ellipsoid</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="n">throw</span><span class="p">)</span>
</span><span id="Faults.get_displacement_vector-1896"><a href="#-1896"><span class="linenos">1896</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">max_fault_throw</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">max_fault_throw</span>
</span><span id="Faults.get_displacement_vector-1897"><a href="#-1897"><span class="linenos">1897</span></a>
</span><span id="Faults.get_displacement_vector-1898"><a href="#-1898"><span class="linenos">1898</span></a>        <span class="k">return</span> <span class="p">(</span>
</span><span id="Faults.get_displacement_vector-1899"><a href="#-1899"><span class="linenos">1899</span></a>            <span class="n">stretch_times</span><span class="p">,</span>
</span><span id="Faults.get_displacement_vector-1900"><a href="#-1900"><span class="linenos">1900</span></a>            <span class="n">stretch_times_classification</span><span class="p">,</span>
</span><span id="Faults.get_displacement_vector-1901"><a href="#-1901"><span class="linenos">1901</span></a>            <span class="n">interpolation</span><span class="p">,</span>
</span><span id="Faults.get_displacement_vector-1902"><a href="#-1902"><span class="linenos">1902</span></a>            <span class="n">hockey_stick</span><span class="p">,</span>
</span><span id="Faults.get_displacement_vector-1903"><a href="#-1903"><span class="linenos">1903</span></a>            <span class="n">fault_segments</span><span class="p">,</span>
</span><span id="Faults.get_displacement_vector-1904"><a href="#-1904"><span class="linenos">1904</span></a>            <span class="n">ellipsoid</span><span class="p">,</span>
</span><span id="Faults.get_displacement_vector-1905"><a href="#-1905"><span class="linenos">1905</span></a>            <span class="n">fp</span><span class="p">,</span>
</span><span id="Faults.get_displacement_vector-1906"><a href="#-1906"><span class="linenos">1906</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Gets a displacement vector.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>semi_axes</strong> (tuple):
The semi axes.</li>
<li><strong>origin</strong> (tuple):
The origin.</li>
<li><strong>throw</strong> (float):
The throw of th fault to use.</li>
<li><strong>tilt</strong> (float):
The tilt of the fault.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>stretch_times</strong> (np.ndarray):
The stretch times.</li>
<li><strong>stretch_times_classification</strong> (np.ndarray):
Stretch times classification.</li>
<li><strong>interpolation</strong> (bool):
Whether or not to interpolate.</li>
<li><strong>hockey_stick</strong> (int):
The hockey stick.</li>
<li><p><strong>fault_segments</strong> (np.ndarray):</p></li>
<li><p><strong>ellipsoid</strong> ():</p></li>
<li><p><strong>fp :</strong></p></li>
</ul>
</div>


                            </div>
                            <div id="Faults.apply_xyz_displacement" class="classattr">
                                        <input id="Faults.apply_xyz_displacement-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">apply_xyz_displacement</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">traces</span></span><span class="return-annotation">) -> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span>:</span></span>

                <label class="view-source-button" for="Faults.apply_xyz_displacement-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Faults.apply_xyz_displacement"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Faults.apply_xyz_displacement-1908"><a href="#-1908"><span class="linenos">1908</span></a>    <span class="k">def</span> <span class="nf">apply_xyz_displacement</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">traces</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="Faults.apply_xyz_displacement-1909"><a href="#-1909"><span class="linenos">1909</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="Faults.apply_xyz_displacement-1910"><a href="#-1910"><span class="linenos">1910</span></a><span class="sd">        Applies XYZ Displacement.</span>
</span><span id="Faults.apply_xyz_displacement-1911"><a href="#-1911"><span class="linenos">1911</span></a><span class="sd">        </span>
</span><span id="Faults.apply_xyz_displacement-1912"><a href="#-1912"><span class="linenos">1912</span></a><span class="sd">        Apply stretching and squeezing previously applied to the input cube</span>
</span><span id="Faults.apply_xyz_displacement-1913"><a href="#-1913"><span class="linenos">1913</span></a><span class="sd">        vertically to give all depths the same number of extrema.</span>
</span><span id="Faults.apply_xyz_displacement-1914"><a href="#-1914"><span class="linenos">1914</span></a>
</span><span id="Faults.apply_xyz_displacement-1915"><a href="#-1915"><span class="linenos">1915</span></a><span class="sd">        This is intended to be a proxy for making the</span>
</span><span id="Faults.apply_xyz_displacement-1916"><a href="#-1916"><span class="linenos">1916</span></a><span class="sd">        dominant frequency the same everywhere.</span>
</span><span id="Faults.apply_xyz_displacement-1917"><a href="#-1917"><span class="linenos">1917</span></a>
</span><span id="Faults.apply_xyz_displacement-1918"><a href="#-1918"><span class="linenos">1918</span></a><span class="sd">        Parameters</span>
</span><span id="Faults.apply_xyz_displacement-1919"><a href="#-1919"><span class="linenos">1919</span></a><span class="sd">        ----------</span>
</span><span id="Faults.apply_xyz_displacement-1920"><a href="#-1920"><span class="linenos">1920</span></a><span class="sd">        traces : np.ndarray</span>
</span><span id="Faults.apply_xyz_displacement-1921"><a href="#-1921"><span class="linenos">1921</span></a><span class="sd">            Previously stretched/squeezed trace(s)</span>
</span><span id="Faults.apply_xyz_displacement-1922"><a href="#-1922"><span class="linenos">1922</span></a>
</span><span id="Faults.apply_xyz_displacement-1923"><a href="#-1923"><span class="linenos">1923</span></a><span class="sd">        Returns</span>
</span><span id="Faults.apply_xyz_displacement-1924"><a href="#-1924"><span class="linenos">1924</span></a><span class="sd">        -------</span>
</span><span id="Faults.apply_xyz_displacement-1925"><a href="#-1925"><span class="linenos">1925</span></a><span class="sd">        unstretch_traces: np.ndarray</span>
</span><span id="Faults.apply_xyz_displacement-1926"><a href="#-1926"><span class="linenos">1926</span></a><span class="sd">            Un-stretched/un-squeezed trace(s)</span>
</span><span id="Faults.apply_xyz_displacement-1927"><a href="#-1927"><span class="linenos">1927</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Faults.apply_xyz_displacement-1928"><a href="#-1928"><span class="linenos">1928</span></a>        <span class="n">unstretch_traces</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">traces</span><span class="p">)</span>
</span><span id="Faults.apply_xyz_displacement-1929"><a href="#-1929"><span class="linenos">1929</span></a>        <span class="n">origtime</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">traces</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</span><span id="Faults.apply_xyz_displacement-1930"><a href="#-1930"><span class="linenos">1930</span></a>
</span><span id="Faults.apply_xyz_displacement-1931"><a href="#-1931"><span class="linenos">1931</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">   ... Cube parameters going into interpolation&quot;</span><span class="p">)</span>
</span><span id="Faults.apply_xyz_displacement-1932"><a href="#-1932"><span class="linenos">1932</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">   ... Origtime shape  = </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">origtime</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Faults.apply_xyz_displacement-1933"><a href="#-1933"><span class="linenos">1933</span></a>        <span class="nb">print</span><span class="p">(</span>
</span><span id="Faults.apply_xyz_displacement-1934"><a href="#-1934"><span class="linenos">1934</span></a>            <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">   ... stretch_times_effects shape  = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">displacement_vectors</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Faults.apply_xyz_displacement-1935"><a href="#-1935"><span class="linenos">1935</span></a>        <span class="p">)</span>
</span><span id="Faults.apply_xyz_displacement-1936"><a href="#-1936"><span class="linenos">1936</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">   ... unstretch_times shape  = </span><span class="si">{</span><span class="n">unstretch_traces</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Faults.apply_xyz_displacement-1937"><a href="#-1937"><span class="linenos">1937</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">   ... traces shape  = </span><span class="si">{</span><span class="n">traces</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Faults.apply_xyz_displacement-1938"><a href="#-1938"><span class="linenos">1938</span></a>
</span><span id="Faults.apply_xyz_displacement-1939"><a href="#-1939"><span class="linenos">1939</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">traces</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="Faults.apply_xyz_displacement-1940"><a href="#-1940"><span class="linenos">1940</span></a>            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">traces</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
</span><span id="Faults.apply_xyz_displacement-1941"><a href="#-1941"><span class="linenos">1941</span></a>                <span class="k">if</span> <span class="n">traces</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">!=</span> <span class="n">traces</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">max</span><span class="p">():</span>
</span><span id="Faults.apply_xyz_displacement-1942"><a href="#-1942"><span class="linenos">1942</span></a>                    <span class="n">unstretch_traces</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span>
</span><span id="Faults.apply_xyz_displacement-1943"><a href="#-1943"><span class="linenos">1943</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">displacement_vectors</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="p">:],</span> <span class="n">origtime</span><span class="p">,</span> <span class="n">traces</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="p">:]</span>
</span><span id="Faults.apply_xyz_displacement-1944"><a href="#-1944"><span class="linenos">1944</span></a>                    <span class="p">)</span>
</span><span id="Faults.apply_xyz_displacement-1945"><a href="#-1945"><span class="linenos">1945</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Faults.apply_xyz_displacement-1946"><a href="#-1946"><span class="linenos">1946</span></a>                    <span class="n">unstretch_traces</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">traces</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="p">:]</span>
</span><span id="Faults.apply_xyz_displacement-1947"><a href="#-1947"><span class="linenos">1947</span></a>        <span class="k">return</span> <span class="n">unstretch_traces</span>
</span></pre></div>


            <div class="docstring"><p>Applies XYZ Displacement.</p>

<p>Apply stretching and squeezing previously applied to the input cube
vertically to give all depths the same number of extrema.</p>

<p>This is intended to be a proxy for making the
dominant frequency the same everywhere.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>traces</strong> (np.ndarray):
Previously stretched/squeezed trace(s)</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>unstretch_traces</strong> (np.ndarray):
Un-stretched/un-squeezed trace(s)</li>
</ul>
</div>


                            </div>
                            <div id="Faults.copy_and_divide_depth_maps_by_infill" class="classattr">
                                        <input id="Faults.copy_and_divide_depth_maps_by_infill-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">copy_and_divide_depth_maps_by_infill</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">zmaps</span></span><span class="return-annotation">) -> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span>:</span></span>

                <label class="view-source-button" for="Faults.copy_and_divide_depth_maps_by_infill-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Faults.copy_and_divide_depth_maps_by_infill"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Faults.copy_and_divide_depth_maps_by_infill-1949"><a href="#-1949"><span class="linenos">1949</span></a>    <span class="k">def</span> <span class="nf">copy_and_divide_depth_maps_by_infill</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zmaps</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="Faults.copy_and_divide_depth_maps_by_infill-1950"><a href="#-1950"><span class="linenos">1950</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="Faults.copy_and_divide_depth_maps_by_infill-1951"><a href="#-1951"><span class="linenos">1951</span></a><span class="sd">        Copy and divide depth maps by infill factor</span>
</span><span id="Faults.copy_and_divide_depth_maps_by_infill-1952"><a href="#-1952"><span class="linenos">1952</span></a><span class="sd">        -------------------------------------------</span>
</span><span id="Faults.copy_and_divide_depth_maps_by_infill-1953"><a href="#-1953"><span class="linenos">1953</span></a>
</span><span id="Faults.copy_and_divide_depth_maps_by_infill-1954"><a href="#-1954"><span class="linenos">1954</span></a><span class="sd">        Copies and divides depth maps by infill factor.</span>
</span><span id="Faults.copy_and_divide_depth_maps_by_infill-1955"><a href="#-1955"><span class="linenos">1955</span></a>
</span><span id="Faults.copy_and_divide_depth_maps_by_infill-1956"><a href="#-1956"><span class="linenos">1956</span></a><span class="sd">        Parameters</span>
</span><span id="Faults.copy_and_divide_depth_maps_by_infill-1957"><a href="#-1957"><span class="linenos">1957</span></a><span class="sd">        ----------</span>
</span><span id="Faults.copy_and_divide_depth_maps_by_infill-1958"><a href="#-1958"><span class="linenos">1958</span></a><span class="sd">        zmaps : np.array</span>
</span><span id="Faults.copy_and_divide_depth_maps_by_infill-1959"><a href="#-1959"><span class="linenos">1959</span></a><span class="sd">            The depth maps to copy and divide.</span>
</span><span id="Faults.copy_and_divide_depth_maps_by_infill-1960"><a href="#-1960"><span class="linenos">1960</span></a>
</span><span id="Faults.copy_and_divide_depth_maps_by_infill-1961"><a href="#-1961"><span class="linenos">1961</span></a><span class="sd">        Returns</span>
</span><span id="Faults.copy_and_divide_depth_maps_by_infill-1962"><a href="#-1962"><span class="linenos">1962</span></a><span class="sd">        -------</span>
</span><span id="Faults.copy_and_divide_depth_maps_by_infill-1963"><a href="#-1963"><span class="linenos">1963</span></a><span class="sd">        np.ndarray</span>
</span><span id="Faults.copy_and_divide_depth_maps_by_infill-1964"><a href="#-1964"><span class="linenos">1964</span></a><span class="sd">            The result of the division</span>
</span><span id="Faults.copy_and_divide_depth_maps_by_infill-1965"><a href="#-1965"><span class="linenos">1965</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Faults.copy_and_divide_depth_maps_by_infill-1966"><a href="#-1966"><span class="linenos">1966</span></a>        <span class="k">return</span> <span class="n">zmaps</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">infill_factor</span>
</span></pre></div>


            <div class="docstring"><h6 id="copy-and-divide-depth-maps-by-infill-factor">Copy and divide depth maps by infill factor</h6>

<p>Copies and divides depth maps by infill factor.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>zmaps</strong> (np.array):
The depth maps to copy and divide.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>np.ndarray</strong>: The result of the division</li>
</ul>
</div>


                            </div>
                            <div id="Faults.rotate_3d_ellipsoid" class="classattr">
                                        <input id="Faults.rotate_3d_ellipsoid-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">rotate_3d_ellipsoid</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">x0</span>, </span><span class="param"><span class="n">y0</span>, </span><span class="param"><span class="n">z0</span>, </span><span class="param"><span class="n">a</span>, </span><span class="param"><span class="n">b</span>, </span><span class="param"><span class="n">c</span>, </span><span class="param"><span class="n">fraction</span></span><span class="return-annotation">) -> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span>:</span></span>

                <label class="view-source-button" for="Faults.rotate_3d_ellipsoid-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Faults.rotate_3d_ellipsoid"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Faults.rotate_3d_ellipsoid-1968"><a href="#-1968"><span class="linenos">1968</span></a>    <span class="k">def</span> <span class="nf">rotate_3d_ellipsoid</span><span class="p">(</span>
</span><span id="Faults.rotate_3d_ellipsoid-1969"><a href="#-1969"><span class="linenos">1969</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">z0</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">fraction</span>
</span><span id="Faults.rotate_3d_ellipsoid-1970"><a href="#-1970"><span class="linenos">1970</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="Faults.rotate_3d_ellipsoid-1971"><a href="#-1971"><span class="linenos">1971</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="Faults.rotate_3d_ellipsoid-1972"><a href="#-1972"><span class="linenos">1972</span></a><span class="sd">        Rotate a 3D ellipsoid</span>
</span><span id="Faults.rotate_3d_ellipsoid-1973"><a href="#-1973"><span class="linenos">1973</span></a><span class="sd">        ---------------------</span>
</span><span id="Faults.rotate_3d_ellipsoid-1974"><a href="#-1974"><span class="linenos">1974</span></a>
</span><span id="Faults.rotate_3d_ellipsoid-1975"><a href="#-1975"><span class="linenos">1975</span></a><span class="sd">        Parameters</span>
</span><span id="Faults.rotate_3d_ellipsoid-1976"><a href="#-1976"><span class="linenos">1976</span></a><span class="sd">        ----------</span>
</span><span id="Faults.rotate_3d_ellipsoid-1977"><a href="#-1977"><span class="linenos">1977</span></a><span class="sd">        x0 : _type_</span>
</span><span id="Faults.rotate_3d_ellipsoid-1978"><a href="#-1978"><span class="linenos">1978</span></a><span class="sd">            _description_</span>
</span><span id="Faults.rotate_3d_ellipsoid-1979"><a href="#-1979"><span class="linenos">1979</span></a><span class="sd">        y0 : _type_</span>
</span><span id="Faults.rotate_3d_ellipsoid-1980"><a href="#-1980"><span class="linenos">1980</span></a><span class="sd">            _description_</span>
</span><span id="Faults.rotate_3d_ellipsoid-1981"><a href="#-1981"><span class="linenos">1981</span></a><span class="sd">        z0 : _type_</span>
</span><span id="Faults.rotate_3d_ellipsoid-1982"><a href="#-1982"><span class="linenos">1982</span></a><span class="sd">            _description_</span>
</span><span id="Faults.rotate_3d_ellipsoid-1983"><a href="#-1983"><span class="linenos">1983</span></a><span class="sd">        a : _type_</span>
</span><span id="Faults.rotate_3d_ellipsoid-1984"><a href="#-1984"><span class="linenos">1984</span></a><span class="sd">            _description_</span>
</span><span id="Faults.rotate_3d_ellipsoid-1985"><a href="#-1985"><span class="linenos">1985</span></a><span class="sd">        b : _type_</span>
</span><span id="Faults.rotate_3d_ellipsoid-1986"><a href="#-1986"><span class="linenos">1986</span></a><span class="sd">            _description_</span>
</span><span id="Faults.rotate_3d_ellipsoid-1987"><a href="#-1987"><span class="linenos">1987</span></a><span class="sd">        c : _type_</span>
</span><span id="Faults.rotate_3d_ellipsoid-1988"><a href="#-1988"><span class="linenos">1988</span></a><span class="sd">            _description_</span>
</span><span id="Faults.rotate_3d_ellipsoid-1989"><a href="#-1989"><span class="linenos">1989</span></a><span class="sd">        fraction : _type_</span>
</span><span id="Faults.rotate_3d_ellipsoid-1990"><a href="#-1990"><span class="linenos">1990</span></a><span class="sd">            _description_</span>
</span><span id="Faults.rotate_3d_ellipsoid-1991"><a href="#-1991"><span class="linenos">1991</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Faults.rotate_3d_ellipsoid-1992"><a href="#-1992"><span class="linenos">1992</span></a>        <span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">z1</span><span class="p">,</span> <span class="n">x_0</span><span class="p">,</span> <span class="n">y_0</span><span class="p">,</span> <span class="n">z_0</span><span class="p">,</span> <span class="n">a1</span><span class="p">,</span> <span class="n">b1</span><span class="p">,</span> <span class="n">c1</span><span class="p">):</span>
</span><span id="Faults.rotate_3d_ellipsoid-1993"><a href="#-1993"><span class="linenos">1993</span></a>            <span class="k">return</span> <span class="p">(</span>
</span><span id="Faults.rotate_3d_ellipsoid-1994"><a href="#-1994"><span class="linenos">1994</span></a>                <span class="p">((</span><span class="n">x1</span> <span class="o">-</span> <span class="n">x_0</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="n">a1</span> <span class="o">+</span> <span class="p">((</span><span class="n">y1</span> <span class="o">-</span> <span class="n">y_0</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="n">b1</span> <span class="o">+</span> <span class="p">((</span><span class="n">z1</span> <span class="o">-</span> <span class="n">z_0</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="n">c1</span>
</span><span id="Faults.rotate_3d_ellipsoid-1995"><a href="#-1995"><span class="linenos">1995</span></a>            <span class="p">)</span>
</span><span id="Faults.rotate_3d_ellipsoid-1996"><a href="#-1996"><span class="linenos">1996</span></a>
</span><span id="Faults.rotate_3d_ellipsoid-1997"><a href="#-1997"><span class="linenos">1997</span></a>        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">geologic_age</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;float&quot;</span><span class="p">)</span>
</span><span id="Faults.rotate_3d_ellipsoid-1998"><a href="#-1998"><span class="linenos">1998</span></a>        <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">geologic_age</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;float&quot;</span><span class="p">)</span>
</span><span id="Faults.rotate_3d_ellipsoid-1999"><a href="#-1999"><span class="linenos">1999</span></a>        <span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">geologic_age</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;float&quot;</span><span class="p">)</span>
</span><span id="Faults.rotate_3d_ellipsoid-2000"><a href="#-2000"><span class="linenos">2000</span></a>
</span><span id="Faults.rotate_3d_ellipsoid-2001"><a href="#-2001"><span class="linenos">2001</span></a>        <span class="n">xx</span><span class="p">,</span> <span class="n">yy</span><span class="p">,</span> <span class="n">zz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">indexing</span><span class="o">=</span><span class="s2">&quot;ij&quot;</span><span class="p">,</span> <span class="n">sparse</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="Faults.rotate_3d_ellipsoid-2002"><a href="#-2002"><span class="linenos">2002</span></a>
</span><span id="Faults.rotate_3d_ellipsoid-2003"><a href="#-2003"><span class="linenos">2003</span></a>        <span class="n">xyz</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="Faults.rotate_3d_ellipsoid-2004"><a href="#-2004"><span class="linenos">2004</span></a>            <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">xx</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">yy</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">zz</span><span class="o">.</span><span class="n">flatten</span><span class="p">()))</span>
</span><span id="Faults.rotate_3d_ellipsoid-2005"><a href="#-2005"><span class="linenos">2005</span></a>            <span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="Faults.rotate_3d_ellipsoid-2006"><a href="#-2006"><span class="linenos">2006</span></a>            <span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;float&quot;</span><span class="p">)</span>
</span><span id="Faults.rotate_3d_ellipsoid-2007"><a href="#-2007"><span class="linenos">2007</span></a>        <span class="p">)</span>
</span><span id="Faults.rotate_3d_ellipsoid-2008"><a href="#-2008"><span class="linenos">2008</span></a>
</span><span id="Faults.rotate_3d_ellipsoid-2009"><a href="#-2009"><span class="linenos">2009</span></a>        <span class="n">xyz_rotated</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_3d_rotation</span><span class="p">(</span>
</span><span id="Faults.rotate_3d_ellipsoid-2010"><a href="#-2010"><span class="linenos">2010</span></a>            <span class="n">xyz</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">geologic_age</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">fraction</span>
</span><span id="Faults.rotate_3d_ellipsoid-2011"><a href="#-2011"><span class="linenos">2011</span></a>        <span class="p">)</span>
</span><span id="Faults.rotate_3d_ellipsoid-2012"><a href="#-2012"><span class="linenos">2012</span></a>
</span><span id="Faults.rotate_3d_ellipsoid-2013"><a href="#-2013"><span class="linenos">2013</span></a>        <span class="n">xx_rotated</span> <span class="o">=</span> <span class="n">xyz_rotated</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">geologic_age</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span><span id="Faults.rotate_3d_ellipsoid-2014"><a href="#-2014"><span class="linenos">2014</span></a>        <span class="n">yy_rotated</span> <span class="o">=</span> <span class="n">xyz_rotated</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">geologic_age</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span><span id="Faults.rotate_3d_ellipsoid-2015"><a href="#-2015"><span class="linenos">2015</span></a>        <span class="n">zz_rotated</span> <span class="o">=</span> <span class="n">xyz_rotated</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">geologic_age</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span><span id="Faults.rotate_3d_ellipsoid-2016"><a href="#-2016"><span class="linenos">2016</span></a>
</span><span id="Faults.rotate_3d_ellipsoid-2017"><a href="#-2017"><span class="linenos">2017</span></a>        <span class="n">ellipsoid</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">xx_rotated</span><span class="p">,</span> <span class="n">yy_rotated</span><span class="p">,</span> <span class="n">zz_rotated</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">z0</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span>
</span><span id="Faults.rotate_3d_ellipsoid-2018"><a href="#-2018"><span class="linenos">2018</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">geologic_age</span><span class="o">.</span><span class="n">shape</span>
</span><span id="Faults.rotate_3d_ellipsoid-2019"><a href="#-2019"><span class="linenos">2019</span></a>        <span class="p">)</span>
</span><span id="Faults.rotate_3d_ellipsoid-2020"><a href="#-2020"><span class="linenos">2020</span></a>
</span><span id="Faults.rotate_3d_ellipsoid-2021"><a href="#-2021"><span class="linenos">2021</span></a>        <span class="k">return</span> <span class="n">ellipsoid</span>
</span></pre></div>


            <div class="docstring"><h2 id="rotate-a-3d-ellipsoid">Rotate a 3D ellipsoid</h2>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>x0</strong> (_type_):
_description_</li>
<li><strong>y0</strong> (_type_):
_description_</li>
<li><strong>z0</strong> (_type_):
_description_</li>
<li><strong>a</strong> (_type_):
_description_</li>
<li><strong>b</strong> (_type_):
_description_</li>
<li><strong>c</strong> (_type_):
_description_</li>
<li><strong>fraction</strong> (_type_):
_description_</li>
</ul>
</div>


                            </div>
                            <div id="Faults.apply_3d_rotation" class="classattr">
                                        <input id="Faults.apply_3d_rotation-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">apply_3d_rotation</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">inarray</span>, </span><span class="param"><span class="n">array_shape</span>, </span><span class="param"><span class="n">x0</span>, </span><span class="param"><span class="n">y0</span>, </span><span class="param"><span class="n">fraction</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Faults.apply_3d_rotation-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Faults.apply_3d_rotation"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Faults.apply_3d_rotation-2023"><a href="#-2023"><span class="linenos">2023</span></a>    <span class="nd">@staticmethod</span>
</span><span id="Faults.apply_3d_rotation-2024"><a href="#-2024"><span class="linenos">2024</span></a>    <span class="k">def</span> <span class="nf">apply_3d_rotation</span><span class="p">(</span><span class="n">inarray</span><span class="p">,</span> <span class="n">array_shape</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">fraction</span><span class="p">):</span>
</span><span id="Faults.apply_3d_rotation-2025"><a href="#-2025"><span class="linenos">2025</span></a>        <span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">sqrt</span><span class="p">,</span> <span class="n">sin</span><span class="p">,</span> <span class="n">cos</span><span class="p">,</span> <span class="n">atan2</span>
</span><span id="Faults.apply_3d_rotation-2026"><a href="#-2026"><span class="linenos">2026</span></a>        <span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">cross</span><span class="p">,</span> <span class="n">eye</span>
</span><span id="Faults.apply_3d_rotation-2027"><a href="#-2027"><span class="linenos">2027</span></a>
</span><span id="Faults.apply_3d_rotation-2028"><a href="#-2028"><span class="linenos">2028</span></a>        <span class="c1"># expm3 deprecated, changed to &#39;more robust&#39; expm (TM)</span>
</span><span id="Faults.apply_3d_rotation-2029"><a href="#-2029"><span class="linenos">2029</span></a>        <span class="kn">from</span> <span class="nn">scipy.linalg</span> <span class="kn">import</span> <span class="n">expm</span><span class="p">,</span> <span class="n">norm</span>
</span><span id="Faults.apply_3d_rotation-2030"><a href="#-2030"><span class="linenos">2030</span></a>
</span><span id="Faults.apply_3d_rotation-2031"><a href="#-2031"><span class="linenos">2031</span></a>        <span class="k">def</span> <span class="nf">m</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="n">angle</span><span class="p">):</span>
</span><span id="Faults.apply_3d_rotation-2032"><a href="#-2032"><span class="linenos">2032</span></a>            <span class="k">return</span> <span class="n">expm</span><span class="p">(</span><span class="n">cross</span><span class="p">(</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">axis</span> <span class="o">/</span> <span class="n">norm</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span> <span class="o">*</span> <span class="n">angle</span><span class="p">))</span>
</span><span id="Faults.apply_3d_rotation-2033"><a href="#-2033"><span class="linenos">2033</span></a>
</span><span id="Faults.apply_3d_rotation-2034"><a href="#-2034"><span class="linenos">2034</span></a>        <span class="n">theta</span> <span class="o">=</span> <span class="n">atan2</span><span class="p">(</span>
</span><span id="Faults.apply_3d_rotation-2035"><a href="#-2035"><span class="linenos">2035</span></a>            <span class="n">fraction</span>
</span><span id="Faults.apply_3d_rotation-2036"><a href="#-2036"><span class="linenos">2036</span></a>            <span class="o">*</span> <span class="n">sqrt</span><span class="p">((</span><span class="n">x0</span> <span class="o">-</span> <span class="n">array_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">y0</span> <span class="o">-</span> <span class="n">array_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">),</span>
</span><span id="Faults.apply_3d_rotation-2037"><a href="#-2037"><span class="linenos">2037</span></a>            <span class="n">array_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
</span><span id="Faults.apply_3d_rotation-2038"><a href="#-2038"><span class="linenos">2038</span></a>        <span class="p">)</span>
</span><span id="Faults.apply_3d_rotation-2039"><a href="#-2039"><span class="linenos">2039</span></a>        <span class="n">dip_angle</span> <span class="o">=</span> <span class="n">atan2</span><span class="p">(</span><span class="n">y0</span> <span class="o">-</span> <span class="n">array_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">x0</span> <span class="o">-</span> <span class="n">array_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="Faults.apply_3d_rotation-2040"><a href="#-2040"><span class="linenos">2040</span></a>
</span><span id="Faults.apply_3d_rotation-2041"><a href="#-2041"><span class="linenos">2041</span></a>        <span class="n">strike_unitvector</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
</span><span id="Faults.apply_3d_rotation-2042"><a href="#-2042"><span class="linenos">2042</span></a>            <span class="p">(</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">-</span> <span class="n">dip_angle</span><span class="p">),</span> <span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">-</span> <span class="n">dip_angle</span><span class="p">),</span> <span class="mf">0.0</span><span class="p">)</span>
</span><span id="Faults.apply_3d_rotation-2043"><a href="#-2043"><span class="linenos">2043</span></a>        <span class="p">)</span>
</span><span id="Faults.apply_3d_rotation-2044"><a href="#-2044"><span class="linenos">2044</span></a>        <span class="n">m0</span> <span class="o">=</span> <span class="n">m</span><span class="p">(</span><span class="n">strike_unitvector</span><span class="p">,</span> <span class="n">theta</span><span class="p">)</span>
</span><span id="Faults.apply_3d_rotation-2045"><a href="#-2045"><span class="linenos">2045</span></a>
</span><span id="Faults.apply_3d_rotation-2046"><a href="#-2046"><span class="linenos">2046</span></a>        <span class="n">outarray</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">m0</span><span class="p">,</span> <span class="n">inarray</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
</span><span id="Faults.apply_3d_rotation-2047"><a href="#-2047"><span class="linenos">2047</span></a>
</span><span id="Faults.apply_3d_rotation-2048"><a href="#-2048"><span class="linenos">2048</span></a>        <span class="k">return</span> <span class="n">outarray</span>
</span></pre></div>


    

                            </div>
                            <div id="Faults.get_fault_plane_sobel" class="classattr">
                                        <input id="Faults.get_fault_plane_sobel-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">get_fault_plane_sobel</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">test_ellipsoid</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Faults.get_fault_plane_sobel-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Faults.get_fault_plane_sobel"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Faults.get_fault_plane_sobel-2050"><a href="#-2050"><span class="linenos">2050</span></a>    <span class="nd">@staticmethod</span>
</span><span id="Faults.get_fault_plane_sobel-2051"><a href="#-2051"><span class="linenos">2051</span></a>    <span class="k">def</span> <span class="nf">get_fault_plane_sobel</span><span class="p">(</span><span class="n">test_ellipsoid</span><span class="p">):</span>
</span><span id="Faults.get_fault_plane_sobel-2052"><a href="#-2052"><span class="linenos">2052</span></a>        <span class="kn">from</span> <span class="nn">scipy.ndimage</span> <span class="kn">import</span> <span class="n">sobel</span>
</span><span id="Faults.get_fault_plane_sobel-2053"><a href="#-2053"><span class="linenos">2053</span></a>        <span class="kn">from</span> <span class="nn">scipy.ndimage</span> <span class="kn">import</span> <span class="n">maximum_filter</span>
</span><span id="Faults.get_fault_plane_sobel-2054"><a href="#-2054"><span class="linenos">2054</span></a>
</span><span id="Faults.get_fault_plane_sobel-2055"><a href="#-2055"><span class="linenos">2055</span></a>        <span class="n">test_ellipsoid</span><span class="p">[</span><span class="n">test_ellipsoid</span> <span class="o">&lt;=</span> <span class="mf">1.0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="Faults.get_fault_plane_sobel-2056"><a href="#-2056"><span class="linenos">2056</span></a>        <span class="n">inside</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">test_ellipsoid</span><span class="p">)</span>
</span><span id="Faults.get_fault_plane_sobel-2057"><a href="#-2057"><span class="linenos">2057</span></a>        <span class="n">inside</span><span class="p">[</span><span class="n">test_ellipsoid</span> <span class="o">&lt;=</span> <span class="mf">1.0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="Faults.get_fault_plane_sobel-2058"><a href="#-2058"><span class="linenos">2058</span></a>        <span class="c1"># method 2</span>
</span><span id="Faults.get_fault_plane_sobel-2059"><a href="#-2059"><span class="linenos">2059</span></a>        <span class="n">edge</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="Faults.get_fault_plane_sobel-2060"><a href="#-2060"><span class="linenos">2060</span></a>            <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">sobel</span><span class="p">(</span><span class="n">inside</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
</span><span id="Faults.get_fault_plane_sobel-2061"><a href="#-2061"><span class="linenos">2061</span></a>            <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">sobel</span><span class="p">(</span><span class="n">inside</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
</span><span id="Faults.get_fault_plane_sobel-2062"><a href="#-2062"><span class="linenos">2062</span></a>            <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">sobel</span><span class="p">(</span><span class="n">inside</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">))</span>
</span><span id="Faults.get_fault_plane_sobel-2063"><a href="#-2063"><span class="linenos">2063</span></a>        <span class="p">)</span>
</span><span id="Faults.get_fault_plane_sobel-2064"><a href="#-2064"><span class="linenos">2064</span></a>        <span class="n">edge_max</span> <span class="o">=</span> <span class="n">maximum_filter</span><span class="p">(</span><span class="n">edge</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
</span><span id="Faults.get_fault_plane_sobel-2065"><a href="#-2065"><span class="linenos">2065</span></a>        <span class="n">edge_max</span><span class="p">[</span><span class="n">edge_max</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1e6</span>
</span><span id="Faults.get_fault_plane_sobel-2066"><a href="#-2066"><span class="linenos">2066</span></a>        <span class="n">fault_segments</span> <span class="o">=</span> <span class="n">edge</span> <span class="o">/</span> <span class="n">edge_max</span>
</span><span id="Faults.get_fault_plane_sobel-2067"><a href="#-2067"><span class="linenos">2067</span></a>        <span class="n">fault_segments</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">fault_segments</span><span class="p">)]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="Faults.get_fault_plane_sobel-2068"><a href="#-2068"><span class="linenos">2068</span></a>        <span class="n">fault_segments</span><span class="p">[</span><span class="n">fault_segments</span> <span class="o">&lt;</span> <span class="mf">0.5</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="Faults.get_fault_plane_sobel-2069"><a href="#-2069"><span class="linenos">2069</span></a>        <span class="n">fault_segments</span><span class="p">[</span><span class="n">fault_segments</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="Faults.get_fault_plane_sobel-2070"><a href="#-2070"><span class="linenos">2070</span></a>        <span class="k">return</span> <span class="n">fault_segments</span>
</span></pre></div>


    

                            </div>
                            <div id="Faults.get_fault_centre" class="classattr">
                                        <input id="Faults.get_fault_centre-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_fault_centre</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">ellipsoid</span>, </span><span class="param"><span class="n">wb_time_map</span>, </span><span class="param"><span class="n">z_on_ellipse</span>, </span><span class="param"><span class="n">index</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Faults.get_fault_centre-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Faults.get_fault_centre"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Faults.get_fault_centre-2072"><a href="#-2072"><span class="linenos">2072</span></a>    <span class="k">def</span> <span class="nf">get_fault_centre</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ellipsoid</span><span class="p">,</span> <span class="n">wb_time_map</span><span class="p">,</span> <span class="n">z_on_ellipse</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
</span><span id="Faults.get_fault_centre-2073"><a href="#-2073"><span class="linenos">2073</span></a>        <span class="k">def</span> <span class="nf">find_nearest</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
</span><span id="Faults.get_fault_centre-2074"><a href="#-2074"><span class="linenos">2074</span></a>            <span class="n">idx</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">array</span> <span class="o">-</span> <span class="n">value</span><span class="p">))</span><span class="o">.</span><span class="n">argmin</span><span class="p">()</span>
</span><span id="Faults.get_fault_centre-2075"><a href="#-2075"><span class="linenos">2075</span></a>            <span class="k">return</span> <span class="n">array</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
</span><span id="Faults.get_fault_centre-2076"><a href="#-2076"><span class="linenos">2076</span></a>
</span><span id="Faults.get_fault_centre-2077"><a href="#-2077"><span class="linenos">2077</span></a>        <span class="k">def</span> <span class="nf">intersec</span><span class="p">(</span><span class="n">ell</span><span class="p">,</span> <span class="n">thresh</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">):</span>
</span><span id="Faults.get_fault_centre-2078"><a href="#-2078"><span class="linenos">2078</span></a>            <span class="n">abc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
</span><span id="Faults.get_fault_centre-2079"><a href="#-2079"><span class="linenos">2079</span></a>                <span class="p">(</span><span class="n">ell</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">thresh</span><span class="p">))</span>
</span><span id="Faults.get_fault_centre-2080"><a href="#-2080"><span class="linenos">2080</span></a>                <span class="o">&amp;</span> <span class="p">(</span><span class="n">ell</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">thresh</span><span class="p">))</span>
</span><span id="Faults.get_fault_centre-2081"><a href="#-2081"><span class="linenos">2081</span></a>            <span class="p">)</span>
</span><span id="Faults.get_fault_centre-2082"><a href="#-2082"><span class="linenos">2082</span></a>            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">abc</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Faults.get_fault_centre-2083"><a href="#-2083"><span class="linenos">2083</span></a>                <span class="n">direction</span> <span class="o">=</span> <span class="n">find_nearest</span><span class="p">(</span><span class="n">abc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="Faults.get_fault_centre-2084"><a href="#-2084"><span class="linenos">2084</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Faults.get_fault_centre-2085"><a href="#-2085"><span class="linenos">2085</span></a>                <span class="n">direction</span> <span class="o">=</span> <span class="mi">9999</span>
</span><span id="Faults.get_fault_centre-2086"><a href="#-2086"><span class="linenos">2086</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="Faults.get_fault_centre-2087"><a href="#-2087"><span class="linenos">2087</span></a>                <span class="s2">&quot;   ... computing intersection points between ellipsoid and cube, raise error if none found&quot;</span>
</span><span id="Faults.get_fault_centre-2088"><a href="#-2088"><span class="linenos">2088</span></a>            <span class="p">)</span>
</span><span id="Faults.get_fault_centre-2089"><a href="#-2089"><span class="linenos">2089</span></a>            <span class="n">xdir_min</span> <span class="o">=</span> <span class="n">intersec</span><span class="p">(</span><span class="n">ell</span><span class="p">,</span> <span class="n">thresh</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">z</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="Faults.get_fault_centre-2090"><a href="#-2090"><span class="linenos">2090</span></a>            <span class="n">xdir_max</span> <span class="o">=</span> <span class="n">intersec</span><span class="p">(</span><span class="n">ell</span><span class="p">,</span> <span class="n">thresh</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">z</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="Faults.get_fault_centre-2091"><a href="#-2091"><span class="linenos">2091</span></a>            <span class="n">ydir_min</span> <span class="o">=</span> <span class="n">intersec</span><span class="p">(</span><span class="n">ell</span><span class="p">,</span> <span class="n">thresh</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="Faults.get_fault_centre-2092"><a href="#-2092"><span class="linenos">2092</span></a>            <span class="n">ydir_max</span> <span class="o">=</span> <span class="n">intersec</span><span class="p">(</span><span class="n">ell</span><span class="p">,</span> <span class="n">thresh</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="Faults.get_fault_centre-2093"><a href="#-2093"><span class="linenos">2093</span></a>
</span><span id="Faults.get_fault_centre-2094"><a href="#-2094"><span class="linenos">2094</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    ... xdir_min coord = &quot;</span><span class="p">,</span> <span class="n">xdir_min</span><span class="p">,</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">z</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="Faults.get_fault_centre-2095"><a href="#-2095"><span class="linenos">2095</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    ... xdir_max coord = &quot;</span><span class="p">,</span> <span class="n">xdir_max</span><span class="p">,</span> <span class="n">y</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">z</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="Faults.get_fault_centre-2096"><a href="#-2096"><span class="linenos">2096</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    ... ydir_min coord = &quot;</span><span class="p">,</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ydir_min</span><span class="p">,</span> <span class="n">z</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="Faults.get_fault_centre-2097"><a href="#-2097"><span class="linenos">2097</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    ... ydir_max coord = &quot;</span><span class="p">,</span> <span class="n">y</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">ydir_max</span><span class="p">,</span> <span class="n">z</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="Faults.get_fault_centre-2098"><a href="#-2098"><span class="linenos">2098</span></a>            <span class="k">return</span> <span class="n">direction</span>
</span><span id="Faults.get_fault_centre-2099"><a href="#-2099"><span class="linenos">2099</span></a>
</span><span id="Faults.get_fault_centre-2100"><a href="#-2100"><span class="linenos">2100</span></a>        <span class="k">def</span> <span class="nf">get_middle_z</span><span class="p">(</span><span class="n">ellipse</span><span class="p">,</span> <span class="n">wb_map</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="Faults.get_fault_centre-2101"><a href="#-2101"><span class="linenos">2101</span></a>            <span class="c1"># Retrieve indices and cube of point on the ellipsoid and under the sea bed</span>
</span><span id="Faults.get_fault_centre-2102"><a href="#-2102"><span class="linenos">2102</span></a>
</span><span id="Faults.get_fault_centre-2103"><a href="#-2103"><span class="linenos">2103</span></a>            <span class="n">random_idx</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Faults.get_fault_centre-2104"><a href="#-2104"><span class="linenos">2104</span></a>            <span class="n">do_it</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Faults.get_fault_centre-2105"><a href="#-2105"><span class="linenos">2105</span></a>            <span class="n">origtime</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">ellipse</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
</span><span id="Faults.get_fault_centre-2106"><a href="#-2106"><span class="linenos">2106</span></a>            <span class="n">wb_time_cube</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span>
</span><span id="Faults.get_fault_centre-2107"><a href="#-2107"><span class="linenos">2107</span></a>                <span class="n">wb_map</span><span class="p">,</span> <span class="p">(</span><span class="n">wb_map</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">wb_map</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="Faults.get_fault_centre-2108"><a href="#-2108"><span class="linenos">2108</span></a>            <span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">origtime</span><span class="p">)</span>
</span><span id="Faults.get_fault_centre-2109"><a href="#-2109"><span class="linenos">2109</span></a>            <span class="n">abc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">z_on_ellipse</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">((</span><span class="n">wb_time_cube</span> <span class="o">-</span> <span class="n">origtime</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">))</span>
</span><span id="Faults.get_fault_centre-2110"><a href="#-2110"><span class="linenos">2110</span></a>            <span class="n">xyz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span><span class="n">abc</span><span class="p">)</span>
</span><span id="Faults.get_fault_centre-2111"><a href="#-2111"><span class="linenos">2111</span></a>            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="Faults.get_fault_centre-2112"><a href="#-2112"><span class="linenos">2112</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;     ... xyz.shape  = &quot;</span><span class="p">,</span> <span class="n">xyz</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span><span id="Faults.get_fault_centre-2113"><a href="#-2113"><span class="linenos">2113</span></a>            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">abc</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Faults.get_fault_centre-2114"><a href="#-2114"><span class="linenos">2114</span></a>                <span class="n">xyz_xyz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
</span><span id="Faults.get_fault_centre-2115"><a href="#-2115"><span class="linenos">2115</span></a>                <span class="n">threshold_center</span> <span class="o">=</span> <span class="mi">5</span>
</span><span id="Faults.get_fault_centre-2116"><a href="#-2116"><span class="linenos">2116</span></a>                <span class="k">while</span> <span class="n">xyz_xyz</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Faults.get_fault_centre-2117"><a href="#-2117"><span class="linenos">2117</span></a>                    <span class="k">if</span> <span class="n">threshold_center</span> <span class="o">&lt;</span> <span class="n">z_on_ellipse</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
</span><span id="Faults.get_fault_centre-2118"><a href="#-2118"><span class="linenos">2118</span></a>                        <span class="n">z_middle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
</span><span id="Faults.get_fault_centre-2119"><a href="#-2119"><span class="linenos">2119</span></a>                            <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">xyz</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="nb">int</span><span class="p">((</span><span class="n">xyz</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">+</span> <span class="n">xyz</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
</span><span id="Faults.get_fault_centre-2120"><a href="#-2120"><span class="linenos">2120</span></a>                            <span class="o">&lt;</span> <span class="n">threshold_center</span>
</span><span id="Faults.get_fault_centre-2121"><a href="#-2121"><span class="linenos">2121</span></a>                        <span class="p">)</span>
</span><span id="Faults.get_fault_centre-2122"><a href="#-2122"><span class="linenos">2122</span></a>                        <span class="n">xyz_z</span> <span class="o">=</span> <span class="n">xyz</span><span class="p">[:,</span> <span class="n">z_middle</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Faults.get_fault_centre-2123"><a href="#-2123"><span class="linenos">2123</span></a>                        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="Faults.get_fault_centre-2124"><a href="#-2124"><span class="linenos">2124</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;     ... xyz_z.shape  = &quot;</span><span class="p">,</span> <span class="n">xyz_z</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span><span id="Faults.get_fault_centre-2125"><a href="#-2125"><span class="linenos">2125</span></a>                        <span class="k">if</span> <span class="n">xyz_z</span><span class="o">.</span><span class="n">size</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Faults.get_fault_centre-2126"><a href="#-2126"><span class="linenos">2126</span></a>                            <span class="n">x_middle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
</span><span id="Faults.get_fault_centre-2127"><a href="#-2127"><span class="linenos">2127</span></a>                                <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span>
</span><span id="Faults.get_fault_centre-2128"><a href="#-2128"><span class="linenos">2128</span></a>                                    <span class="n">xyz_z</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Faults.get_fault_centre-2129"><a href="#-2129"><span class="linenos">2129</span></a>                                    <span class="o">-</span> <span class="nb">int</span><span class="p">((</span><span class="n">xyz_z</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">+</span> <span class="n">xyz_z</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="Faults.get_fault_centre-2130"><a href="#-2130"><span class="linenos">2130</span></a>                                <span class="p">)</span>
</span><span id="Faults.get_fault_centre-2131"><a href="#-2131"><span class="linenos">2131</span></a>                                <span class="o">&lt;</span> <span class="n">threshold_center</span>
</span><span id="Faults.get_fault_centre-2132"><a href="#-2132"><span class="linenos">2132</span></a>                            <span class="p">)</span>
</span><span id="Faults.get_fault_centre-2133"><a href="#-2133"><span class="linenos">2133</span></a>                            <span class="n">xyz_xz</span> <span class="o">=</span> <span class="n">xyz_z</span><span class="p">[:,</span> <span class="n">x_middle</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Faults.get_fault_centre-2134"><a href="#-2134"><span class="linenos">2134</span></a>                            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="Faults.get_fault_centre-2135"><a href="#-2135"><span class="linenos">2135</span></a>                                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;     ... xyz_xz.shape  = &quot;</span><span class="p">,</span> <span class="n">xyz_xz</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span><span id="Faults.get_fault_centre-2136"><a href="#-2136"><span class="linenos">2136</span></a>                            <span class="k">if</span> <span class="n">xyz_xz</span><span class="o">.</span><span class="n">size</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Faults.get_fault_centre-2137"><a href="#-2137"><span class="linenos">2137</span></a>                                <span class="n">y_middle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
</span><span id="Faults.get_fault_centre-2138"><a href="#-2138"><span class="linenos">2138</span></a>                                    <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span>
</span><span id="Faults.get_fault_centre-2139"><a href="#-2139"><span class="linenos">2139</span></a>                                        <span class="n">xyz_xz</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="Faults.get_fault_centre-2140"><a href="#-2140"><span class="linenos">2140</span></a>                                        <span class="o">-</span> <span class="nb">int</span><span class="p">((</span><span class="n">xyz_xz</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">+</span> <span class="n">xyz_xz</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="Faults.get_fault_centre-2141"><a href="#-2141"><span class="linenos">2141</span></a>                                    <span class="p">)</span>
</span><span id="Faults.get_fault_centre-2142"><a href="#-2142"><span class="linenos">2142</span></a>                                    <span class="o">&lt;</span> <span class="n">threshold_center</span>
</span><span id="Faults.get_fault_centre-2143"><a href="#-2143"><span class="linenos">2143</span></a>                                <span class="p">)</span>
</span><span id="Faults.get_fault_centre-2144"><a href="#-2144"><span class="linenos">2144</span></a>                                <span class="n">xyz_xyz</span> <span class="o">=</span> <span class="n">xyz_xz</span><span class="p">[:,</span> <span class="n">y_middle</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Faults.get_fault_centre-2145"><a href="#-2145"><span class="linenos">2145</span></a>                                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="Faults.get_fault_centre-2146"><a href="#-2146"><span class="linenos">2146</span></a>                                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;     ... xyz_xyz.shape  = &quot;</span><span class="p">,</span> <span class="n">xyz_xyz</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span><span id="Faults.get_fault_centre-2147"><a href="#-2147"><span class="linenos">2147</span></a>                        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="Faults.get_fault_centre-2148"><a href="#-2148"><span class="linenos">2148</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;     ... z for upper intersection  = &quot;</span><span class="p">,</span> <span class="n">xyz</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
</span><span id="Faults.get_fault_centre-2149"><a href="#-2149"><span class="linenos">2149</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;     ... z for lower intersection  = &quot;</span><span class="p">,</span> <span class="n">xyz</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
</span><span id="Faults.get_fault_centre-2150"><a href="#-2150"><span class="linenos">2150</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;     ... threshold_center used = &quot;</span><span class="p">,</span> <span class="n">threshold_center</span><span class="p">)</span>
</span><span id="Faults.get_fault_centre-2151"><a href="#-2151"><span class="linenos">2151</span></a>                        <span class="n">threshold_center</span> <span class="o">+=</span> <span class="mi">5</span>
</span><span id="Faults.get_fault_centre-2152"><a href="#-2152"><span class="linenos">2152</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="Faults.get_fault_centre-2153"><a href="#-2153"><span class="linenos">2153</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   ... Break the loop, could not find a suitable point&quot;</span><span class="p">)</span>
</span><span id="Faults.get_fault_centre-2154"><a href="#-2154"><span class="linenos">2154</span></a>                        <span class="n">random_idx</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Faults.get_fault_centre-2155"><a href="#-2155"><span class="linenos">2155</span></a>                        <span class="n">do_it</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Faults.get_fault_centre-2156"><a href="#-2156"><span class="linenos">2156</span></a>                        <span class="k">break</span>
</span><span id="Faults.get_fault_centre-2157"><a href="#-2157"><span class="linenos">2157</span></a>                <span class="k">if</span> <span class="n">do_it</span><span class="p">:</span>
</span><span id="Faults.get_fault_centre-2158"><a href="#-2158"><span class="linenos">2158</span></a>                    <span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">random</span>
</span><span id="Faults.get_fault_centre-2159"><a href="#-2159"><span class="linenos">2159</span></a>
</span><span id="Faults.get_fault_centre-2160"><a href="#-2160"><span class="linenos">2160</span></a>                    <span class="n">random_idx</span> <span class="o">=</span> <span class="n">xyz_xyz</span><span class="p">[:,</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">xyz_xyz</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>
</span><span id="Faults.get_fault_centre-2161"><a href="#-2161"><span class="linenos">2161</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="Faults.get_fault_centre-2162"><a href="#-2162"><span class="linenos">2162</span></a>                        <span class="s2">&quot;   ... Computing fault middle to hang max displacement function&quot;</span>
</span><span id="Faults.get_fault_centre-2163"><a href="#-2163"><span class="linenos">2163</span></a>                    <span class="p">)</span>
</span><span id="Faults.get_fault_centre-2164"><a href="#-2164"><span class="linenos">2164</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    ... x idx for max displacement  = &quot;</span><span class="p">,</span> <span class="n">random_idx</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="Faults.get_fault_centre-2165"><a href="#-2165"><span class="linenos">2165</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    ... y idx for max displacement  = &quot;</span><span class="p">,</span> <span class="n">random_idx</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="Faults.get_fault_centre-2166"><a href="#-2166"><span class="linenos">2166</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    ... z idx for max displacement  = &quot;</span><span class="p">,</span> <span class="n">random_idx</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</span><span id="Faults.get_fault_centre-2167"><a href="#-2167"><span class="linenos">2167</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="Faults.get_fault_centre-2168"><a href="#-2168"><span class="linenos">2168</span></a>                        <span class="s2">&quot;    ... ellipsoid value  = &quot;</span><span class="p">,</span>
</span><span id="Faults.get_fault_centre-2169"><a href="#-2169"><span class="linenos">2169</span></a>                        <span class="n">ellipse</span><span class="p">[</span><span class="n">random_idx</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">random_idx</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">random_idx</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span>
</span><span id="Faults.get_fault_centre-2170"><a href="#-2170"><span class="linenos">2170</span></a>                    <span class="p">)</span>
</span><span id="Faults.get_fault_centre-2171"><a href="#-2171"><span class="linenos">2171</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Faults.get_fault_centre-2172"><a href="#-2172"><span class="linenos">2172</span></a>                <span class="nb">print</span><span class="p">(</span>
</span><span id="Faults.get_fault_centre-2173"><a href="#-2173"><span class="linenos">2173</span></a>                    <span class="s2">&quot;    ... Empty intersection between fault and cube, assign d-max at cube lower corner&quot;</span>
</span><span id="Faults.get_fault_centre-2174"><a href="#-2174"><span class="linenos">2174</span></a>                <span class="p">)</span>
</span><span id="Faults.get_fault_centre-2175"><a href="#-2175"><span class="linenos">2175</span></a>
</span><span id="Faults.get_fault_centre-2176"><a href="#-2176"><span class="linenos">2176</span></a>            <span class="k">return</span> <span class="n">random_idx</span>
</span><span id="Faults.get_fault_centre-2177"><a href="#-2177"><span class="linenos">2177</span></a>
</span><span id="Faults.get_fault_centre-2178"><a href="#-2178"><span class="linenos">2178</span></a>        <span class="n">z_idx</span> <span class="o">=</span> <span class="n">get_middle_z</span><span class="p">(</span><span class="n">ellipsoid</span><span class="p">,</span> <span class="n">wb_time_map</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>
</span><span id="Faults.get_fault_centre-2179"><a href="#-2179"><span class="linenos">2179</span></a>        <span class="k">return</span> <span class="n">z_idx</span>
</span></pre></div>


    

                            </div>
                            <div id="Faults.xyz_dis" class="classattr">
                                        <input id="Faults.xyz_dis-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">xyz_dis</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">z_idx</span>, </span><span class="param"><span class="n">throw</span>, </span><span class="param"><span class="n">z_on_ellipse</span>, </span><span class="param"><span class="n">ellipsoid</span>, </span><span class="param"><span class="n">wb</span>, </span><span class="param"><span class="n">index</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Faults.xyz_dis-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Faults.xyz_dis"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Faults.xyz_dis-2181"><a href="#-2181"><span class="linenos">2181</span></a>    <span class="k">def</span> <span class="nf">xyz_dis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">z_idx</span><span class="p">,</span> <span class="n">throw</span><span class="p">,</span> <span class="n">z_on_ellipse</span><span class="p">,</span> <span class="n">ellipsoid</span><span class="p">,</span> <span class="n">wb</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
</span><span id="Faults.xyz_dis-2182"><a href="#-2182"><span class="linenos">2182</span></a>        <span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">interpolate</span><span class="p">,</span> <span class="n">signal</span>
</span><span id="Faults.xyz_dis-2183"><a href="#-2183"><span class="linenos">2183</span></a>        <span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">atan2</span><span class="p">,</span> <span class="n">degrees</span>
</span><span id="Faults.xyz_dis-2184"><a href="#-2184"><span class="linenos">2184</span></a>        <span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">multivariate_normal</span>
</span><span id="Faults.xyz_dis-2185"><a href="#-2185"><span class="linenos">2185</span></a>        <span class="kn">from</span> <span class="nn">scipy.ndimage.interpolation</span> <span class="kn">import</span> <span class="n">rotate</span>
</span><span id="Faults.xyz_dis-2186"><a href="#-2186"><span class="linenos">2186</span></a>
</span><span id="Faults.xyz_dis-2187"><a href="#-2187"><span class="linenos">2187</span></a>        <span class="n">cube_shape</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">geologic_age</span><span class="o">.</span><span class="n">shape</span>
</span><span id="Faults.xyz_dis-2188"><a href="#-2188"><span class="linenos">2188</span></a>
</span><span id="Faults.xyz_dis-2189"><a href="#-2189"><span class="linenos">2189</span></a>        <span class="k">def</span> <span class="nf">u_gaussian</span><span class="p">(</span><span class="n">d_max</span><span class="p">,</span> <span class="n">sig</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span> <span class="n">points</span><span class="p">):</span>
</span><span id="Faults.xyz_dis-2190"><a href="#-2190"><span class="linenos">2190</span></a>            <span class="kn">from</span> <span class="nn">scipy.signal.windows</span> <span class="kn">import</span> <span class="n">general_gaussian</span>
</span><span id="Faults.xyz_dis-2191"><a href="#-2191"><span class="linenos">2191</span></a>
</span><span id="Faults.xyz_dis-2192"><a href="#-2192"><span class="linenos">2192</span></a>            <span class="k">return</span> <span class="n">d_max</span> <span class="o">*</span> <span class="n">general_gaussian</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">(</span><span class="n">sig</span><span class="p">))</span>
</span><span id="Faults.xyz_dis-2193"><a href="#-2193"><span class="linenos">2193</span></a>
</span><span id="Faults.xyz_dis-2194"><a href="#-2194"><span class="linenos">2194</span></a>        <span class="c1"># Choose random values sigma, p and coef</span>
</span><span id="Faults.xyz_dis-2195"><a href="#-2195"><span class="linenos">2195</span></a>        <span class="n">sigma</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="mi">10</span> <span class="o">*</span> <span class="n">throw</span> <span class="o">-</span> <span class="mi">50</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
</span><span id="Faults.xyz_dis-2196"><a href="#-2196"><span class="linenos">2196</span></a>        <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</span><span id="Faults.xyz_dis-2197"><a href="#-2197"><span class="linenos">2197</span></a>        <span class="n">coef</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">1.3</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">)</span>
</span><span id="Faults.xyz_dis-2198"><a href="#-2198"><span class="linenos">2198</span></a>
</span><span id="Faults.xyz_dis-2199"><a href="#-2199"><span class="linenos">2199</span></a>        <span class="c1"># Fault plane</span>
</span><span id="Faults.xyz_dis-2200"><a href="#-2200"><span class="linenos">2200</span></a>        <span class="n">infill_factor</span> <span class="o">=</span> <span class="mf">0.5</span>
</span><span id="Faults.xyz_dis-2201"><a href="#-2201"><span class="linenos">2201</span></a>        <span class="n">origtime</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">cube_shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</span><span id="Faults.xyz_dis-2202"><a href="#-2202"><span class="linenos">2202</span></a>        <span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;int&quot;</span><span class="p">)</span>
</span><span id="Faults.xyz_dis-2203"><a href="#-2203"><span class="linenos">2203</span></a>        <span class="c1"># Define Gaussian max throw and roll it to chosen z</span>
</span><span id="Faults.xyz_dis-2204"><a href="#-2204"><span class="linenos">2204</span></a>        <span class="c1"># Gaussian should be defined on at least 5 sigma on each side</span>
</span><span id="Faults.xyz_dis-2205"><a href="#-2205"><span class="linenos">2205</span></a>        <span class="n">roll_int</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">10</span> <span class="o">*</span> <span class="n">sigma</span><span class="p">)</span>
</span><span id="Faults.xyz_dis-2206"><a href="#-2206"><span class="linenos">2206</span></a>        <span class="n">g</span> <span class="o">=</span> <span class="n">u_gaussian</span><span class="p">(</span><span class="n">throw</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">cube_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">roll_int</span><span class="p">)</span>
</span><span id="Faults.xyz_dis-2207"><a href="#-2207"><span class="linenos">2207</span></a>        <span class="c1"># Pad signal by 10*sigma before rolling</span>
</span><span id="Faults.xyz_dis-2208"><a href="#-2208"><span class="linenos">2208</span></a>        <span class="n">g_padded_rolled</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">(</span><span class="n">z_idx</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">g</span><span class="o">.</span><span class="n">argmax</span><span class="p">()</span> <span class="o">+</span> <span class="n">roll_int</span><span class="p">))</span>
</span><span id="Faults.xyz_dis-2209"><a href="#-2209"><span class="linenos">2209</span></a>        <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Faults.xyz_dis-2210"><a href="#-2210"><span class="linenos">2210</span></a>        <span class="n">wb_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">z_on_ellipse</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Faults.xyz_dis-2211"><a href="#-2211"><span class="linenos">2211</span></a>        <span class="n">wb_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">z_on_ellipse</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="Faults.xyz_dis-2212"><a href="#-2212"><span class="linenos">2212</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   ... Taper fault so it doesn&#39;t reach seabed&quot;</span><span class="p">)</span>
</span><span id="Faults.xyz_dis-2213"><a href="#-2213"><span class="linenos">2213</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    ... Sea floor max = </span><span class="si">{</span><span class="n">wb</span><span class="p">[</span><span class="n">wb_x</span><span class="p">,</span> <span class="n">wb_y</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Faults.xyz_dis-2214"><a href="#-2214"><span class="linenos">2214</span></a>        <span class="c1"># Shift Z throw so that id doesn&#39;t cross sea bed</span>
</span><span id="Faults.xyz_dis-2215"><a href="#-2215"><span class="linenos">2215</span></a>        <span class="k">while</span> <span class="n">g_padded_rolled</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">roll_int</span> <span class="o">+</span> <span class="n">wb</span><span class="p">[</span><span class="n">wb_x</span><span class="p">,</span> <span class="n">wb_y</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Faults.xyz_dis-2216"><a href="#-2216"><span class="linenos">2216</span></a>            <span class="n">g_padded_rolled</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">g_padded_rolled</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
</span><span id="Faults.xyz_dis-2217"><a href="#-2217"><span class="linenos">2217</span></a>            <span class="n">count</span> <span class="o">+=</span> <span class="mi">5</span>
</span><span id="Faults.xyz_dis-2218"><a href="#-2218"><span class="linenos">2218</span></a>            <span class="c1"># Break loop if can&#39;t find spot</span>
</span><span id="Faults.xyz_dis-2219"><a href="#-2219"><span class="linenos">2219</span></a>            <span class="k">if</span> <span class="n">count</span> <span class="o">&gt;</span> <span class="n">cube_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">wb</span><span class="p">[</span><span class="n">wb_x</span><span class="p">,</span> <span class="n">wb_y</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">():</span>
</span><span id="Faults.xyz_dis-2220"><a href="#-2220"><span class="linenos">2220</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    ... Too many rolled sample, seafloor will not have 0 throw&quot;</span><span class="p">)</span>
</span><span id="Faults.xyz_dis-2221"><a href="#-2221"><span class="linenos">2221</span></a>                <span class="k">break</span>
</span><span id="Faults.xyz_dis-2222"><a href="#-2222"><span class="linenos">2222</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   ... Vertical throw shifted by </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">count</span><span class="p">)</span><span class="si">}</span><span class="s2"> samples&quot;</span><span class="p">)</span>
</span><span id="Faults.xyz_dis-2223"><a href="#-2223"><span class="linenos">2223</span></a>        <span class="n">g_centered</span> <span class="o">=</span> <span class="n">g_padded_rolled</span><span class="p">[</span><span class="n">roll_int</span> <span class="p">:</span> <span class="n">cube_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">roll_int</span><span class="p">]</span>
</span><span id="Faults.xyz_dis-2224"><a href="#-2224"><span class="linenos">2224</span></a>
</span><span id="Faults.xyz_dis-2225"><a href="#-2225"><span class="linenos">2225</span></a>        <span class="n">ff</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">g_centered</span><span class="p">)</span>
</span><span id="Faults.xyz_dis-2226"><a href="#-2226"><span class="linenos">2226</span></a>        <span class="n">z_shift</span> <span class="o">=</span> <span class="n">ff</span>
</span><span id="Faults.xyz_dis-2227"><a href="#-2227"><span class="linenos">2227</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   ... Computing Gaussian distribution function&quot;</span><span class="p">)</span>
</span><span id="Faults.xyz_dis-2228"><a href="#-2228"><span class="linenos">2228</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    ... Max displacement  = </span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">throw</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Faults.xyz_dis-2229"><a href="#-2229"><span class="linenos">2229</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    ... Sigma  = </span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">sigma</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Faults.xyz_dis-2230"><a href="#-2230"><span class="linenos">2230</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    ... P  = </span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Faults.xyz_dis-2231"><a href="#-2231"><span class="linenos">2231</span></a>
</span><span id="Faults.xyz_dis-2232"><a href="#-2232"><span class="linenos">2232</span></a>        <span class="n">low_fault_throw</span> <span class="o">=</span> <span class="mi">5</span>
</span><span id="Faults.xyz_dis-2233"><a href="#-2233"><span class="linenos">2233</span></a>        <span class="n">high_fault_throw</span> <span class="o">=</span> <span class="mi">35</span>
</span><span id="Faults.xyz_dis-2234"><a href="#-2234"><span class="linenos">2234</span></a>        <span class="c1"># Parameters to set ratio of 1.4 seems to be optimal for a 1500x1500 grid</span>
</span><span id="Faults.xyz_dis-2235"><a href="#-2235"><span class="linenos">2235</span></a>        <span class="n">mu_x</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Faults.xyz_dis-2236"><a href="#-2236"><span class="linenos">2236</span></a>        <span class="n">mu_y</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Faults.xyz_dis-2237"><a href="#-2237"><span class="linenos">2237</span></a>
</span><span id="Faults.xyz_dis-2238"><a href="#-2238"><span class="linenos">2238</span></a>        <span class="c1"># Use throw to get length</span>
</span><span id="Faults.xyz_dis-2239"><a href="#-2239"><span class="linenos">2239</span></a>        <span class="n">throw_range</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">low_fault_throw</span><span class="p">,</span> <span class="n">high_fault_throw</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="Faults.xyz_dis-2240"><a href="#-2240"><span class="linenos">2240</span></a>        <span class="c1"># Max throw vs length relationship</span>
</span><span id="Faults.xyz_dis-2241"><a href="#-2241"><span class="linenos">2241</span></a>        <span class="n">fault_length</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="mf">0.0013</span> <span class="o">*</span> <span class="n">throw_range</span><span class="p">,</span> <span class="mf">1.3258</span><span class="p">)</span>
</span><span id="Faults.xyz_dis-2242"><a href="#-2242"><span class="linenos">2242</span></a>        <span class="c1"># Max throw == 16000</span>
</span><span id="Faults.xyz_dis-2243"><a href="#-2243"><span class="linenos">2243</span></a>        <span class="n">scale_factor</span> <span class="o">=</span> <span class="mi">16000</span> <span class="o">/</span> <span class="n">fault_length</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="Faults.xyz_dis-2244"><a href="#-2244"><span class="linenos">2244</span></a>        <span class="c1"># Coef random selection moved to top of function</span>
</span><span id="Faults.xyz_dis-2245"><a href="#-2245"><span class="linenos">2245</span></a>        <span class="n">variance_x</span> <span class="o">=</span> <span class="n">scale_factor</span> <span class="o">*</span> <span class="n">fault_length</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">throw_range</span> <span class="o">==</span> <span class="nb">int</span><span class="p">(</span><span class="n">throw</span><span class="p">))]</span>
</span><span id="Faults.xyz_dis-2246"><a href="#-2246"><span class="linenos">2246</span></a>        <span class="n">variance_y</span> <span class="o">=</span> <span class="n">variance_x</span> <span class="o">*</span> <span class="n">coef</span>
</span><span id="Faults.xyz_dis-2247"><a href="#-2247"><span class="linenos">2247</span></a>        <span class="c1"># Do the same for the drag zone area</span>
</span><span id="Faults.xyz_dis-2248"><a href="#-2248"><span class="linenos">2248</span></a>        <span class="n">fault_length_drag</span> <span class="o">=</span> <span class="n">fault_length</span> <span class="o">/</span> <span class="mi">10000</span>
</span><span id="Faults.xyz_dis-2249"><a href="#-2249"><span class="linenos">2249</span></a>        <span class="n">variance_x_drag</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="Faults.xyz_dis-2250"><a href="#-2250"><span class="linenos">2250</span></a>            <span class="n">scale_factor</span> <span class="o">*</span> <span class="n">fault_length_drag</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">throw_range</span> <span class="o">==</span> <span class="nb">int</span><span class="p">(</span><span class="n">throw</span><span class="p">))]</span>
</span><span id="Faults.xyz_dis-2251"><a href="#-2251"><span class="linenos">2251</span></a>        <span class="p">)</span>
</span><span id="Faults.xyz_dis-2252"><a href="#-2252"><span class="linenos">2252</span></a>        <span class="n">variance_y_drag</span> <span class="o">=</span> <span class="n">variance_x_drag</span> <span class="o">*</span> <span class="n">coef</span>
</span><span id="Faults.xyz_dis-2253"><a href="#-2253"><span class="linenos">2253</span></a>        <span class="c1"># Rotation from z_idx to center</span>
</span><span id="Faults.xyz_dis-2254"><a href="#-2254"><span class="linenos">2254</span></a>        <span class="n">alpha</span> <span class="o">=</span> <span class="n">atan2</span><span class="p">(</span><span class="n">z_idx</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">cube_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">z_idx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">cube_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="Faults.xyz_dis-2255"><a href="#-2255"><span class="linenos">2255</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    ... Variance_x, Variance_y = </span><span class="si">{</span><span class="n">variance_x</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">variance_y</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Faults.xyz_dis-2256"><a href="#-2256"><span class="linenos">2256</span></a>        <span class="nb">print</span><span class="p">(</span>
</span><span id="Faults.xyz_dis-2257"><a href="#-2257"><span class="linenos">2257</span></a>            <span class="sa">f</span><span class="s2">&quot;    ... Angle between max displacement point tangent plane and cube = </span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">degrees</span><span class="p">(</span><span class="n">alpha</span><span class="p">))</span><span class="si">}</span><span class="s2"> Degrees&quot;</span>
</span><span id="Faults.xyz_dis-2258"><a href="#-2258"><span class="linenos">2258</span></a>        <span class="p">)</span>
</span><span id="Faults.xyz_dis-2259"><a href="#-2259"><span class="linenos">2259</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    ... Max displacement point at x,y,z = </span><span class="si">{</span><span class="n">z_idx</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Faults.xyz_dis-2260"><a href="#-2260"><span class="linenos">2260</span></a>
</span><span id="Faults.xyz_dis-2261"><a href="#-2261"><span class="linenos">2261</span></a>        <span class="c1"># Create grid and multivariate normal</span>
</span><span id="Faults.xyz_dis-2262"><a href="#-2262"><span class="linenos">2262</span></a>        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span>
</span><span id="Faults.xyz_dis-2263"><a href="#-2263"><span class="linenos">2263</span></a>            <span class="o">-</span><span class="nb">int</span><span class="p">(</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mf">1.5</span> <span class="o">*</span> <span class="n">cube_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
</span><span id="Faults.xyz_dis-2264"><a href="#-2264"><span class="linenos">2264</span></a>            <span class="nb">int</span><span class="p">(</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mf">1.5</span> <span class="o">*</span> <span class="n">cube_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
</span><span id="Faults.xyz_dis-2265"><a href="#-2265"><span class="linenos">2265</span></a>            <span class="mi">2</span> <span class="o">*</span> <span class="nb">int</span><span class="p">(</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mf">1.5</span> <span class="o">*</span> <span class="n">cube_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
</span><span id="Faults.xyz_dis-2266"><a href="#-2266"><span class="linenos">2266</span></a>        <span class="p">)</span>
</span><span id="Faults.xyz_dis-2267"><a href="#-2267"><span class="linenos">2267</span></a>        <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span>
</span><span id="Faults.xyz_dis-2268"><a href="#-2268"><span class="linenos">2268</span></a>            <span class="o">-</span><span class="nb">int</span><span class="p">(</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mf">1.5</span> <span class="o">*</span> <span class="n">cube_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
</span><span id="Faults.xyz_dis-2269"><a href="#-2269"><span class="linenos">2269</span></a>            <span class="nb">int</span><span class="p">(</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mf">1.5</span> <span class="o">*</span> <span class="n">cube_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
</span><span id="Faults.xyz_dis-2270"><a href="#-2270"><span class="linenos">2270</span></a>            <span class="mi">2</span> <span class="o">*</span> <span class="nb">int</span><span class="p">(</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mf">1.5</span> <span class="o">*</span> <span class="n">cube_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
</span><span id="Faults.xyz_dis-2271"><a href="#-2271"><span class="linenos">2271</span></a>        <span class="p">)</span>
</span><span id="Faults.xyz_dis-2272"><a href="#-2272"><span class="linenos">2272</span></a>        <span class="n">_x</span><span class="p">,</span> <span class="n">_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</span><span id="Faults.xyz_dis-2273"><a href="#-2273"><span class="linenos">2273</span></a>        <span class="n">pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">_x</span><span class="o">.</span><span class="n">shape</span> <span class="o">+</span> <span class="p">(</span><span class="mi">2</span><span class="p">,))</span>
</span><span id="Faults.xyz_dis-2274"><a href="#-2274"><span class="linenos">2274</span></a>        <span class="n">pos</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">_x</span>
</span><span id="Faults.xyz_dis-2275"><a href="#-2275"><span class="linenos">2275</span></a>        <span class="n">pos</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">_y</span>
</span><span id="Faults.xyz_dis-2276"><a href="#-2276"><span class="linenos">2276</span></a>        <span class="n">rv</span> <span class="o">=</span> <span class="n">multivariate_normal</span><span class="p">([</span><span class="n">mu_x</span><span class="p">,</span> <span class="n">mu_y</span><span class="p">],</span> <span class="p">[[</span><span class="n">variance_x</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">variance_y</span><span class="p">]])</span>
</span><span id="Faults.xyz_dis-2277"><a href="#-2277"><span class="linenos">2277</span></a>        <span class="n">rv_drag</span> <span class="o">=</span> <span class="n">multivariate_normal</span><span class="p">(</span>
</span><span id="Faults.xyz_dis-2278"><a href="#-2278"><span class="linenos">2278</span></a>            <span class="p">[</span><span class="n">mu_x</span><span class="p">,</span> <span class="n">mu_y</span><span class="p">],</span> <span class="p">[[</span><span class="n">variance_x_drag</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">variance_y_drag</span><span class="p">]]</span>
</span><span id="Faults.xyz_dis-2279"><a href="#-2279"><span class="linenos">2279</span></a>        <span class="p">)</span>
</span><span id="Faults.xyz_dis-2280"><a href="#-2280"><span class="linenos">2280</span></a>        <span class="c1"># Scale up by mu order of magnitude and swap axes</span>
</span><span id="Faults.xyz_dis-2281"><a href="#-2281"><span class="linenos">2281</span></a>        <span class="n">xy_dis</span> <span class="o">=</span> <span class="mi">10000</span> <span class="o">*</span> <span class="p">(</span><span class="n">rv</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">pos</span><span class="p">))</span>
</span><span id="Faults.xyz_dis-2282"><a href="#-2282"><span class="linenos">2282</span></a>        <span class="n">xy_dis_drag</span> <span class="o">=</span> <span class="mi">10000</span> <span class="o">*</span> <span class="p">(</span><span class="n">rv_drag</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">pos</span><span class="p">))</span>
</span><span id="Faults.xyz_dis-2283"><a href="#-2283"><span class="linenos">2283</span></a>
</span><span id="Faults.xyz_dis-2284"><a href="#-2284"><span class="linenos">2284</span></a>        <span class="c1"># Normalize</span>
</span><span id="Faults.xyz_dis-2285"><a href="#-2285"><span class="linenos">2285</span></a>        <span class="n">xy_dis</span> <span class="o">=</span> <span class="n">xy_dis</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="n">xy_dis</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span>
</span><span id="Faults.xyz_dis-2286"><a href="#-2286"><span class="linenos">2286</span></a>        <span class="n">xy_dis_drag</span> <span class="o">=</span> <span class="p">(</span><span class="n">xy_dis_drag</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="n">xy_dis_drag</span><span class="o">.</span><span class="n">flatten</span><span class="p">()))</span> <span class="o">*</span> <span class="mf">0.99</span>
</span><span id="Faults.xyz_dis-2287"><a href="#-2287"><span class="linenos">2287</span></a>
</span><span id="Faults.xyz_dis-2288"><a href="#-2288"><span class="linenos">2288</span></a>        <span class="c1"># Rotate plane by alpha</span>
</span><span id="Faults.xyz_dis-2289"><a href="#-2289"><span class="linenos">2289</span></a>        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">cube_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cube_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="Faults.xyz_dis-2290"><a href="#-2290"><span class="linenos">2290</span></a>        <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">cube_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">cube_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="Faults.xyz_dis-2291"><a href="#-2291"><span class="linenos">2291</span></a>        <span class="n">_x</span><span class="p">,</span> <span class="n">_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</span><span id="Faults.xyz_dis-2292"><a href="#-2292"><span class="linenos">2292</span></a>        <span class="n">xy_dis_rotated</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">xy_dis</span><span class="p">)</span>
</span><span id="Faults.xyz_dis-2293"><a href="#-2293"><span class="linenos">2293</span></a>        <span class="n">xy_dis_drag_rotated</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">xy_dis</span><span class="p">)</span>
</span><span id="Faults.xyz_dis-2294"><a href="#-2294"><span class="linenos">2294</span></a>        <span class="n">rotate</span><span class="p">(</span>
</span><span id="Faults.xyz_dis-2295"><a href="#-2295"><span class="linenos">2295</span></a>            <span class="n">xy_dis_drag</span><span class="p">,</span>
</span><span id="Faults.xyz_dis-2296"><a href="#-2296"><span class="linenos">2296</span></a>            <span class="n">degrees</span><span class="p">(</span><span class="n">alpha</span><span class="p">),</span>
</span><span id="Faults.xyz_dis-2297"><a href="#-2297"><span class="linenos">2297</span></a>            <span class="n">reshape</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="Faults.xyz_dis-2298"><a href="#-2298"><span class="linenos">2298</span></a>            <span class="n">output</span><span class="o">=</span><span class="n">xy_dis_drag_rotated</span><span class="p">,</span>
</span><span id="Faults.xyz_dis-2299"><a href="#-2299"><span class="linenos">2299</span></a>            <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;nearest&quot;</span><span class="p">,</span>
</span><span id="Faults.xyz_dis-2300"><a href="#-2300"><span class="linenos">2300</span></a>        <span class="p">)</span>
</span><span id="Faults.xyz_dis-2301"><a href="#-2301"><span class="linenos">2301</span></a>        <span class="n">rotate</span><span class="p">(</span>
</span><span id="Faults.xyz_dis-2302"><a href="#-2302"><span class="linenos">2302</span></a>            <span class="n">xy_dis</span><span class="p">,</span> <span class="n">degrees</span><span class="p">(</span><span class="n">alpha</span><span class="p">),</span> <span class="n">reshape</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="n">xy_dis_rotated</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;nearest&quot;</span>
</span><span id="Faults.xyz_dis-2303"><a href="#-2303"><span class="linenos">2303</span></a>        <span class="p">)</span>
</span><span id="Faults.xyz_dis-2304"><a href="#-2304"><span class="linenos">2304</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   ...&quot;</span><span class="p">,</span> <span class="n">xy_dis_rotated</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">xy_dis</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span><span id="Faults.xyz_dis-2305"><a href="#-2305"><span class="linenos">2305</span></a>        <span class="n">xy_dis</span> <span class="o">=</span> <span class="n">xy_dis</span><span class="p">[</span>
</span><span id="Faults.xyz_dis-2306"><a href="#-2306"><span class="linenos">2306</span></a>            <span class="nb">int</span><span class="p">(</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="mi">2</span> <span class="p">:</span> <span class="n">cube_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span>
</span><span id="Faults.xyz_dis-2307"><a href="#-2307"><span class="linenos">2307</span></a>            <span class="nb">int</span><span class="p">(</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="mi">2</span> <span class="p">:</span> <span class="n">cube_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span>
</span><span id="Faults.xyz_dis-2308"><a href="#-2308"><span class="linenos">2308</span></a>        <span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Faults.xyz_dis-2309"><a href="#-2309"><span class="linenos">2309</span></a>        <span class="n">xy_dis_drag</span> <span class="o">=</span> <span class="n">xy_dis_drag</span><span class="p">[</span>
</span><span id="Faults.xyz_dis-2310"><a href="#-2310"><span class="linenos">2310</span></a>            <span class="nb">int</span><span class="p">(</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="mi">2</span> <span class="p">:</span> <span class="n">cube_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span>
</span><span id="Faults.xyz_dis-2311"><a href="#-2311"><span class="linenos">2311</span></a>            <span class="nb">int</span><span class="p">(</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="mi">2</span> <span class="p">:</span> <span class="n">cube_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span>
</span><span id="Faults.xyz_dis-2312"><a href="#-2312"><span class="linenos">2312</span></a>        <span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Faults.xyz_dis-2313"><a href="#-2313"><span class="linenos">2313</span></a>
</span><span id="Faults.xyz_dis-2314"><a href="#-2314"><span class="linenos">2314</span></a>        <span class="c1"># taper edges of xy_dis_drag in 2d to avoid edge artifacts in fft</span>
</span><span id="Faults.xyz_dis-2315"><a href="#-2315"><span class="linenos">2315</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    ... xy_dis_drag.shape = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">xy_dis_drag</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
</span><span id="Faults.xyz_dis-2316"><a href="#-2316"><span class="linenos">2316</span></a>        <span class="nb">print</span><span class="p">(</span>
</span><span id="Faults.xyz_dis-2317"><a href="#-2317"><span class="linenos">2317</span></a>            <span class="s2">&quot;    ... xy_dis_drag[xy_dis_drag&gt;0.].size = &quot;</span>
</span><span id="Faults.xyz_dis-2318"><a href="#-2318"><span class="linenos">2318</span></a>            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">xy_dis_drag</span><span class="p">[</span><span class="n">xy_dis_drag</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
</span><span id="Faults.xyz_dis-2319"><a href="#-2319"><span class="linenos">2319</span></a>        <span class="p">)</span>
</span><span id="Faults.xyz_dis-2320"><a href="#-2320"><span class="linenos">2320</span></a>        <span class="nb">print</span><span class="p">(</span>
</span><span id="Faults.xyz_dis-2321"><a href="#-2321"><span class="linenos">2321</span></a>            <span class="s2">&quot;    ... xy_dis_drag.shape min/mean/max= &quot;</span>
</span><span id="Faults.xyz_dis-2322"><a href="#-2322"><span class="linenos">2322</span></a>            <span class="o">+</span> <span class="nb">str</span><span class="p">((</span><span class="n">xy_dis_drag</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">xy_dis_drag</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">xy_dis_drag</span><span class="o">.</span><span class="n">max</span><span class="p">()))</span>
</span><span id="Faults.xyz_dis-2323"><a href="#-2323"><span class="linenos">2323</span></a>        <span class="p">)</span>
</span><span id="Faults.xyz_dis-2324"><a href="#-2324"><span class="linenos">2324</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="Faults.xyz_dis-2325"><a href="#-2325"><span class="linenos">2325</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">plot_counter</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="Faults.xyz_dis-2326"><a href="#-2326"><span class="linenos">2326</span></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="Faults.xyz_dis-2327"><a href="#-2327"><span class="linenos">2327</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">plot_counter</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Faults.xyz_dis-2328"><a href="#-2328"><span class="linenos">2328</span></a>
</span><span id="Faults.xyz_dis-2329"><a href="#-2329"><span class="linenos">2329</span></a>        <span class="c1"># xy_dis_rotated = rotate(xy_dis, degrees(alpha), mode=&#39;constant&#39;)</span>
</span><span id="Faults.xyz_dis-2330"><a href="#-2330"><span class="linenos">2330</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   ...&quot;</span><span class="p">,</span> <span class="n">xy_dis_rotated</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">xy_dis</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span><span id="Faults.xyz_dis-2331"><a href="#-2331"><span class="linenos">2331</span></a>
</span><span id="Faults.xyz_dis-2332"><a href="#-2332"><span class="linenos">2332</span></a>        <span class="c1"># Normalize</span>
</span><span id="Faults.xyz_dis-2333"><a href="#-2333"><span class="linenos">2333</span></a>        <span class="c1"># xy_dis_rotated = rotate(xy_dis, degrees(alpha), mode=&#39;constant&#39;)</span>
</span><span id="Faults.xyz_dis-2334"><a href="#-2334"><span class="linenos">2334</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   ...&quot;</span><span class="p">,</span> <span class="n">xy_dis_rotated</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">xy_dis</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span><span id="Faults.xyz_dis-2335"><a href="#-2335"><span class="linenos">2335</span></a>        <span class="c1"># Normalize</span>
</span><span id="Faults.xyz_dis-2336"><a href="#-2336"><span class="linenos">2336</span></a>        <span class="n">new_matrix</span> <span class="o">=</span> <span class="n">xy_dis_rotated</span>
</span><span id="Faults.xyz_dis-2337"><a href="#-2337"><span class="linenos">2337</span></a>        <span class="n">xy_dis_norm</span> <span class="o">=</span> <span class="n">xy_dis</span>
</span><span id="Faults.xyz_dis-2338"><a href="#-2338"><span class="linenos">2338</span></a>        <span class="n">x_center</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">new_matrix</span> <span class="o">==</span> <span class="n">new_matrix</span><span class="o">.</span><span class="n">max</span><span class="p">())[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Faults.xyz_dis-2339"><a href="#-2339"><span class="linenos">2339</span></a>        <span class="n">y_center</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">new_matrix</span> <span class="o">==</span> <span class="n">new_matrix</span><span class="o">.</span><span class="n">max</span><span class="p">())[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Faults.xyz_dis-2340"><a href="#-2340"><span class="linenos">2340</span></a>
</span><span id="Faults.xyz_dis-2341"><a href="#-2341"><span class="linenos">2341</span></a>        <span class="c1"># Pad event and move it to maximum depth location</span>
</span><span id="Faults.xyz_dis-2342"><a href="#-2342"><span class="linenos">2342</span></a>        <span class="n">x_pad</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Faults.xyz_dis-2343"><a href="#-2343"><span class="linenos">2343</span></a>        <span class="n">y_pad</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Faults.xyz_dis-2344"><a href="#-2344"><span class="linenos">2344</span></a>        <span class="n">x_roll</span> <span class="o">=</span> <span class="n">z_idx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">x_center</span>
</span><span id="Faults.xyz_dis-2345"><a href="#-2345"><span class="linenos">2345</span></a>        <span class="n">y_roll</span> <span class="o">=</span> <span class="n">z_idx</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">y_center</span>
</span><span id="Faults.xyz_dis-2346"><a href="#-2346"><span class="linenos">2346</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    ... padding x,y and roll x,y = </span><span class="si">{</span><span class="n">x_pad</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">y_pad</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">x_roll</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">y_roll</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Faults.xyz_dis-2347"><a href="#-2347"><span class="linenos">2347</span></a>        <span class="nb">print</span><span class="p">(</span>
</span><span id="Faults.xyz_dis-2348"><a href="#-2348"><span class="linenos">2348</span></a>            <span class="sa">f</span><span class="s2">&quot;    ... Max displacement point before rotation and adding of padding x,y = </span><span class="si">{</span><span class="n">x_center</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">y_center</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Faults.xyz_dis-2349"><a href="#-2349"><span class="linenos">2349</span></a>        <span class="p">)</span>
</span><span id="Faults.xyz_dis-2350"><a href="#-2350"><span class="linenos">2350</span></a>        <span class="n">new_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span>
</span><span id="Faults.xyz_dis-2351"><a href="#-2351"><span class="linenos">2351</span></a>            <span class="n">new_matrix</span><span class="p">,</span> <span class="p">((</span><span class="nb">abs</span><span class="p">(</span><span class="n">x_pad</span><span class="p">),</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x_pad</span><span class="p">)),</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">y_pad</span><span class="p">),</span> <span class="nb">abs</span><span class="p">(</span><span class="n">y_pad</span><span class="p">))),</span> <span class="s2">&quot;edge&quot;</span>
</span><span id="Faults.xyz_dis-2352"><a href="#-2352"><span class="linenos">2352</span></a>        <span class="p">)</span>
</span><span id="Faults.xyz_dis-2353"><a href="#-2353"><span class="linenos">2353</span></a>        <span class="n">new_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">new_matrix</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">x_roll</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="Faults.xyz_dis-2354"><a href="#-2354"><span class="linenos">2354</span></a>        <span class="n">new_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">new_matrix</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">y_roll</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="Faults.xyz_dis-2355"><a href="#-2355"><span class="linenos">2355</span></a>        <span class="n">new_matrix</span> <span class="o">=</span> <span class="n">new_matrix</span><span class="p">[</span>
</span><span id="Faults.xyz_dis-2356"><a href="#-2356"><span class="linenos">2356</span></a>            <span class="nb">abs</span><span class="p">(</span><span class="n">x_pad</span><span class="p">)</span> <span class="p">:</span> <span class="n">cube_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x_pad</span><span class="p">),</span>
</span><span id="Faults.xyz_dis-2357"><a href="#-2357"><span class="linenos">2357</span></a>            <span class="nb">abs</span><span class="p">(</span><span class="n">y_pad</span><span class="p">)</span> <span class="p">:</span> <span class="n">cube_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="nb">abs</span><span class="p">(</span><span class="n">y_pad</span><span class="p">),</span>
</span><span id="Faults.xyz_dis-2358"><a href="#-2358"><span class="linenos">2358</span></a>        <span class="p">]</span>
</span><span id="Faults.xyz_dis-2359"><a href="#-2359"><span class="linenos">2359</span></a>        <span class="c1"># Check that fault center is at the right place</span>
</span><span id="Faults.xyz_dis-2360"><a href="#-2360"><span class="linenos">2360</span></a>        <span class="n">x_center</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">new_matrix</span> <span class="o">==</span> <span class="n">new_matrix</span><span class="o">.</span><span class="n">max</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Faults.xyz_dis-2361"><a href="#-2361"><span class="linenos">2361</span></a>        <span class="n">y_center</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">new_matrix</span> <span class="o">==</span> <span class="n">new_matrix</span><span class="o">.</span><span class="n">max</span><span class="p">())[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="Faults.xyz_dis-2362"><a href="#-2362"><span class="linenos">2362</span></a>        <span class="nb">print</span><span class="p">(</span>
</span><span id="Faults.xyz_dis-2363"><a href="#-2363"><span class="linenos">2363</span></a>            <span class="sa">f</span><span class="s2">&quot;    ... Max displacement point after rotation and removal of padding x,y = </span><span class="si">{</span><span class="n">x_center</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">y_center</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Faults.xyz_dis-2364"><a href="#-2364"><span class="linenos">2364</span></a>        <span class="p">)</span>
</span><span id="Faults.xyz_dis-2365"><a href="#-2365"><span class="linenos">2365</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    ... z_idx = </span><span class="si">{</span><span class="n">z_idx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">z_idx</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Faults.xyz_dis-2366"><a href="#-2366"><span class="linenos">2366</span></a>        <span class="nb">print</span><span class="p">(</span>
</span><span id="Faults.xyz_dis-2367"><a href="#-2367"><span class="linenos">2367</span></a>            <span class="sa">f</span><span class="s2">&quot;    ... Difference from origin z_idx = </span><span class="si">{</span><span class="n">x_center</span> <span class="o">-</span> <span class="n">z_idx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">y_center</span> <span class="o">-</span> <span class="n">z_idx</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Faults.xyz_dis-2368"><a href="#-2368"><span class="linenos">2368</span></a>        <span class="p">)</span>
</span><span id="Faults.xyz_dis-2369"><a href="#-2369"><span class="linenos">2369</span></a>
</span><span id="Faults.xyz_dis-2370"><a href="#-2370"><span class="linenos">2370</span></a>        <span class="c1"># Build cube of lateral variable displacement</span>
</span><span id="Faults.xyz_dis-2371"><a href="#-2371"><span class="linenos">2371</span></a>        <span class="n">xy_dis</span> <span class="o">=</span> <span class="n">new_matrix</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cube_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="Faults.xyz_dis-2372"><a href="#-2372"><span class="linenos">2372</span></a>        <span class="c1"># Get enlarged fault plane</span>
</span><span id="Faults.xyz_dis-2373"><a href="#-2373"><span class="linenos">2373</span></a>        <span class="n">bb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">ellipsoid</span><span class="p">)</span>
</span><span id="Faults.xyz_dis-2374"><a href="#-2374"><span class="linenos">2374</span></a>        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">bb</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
</span><span id="Faults.xyz_dis-2375"><a href="#-2375"><span class="linenos">2375</span></a>            <span class="n">bb</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">j</span>
</span><span id="Faults.xyz_dis-2376"><a href="#-2376"><span class="linenos">2376</span></a>        <span class="n">stretch_times_effects_drag</span> <span class="o">=</span> <span class="n">bb</span> <span class="o">-</span> <span class="n">xy_dis</span> <span class="o">*</span> <span class="n">z_shift</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
</span><span id="Faults.xyz_dis-2377"><a href="#-2377"><span class="linenos">2377</span></a>        <span class="n">fault_plane_classification</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
</span><span id="Faults.xyz_dis-2378"><a href="#-2378"><span class="linenos">2378</span></a>            <span class="p">(</span><span class="n">z_on_ellipse</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="Faults.xyz_dis-2379"><a href="#-2379"><span class="linenos">2379</span></a>            <span class="o">&amp;</span> <span class="p">((</span><span class="n">origtime</span> <span class="o">-</span> <span class="n">stretch_times_effects_drag</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">infill_factor</span><span class="p">),</span>
</span><span id="Faults.xyz_dis-2380"><a href="#-2380"><span class="linenos">2380</span></a>            <span class="mi">1</span><span class="p">,</span>
</span><span id="Faults.xyz_dis-2381"><a href="#-2381"><span class="linenos">2381</span></a>            <span class="mi">0</span><span class="p">,</span>
</span><span id="Faults.xyz_dis-2382"><a href="#-2382"><span class="linenos">2382</span></a>        <span class="p">)</span>
</span><span id="Faults.xyz_dis-2383"><a href="#-2383"><span class="linenos">2383</span></a>        <span class="n">hockey_stick</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Faults.xyz_dis-2384"><a href="#-2384"><span class="linenos">2384</span></a>        <span class="c1"># Define as 0&#39;s, to be updated if necessary</span>
</span><span id="Faults.xyz_dis-2385"><a href="#-2385"><span class="linenos">2385</span></a>        <span class="n">fault_plane_classification_drag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">z_on_ellipse</span><span class="p">)</span>
</span><span id="Faults.xyz_dis-2386"><a href="#-2386"><span class="linenos">2386</span></a>        <span class="k">if</span> <span class="n">throw</span> <span class="o">&gt;=</span> <span class="mf">0.85</span> <span class="o">*</span> <span class="n">high_fault_throw</span><span class="p">:</span>
</span><span id="Faults.xyz_dis-2387"><a href="#-2387"><span class="linenos">2387</span></a>            <span class="n">hockey_stick</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="Faults.xyz_dis-2388"><a href="#-2388"><span class="linenos">2388</span></a>            <span class="c1"># Check for non zero fault_plane_classification, to avoid division by 0</span>
</span><span id="Faults.xyz_dis-2389"><a href="#-2389"><span class="linenos">2389</span></a>            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">count_nonzero</span><span class="p">(</span><span class="n">fault_plane_classification</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Faults.xyz_dis-2390"><a href="#-2390"><span class="linenos">2390</span></a>                <span class="c1"># Generate Hockey sticks by convolving small xy displacement with fault segment</span>
</span><span id="Faults.xyz_dis-2391"><a href="#-2391"><span class="linenos">2391</span></a>                <span class="n">fault_plane_classification_drag</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">fftconvolve</span><span class="p">(</span>
</span><span id="Faults.xyz_dis-2392"><a href="#-2392"><span class="linenos">2392</span></a>                    <span class="n">fault_plane_classification</span><span class="p">,</span>
</span><span id="Faults.xyz_dis-2393"><a href="#-2393"><span class="linenos">2393</span></a>                    <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">xy_dis_drag</span><span class="p">,</span> <span class="p">(</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cube_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1</span><span class="p">)),</span>
</span><span id="Faults.xyz_dis-2394"><a href="#-2394"><span class="linenos">2394</span></a>                    <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;same&quot;</span><span class="p">,</span>
</span><span id="Faults.xyz_dis-2395"><a href="#-2395"><span class="linenos">2395</span></a>                <span class="p">)</span>
</span><span id="Faults.xyz_dis-2396"><a href="#-2396"><span class="linenos">2396</span></a>                <span class="n">fault_plane_classification_drag</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="Faults.xyz_dis-2397"><a href="#-2397"><span class="linenos">2397</span></a>                    <span class="n">fault_plane_classification_drag</span>
</span><span id="Faults.xyz_dis-2398"><a href="#-2398"><span class="linenos">2398</span></a>                    <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="n">fault_plane_classification_drag</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span>
</span><span id="Faults.xyz_dis-2399"><a href="#-2399"><span class="linenos">2399</span></a>                <span class="p">)</span>
</span><span id="Faults.xyz_dis-2400"><a href="#-2400"><span class="linenos">2400</span></a>
</span><span id="Faults.xyz_dis-2401"><a href="#-2401"><span class="linenos">2401</span></a>        <span class="n">xy_dis</span> <span class="o">=</span> <span class="n">xy_dis</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vols</span><span class="o">.</span><span class="n">geologic_age</span><span class="p">)</span>
</span><span id="Faults.xyz_dis-2402"><a href="#-2402"><span class="linenos">2402</span></a>        <span class="n">xy_dis_classification</span> <span class="o">=</span> <span class="n">xy_dis</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Faults.xyz_dis-2403"><a href="#-2403"><span class="linenos">2403</span></a>        <span class="n">interpolation</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Faults.xyz_dis-2404"><a href="#-2404"><span class="linenos">2404</span></a>
</span><span id="Faults.xyz_dis-2405"><a href="#-2405"><span class="linenos">2405</span></a>        <span class="n">xy_dis</span> <span class="o">=</span> <span class="n">xy_dis</span> <span class="o">-</span> <span class="n">fault_plane_classification_drag</span>
</span><span id="Faults.xyz_dis-2406"><a href="#-2406"><span class="linenos">2406</span></a>        <span class="n">xy_dis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">xy_dis</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">xy_dis</span><span class="p">)</span>
</span><span id="Faults.xyz_dis-2407"><a href="#-2407"><span class="linenos">2407</span></a>        <span class="n">stretch_times</span> <span class="o">=</span> <span class="n">xy_dis</span> <span class="o">*</span> <span class="n">z_shift</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
</span><span id="Faults.xyz_dis-2408"><a href="#-2408"><span class="linenos">2408</span></a>        <span class="n">stretch_times_classification</span> <span class="o">=</span> <span class="n">xy_dis_classification</span> <span class="o">*</span> <span class="n">z_shift</span><span class="p">(</span>
</span><span id="Faults.xyz_dis-2409"><a href="#-2409"><span class="linenos">2409</span></a>            <span class="nb">range</span><span class="p">(</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</span><span id="Faults.xyz_dis-2410"><a href="#-2410"><span class="linenos">2410</span></a>        <span class="p">)</span>
</span><span id="Faults.xyz_dis-2411"><a href="#-2411"><span class="linenos">2411</span></a>
</span><span id="Faults.xyz_dis-2412"><a href="#-2412"><span class="linenos">2412</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">qc_plots</span><span class="p">:</span>
</span><span id="Faults.xyz_dis-2413"><a href="#-2413"><span class="linenos">2413</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">fault_summary_plot</span><span class="p">(</span>
</span><span id="Faults.xyz_dis-2414"><a href="#-2414"><span class="linenos">2414</span></a>                <span class="n">ff</span><span class="p">,</span>
</span><span id="Faults.xyz_dis-2415"><a href="#-2415"><span class="linenos">2415</span></a>                <span class="n">z</span><span class="p">,</span>
</span><span id="Faults.xyz_dis-2416"><a href="#-2416"><span class="linenos">2416</span></a>                <span class="n">throw</span><span class="p">,</span>
</span><span id="Faults.xyz_dis-2417"><a href="#-2417"><span class="linenos">2417</span></a>                <span class="n">sigma</span><span class="p">,</span>
</span><span id="Faults.xyz_dis-2418"><a href="#-2418"><span class="linenos">2418</span></a>                <span class="n">_x</span><span class="p">,</span>
</span><span id="Faults.xyz_dis-2419"><a href="#-2419"><span class="linenos">2419</span></a>                <span class="n">_y</span><span class="p">,</span>
</span><span id="Faults.xyz_dis-2420"><a href="#-2420"><span class="linenos">2420</span></a>                <span class="n">xy_dis_norm</span><span class="p">,</span>
</span><span id="Faults.xyz_dis-2421"><a href="#-2421"><span class="linenos">2421</span></a>                <span class="n">ellipsoid</span><span class="p">,</span>
</span><span id="Faults.xyz_dis-2422"><a href="#-2422"><span class="linenos">2422</span></a>                <span class="n">z_idx</span><span class="p">,</span>
</span><span id="Faults.xyz_dis-2423"><a href="#-2423"><span class="linenos">2423</span></a>                <span class="n">xy_dis</span><span class="p">,</span>
</span><span id="Faults.xyz_dis-2424"><a href="#-2424"><span class="linenos">2424</span></a>                <span class="n">index</span><span class="p">,</span>
</span><span id="Faults.xyz_dis-2425"><a href="#-2425"><span class="linenos">2425</span></a>                <span class="n">alpha</span><span class="p">,</span>
</span><span id="Faults.xyz_dis-2426"><a href="#-2426"><span class="linenos">2426</span></a>            <span class="p">)</span>
</span><span id="Faults.xyz_dis-2427"><a href="#-2427"><span class="linenos">2427</span></a>
</span><span id="Faults.xyz_dis-2428"><a href="#-2428"><span class="linenos">2428</span></a>        <span class="k">return</span> <span class="n">stretch_times</span><span class="p">,</span> <span class="n">stretch_times_classification</span><span class="p">,</span> <span class="n">interpolation</span><span class="p">,</span> <span class="n">hockey_stick</span>
</span></pre></div>


    

                            </div>
                            <div id="Faults.fault_summary_plot" class="classattr">
                                        <input id="Faults.fault_summary_plot-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">fault_summary_plot</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">ff</span>,</span><span class="param">	<span class="n">z</span>,</span><span class="param">	<span class="n">throw</span>,</span><span class="param">	<span class="n">sigma</span>,</span><span class="param">	<span class="n">x</span>,</span><span class="param">	<span class="n">y</span>,</span><span class="param">	<span class="n">xy_dis_norm</span>,</span><span class="param">	<span class="n">ellipsoid</span>,</span><span class="param">	<span class="n">z_idx</span>,</span><span class="param">	<span class="n">xy_dis</span>,</span><span class="param">	<span class="n">index</span>,</span><span class="param">	<span class="n">alpha</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="Faults.fault_summary_plot-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Faults.fault_summary_plot"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Faults.fault_summary_plot-2430"><a href="#-2430"><span class="linenos">2430</span></a>    <span class="k">def</span> <span class="nf">fault_summary_plot</span><span class="p">(</span>
</span><span id="Faults.fault_summary_plot-2431"><a href="#-2431"><span class="linenos">2431</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Faults.fault_summary_plot-2432"><a href="#-2432"><span class="linenos">2432</span></a>        <span class="n">ff</span><span class="p">,</span>
</span><span id="Faults.fault_summary_plot-2433"><a href="#-2433"><span class="linenos">2433</span></a>        <span class="n">z</span><span class="p">,</span>
</span><span id="Faults.fault_summary_plot-2434"><a href="#-2434"><span class="linenos">2434</span></a>        <span class="n">throw</span><span class="p">,</span>
</span><span id="Faults.fault_summary_plot-2435"><a href="#-2435"><span class="linenos">2435</span></a>        <span class="n">sigma</span><span class="p">,</span>
</span><span id="Faults.fault_summary_plot-2436"><a href="#-2436"><span class="linenos">2436</span></a>        <span class="n">x</span><span class="p">,</span>
</span><span id="Faults.fault_summary_plot-2437"><a href="#-2437"><span class="linenos">2437</span></a>        <span class="n">y</span><span class="p">,</span>
</span><span id="Faults.fault_summary_plot-2438"><a href="#-2438"><span class="linenos">2438</span></a>        <span class="n">xy_dis_norm</span><span class="p">,</span>
</span><span id="Faults.fault_summary_plot-2439"><a href="#-2439"><span class="linenos">2439</span></a>        <span class="n">ellipsoid</span><span class="p">,</span>
</span><span id="Faults.fault_summary_plot-2440"><a href="#-2440"><span class="linenos">2440</span></a>        <span class="n">z_idx</span><span class="p">,</span>
</span><span id="Faults.fault_summary_plot-2441"><a href="#-2441"><span class="linenos">2441</span></a>        <span class="n">xy_dis</span><span class="p">,</span>
</span><span id="Faults.fault_summary_plot-2442"><a href="#-2442"><span class="linenos">2442</span></a>        <span class="n">index</span><span class="p">,</span>
</span><span id="Faults.fault_summary_plot-2443"><a href="#-2443"><span class="linenos">2443</span></a>        <span class="n">alpha</span><span class="p">,</span>
</span><span id="Faults.fault_summary_plot-2444"><a href="#-2444"><span class="linenos">2444</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Faults.fault_summary_plot-2445"><a href="#-2445"><span class="linenos">2445</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="Faults.fault_summary_plot-2446"><a href="#-2446"><span class="linenos">2446</span></a><span class="sd">        Fault Summary Plot</span>
</span><span id="Faults.fault_summary_plot-2447"><a href="#-2447"><span class="linenos">2447</span></a><span class="sd">        ------------------</span>
</span><span id="Faults.fault_summary_plot-2448"><a href="#-2448"><span class="linenos">2448</span></a>
</span><span id="Faults.fault_summary_plot-2449"><a href="#-2449"><span class="linenos">2449</span></a><span class="sd">        Generates a fault summary plot.</span>
</span><span id="Faults.fault_summary_plot-2450"><a href="#-2450"><span class="linenos">2450</span></a>
</span><span id="Faults.fault_summary_plot-2451"><a href="#-2451"><span class="linenos">2451</span></a><span class="sd">        Parameters</span>
</span><span id="Faults.fault_summary_plot-2452"><a href="#-2452"><span class="linenos">2452</span></a><span class="sd">        ----------</span>
</span><span id="Faults.fault_summary_plot-2453"><a href="#-2453"><span class="linenos">2453</span></a><span class="sd">        ff : _type_</span>
</span><span id="Faults.fault_summary_plot-2454"><a href="#-2454"><span class="linenos">2454</span></a><span class="sd">            _description_</span>
</span><span id="Faults.fault_summary_plot-2455"><a href="#-2455"><span class="linenos">2455</span></a><span class="sd">        z : _type_</span>
</span><span id="Faults.fault_summary_plot-2456"><a href="#-2456"><span class="linenos">2456</span></a><span class="sd">            _description_</span>
</span><span id="Faults.fault_summary_plot-2457"><a href="#-2457"><span class="linenos">2457</span></a><span class="sd">        throw : _type_</span>
</span><span id="Faults.fault_summary_plot-2458"><a href="#-2458"><span class="linenos">2458</span></a><span class="sd">            _description_</span>
</span><span id="Faults.fault_summary_plot-2459"><a href="#-2459"><span class="linenos">2459</span></a><span class="sd">        sigma : _type_</span>
</span><span id="Faults.fault_summary_plot-2460"><a href="#-2460"><span class="linenos">2460</span></a><span class="sd">            _description_</span>
</span><span id="Faults.fault_summary_plot-2461"><a href="#-2461"><span class="linenos">2461</span></a><span class="sd">        x : _type_</span>
</span><span id="Faults.fault_summary_plot-2462"><a href="#-2462"><span class="linenos">2462</span></a><span class="sd">            _description_</span>
</span><span id="Faults.fault_summary_plot-2463"><a href="#-2463"><span class="linenos">2463</span></a><span class="sd">        y : _type_</span>
</span><span id="Faults.fault_summary_plot-2464"><a href="#-2464"><span class="linenos">2464</span></a><span class="sd">            _description_</span>
</span><span id="Faults.fault_summary_plot-2465"><a href="#-2465"><span class="linenos">2465</span></a><span class="sd">        xy_dis_norm : _type_</span>
</span><span id="Faults.fault_summary_plot-2466"><a href="#-2466"><span class="linenos">2466</span></a><span class="sd">            _description_</span>
</span><span id="Faults.fault_summary_plot-2467"><a href="#-2467"><span class="linenos">2467</span></a><span class="sd">        ellipsoid : _type_</span>
</span><span id="Faults.fault_summary_plot-2468"><a href="#-2468"><span class="linenos">2468</span></a><span class="sd">            _description_</span>
</span><span id="Faults.fault_summary_plot-2469"><a href="#-2469"><span class="linenos">2469</span></a><span class="sd">        z_idx : _type_</span>
</span><span id="Faults.fault_summary_plot-2470"><a href="#-2470"><span class="linenos">2470</span></a><span class="sd">            _description_</span>
</span><span id="Faults.fault_summary_plot-2471"><a href="#-2471"><span class="linenos">2471</span></a><span class="sd">        xy_dis : _type_</span>
</span><span id="Faults.fault_summary_plot-2472"><a href="#-2472"><span class="linenos">2472</span></a><span class="sd">            _description_</span>
</span><span id="Faults.fault_summary_plot-2473"><a href="#-2473"><span class="linenos">2473</span></a><span class="sd">        index : _type_</span>
</span><span id="Faults.fault_summary_plot-2474"><a href="#-2474"><span class="linenos">2474</span></a><span class="sd">            _description_</span>
</span><span id="Faults.fault_summary_plot-2475"><a href="#-2475"><span class="linenos">2475</span></a><span class="sd">        alpha : _type_</span>
</span><span id="Faults.fault_summary_plot-2476"><a href="#-2476"><span class="linenos">2476</span></a><span class="sd">            _description_</span>
</span><span id="Faults.fault_summary_plot-2477"><a href="#-2477"><span class="linenos">2477</span></a><span class="sd">        </span>
</span><span id="Faults.fault_summary_plot-2478"><a href="#-2478"><span class="linenos">2478</span></a><span class="sd">        Returns</span>
</span><span id="Faults.fault_summary_plot-2479"><a href="#-2479"><span class="linenos">2479</span></a><span class="sd">        -------</span>
</span><span id="Faults.fault_summary_plot-2480"><a href="#-2480"><span class="linenos">2480</span></a><span class="sd">        None</span>
</span><span id="Faults.fault_summary_plot-2481"><a href="#-2481"><span class="linenos">2481</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Faults.fault_summary_plot-2482"><a href="#-2482"><span class="linenos">2482</span></a>        <span class="kn">import</span> <span class="nn">os</span>
</span><span id="Faults.fault_summary_plot-2483"><a href="#-2483"><span class="linenos">2483</span></a>        <span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">degrees</span>
</span><span id="Faults.fault_summary_plot-2484"><a href="#-2484"><span class="linenos">2484</span></a>        <span class="kn">from</span> <span class="nn">datagenerator.util</span> <span class="kn">import</span> <span class="n">import_matplotlib</span>
</span><span id="Faults.fault_summary_plot-2485"><a href="#-2485"><span class="linenos">2485</span></a>
</span><span id="Faults.fault_summary_plot-2486"><a href="#-2486"><span class="linenos">2486</span></a>        <span class="n">plt</span> <span class="o">=</span> <span class="n">import_matplotlib</span><span class="p">()</span>
</span><span id="Faults.fault_summary_plot-2487"><a href="#-2487"><span class="linenos">2487</span></a>        <span class="c1"># Import axes3d, required to create plot with projection=&#39;3d&#39; below. DO NOT REMOVE!</span>
</span><span id="Faults.fault_summary_plot-2488"><a href="#-2488"><span class="linenos">2488</span></a>        <span class="kn">from</span> <span class="nn">mpl_toolkits.mplot3d</span> <span class="kn">import</span> <span class="n">axes3d</span>
</span><span id="Faults.fault_summary_plot-2489"><a href="#-2489"><span class="linenos">2489</span></a>        <span class="kn">from</span> <span class="nn">mpl_toolkits.axes_grid1</span> <span class="kn">import</span> <span class="n">make_axes_locatable</span>
</span><span id="Faults.fault_summary_plot-2490"><a href="#-2490"><span class="linenos">2490</span></a>
</span><span id="Faults.fault_summary_plot-2491"><a href="#-2491"><span class="linenos">2491</span></a>        <span class="c1"># Make summary picture</span>
</span><span id="Faults.fault_summary_plot-2492"><a href="#-2492"><span class="linenos">2492</span></a>        <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span><span id="Faults.fault_summary_plot-2493"><a href="#-2493"><span class="linenos">2493</span></a>        <span class="n">ax0</span><span class="p">,</span> <span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">,</span> <span class="n">ax3</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
</span><span id="Faults.fault_summary_plot-2494"><a href="#-2494"><span class="linenos">2494</span></a>        <span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
</span><span id="Faults.fault_summary_plot-2495"><a href="#-2495"><span class="linenos">2495</span></a>        <span class="c1"># PLot Z displacement</span>
</span><span id="Faults.fault_summary_plot-2496"><a href="#-2496"><span class="linenos">2496</span></a>        <span class="n">ax0</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ff</span><span class="p">(</span><span class="n">z</span><span class="p">))</span>
</span><span id="Faults.fault_summary_plot-2497"><a href="#-2497"><span class="linenos">2497</span></a>        <span class="n">ax0</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Fault with throw </span><span class="si">%s</span><span class="s2"> and sigma </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">throw</span><span class="p">,</span> <span class="n">sigma</span><span class="p">))</span>
</span><span id="Faults.fault_summary_plot-2498"><a href="#-2498"><span class="linenos">2498</span></a>        <span class="n">ax0</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Z axis&quot;</span><span class="p">)</span>
</span><span id="Faults.fault_summary_plot-2499"><a href="#-2499"><span class="linenos">2499</span></a>        <span class="n">ax0</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Throw&quot;</span><span class="p">)</span>
</span><span id="Faults.fault_summary_plot-2500"><a href="#-2500"><span class="linenos">2500</span></a>        <span class="c1"># Plot 3D XY displacement</span>
</span><span id="Faults.fault_summary_plot-2501"><a href="#-2501"><span class="linenos">2501</span></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>
</span><span id="Faults.fault_summary_plot-2502"><a href="#-2502"><span class="linenos">2502</span></a>        <span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">222</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s2">&quot;3d&quot;</span><span class="p">)</span>
</span><span id="Faults.fault_summary_plot-2503"><a href="#-2503"><span class="linenos">2503</span></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">plot_surface</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">xy_dis_norm</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;Spectral&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="Faults.fault_summary_plot-2504"><a href="#-2504"><span class="linenos">2504</span></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;X axis&quot;</span><span class="p">)</span>
</span><span id="Faults.fault_summary_plot-2505"><a href="#-2505"><span class="linenos">2505</span></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Y axis&quot;</span><span class="p">)</span>
</span><span id="Faults.fault_summary_plot-2506"><a href="#-2506"><span class="linenos">2506</span></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">set_zlabel</span><span class="p">(</span><span class="s2">&quot;Throw fraction&quot;</span><span class="p">)</span>
</span><span id="Faults.fault_summary_plot-2507"><a href="#-2507"><span class="linenos">2507</span></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;3D XY displacement&quot;</span><span class="p">)</span>
</span><span id="Faults.fault_summary_plot-2508"><a href="#-2508"><span class="linenos">2508</span></a>        <span class="c1"># Ellipsoid location</span>
</span><span id="Faults.fault_summary_plot-2509"><a href="#-2509"><span class="linenos">2509</span></a>        <span class="n">weights</span> <span class="o">=</span> <span class="n">ellipsoid</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">z_idx</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>
</span><span id="Faults.fault_summary_plot-2510"><a href="#-2510"><span class="linenos">2510</span></a>        <span class="c1"># Plot un-rotated XY displacement</span>
</span><span id="Faults.fault_summary_plot-2511"><a href="#-2511"><span class="linenos">2511</span></a>        <span class="n">cax2</span> <span class="o">=</span> <span class="n">ax2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">rot90</span><span class="p">(</span><span class="n">xy_dis_norm</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
</span><span id="Faults.fault_summary_plot-2512"><a href="#-2512"><span class="linenos">2512</span></a>        <span class="c1"># Levels for imshow contour</span>
</span><span id="Faults.fault_summary_plot-2513"><a href="#-2513"><span class="linenos">2513</span></a>        <span class="n">levels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span>
</span><span id="Faults.fault_summary_plot-2514"><a href="#-2514"><span class="linenos">2514</span></a>        <span class="c1"># Plot contour</span>
</span><span id="Faults.fault_summary_plot-2515"><a href="#-2515"><span class="linenos">2515</span></a>        <span class="n">ax2</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">rot90</span><span class="p">(</span><span class="n">xy_dis_norm</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">levels</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="n">linestyles</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">)</span>
</span><span id="Faults.fault_summary_plot-2516"><a href="#-2516"><span class="linenos">2516</span></a>        <span class="n">divider</span> <span class="o">=</span> <span class="n">make_axes_locatable</span><span class="p">(</span><span class="n">ax2</span><span class="p">)</span>
</span><span id="Faults.fault_summary_plot-2517"><a href="#-2517"><span class="linenos">2517</span></a>        <span class="n">cax4</span> <span class="o">=</span> <span class="n">divider</span><span class="o">.</span><span class="n">append_axes</span><span class="p">(</span><span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s2">&quot;5%&quot;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
</span><span id="Faults.fault_summary_plot-2518"><a href="#-2518"><span class="linenos">2518</span></a>        <span class="n">cbar2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">cax2</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">cax4</span><span class="p">)</span>
</span><span id="Faults.fault_summary_plot-2519"><a href="#-2519"><span class="linenos">2519</span></a>        <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;X axis&quot;</span><span class="p">)</span>
</span><span id="Faults.fault_summary_plot-2520"><a href="#-2520"><span class="linenos">2520</span></a>        <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Y axis&quot;</span><span class="p">)</span>
</span><span id="Faults.fault_summary_plot-2521"><a href="#-2521"><span class="linenos">2521</span></a>        <span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;2D projection of XY displacement unrotated&quot;</span><span class="p">)</span>
</span><span id="Faults.fault_summary_plot-2522"><a href="#-2522"><span class="linenos">2522</span></a>        <span class="c1">############################################################</span>
</span><span id="Faults.fault_summary_plot-2523"><a href="#-2523"><span class="linenos">2523</span></a>        <span class="c1"># Plot rotated displacement and contour</span>
</span><span id="Faults.fault_summary_plot-2524"><a href="#-2524"><span class="linenos">2524</span></a>        <span class="n">cax3</span> <span class="o">=</span> <span class="n">ax3</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">rot90</span><span class="p">(</span><span class="n">xy_dis</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">z_idx</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span> <span class="mi">3</span><span class="p">))</span>
</span><span id="Faults.fault_summary_plot-2525"><a href="#-2525"><span class="linenos">2525</span></a>        <span class="n">ax3</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span>
</span><span id="Faults.fault_summary_plot-2526"><a href="#-2526"><span class="linenos">2526</span></a>            <span class="n">np</span><span class="o">.</span><span class="n">rot90</span><span class="p">(</span><span class="n">xy_dis</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">z_idx</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span> <span class="mi">3</span><span class="p">),</span> <span class="n">levels</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="n">linestyles</span><span class="o">=</span><span class="s2">&quot;-&quot;</span>
</span><span id="Faults.fault_summary_plot-2527"><a href="#-2527"><span class="linenos">2527</span></a>        <span class="p">)</span>
</span><span id="Faults.fault_summary_plot-2528"><a href="#-2528"><span class="linenos">2528</span></a>        <span class="c1"># Add ellipsoid shape</span>
</span><span id="Faults.fault_summary_plot-2529"><a href="#-2529"><span class="linenos">2529</span></a>        <span class="n">ax3</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">rot90</span><span class="p">(</span><span class="n">weights</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">levels</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">colors</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">linestyles</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">)</span>
</span><span id="Faults.fault_summary_plot-2530"><a href="#-2530"><span class="linenos">2530</span></a>        <span class="n">divider</span> <span class="o">=</span> <span class="n">make_axes_locatable</span><span class="p">(</span><span class="n">ax3</span><span class="p">)</span>
</span><span id="Faults.fault_summary_plot-2531"><a href="#-2531"><span class="linenos">2531</span></a>        <span class="n">cax5</span> <span class="o">=</span> <span class="n">divider</span><span class="o">.</span><span class="n">append_axes</span><span class="p">(</span><span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s2">&quot;5%&quot;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
</span><span id="Faults.fault_summary_plot-2532"><a href="#-2532"><span class="linenos">2532</span></a>        <span class="n">cbar3</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">cax3</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">cax5</span><span class="p">)</span>
</span><span id="Faults.fault_summary_plot-2533"><a href="#-2533"><span class="linenos">2533</span></a>        <span class="n">ax3</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;X axis&quot;</span><span class="p">)</span>
</span><span id="Faults.fault_summary_plot-2534"><a href="#-2534"><span class="linenos">2534</span></a>        <span class="n">ax3</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Y axis&quot;</span><span class="p">)</span>
</span><span id="Faults.fault_summary_plot-2535"><a href="#-2535"><span class="linenos">2535</span></a>        <span class="n">ax3</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span>
</span><span id="Faults.fault_summary_plot-2536"><a href="#-2536"><span class="linenos">2536</span></a>            <span class="s2">&quot;2D projection of XY displacement rotated by </span><span class="si">%s</span><span class="s2"> degrees&quot;</span>
</span><span id="Faults.fault_summary_plot-2537"><a href="#-2537"><span class="linenos">2537</span></a>            <span class="o">%</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">degrees</span><span class="p">(</span><span class="n">alpha</span><span class="p">)))</span>
</span><span id="Faults.fault_summary_plot-2538"><a href="#-2538"><span class="linenos">2538</span></a>        <span class="p">)</span>
</span><span id="Faults.fault_summary_plot-2539"><a href="#-2539"><span class="linenos">2539</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span>
</span><span id="Faults.fault_summary_plot-2540"><a href="#-2540"><span class="linenos">2540</span></a>            <span class="s2">&quot;XYZ displacement parameters for fault Nr </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">),</span>
</span><span id="Faults.fault_summary_plot-2541"><a href="#-2541"><span class="linenos">2541</span></a>            <span class="n">fontweight</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span><span class="p">,</span>
</span><span id="Faults.fault_summary_plot-2542"><a href="#-2542"><span class="linenos">2542</span></a>        <span class="p">)</span>
</span><span id="Faults.fault_summary_plot-2543"><a href="#-2543"><span class="linenos">2543</span></a>        <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</span><span id="Faults.fault_summary_plot-2544"><a href="#-2544"><span class="linenos">2544</span></a>        <span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">top</span><span class="o">=</span><span class="mf">0.94</span><span class="p">)</span>
</span><span id="Faults.fault_summary_plot-2545"><a href="#-2545"><span class="linenos">2545</span></a>        <span class="n">image_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="Faults.fault_summary_plot-2546"><a href="#-2546"><span class="linenos">2546</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">work_subfolder</span><span class="p">,</span> <span class="s2">&quot;QC_plot__Fault_</span><span class="si">%s</span><span class="s2">.png&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
</span><span id="Faults.fault_summary_plot-2547"><a href="#-2547"><span class="linenos">2547</span></a>        <span class="p">)</span>
</span><span id="Faults.fault_summary_plot-2548"><a href="#-2548"><span class="linenos">2548</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">image_path</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;png&quot;</span><span class="p">)</span>
</span><span id="Faults.fault_summary_plot-2549"><a href="#-2549"><span class="linenos">2549</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><h6 id="fault-summary-plot">Fault Summary Plot</h6>

<p>Generates a fault summary plot.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>ff</strong> (_type_):
_description_</li>
<li><strong>z</strong> (_type_):
_description_</li>
<li><strong>throw</strong> (_type_):
_description_</li>
<li><strong>sigma</strong> (_type_):
_description_</li>
<li><strong>x</strong> (_type_):
_description_</li>
<li><strong>y</strong> (_type_):
_description_</li>
<li><strong>xy_dis_norm</strong> (_type_):
_description_</li>
<li><strong>ellipsoid</strong> (_type_):
_description_</li>
<li><strong>z_idx</strong> (_type_):
_description_</li>
<li><strong>xy_dis</strong> (_type_):
_description_</li>
<li><strong>index</strong> (_type_):
_description_</li>
<li><strong>alpha</strong> (_type_):
_description_</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>None</strong></li>
</ul>
</div>


                            </div>
                            <div id="Faults.create_binary_segmentations_post_faulting" class="classattr">
                                        <input id="Faults.create_binary_segmentations_post_faulting-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">create_binary_segmentations_post_faulting</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">cube</span>, </span><span class="param"><span class="n">segmentation_threshold</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Faults.create_binary_segmentations_post_faulting-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Faults.create_binary_segmentations_post_faulting"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Faults.create_binary_segmentations_post_faulting-2551"><a href="#-2551"><span class="linenos">2551</span></a>    <span class="nd">@staticmethod</span>
</span><span id="Faults.create_binary_segmentations_post_faulting-2552"><a href="#-2552"><span class="linenos">2552</span></a>    <span class="k">def</span> <span class="nf">create_binary_segmentations_post_faulting</span><span class="p">(</span><span class="n">cube</span><span class="p">,</span> <span class="n">segmentation_threshold</span><span class="p">):</span>
</span><span id="Faults.create_binary_segmentations_post_faulting-2553"><a href="#-2553"><span class="linenos">2553</span></a>        <span class="n">cube</span><span class="p">[</span><span class="n">cube</span> <span class="o">&gt;=</span> <span class="n">segmentation_threshold</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="Faults.create_binary_segmentations_post_faulting-2554"><a href="#-2554"><span class="linenos">2554</span></a>        <span class="k">return</span> <span class="n">cube</span>
</span></pre></div>


    

                            </div>
                            <div id="Faults.reassign_channel_segment_encoding" class="classattr">
                                        <input id="Faults.reassign_channel_segment_encoding-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">reassign_channel_segment_encoding</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">faulted_age</span>,</span><span class="param">	<span class="n">floodplain_shale</span>,</span><span class="param">	<span class="n">channel_fill</span>,</span><span class="param">	<span class="n">shale_channel_drape</span>,</span><span class="param">	<span class="n">levee</span>,</span><span class="param">	<span class="n">crevasse</span>,</span><span class="param">	<span class="n">channel_flag_lut</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Faults.reassign_channel_segment_encoding-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Faults.reassign_channel_segment_encoding"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Faults.reassign_channel_segment_encoding-2556"><a href="#-2556"><span class="linenos">2556</span></a>    <span class="k">def</span> <span class="nf">reassign_channel_segment_encoding</span><span class="p">(</span>
</span><span id="Faults.reassign_channel_segment_encoding-2557"><a href="#-2557"><span class="linenos">2557</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Faults.reassign_channel_segment_encoding-2558"><a href="#-2558"><span class="linenos">2558</span></a>        <span class="n">faulted_age</span><span class="p">,</span>
</span><span id="Faults.reassign_channel_segment_encoding-2559"><a href="#-2559"><span class="linenos">2559</span></a>        <span class="n">floodplain_shale</span><span class="p">,</span>
</span><span id="Faults.reassign_channel_segment_encoding-2560"><a href="#-2560"><span class="linenos">2560</span></a>        <span class="n">channel_fill</span><span class="p">,</span>
</span><span id="Faults.reassign_channel_segment_encoding-2561"><a href="#-2561"><span class="linenos">2561</span></a>        <span class="n">shale_channel_drape</span><span class="p">,</span>
</span><span id="Faults.reassign_channel_segment_encoding-2562"><a href="#-2562"><span class="linenos">2562</span></a>        <span class="n">levee</span><span class="p">,</span>
</span><span id="Faults.reassign_channel_segment_encoding-2563"><a href="#-2563"><span class="linenos">2563</span></a>        <span class="n">crevasse</span><span class="p">,</span>
</span><span id="Faults.reassign_channel_segment_encoding-2564"><a href="#-2564"><span class="linenos">2564</span></a>        <span class="n">channel_flag_lut</span><span class="p">,</span>
</span><span id="Faults.reassign_channel_segment_encoding-2565"><a href="#-2565"><span class="linenos">2565</span></a>    <span class="p">):</span>
</span><span id="Faults.reassign_channel_segment_encoding-2566"><a href="#-2566"><span class="linenos">2566</span></a>        <span class="c1"># Generate list of horizons with channel episodes</span>
</span><span id="Faults.reassign_channel_segment_encoding-2567"><a href="#-2567"><span class="linenos">2567</span></a>        <span class="n">channel_segments</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">floodplain_shale</span><span class="p">)</span>
</span><span id="Faults.reassign_channel_segment_encoding-2568"><a href="#-2568"><span class="linenos">2568</span></a>        <span class="n">channel_horizons_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
</span><span id="Faults.reassign_channel_segment_encoding-2569"><a href="#-2569"><span class="linenos">2569</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faulted_depth_maps</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="mi">7</span><span class="p">):</span>
</span><span id="Faults.reassign_channel_segment_encoding-2570"><a href="#-2570"><span class="linenos">2570</span></a>            <span class="k">if</span> <span class="n">channel_flag_lut</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Faults.reassign_channel_segment_encoding-2571"><a href="#-2571"><span class="linenos">2571</span></a>                <span class="n">channel_horizons_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</span><span id="Faults.reassign_channel_segment_encoding-2572"><a href="#-2572"><span class="linenos">2572</span></a>        <span class="n">channel_horizons_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">999</span><span class="p">)</span>
</span><span id="Faults.reassign_channel_segment_encoding-2573"><a href="#-2573"><span class="linenos">2573</span></a>
</span><span id="Faults.reassign_channel_segment_encoding-2574"><a href="#-2574"><span class="linenos">2574</span></a>        <span class="c1"># Re-assign correct channel segments encoding</span>
</span><span id="Faults.reassign_channel_segment_encoding-2575"><a href="#-2575"><span class="linenos">2575</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">iLayer</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">channel_horizons_list</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
</span><span id="Faults.reassign_channel_segment_encoding-2576"><a href="#-2576"><span class="linenos">2576</span></a>            <span class="k">if</span> <span class="n">iLayer</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">iLayer</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">faulted_depth_maps</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
</span><span id="Faults.reassign_channel_segment_encoding-2577"><a href="#-2577"><span class="linenos">2577</span></a>                <span class="c1"># loop through channel facies</span>
</span><span id="Faults.reassign_channel_segment_encoding-2578"><a href="#-2578"><span class="linenos">2578</span></a>                <span class="c1">#    --- 0  is floodplain shale</span>
</span><span id="Faults.reassign_channel_segment_encoding-2579"><a href="#-2579"><span class="linenos">2579</span></a>                <span class="c1">#    --- 1  is channel fill (sand)</span>
</span><span id="Faults.reassign_channel_segment_encoding-2580"><a href="#-2580"><span class="linenos">2580</span></a>                <span class="c1">#    --- 2  is shale channel drape</span>
</span><span id="Faults.reassign_channel_segment_encoding-2581"><a href="#-2581"><span class="linenos">2581</span></a>                <span class="c1">#    --- 3  is levee (mid quality sand)</span>
</span><span id="Faults.reassign_channel_segment_encoding-2582"><a href="#-2582"><span class="linenos">2582</span></a>                <span class="c1">#    --- 4  is crevasse (low quality sand)</span>
</span><span id="Faults.reassign_channel_segment_encoding-2583"><a href="#-2583"><span class="linenos">2583</span></a>                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">4001</span><span class="p">,</span> <span class="mi">1000</span><span class="p">):</span>
</span><span id="Faults.reassign_channel_segment_encoding-2584"><a href="#-2584"><span class="linenos">2584</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="Faults.reassign_channel_segment_encoding-2585"><a href="#-2585"><span class="linenos">2585</span></a>                        <span class="s2">&quot; ... re-assign channel segments after faulting: i, iLayer, j = &quot;</span><span class="p">,</span>
</span><span id="Faults.reassign_channel_segment_encoding-2586"><a href="#-2586"><span class="linenos">2586</span></a>                        <span class="n">i</span><span class="p">,</span>
</span><span id="Faults.reassign_channel_segment_encoding-2587"><a href="#-2587"><span class="linenos">2587</span></a>                        <span class="n">iLayer</span><span class="p">,</span>
</span><span id="Faults.reassign_channel_segment_encoding-2588"><a href="#-2588"><span class="linenos">2588</span></a>                        <span class="n">j</span><span class="p">,</span>
</span><span id="Faults.reassign_channel_segment_encoding-2589"><a href="#-2589"><span class="linenos">2589</span></a>                    <span class="p">)</span>
</span><span id="Faults.reassign_channel_segment_encoding-2590"><a href="#-2590"><span class="linenos">2590</span></a>                    <span class="n">channel_facies_code</span> <span class="o">=</span> <span class="n">j</span> <span class="o">+</span> <span class="n">iLayer</span>
</span><span id="Faults.reassign_channel_segment_encoding-2591"><a href="#-2591"><span class="linenos">2591</span></a>                    <span class="n">layers_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
</span><span id="Faults.reassign_channel_segment_encoding-2592"><a href="#-2592"><span class="linenos">2592</span></a>                        <span class="p">(</span>
</span><span id="Faults.reassign_channel_segment_encoding-2593"><a href="#-2593"><span class="linenos">2593</span></a>                            <span class="p">(</span><span class="n">faulted_age</span> <span class="o">&gt;=</span> <span class="n">iLayer</span><span class="p">)</span>
</span><span id="Faults.reassign_channel_segment_encoding-2594"><a href="#-2594"><span class="linenos">2594</span></a>                            <span class="o">&amp;</span> <span class="p">(</span><span class="n">faulted_age</span> <span class="o">&lt;</span> <span class="n">channel_horizons_list</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
</span><span id="Faults.reassign_channel_segment_encoding-2595"><a href="#-2595"><span class="linenos">2595</span></a>                        <span class="p">),</span>
</span><span id="Faults.reassign_channel_segment_encoding-2596"><a href="#-2596"><span class="linenos">2596</span></a>                        <span class="mi">1</span><span class="p">,</span>
</span><span id="Faults.reassign_channel_segment_encoding-2597"><a href="#-2597"><span class="linenos">2597</span></a>                        <span class="mi">0</span><span class="p">,</span>
</span><span id="Faults.reassign_channel_segment_encoding-2598"><a href="#-2598"><span class="linenos">2598</span></a>                    <span class="p">)</span>
</span><span id="Faults.reassign_channel_segment_encoding-2599"><a href="#-2599"><span class="linenos">2599</span></a>                    <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="mi">1000</span><span class="p">:</span>
</span><span id="Faults.reassign_channel_segment_encoding-2600"><a href="#-2600"><span class="linenos">2600</span></a>                        <span class="n">channel_segments</span><span class="p">[</span>
</span><span id="Faults.reassign_channel_segment_encoding-2601"><a href="#-2601"><span class="linenos">2601</span></a>                            <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">layers_mask</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="n">channel_fill</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="Faults.reassign_channel_segment_encoding-2602"><a href="#-2602"><span class="linenos">2602</span></a>                        <span class="p">]</span> <span class="o">=</span> <span class="n">channel_facies_code</span>
</span><span id="Faults.reassign_channel_segment_encoding-2603"><a href="#-2603"><span class="linenos">2603</span></a>                        <span class="n">faulted_age</span><span class="p">[</span>
</span><span id="Faults.reassign_channel_segment_encoding-2604"><a href="#-2604"><span class="linenos">2604</span></a>                            <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">layers_mask</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="n">channel_fill</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="Faults.reassign_channel_segment_encoding-2605"><a href="#-2605"><span class="linenos">2605</span></a>                        <span class="p">]</span> <span class="o">=</span> <span class="n">channel_facies_code</span>
</span><span id="Faults.reassign_channel_segment_encoding-2606"><a href="#-2606"><span class="linenos">2606</span></a>                    <span class="k">elif</span> <span class="n">j</span> <span class="o">==</span> <span class="mi">2000</span><span class="p">:</span>
</span><span id="Faults.reassign_channel_segment_encoding-2607"><a href="#-2607"><span class="linenos">2607</span></a>                        <span class="n">channel_segments</span><span class="p">[</span>
</span><span id="Faults.reassign_channel_segment_encoding-2608"><a href="#-2608"><span class="linenos">2608</span></a>                            <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">layers_mask</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="n">shale_channel_drape</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="Faults.reassign_channel_segment_encoding-2609"><a href="#-2609"><span class="linenos">2609</span></a>                        <span class="p">]</span> <span class="o">=</span> <span class="n">channel_facies_code</span>
</span><span id="Faults.reassign_channel_segment_encoding-2610"><a href="#-2610"><span class="linenos">2610</span></a>                        <span class="n">faulted_age</span><span class="p">[</span>
</span><span id="Faults.reassign_channel_segment_encoding-2611"><a href="#-2611"><span class="linenos">2611</span></a>                            <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">layers_mask</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="n">shale_channel_drape</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="Faults.reassign_channel_segment_encoding-2612"><a href="#-2612"><span class="linenos">2612</span></a>                        <span class="p">]</span> <span class="o">=</span> <span class="n">channel_facies_code</span>
</span><span id="Faults.reassign_channel_segment_encoding-2613"><a href="#-2613"><span class="linenos">2613</span></a>                    <span class="k">elif</span> <span class="n">j</span> <span class="o">==</span> <span class="mi">3000</span><span class="p">:</span>
</span><span id="Faults.reassign_channel_segment_encoding-2614"><a href="#-2614"><span class="linenos">2614</span></a>                        <span class="n">channel_segments</span><span class="p">[</span>
</span><span id="Faults.reassign_channel_segment_encoding-2615"><a href="#-2615"><span class="linenos">2615</span></a>                            <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">layers_mask</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="n">levee</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="Faults.reassign_channel_segment_encoding-2616"><a href="#-2616"><span class="linenos">2616</span></a>                        <span class="p">]</span> <span class="o">=</span> <span class="n">channel_facies_code</span>
</span><span id="Faults.reassign_channel_segment_encoding-2617"><a href="#-2617"><span class="linenos">2617</span></a>                        <span class="n">faulted_age</span><span class="p">[</span>
</span><span id="Faults.reassign_channel_segment_encoding-2618"><a href="#-2618"><span class="linenos">2618</span></a>                            <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">layers_mask</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="n">levee</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="Faults.reassign_channel_segment_encoding-2619"><a href="#-2619"><span class="linenos">2619</span></a>                        <span class="p">]</span> <span class="o">=</span> <span class="n">channel_facies_code</span>
</span><span id="Faults.reassign_channel_segment_encoding-2620"><a href="#-2620"><span class="linenos">2620</span></a>                    <span class="k">elif</span> <span class="n">j</span> <span class="o">==</span> <span class="mi">4000</span><span class="p">:</span>
</span><span id="Faults.reassign_channel_segment_encoding-2621"><a href="#-2621"><span class="linenos">2621</span></a>                        <span class="n">channel_segments</span><span class="p">[</span>
</span><span id="Faults.reassign_channel_segment_encoding-2622"><a href="#-2622"><span class="linenos">2622</span></a>                            <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">layers_mask</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="n">crevasse</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="Faults.reassign_channel_segment_encoding-2623"><a href="#-2623"><span class="linenos">2623</span></a>                        <span class="p">]</span> <span class="o">=</span> <span class="n">channel_facies_code</span>
</span><span id="Faults.reassign_channel_segment_encoding-2624"><a href="#-2624"><span class="linenos">2624</span></a>                        <span class="n">faulted_age</span><span class="p">[</span>
</span><span id="Faults.reassign_channel_segment_encoding-2625"><a href="#-2625"><span class="linenos">2625</span></a>                            <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">layers_mask</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="n">crevasse</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="Faults.reassign_channel_segment_encoding-2626"><a href="#-2626"><span class="linenos">2626</span></a>                        <span class="p">]</span> <span class="o">=</span> <span class="n">channel_facies_code</span>
</span><span id="Faults.reassign_channel_segment_encoding-2627"><a href="#-2627"><span class="linenos">2627</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; ... finished Re-assign correct channel segments&quot;</span><span class="p">)</span>
</span><span id="Faults.reassign_channel_segment_encoding-2628"><a href="#-2628"><span class="linenos">2628</span></a>        <span class="k">return</span> <span class="n">channel_segments</span><span class="p">,</span> <span class="n">faulted_age</span>
</span></pre></div>


    

                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="Horizons.html#Horizons">datagenerator.Horizons.Horizons</a></dt>
                                <dd id="Faults.insert_feature_into_horizon_stack" class="function"><a href="Horizons.html#Horizons.insert_feature_into_horizon_stack">insert_feature_into_horizon_stack</a></dd>
                <dd id="Faults.insert_seafloor" class="function"><a href="Horizons.html#Horizons.insert_seafloor">insert_seafloor</a></dd>
                <dd id="Faults.create_random_net_over_gross_map" class="function"><a href="Horizons.html#Horizons.create_random_net_over_gross_map">create_random_net_over_gross_map</a></dd>
                <dd id="Faults.fit_plane_lsq" class="function"><a href="Horizons.html#Horizons.fit_plane_lsq">fit_plane_lsq</a></dd>
                <dd id="Faults.eval_plane" class="function"><a href="Horizons.html#Horizons.eval_plane">eval_plane</a></dd>
                <dd id="Faults.halton" class="function"><a href="Horizons.html#Horizons.halton">halton</a></dd>
                <dd id="Faults.rotate_point" class="function"><a href="Horizons.html#Horizons.rotate_point">rotate_point</a></dd>
                <dd id="Faults.convert_map_from_samples_to_units" class="function"><a href="Horizons.html#Horizons.convert_map_from_samples_to_units">convert_map_from_samples_to_units</a></dd>
                <dd id="Faults.write_maps_to_disk" class="function"><a href="Horizons.html#Horizons.write_maps_to_disk">write_maps_to_disk</a></dd>
                <dd id="Faults.write_onlap_episodes" class="function"><a href="Horizons.html#Horizons.write_onlap_episodes">write_onlap_episodes</a></dd>
                <dd id="Faults.write_fan_horizons" class="function"><a href="Horizons.html#Horizons.write_fan_horizons">write_fan_horizons</a></dd>

            </div>
            <div><dt><a href="Geomodels.html#Geomodel">datagenerator.Geomodels.Geomodel</a></dt>
                                <dd id="Faults.build_unfaulted_geomodels" class="function"><a href="Geomodels.html#Geomodel.build_unfaulted_geomodels">build_unfaulted_geomodels</a></dd>
                <dd id="Faults.infilled_cube_shape" class="function"><a href="Geomodels.html#Geomodel.infilled_cube_shape">infilled_cube_shape</a></dd>
                <dd id="Faults.build_meshgrid" class="function"><a href="Geomodels.html#Geomodel.build_meshgrid">build_meshgrid</a></dd>
                <dd id="Faults.create_geologic_age_3d_from_infilled_horizons" class="function"><a href="Geomodels.html#Geomodel.create_geologic_age_3d_from_infilled_horizons">create_geologic_age_3d_from_infilled_horizons</a></dd>
                <dd id="Faults.vertical_anti_alias_filter_simple" class="function"><a href="Geomodels.html#Geomodel.vertical_anti_alias_filter_simple">vertical_anti_alias_filter_simple</a></dd>
                <dd id="Faults.vertical_anti_alias_filter" class="function"><a href="Geomodels.html#Geomodel.vertical_anti_alias_filter">vertical_anti_alias_filter</a></dd>
                <dd id="Faults.plot_channels" class="function"><a href="Geomodels.html#Geomodel.plot_channels">plot_channels</a></dd>
                <dd id="Faults.insert_onlap_surfaces" class="function"><a href="Geomodels.html#Geomodel.insert_onlap_surfaces">insert_onlap_surfaces</a></dd>
                <dd id="Faults.write_cube_to_disk" class="function"><a href="Geomodels.html#Geomodel.write_cube_to_disk">write_cube_to_disk</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="find_zero_thickness_onlapping_layers">
                            <input id="find_zero_thickness_onlapping_layers-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">find_zero_thickness_onlapping_layers</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">z</span>, </span><span class="param"><span class="n">onlap_list</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="find_zero_thickness_onlapping_layers-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#find_zero_thickness_onlapping_layers"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="find_zero_thickness_onlapping_layers-3205"><a href="#-3205"><span class="linenos">3205</span></a><span class="k">def</span> <span class="nf">find_zero_thickness_onlapping_layers</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">onlap_list</span><span class="p">):</span>
</span><span id="find_zero_thickness_onlapping_layers-3206"><a href="#-3206"><span class="linenos">3206</span></a>    <span class="n">onlap_zero_z</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
</span><span id="find_zero_thickness_onlapping_layers-3207"><a href="#-3207"><span class="linenos">3207</span></a>    <span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="n">onlap_list</span><span class="p">:</span>
</span><span id="find_zero_thickness_onlapping_layers-3208"><a href="#-3208"><span class="linenos">3208</span></a>        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
</span><span id="find_zero_thickness_onlapping_layers-3209"><a href="#-3209"><span class="linenos">3209</span></a>            <span class="n">thickness</span> <span class="o">=</span> <span class="n">z</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">layer</span><span class="p">]</span> <span class="o">-</span> <span class="n">z</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">x</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="find_zero_thickness_onlapping_layers-3210"><a href="#-3210"><span class="linenos">3210</span></a>            <span class="n">zeros</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">thickness</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">)</span>
</span><span id="find_zero_thickness_onlapping_layers-3211"><a href="#-3211"><span class="linenos">3211</span></a>            <span class="k">if</span> <span class="n">zeros</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="find_zero_thickness_onlapping_layers-3212"><a href="#-3212"><span class="linenos">3212</span></a>                <span class="n">onlap_zero_z</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">layer</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">x</span><span class="o">-</span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">zeros</span>
</span><span id="find_zero_thickness_onlapping_layers-3213"><a href="#-3213"><span class="linenos">3213</span></a>    <span class="k">return</span> <span class="n">onlap_zero_z</span>
</span></pre></div>


    

                </section>
                <section id="fix_zero_thickness_fan_layers">
                            <input id="fix_zero_thickness_fan_layers-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">fix_zero_thickness_fan_layers</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">z</span>, </span><span class="param"><span class="n">layer_number</span>, </span><span class="param"><span class="n">thickness</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="fix_zero_thickness_fan_layers-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#fix_zero_thickness_fan_layers"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="fix_zero_thickness_fan_layers-3216"><a href="#-3216"><span class="linenos">3216</span></a><span class="k">def</span> <span class="nf">fix_zero_thickness_fan_layers</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">layer_number</span><span class="p">,</span> <span class="n">thickness</span><span class="p">):</span>
</span><span id="fix_zero_thickness_fan_layers-3217"><a href="#-3217"><span class="linenos">3217</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="fix_zero_thickness_fan_layers-3218"><a href="#-3218"><span class="linenos">3218</span></a><span class="sd">    Clip fan layers to horizon below the fan layer in areas where the fan thickness is zero</span>
</span><span id="fix_zero_thickness_fan_layers-3219"><a href="#-3219"><span class="linenos">3219</span></a>
</span><span id="fix_zero_thickness_fan_layers-3220"><a href="#-3220"><span class="linenos">3220</span></a><span class="sd">    Parameters</span>
</span><span id="fix_zero_thickness_fan_layers-3221"><a href="#-3221"><span class="linenos">3221</span></a><span class="sd">    ----------</span>
</span><span id="fix_zero_thickness_fan_layers-3222"><a href="#-3222"><span class="linenos">3222</span></a><span class="sd">    z : ndarray - depth maps</span>
</span><span id="fix_zero_thickness_fan_layers-3223"><a href="#-3223"><span class="linenos">3223</span></a><span class="sd">    layer_number : 1d array - horizon numbers which contain fans</span>
</span><span id="fix_zero_thickness_fan_layers-3224"><a href="#-3224"><span class="linenos">3224</span></a><span class="sd">    thickness : tuple of ndarrays - original thickness maps of the fans</span>
</span><span id="fix_zero_thickness_fan_layers-3225"><a href="#-3225"><span class="linenos">3225</span></a>
</span><span id="fix_zero_thickness_fan_layers-3226"><a href="#-3226"><span class="linenos">3226</span></a><span class="sd">    Returns</span>
</span><span id="fix_zero_thickness_fan_layers-3227"><a href="#-3227"><span class="linenos">3227</span></a><span class="sd">    -------</span>
</span><span id="fix_zero_thickness_fan_layers-3228"><a href="#-3228"><span class="linenos">3228</span></a><span class="sd">    zmaps : ndarray - depth maps with fan layers clipped to lower horizons where thicknesses is zero</span>
</span><span id="fix_zero_thickness_fan_layers-3229"><a href="#-3229"><span class="linenos">3229</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="fix_zero_thickness_fan_layers-3230"><a href="#-3230"><span class="linenos">3230</span></a>    <span class="n">zmaps</span> <span class="o">=</span> <span class="n">z</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="fix_zero_thickness_fan_layers-3231"><a href="#-3231"><span class="linenos">3231</span></a>    <span class="n">zmaps</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">layer_number</span><span class="p">][</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">thickness</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">)]</span> <span class="o">=</span> <span class="n">zmaps</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">layer_number</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span>
</span><span id="fix_zero_thickness_fan_layers-3232"><a href="#-3232"><span class="linenos">3232</span></a>        <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">thickness</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">)</span>
</span><span id="fix_zero_thickness_fan_layers-3233"><a href="#-3233"><span class="linenos">3233</span></a>    <span class="p">]</span>
</span><span id="fix_zero_thickness_fan_layers-3234"><a href="#-3234"><span class="linenos">3234</span></a>    <span class="k">return</span> <span class="n">zmaps</span>
</span></pre></div>


            <div class="docstring"><p>Clip fan layers to horizon below the fan layer in areas where the fan thickness is zero</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><p><strong>z</strong> (ndarray - depth maps):</p></li>
<li><p><strong>layer_number</strong> (1d array - horizon numbers which contain fans):</p></li>
<li><p><strong>thickness</strong> (tuple of ndarrays - original thickness maps of the fans):</p></li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>zmaps</strong> (ndarray - depth maps with fan layers clipped to lower horizons where thicknesses is zero):</li>
</ul>
</div>


                </section>
                <section id="fix_zero_thickness_onlap_layers">
                            <input id="fix_zero_thickness_onlap_layers-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">fix_zero_thickness_onlap_layers</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">faulted_depth_maps</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span>, </span><span class="param"><span class="n">onlap_dict</span><span class="p">:</span> <span class="nb">dict</span></span><span class="return-annotation">) -> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span>:</span></span>

                <label class="view-source-button" for="fix_zero_thickness_onlap_layers-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#fix_zero_thickness_onlap_layers"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="fix_zero_thickness_onlap_layers-3237"><a href="#-3237"><span class="linenos">3237</span></a><span class="k">def</span> <span class="nf">fix_zero_thickness_onlap_layers</span><span class="p">(</span>
</span><span id="fix_zero_thickness_onlap_layers-3238"><a href="#-3238"><span class="linenos">3238</span></a>    <span class="n">faulted_depth_maps</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
</span><span id="fix_zero_thickness_onlap_layers-3239"><a href="#-3239"><span class="linenos">3239</span></a>    <span class="n">onlap_dict</span><span class="p">:</span> <span class="nb">dict</span>
</span><span id="fix_zero_thickness_onlap_layers-3240"><a href="#-3240"><span class="linenos">3240</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="fix_zero_thickness_onlap_layers-3241"><a href="#-3241"><span class="linenos">3241</span></a>    <span class="sd">&quot;&quot;&quot;fix_zero_thickness_onlap_layers _summary_</span>
</span><span id="fix_zero_thickness_onlap_layers-3242"><a href="#-3242"><span class="linenos">3242</span></a>
</span><span id="fix_zero_thickness_onlap_layers-3243"><a href="#-3243"><span class="linenos">3243</span></a><span class="sd">    Parameters</span>
</span><span id="fix_zero_thickness_onlap_layers-3244"><a href="#-3244"><span class="linenos">3244</span></a><span class="sd">    ----------</span>
</span><span id="fix_zero_thickness_onlap_layers-3245"><a href="#-3245"><span class="linenos">3245</span></a><span class="sd">    faulted_depth_maps : np.ndarray</span>
</span><span id="fix_zero_thickness_onlap_layers-3246"><a href="#-3246"><span class="linenos">3246</span></a><span class="sd">        The depth maps with faults</span>
</span><span id="fix_zero_thickness_onlap_layers-3247"><a href="#-3247"><span class="linenos">3247</span></a><span class="sd">    onlap_dict : dict</span>
</span><span id="fix_zero_thickness_onlap_layers-3248"><a href="#-3248"><span class="linenos">3248</span></a><span class="sd">        Onlaps dictionary</span>
</span><span id="fix_zero_thickness_onlap_layers-3249"><a href="#-3249"><span class="linenos">3249</span></a>
</span><span id="fix_zero_thickness_onlap_layers-3250"><a href="#-3250"><span class="linenos">3250</span></a><span class="sd">    Returns</span>
</span><span id="fix_zero_thickness_onlap_layers-3251"><a href="#-3251"><span class="linenos">3251</span></a><span class="sd">    -------</span>
</span><span id="fix_zero_thickness_onlap_layers-3252"><a href="#-3252"><span class="linenos">3252</span></a><span class="sd">    zmaps : np.ndarray</span>
</span><span id="fix_zero_thickness_onlap_layers-3253"><a href="#-3253"><span class="linenos">3253</span></a><span class="sd">        Fixed depth maps</span>
</span><span id="fix_zero_thickness_onlap_layers-3254"><a href="#-3254"><span class="linenos">3254</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="fix_zero_thickness_onlap_layers-3255"><a href="#-3255"><span class="linenos">3255</span></a>    <span class="n">zmaps</span> <span class="o">=</span> <span class="n">faulted_depth_maps</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="fix_zero_thickness_onlap_layers-3256"><a href="#-3256"><span class="linenos">3256</span></a>    <span class="k">for</span> <span class="n">layers</span><span class="p">,</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">onlap_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="fix_zero_thickness_onlap_layers-3257"><a href="#-3257"><span class="linenos">3257</span></a>        <span class="n">onlap_layer</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">layers</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="fix_zero_thickness_onlap_layers-3258"><a href="#-3258"><span class="linenos">3258</span></a>        <span class="n">layer_to_clip</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">layers</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="fix_zero_thickness_onlap_layers-3259"><a href="#-3259"><span class="linenos">3259</span></a>        <span class="n">zmaps</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">layer_to_clip</span><span class="p">][</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">zmaps</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">onlap_layer</span><span class="p">][</span><span class="n">idx</span><span class="p">]</span>
</span><span id="fix_zero_thickness_onlap_layers-3260"><a href="#-3260"><span class="linenos">3260</span></a>
</span><span id="fix_zero_thickness_onlap_layers-3261"><a href="#-3261"><span class="linenos">3261</span></a>    <span class="k">return</span> <span class="n">zmaps</span>
</span></pre></div>


            <div class="docstring"><p>fix_zero_thickness_onlap_layers _summary_</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>faulted_depth_maps</strong> (np.ndarray):
The depth maps with faults</li>
<li><strong>onlap_dict</strong> (dict):
Onlaps dictionary</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>zmaps</strong> (np.ndarray):
Fixed depth maps</li>
</ul>
</div>


                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "../search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `../${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.kind) {
                    case "function":
                        if (doc.fullname.endsWith(".__init__")) {
                            heading = `<span class="name">${doc.fullname.replace(/\.__init__$/, "")}</span>${doc.signature}`;
                        } else {
                            heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span>${doc.signature}`;
                        }
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value">${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.kind}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>