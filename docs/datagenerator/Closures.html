<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 12.3.0"/>
    <title>datagenerator.Closures API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent }nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .pdoc-alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:1rem center;margin-bottom:1rem;}.pdoc .pdoc-alert > *:last-child{margin-bottom:0;}.pdoc .pdoc-alert-note {color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--code);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="../datagenerator.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                &nbsp;datagenerator</a>


            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>



        <h2>API Documentation</h2>
            <ul class="memberlist">
            <li>
                    <a class="class" href="#Closures">Closures</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#Closures.__init__">Closures</a>
                        </li>
                        <li>
                                <a class="function" href="#Closures.create_closure_labels_from_depth_maps">create_closure_labels_from_depth_maps</a>
                        </li>
                        <li>
                                <a class="function" href="#Closures.create_closure_labels_from_all_depth_maps">create_closure_labels_from_all_depth_maps</a>
                        </li>
                        <li>
                                <a class="function" href="#Closures.find_top_lith_horizons">find_top_lith_horizons</a>
                        </li>
                        <li>
                                <a class="function" href="#Closures.create_closures">create_closures</a>
                        </li>
                        <li>
                                <a class="function" href="#Closures.closure_size_filter">closure_size_filter</a>
                        </li>
                        <li>
                                <a class="function" href="#Closures.closure_type_info_for_log">closure_type_info_for_log</a>
                        </li>
                        <li>
                                <a class="function" href="#Closures.get_voxel_counts">get_voxel_counts</a>
                        </li>
                        <li>
                                <a class="function" href="#Closures.populate_closure_dict">populate_closure_dict</a>
                        </li>
                        <li>
                                <a class="function" href="#Closures.write_closure_info_to_log">write_closure_info_to_log</a>
                        </li>
                        <li>
                                <a class="function" href="#Closures.parse_label_values_and_counts">parse_label_values_and_counts</a>
                        </li>
                        <li>
                                <a class="function" href="#Closures.assign_fluid_types">assign_fluid_types</a>
                        </li>
                        <li>
                                <a class="function" href="#Closures.remove_small_objects">remove_small_objects</a>
                        </li>
                        <li>
                                <a class="function" href="#Closures.segment_closures">segment_closures</a>
                        </li>
                        <li>
                                <a class="function" href="#Closures.write_closure_volumes_to_disk">write_closure_volumes_to_disk</a>
                        </li>
                        <li>
                                <a class="function" href="#Closures.calculate_closure_statistics">calculate_closure_statistics</a>
                        </li>
                        <li>
                                <a class="function" href="#Closures.find_faulted_closures">find_faulted_closures</a>
                        </li>
                        <li>
                                <a class="function" href="#Closures.find_onlap_closures">find_onlap_closures</a>
                        </li>
                        <li>
                                <a class="function" href="#Closures.find_simple_closures">find_simple_closures</a>
                        </li>
                        <li>
                                <a class="function" href="#Closures.find_false_closures">find_false_closures</a>
                        </li>
                        <li>
                                <a class="function" href="#Closures.find_salt_bounded_closures">find_salt_bounded_closures</a>
                        </li>
                        <li>
                                <a class="function" href="#Closures.find_faulted_all_closures">find_faulted_all_closures</a>
                        </li>
                        <li>
                                <a class="function" href="#Closures.find_onlap_all_closures">find_onlap_all_closures</a>
                        </li>
                        <li>
                                <a class="function" href="#Closures.find_simple_all_closures">find_simple_all_closures</a>
                        </li>
                        <li>
                                <a class="function" href="#Closures.find_false_all_closures">find_false_all_closures</a>
                        </li>
                        <li>
                                <a class="function" href="#Closures.find_salt_bounded_all_closures">find_salt_bounded_all_closures</a>
                        </li>
                        <li>
                                <a class="function" href="#Closures.grow_to_fault2">grow_to_fault2</a>
                        </li>
                        <li>
                                <a class="function" href="#Closures.grow_to_salt">grow_to_salt</a>
                        </li>
                        <li>
                                <a class="function" href="#Closures.grow_lateral">grow_lateral</a>
                        </li>
                        <li>
                                <a class="function" href="#Closures.grow_upward">grow_upward</a>
                        </li>
                        <li>
                                <a class="function" href="#Closures.grow_downward">grow_downward</a>
                        </li>
                        <li>
                                <a class="function" href="#Closures.parse_closure_codes">parse_closure_codes</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#Intersect3D">Intersect3D</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#Intersect3D.__init__">Intersect3D</a>
                        </li>
                        <li>
                                <a class="function" href="#Intersect3D.find_faulted_closures">find_faulted_closures</a>
                        </li>
                        <li>
                                <a class="function" href="#Intersect3D.find_onlap_closures">find_onlap_closures</a>
                        </li>
                        <li>
                                <a class="function" href="#Intersect3D.find_simple_closures">find_simple_closures</a>
                        </li>
                        <li>
                                <a class="function" href="#Intersect3D.find_false_closures">find_false_closures</a>
                        </li>
                        <li>
                                <a class="function" href="#Intersect3D.grow_to_fault2">grow_to_fault2</a>
                        </li>
                        <li>
                                <a class="function" href="#Intersect3D.grow_up_and_lateral">grow_up_and_lateral</a>
                        </li>
                        <li>
                                <a class="function" href="#Intersect3D.grow_lateral">grow_lateral</a>
                        </li>
                        <li>
                                <a class="function" href="#Intersect3D.grow_upward">grow_upward</a>
                        </li>
                        <li>
                                <a class="function" href="#Intersect3D.grow_downward">grow_downward</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="function" href="#variable_max_column_height">variable_max_column_height</a>
            </li>
            <li>
                    <a class="function" href="#fill_to_spill">fill_to_spill</a>
            </li>
            <li>
                    <a class="function" href="#flood_fill_heap">flood_fill_heap</a>
            </li>
            <li>
                    <a class="function" href="#get_top_of_closure">get_top_of_closure</a>
            </li>
            <li>
                    <a class="function" href="#lsq">lsq</a>
            </li>
            <li>
                    <a class="function" href="#compute_ai_gi">compute_ai_gi</a>
            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
<a href="./../datagenerator.html">datagenerator</a><wbr>.Closures    </h1>

                
                        <input id="mod-Closures-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-Closures-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#-1"><span class="linenos">   1</span></a><span class="kn">import</span> <span class="nn">os</span>
</span><span id="L-2"><a href="#-2"><span class="linenos">   2</span></a>
</span><span id="L-3"><a href="#-3"><span class="linenos">   3</span></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span><span id="L-4"><a href="#-4"><span class="linenos">   4</span></a><span class="kn">from</span> <span class="nn">datagenerator.Horizons</span> <span class="kn">import</span> <span class="n">Horizons</span>
</span><span id="L-5"><a href="#-5"><span class="linenos">   5</span></a><span class="kn">from</span> <span class="nn">datagenerator.Geomodels</span> <span class="kn">import</span> <span class="n">Geomodel</span>
</span><span id="L-6"><a href="#-6"><span class="linenos">   6</span></a><span class="kn">from</span> <span class="nn">datagenerator.Parameters</span> <span class="kn">import</span> <span class="n">Parameters</span>
</span><span id="L-7"><a href="#-7"><span class="linenos">   7</span></a><span class="kn">from</span> <span class="nn">skimage</span> <span class="kn">import</span> <span class="n">morphology</span><span class="p">,</span> <span class="n">measure</span>
</span><span id="L-8"><a href="#-8"><span class="linenos">   8</span></a><span class="kn">from</span> <span class="nn">scipy.ndimage</span> <span class="kn">import</span> <span class="n">minimum_filter</span><span class="p">,</span> <span class="n">maximum_filter</span>
</span><span id="L-9"><a href="#-9"><span class="linenos">   9</span></a>
</span><span id="L-10"><a href="#-10"><span class="linenos">  10</span></a>
</span><span id="L-11"><a href="#-11"><span class="linenos">  11</span></a><span class="k">class</span> <span class="nc">Closures</span><span class="p">(</span><span class="n">Horizons</span><span class="p">,</span> <span class="n">Geomodel</span><span class="p">,</span> <span class="n">Parameters</span><span class="p">):</span>
</span><span id="L-12"><a href="#-12"><span class="linenos">  12</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parameters</span><span class="p">,</span> <span class="n">faults</span><span class="p">,</span> <span class="n">facies</span><span class="p">,</span> <span class="n">onlap_horizon_list</span><span class="p">):</span>
</span><span id="L-13"><a href="#-13"><span class="linenos">  13</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">closure_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
</span><span id="L-14"><a href="#-14"><span class="linenos">  14</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span> <span class="o">=</span> <span class="n">parameters</span>
</span><span id="L-15"><a href="#-15"><span class="linenos">  15</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">faults</span> <span class="o">=</span> <span class="n">faults</span>
</span><span id="L-16"><a href="#-16"><span class="linenos">  16</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">facies</span> <span class="o">=</span> <span class="n">facies</span>
</span><span id="L-17"><a href="#-17"><span class="linenos">  17</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">onlap_list</span> <span class="o">=</span> <span class="n">onlap_horizon_list</span>
</span><span id="L-18"><a href="#-18"><span class="linenos">  18</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">top_lith_facies</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-19"><a href="#-19"><span class="linenos">  19</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">closure_vol_shape</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">faulted_age_volume</span><span class="o">.</span><span class="n">shape</span>
</span><span id="L-20"><a href="#-20"><span class="linenos">  20</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">closure_segments</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="L-21"><a href="#-21"><span class="linenos">  21</span></a>            <span class="s2">&quot;closure_segments&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">closure_vol_shape</span>
</span><span id="L-22"><a href="#-22"><span class="linenos">  22</span></a>        <span class="p">)</span>
</span><span id="L-23"><a href="#-23"><span class="linenos">  23</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">oil_closures</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="L-24"><a href="#-24"><span class="linenos">  24</span></a>            <span class="s2">&quot;oil_closures&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">closure_vol_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;uint8&quot;</span>
</span><span id="L-25"><a href="#-25"><span class="linenos">  25</span></a>        <span class="p">)</span>
</span><span id="L-26"><a href="#-26"><span class="linenos">  26</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gas_closures</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="L-27"><a href="#-27"><span class="linenos">  27</span></a>            <span class="s2">&quot;gas_closures&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">closure_vol_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;uint8&quot;</span>
</span><span id="L-28"><a href="#-28"><span class="linenos">  28</span></a>        <span class="p">)</span>
</span><span id="L-29"><a href="#-29"><span class="linenos">  29</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">brine_closures</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="L-30"><a href="#-30"><span class="linenos">  30</span></a>            <span class="s2">&quot;brine_closures&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">closure_vol_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;uint8&quot;</span>
</span><span id="L-31"><a href="#-31"><span class="linenos">  31</span></a>        <span class="p">)</span>
</span><span id="L-32"><a href="#-32"><span class="linenos">  32</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">simple_closures</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="L-33"><a href="#-33"><span class="linenos">  33</span></a>            <span class="s2">&quot;simple_closures&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">closure_vol_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;uint8&quot;</span>
</span><span id="L-34"><a href="#-34"><span class="linenos">  34</span></a>        <span class="p">)</span>
</span><span id="L-35"><a href="#-35"><span class="linenos">  35</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">strat_closures</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="L-36"><a href="#-36"><span class="linenos">  36</span></a>            <span class="s2">&quot;strat_closures&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">closure_vol_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;uint8&quot;</span>
</span><span id="L-37"><a href="#-37"><span class="linenos">  37</span></a>        <span class="p">)</span>
</span><span id="L-38"><a href="#-38"><span class="linenos">  38</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fault_closures</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="L-39"><a href="#-39"><span class="linenos">  39</span></a>            <span class="s2">&quot;fault_closures&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">closure_vol_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;uint8&quot;</span>
</span><span id="L-40"><a href="#-40"><span class="linenos">  40</span></a>        <span class="p">)</span>
</span><span id="L-41"><a href="#-41"><span class="linenos">  41</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">hc_labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="L-42"><a href="#-42"><span class="linenos">  42</span></a>            <span class="s2">&quot;hc_labels&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">closure_vol_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;uint8&quot;</span>
</span><span id="L-43"><a href="#-43"><span class="linenos">  43</span></a>        <span class="p">)</span>
</span><span id="L-44"><a href="#-44"><span class="linenos">  44</span></a>
</span><span id="L-45"><a href="#-45"><span class="linenos">  45</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">all_closure_segments</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="L-46"><a href="#-46"><span class="linenos">  46</span></a>            <span class="s2">&quot;all_closure_segments&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">closure_vol_shape</span>
</span><span id="L-47"><a href="#-47"><span class="linenos">  47</span></a>        <span class="p">)</span>
</span><span id="L-48"><a href="#-48"><span class="linenos">  48</span></a>
</span><span id="L-49"><a href="#-49"><span class="linenos">  49</span></a>        <span class="c1"># Class attributes added from Intersect3D</span>
</span><span id="L-50"><a href="#-50"><span class="linenos">  50</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">wide_faults</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="L-51"><a href="#-51"><span class="linenos">  51</span></a>            <span class="s2">&quot;wide_faults&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">closure_vol_shape</span>
</span><span id="L-52"><a href="#-52"><span class="linenos">  52</span></a>        <span class="p">)</span>
</span><span id="L-53"><a href="#-53"><span class="linenos">  53</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fat_faults</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span><span class="s2">&quot;fat_faults&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">closure_vol_shape</span><span class="p">)</span>
</span><span id="L-54"><a href="#-54"><span class="linenos">  54</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">onlaps_upward</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="L-55"><a href="#-55"><span class="linenos">  55</span></a>            <span class="s2">&quot;onlaps_upward&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">closure_vol_shape</span>
</span><span id="L-56"><a href="#-56"><span class="linenos">  56</span></a>        <span class="p">)</span>
</span><span id="L-57"><a href="#-57"><span class="linenos">  57</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">onlaps_downward</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="L-58"><a href="#-58"><span class="linenos">  58</span></a>            <span class="s2">&quot;onlaps_downward&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">closure_vol_shape</span>
</span><span id="L-59"><a href="#-59"><span class="linenos">  59</span></a>        <span class="p">)</span>
</span><span id="L-60"><a href="#-60"><span class="linenos">  60</span></a>
</span><span id="L-61"><a href="#-61"><span class="linenos">  61</span></a>        <span class="c1"># Faulted closures</span>
</span><span id="L-62"><a href="#-62"><span class="linenos">  62</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">faulted_closures_oil</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="L-63"><a href="#-63"><span class="linenos">  63</span></a>            <span class="s2">&quot;faulted_closures_oil&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">closure_vol_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;uint8&quot;</span>
</span><span id="L-64"><a href="#-64"><span class="linenos">  64</span></a>        <span class="p">)</span>
</span><span id="L-65"><a href="#-65"><span class="linenos">  65</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">faulted_closures_gas</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="L-66"><a href="#-66"><span class="linenos">  66</span></a>            <span class="s2">&quot;faulted_closures_gas&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">closure_vol_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;uint8&quot;</span>
</span><span id="L-67"><a href="#-67"><span class="linenos">  67</span></a>        <span class="p">)</span>
</span><span id="L-68"><a href="#-68"><span class="linenos">  68</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">faulted_closures_brine</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="L-69"><a href="#-69"><span class="linenos">  69</span></a>            <span class="s2">&quot;faulted_closures_brine&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">closure_vol_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;uint8&quot;</span>
</span><span id="L-70"><a href="#-70"><span class="linenos">  70</span></a>        <span class="p">)</span>
</span><span id="L-71"><a href="#-71"><span class="linenos">  71</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fault_closures_oil_segment_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
</span><span id="L-72"><a href="#-72"><span class="linenos">  72</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fault_closures_gas_segment_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
</span><span id="L-73"><a href="#-73"><span class="linenos">  73</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fault_closures_brine_segment_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
</span><span id="L-74"><a href="#-74"><span class="linenos">  74</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_fault_closures_oil</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-75"><a href="#-75"><span class="linenos">  75</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_fault_closures_gas</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-76"><a href="#-76"><span class="linenos">  76</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_fault_closures_brine</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-77"><a href="#-77"><span class="linenos">  77</span></a>
</span><span id="L-78"><a href="#-78"><span class="linenos">  78</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">faulted_all_closures</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="L-79"><a href="#-79"><span class="linenos">  79</span></a>            <span class="s2">&quot;faulted_all_closures&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">closure_vol_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;uint8&quot;</span>
</span><span id="L-80"><a href="#-80"><span class="linenos">  80</span></a>        <span class="p">)</span>
</span><span id="L-81"><a href="#-81"><span class="linenos">  81</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fault_all_closures_segment_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
</span><span id="L-82"><a href="#-82"><span class="linenos">  82</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_fault_all_closures</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-83"><a href="#-83"><span class="linenos">  83</span></a>
</span><span id="L-84"><a href="#-84"><span class="linenos">  84</span></a>        <span class="c1"># Onlap closures</span>
</span><span id="L-85"><a href="#-85"><span class="linenos">  85</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">onlap_closures_oil</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="L-86"><a href="#-86"><span class="linenos">  86</span></a>            <span class="s2">&quot;onlap_closures_oil&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">closure_vol_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;uint8&quot;</span>
</span><span id="L-87"><a href="#-87"><span class="linenos">  87</span></a>        <span class="p">)</span>
</span><span id="L-88"><a href="#-88"><span class="linenos">  88</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">onlap_closures_gas</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="L-89"><a href="#-89"><span class="linenos">  89</span></a>            <span class="s2">&quot;onlap_closures_gas&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">closure_vol_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;uint8&quot;</span>
</span><span id="L-90"><a href="#-90"><span class="linenos">  90</span></a>        <span class="p">)</span>
</span><span id="L-91"><a href="#-91"><span class="linenos">  91</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">onlap_closures_brine</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="L-92"><a href="#-92"><span class="linenos">  92</span></a>            <span class="s2">&quot;onlap_closures_brine&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">closure_vol_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;uint8&quot;</span>
</span><span id="L-93"><a href="#-93"><span class="linenos">  93</span></a>        <span class="p">)</span>
</span><span id="L-94"><a href="#-94"><span class="linenos">  94</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">onlap_closures_oil_segment_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
</span><span id="L-95"><a href="#-95"><span class="linenos">  95</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">onlap_closures_gas_segment_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
</span><span id="L-96"><a href="#-96"><span class="linenos">  96</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">onlap_closures_brine_segment_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
</span><span id="L-97"><a href="#-97"><span class="linenos">  97</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_onlap_closures_oil</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-98"><a href="#-98"><span class="linenos">  98</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_onlap_closures_gas</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-99"><a href="#-99"><span class="linenos">  99</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_onlap_closures_brine</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-100"><a href="#-100"><span class="linenos"> 100</span></a>
</span><span id="L-101"><a href="#-101"><span class="linenos"> 101</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">onlap_all_closures</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="L-102"><a href="#-102"><span class="linenos"> 102</span></a>            <span class="s2">&quot;onlap_all_closures&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">closure_vol_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;uint8&quot;</span>
</span><span id="L-103"><a href="#-103"><span class="linenos"> 103</span></a>        <span class="p">)</span>
</span><span id="L-104"><a href="#-104"><span class="linenos"> 104</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">onlap_all_closures_segment_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
</span><span id="L-105"><a href="#-105"><span class="linenos"> 105</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_onlap_all_closures_oil</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-106"><a href="#-106"><span class="linenos"> 106</span></a>
</span><span id="L-107"><a href="#-107"><span class="linenos"> 107</span></a>        <span class="c1"># Simple closures</span>
</span><span id="L-108"><a href="#-108"><span class="linenos"> 108</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">simple_closures_oil</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="L-109"><a href="#-109"><span class="linenos"> 109</span></a>            <span class="s2">&quot;simple_closures_oil&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">closure_vol_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;uint8&quot;</span>
</span><span id="L-110"><a href="#-110"><span class="linenos"> 110</span></a>        <span class="p">)</span>
</span><span id="L-111"><a href="#-111"><span class="linenos"> 111</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">simple_closures_gas</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="L-112"><a href="#-112"><span class="linenos"> 112</span></a>            <span class="s2">&quot;simple_closures_gas&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">closure_vol_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;uint8&quot;</span>
</span><span id="L-113"><a href="#-113"><span class="linenos"> 113</span></a>        <span class="p">)</span>
</span><span id="L-114"><a href="#-114"><span class="linenos"> 114</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">simple_closures_brine</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="L-115"><a href="#-115"><span class="linenos"> 115</span></a>            <span class="s2">&quot;simple_closures_brine&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">closure_vol_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;uint8&quot;</span>
</span><span id="L-116"><a href="#-116"><span class="linenos"> 116</span></a>        <span class="p">)</span>
</span><span id="L-117"><a href="#-117"><span class="linenos"> 117</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">simple_closures_oil_segment_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
</span><span id="L-118"><a href="#-118"><span class="linenos"> 118</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">simple_closures_gas_segment_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
</span><span id="L-119"><a href="#-119"><span class="linenos"> 119</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">simple_closures_brine_segment_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
</span><span id="L-120"><a href="#-120"><span class="linenos"> 120</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_4way_closures_oil</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-121"><a href="#-121"><span class="linenos"> 121</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_4way_closures_gas</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-122"><a href="#-122"><span class="linenos"> 122</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_4way_closures_brine</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-123"><a href="#-123"><span class="linenos"> 123</span></a>
</span><span id="L-124"><a href="#-124"><span class="linenos"> 124</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">simple_all_closures</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="L-125"><a href="#-125"><span class="linenos"> 125</span></a>            <span class="s2">&quot;simple_all_closures&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">closure_vol_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;uint8&quot;</span>
</span><span id="L-126"><a href="#-126"><span class="linenos"> 126</span></a>        <span class="p">)</span>
</span><span id="L-127"><a href="#-127"><span class="linenos"> 127</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">simple_all_closures_segment_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
</span><span id="L-128"><a href="#-128"><span class="linenos"> 128</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_4way_all_closures</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-129"><a href="#-129"><span class="linenos"> 129</span></a>
</span><span id="L-130"><a href="#-130"><span class="linenos"> 130</span></a>        <span class="c1"># False closures</span>
</span><span id="L-131"><a href="#-131"><span class="linenos"> 131</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">false_closures_oil</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="L-132"><a href="#-132"><span class="linenos"> 132</span></a>            <span class="s2">&quot;false_closures_oil&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">closure_vol_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;uint8&quot;</span>
</span><span id="L-133"><a href="#-133"><span class="linenos"> 133</span></a>        <span class="p">)</span>
</span><span id="L-134"><a href="#-134"><span class="linenos"> 134</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">false_closures_gas</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="L-135"><a href="#-135"><span class="linenos"> 135</span></a>            <span class="s2">&quot;false_closures_gas&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">closure_vol_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;uint8&quot;</span>
</span><span id="L-136"><a href="#-136"><span class="linenos"> 136</span></a>        <span class="p">)</span>
</span><span id="L-137"><a href="#-137"><span class="linenos"> 137</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">false_closures_brine</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="L-138"><a href="#-138"><span class="linenos"> 138</span></a>            <span class="s2">&quot;false_closures_brine&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">closure_vol_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;uint8&quot;</span>
</span><span id="L-139"><a href="#-139"><span class="linenos"> 139</span></a>        <span class="p">)</span>
</span><span id="L-140"><a href="#-140"><span class="linenos"> 140</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_false_closures_oil</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-141"><a href="#-141"><span class="linenos"> 141</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_false_closures_gas</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-142"><a href="#-142"><span class="linenos"> 142</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_false_closures_brine</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-143"><a href="#-143"><span class="linenos"> 143</span></a>
</span><span id="L-144"><a href="#-144"><span class="linenos"> 144</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">false_all_closures</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="L-145"><a href="#-145"><span class="linenos"> 145</span></a>            <span class="s2">&quot;false_all_closures&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">closure_vol_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;uint8&quot;</span>
</span><span id="L-146"><a href="#-146"><span class="linenos"> 146</span></a>        <span class="p">)</span>
</span><span id="L-147"><a href="#-147"><span class="linenos"> 147</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_false_all_closures</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-148"><a href="#-148"><span class="linenos"> 148</span></a>
</span><span id="L-149"><a href="#-149"><span class="linenos"> 149</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">include_salt</span><span class="p">:</span>
</span><span id="L-150"><a href="#-150"><span class="linenos"> 150</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">salt_closures</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="L-151"><a href="#-151"><span class="linenos"> 151</span></a>                <span class="s2">&quot;salt_closures&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">closure_vol_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;uint8&quot;</span>
</span><span id="L-152"><a href="#-152"><span class="linenos"> 152</span></a>            <span class="p">)</span>
</span><span id="L-153"><a href="#-153"><span class="linenos"> 153</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">wide_salt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="L-154"><a href="#-154"><span class="linenos"> 154</span></a>                <span class="s2">&quot;wide_salt&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">closure_vol_shape</span>
</span><span id="L-155"><a href="#-155"><span class="linenos"> 155</span></a>            <span class="p">)</span>
</span><span id="L-156"><a href="#-156"><span class="linenos"> 156</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">salt_closures_oil</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="L-157"><a href="#-157"><span class="linenos"> 157</span></a>                <span class="s2">&quot;salt_bounded_closures_oil&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">closure_vol_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;uint8&quot;</span>
</span><span id="L-158"><a href="#-158"><span class="linenos"> 158</span></a>            <span class="p">)</span>
</span><span id="L-159"><a href="#-159"><span class="linenos"> 159</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">salt_closures_gas</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="L-160"><a href="#-160"><span class="linenos"> 160</span></a>                <span class="s2">&quot;salt_bounded_closures_gas&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">closure_vol_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;uint8&quot;</span>
</span><span id="L-161"><a href="#-161"><span class="linenos"> 161</span></a>            <span class="p">)</span>
</span><span id="L-162"><a href="#-162"><span class="linenos"> 162</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">salt_closures_brine</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="L-163"><a href="#-163"><span class="linenos"> 163</span></a>                <span class="s2">&quot;salt_bounded_closures_brine&quot;</span><span class="p">,</span>
</span><span id="L-164"><a href="#-164"><span class="linenos"> 164</span></a>                <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">closure_vol_shape</span><span class="p">,</span>
</span><span id="L-165"><a href="#-165"><span class="linenos"> 165</span></a>                <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;uint8&quot;</span><span class="p">,</span>
</span><span id="L-166"><a href="#-166"><span class="linenos"> 166</span></a>            <span class="p">)</span>
</span><span id="L-167"><a href="#-167"><span class="linenos"> 167</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">salt_closures_oil_segment_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
</span><span id="L-168"><a href="#-168"><span class="linenos"> 168</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">salt_closures_gas_segment_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
</span><span id="L-169"><a href="#-169"><span class="linenos"> 169</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">salt_closures_brine_segment_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
</span><span id="L-170"><a href="#-170"><span class="linenos"> 170</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">n_salt_closures_oil</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-171"><a href="#-171"><span class="linenos"> 171</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">n_salt_closures_gas</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-172"><a href="#-172"><span class="linenos"> 172</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">n_salt_closures_brine</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-173"><a href="#-173"><span class="linenos"> 173</span></a>
</span><span id="L-174"><a href="#-174"><span class="linenos"> 174</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">salt_all_closures</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="L-175"><a href="#-175"><span class="linenos"> 175</span></a>                <span class="s2">&quot;salt_bounded_all_closures&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">closure_vol_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;uint8&quot;</span>
</span><span id="L-176"><a href="#-176"><span class="linenos"> 176</span></a>            <span class="p">)</span>
</span><span id="L-177"><a href="#-177"><span class="linenos"> 177</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">salt_all_closures_segment_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
</span><span id="L-178"><a href="#-178"><span class="linenos"> 178</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">n_salt_all_closures</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-179"><a href="#-179"><span class="linenos"> 179</span></a>
</span><span id="L-180"><a href="#-180"><span class="linenos"> 180</span></a>    <span class="k">def</span> <span class="nf">create_closure_labels_from_depth_maps</span><span class="p">(</span>
</span><span id="L-181"><a href="#-181"><span class="linenos"> 181</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">depth_maps</span><span class="p">,</span> <span class="n">depth_maps_infilled</span><span class="p">,</span> <span class="n">max_col_height</span>
</span><span id="L-182"><a href="#-182"><span class="linenos"> 182</span></a>    <span class="p">):</span>
</span><span id="L-183"><a href="#-183"><span class="linenos"> 183</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="L-184"><a href="#-184"><span class="linenos"> 184</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\t</span><span class="s2">... inside insertClosureLabels3D &quot;</span><span class="p">)</span>
</span><span id="L-185"><a href="#-185"><span class="linenos"> 185</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="L-186"><a href="#-186"><span class="linenos"> 186</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">... depth_maps min </span><span class="si">{</span><span class="n">depth_maps</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, mean </span><span class="si">{</span><span class="n">depth_maps</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">,&quot;</span>
</span><span id="L-187"><a href="#-187"><span class="linenos"> 187</span></a>                <span class="sa">f</span><span class="s2">&quot; max </span><span class="si">{</span><span class="n">depth_maps</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, cube_shape </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-188"><a href="#-188"><span class="linenos"> 188</span></a>            <span class="p">)</span>
</span><span id="L-189"><a href="#-189"><span class="linenos"> 189</span></a>
</span><span id="L-190"><a href="#-190"><span class="linenos"> 190</span></a>        <span class="c1"># create 3D cube to hold segmentation results</span>
</span><span id="L-191"><a href="#-191"><span class="linenos"> 191</span></a>        <span class="n">closure_segments</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">faulted_lithology</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="s2">&quot;float32&quot;</span><span class="p">)</span>
</span><span id="L-192"><a href="#-192"><span class="linenos"> 192</span></a>
</span><span id="L-193"><a href="#-193"><span class="linenos"> 193</span></a>        <span class="c1"># create grids with grid indices</span>
</span><span id="L-194"><a href="#-194"><span class="linenos"> 194</span></a>        <span class="n">ii</span><span class="p">,</span> <span class="n">jj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">build_meshgrid</span><span class="p">()</span>
</span><span id="L-195"><a href="#-195"><span class="linenos"> 195</span></a>
</span><span id="L-196"><a href="#-196"><span class="linenos"> 196</span></a>        <span class="c1"># loop through horizons in &#39;depth_maps&#39;</span>
</span><span id="L-197"><a href="#-197"><span class="linenos"> 197</span></a>        <span class="n">voxel_change_count</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
</span><span id="L-198"><a href="#-198"><span class="linenos"> 198</span></a>        <span class="n">layers_with_closure</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-199"><a href="#-199"><span class="linenos"> 199</span></a>
</span><span id="L-200"><a href="#-200"><span class="linenos"> 200</span></a>        <span class="n">avg_sand_thickness</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
</span><span id="L-201"><a href="#-201"><span class="linenos"> 201</span></a>        <span class="n">avg_shale_thickness</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
</span><span id="L-202"><a href="#-202"><span class="linenos"> 202</span></a>        <span class="n">avg_unit_thickness</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
</span><span id="L-203"><a href="#-203"><span class="linenos"> 203</span></a>        <span class="k">for</span> <span class="n">ihorizon</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">depth_maps</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="L-204"><a href="#-204"><span class="linenos"> 204</span></a>            <span class="n">avg_unit_thickness</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="L-205"><a href="#-205"><span class="linenos"> 205</span></a>                <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span>
</span><span id="L-206"><a href="#-206"><span class="linenos"> 206</span></a>                    <span class="n">depth_maps_infilled</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">ihorizon</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="L-207"><a href="#-207"><span class="linenos"> 207</span></a>                    <span class="o">-</span> <span class="n">depth_maps_infilled</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">ihorizon</span><span class="p">]</span>
</span><span id="L-208"><a href="#-208"><span class="linenos"> 208</span></a>                <span class="p">)</span>
</span><span id="L-209"><a href="#-209"><span class="linenos"> 209</span></a>            <span class="p">)</span>
</span><span id="L-210"><a href="#-210"><span class="linenos"> 210</span></a>
</span><span id="L-211"><a href="#-211"><span class="linenos"> 211</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">top_lith_facies</span><span class="p">[</span><span class="n">ihorizon</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-212"><a href="#-212"><span class="linenos"> 212</span></a>                <span class="c1"># If facies is not shale, calculate a closure map for the layer</span>
</span><span id="L-213"><a href="#-213"><span class="linenos"> 213</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="L-214"><a href="#-214"><span class="linenos"> 214</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="L-215"><a href="#-215"><span class="linenos"> 215</span></a>                        <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">...closure voxels computation for layer </span><span class="si">{</span><span class="n">ihorizon</span><span class="si">}</span><span class="s2"> in horizon list.&quot;</span>
</span><span id="L-216"><a href="#-216"><span class="linenos"> 216</span></a>                    <span class="p">)</span>
</span><span id="L-217"><a href="#-217"><span class="linenos"> 217</span></a>                <span class="n">avg_sand_thickness</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="L-218"><a href="#-218"><span class="linenos"> 218</span></a>                    <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span>
</span><span id="L-219"><a href="#-219"><span class="linenos"> 219</span></a>                        <span class="n">depth_maps_infilled</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">ihorizon</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="L-220"><a href="#-220"><span class="linenos"> 220</span></a>                        <span class="o">-</span> <span class="n">depth_maps_infilled</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">ihorizon</span><span class="p">]</span>
</span><span id="L-221"><a href="#-221"><span class="linenos"> 221</span></a>                    <span class="p">)</span>
</span><span id="L-222"><a href="#-222"><span class="linenos"> 222</span></a>                <span class="p">)</span>
</span><span id="L-223"><a href="#-223"><span class="linenos"> 223</span></a>                <span class="c1"># compute a closure map</span>
</span><span id="L-224"><a href="#-224"><span class="linenos"> 224</span></a>                <span class="c1"># - identical to top structure map when not in closure, &#39;max flooding&#39; depth when in closure</span>
</span><span id="L-225"><a href="#-225"><span class="linenos"> 225</span></a>                <span class="c1"># - use thicknesses converted to samples instead of ft or ms</span>
</span><span id="L-226"><a href="#-226"><span class="linenos"> 226</span></a>                <span class="c1"># - assumes that fault intersections are inserted in input map with value of 0.</span>
</span><span id="L-227"><a href="#-227"><span class="linenos"> 227</span></a>                <span class="c1"># - assumes that input map values represent depth (i.e., bigger values are deeper)</span>
</span><span id="L-228"><a href="#-228"><span class="linenos"> 228</span></a>                <span class="n">top_structure_depth_map</span> <span class="o">=</span> <span class="n">depth_maps</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">ihorizon</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-229"><a href="#-229"><span class="linenos"> 229</span></a>                <span class="n">top_structure_depth_map</span><span class="p">[</span>
</span><span id="L-230"><a href="#-230"><span class="linenos"> 230</span></a>                    <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">top_structure_depth_map</span><span class="p">)</span>
</span><span id="L-231"><a href="#-231"><span class="linenos"> 231</span></a>                <span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>  <span class="c1"># replace nans with 0.</span>
</span><span id="L-232"><a href="#-232"><span class="linenos"> 232</span></a>                <span class="n">top_structure_depth_map</span> <span class="o">/=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">digi</span><span class="p">)</span>
</span><span id="L-233"><a href="#-233"><span class="linenos"> 233</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">partial_voxels</span><span class="p">:</span>
</span><span id="L-234"><a href="#-234"><span class="linenos"> 234</span></a>                    <span class="n">top_structure_depth_map</span> <span class="o">-=</span> <span class="p">(</span>
</span><span id="L-235"><a href="#-235"><span class="linenos"> 235</span></a>                        <span class="mf">1.0</span>  <span class="c1"># account for voxels partially in layer</span>
</span><span id="L-236"><a href="#-236"><span class="linenos"> 236</span></a>                    <span class="p">)</span>
</span><span id="L-237"><a href="#-237"><span class="linenos"> 237</span></a>                <span class="n">base_structure_depth_map</span> <span class="o">=</span> <span class="n">depth_maps_infilled</span><span class="p">[</span>
</span><span id="L-238"><a href="#-238"><span class="linenos"> 238</span></a>                    <span class="p">:,</span> <span class="p">:,</span> <span class="n">ihorizon</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="L-239"><a href="#-239"><span class="linenos"> 239</span></a>                <span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-240"><a href="#-240"><span class="linenos"> 240</span></a>                <span class="n">base_structure_depth_map</span><span class="p">[</span>
</span><span id="L-241"><a href="#-241"><span class="linenos"> 241</span></a>                    <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">top_structure_depth_map</span><span class="p">)</span>
</span><span id="L-242"><a href="#-242"><span class="linenos"> 242</span></a>                <span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>  <span class="c1"># replace nans with 0.</span>
</span><span id="L-243"><a href="#-243"><span class="linenos"> 243</span></a>                <span class="n">base_structure_depth_map</span> <span class="o">/=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">digi</span><span class="p">)</span>
</span><span id="L-244"><a href="#-244"><span class="linenos"> 244</span></a>                <span class="nb">print</span><span class="p">(</span>
</span><span id="L-245"><a href="#-245"><span class="linenos"> 245</span></a>                    <span class="s2">&quot; ...inside create_closure_labels_from_depth_maps... ihorizon, self.top_lith_facies[ihorizon] = &quot;</span><span class="p">,</span>
</span><span id="L-246"><a href="#-246"><span class="linenos"> 246</span></a>                    <span class="n">ihorizon</span><span class="p">,</span>
</span><span id="L-247"><a href="#-247"><span class="linenos"> 247</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">top_lith_facies</span><span class="p">[</span><span class="n">ihorizon</span><span class="p">],</span>
</span><span id="L-248"><a href="#-248"><span class="linenos"> 248</span></a>                <span class="p">)</span>
</span><span id="L-249"><a href="#-249"><span class="linenos"> 249</span></a>                <span class="c1"># if there is non-zero thickness between top/base closure</span>
</span><span id="L-250"><a href="#-250"><span class="linenos"> 250</span></a>                <span class="k">if</span> <span class="n">top_structure_depth_map</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">!=</span> <span class="n">top_structure_depth_map</span><span class="o">.</span><span class="n">max</span><span class="p">():</span>
</span><span id="L-251"><a href="#-251"><span class="linenos"> 251</span></a>                    <span class="n">max_column</span> <span class="o">=</span> <span class="n">max_col_height</span><span class="p">[</span><span class="n">ihorizon</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">digi</span>
</span><span id="L-252"><a href="#-252"><span class="linenos"> 252</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="L-253"><a href="#-253"><span class="linenos"> 253</span></a>                        <span class="nb">print</span><span class="p">(</span>
</span><span id="L-254"><a href="#-254"><span class="linenos"> 254</span></a>                            <span class="sa">f</span><span class="s2">&quot;   ...avg depth for layer </span><span class="si">{</span><span class="n">ihorizon</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">,</span>
</span><span id="L-255"><a href="#-255"><span class="linenos"> 255</span></a>                            <span class="n">top_structure_depth_map</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span>
</span><span id="L-256"><a href="#-256"><span class="linenos"> 256</span></a>                        <span class="p">)</span>
</span><span id="L-257"><a href="#-257"><span class="linenos"> 257</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="L-258"><a href="#-258"><span class="linenos"> 258</span></a>                        <span class="nb">print</span><span class="p">(</span>
</span><span id="L-259"><a href="#-259"><span class="linenos"> 259</span></a>                            <span class="sa">f</span><span class="s2">&quot;   ...maximum column height for layer </span><span class="si">{</span><span class="n">ihorizon</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">,</span>
</span><span id="L-260"><a href="#-260"><span class="linenos"> 260</span></a>                            <span class="n">max_column</span><span class="p">,</span>
</span><span id="L-261"><a href="#-261"><span class="linenos"> 261</span></a>                        <span class="p">)</span>
</span><span id="L-262"><a href="#-262"><span class="linenos"> 262</span></a>
</span><span id="L-263"><a href="#-263"><span class="linenos"> 263</span></a>                    <span class="k">if</span> <span class="n">ihorizon</span> <span class="o">==</span> <span class="mi">27000</span> <span class="ow">or</span> <span class="n">ihorizon</span> <span class="o">==</span> <span class="mi">1000</span><span class="p">:</span>
</span><span id="L-264"><a href="#-264"><span class="linenos"> 264</span></a>                        <span class="n">closure_depth_map</span> <span class="o">=</span> <span class="n">_flood_fill</span><span class="p">(</span>
</span><span id="L-265"><a href="#-265"><span class="linenos"> 265</span></a>                            <span class="n">top_structure_depth_map</span><span class="p">,</span>
</span><span id="L-266"><a href="#-266"><span class="linenos"> 266</span></a>                            <span class="n">max_column_height</span><span class="o">=</span><span class="n">max_column</span><span class="p">,</span>
</span><span id="L-267"><a href="#-267"><span class="linenos"> 267</span></a>                            <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-268"><a href="#-268"><span class="linenos"> 268</span></a>                            <span class="n">debug</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-269"><a href="#-269"><span class="linenos"> 269</span></a>                        <span class="p">)</span>
</span><span id="L-270"><a href="#-270"><span class="linenos"> 270</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="L-271"><a href="#-271"><span class="linenos"> 271</span></a>                        <span class="n">closure_depth_map</span> <span class="o">=</span> <span class="n">_flood_fill</span><span class="p">(</span>
</span><span id="L-272"><a href="#-272"><span class="linenos"> 272</span></a>                            <span class="n">top_structure_depth_map</span><span class="p">,</span> <span class="n">max_column_height</span><span class="o">=</span><span class="n">max_column</span>
</span><span id="L-273"><a href="#-273"><span class="linenos"> 273</span></a>                        <span class="p">)</span>
</span><span id="L-274"><a href="#-274"><span class="linenos"> 274</span></a>                    <span class="n">closure_depth_map</span><span class="p">[</span><span class="n">closure_depth_map</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">top_structure_depth_map</span><span class="p">[</span>
</span><span id="L-275"><a href="#-275"><span class="linenos"> 275</span></a>                        <span class="n">closure_depth_map</span> <span class="o">==</span> <span class="mi">0</span>
</span><span id="L-276"><a href="#-276"><span class="linenos"> 276</span></a>                    <span class="p">]</span>
</span><span id="L-277"><a href="#-277"><span class="linenos"> 277</span></a>                    <span class="n">closure_depth_map</span><span class="p">[</span><span class="n">closure_depth_map</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">top_structure_depth_map</span><span class="p">[</span>
</span><span id="L-278"><a href="#-278"><span class="linenos"> 278</span></a>                        <span class="n">closure_depth_map</span> <span class="o">==</span> <span class="mi">1</span>
</span><span id="L-279"><a href="#-279"><span class="linenos"> 279</span></a>                    <span class="p">]</span>
</span><span id="L-280"><a href="#-280"><span class="linenos"> 280</span></a>                    <span class="n">closure_depth_map</span><span class="p">[</span>
</span><span id="L-281"><a href="#-281"><span class="linenos"> 281</span></a>                        <span class="n">closure_depth_map</span> <span class="o">==</span> <span class="mf">1e5</span>
</span><span id="L-282"><a href="#-282"><span class="linenos"> 282</span></a>                    <span class="p">]</span> <span class="o">=</span> <span class="n">top_structure_depth_map</span><span class="p">[</span><span class="n">closure_depth_map</span> <span class="o">==</span> <span class="mf">1e5</span><span class="p">]</span>
</span><span id="L-283"><a href="#-283"><span class="linenos"> 283</span></a>                    <span class="c1"># Select the maximum value between the top sand map and the flood-filled closure map</span>
</span><span id="L-284"><a href="#-284"><span class="linenos"> 284</span></a>                    <span class="n">closure_depth_map</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span>
</span><span id="L-285"><a href="#-285"><span class="linenos"> 285</span></a>                        <span class="n">np</span><span class="o">.</span><span class="n">dstack</span><span class="p">((</span><span class="n">closure_depth_map</span><span class="p">,</span> <span class="n">top_structure_depth_map</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span>
</span><span id="L-286"><a href="#-286"><span class="linenos"> 286</span></a>                    <span class="p">)</span>
</span><span id="L-287"><a href="#-287"><span class="linenos"> 287</span></a>                    <span class="n">closure_depth_map</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span>
</span><span id="L-288"><a href="#-288"><span class="linenos"> 288</span></a>                        <span class="n">np</span><span class="o">.</span><span class="n">dstack</span><span class="p">((</span><span class="n">closure_depth_map</span><span class="p">,</span> <span class="n">base_structure_depth_map</span><span class="p">)),</span>
</span><span id="L-289"><a href="#-289"><span class="linenos"> 289</span></a>                        <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
</span><span id="L-290"><a href="#-290"><span class="linenos"> 290</span></a>                    <span class="p">)</span>
</span><span id="L-291"><a href="#-291"><span class="linenos"> 291</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="L-292"><a href="#-292"><span class="linenos"> 292</span></a>                        <span class="nb">print</span><span class="p">(</span>
</span><span id="L-293"><a href="#-293"><span class="linenos"> 293</span></a>                            <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">    ... layer </span><span class="si">{</span><span class="n">ihorizon</span><span class="si">}</span><span class="s2">,&quot;</span>
</span><span id="L-294"><a href="#-294"><span class="linenos"> 294</span></a>                            <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n\t</span><span class="s2">top structure map min, max </span><span class="si">{</span><span class="n">top_structure_depth_map</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">,&quot;</span>
</span><span id="L-295"><a href="#-295"><span class="linenos"> 295</span></a>                            <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">top_structure_depth_map</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="se">\n\t</span><span class="s2">closure_depth_map min, max&quot;</span>
</span><span id="L-296"><a href="#-296"><span class="linenos"> 296</span></a>                            <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">closure_depth_map</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">closure_depth_map</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-297"><a href="#-297"><span class="linenos"> 297</span></a>                        <span class="p">)</span>
</span><span id="L-298"><a href="#-298"><span class="linenos"> 298</span></a>                    <span class="n">closure_thickness</span> <span class="o">=</span> <span class="n">closure_depth_map</span> <span class="o">-</span> <span class="n">top_structure_depth_map</span>
</span><span id="L-299"><a href="#-299"><span class="linenos"> 299</span></a>                    <span class="n">closure_thickness_no_nan</span> <span class="o">=</span> <span class="n">closure_thickness</span><span class="p">[</span>
</span><span id="L-300"><a href="#-300"><span class="linenos"> 300</span></a>                        <span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">closure_thickness</span><span class="p">)</span>
</span><span id="L-301"><a href="#-301"><span class="linenos"> 301</span></a>                    <span class="p">]</span>
</span><span id="L-302"><a href="#-302"><span class="linenos"> 302</span></a>                    <span class="n">max_closure</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">closure_thickness_no_nan</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="mi">0</span><span class="p">))</span>
</span><span id="L-303"><a href="#-303"><span class="linenos"> 303</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="L-304"><a href="#-304"><span class="linenos"> 304</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    ... layer </span><span class="si">{</span><span class="n">ihorizon</span><span class="si">}</span><span class="s2">, max_closure </span><span class="si">{</span><span class="n">max_closure</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-305"><a href="#-305"><span class="linenos"> 305</span></a>
</span><span id="L-306"><a href="#-306"><span class="linenos"> 306</span></a>                    <span class="c1"># locate 3D zone in closure after checking that closures exist for this horizon</span>
</span><span id="L-307"><a href="#-307"><span class="linenos"> 307</span></a>                    <span class="c1"># if False in (top_structure_depth_map == closure_depth_map):</span>
</span><span id="L-308"><a href="#-308"><span class="linenos"> 308</span></a>                    <span class="k">if</span> <span class="n">max_closure</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-309"><a href="#-309"><span class="linenos"> 309</span></a>                        <span class="c1"># locate voxels anywhere in layer where top_structure_depth_map &lt; closure_depth_map</span>
</span><span id="L-310"><a href="#-310"><span class="linenos"> 310</span></a>                        <span class="c1"># put label in cube between top_structure_depth_map and closure_depth_map</span>
</span><span id="L-311"><a href="#-311"><span class="linenos"> 311</span></a>                        <span class="n">top_structure_depth_map_integer</span> <span class="o">=</span> <span class="n">top_structure_depth_map</span>
</span><span id="L-312"><a href="#-312"><span class="linenos"> 312</span></a>                        <span class="n">closure_depth_map_integer</span> <span class="o">=</span> <span class="n">closure_depth_map</span>
</span><span id="L-313"><a href="#-313"><span class="linenos"> 313</span></a>
</span><span id="L-314"><a href="#-314"><span class="linenos"> 314</span></a>                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="L-315"><a href="#-315"><span class="linenos"> 315</span></a>                            <span class="n">closure_map_min</span> <span class="o">=</span> <span class="n">closure_depth_map_integer</span><span class="p">[</span>
</span><span id="L-316"><a href="#-316"><span class="linenos"> 316</span></a>                                <span class="n">closure_depth_map_integer</span> <span class="o">&gt;</span> <span class="mf">0.1</span>
</span><span id="L-317"><a href="#-317"><span class="linenos"> 317</span></a>                            <span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
</span><span id="L-318"><a href="#-318"><span class="linenos"> 318</span></a>                            <span class="n">closure_map_max</span> <span class="o">=</span> <span class="n">closure_depth_map_integer</span><span class="p">[</span>
</span><span id="L-319"><a href="#-319"><span class="linenos"> 319</span></a>                                <span class="n">closure_depth_map_integer</span> <span class="o">&gt;</span> <span class="mf">0.1</span>
</span><span id="L-320"><a href="#-320"><span class="linenos"> 320</span></a>                            <span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</span><span id="L-321"><a href="#-321"><span class="linenos"> 321</span></a>                            <span class="nb">print</span><span class="p">(</span>
</span><span id="L-322"><a href="#-322"><span class="linenos"> 322</span></a>                                <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">... (2) layer: </span><span class="si">{</span><span class="n">ihorizon</span><span class="si">}</span><span class="s2">, max_closure; </span><span class="si">{</span><span class="n">max_closure</span><span class="si">}</span><span class="s2">, top structure map min, &quot;</span>
</span><span id="L-323"><a href="#-323"><span class="linenos"> 323</span></a>                                <span class="sa">f</span><span class="s2">&quot;max: </span><span class="si">{</span><span class="n">top_structure_depth_map</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">top_structure_depth_map_integer</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">}</span><span class="s2">,&quot;</span>
</span><span id="L-324"><a href="#-324"><span class="linenos"> 324</span></a>                                <span class="sa">f</span><span class="s2">&quot; closure map min, max: </span><span class="si">{</span><span class="n">closure_map_min</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">closure_map_max</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-325"><a href="#-325"><span class="linenos"> 325</span></a>                            <span class="p">)</span>
</span><span id="L-326"><a href="#-326"><span class="linenos"> 326</span></a>
</span><span id="L-327"><a href="#-327"><span class="linenos"> 327</span></a>                        <span class="n">slices_with_substitution</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-328"><a href="#-328"><span class="linenos"> 328</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    ... max_closure: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">max_closure</span><span class="p">))</span>
</span><span id="L-329"><a href="#-329"><span class="linenos"> 329</span></a>                        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span>
</span><span id="L-330"><a href="#-330"><span class="linenos"> 330</span></a>                            <span class="n">max_closure</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="L-331"><a href="#-331"><span class="linenos"> 331</span></a>                        <span class="p">):</span>  <span class="c1"># add one more sample than seemingly needed for round-off</span>
</span><span id="L-332"><a href="#-332"><span class="linenos"> 332</span></a>                            <span class="c1"># Subtract 2 from the closure cube shape since adding one later</span>
</span><span id="L-333"><a href="#-333"><span class="linenos"> 333</span></a>                            <span class="n">horizon_slice</span> <span class="o">=</span> <span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="n">top_structure_depth_map</span><span class="p">)</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span>
</span><span id="L-334"><a href="#-334"><span class="linenos"> 334</span></a>                                <span class="mi">0</span><span class="p">,</span> <span class="n">closure_segments</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="mi">2</span>
</span><span id="L-335"><a href="#-335"><span class="linenos"> 335</span></a>                            <span class="p">)</span>
</span><span id="L-336"><a href="#-336"><span class="linenos"> 336</span></a>                            <span class="n">sublayer_kk</span> <span class="o">=</span> <span class="n">horizon_slice</span><span class="p">[</span>
</span><span id="L-337"><a href="#-337"><span class="linenos"> 337</span></a>                                <span class="n">horizon_slice</span> <span class="o">&lt;</span> <span class="n">closure_depth_map</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;int&quot;</span><span class="p">)</span>
</span><span id="L-338"><a href="#-338"><span class="linenos"> 338</span></a>                            <span class="p">]</span>
</span><span id="L-339"><a href="#-339"><span class="linenos"> 339</span></a>                            <span class="n">sublayer_ii</span> <span class="o">=</span> <span class="n">ii</span><span class="p">[</span>
</span><span id="L-340"><a href="#-340"><span class="linenos"> 340</span></a>                                <span class="n">horizon_slice</span> <span class="o">&lt;</span> <span class="n">closure_depth_map</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;int&quot;</span><span class="p">)</span>
</span><span id="L-341"><a href="#-341"><span class="linenos"> 341</span></a>                            <span class="p">]</span>
</span><span id="L-342"><a href="#-342"><span class="linenos"> 342</span></a>                            <span class="n">sublayer_jj</span> <span class="o">=</span> <span class="n">jj</span><span class="p">[</span>
</span><span id="L-343"><a href="#-343"><span class="linenos"> 343</span></a>                                <span class="n">horizon_slice</span> <span class="o">&lt;</span> <span class="n">closure_depth_map</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;int&quot;</span><span class="p">)</span>
</span><span id="L-344"><a href="#-344"><span class="linenos"> 344</span></a>                            <span class="p">]</span>
</span><span id="L-345"><a href="#-345"><span class="linenos"> 345</span></a>
</span><span id="L-346"><a href="#-346"><span class="linenos"> 346</span></a>                            <span class="k">if</span> <span class="n">sublayer_ii</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-347"><a href="#-347"><span class="linenos"> 347</span></a>                                <span class="n">slices_with_substitution</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-348"><a href="#-348"><span class="linenos"> 348</span></a>
</span><span id="L-349"><a href="#-349"><span class="linenos"> 349</span></a>                                <span class="n">i_indices</span> <span class="o">=</span> <span class="n">sublayer_ii</span>
</span><span id="L-350"><a href="#-350"><span class="linenos"> 350</span></a>                                <span class="n">j_indices</span> <span class="o">=</span> <span class="n">sublayer_jj</span>
</span><span id="L-351"><a href="#-351"><span class="linenos"> 351</span></a>                                <span class="n">k_indices</span> <span class="o">=</span> <span class="n">sublayer_kk</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="L-352"><a href="#-352"><span class="linenos"> 352</span></a>
</span><span id="L-353"><a href="#-353"><span class="linenos"> 353</span></a>                                <span class="k">try</span><span class="p">:</span>
</span><span id="L-354"><a href="#-354"><span class="linenos"> 354</span></a>                                    <span class="n">closure_segments</span><span class="p">[</span>
</span><span id="L-355"><a href="#-355"><span class="linenos"> 355</span></a>                                        <span class="n">i_indices</span><span class="p">,</span> <span class="n">j_indices</span><span class="p">,</span> <span class="n">k_indices</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;int&quot;</span><span class="p">)</span>
</span><span id="L-356"><a href="#-356"><span class="linenos"> 356</span></a>                                    <span class="p">]</span> <span class="o">+=</span> <span class="mf">1.0</span>
</span><span id="L-357"><a href="#-357"><span class="linenos"> 357</span></a>                                    <span class="n">voxel_change_count</span><span class="p">[</span>
</span><span id="L-358"><a href="#-358"><span class="linenos"> 358</span></a>                                        <span class="n">i_indices</span><span class="p">,</span> <span class="n">j_indices</span><span class="p">,</span> <span class="n">k_indices</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;int&quot;</span><span class="p">)</span>
</span><span id="L-359"><a href="#-359"><span class="linenos"> 359</span></a>                                    <span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-360"><a href="#-360"><span class="linenos"> 360</span></a>                                <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
</span><span id="L-361"><a href="#-361"><span class="linenos"> 361</span></a>                                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Index is out of bounds.&quot;</span><span class="p">)</span>
</span><span id="L-362"><a href="#-362"><span class="linenos"> 362</span></a>                                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">closure_segments: </span><span class="si">{</span><span class="n">closure_segments</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-363"><a href="#-363"><span class="linenos"> 363</span></a>                                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">voxel_change_count: </span><span class="si">{</span><span class="n">voxel_change_count</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-364"><a href="#-364"><span class="linenos"> 364</span></a>                                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">i_indices: </span><span class="si">{</span><span class="n">i_indices</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-365"><a href="#-365"><span class="linenos"> 365</span></a>                                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">j_indices: </span><span class="si">{</span><span class="n">j_indices</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-366"><a href="#-366"><span class="linenos"> 366</span></a>                                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">k_indices: </span><span class="si">{</span><span class="n">k_indices</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;int&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-367"><a href="#-367"><span class="linenos"> 367</span></a>                                    <span class="k">pass</span>
</span><span id="L-368"><a href="#-368"><span class="linenos"> 368</span></a>
</span><span id="L-369"><a href="#-369"><span class="linenos"> 369</span></a>                        <span class="k">if</span> <span class="n">slices_with_substitution</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-370"><a href="#-370"><span class="linenos"> 370</span></a>                            <span class="n">layers_with_closure</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-371"><a href="#-371"><span class="linenos"> 371</span></a>
</span><span id="L-372"><a href="#-372"><span class="linenos"> 372</span></a>                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="L-373"><a href="#-373"><span class="linenos"> 373</span></a>                            <span class="nb">print</span><span class="p">(</span>
</span><span id="L-374"><a href="#-374"><span class="linenos"> 374</span></a>                                <span class="s2">&quot;    ... finished putting closures in closures_segments for layer ...&quot;</span><span class="p">,</span>
</span><span id="L-375"><a href="#-375"><span class="linenos"> 375</span></a>                                <span class="n">ihorizon</span><span class="p">,</span>
</span><span id="L-376"><a href="#-376"><span class="linenos"> 376</span></a>                            <span class="p">)</span>
</span><span id="L-377"><a href="#-377"><span class="linenos"> 377</span></a>
</span><span id="L-378"><a href="#-378"><span class="linenos"> 378</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="L-379"><a href="#-379"><span class="linenos"> 379</span></a>                        <span class="k">continue</span>
</span><span id="L-380"><a href="#-380"><span class="linenos"> 380</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-381"><a href="#-381"><span class="linenos"> 381</span></a>                <span class="c1"># Calculate shale unit thicknesses</span>
</span><span id="L-382"><a href="#-382"><span class="linenos"> 382</span></a>                <span class="n">avg_shale_thickness</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="L-383"><a href="#-383"><span class="linenos"> 383</span></a>                    <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span>
</span><span id="L-384"><a href="#-384"><span class="linenos"> 384</span></a>                        <span class="n">depth_maps_infilled</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">ihorizon</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="L-385"><a href="#-385"><span class="linenos"> 385</span></a>                        <span class="o">-</span> <span class="n">depth_maps_infilled</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">ihorizon</span><span class="p">]</span>
</span><span id="L-386"><a href="#-386"><span class="linenos"> 386</span></a>                    <span class="p">)</span>
</span><span id="L-387"><a href="#-387"><span class="linenos"> 387</span></a>                <span class="p">)</span>
</span><span id="L-388"><a href="#-388"><span class="linenos"> 388</span></a>
</span><span id="L-389"><a href="#-389"><span class="linenos"> 389</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">avg_sand_thickness</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-390"><a href="#-390"><span class="linenos"> 390</span></a>            <span class="n">avg_sand_thickness</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-391"><a href="#-391"><span class="linenos"> 391</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="L-392"><a href="#-392"><span class="linenos"> 392</span></a>            <span class="sa">f</span><span class="s2">&quot;Sand Unit Thickness (m): mean: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">avg_sand_thickness</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, &quot;</span>
</span><span id="L-393"><a href="#-393"><span class="linenos"> 393</span></a>            <span class="sa">f</span><span class="s2">&quot;std: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">avg_sand_thickness</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, min: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">avg_sand_thickness</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, &quot;</span>
</span><span id="L-394"><a href="#-394"><span class="linenos"> 394</span></a>            <span class="sa">f</span><span class="s2">&quot;max: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">avg_sand_thickness</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-395"><a href="#-395"><span class="linenos"> 395</span></a>        <span class="p">)</span>
</span><span id="L-396"><a href="#-396"><span class="linenos"> 396</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="L-397"><a href="#-397"><span class="linenos"> 397</span></a>            <span class="sa">f</span><span class="s2">&quot;Shale Unit Thickness (m): mean: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">avg_shale_thickness</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, &quot;</span>
</span><span id="L-398"><a href="#-398"><span class="linenos"> 398</span></a>            <span class="sa">f</span><span class="s2">&quot;std: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">avg_shale_thickness</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, min: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">avg_shale_thickness</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, &quot;</span>
</span><span id="L-399"><a href="#-399"><span class="linenos"> 399</span></a>            <span class="sa">f</span><span class="s2">&quot;max: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">avg_shale_thickness</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-400"><a href="#-400"><span class="linenos"> 400</span></a>        <span class="p">)</span>
</span><span id="L-401"><a href="#-401"><span class="linenos"> 401</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="L-402"><a href="#-402"><span class="linenos"> 402</span></a>            <span class="sa">f</span><span class="s2">&quot;Overall Unit Thickness (m): mean: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">avg_unit_thickness</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, &quot;</span>
</span><span id="L-403"><a href="#-403"><span class="linenos"> 403</span></a>            <span class="sa">f</span><span class="s2">&quot;std: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">avg_unit_thickness</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, min: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">avg_unit_thickness</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, &quot;</span>
</span><span id="L-404"><a href="#-404"><span class="linenos"> 404</span></a>            <span class="sa">f</span><span class="s2">&quot;max: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">avg_unit_thickness</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-405"><a href="#-405"><span class="linenos"> 405</span></a>        <span class="p">)</span>
</span><span id="L-406"><a href="#-406"><span class="linenos"> 406</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="L-407"><a href="#-407"><span class="linenos"> 407</span></a>            <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-408"><a href="#-408"><span class="linenos"> 408</span></a>            <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span>
</span><span id="L-409"><a href="#-409"><span class="linenos"> 409</span></a>            <span class="n">subkey</span><span class="o">=</span><span class="s2">&quot;sand_unit_thickness_combined_mean&quot;</span><span class="p">,</span>
</span><span id="L-410"><a href="#-410"><span class="linenos"> 410</span></a>            <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">avg_sand_thickness</span><span class="p">),</span>
</span><span id="L-411"><a href="#-411"><span class="linenos"> 411</span></a>        <span class="p">)</span>
</span><span id="L-412"><a href="#-412"><span class="linenos"> 412</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="L-413"><a href="#-413"><span class="linenos"> 413</span></a>            <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-414"><a href="#-414"><span class="linenos"> 414</span></a>            <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span>
</span><span id="L-415"><a href="#-415"><span class="linenos"> 415</span></a>            <span class="n">subkey</span><span class="o">=</span><span class="s2">&quot;sand_unit_thickness_combined_std&quot;</span><span class="p">,</span>
</span><span id="L-416"><a href="#-416"><span class="linenos"> 416</span></a>            <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">avg_sand_thickness</span><span class="p">),</span>
</span><span id="L-417"><a href="#-417"><span class="linenos"> 417</span></a>        <span class="p">)</span>
</span><span id="L-418"><a href="#-418"><span class="linenos"> 418</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="L-419"><a href="#-419"><span class="linenos"> 419</span></a>            <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-420"><a href="#-420"><span class="linenos"> 420</span></a>            <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span>
</span><span id="L-421"><a href="#-421"><span class="linenos"> 421</span></a>            <span class="n">subkey</span><span class="o">=</span><span class="s2">&quot;sand_unit_thickness_combined_min&quot;</span><span class="p">,</span>
</span><span id="L-422"><a href="#-422"><span class="linenos"> 422</span></a>            <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">avg_sand_thickness</span><span class="p">),</span>
</span><span id="L-423"><a href="#-423"><span class="linenos"> 423</span></a>        <span class="p">)</span>
</span><span id="L-424"><a href="#-424"><span class="linenos"> 424</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="L-425"><a href="#-425"><span class="linenos"> 425</span></a>            <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-426"><a href="#-426"><span class="linenos"> 426</span></a>            <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span>
</span><span id="L-427"><a href="#-427"><span class="linenos"> 427</span></a>            <span class="n">subkey</span><span class="o">=</span><span class="s2">&quot;sand_unit_thickness_combined_max&quot;</span><span class="p">,</span>
</span><span id="L-428"><a href="#-428"><span class="linenos"> 428</span></a>            <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">avg_sand_thickness</span><span class="p">),</span>
</span><span id="L-429"><a href="#-429"><span class="linenos"> 429</span></a>        <span class="p">)</span>
</span><span id="L-430"><a href="#-430"><span class="linenos"> 430</span></a>        <span class="c1">#</span>
</span><span id="L-431"><a href="#-431"><span class="linenos"> 431</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="L-432"><a href="#-432"><span class="linenos"> 432</span></a>            <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-433"><a href="#-433"><span class="linenos"> 433</span></a>            <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span>
</span><span id="L-434"><a href="#-434"><span class="linenos"> 434</span></a>            <span class="n">subkey</span><span class="o">=</span><span class="s2">&quot;shale_unit_thickness_combined_mean&quot;</span><span class="p">,</span>
</span><span id="L-435"><a href="#-435"><span class="linenos"> 435</span></a>            <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">avg_shale_thickness</span><span class="p">),</span>
</span><span id="L-436"><a href="#-436"><span class="linenos"> 436</span></a>        <span class="p">)</span>
</span><span id="L-437"><a href="#-437"><span class="linenos"> 437</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="L-438"><a href="#-438"><span class="linenos"> 438</span></a>            <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-439"><a href="#-439"><span class="linenos"> 439</span></a>            <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span>
</span><span id="L-440"><a href="#-440"><span class="linenos"> 440</span></a>            <span class="n">subkey</span><span class="o">=</span><span class="s2">&quot;shale_unit_thickness_combined_std&quot;</span><span class="p">,</span>
</span><span id="L-441"><a href="#-441"><span class="linenos"> 441</span></a>            <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">avg_shale_thickness</span><span class="p">),</span>
</span><span id="L-442"><a href="#-442"><span class="linenos"> 442</span></a>        <span class="p">)</span>
</span><span id="L-443"><a href="#-443"><span class="linenos"> 443</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="L-444"><a href="#-444"><span class="linenos"> 444</span></a>            <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-445"><a href="#-445"><span class="linenos"> 445</span></a>            <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span>
</span><span id="L-446"><a href="#-446"><span class="linenos"> 446</span></a>            <span class="n">subkey</span><span class="o">=</span><span class="s2">&quot;shale_unit_thickness_combined_min&quot;</span><span class="p">,</span>
</span><span id="L-447"><a href="#-447"><span class="linenos"> 447</span></a>            <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">avg_shale_thickness</span><span class="p">),</span>
</span><span id="L-448"><a href="#-448"><span class="linenos"> 448</span></a>        <span class="p">)</span>
</span><span id="L-449"><a href="#-449"><span class="linenos"> 449</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="L-450"><a href="#-450"><span class="linenos"> 450</span></a>            <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-451"><a href="#-451"><span class="linenos"> 451</span></a>            <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span>
</span><span id="L-452"><a href="#-452"><span class="linenos"> 452</span></a>            <span class="n">subkey</span><span class="o">=</span><span class="s2">&quot;shale_unit_thickness_combined_max&quot;</span><span class="p">,</span>
</span><span id="L-453"><a href="#-453"><span class="linenos"> 453</span></a>            <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">avg_shale_thickness</span><span class="p">),</span>
</span><span id="L-454"><a href="#-454"><span class="linenos"> 454</span></a>        <span class="p">)</span>
</span><span id="L-455"><a href="#-455"><span class="linenos"> 455</span></a>
</span><span id="L-456"><a href="#-456"><span class="linenos"> 456</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="L-457"><a href="#-457"><span class="linenos"> 457</span></a>            <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-458"><a href="#-458"><span class="linenos"> 458</span></a>            <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span>
</span><span id="L-459"><a href="#-459"><span class="linenos"> 459</span></a>            <span class="n">subkey</span><span class="o">=</span><span class="s2">&quot;overall_unit_thickness_combined_mean&quot;</span><span class="p">,</span>
</span><span id="L-460"><a href="#-460"><span class="linenos"> 460</span></a>            <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">avg_unit_thickness</span><span class="p">),</span>
</span><span id="L-461"><a href="#-461"><span class="linenos"> 461</span></a>        <span class="p">)</span>
</span><span id="L-462"><a href="#-462"><span class="linenos"> 462</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="L-463"><a href="#-463"><span class="linenos"> 463</span></a>            <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-464"><a href="#-464"><span class="linenos"> 464</span></a>            <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span>
</span><span id="L-465"><a href="#-465"><span class="linenos"> 465</span></a>            <span class="n">subkey</span><span class="o">=</span><span class="s2">&quot;overall_unit_thickness_combined_std&quot;</span><span class="p">,</span>
</span><span id="L-466"><a href="#-466"><span class="linenos"> 466</span></a>            <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">avg_unit_thickness</span><span class="p">),</span>
</span><span id="L-467"><a href="#-467"><span class="linenos"> 467</span></a>        <span class="p">)</span>
</span><span id="L-468"><a href="#-468"><span class="linenos"> 468</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="L-469"><a href="#-469"><span class="linenos"> 469</span></a>            <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-470"><a href="#-470"><span class="linenos"> 470</span></a>            <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span>
</span><span id="L-471"><a href="#-471"><span class="linenos"> 471</span></a>            <span class="n">subkey</span><span class="o">=</span><span class="s2">&quot;overall_unit_thickness_combined_min&quot;</span><span class="p">,</span>
</span><span id="L-472"><a href="#-472"><span class="linenos"> 472</span></a>            <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">avg_unit_thickness</span><span class="p">),</span>
</span><span id="L-473"><a href="#-473"><span class="linenos"> 473</span></a>        <span class="p">)</span>
</span><span id="L-474"><a href="#-474"><span class="linenos"> 474</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="L-475"><a href="#-475"><span class="linenos"> 475</span></a>            <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-476"><a href="#-476"><span class="linenos"> 476</span></a>            <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span>
</span><span id="L-477"><a href="#-477"><span class="linenos"> 477</span></a>            <span class="n">subkey</span><span class="o">=</span><span class="s2">&quot;overall_unit_thickness_combined_max&quot;</span><span class="p">,</span>
</span><span id="L-478"><a href="#-478"><span class="linenos"> 478</span></a>            <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">avg_unit_thickness</span><span class="p">),</span>
</span><span id="L-479"><a href="#-479"><span class="linenos"> 479</span></a>        <span class="p">)</span>
</span><span id="L-480"><a href="#-480"><span class="linenos"> 480</span></a>
</span><span id="L-481"><a href="#-481"><span class="linenos"> 481</span></a>        <span class="n">non_zero_pixels</span> <span class="o">=</span> <span class="n">closure_segments</span><span class="p">[</span><span class="n">closure_segments</span> <span class="o">!=</span> <span class="mf">0.0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-482"><a href="#-482"><span class="linenos"> 482</span></a>        <span class="n">pct_non_zero</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">non_zero_pixels</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span>
</span><span id="L-483"><a href="#-483"><span class="linenos"> 483</span></a>            <span class="n">closure_segments</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-484"><a href="#-484"><span class="linenos"> 484</span></a>            <span class="o">*</span> <span class="n">closure_segments</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-485"><a href="#-485"><span class="linenos"> 485</span></a>            <span class="o">*</span> <span class="n">closure_segments</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
</span><span id="L-486"><a href="#-486"><span class="linenos"> 486</span></a>        <span class="p">)</span>
</span><span id="L-487"><a href="#-487"><span class="linenos"> 487</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="L-488"><a href="#-488"><span class="linenos"> 488</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="L-489"><a href="#-489"><span class="linenos"> 489</span></a>                <span class="s2">&quot;    ...closure_segments min </span><span class="si">{}</span><span class="s2">, mean </span><span class="si">{}</span><span class="s2">, max </span><span class="si">{}</span><span class="s2">, % non-zero </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="L-490"><a href="#-490"><span class="linenos"> 490</span></a>                    <span class="n">closure_segments</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
</span><span id="L-491"><a href="#-491"><span class="linenos"> 491</span></a>                    <span class="n">closure_segments</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span>
</span><span id="L-492"><a href="#-492"><span class="linenos"> 492</span></a>                    <span class="n">closure_segments</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span>
</span><span id="L-493"><a href="#-493"><span class="linenos"> 493</span></a>                    <span class="n">pct_non_zero</span><span class="p">,</span>
</span><span id="L-494"><a href="#-494"><span class="linenos"> 494</span></a>                <span class="p">)</span>
</span><span id="L-495"><a href="#-495"><span class="linenos"> 495</span></a>            <span class="p">)</span>
</span><span id="L-496"><a href="#-496"><span class="linenos"> 496</span></a>
</span><span id="L-497"><a href="#-497"><span class="linenos"> 497</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">... layers_with_closure </span><span class="si">{</span><span class="n">layers_with_closure</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-498"><a href="#-498"><span class="linenos"> 498</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">... finished putting closures in closure_segments ...</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-499"><a href="#-499"><span class="linenos"> 499</span></a>
</span><span id="L-500"><a href="#-500"><span class="linenos"> 500</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="L-501"><a href="#-501"><span class="linenos"> 501</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="L-502"><a href="#-502"><span class="linenos"> 502</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">   ...closure segments created. min: </span><span class="si">{</span><span class="n">closure_segments</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="si">}</span><span class="s2">, &quot;</span>
</span><span id="L-503"><a href="#-503"><span class="linenos"> 503</span></a>                <span class="sa">f</span><span class="s2">&quot;mean: </span><span class="si">{</span><span class="n">closure_segments</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, max: </span><span class="si">{</span><span class="n">closure_segments</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-504"><a href="#-504"><span class="linenos"> 504</span></a>                <span class="sa">f</span><span class="s2">&quot; voxel count: </span><span class="si">{</span><span class="n">closure_segments</span><span class="p">[</span><span class="n">closure_segments</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-505"><a href="#-505"><span class="linenos"> 505</span></a>            <span class="p">)</span>
</span><span id="L-506"><a href="#-506"><span class="linenos"> 506</span></a>
</span><span id="L-507"><a href="#-507"><span class="linenos"> 507</span></a>        <span class="k">return</span> <span class="n">closure_segments</span>
</span><span id="L-508"><a href="#-508"><span class="linenos"> 508</span></a>
</span><span id="L-509"><a href="#-509"><span class="linenos"> 509</span></a>    <span class="k">def</span> <span class="nf">create_closure_labels_from_all_depth_maps</span><span class="p">(</span>
</span><span id="L-510"><a href="#-510"><span class="linenos"> 510</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">depth_maps</span><span class="p">,</span> <span class="n">depth_maps_infilled</span><span class="p">,</span> <span class="n">max_col_height</span>
</span><span id="L-511"><a href="#-511"><span class="linenos"> 511</span></a>    <span class="p">):</span>
</span><span id="L-512"><a href="#-512"><span class="linenos"> 512</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="L-513"><a href="#-513"><span class="linenos"> 513</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\t</span><span class="s2">... inside insertClosureLabels3D &quot;</span><span class="p">)</span>
</span><span id="L-514"><a href="#-514"><span class="linenos"> 514</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="L-515"><a href="#-515"><span class="linenos"> 515</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">... depth_maps min </span><span class="si">{</span><span class="n">depth_maps</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, mean </span><span class="si">{</span><span class="n">depth_maps</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">,&quot;</span>
</span><span id="L-516"><a href="#-516"><span class="linenos"> 516</span></a>                <span class="sa">f</span><span class="s2">&quot; max </span><span class="si">{</span><span class="n">depth_maps</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, cube_shape </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-517"><a href="#-517"><span class="linenos"> 517</span></a>            <span class="p">)</span>
</span><span id="L-518"><a href="#-518"><span class="linenos"> 518</span></a>
</span><span id="L-519"><a href="#-519"><span class="linenos"> 519</span></a>        <span class="c1"># create 3D cube to hold segmentation results</span>
</span><span id="L-520"><a href="#-520"><span class="linenos"> 520</span></a>        <span class="n">closure_segments</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">faulted_lithology</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="s2">&quot;float32&quot;</span><span class="p">)</span>
</span><span id="L-521"><a href="#-521"><span class="linenos"> 521</span></a>
</span><span id="L-522"><a href="#-522"><span class="linenos"> 522</span></a>        <span class="c1"># create grids with grid indices</span>
</span><span id="L-523"><a href="#-523"><span class="linenos"> 523</span></a>        <span class="n">ii</span><span class="p">,</span> <span class="n">jj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">build_meshgrid</span><span class="p">()</span>
</span><span id="L-524"><a href="#-524"><span class="linenos"> 524</span></a>
</span><span id="L-525"><a href="#-525"><span class="linenos"> 525</span></a>        <span class="c1"># loop through horizons in &#39;depth_maps&#39;</span>
</span><span id="L-526"><a href="#-526"><span class="linenos"> 526</span></a>        <span class="n">voxel_change_count</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
</span><span id="L-527"><a href="#-527"><span class="linenos"> 527</span></a>        <span class="n">layers_with_closure</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-528"><a href="#-528"><span class="linenos"> 528</span></a>
</span><span id="L-529"><a href="#-529"><span class="linenos"> 529</span></a>        <span class="n">avg_sand_thickness</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
</span><span id="L-530"><a href="#-530"><span class="linenos"> 530</span></a>        <span class="n">avg_shale_thickness</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
</span><span id="L-531"><a href="#-531"><span class="linenos"> 531</span></a>        <span class="n">avg_unit_thickness</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
</span><span id="L-532"><a href="#-532"><span class="linenos"> 532</span></a>        <span class="k">for</span> <span class="n">ihorizon</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">depth_maps</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="L-533"><a href="#-533"><span class="linenos"> 533</span></a>            <span class="n">avg_unit_thickness</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="L-534"><a href="#-534"><span class="linenos"> 534</span></a>                <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span>
</span><span id="L-535"><a href="#-535"><span class="linenos"> 535</span></a>                    <span class="n">depth_maps_infilled</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">ihorizon</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="L-536"><a href="#-536"><span class="linenos"> 536</span></a>                    <span class="o">-</span> <span class="n">depth_maps_infilled</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">ihorizon</span><span class="p">]</span>
</span><span id="L-537"><a href="#-537"><span class="linenos"> 537</span></a>                <span class="p">)</span>
</span><span id="L-538"><a href="#-538"><span class="linenos"> 538</span></a>            <span class="p">)</span>
</span><span id="L-539"><a href="#-539"><span class="linenos"> 539</span></a>            <span class="c1"># calculate a closure map for the layer</span>
</span><span id="L-540"><a href="#-540"><span class="linenos"> 540</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="L-541"><a href="#-541"><span class="linenos"> 541</span></a>                <span class="nb">print</span><span class="p">(</span>
</span><span id="L-542"><a href="#-542"><span class="linenos"> 542</span></a>                    <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">...closure voxels computation for layer </span><span class="si">{</span><span class="n">ihorizon</span><span class="si">}</span><span class="s2"> in horizon list.&quot;</span>
</span><span id="L-543"><a href="#-543"><span class="linenos"> 543</span></a>                <span class="p">)</span>
</span><span id="L-544"><a href="#-544"><span class="linenos"> 544</span></a>
</span><span id="L-545"><a href="#-545"><span class="linenos"> 545</span></a>            <span class="c1"># compute a closure map</span>
</span><span id="L-546"><a href="#-546"><span class="linenos"> 546</span></a>            <span class="c1"># - identical to top structure map when not in closure, &#39;max flooding&#39; depth when in closure</span>
</span><span id="L-547"><a href="#-547"><span class="linenos"> 547</span></a>            <span class="c1"># - use thicknesses converted to samples instead of ft or ms</span>
</span><span id="L-548"><a href="#-548"><span class="linenos"> 548</span></a>            <span class="c1"># - assumes that fault intersections are inserted in input map with value of 0.</span>
</span><span id="L-549"><a href="#-549"><span class="linenos"> 549</span></a>            <span class="c1"># - assumes that input map values represent depth (i.e., bigger values are deeper)</span>
</span><span id="L-550"><a href="#-550"><span class="linenos"> 550</span></a>            <span class="n">top_structure_depth_map</span> <span class="o">=</span> <span class="n">depth_maps</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">ihorizon</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-551"><a href="#-551"><span class="linenos"> 551</span></a>            <span class="n">top_structure_depth_map</span><span class="p">[</span>
</span><span id="L-552"><a href="#-552"><span class="linenos"> 552</span></a>                <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">top_structure_depth_map</span><span class="p">)</span>
</span><span id="L-553"><a href="#-553"><span class="linenos"> 553</span></a>            <span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>  <span class="c1"># replace nans with 0.</span>
</span><span id="L-554"><a href="#-554"><span class="linenos"> 554</span></a>            <span class="n">top_structure_depth_map</span> <span class="o">/=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">digi</span><span class="p">)</span>
</span><span id="L-555"><a href="#-555"><span class="linenos"> 555</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">partial_voxels</span><span class="p">:</span>
</span><span id="L-556"><a href="#-556"><span class="linenos"> 556</span></a>                <span class="n">top_structure_depth_map</span> <span class="o">-=</span> <span class="mf">1.0</span>  <span class="c1"># account for voxels partially in layer</span>
</span><span id="L-557"><a href="#-557"><span class="linenos"> 557</span></a>            <span class="n">base_structure_depth_map</span> <span class="o">=</span> <span class="n">depth_maps_infilled</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">ihorizon</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-558"><a href="#-558"><span class="linenos"> 558</span></a>            <span class="n">base_structure_depth_map</span><span class="p">[</span>
</span><span id="L-559"><a href="#-559"><span class="linenos"> 559</span></a>                <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">top_structure_depth_map</span><span class="p">)</span>
</span><span id="L-560"><a href="#-560"><span class="linenos"> 560</span></a>            <span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>  <span class="c1"># replace nans with 0.</span>
</span><span id="L-561"><a href="#-561"><span class="linenos"> 561</span></a>            <span class="n">base_structure_depth_map</span> <span class="o">/=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">digi</span><span class="p">)</span>
</span><span id="L-562"><a href="#-562"><span class="linenos"> 562</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="L-563"><a href="#-563"><span class="linenos"> 563</span></a>                <span class="s2">&quot; ...inside create_closure_labels_from_depth_maps... ihorizon = &quot;</span><span class="p">,</span>
</span><span id="L-564"><a href="#-564"><span class="linenos"> 564</span></a>                <span class="n">ihorizon</span><span class="p">,</span>
</span><span id="L-565"><a href="#-565"><span class="linenos"> 565</span></a>            <span class="p">)</span>
</span><span id="L-566"><a href="#-566"><span class="linenos"> 566</span></a>            <span class="c1"># if there is non-zero thickness between top/base closure</span>
</span><span id="L-567"><a href="#-567"><span class="linenos"> 567</span></a>            <span class="k">if</span> <span class="n">top_structure_depth_map</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">!=</span> <span class="n">top_structure_depth_map</span><span class="o">.</span><span class="n">max</span><span class="p">():</span>
</span><span id="L-568"><a href="#-568"><span class="linenos"> 568</span></a>                <span class="n">max_column</span> <span class="o">=</span> <span class="n">max_col_height</span><span class="p">[</span><span class="n">ihorizon</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">digi</span>
</span><span id="L-569"><a href="#-569"><span class="linenos"> 569</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="L-570"><a href="#-570"><span class="linenos"> 570</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="L-571"><a href="#-571"><span class="linenos"> 571</span></a>                        <span class="sa">f</span><span class="s2">&quot;   ...avg depth for layer </span><span class="si">{</span><span class="n">ihorizon</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">,</span>
</span><span id="L-572"><a href="#-572"><span class="linenos"> 572</span></a>                        <span class="n">top_structure_depth_map</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span>
</span><span id="L-573"><a href="#-573"><span class="linenos"> 573</span></a>                    <span class="p">)</span>
</span><span id="L-574"><a href="#-574"><span class="linenos"> 574</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="L-575"><a href="#-575"><span class="linenos"> 575</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="L-576"><a href="#-576"><span class="linenos"> 576</span></a>                        <span class="sa">f</span><span class="s2">&quot;   ...maximum column height for layer </span><span class="si">{</span><span class="n">ihorizon</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">,</span> <span class="n">max_column</span>
</span><span id="L-577"><a href="#-577"><span class="linenos"> 577</span></a>                    <span class="p">)</span>
</span><span id="L-578"><a href="#-578"><span class="linenos"> 578</span></a>
</span><span id="L-579"><a href="#-579"><span class="linenos"> 579</span></a>                <span class="k">if</span> <span class="n">ihorizon</span> <span class="o">==</span> <span class="mi">27000</span> <span class="ow">or</span> <span class="n">ihorizon</span> <span class="o">==</span> <span class="mi">1000</span><span class="p">:</span>
</span><span id="L-580"><a href="#-580"><span class="linenos"> 580</span></a>                    <span class="n">closure_depth_map</span> <span class="o">=</span> <span class="n">_flood_fill</span><span class="p">(</span>
</span><span id="L-581"><a href="#-581"><span class="linenos"> 581</span></a>                        <span class="n">top_structure_depth_map</span><span class="p">,</span>
</span><span id="L-582"><a href="#-582"><span class="linenos"> 582</span></a>                        <span class="n">max_column_height</span><span class="o">=</span><span class="n">max_column</span><span class="p">,</span>
</span><span id="L-583"><a href="#-583"><span class="linenos"> 583</span></a>                        <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-584"><a href="#-584"><span class="linenos"> 584</span></a>                        <span class="n">debug</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-585"><a href="#-585"><span class="linenos"> 585</span></a>                    <span class="p">)</span>
</span><span id="L-586"><a href="#-586"><span class="linenos"> 586</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-587"><a href="#-587"><span class="linenos"> 587</span></a>                    <span class="n">closure_depth_map</span> <span class="o">=</span> <span class="n">_flood_fill</span><span class="p">(</span>
</span><span id="L-588"><a href="#-588"><span class="linenos"> 588</span></a>                        <span class="n">top_structure_depth_map</span><span class="p">,</span> <span class="n">max_column_height</span><span class="o">=</span><span class="n">max_column</span>
</span><span id="L-589"><a href="#-589"><span class="linenos"> 589</span></a>                    <span class="p">)</span>
</span><span id="L-590"><a href="#-590"><span class="linenos"> 590</span></a>                <span class="n">closure_depth_map</span><span class="p">[</span><span class="n">closure_depth_map</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">top_structure_depth_map</span><span class="p">[</span>
</span><span id="L-591"><a href="#-591"><span class="linenos"> 591</span></a>                    <span class="n">closure_depth_map</span> <span class="o">==</span> <span class="mi">0</span>
</span><span id="L-592"><a href="#-592"><span class="linenos"> 592</span></a>                <span class="p">]</span>
</span><span id="L-593"><a href="#-593"><span class="linenos"> 593</span></a>                <span class="n">closure_depth_map</span><span class="p">[</span><span class="n">closure_depth_map</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">top_structure_depth_map</span><span class="p">[</span>
</span><span id="L-594"><a href="#-594"><span class="linenos"> 594</span></a>                    <span class="n">closure_depth_map</span> <span class="o">==</span> <span class="mi">1</span>
</span><span id="L-595"><a href="#-595"><span class="linenos"> 595</span></a>                <span class="p">]</span>
</span><span id="L-596"><a href="#-596"><span class="linenos"> 596</span></a>                <span class="n">closure_depth_map</span><span class="p">[</span><span class="n">closure_depth_map</span> <span class="o">==</span> <span class="mf">1e5</span><span class="p">]</span> <span class="o">=</span> <span class="n">top_structure_depth_map</span><span class="p">[</span>
</span><span id="L-597"><a href="#-597"><span class="linenos"> 597</span></a>                    <span class="n">closure_depth_map</span> <span class="o">==</span> <span class="mf">1e5</span>
</span><span id="L-598"><a href="#-598"><span class="linenos"> 598</span></a>                <span class="p">]</span>
</span><span id="L-599"><a href="#-599"><span class="linenos"> 599</span></a>                <span class="c1"># Select the maximum value between the top sand map and the flood-filled closure map</span>
</span><span id="L-600"><a href="#-600"><span class="linenos"> 600</span></a>                <span class="n">closure_depth_map</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span>
</span><span id="L-601"><a href="#-601"><span class="linenos"> 601</span></a>                    <span class="n">np</span><span class="o">.</span><span class="n">dstack</span><span class="p">((</span><span class="n">closure_depth_map</span><span class="p">,</span> <span class="n">top_structure_depth_map</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span>
</span><span id="L-602"><a href="#-602"><span class="linenos"> 602</span></a>                <span class="p">)</span>
</span><span id="L-603"><a href="#-603"><span class="linenos"> 603</span></a>                <span class="n">closure_depth_map</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span>
</span><span id="L-604"><a href="#-604"><span class="linenos"> 604</span></a>                    <span class="n">np</span><span class="o">.</span><span class="n">dstack</span><span class="p">((</span><span class="n">closure_depth_map</span><span class="p">,</span> <span class="n">base_structure_depth_map</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span>
</span><span id="L-605"><a href="#-605"><span class="linenos"> 605</span></a>                <span class="p">)</span>
</span><span id="L-606"><a href="#-606"><span class="linenos"> 606</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="L-607"><a href="#-607"><span class="linenos"> 607</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="L-608"><a href="#-608"><span class="linenos"> 608</span></a>                        <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">    ... layer </span><span class="si">{</span><span class="n">ihorizon</span><span class="si">}</span><span class="s2">,&quot;</span>
</span><span id="L-609"><a href="#-609"><span class="linenos"> 609</span></a>                        <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n\t</span><span class="s2">top structure map min, max </span><span class="si">{</span><span class="n">top_structure_depth_map</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">,&quot;</span>
</span><span id="L-610"><a href="#-610"><span class="linenos"> 610</span></a>                        <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">top_structure_depth_map</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="se">\n\t</span><span class="s2">closure_depth_map min, max&quot;</span>
</span><span id="L-611"><a href="#-611"><span class="linenos"> 611</span></a>                        <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">closure_depth_map</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">closure_depth_map</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-612"><a href="#-612"><span class="linenos"> 612</span></a>                    <span class="p">)</span>
</span><span id="L-613"><a href="#-613"><span class="linenos"> 613</span></a>                <span class="n">closure_thickness</span> <span class="o">=</span> <span class="n">closure_depth_map</span> <span class="o">-</span> <span class="n">top_structure_depth_map</span>
</span><span id="L-614"><a href="#-614"><span class="linenos"> 614</span></a>                <span class="n">closure_thickness_no_nan</span> <span class="o">=</span> <span class="n">closure_thickness</span><span class="p">[</span>
</span><span id="L-615"><a href="#-615"><span class="linenos"> 615</span></a>                    <span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">closure_thickness</span><span class="p">)</span>
</span><span id="L-616"><a href="#-616"><span class="linenos"> 616</span></a>                <span class="p">]</span>
</span><span id="L-617"><a href="#-617"><span class="linenos"> 617</span></a>                <span class="n">max_closure</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">closure_thickness_no_nan</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="mi">0</span><span class="p">))</span>
</span><span id="L-618"><a href="#-618"><span class="linenos"> 618</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="L-619"><a href="#-619"><span class="linenos"> 619</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    ... layer </span><span class="si">{</span><span class="n">ihorizon</span><span class="si">}</span><span class="s2">, max_closure </span><span class="si">{</span><span class="n">max_closure</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-620"><a href="#-620"><span class="linenos"> 620</span></a>
</span><span id="L-621"><a href="#-621"><span class="linenos"> 621</span></a>                <span class="c1"># locate 3D zone in closure after checking that closures exist for this horizon</span>
</span><span id="L-622"><a href="#-622"><span class="linenos"> 622</span></a>                <span class="c1"># if False in (top_structure_depth_map == closure_depth_map):</span>
</span><span id="L-623"><a href="#-623"><span class="linenos"> 623</span></a>                <span class="k">if</span> <span class="n">max_closure</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-624"><a href="#-624"><span class="linenos"> 624</span></a>                    <span class="c1"># locate voxels anywhere in layer where top_structure_depth_map &lt; closure_depth_map</span>
</span><span id="L-625"><a href="#-625"><span class="linenos"> 625</span></a>                    <span class="c1"># put label in cube between top_structure_depth_map and closure_depth_map</span>
</span><span id="L-626"><a href="#-626"><span class="linenos"> 626</span></a>                    <span class="n">top_structure_depth_map_integer</span> <span class="o">=</span> <span class="n">top_structure_depth_map</span>
</span><span id="L-627"><a href="#-627"><span class="linenos"> 627</span></a>                    <span class="n">closure_depth_map_integer</span> <span class="o">=</span> <span class="n">closure_depth_map</span>
</span><span id="L-628"><a href="#-628"><span class="linenos"> 628</span></a>
</span><span id="L-629"><a href="#-629"><span class="linenos"> 629</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="L-630"><a href="#-630"><span class="linenos"> 630</span></a>                        <span class="n">closure_map_min</span> <span class="o">=</span> <span class="n">closure_depth_map_integer</span><span class="p">[</span>
</span><span id="L-631"><a href="#-631"><span class="linenos"> 631</span></a>                            <span class="n">closure_depth_map_integer</span> <span class="o">&gt;</span> <span class="mf">0.1</span>
</span><span id="L-632"><a href="#-632"><span class="linenos"> 632</span></a>                        <span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
</span><span id="L-633"><a href="#-633"><span class="linenos"> 633</span></a>                        <span class="n">closure_map_max</span> <span class="o">=</span> <span class="n">closure_depth_map_integer</span><span class="p">[</span>
</span><span id="L-634"><a href="#-634"><span class="linenos"> 634</span></a>                            <span class="n">closure_depth_map_integer</span> <span class="o">&gt;</span> <span class="mf">0.1</span>
</span><span id="L-635"><a href="#-635"><span class="linenos"> 635</span></a>                        <span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</span><span id="L-636"><a href="#-636"><span class="linenos"> 636</span></a>                        <span class="nb">print</span><span class="p">(</span>
</span><span id="L-637"><a href="#-637"><span class="linenos"> 637</span></a>                            <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">... (2) layer: </span><span class="si">{</span><span class="n">ihorizon</span><span class="si">}</span><span class="s2">, max_closure; </span><span class="si">{</span><span class="n">max_closure</span><span class="si">}</span><span class="s2">, top structure map min, &quot;</span>
</span><span id="L-638"><a href="#-638"><span class="linenos"> 638</span></a>                            <span class="sa">f</span><span class="s2">&quot;max: </span><span class="si">{</span><span class="n">top_structure_depth_map</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">top_structure_depth_map_integer</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">}</span><span class="s2">,&quot;</span>
</span><span id="L-639"><a href="#-639"><span class="linenos"> 639</span></a>                            <span class="sa">f</span><span class="s2">&quot; closure map min, max: </span><span class="si">{</span><span class="n">closure_map_min</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">closure_map_max</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-640"><a href="#-640"><span class="linenos"> 640</span></a>                        <span class="p">)</span>
</span><span id="L-641"><a href="#-641"><span class="linenos"> 641</span></a>
</span><span id="L-642"><a href="#-642"><span class="linenos"> 642</span></a>                    <span class="n">slices_with_substitution</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-643"><a href="#-643"><span class="linenos"> 643</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    ... max_closure: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">max_closure</span><span class="p">))</span>
</span><span id="L-644"><a href="#-644"><span class="linenos"> 644</span></a>                    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span>
</span><span id="L-645"><a href="#-645"><span class="linenos"> 645</span></a>                        <span class="n">max_closure</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="L-646"><a href="#-646"><span class="linenos"> 646</span></a>                    <span class="p">):</span>  <span class="c1"># add one more sample than seemingly needed for round-off</span>
</span><span id="L-647"><a href="#-647"><span class="linenos"> 647</span></a>                        <span class="c1"># Subtract 2 from the closure cube shape since adding one later</span>
</span><span id="L-648"><a href="#-648"><span class="linenos"> 648</span></a>                        <span class="n">horizon_slice</span> <span class="o">=</span> <span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="n">top_structure_depth_map</span><span class="p">)</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span>
</span><span id="L-649"><a href="#-649"><span class="linenos"> 649</span></a>                            <span class="mi">0</span><span class="p">,</span> <span class="n">closure_segments</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="mi">2</span>
</span><span id="L-650"><a href="#-650"><span class="linenos"> 650</span></a>                        <span class="p">)</span>
</span><span id="L-651"><a href="#-651"><span class="linenos"> 651</span></a>                        <span class="n">sublayer_kk</span> <span class="o">=</span> <span class="n">horizon_slice</span><span class="p">[</span>
</span><span id="L-652"><a href="#-652"><span class="linenos"> 652</span></a>                            <span class="n">horizon_slice</span> <span class="o">&lt;</span> <span class="n">closure_depth_map</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;int&quot;</span><span class="p">)</span>
</span><span id="L-653"><a href="#-653"><span class="linenos"> 653</span></a>                        <span class="p">]</span>
</span><span id="L-654"><a href="#-654"><span class="linenos"> 654</span></a>                        <span class="n">sublayer_ii</span> <span class="o">=</span> <span class="n">ii</span><span class="p">[</span>
</span><span id="L-655"><a href="#-655"><span class="linenos"> 655</span></a>                            <span class="n">horizon_slice</span> <span class="o">&lt;</span> <span class="n">closure_depth_map</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;int&quot;</span><span class="p">)</span>
</span><span id="L-656"><a href="#-656"><span class="linenos"> 656</span></a>                        <span class="p">]</span>
</span><span id="L-657"><a href="#-657"><span class="linenos"> 657</span></a>                        <span class="n">sublayer_jj</span> <span class="o">=</span> <span class="n">jj</span><span class="p">[</span>
</span><span id="L-658"><a href="#-658"><span class="linenos"> 658</span></a>                            <span class="n">horizon_slice</span> <span class="o">&lt;</span> <span class="n">closure_depth_map</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;int&quot;</span><span class="p">)</span>
</span><span id="L-659"><a href="#-659"><span class="linenos"> 659</span></a>                        <span class="p">]</span>
</span><span id="L-660"><a href="#-660"><span class="linenos"> 660</span></a>
</span><span id="L-661"><a href="#-661"><span class="linenos"> 661</span></a>                        <span class="k">if</span> <span class="n">sublayer_ii</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-662"><a href="#-662"><span class="linenos"> 662</span></a>                            <span class="n">slices_with_substitution</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-663"><a href="#-663"><span class="linenos"> 663</span></a>
</span><span id="L-664"><a href="#-664"><span class="linenos"> 664</span></a>                            <span class="n">i_indices</span> <span class="o">=</span> <span class="n">sublayer_ii</span>
</span><span id="L-665"><a href="#-665"><span class="linenos"> 665</span></a>                            <span class="n">j_indices</span> <span class="o">=</span> <span class="n">sublayer_jj</span>
</span><span id="L-666"><a href="#-666"><span class="linenos"> 666</span></a>                            <span class="n">k_indices</span> <span class="o">=</span> <span class="n">sublayer_kk</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="L-667"><a href="#-667"><span class="linenos"> 667</span></a>
</span><span id="L-668"><a href="#-668"><span class="linenos"> 668</span></a>                            <span class="k">try</span><span class="p">:</span>
</span><span id="L-669"><a href="#-669"><span class="linenos"> 669</span></a>                                <span class="n">closure_segments</span><span class="p">[</span>
</span><span id="L-670"><a href="#-670"><span class="linenos"> 670</span></a>                                    <span class="n">i_indices</span><span class="p">,</span> <span class="n">j_indices</span><span class="p">,</span> <span class="n">k_indices</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;int&quot;</span><span class="p">)</span>
</span><span id="L-671"><a href="#-671"><span class="linenos"> 671</span></a>                                <span class="p">]</span> <span class="o">+=</span> <span class="mf">1.0</span>
</span><span id="L-672"><a href="#-672"><span class="linenos"> 672</span></a>                                <span class="n">voxel_change_count</span><span class="p">[</span>
</span><span id="L-673"><a href="#-673"><span class="linenos"> 673</span></a>                                    <span class="n">i_indices</span><span class="p">,</span> <span class="n">j_indices</span><span class="p">,</span> <span class="n">k_indices</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;int&quot;</span><span class="p">)</span>
</span><span id="L-674"><a href="#-674"><span class="linenos"> 674</span></a>                                <span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-675"><a href="#-675"><span class="linenos"> 675</span></a>                            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
</span><span id="L-676"><a href="#-676"><span class="linenos"> 676</span></a>                                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Index is out of bounds.&quot;</span><span class="p">)</span>
</span><span id="L-677"><a href="#-677"><span class="linenos"> 677</span></a>                                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">closure_segments: </span><span class="si">{</span><span class="n">closure_segments</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-678"><a href="#-678"><span class="linenos"> 678</span></a>                                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">voxel_change_count: </span><span class="si">{</span><span class="n">voxel_change_count</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-679"><a href="#-679"><span class="linenos"> 679</span></a>                                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">i_indices: </span><span class="si">{</span><span class="n">i_indices</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-680"><a href="#-680"><span class="linenos"> 680</span></a>                                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">j_indices: </span><span class="si">{</span><span class="n">j_indices</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-681"><a href="#-681"><span class="linenos"> 681</span></a>                                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">k_indices: </span><span class="si">{</span><span class="n">k_indices</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;int&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-682"><a href="#-682"><span class="linenos"> 682</span></a>                                <span class="k">pass</span>
</span><span id="L-683"><a href="#-683"><span class="linenos"> 683</span></a>
</span><span id="L-684"><a href="#-684"><span class="linenos"> 684</span></a>                    <span class="k">if</span> <span class="n">slices_with_substitution</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-685"><a href="#-685"><span class="linenos"> 685</span></a>                        <span class="n">layers_with_closure</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-686"><a href="#-686"><span class="linenos"> 686</span></a>
</span><span id="L-687"><a href="#-687"><span class="linenos"> 687</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="L-688"><a href="#-688"><span class="linenos"> 688</span></a>                        <span class="nb">print</span><span class="p">(</span>
</span><span id="L-689"><a href="#-689"><span class="linenos"> 689</span></a>                            <span class="s2">&quot;    ... finished putting closures in closures_segments for layer ...&quot;</span><span class="p">,</span>
</span><span id="L-690"><a href="#-690"><span class="linenos"> 690</span></a>                            <span class="n">ihorizon</span><span class="p">,</span>
</span><span id="L-691"><a href="#-691"><span class="linenos"> 691</span></a>                        <span class="p">)</span>
</span><span id="L-692"><a href="#-692"><span class="linenos"> 692</span></a>
</span><span id="L-693"><a href="#-693"><span class="linenos"> 693</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-694"><a href="#-694"><span class="linenos"> 694</span></a>                    <span class="k">continue</span>
</span><span id="L-695"><a href="#-695"><span class="linenos"> 695</span></a>
</span><span id="L-696"><a href="#-696"><span class="linenos"> 696</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">facies</span><span class="p">[</span><span class="n">ihorizon</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-697"><a href="#-697"><span class="linenos"> 697</span></a>                <span class="n">avg_sand_thickness</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="L-698"><a href="#-698"><span class="linenos"> 698</span></a>                    <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span>
</span><span id="L-699"><a href="#-699"><span class="linenos"> 699</span></a>                        <span class="n">depth_maps_infilled</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">ihorizon</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="L-700"><a href="#-700"><span class="linenos"> 700</span></a>                        <span class="o">-</span> <span class="n">depth_maps_infilled</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">ihorizon</span><span class="p">]</span>
</span><span id="L-701"><a href="#-701"><span class="linenos"> 701</span></a>                    <span class="p">)</span>
</span><span id="L-702"><a href="#-702"><span class="linenos"> 702</span></a>                <span class="p">)</span>
</span><span id="L-703"><a href="#-703"><span class="linenos"> 703</span></a>            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">facies</span><span class="p">[</span><span class="n">ihorizon</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-704"><a href="#-704"><span class="linenos"> 704</span></a>                <span class="c1"># Calculate shale unit thicknesses</span>
</span><span id="L-705"><a href="#-705"><span class="linenos"> 705</span></a>                <span class="n">avg_shale_thickness</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="L-706"><a href="#-706"><span class="linenos"> 706</span></a>                    <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span>
</span><span id="L-707"><a href="#-707"><span class="linenos"> 707</span></a>                        <span class="n">depth_maps_infilled</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">ihorizon</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="L-708"><a href="#-708"><span class="linenos"> 708</span></a>                        <span class="o">-</span> <span class="n">depth_maps_infilled</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">ihorizon</span><span class="p">]</span>
</span><span id="L-709"><a href="#-709"><span class="linenos"> 709</span></a>                    <span class="p">)</span>
</span><span id="L-710"><a href="#-710"><span class="linenos"> 710</span></a>                <span class="p">)</span>
</span><span id="L-711"><a href="#-711"><span class="linenos"> 711</span></a>
</span><span id="L-712"><a href="#-712"><span class="linenos"> 712</span></a>        <span class="c1"># TODO  handle case where avg_sand_thickness is zero-size array</span>
</span><span id="L-713"><a href="#-713"><span class="linenos"> 713</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-714"><a href="#-714"><span class="linenos"> 714</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="L-715"><a href="#-715"><span class="linenos"> 715</span></a>                <span class="sa">f</span><span class="s2">&quot;Sand Unit Thickness (m): mean: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">avg_sand_thickness</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, &quot;</span>
</span><span id="L-716"><a href="#-716"><span class="linenos"> 716</span></a>                <span class="sa">f</span><span class="s2">&quot;std: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">avg_sand_thickness</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, min: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">avg_sand_thickness</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, &quot;</span>
</span><span id="L-717"><a href="#-717"><span class="linenos"> 717</span></a>                <span class="sa">f</span><span class="s2">&quot;max: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">avg_sand_thickness</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-718"><a href="#-718"><span class="linenos"> 718</span></a>            <span class="p">)</span>
</span><span id="L-719"><a href="#-719"><span class="linenos"> 719</span></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="L-720"><a href="#-720"><span class="linenos"> 720</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No sands in model&quot;</span><span class="p">)</span>
</span><span id="L-721"><a href="#-721"><span class="linenos"> 721</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="L-722"><a href="#-722"><span class="linenos"> 722</span></a>            <span class="sa">f</span><span class="s2">&quot;Shale Unit Thickness (m): mean: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">avg_shale_thickness</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, &quot;</span>
</span><span id="L-723"><a href="#-723"><span class="linenos"> 723</span></a>            <span class="sa">f</span><span class="s2">&quot;std: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">avg_shale_thickness</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, min: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">avg_shale_thickness</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, &quot;</span>
</span><span id="L-724"><a href="#-724"><span class="linenos"> 724</span></a>            <span class="sa">f</span><span class="s2">&quot;max: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">avg_shale_thickness</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-725"><a href="#-725"><span class="linenos"> 725</span></a>        <span class="p">)</span>
</span><span id="L-726"><a href="#-726"><span class="linenos"> 726</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="L-727"><a href="#-727"><span class="linenos"> 727</span></a>            <span class="sa">f</span><span class="s2">&quot;Overall Unit Thickness (m): mean: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">avg_unit_thickness</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, &quot;</span>
</span><span id="L-728"><a href="#-728"><span class="linenos"> 728</span></a>            <span class="sa">f</span><span class="s2">&quot;std: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">avg_unit_thickness</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, min: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">avg_unit_thickness</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, &quot;</span>
</span><span id="L-729"><a href="#-729"><span class="linenos"> 729</span></a>            <span class="sa">f</span><span class="s2">&quot;max: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">avg_unit_thickness</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-730"><a href="#-730"><span class="linenos"> 730</span></a>        <span class="p">)</span>
</span><span id="L-731"><a href="#-731"><span class="linenos"> 731</span></a>
</span><span id="L-732"><a href="#-732"><span class="linenos"> 732</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="L-733"><a href="#-733"><span class="linenos"> 733</span></a>            <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-734"><a href="#-734"><span class="linenos"> 734</span></a>            <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span>
</span><span id="L-735"><a href="#-735"><span class="linenos"> 735</span></a>            <span class="n">subkey</span><span class="o">=</span><span class="s2">&quot;sand_unit_thickness_mean&quot;</span><span class="p">,</span>
</span><span id="L-736"><a href="#-736"><span class="linenos"> 736</span></a>            <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">avg_sand_thickness</span><span class="p">),</span>
</span><span id="L-737"><a href="#-737"><span class="linenos"> 737</span></a>        <span class="p">)</span>
</span><span id="L-738"><a href="#-738"><span class="linenos"> 738</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="L-739"><a href="#-739"><span class="linenos"> 739</span></a>            <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-740"><a href="#-740"><span class="linenos"> 740</span></a>            <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span>
</span><span id="L-741"><a href="#-741"><span class="linenos"> 741</span></a>            <span class="n">subkey</span><span class="o">=</span><span class="s2">&quot;sand_unit_thickness_std&quot;</span><span class="p">,</span>
</span><span id="L-742"><a href="#-742"><span class="linenos"> 742</span></a>            <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">avg_sand_thickness</span><span class="p">),</span>
</span><span id="L-743"><a href="#-743"><span class="linenos"> 743</span></a>        <span class="p">)</span>
</span><span id="L-744"><a href="#-744"><span class="linenos"> 744</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="L-745"><a href="#-745"><span class="linenos"> 745</span></a>            <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-746"><a href="#-746"><span class="linenos"> 746</span></a>            <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span>
</span><span id="L-747"><a href="#-747"><span class="linenos"> 747</span></a>            <span class="n">subkey</span><span class="o">=</span><span class="s2">&quot;sand_unit_thickness_min&quot;</span><span class="p">,</span>
</span><span id="L-748"><a href="#-748"><span class="linenos"> 748</span></a>            <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">avg_sand_thickness</span><span class="p">),</span>
</span><span id="L-749"><a href="#-749"><span class="linenos"> 749</span></a>        <span class="p">)</span>
</span><span id="L-750"><a href="#-750"><span class="linenos"> 750</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="L-751"><a href="#-751"><span class="linenos"> 751</span></a>            <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-752"><a href="#-752"><span class="linenos"> 752</span></a>            <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span>
</span><span id="L-753"><a href="#-753"><span class="linenos"> 753</span></a>            <span class="n">subkey</span><span class="o">=</span><span class="s2">&quot;sand_unit_thickness_max&quot;</span><span class="p">,</span>
</span><span id="L-754"><a href="#-754"><span class="linenos"> 754</span></a>            <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">avg_sand_thickness</span><span class="p">),</span>
</span><span id="L-755"><a href="#-755"><span class="linenos"> 755</span></a>        <span class="p">)</span>
</span><span id="L-756"><a href="#-756"><span class="linenos"> 756</span></a>        <span class="c1">#</span>
</span><span id="L-757"><a href="#-757"><span class="linenos"> 757</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="L-758"><a href="#-758"><span class="linenos"> 758</span></a>            <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-759"><a href="#-759"><span class="linenos"> 759</span></a>            <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span>
</span><span id="L-760"><a href="#-760"><span class="linenos"> 760</span></a>            <span class="n">subkey</span><span class="o">=</span><span class="s2">&quot;shale_unit_thickness_mean&quot;</span><span class="p">,</span>
</span><span id="L-761"><a href="#-761"><span class="linenos"> 761</span></a>            <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">avg_shale_thickness</span><span class="p">),</span>
</span><span id="L-762"><a href="#-762"><span class="linenos"> 762</span></a>        <span class="p">)</span>
</span><span id="L-763"><a href="#-763"><span class="linenos"> 763</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="L-764"><a href="#-764"><span class="linenos"> 764</span></a>            <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-765"><a href="#-765"><span class="linenos"> 765</span></a>            <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span>
</span><span id="L-766"><a href="#-766"><span class="linenos"> 766</span></a>            <span class="n">subkey</span><span class="o">=</span><span class="s2">&quot;shale_unit_thickness_std&quot;</span><span class="p">,</span>
</span><span id="L-767"><a href="#-767"><span class="linenos"> 767</span></a>            <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">avg_shale_thickness</span><span class="p">),</span>
</span><span id="L-768"><a href="#-768"><span class="linenos"> 768</span></a>        <span class="p">)</span>
</span><span id="L-769"><a href="#-769"><span class="linenos"> 769</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="L-770"><a href="#-770"><span class="linenos"> 770</span></a>            <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-771"><a href="#-771"><span class="linenos"> 771</span></a>            <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span>
</span><span id="L-772"><a href="#-772"><span class="linenos"> 772</span></a>            <span class="n">subkey</span><span class="o">=</span><span class="s2">&quot;shale_unit_thickness_min&quot;</span><span class="p">,</span>
</span><span id="L-773"><a href="#-773"><span class="linenos"> 773</span></a>            <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">avg_shale_thickness</span><span class="p">),</span>
</span><span id="L-774"><a href="#-774"><span class="linenos"> 774</span></a>        <span class="p">)</span>
</span><span id="L-775"><a href="#-775"><span class="linenos"> 775</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="L-776"><a href="#-776"><span class="linenos"> 776</span></a>            <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-777"><a href="#-777"><span class="linenos"> 777</span></a>            <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span>
</span><span id="L-778"><a href="#-778"><span class="linenos"> 778</span></a>            <span class="n">subkey</span><span class="o">=</span><span class="s2">&quot;shale_unit_thickness_max&quot;</span><span class="p">,</span>
</span><span id="L-779"><a href="#-779"><span class="linenos"> 779</span></a>            <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">avg_shale_thickness</span><span class="p">),</span>
</span><span id="L-780"><a href="#-780"><span class="linenos"> 780</span></a>        <span class="p">)</span>
</span><span id="L-781"><a href="#-781"><span class="linenos"> 781</span></a>
</span><span id="L-782"><a href="#-782"><span class="linenos"> 782</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="L-783"><a href="#-783"><span class="linenos"> 783</span></a>            <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-784"><a href="#-784"><span class="linenos"> 784</span></a>            <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span>
</span><span id="L-785"><a href="#-785"><span class="linenos"> 785</span></a>            <span class="n">subkey</span><span class="o">=</span><span class="s2">&quot;overall_unit_thickness_mean&quot;</span><span class="p">,</span>
</span><span id="L-786"><a href="#-786"><span class="linenos"> 786</span></a>            <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">avg_unit_thickness</span><span class="p">),</span>
</span><span id="L-787"><a href="#-787"><span class="linenos"> 787</span></a>        <span class="p">)</span>
</span><span id="L-788"><a href="#-788"><span class="linenos"> 788</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="L-789"><a href="#-789"><span class="linenos"> 789</span></a>            <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-790"><a href="#-790"><span class="linenos"> 790</span></a>            <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span>
</span><span id="L-791"><a href="#-791"><span class="linenos"> 791</span></a>            <span class="n">subkey</span><span class="o">=</span><span class="s2">&quot;overall_unit_thickness_std&quot;</span><span class="p">,</span>
</span><span id="L-792"><a href="#-792"><span class="linenos"> 792</span></a>            <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">avg_unit_thickness</span><span class="p">),</span>
</span><span id="L-793"><a href="#-793"><span class="linenos"> 793</span></a>        <span class="p">)</span>
</span><span id="L-794"><a href="#-794"><span class="linenos"> 794</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="L-795"><a href="#-795"><span class="linenos"> 795</span></a>            <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-796"><a href="#-796"><span class="linenos"> 796</span></a>            <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span>
</span><span id="L-797"><a href="#-797"><span class="linenos"> 797</span></a>            <span class="n">subkey</span><span class="o">=</span><span class="s2">&quot;overall_unit_thickness_min&quot;</span><span class="p">,</span>
</span><span id="L-798"><a href="#-798"><span class="linenos"> 798</span></a>            <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">avg_unit_thickness</span><span class="p">),</span>
</span><span id="L-799"><a href="#-799"><span class="linenos"> 799</span></a>        <span class="p">)</span>
</span><span id="L-800"><a href="#-800"><span class="linenos"> 800</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="L-801"><a href="#-801"><span class="linenos"> 801</span></a>            <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-802"><a href="#-802"><span class="linenos"> 802</span></a>            <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span>
</span><span id="L-803"><a href="#-803"><span class="linenos"> 803</span></a>            <span class="n">subkey</span><span class="o">=</span><span class="s2">&quot;overall_unit_thickness_max&quot;</span><span class="p">,</span>
</span><span id="L-804"><a href="#-804"><span class="linenos"> 804</span></a>            <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">avg_unit_thickness</span><span class="p">),</span>
</span><span id="L-805"><a href="#-805"><span class="linenos"> 805</span></a>        <span class="p">)</span>
</span><span id="L-806"><a href="#-806"><span class="linenos"> 806</span></a>
</span><span id="L-807"><a href="#-807"><span class="linenos"> 807</span></a>        <span class="n">non_zero_pixels</span> <span class="o">=</span> <span class="n">closure_segments</span><span class="p">[</span><span class="n">closure_segments</span> <span class="o">!=</span> <span class="mf">0.0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-808"><a href="#-808"><span class="linenos"> 808</span></a>        <span class="n">pct_non_zero</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">non_zero_pixels</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span>
</span><span id="L-809"><a href="#-809"><span class="linenos"> 809</span></a>            <span class="n">closure_segments</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-810"><a href="#-810"><span class="linenos"> 810</span></a>            <span class="o">*</span> <span class="n">closure_segments</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-811"><a href="#-811"><span class="linenos"> 811</span></a>            <span class="o">*</span> <span class="n">closure_segments</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
</span><span id="L-812"><a href="#-812"><span class="linenos"> 812</span></a>        <span class="p">)</span>
</span><span id="L-813"><a href="#-813"><span class="linenos"> 813</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="L-814"><a href="#-814"><span class="linenos"> 814</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="L-815"><a href="#-815"><span class="linenos"> 815</span></a>                <span class="s2">&quot;    ...closure_segments min </span><span class="si">{}</span><span class="s2">, mean </span><span class="si">{}</span><span class="s2">, max </span><span class="si">{}</span><span class="s2">, % non-zero </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="L-816"><a href="#-816"><span class="linenos"> 816</span></a>                    <span class="n">closure_segments</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
</span><span id="L-817"><a href="#-817"><span class="linenos"> 817</span></a>                    <span class="n">closure_segments</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span>
</span><span id="L-818"><a href="#-818"><span class="linenos"> 818</span></a>                    <span class="n">closure_segments</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span>
</span><span id="L-819"><a href="#-819"><span class="linenos"> 819</span></a>                    <span class="n">pct_non_zero</span><span class="p">,</span>
</span><span id="L-820"><a href="#-820"><span class="linenos"> 820</span></a>                <span class="p">)</span>
</span><span id="L-821"><a href="#-821"><span class="linenos"> 821</span></a>            <span class="p">)</span>
</span><span id="L-822"><a href="#-822"><span class="linenos"> 822</span></a>
</span><span id="L-823"><a href="#-823"><span class="linenos"> 823</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">... layers_with_closure </span><span class="si">{</span><span class="n">layers_with_closure</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-824"><a href="#-824"><span class="linenos"> 824</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">... finished putting closures in closure_segments ...</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-825"><a href="#-825"><span class="linenos"> 825</span></a>
</span><span id="L-826"><a href="#-826"><span class="linenos"> 826</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="L-827"><a href="#-827"><span class="linenos"> 827</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="L-828"><a href="#-828"><span class="linenos"> 828</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">   ...closure segments created. min: </span><span class="si">{</span><span class="n">closure_segments</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="si">}</span><span class="s2">, &quot;</span>
</span><span id="L-829"><a href="#-829"><span class="linenos"> 829</span></a>                <span class="sa">f</span><span class="s2">&quot;mean: </span><span class="si">{</span><span class="n">closure_segments</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, max: </span><span class="si">{</span><span class="n">closure_segments</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-830"><a href="#-830"><span class="linenos"> 830</span></a>                <span class="sa">f</span><span class="s2">&quot; voxel count: </span><span class="si">{</span><span class="n">closure_segments</span><span class="p">[</span><span class="n">closure_segments</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-831"><a href="#-831"><span class="linenos"> 831</span></a>            <span class="p">)</span>
</span><span id="L-832"><a href="#-832"><span class="linenos"> 832</span></a>
</span><span id="L-833"><a href="#-833"><span class="linenos"> 833</span></a>        <span class="k">return</span> <span class="n">closure_segments</span>
</span><span id="L-834"><a href="#-834"><span class="linenos"> 834</span></a>
</span><span id="L-835"><a href="#-835"><span class="linenos"> 835</span></a>    <span class="k">def</span> <span class="nf">find_top_lith_horizons</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-836"><a href="#-836"><span class="linenos"> 836</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-837"><a href="#-837"><span class="linenos"> 837</span></a><span class="sd">        Find horizons which are the top of layers where the lithology changes</span>
</span><span id="L-838"><a href="#-838"><span class="linenos"> 838</span></a>
</span><span id="L-839"><a href="#-839"><span class="linenos"> 839</span></a><span class="sd">        Combine layers of the same lithology and retain the top of these new layers for closure calculations.</span>
</span><span id="L-840"><a href="#-840"><span class="linenos"> 840</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-841"><a href="#-841"><span class="linenos"> 841</span></a>        <span class="n">top_lith_indices</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">onlap_list</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-842"><a href="#-842"><span class="linenos"> 842</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">facies</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
</span><span id="L-843"><a href="#-843"><span class="linenos"> 843</span></a>            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-844"><a href="#-844"><span class="linenos"> 844</span></a>                <span class="k">continue</span>
</span><span id="L-845"><a href="#-845"><span class="linenos"> 845</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="L-846"><a href="#-846"><span class="linenos"> 846</span></a>                <span class="sa">f</span><span class="s2">&quot;i: </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">, sand_layer_label[i-1]: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">facies</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">,&quot;</span>
</span><span id="L-847"><a href="#-847"><span class="linenos"> 847</span></a>                <span class="sa">f</span><span class="s2">&quot; sand_layer_label[i]: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">facies</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-848"><a href="#-848"><span class="linenos"> 848</span></a>            <span class="p">)</span>
</span><span id="L-849"><a href="#-849"><span class="linenos"> 849</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">facies</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">facies</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]:</span>
</span><span id="L-850"><a href="#-850"><span class="linenos"> 850</span></a>                <span class="n">top_lith_indices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</span><span id="L-851"><a href="#-851"><span class="linenos"> 851</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="L-852"><a href="#-852"><span class="linenos"> 852</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="L-853"><a href="#-853"><span class="linenos"> 853</span></a>                        <span class="s2">&quot;  ... layer lith different than layer above it. i = </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="L-854"><a href="#-854"><span class="linenos"> 854</span></a>                            <span class="n">i</span>
</span><span id="L-855"><a href="#-855"><span class="linenos"> 855</span></a>                        <span class="p">)</span>
</span><span id="L-856"><a href="#-856"><span class="linenos"> 856</span></a>                    <span class="p">)</span>
</span><span id="L-857"><a href="#-857"><span class="linenos"> 857</span></a>        <span class="n">top_lith_indices</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
</span><span id="L-858"><a href="#-858"><span class="linenos"> 858</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="L-859"><a href="#-859"><span class="linenos"> 859</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="L-860"><a href="#-860"><span class="linenos"> 860</span></a>                <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">   ...layers selected for closure computations...</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="L-861"><a href="#-861"><span class="linenos"> 861</span></a>                <span class="n">top_lith_indices</span><span class="p">,</span>
</span><span id="L-862"><a href="#-862"><span class="linenos"> 862</span></a>            <span class="p">)</span>
</span><span id="L-863"><a href="#-863"><span class="linenos"> 863</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">top_lith_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">top_lith_indices</span><span class="p">)</span>
</span><span id="L-864"><a href="#-864"><span class="linenos"> 864</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">top_lith_facies</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">facies</span><span class="p">[</span><span class="n">top_lith_indices</span><span class="p">]</span>
</span><span id="L-865"><a href="#-865"><span class="linenos"> 865</span></a>
</span><span id="L-866"><a href="#-866"><span class="linenos"> 866</span></a>        <span class="c1"># return top_lith_indices</span>
</span><span id="L-867"><a href="#-867"><span class="linenos"> 867</span></a>
</span><span id="L-868"><a href="#-868"><span class="linenos"> 868</span></a>    <span class="k">def</span> <span class="nf">create_closures</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-869"><a href="#-869"><span class="linenos"> 869</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="L-870"><a href="#-870"><span class="linenos"> 870</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2"> ... create 3D labels for closure&quot;</span><span class="p">)</span>
</span><span id="L-871"><a href="#-871"><span class="linenos"> 871</span></a>
</span><span id="L-872"><a href="#-872"><span class="linenos"> 872</span></a>        <span class="c1"># Convert nan to 0&#39;s</span>
</span><span id="L-873"><a href="#-873"><span class="linenos"> 873</span></a>        <span class="n">old_depth_maps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">faulted_depth_maps</span><span class="p">[:],</span> <span class="n">copy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-874"><a href="#-874"><span class="linenos"> 874</span></a>        <span class="n">old_depth_maps_gaps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span>
</span><span id="L-875"><a href="#-875"><span class="linenos"> 875</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">faulted_depth_maps_gaps</span><span class="p">[:],</span> <span class="n">copy</span><span class="o">=</span><span class="kc">True</span>
</span><span id="L-876"><a href="#-876"><span class="linenos"> 876</span></a>        <span class="p">)</span>
</span><span id="L-877"><a href="#-877"><span class="linenos"> 877</span></a>
</span><span id="L-878"><a href="#-878"><span class="linenos"> 878</span></a>        <span class="c1"># Convert from samples to units</span>
</span><span id="L-879"><a href="#-879"><span class="linenos"> 879</span></a>        <span class="n">old_depth_maps_gaps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">convert_map_from_samples_to_units</span><span class="p">(</span>
</span><span id="L-880"><a href="#-880"><span class="linenos"> 880</span></a>            <span class="n">old_depth_maps_gaps</span>
</span><span id="L-881"><a href="#-881"><span class="linenos"> 881</span></a>        <span class="p">)</span>
</span><span id="L-882"><a href="#-882"><span class="linenos"> 882</span></a>        <span class="n">old_depth_maps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">convert_map_from_samples_to_units</span><span class="p">(</span><span class="n">old_depth_maps</span><span class="p">)</span>
</span><span id="L-883"><a href="#-883"><span class="linenos"> 883</span></a>
</span><span id="L-884"><a href="#-884"><span class="linenos"> 884</span></a>        <span class="c1"># keep only horizons corresponding to top of layers where lithology changes</span>
</span><span id="L-885"><a href="#-885"><span class="linenos"> 885</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">find_top_lith_horizons</span><span class="p">()</span>
</span><span id="L-886"><a href="#-886"><span class="linenos"> 886</span></a>        <span class="n">all_lith_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">old_depth_maps</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</span><span id="L-887"><a href="#-887"><span class="linenos"> 887</span></a>        <span class="kn">import</span> <span class="nn">sys</span>
</span><span id="L-888"><a href="#-888"><span class="linenos"> 888</span></a>
</span><span id="L-889"><a href="#-889"><span class="linenos"> 889</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;All lith indices (last, then all):&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">facies</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">all_lith_indices</span><span class="p">)</span>
</span><span id="L-890"><a href="#-890"><span class="linenos"> 890</span></a>        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</span><span id="L-891"><a href="#-891"><span class="linenos"> 891</span></a>
</span><span id="L-892"><a href="#-892"><span class="linenos"> 892</span></a>        <span class="n">depth_maps_gaps_top_lith</span> <span class="o">=</span> <span class="n">old_depth_maps_gaps</span><span class="p">[</span>
</span><span id="L-893"><a href="#-893"><span class="linenos"> 893</span></a>            <span class="p">:,</span> <span class="p">:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top_lith_indices</span>
</span><span id="L-894"><a href="#-894"><span class="linenos"> 894</span></a>        <span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-895"><a href="#-895"><span class="linenos"> 895</span></a>        <span class="n">depth_maps_gaps_all_lith</span> <span class="o">=</span> <span class="n">old_depth_maps_gaps</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">all_lith_indices</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-896"><a href="#-896"><span class="linenos"> 896</span></a>        <span class="n">depth_maps_top_lith</span> <span class="o">=</span> <span class="n">old_depth_maps</span><span class="p">[:,</span> <span class="p">:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top_lith_indices</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-897"><a href="#-897"><span class="linenos"> 897</span></a>        <span class="n">depth_maps_all_lith</span> <span class="o">=</span> <span class="n">old_depth_maps</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">all_lith_indices</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-898"><a href="#-898"><span class="linenos"> 898</span></a>        <span class="n">max_column_heights</span> <span class="o">=</span> <span class="n">variable_max_column_height</span><span class="p">(</span>
</span><span id="L-899"><a href="#-899"><span class="linenos"> 899</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">top_lith_indices</span><span class="p">,</span>
</span><span id="L-900"><a href="#-900"><span class="linenos"> 900</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">faulted_depth_maps_gaps</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
</span><span id="L-901"><a href="#-901"><span class="linenos"> 901</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">max_column_height</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
</span><span id="L-902"><a href="#-902"><span class="linenos"> 902</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">max_column_height</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
</span><span id="L-903"><a href="#-903"><span class="linenos"> 903</span></a>        <span class="p">)</span>
</span><span id="L-904"><a href="#-904"><span class="linenos"> 904</span></a>        <span class="n">all_max_column_heights</span> <span class="o">=</span> <span class="n">variable_max_column_height</span><span class="p">(</span>
</span><span id="L-905"><a href="#-905"><span class="linenos"> 905</span></a>            <span class="n">all_lith_indices</span><span class="p">,</span>
</span><span id="L-906"><a href="#-906"><span class="linenos"> 906</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">faulted_depth_maps_gaps</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
</span><span id="L-907"><a href="#-907"><span class="linenos"> 907</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">max_column_height</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
</span><span id="L-908"><a href="#-908"><span class="linenos"> 908</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">max_column_height</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
</span><span id="L-909"><a href="#-909"><span class="linenos"> 909</span></a>        <span class="p">)</span>
</span><span id="L-910"><a href="#-910"><span class="linenos"> 910</span></a>
</span><span id="L-911"><a href="#-911"><span class="linenos"> 911</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="L-912"><a href="#-912"><span class="linenos"> 912</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">   ...facies for closure computations...</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top_lith_facies</span><span class="p">)</span>
</span><span id="L-913"><a href="#-913"><span class="linenos"> 913</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="L-914"><a href="#-914"><span class="linenos"> 914</span></a>                <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">   ...max column heights for closure computations...</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="L-915"><a href="#-915"><span class="linenos"> 915</span></a>                <span class="n">max_column_heights</span><span class="p">,</span>
</span><span id="L-916"><a href="#-916"><span class="linenos"> 916</span></a>            <span class="p">)</span>
</span><span id="L-917"><a href="#-917"><span class="linenos"> 917</span></a>
</span><span id="L-918"><a href="#-918"><span class="linenos"> 918</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">closure_segments</span><span class="p">[:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_closure_labels_from_depth_maps</span><span class="p">(</span>
</span><span id="L-919"><a href="#-919"><span class="linenos"> 919</span></a>            <span class="n">depth_maps_gaps_top_lith</span><span class="p">,</span> <span class="n">depth_maps_top_lith</span><span class="p">,</span> <span class="n">max_column_heights</span>
</span><span id="L-920"><a href="#-920"><span class="linenos"> 920</span></a>        <span class="p">)</span>
</span><span id="L-921"><a href="#-921"><span class="linenos"> 921</span></a>
</span><span id="L-922"><a href="#-922"><span class="linenos"> 922</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">all_closure_segments</span><span class="p">[:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_closure_labels_from_all_depth_maps</span><span class="p">(</span>
</span><span id="L-923"><a href="#-923"><span class="linenos"> 923</span></a>            <span class="n">depth_maps_gaps_all_lith</span><span class="p">,</span> <span class="n">depth_maps_all_lith</span><span class="p">,</span> <span class="n">all_max_column_heights</span>
</span><span id="L-924"><a href="#-924"><span class="linenos"> 924</span></a>        <span class="p">)</span>
</span><span id="L-925"><a href="#-925"><span class="linenos"> 925</span></a>
</span><span id="L-926"><a href="#-926"><span class="linenos"> 926</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="L-927"><a href="#-927"><span class="linenos"> 927</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="L-928"><a href="#-928"><span class="linenos"> 928</span></a>                <span class="s2">&quot;     ...+++... number of nan&#39;s in depth_maps_gaps before insertClosureLabels3D ...+++... </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="L-929"><a href="#-929"><span class="linenos"> 929</span></a>                    <span class="n">old_depth_maps_gaps</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">old_depth_maps_gaps</span><span class="p">)]</span><span class="o">.</span><span class="n">shape</span>
</span><span id="L-930"><a href="#-930"><span class="linenos"> 930</span></a>                <span class="p">)</span>
</span><span id="L-931"><a href="#-931"><span class="linenos"> 931</span></a>            <span class="p">)</span>
</span><span id="L-932"><a href="#-932"><span class="linenos"> 932</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="L-933"><a href="#-933"><span class="linenos"> 933</span></a>                <span class="s2">&quot;     ...+++... number of nan&#39;s in depth_maps_gaps after insertClosureLabels3D ...+++... </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="L-934"><a href="#-934"><span class="linenos"> 934</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">faulted_depth_maps_gaps</span><span class="p">[</span>
</span><span id="L-935"><a href="#-935"><span class="linenos"> 935</span></a>                        <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">faulted_depth_maps_gaps</span><span class="p">)</span>
</span><span id="L-936"><a href="#-936"><span class="linenos"> 936</span></a>                    <span class="p">]</span><span class="o">.</span><span class="n">shape</span>
</span><span id="L-937"><a href="#-937"><span class="linenos"> 937</span></a>                <span class="p">)</span>
</span><span id="L-938"><a href="#-938"><span class="linenos"> 938</span></a>            <span class="p">)</span>
</span><span id="L-939"><a href="#-939"><span class="linenos"> 939</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="L-940"><a href="#-940"><span class="linenos"> 940</span></a>                <span class="s2">&quot;     ...+++... number of nan&#39;s in depth_maps after insertClosureLabels3D ...+++... </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="L-941"><a href="#-941"><span class="linenos"> 941</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">faulted_depth_maps</span><span class="p">[</span>
</span><span id="L-942"><a href="#-942"><span class="linenos"> 942</span></a>                        <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">faulted_depth_maps</span><span class="p">)</span>
</span><span id="L-943"><a href="#-943"><span class="linenos"> 943</span></a>                    <span class="p">]</span><span class="o">.</span><span class="n">shape</span>
</span><span id="L-944"><a href="#-944"><span class="linenos"> 944</span></a>                <span class="p">)</span>
</span><span id="L-945"><a href="#-945"><span class="linenos"> 945</span></a>            <span class="p">)</span>
</span><span id="L-946"><a href="#-946"><span class="linenos"> 946</span></a>            <span class="n">_closure_segments</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">closure_segments</span><span class="p">[:]</span>
</span><span id="L-947"><a href="#-947"><span class="linenos"> 947</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="L-948"><a href="#-948"><span class="linenos"> 948</span></a>                <span class="s2">&quot;     ...+++... number of closure voxels in self.closure_segments ...+++... </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="L-949"><a href="#-949"><span class="linenos"> 949</span></a>                    <span class="n">_closure_segments</span><span class="p">[</span><span class="n">_closure_segments</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span>
</span><span id="L-950"><a href="#-950"><span class="linenos"> 950</span></a>                <span class="p">)</span>
</span><span id="L-951"><a href="#-951"><span class="linenos"> 951</span></a>            <span class="p">)</span>
</span><span id="L-952"><a href="#-952"><span class="linenos"> 952</span></a>            <span class="k">del</span> <span class="n">_closure_segments</span>
</span><span id="L-953"><a href="#-953"><span class="linenos"> 953</span></a>
</span><span id="L-954"><a href="#-954"><span class="linenos"> 954</span></a>        <span class="n">labels_clean</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">closure_segments</span><span class="p">[:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">segment_closures</span><span class="p">(</span>
</span><span id="L-955"><a href="#-955"><span class="linenos"> 955</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">closure_segments</span><span class="p">[:],</span> <span class="n">remove_shale</span><span class="o">=</span><span class="kc">True</span>
</span><span id="L-956"><a href="#-956"><span class="linenos"> 956</span></a>        <span class="p">)</span>
</span><span id="L-957"><a href="#-957"><span class="linenos"> 957</span></a>        <span class="n">label_values</span><span class="p">,</span> <span class="n">labels_clean</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_label_values_and_counts</span><span class="p">(</span><span class="n">labels_clean</span><span class="p">)</span>
</span><span id="L-958"><a href="#-958"><span class="linenos"> 958</span></a>
</span><span id="L-959"><a href="#-959"><span class="linenos"> 959</span></a>        <span class="n">labels_clean_all</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_closure_segments</span><span class="p">[:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">segment_closures</span><span class="p">(</span>
</span><span id="L-960"><a href="#-960"><span class="linenos"> 960</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">all_closure_segments</span><span class="p">[:],</span> <span class="n">remove_shale</span><span class="o">=</span><span class="kc">False</span>
</span><span id="L-961"><a href="#-961"><span class="linenos"> 961</span></a>        <span class="p">)</span>
</span><span id="L-962"><a href="#-962"><span class="linenos"> 962</span></a>        <span class="n">label_values_all</span><span class="p">,</span> <span class="n">labels_clean_all</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_label_values_and_counts</span><span class="p">(</span>
</span><span id="L-963"><a href="#-963"><span class="linenos"> 963</span></a>            <span class="n">labels_clean_all</span>
</span><span id="L-964"><a href="#-964"><span class="linenos"> 964</span></a>        <span class="p">)</span>
</span><span id="L-965"><a href="#-965"><span class="linenos"> 965</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">write_cube_to_disk</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">all_closure_segments</span><span class="p">[:],</span> <span class="s2">&quot;all_closure_segments&quot;</span><span class="p">)</span>
</span><span id="L-966"><a href="#-966"><span class="linenos"> 966</span></a>
</span><span id="L-967"><a href="#-967"><span class="linenos"> 967</span></a>        <span class="c1"># Assign fluid types</span>
</span><span id="L-968"><a href="#-968"><span class="linenos"> 968</span></a>        <span class="p">(</span>
</span><span id="L-969"><a href="#-969"><span class="linenos"> 969</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">oil_closures</span><span class="p">[:],</span>
</span><span id="L-970"><a href="#-970"><span class="linenos"> 970</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">gas_closures</span><span class="p">[:],</span>
</span><span id="L-971"><a href="#-971"><span class="linenos"> 971</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">brine_closures</span><span class="p">[:],</span>
</span><span id="L-972"><a href="#-972"><span class="linenos"> 972</span></a>        <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assign_fluid_types</span><span class="p">(</span><span class="n">label_values</span><span class="p">,</span> <span class="n">labels_clean</span><span class="p">)</span>
</span><span id="L-973"><a href="#-973"><span class="linenos"> 973</span></a>        <span class="n">all_closures_final</span> <span class="o">=</span> <span class="p">(</span><span class="n">labels_clean_all</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;uint8&quot;</span><span class="p">)</span>
</span><span id="L-974"><a href="#-974"><span class="linenos"> 974</span></a>
</span><span id="L-975"><a href="#-975"><span class="linenos"> 975</span></a>        <span class="c1"># Identify closures by type (simple, faulted, onlap or salt bounded)</span>
</span><span id="L-976"><a href="#-976"><span class="linenos"> 976</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">find_faulted_closures</span><span class="p">(</span><span class="n">label_values</span><span class="p">,</span> <span class="n">labels_clean</span><span class="p">)</span>
</span><span id="L-977"><a href="#-977"><span class="linenos"> 977</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">find_onlap_closures</span><span class="p">(</span><span class="n">label_values</span><span class="p">,</span> <span class="n">labels_clean</span><span class="p">)</span>
</span><span id="L-978"><a href="#-978"><span class="linenos"> 978</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">find_simple_closures</span><span class="p">(</span><span class="n">label_values</span><span class="p">,</span> <span class="n">labels_clean</span><span class="p">)</span>
</span><span id="L-979"><a href="#-979"><span class="linenos"> 979</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">find_false_closures</span><span class="p">(</span><span class="n">label_values</span><span class="p">,</span> <span class="n">labels_clean</span><span class="p">)</span>
</span><span id="L-980"><a href="#-980"><span class="linenos"> 980</span></a>
</span><span id="L-981"><a href="#-981"><span class="linenos"> 981</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">find_faulted_all_closures</span><span class="p">(</span><span class="n">label_values_all</span><span class="p">,</span> <span class="n">labels_clean_all</span><span class="p">)</span>
</span><span id="L-982"><a href="#-982"><span class="linenos"> 982</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">find_onlap_all_closures</span><span class="p">(</span><span class="n">label_values_all</span><span class="p">,</span> <span class="n">labels_clean_all</span><span class="p">)</span>
</span><span id="L-983"><a href="#-983"><span class="linenos"> 983</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">find_simple_all_closures</span><span class="p">(</span><span class="n">label_values_all</span><span class="p">,</span> <span class="n">labels_clean_all</span><span class="p">)</span>
</span><span id="L-984"><a href="#-984"><span class="linenos"> 984</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">find_false_all_closures</span><span class="p">(</span><span class="n">label_values_all</span><span class="p">,</span> <span class="n">labels_clean_all</span><span class="p">)</span>
</span><span id="L-985"><a href="#-985"><span class="linenos"> 985</span></a>
</span><span id="L-986"><a href="#-986"><span class="linenos"> 986</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">include_salt</span><span class="p">:</span>
</span><span id="L-987"><a href="#-987"><span class="linenos"> 987</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">find_salt_bounded_closures</span><span class="p">(</span><span class="n">label_values</span><span class="p">,</span> <span class="n">labels_clean</span><span class="p">)</span>
</span><span id="L-988"><a href="#-988"><span class="linenos"> 988</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">find_salt_bounded_all_closures</span><span class="p">(</span><span class="n">label_values_all</span><span class="p">,</span> <span class="n">labels_clean_all</span><span class="p">)</span>
</span><span id="L-989"><a href="#-989"><span class="linenos"> 989</span></a>
</span><span id="L-990"><a href="#-990"><span class="linenos"> 990</span></a>        <span class="c1"># Remove false closures from oil &amp; gas closure cubes</span>
</span><span id="L-991"><a href="#-991"><span class="linenos"> 991</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_false_closures_oil</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-992"><a href="#-992"><span class="linenos"> 992</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Removing </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">n_false_closures_oil</span><span class="si">}</span><span class="s2"> false oil closures&quot;</span><span class="p">)</span>
</span><span id="L-993"><a href="#-993"><span class="linenos"> 993</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">oil_closures</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">false_closures_oil</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="L-994"><a href="#-994"><span class="linenos"> 994</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_false_closures_gas</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-995"><a href="#-995"><span class="linenos"> 995</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Removing </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">n_false_closures_gas</span><span class="si">}</span><span class="s2"> false gas closures&quot;</span><span class="p">)</span>
</span><span id="L-996"><a href="#-996"><span class="linenos"> 996</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">gas_closures</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">false_closures_gas</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="L-997"><a href="#-997"><span class="linenos"> 997</span></a>
</span><span id="L-998"><a href="#-998"><span class="linenos"> 998</span></a>        <span class="c1"># Remove false closures from allclosure cube</span>
</span><span id="L-999"><a href="#-999"><span class="linenos"> 999</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_false_all_closures</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-1000"><a href="#-1000"><span class="linenos">1000</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Removing </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">n_false_all_closures</span><span class="si">}</span><span class="s2"> false all closures&quot;</span><span class="p">)</span>
</span><span id="L-1001"><a href="#-1001"><span class="linenos">1001</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">all_closure_segments</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">false_all_closures</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="L-1002"><a href="#-1002"><span class="linenos">1002</span></a>
</span><span id="L-1003"><a href="#-1003"><span class="linenos">1003</span></a>        <span class="c1"># Create a closure cube with voxel count as labels, and include closure type in decimal</span>
</span><span id="L-1004"><a href="#-1004"><span class="linenos">1004</span></a>        <span class="c1"># e.g. simple closure of size 5000 = 5000.1</span>
</span><span id="L-1005"><a href="#-1005"><span class="linenos">1005</span></a>        <span class="c1">#      faulted closure of size 5000 = 5000.2</span>
</span><span id="L-1006"><a href="#-1006"><span class="linenos">1006</span></a>        <span class="c1">#      onlap closure of size 5000 = 5000.3</span>
</span><span id="L-1007"><a href="#-1007"><span class="linenos">1007</span></a>        <span class="c1">#      salt-bounded closure of size 5000 = 5000.4</span>
</span><span id="L-1008"><a href="#-1008"><span class="linenos">1008</span></a>        <span class="n">hc_closure_codes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gas_closures</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;float32&quot;</span><span class="p">)</span>
</span><span id="L-1009"><a href="#-1009"><span class="linenos">1009</span></a>
</span><span id="L-1010"><a href="#-1010"><span class="linenos">1010</span></a>        <span class="c1"># AZ: COULD RUN THESE CLOSURE SIZE FILTERS ON ALL_CLOSURES, IF DESIRED</span>
</span><span id="L-1011"><a href="#-1011"><span class="linenos">1011</span></a>
</span><span id="L-1012"><a href="#-1012"><span class="linenos">1012</span></a>        <span class="k">if</span> <span class="s2">&quot;simple&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">closure_types</span><span class="p">:</span>
</span><span id="L-1013"><a href="#-1013"><span class="linenos">1013</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Filtering 4 Way Closures&quot;</span><span class="p">)</span>
</span><span id="L-1014"><a href="#-1014"><span class="linenos">1014</span></a>            <span class="p">(</span>
</span><span id="L-1015"><a href="#-1015"><span class="linenos">1015</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">simple_closures_oil</span><span class="p">[:],</span>
</span><span id="L-1016"><a href="#-1016"><span class="linenos">1016</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">n_4way_closures_oil</span><span class="p">,</span>
</span><span id="L-1017"><a href="#-1017"><span class="linenos">1017</span></a>            <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">closure_size_filter</span><span class="p">(</span>
</span><span id="L-1018"><a href="#-1018"><span class="linenos">1018</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">simple_closures_oil</span><span class="p">[:],</span>
</span><span id="L-1019"><a href="#-1019"><span class="linenos">1019</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">closure_min_voxels_simple</span><span class="p">,</span>
</span><span id="L-1020"><a href="#-1020"><span class="linenos">1020</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">n_4way_closures_oil</span><span class="p">,</span>
</span><span id="L-1021"><a href="#-1021"><span class="linenos">1021</span></a>            <span class="p">)</span>
</span><span id="L-1022"><a href="#-1022"><span class="linenos">1022</span></a>            <span class="p">(</span>
</span><span id="L-1023"><a href="#-1023"><span class="linenos">1023</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">simple_closures_gas</span><span class="p">[:],</span>
</span><span id="L-1024"><a href="#-1024"><span class="linenos">1024</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">n_4way_closures_gas</span><span class="p">,</span>
</span><span id="L-1025"><a href="#-1025"><span class="linenos">1025</span></a>            <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">closure_size_filter</span><span class="p">(</span>
</span><span id="L-1026"><a href="#-1026"><span class="linenos">1026</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">simple_closures_gas</span><span class="p">[:],</span>
</span><span id="L-1027"><a href="#-1027"><span class="linenos">1027</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">closure_min_voxels_simple</span><span class="p">,</span>
</span><span id="L-1028"><a href="#-1028"><span class="linenos">1028</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">n_4way_closures_gas</span><span class="p">,</span>
</span><span id="L-1029"><a href="#-1029"><span class="linenos">1029</span></a>            <span class="p">)</span>
</span><span id="L-1030"><a href="#-1030"><span class="linenos">1030</span></a>
</span><span id="L-1031"><a href="#-1031"><span class="linenos">1031</span></a>            <span class="c1"># Add simple closures to closure code cube</span>
</span><span id="L-1032"><a href="#-1032"><span class="linenos">1032</span></a>            <span class="n">hc_closures</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-1033"><a href="#-1033"><span class="linenos">1033</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">simple_closures_oil</span><span class="p">[:]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">simple_closures_gas</span><span class="p">[:]</span>
</span><span id="L-1034"><a href="#-1034"><span class="linenos">1034</span></a>            <span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;float32&quot;</span><span class="p">)</span>
</span><span id="L-1035"><a href="#-1035"><span class="linenos">1035</span></a>            <span class="n">labels</span><span class="p">,</span> <span class="n">num</span> <span class="o">=</span> <span class="n">measure</span><span class="o">.</span><span class="n">label</span><span class="p">(</span>
</span><span id="L-1036"><a href="#-1036"><span class="linenos">1036</span></a>                <span class="n">hc_closures</span><span class="p">,</span> <span class="n">connectivity</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">background</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">return_num</span><span class="o">=</span><span class="kc">True</span>
</span><span id="L-1037"><a href="#-1037"><span class="linenos">1037</span></a>            <span class="p">)</span>
</span><span id="L-1038"><a href="#-1038"><span class="linenos">1038</span></a>            <span class="n">hc_closure_codes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_closure_codes</span><span class="p">(</span>
</span><span id="L-1039"><a href="#-1039"><span class="linenos">1039</span></a>                <span class="n">hc_closure_codes</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">num</span><span class="p">,</span> <span class="n">code</span><span class="o">=</span><span class="mf">0.1</span>
</span><span id="L-1040"><a href="#-1040"><span class="linenos">1040</span></a>            <span class="p">)</span>
</span><span id="L-1041"><a href="#-1041"><span class="linenos">1041</span></a>        <span class="k">else</span><span class="p">:</span>  <span class="c1"># if closure type not in config, set HC closures to 0</span>
</span><span id="L-1042"><a href="#-1042"><span class="linenos">1042</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">simple_closures_oil</span><span class="p">[:]</span> <span class="o">*=</span> <span class="mi">0</span>
</span><span id="L-1043"><a href="#-1043"><span class="linenos">1043</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">simple_closures_gas</span><span class="p">[:]</span> <span class="o">*=</span> <span class="mi">0</span>
</span><span id="L-1044"><a href="#-1044"><span class="linenos">1044</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">simple_all_closures</span><span class="p">[:]</span> <span class="o">*=</span> <span class="mi">0</span>
</span><span id="L-1045"><a href="#-1045"><span class="linenos">1045</span></a>
</span><span id="L-1046"><a href="#-1046"><span class="linenos">1046</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">oil_closures</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">simple_closures_oil</span><span class="p">[:]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="L-1047"><a href="#-1047"><span class="linenos">1047</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">oil_closures</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">simple_closures_oil</span><span class="p">[:]</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="L-1048"><a href="#-1048"><span class="linenos">1048</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gas_closures</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">simple_closures_gas</span><span class="p">[:]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="L-1049"><a href="#-1049"><span class="linenos">1049</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gas_closures</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">simple_closures_gas</span><span class="p">[:]</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="L-1050"><a href="#-1050"><span class="linenos">1050</span></a>
</span><span id="L-1051"><a href="#-1051"><span class="linenos">1051</span></a>        <span class="n">all_closures_final</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">simple_all_closures</span><span class="p">[:]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="L-1052"><a href="#-1052"><span class="linenos">1052</span></a>        <span class="n">all_closures_final</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">simple_all_closures</span><span class="p">[:]</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="L-1053"><a href="#-1053"><span class="linenos">1053</span></a>
</span><span id="L-1054"><a href="#-1054"><span class="linenos">1054</span></a>        <span class="k">if</span> <span class="s2">&quot;faulted&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">closure_types</span><span class="p">:</span>
</span><span id="L-1055"><a href="#-1055"><span class="linenos">1055</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Filtering 4 Way Closures&quot;</span><span class="p">)</span>
</span><span id="L-1056"><a href="#-1056"><span class="linenos">1056</span></a>            <span class="c1"># Grow the faulted closures to the fault planes</span>
</span><span id="L-1057"><a href="#-1057"><span class="linenos">1057</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">faulted_closures_oil</span><span class="p">[:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grow_to_fault2</span><span class="p">(</span>
</span><span id="L-1058"><a href="#-1058"><span class="linenos">1058</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">faulted_closures_oil</span><span class="p">[:]</span>
</span><span id="L-1059"><a href="#-1059"><span class="linenos">1059</span></a>            <span class="p">)</span>
</span><span id="L-1060"><a href="#-1060"><span class="linenos">1060</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">faulted_closures_gas</span><span class="p">[:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grow_to_fault2</span><span class="p">(</span>
</span><span id="L-1061"><a href="#-1061"><span class="linenos">1061</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">faulted_closures_gas</span><span class="p">[:]</span>
</span><span id="L-1062"><a href="#-1062"><span class="linenos">1062</span></a>            <span class="p">)</span>
</span><span id="L-1063"><a href="#-1063"><span class="linenos">1063</span></a>
</span><span id="L-1064"><a href="#-1064"><span class="linenos">1064</span></a>            <span class="p">(</span>
</span><span id="L-1065"><a href="#-1065"><span class="linenos">1065</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">faulted_closures_oil</span><span class="p">[:],</span>
</span><span id="L-1066"><a href="#-1066"><span class="linenos">1066</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">n_fault_closures_oil</span><span class="p">,</span>
</span><span id="L-1067"><a href="#-1067"><span class="linenos">1067</span></a>            <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">closure_size_filter</span><span class="p">(</span>
</span><span id="L-1068"><a href="#-1068"><span class="linenos">1068</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">faulted_closures_oil</span><span class="p">[:],</span>
</span><span id="L-1069"><a href="#-1069"><span class="linenos">1069</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">closure_min_voxels_faulted</span><span class="p">,</span>
</span><span id="L-1070"><a href="#-1070"><span class="linenos">1070</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">n_fault_closures_oil</span><span class="p">,</span>
</span><span id="L-1071"><a href="#-1071"><span class="linenos">1071</span></a>            <span class="p">)</span>
</span><span id="L-1072"><a href="#-1072"><span class="linenos">1072</span></a>            <span class="p">(</span>
</span><span id="L-1073"><a href="#-1073"><span class="linenos">1073</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">faulted_closures_gas</span><span class="p">[:],</span>
</span><span id="L-1074"><a href="#-1074"><span class="linenos">1074</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">n_fault_closures_gas</span><span class="p">,</span>
</span><span id="L-1075"><a href="#-1075"><span class="linenos">1075</span></a>            <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">closure_size_filter</span><span class="p">(</span>
</span><span id="L-1076"><a href="#-1076"><span class="linenos">1076</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">faulted_closures_gas</span><span class="p">[:],</span>
</span><span id="L-1077"><a href="#-1077"><span class="linenos">1077</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">closure_min_voxels_faulted</span><span class="p">,</span>
</span><span id="L-1078"><a href="#-1078"><span class="linenos">1078</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">n_fault_closures_gas</span><span class="p">,</span>
</span><span id="L-1079"><a href="#-1079"><span class="linenos">1079</span></a>            <span class="p">)</span>
</span><span id="L-1080"><a href="#-1080"><span class="linenos">1080</span></a>
</span><span id="L-1081"><a href="#-1081"><span class="linenos">1081</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">faulted_all_closures</span><span class="p">[:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grow_to_fault2</span><span class="p">(</span>
</span><span id="L-1082"><a href="#-1082"><span class="linenos">1082</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">faulted_all_closures</span><span class="p">[:],</span>
</span><span id="L-1083"><a href="#-1083"><span class="linenos">1083</span></a>                <span class="n">grow_only_sand_closures</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="L-1084"><a href="#-1084"><span class="linenos">1084</span></a>                <span class="n">remove_small_closures</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="L-1085"><a href="#-1085"><span class="linenos">1085</span></a>            <span class="p">)</span>
</span><span id="L-1086"><a href="#-1086"><span class="linenos">1086</span></a>
</span><span id="L-1087"><a href="#-1087"><span class="linenos">1087</span></a>            <span class="c1"># Add faulted closures to closure code cube</span>
</span><span id="L-1088"><a href="#-1088"><span class="linenos">1088</span></a>            <span class="n">hc_closures</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">faulted_closures_oil</span><span class="p">[:]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">faulted_closures_gas</span><span class="p">[:]</span>
</span><span id="L-1089"><a href="#-1089"><span class="linenos">1089</span></a>            <span class="n">labels</span><span class="p">,</span> <span class="n">num</span> <span class="o">=</span> <span class="n">measure</span><span class="o">.</span><span class="n">label</span><span class="p">(</span>
</span><span id="L-1090"><a href="#-1090"><span class="linenos">1090</span></a>                <span class="n">hc_closures</span><span class="p">,</span> <span class="n">connectivity</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">background</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">return_num</span><span class="o">=</span><span class="kc">True</span>
</span><span id="L-1091"><a href="#-1091"><span class="linenos">1091</span></a>            <span class="p">)</span>
</span><span id="L-1092"><a href="#-1092"><span class="linenos">1092</span></a>            <span class="n">hc_closure_codes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_closure_codes</span><span class="p">(</span>
</span><span id="L-1093"><a href="#-1093"><span class="linenos">1093</span></a>                <span class="n">hc_closure_codes</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">num</span><span class="p">,</span> <span class="n">code</span><span class="o">=</span><span class="mf">0.2</span>
</span><span id="L-1094"><a href="#-1094"><span class="linenos">1094</span></a>            <span class="p">)</span>
</span><span id="L-1095"><a href="#-1095"><span class="linenos">1095</span></a>        <span class="k">else</span><span class="p">:</span>  <span class="c1"># if closure type not in config, set HC closures to 0</span>
</span><span id="L-1096"><a href="#-1096"><span class="linenos">1096</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">faulted_closures_oil</span><span class="p">[:]</span> <span class="o">*=</span> <span class="mi">0</span>
</span><span id="L-1097"><a href="#-1097"><span class="linenos">1097</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">faulted_closures_gas</span><span class="p">[:]</span> <span class="o">*=</span> <span class="mi">0</span>
</span><span id="L-1098"><a href="#-1098"><span class="linenos">1098</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">faulted_all_closures</span><span class="p">[:]</span> <span class="o">*=</span> <span class="mi">0</span>
</span><span id="L-1099"><a href="#-1099"><span class="linenos">1099</span></a>
</span><span id="L-1100"><a href="#-1100"><span class="linenos">1100</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">oil_closures</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">faulted_closures_oil</span><span class="p">[:]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="L-1101"><a href="#-1101"><span class="linenos">1101</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">oil_closures</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">faulted_closures_oil</span><span class="p">[:]</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="L-1102"><a href="#-1102"><span class="linenos">1102</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gas_closures</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">faulted_closures_gas</span><span class="p">[:]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="L-1103"><a href="#-1103"><span class="linenos">1103</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gas_closures</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">faulted_closures_gas</span><span class="p">[:]</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="L-1104"><a href="#-1104"><span class="linenos">1104</span></a>
</span><span id="L-1105"><a href="#-1105"><span class="linenos">1105</span></a>        <span class="n">all_closures_final</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">faulted_all_closures</span><span class="p">[:]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="L-1106"><a href="#-1106"><span class="linenos">1106</span></a>        <span class="n">all_closures_final</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">faulted_all_closures</span><span class="p">[:]</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="L-1107"><a href="#-1107"><span class="linenos">1107</span></a>
</span><span id="L-1108"><a href="#-1108"><span class="linenos">1108</span></a>        <span class="k">if</span> <span class="s2">&quot;onlap&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">closure_types</span><span class="p">:</span>
</span><span id="L-1109"><a href="#-1109"><span class="linenos">1109</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Filtering Onlap Closures&quot;</span><span class="p">)</span>
</span><span id="L-1110"><a href="#-1110"><span class="linenos">1110</span></a>            <span class="p">(</span>
</span><span id="L-1111"><a href="#-1111"><span class="linenos">1111</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">onlap_closures_oil</span><span class="p">[:],</span>
</span><span id="L-1112"><a href="#-1112"><span class="linenos">1112</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">n_onlap_closures_oil</span><span class="p">,</span>
</span><span id="L-1113"><a href="#-1113"><span class="linenos">1113</span></a>            <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">closure_size_filter</span><span class="p">(</span>
</span><span id="L-1114"><a href="#-1114"><span class="linenos">1114</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">onlap_closures_oil</span><span class="p">[:],</span>
</span><span id="L-1115"><a href="#-1115"><span class="linenos">1115</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">closure_min_voxels_onlap</span><span class="p">,</span>
</span><span id="L-1116"><a href="#-1116"><span class="linenos">1116</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">n_onlap_closures_oil</span><span class="p">,</span>
</span><span id="L-1117"><a href="#-1117"><span class="linenos">1117</span></a>            <span class="p">)</span>
</span><span id="L-1118"><a href="#-1118"><span class="linenos">1118</span></a>            <span class="p">(</span>
</span><span id="L-1119"><a href="#-1119"><span class="linenos">1119</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">onlap_closures_gas</span><span class="p">[:],</span>
</span><span id="L-1120"><a href="#-1120"><span class="linenos">1120</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">n_onlap_closures_gas</span><span class="p">,</span>
</span><span id="L-1121"><a href="#-1121"><span class="linenos">1121</span></a>            <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">closure_size_filter</span><span class="p">(</span>
</span><span id="L-1122"><a href="#-1122"><span class="linenos">1122</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">onlap_closures_gas</span><span class="p">[:],</span>
</span><span id="L-1123"><a href="#-1123"><span class="linenos">1123</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">closure_min_voxels_onlap</span><span class="p">,</span>
</span><span id="L-1124"><a href="#-1124"><span class="linenos">1124</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">n_onlap_closures_gas</span><span class="p">,</span>
</span><span id="L-1125"><a href="#-1125"><span class="linenos">1125</span></a>            <span class="p">)</span>
</span><span id="L-1126"><a href="#-1126"><span class="linenos">1126</span></a>
</span><span id="L-1127"><a href="#-1127"><span class="linenos">1127</span></a>            <span class="c1"># Add faulted closures to closure code cube</span>
</span><span id="L-1128"><a href="#-1128"><span class="linenos">1128</span></a>            <span class="n">hc_closures</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">onlap_closures_oil</span><span class="p">[:]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">onlap_closures_gas</span><span class="p">[:]</span>
</span><span id="L-1129"><a href="#-1129"><span class="linenos">1129</span></a>            <span class="n">labels</span><span class="p">,</span> <span class="n">num</span> <span class="o">=</span> <span class="n">measure</span><span class="o">.</span><span class="n">label</span><span class="p">(</span>
</span><span id="L-1130"><a href="#-1130"><span class="linenos">1130</span></a>                <span class="n">hc_closures</span><span class="p">,</span> <span class="n">connectivity</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">background</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">return_num</span><span class="o">=</span><span class="kc">True</span>
</span><span id="L-1131"><a href="#-1131"><span class="linenos">1131</span></a>            <span class="p">)</span>
</span><span id="L-1132"><a href="#-1132"><span class="linenos">1132</span></a>            <span class="n">hc_closure_codes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_closure_codes</span><span class="p">(</span>
</span><span id="L-1133"><a href="#-1133"><span class="linenos">1133</span></a>                <span class="n">hc_closure_codes</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">num</span><span class="p">,</span> <span class="n">code</span><span class="o">=</span><span class="mf">0.3</span>
</span><span id="L-1134"><a href="#-1134"><span class="linenos">1134</span></a>            <span class="p">)</span>
</span><span id="L-1135"><a href="#-1135"><span class="linenos">1135</span></a>            <span class="c1"># labels = labels.astype(&#39;float32&#39;)</span>
</span><span id="L-1136"><a href="#-1136"><span class="linenos">1136</span></a>            <span class="c1"># if num &gt; 0:</span>
</span><span id="L-1137"><a href="#-1137"><span class="linenos">1137</span></a>            <span class="c1">#     for x in range(1, num + 1):</span>
</span><span id="L-1138"><a href="#-1138"><span class="linenos">1138</span></a>            <span class="c1">#         y = 0.3 + labels[labels == x].size</span>
</span><span id="L-1139"><a href="#-1139"><span class="linenos">1139</span></a>            <span class="c1">#         labels[labels == x] = y</span>
</span><span id="L-1140"><a href="#-1140"><span class="linenos">1140</span></a>            <span class="c1">#     hc_closure_codes += labels</span>
</span><span id="L-1141"><a href="#-1141"><span class="linenos">1141</span></a>        <span class="k">else</span><span class="p">:</span>  <span class="c1"># if closure type not in config, set HC closures to 0</span>
</span><span id="L-1142"><a href="#-1142"><span class="linenos">1142</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">onlap_closures_oil</span><span class="p">[:]</span> <span class="o">*=</span> <span class="mi">0</span>
</span><span id="L-1143"><a href="#-1143"><span class="linenos">1143</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">onlap_closures_gas</span><span class="p">[:]</span> <span class="o">*=</span> <span class="mi">0</span>
</span><span id="L-1144"><a href="#-1144"><span class="linenos">1144</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">onlap_all_closures</span><span class="p">[:]</span> <span class="o">*=</span> <span class="mi">0</span>
</span><span id="L-1145"><a href="#-1145"><span class="linenos">1145</span></a>
</span><span id="L-1146"><a href="#-1146"><span class="linenos">1146</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">oil_closures</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">onlap_closures_oil</span><span class="p">[:]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="L-1147"><a href="#-1147"><span class="linenos">1147</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">oil_closures</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">onlap_closures_oil</span><span class="p">[:]</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="L-1148"><a href="#-1148"><span class="linenos">1148</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gas_closures</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">onlap_closures_gas</span><span class="p">[:]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="L-1149"><a href="#-1149"><span class="linenos">1149</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gas_closures</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">onlap_closures_gas</span><span class="p">[:]</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="L-1150"><a href="#-1150"><span class="linenos">1150</span></a>        <span class="n">all_closures_final</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">onlap_all_closures</span><span class="p">[:]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="L-1151"><a href="#-1151"><span class="linenos">1151</span></a>        <span class="n">all_closures_final</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">onlap_all_closures</span><span class="p">[:]</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="L-1152"><a href="#-1152"><span class="linenos">1152</span></a>
</span><span id="L-1153"><a href="#-1153"><span class="linenos">1153</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">include_salt</span><span class="p">:</span>
</span><span id="L-1154"><a href="#-1154"><span class="linenos">1154</span></a>            <span class="c1"># Grow the salt-bounded closures to the salt body</span>
</span><span id="L-1155"><a href="#-1155"><span class="linenos">1155</span></a>            <span class="n">salt_closures_oil_grown</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">salt_closures_oil</span><span class="p">[:])</span>
</span><span id="L-1156"><a href="#-1156"><span class="linenos">1156</span></a>            <span class="n">salt_closures_gas_grown</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">salt_closures_gas</span><span class="p">[:])</span>
</span><span id="L-1157"><a href="#-1157"><span class="linenos">1157</span></a>
</span><span id="L-1158"><a href="#-1158"><span class="linenos">1158</span></a>            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">salt_closures_oil</span><span class="p">[:])</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
</span><span id="L-1159"><a href="#-1159"><span class="linenos">1159</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">write_cube_to_disk</span><span class="p">(</span>
</span><span id="L-1160"><a href="#-1160"><span class="linenos">1160</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">salt_closures_oil</span><span class="p">[:],</span> <span class="s2">&quot;salt_closures_oil_initial&quot;</span>
</span><span id="L-1161"><a href="#-1161"><span class="linenos">1161</span></a>                <span class="p">)</span>
</span><span id="L-1162"><a href="#-1162"><span class="linenos">1162</span></a>                <span class="nb">print</span><span class="p">(</span>
</span><span id="L-1163"><a href="#-1163"><span class="linenos">1163</span></a>                    <span class="sa">f</span><span class="s2">&quot;Salt-bounded Oil Closure voxel count: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">salt_closures_oil</span><span class="p">[:][</span><span class="bp">self</span><span class="o">.</span><span class="n">salt_closures_oil</span><span class="p">[:]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-1164"><a href="#-1164"><span class="linenos">1164</span></a>                <span class="p">)</span>
</span><span id="L-1165"><a href="#-1165"><span class="linenos">1165</span></a>                <span class="n">salt_closures_oil_grown</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grow_to_salt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">salt_closures_oil</span><span class="p">[:])</span>
</span><span id="L-1166"><a href="#-1166"><span class="linenos">1166</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">salt_closures_oil</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">salt_closures_oil_grown</span>
</span><span id="L-1167"><a href="#-1167"><span class="linenos">1167</span></a>                <span class="nb">print</span><span class="p">(</span>
</span><span id="L-1168"><a href="#-1168"><span class="linenos">1168</span></a>                    <span class="sa">f</span><span class="s2">&quot;Salt-bounded Oil Closure voxel count: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">salt_closures_oil</span><span class="p">[:][</span><span class="bp">self</span><span class="o">.</span><span class="n">salt_closures_oil</span><span class="p">[:]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-1169"><a href="#-1169"><span class="linenos">1169</span></a>                <span class="p">)</span>
</span><span id="L-1170"><a href="#-1170"><span class="linenos">1170</span></a>            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">salt_closures_gas</span><span class="p">[:])</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
</span><span id="L-1171"><a href="#-1171"><span class="linenos">1171</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">write_cube_to_disk</span><span class="p">(</span>
</span><span id="L-1172"><a href="#-1172"><span class="linenos">1172</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">salt_closures_gas</span><span class="p">[:],</span> <span class="s2">&quot;salt_closures_gas_initial&quot;</span>
</span><span id="L-1173"><a href="#-1173"><span class="linenos">1173</span></a>                <span class="p">)</span>
</span><span id="L-1174"><a href="#-1174"><span class="linenos">1174</span></a>                <span class="nb">print</span><span class="p">(</span>
</span><span id="L-1175"><a href="#-1175"><span class="linenos">1175</span></a>                    <span class="sa">f</span><span class="s2">&quot;Salt-bounded Gas Closure voxel count: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">salt_closures_gas</span><span class="p">[:][</span><span class="bp">self</span><span class="o">.</span><span class="n">salt_closures_gas</span><span class="p">[:]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-1176"><a href="#-1176"><span class="linenos">1176</span></a>                <span class="p">)</span>
</span><span id="L-1177"><a href="#-1177"><span class="linenos">1177</span></a>                <span class="n">salt_closures_gas_grown</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grow_to_salt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">salt_closures_gas</span><span class="p">[:])</span>
</span><span id="L-1178"><a href="#-1178"><span class="linenos">1178</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">salt_closures_gas</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">salt_closures_gas_grown</span>
</span><span id="L-1179"><a href="#-1179"><span class="linenos">1179</span></a>                <span class="nb">print</span><span class="p">(</span>
</span><span id="L-1180"><a href="#-1180"><span class="linenos">1180</span></a>                    <span class="sa">f</span><span class="s2">&quot;Salt-bounded Gas Closure voxel count: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">salt_closures_gas</span><span class="p">[:][</span><span class="bp">self</span><span class="o">.</span><span class="n">salt_closures_gas</span><span class="p">[:]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-1181"><a href="#-1181"><span class="linenos">1181</span></a>                <span class="p">)</span>
</span><span id="L-1182"><a href="#-1182"><span class="linenos">1182</span></a>            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">salt_all_closures</span><span class="p">[:])</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
</span><span id="L-1183"><a href="#-1183"><span class="linenos">1183</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">write_cube_to_disk</span><span class="p">(</span>
</span><span id="L-1184"><a href="#-1184"><span class="linenos">1184</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">salt_all_closures</span><span class="p">[:],</span> <span class="s2">&quot;salt_all_closures_initial&quot;</span>
</span><span id="L-1185"><a href="#-1185"><span class="linenos">1185</span></a>                <span class="p">)</span>  <span class="c1"># maybe remove later</span>
</span><span id="L-1186"><a href="#-1186"><span class="linenos">1186</span></a>                <span class="nb">print</span><span class="p">(</span>
</span><span id="L-1187"><a href="#-1187"><span class="linenos">1187</span></a>                    <span class="sa">f</span><span class="s2">&quot;Salt-bounded All Closure voxel count: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">salt_all_closures</span><span class="p">[:][</span><span class="bp">self</span><span class="o">.</span><span class="n">salt_all_closures</span><span class="p">[:]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-1188"><a href="#-1188"><span class="linenos">1188</span></a>                <span class="p">)</span>
</span><span id="L-1189"><a href="#-1189"><span class="linenos">1189</span></a>                <span class="n">salt_all_closures_grown</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grow_to_salt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">salt_all_closures</span><span class="p">[:])</span>
</span><span id="L-1190"><a href="#-1190"><span class="linenos">1190</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">salt_all_closures</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">salt_all_closures_grown</span>
</span><span id="L-1191"><a href="#-1191"><span class="linenos">1191</span></a>                <span class="nb">print</span><span class="p">(</span>
</span><span id="L-1192"><a href="#-1192"><span class="linenos">1192</span></a>                    <span class="sa">f</span><span class="s2">&quot;Salt-bounded All Closure voxel count: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">salt_all_closures</span><span class="p">[:][</span><span class="bp">self</span><span class="o">.</span><span class="n">salt_all_closures</span><span class="p">[:]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-1193"><a href="#-1193"><span class="linenos">1193</span></a>                <span class="p">)</span>
</span><span id="L-1194"><a href="#-1194"><span class="linenos">1194</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-1195"><a href="#-1195"><span class="linenos">1195</span></a>                <span class="n">salt_all_closures_grown</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">salt_all_closures</span><span class="p">)</span>
</span><span id="L-1196"><a href="#-1196"><span class="linenos">1196</span></a>
</span><span id="L-1197"><a href="#-1197"><span class="linenos">1197</span></a>            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">salt_closures_oil</span><span class="p">[:])</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
</span><span id="L-1198"><a href="#-1198"><span class="linenos">1198</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">write_cube_to_disk</span><span class="p">(</span>
</span><span id="L-1199"><a href="#-1199"><span class="linenos">1199</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">salt_closures_oil</span><span class="p">[:],</span> <span class="s2">&quot;salt_closures_oil_grown&quot;</span>
</span><span id="L-1200"><a href="#-1200"><span class="linenos">1200</span></a>                <span class="p">)</span>
</span><span id="L-1201"><a href="#-1201"><span class="linenos">1201</span></a>            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">salt_closures_gas</span><span class="p">[:])</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
</span><span id="L-1202"><a href="#-1202"><span class="linenos">1202</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">write_cube_to_disk</span><span class="p">(</span>
</span><span id="L-1203"><a href="#-1203"><span class="linenos">1203</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">salt_closures_gas</span><span class="p">[:],</span> <span class="s2">&quot;salt_closures_gas_grown&quot;</span>
</span><span id="L-1204"><a href="#-1204"><span class="linenos">1204</span></a>                <span class="p">)</span>
</span><span id="L-1205"><a href="#-1205"><span class="linenos">1205</span></a>            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">salt_all_closures</span><span class="p">[:])</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
</span><span id="L-1206"><a href="#-1206"><span class="linenos">1206</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">write_cube_to_disk</span><span class="p">(</span>
</span><span id="L-1207"><a href="#-1207"><span class="linenos">1207</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">salt_all_closures</span><span class="p">[:],</span> <span class="s2">&quot;salt_all_closures_grown&quot;</span>
</span><span id="L-1208"><a href="#-1208"><span class="linenos">1208</span></a>                <span class="p">)</span>  <span class="c1"># maybe remove later</span>
</span><span id="L-1209"><a href="#-1209"><span class="linenos">1209</span></a>
</span><span id="L-1210"><a href="#-1210"><span class="linenos">1210</span></a>            <span class="p">(</span>
</span><span id="L-1211"><a href="#-1211"><span class="linenos">1211</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">salt_closures_oil</span><span class="p">[:],</span>
</span><span id="L-1212"><a href="#-1212"><span class="linenos">1212</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">n_salt_closures_oil</span><span class="p">,</span>
</span><span id="L-1213"><a href="#-1213"><span class="linenos">1213</span></a>            <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">closure_size_filter</span><span class="p">(</span>
</span><span id="L-1214"><a href="#-1214"><span class="linenos">1214</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">salt_closures_oil</span><span class="p">[:],</span>
</span><span id="L-1215"><a href="#-1215"><span class="linenos">1215</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">closure_min_voxels</span><span class="p">,</span>
</span><span id="L-1216"><a href="#-1216"><span class="linenos">1216</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">n_salt_closures_oil</span><span class="p">,</span>
</span><span id="L-1217"><a href="#-1217"><span class="linenos">1217</span></a>            <span class="p">)</span>
</span><span id="L-1218"><a href="#-1218"><span class="linenos">1218</span></a>            <span class="p">(</span>
</span><span id="L-1219"><a href="#-1219"><span class="linenos">1219</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">salt_closures_gas</span><span class="p">[:],</span>
</span><span id="L-1220"><a href="#-1220"><span class="linenos">1220</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">n_salt_closures_gas</span><span class="p">,</span>
</span><span id="L-1221"><a href="#-1221"><span class="linenos">1221</span></a>            <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">closure_size_filter</span><span class="p">(</span>
</span><span id="L-1222"><a href="#-1222"><span class="linenos">1222</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">salt_closures_gas</span><span class="p">[:],</span>
</span><span id="L-1223"><a href="#-1223"><span class="linenos">1223</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">closure_min_voxels</span><span class="p">,</span>
</span><span id="L-1224"><a href="#-1224"><span class="linenos">1224</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">n_salt_closures_gas</span><span class="p">,</span>
</span><span id="L-1225"><a href="#-1225"><span class="linenos">1225</span></a>            <span class="p">)</span>
</span><span id="L-1226"><a href="#-1226"><span class="linenos">1226</span></a>
</span><span id="L-1227"><a href="#-1227"><span class="linenos">1227</span></a>            <span class="c1"># Append salt-bounded closures to main closure cubes for oil and gas</span>
</span><span id="L-1228"><a href="#-1228"><span class="linenos">1228</span></a>            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">salt_closures_oil_grown</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
</span><span id="L-1229"><a href="#-1229"><span class="linenos">1229</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">oil_closures</span><span class="p">[</span><span class="n">salt_closures_oil_grown</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="L-1230"><a href="#-1230"><span class="linenos">1230</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">oil_closures</span><span class="p">[</span><span class="n">salt_closures_oil_grown</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="L-1231"><a href="#-1231"><span class="linenos">1231</span></a>            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">salt_closures_gas_grown</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
</span><span id="L-1232"><a href="#-1232"><span class="linenos">1232</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">gas_closures</span><span class="p">[</span><span class="n">salt_closures_gas_grown</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="L-1233"><a href="#-1233"><span class="linenos">1233</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">gas_closures</span><span class="p">[</span><span class="n">salt_closures_gas_grown</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="L-1234"><a href="#-1234"><span class="linenos">1234</span></a>            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">salt_all_closures_grown</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
</span><span id="L-1235"><a href="#-1235"><span class="linenos">1235</span></a>                <span class="n">all_closures_final</span><span class="p">[</span><span class="n">salt_all_closures_grown</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="L-1236"><a href="#-1236"><span class="linenos">1236</span></a>                <span class="n">all_closures_final</span><span class="p">[</span><span class="n">salt_all_closures_grown</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="L-1237"><a href="#-1237"><span class="linenos">1237</span></a>
</span><span id="L-1238"><a href="#-1238"><span class="linenos">1238</span></a>            <span class="c1"># Add faulted closures to closure code cube</span>
</span><span id="L-1239"><a href="#-1239"><span class="linenos">1239</span></a>            <span class="n">hc_closures</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">salt_closures_oil</span><span class="p">[:]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">salt_closures_gas</span><span class="p">[:]</span>
</span><span id="L-1240"><a href="#-1240"><span class="linenos">1240</span></a>            <span class="n">labels</span><span class="p">,</span> <span class="n">num</span> <span class="o">=</span> <span class="n">measure</span><span class="o">.</span><span class="n">label</span><span class="p">(</span>
</span><span id="L-1241"><a href="#-1241"><span class="linenos">1241</span></a>                <span class="n">hc_closures</span><span class="p">,</span> <span class="n">connectivity</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">background</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">return_num</span><span class="o">=</span><span class="kc">True</span>
</span><span id="L-1242"><a href="#-1242"><span class="linenos">1242</span></a>            <span class="p">)</span>
</span><span id="L-1243"><a href="#-1243"><span class="linenos">1243</span></a>            <span class="n">hc_closure_codes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_closure_codes</span><span class="p">(</span>
</span><span id="L-1244"><a href="#-1244"><span class="linenos">1244</span></a>                <span class="n">hc_closure_codes</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">num</span><span class="p">,</span> <span class="n">code</span><span class="o">=</span><span class="mf">0.4</span>
</span><span id="L-1245"><a href="#-1245"><span class="linenos">1245</span></a>            <span class="p">)</span>
</span><span id="L-1246"><a href="#-1246"><span class="linenos">1246</span></a>
</span><span id="L-1247"><a href="#-1247"><span class="linenos">1247</span></a>        <span class="c1"># Write hc_closure_codes to disk</span>
</span><span id="L-1248"><a href="#-1248"><span class="linenos">1248</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">write_cube_to_disk</span><span class="p">(</span><span class="n">hc_closure_codes</span><span class="p">,</span> <span class="s2">&quot;closure_segments_hc_voxelcount&quot;</span><span class="p">)</span>
</span><span id="L-1249"><a href="#-1249"><span class="linenos">1249</span></a>
</span><span id="L-1250"><a href="#-1250"><span class="linenos">1250</span></a>        <span class="c1"># Create closure volumes by type</span>
</span><span id="L-1251"><a href="#-1251"><span class="linenos">1251</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">simple_closures</span><span class="p">[:]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1252"><a href="#-1252"><span class="linenos">1252</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">simple_closures</span><span class="p">[:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">simple_closures_oil</span><span class="p">[:]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;uint8&quot;</span><span class="p">)</span>
</span><span id="L-1253"><a href="#-1253"><span class="linenos">1253</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1254"><a href="#-1254"><span class="linenos">1254</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">simple_closures</span><span class="p">[:]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">simple_closures_oil</span><span class="p">[:]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;uint8&quot;</span><span class="p">)</span>
</span><span id="L-1255"><a href="#-1255"><span class="linenos">1255</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">simple_closures</span><span class="p">[:]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">simple_closures_gas</span><span class="p">[:]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;uint8&quot;</span><span class="p">)</span>
</span><span id="L-1256"><a href="#-1256"><span class="linenos">1256</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">simple_closures</span><span class="p">[:]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">simple_closures_brine</span><span class="p">[:]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;uint8&quot;</span><span class="p">)</span>
</span><span id="L-1257"><a href="#-1257"><span class="linenos">1257</span></a>        <span class="c1"># Onlap closures</span>
</span><span id="L-1258"><a href="#-1258"><span class="linenos">1258</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">strat_closures</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1259"><a href="#-1259"><span class="linenos">1259</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">strat_closures</span><span class="p">[:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">onlap_closures_oil</span><span class="p">[:]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;uint8&quot;</span><span class="p">)</span>
</span><span id="L-1260"><a href="#-1260"><span class="linenos">1260</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1261"><a href="#-1261"><span class="linenos">1261</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">strat_closures</span><span class="p">[:]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">onlap_closures_oil</span><span class="p">[:]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;uint8&quot;</span><span class="p">)</span>
</span><span id="L-1262"><a href="#-1262"><span class="linenos">1262</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">strat_closures</span><span class="p">[:]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">onlap_closures_gas</span><span class="p">[:]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;uint8&quot;</span><span class="p">)</span>
</span><span id="L-1263"><a href="#-1263"><span class="linenos">1263</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">strat_closures</span><span class="p">[:]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">onlap_closures_brine</span><span class="p">[:]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;uint8&quot;</span><span class="p">)</span>
</span><span id="L-1264"><a href="#-1264"><span class="linenos">1264</span></a>        <span class="c1"># Fault closures</span>
</span><span id="L-1265"><a href="#-1265"><span class="linenos">1265</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fault_closures</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1266"><a href="#-1266"><span class="linenos">1266</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">fault_closures</span><span class="p">[:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">faulted_closures_oil</span><span class="p">[:]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;uint8&quot;</span><span class="p">)</span>
</span><span id="L-1267"><a href="#-1267"><span class="linenos">1267</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1268"><a href="#-1268"><span class="linenos">1268</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">fault_closures</span><span class="p">[:]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">faulted_closures_oil</span><span class="p">[:]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;uint8&quot;</span><span class="p">)</span>
</span><span id="L-1269"><a href="#-1269"><span class="linenos">1269</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fault_closures</span><span class="p">[:]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">faulted_closures_gas</span><span class="p">[:]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;uint8&quot;</span><span class="p">)</span>
</span><span id="L-1270"><a href="#-1270"><span class="linenos">1270</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fault_closures</span><span class="p">[:]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">faulted_closures_brine</span><span class="p">[:]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;uint8&quot;</span><span class="p">)</span>
</span><span id="L-1271"><a href="#-1271"><span class="linenos">1271</span></a>
</span><span id="L-1272"><a href="#-1272"><span class="linenos">1272</span></a>        <span class="c1"># Salt-bounded closures</span>
</span><span id="L-1273"><a href="#-1273"><span class="linenos">1273</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">include_salt</span><span class="p">:</span>
</span><span id="L-1274"><a href="#-1274"><span class="linenos">1274</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">salt_closures</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1275"><a href="#-1275"><span class="linenos">1275</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">salt_closures</span><span class="p">[:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">salt_closures_oil</span><span class="p">[:]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;uint8&quot;</span><span class="p">)</span>
</span><span id="L-1276"><a href="#-1276"><span class="linenos">1276</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-1277"><a href="#-1277"><span class="linenos">1277</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">salt_closures</span><span class="p">[:]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">salt_closures_oil</span><span class="p">[:]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;uint8&quot;</span><span class="p">)</span>
</span><span id="L-1278"><a href="#-1278"><span class="linenos">1278</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">salt_closures</span><span class="p">[:]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">salt_closures_gas</span><span class="p">[:]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;uint8&quot;</span><span class="p">)</span>
</span><span id="L-1279"><a href="#-1279"><span class="linenos">1279</span></a>
</span><span id="L-1280"><a href="#-1280"><span class="linenos">1280</span></a>        <span class="c1"># Convert closure cubes from int16 to uint8 for writing to disk</span>
</span><span id="L-1281"><a href="#-1281"><span class="linenos">1281</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">closure_segments</span><span class="p">[:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">closure_segments</span><span class="p">[:]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;uint8&quot;</span><span class="p">)</span>
</span><span id="L-1282"><a href="#-1282"><span class="linenos">1282</span></a>
</span><span id="L-1283"><a href="#-1283"><span class="linenos">1283</span></a>        <span class="c1"># add any oil/gas/brine closures into all_closures_final in case missed</span>
</span><span id="L-1284"><a href="#-1284"><span class="linenos">1284</span></a>        <span class="n">all_closures_final</span><span class="p">[:][</span><span class="bp">self</span><span class="o">.</span><span class="n">oil_closures</span><span class="p">[:]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-1285"><a href="#-1285"><span class="linenos">1285</span></a>        <span class="n">all_closures_final</span><span class="p">[:][</span><span class="bp">self</span><span class="o">.</span><span class="n">gas_closures</span><span class="p">[:]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-1286"><a href="#-1286"><span class="linenos">1286</span></a>        <span class="n">all_closures_final</span><span class="p">[:][</span><span class="bp">self</span><span class="o">.</span><span class="n">gas_closures</span><span class="p">[:]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-1287"><a href="#-1287"><span class="linenos">1287</span></a>        <span class="c1"># Write all_closures_final to disk</span>
</span><span id="L-1288"><a href="#-1288"><span class="linenos">1288</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">write_cube_to_disk</span><span class="p">(</span><span class="n">all_closures_final</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;uint8&quot;</span><span class="p">),</span> <span class="s2">&quot;trap_label&quot;</span><span class="p">)</span>
</span><span id="L-1289"><a href="#-1289"><span class="linenos">1289</span></a>
</span><span id="L-1290"><a href="#-1290"><span class="linenos">1290</span></a>        <span class="c1"># add any oil/gas/brine closures into reservoir in case missed</span>
</span><span id="L-1291"><a href="#-1291"><span class="linenos">1291</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">reservoir</span><span class="p">[:][</span><span class="bp">self</span><span class="o">.</span><span class="n">oil_closures</span><span class="p">[:]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-1292"><a href="#-1292"><span class="linenos">1292</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">reservoir</span><span class="p">[:][</span><span class="bp">self</span><span class="o">.</span><span class="n">gas_closures</span><span class="p">[:]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-1293"><a href="#-1293"><span class="linenos">1293</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">reservoir</span><span class="p">[:][</span><span class="bp">self</span><span class="o">.</span><span class="n">brine_closures</span><span class="p">[:]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-1294"><a href="#-1294"><span class="linenos">1294</span></a>        <span class="c1"># write reservoir_label to disk</span>
</span><span id="L-1295"><a href="#-1295"><span class="linenos">1295</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">write_cube_to_disk</span><span class="p">(</span>
</span><span id="L-1296"><a href="#-1296"><span class="linenos">1296</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">reservoir</span><span class="p">[:]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;uint8&quot;</span><span class="p">),</span> <span class="s2">&quot;reservoir_label&quot;</span>
</span><span id="L-1297"><a href="#-1297"><span class="linenos">1297</span></a>        <span class="p">)</span>
</span><span id="L-1298"><a href="#-1298"><span class="linenos">1298</span></a>
</span><span id="L-1299"><a href="#-1299"><span class="linenos">1299</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">qc_plots</span><span class="p">:</span>
</span><span id="L-1300"><a href="#-1300"><span class="linenos">1300</span></a>            <span class="kn">from</span> <span class="nn">datagenerator.util</span> <span class="kn">import</span> <span class="n">plot_xsection</span>
</span><span id="L-1301"><a href="#-1301"><span class="linenos">1301</span></a>            <span class="kn">from</span> <span class="nn">datagenerator.util</span> <span class="kn">import</span> <span class="n">find_line_with_most_voxels</span>
</span><span id="L-1302"><a href="#-1302"><span class="linenos">1302</span></a>
</span><span id="L-1303"><a href="#-1303"><span class="linenos">1303</span></a>            <span class="c1"># visualize closures QC</span>
</span><span id="L-1304"><a href="#-1304"><span class="linenos">1304</span></a>            <span class="n">inline_index_cl</span> <span class="o">=</span> <span class="n">find_line_with_most_voxels</span><span class="p">(</span>
</span><span id="L-1305"><a href="#-1305"><span class="linenos">1305</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">closure_segments</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span>
</span><span id="L-1306"><a href="#-1306"><span class="linenos">1306</span></a>            <span class="p">)</span>
</span><span id="L-1307"><a href="#-1307"><span class="linenos">1307</span></a>            <span class="n">plot_xsection</span><span class="p">(</span>
</span><span id="L-1308"><a href="#-1308"><span class="linenos">1308</span></a>                <span class="n">volume</span><span class="o">=</span><span class="n">labels_clean</span><span class="p">,</span>
</span><span id="L-1309"><a href="#-1309"><span class="linenos">1309</span></a>                <span class="n">maps</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">faulted_depth_maps_gaps</span><span class="p">,</span>
</span><span id="L-1310"><a href="#-1310"><span class="linenos">1310</span></a>                <span class="n">line_num</span><span class="o">=</span><span class="n">inline_index_cl</span><span class="p">,</span>
</span><span id="L-1311"><a href="#-1311"><span class="linenos">1311</span></a>                <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Example Trav through 3D model</span><span class="se">\n</span><span class="s2">closures after faulting&quot;</span><span class="p">,</span>
</span><span id="L-1312"><a href="#-1312"><span class="linenos">1312</span></a>                <span class="n">png_name</span><span class="o">=</span><span class="s2">&quot;QC_plot__AfterFaulting_closure_segments.png&quot;</span><span class="p">,</span>
</span><span id="L-1313"><a href="#-1313"><span class="linenos">1313</span></a>                <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;gist_ncar_r&quot;</span><span class="p">,</span>
</span><span id="L-1314"><a href="#-1314"><span class="linenos">1314</span></a>                <span class="n">cfg</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="p">,</span>
</span><span id="L-1315"><a href="#-1315"><span class="linenos">1315</span></a>            <span class="p">)</span>
</span><span id="L-1316"><a href="#-1316"><span class="linenos">1316</span></a>
</span><span id="L-1317"><a href="#-1317"><span class="linenos">1317</span></a>    <span class="k">def</span> <span class="nf">closure_size_filter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">closure_type</span><span class="p">,</span> <span class="n">threshold</span><span class="p">,</span> <span class="n">count</span><span class="p">):</span>
</span><span id="L-1318"><a href="#-1318"><span class="linenos">1318</span></a>        <span class="n">labels</span><span class="p">,</span> <span class="n">num</span> <span class="o">=</span> <span class="n">measure</span><span class="o">.</span><span class="n">label</span><span class="p">(</span>
</span><span id="L-1319"><a href="#-1319"><span class="linenos">1319</span></a>            <span class="n">closure_type</span><span class="p">,</span> <span class="n">connectivity</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">background</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">return_num</span><span class="o">=</span><span class="kc">True</span>
</span><span id="L-1320"><a href="#-1320"><span class="linenos">1320</span></a>        <span class="p">)</span>
</span><span id="L-1321"><a href="#-1321"><span class="linenos">1321</span></a>        <span class="k">if</span> <span class="p">(</span>
</span><span id="L-1322"><a href="#-1322"><span class="linenos">1322</span></a>            <span class="n">num</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="L-1323"><a href="#-1323"><span class="linenos">1323</span></a>        <span class="p">):</span>  <span class="c1"># TODO add whether smallest closure is below threshold constraint too</span>
</span><span id="L-1324"><a href="#-1324"><span class="linenos">1324</span></a>            <span class="n">s</span> <span class="o">=</span> <span class="p">[</span><span class="n">labels</span><span class="p">[</span><span class="n">labels</span> <span class="o">==</span> <span class="n">x</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">labels</span><span class="p">))]</span>
</span><span id="L-1325"><a href="#-1325"><span class="linenos">1325</span></a>            <span class="n">labels</span> <span class="o">=</span> <span class="n">morphology</span><span class="o">.</span><span class="n">remove_small_objects</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">threshold</span><span class="p">,</span> <span class="n">connectivity</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span><span id="L-1326"><a href="#-1326"><span class="linenos">1326</span></a>            <span class="n">t</span> <span class="o">=</span> <span class="p">[</span><span class="n">labels</span><span class="p">[</span><span class="n">labels</span> <span class="o">==</span> <span class="n">x</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">labels</span><span class="p">))]</span>
</span><span id="L-1327"><a href="#-1327"><span class="linenos">1327</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="L-1328"><a href="#-1328"><span class="linenos">1328</span></a>                <span class="sa">f</span><span class="s2">&quot;Closure sizes before filter: </span><span class="si">{</span><span class="n">s</span><span class="si">}</span><span class="se">\n</span><span class="s2">Threshold: </span><span class="si">{</span><span class="n">threshold</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="L-1329"><a href="#-1329"><span class="linenos">1329</span></a>                <span class="sa">f</span><span class="s2">&quot;Closure sizes after filter: </span><span class="si">{</span><span class="n">t</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-1330"><a href="#-1330"><span class="linenos">1330</span></a>            <span class="p">)</span>
</span><span id="L-1331"><a href="#-1331"><span class="linenos">1331</span></a>            <span class="n">count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
</span><span id="L-1332"><a href="#-1332"><span class="linenos">1332</span></a>        <span class="k">return</span> <span class="n">labels</span><span class="p">,</span> <span class="n">count</span>
</span><span id="L-1333"><a href="#-1333"><span class="linenos">1333</span></a>
</span><span id="L-1334"><a href="#-1334"><span class="linenos">1334</span></a>    <span class="k">def</span> <span class="nf">closure_type_info_for_log</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-1335"><a href="#-1335"><span class="linenos">1335</span></a>        <span class="n">fluid_types</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;oil&quot;</span><span class="p">,</span> <span class="s2">&quot;gas&quot;</span><span class="p">,</span> <span class="s2">&quot;brine&quot;</span><span class="p">]</span>
</span><span id="L-1336"><a href="#-1336"><span class="linenos">1336</span></a>        <span class="k">if</span> <span class="s2">&quot;faulted&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">closure_types</span><span class="p">:</span>
</span><span id="L-1337"><a href="#-1337"><span class="linenos">1337</span></a>            <span class="c1"># Faulted closures</span>
</span><span id="L-1338"><a href="#-1338"><span class="linenos">1338</span></a>            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">fluid</span><span class="p">,</span> <span class="n">num</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
</span><span id="L-1339"><a href="#-1339"><span class="linenos">1339</span></a>                <span class="n">fluid_types</span><span class="p">,</span>
</span><span id="L-1340"><a href="#-1340"><span class="linenos">1340</span></a>                <span class="p">[</span>
</span><span id="L-1341"><a href="#-1341"><span class="linenos">1341</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">faulted_closures_oil</span><span class="p">[:],</span>
</span><span id="L-1342"><a href="#-1342"><span class="linenos">1342</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">faulted_closures_gas</span><span class="p">[:],</span>
</span><span id="L-1343"><a href="#-1343"><span class="linenos">1343</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">faulted_closures_brine</span><span class="p">[:],</span>
</span><span id="L-1344"><a href="#-1344"><span class="linenos">1344</span></a>                <span class="p">],</span>
</span><span id="L-1345"><a href="#-1345"><span class="linenos">1345</span></a>                <span class="p">[</span>
</span><span id="L-1346"><a href="#-1346"><span class="linenos">1346</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">n_fault_closures_oil</span><span class="p">,</span>
</span><span id="L-1347"><a href="#-1347"><span class="linenos">1347</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">n_fault_closures_gas</span><span class="p">,</span>
</span><span id="L-1348"><a href="#-1348"><span class="linenos">1348</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">n_fault_closures_brine</span><span class="p">,</span>
</span><span id="L-1349"><a href="#-1349"><span class="linenos">1349</span></a>                <span class="p">],</span>
</span><span id="L-1350"><a href="#-1350"><span class="linenos">1350</span></a>            <span class="p">):</span>
</span><span id="L-1351"><a href="#-1351"><span class="linenos">1351</span></a>                <span class="n">n_voxels</span> <span class="o">=</span> <span class="n">fluid</span><span class="p">[</span><span class="n">fluid</span><span class="p">[:]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="L-1352"><a href="#-1352"><span class="linenos">1352</span></a>                <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;n_fault_closures_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">num</span><span class="si">:</span><span class="s2">03d</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="L-1353"><a href="#-1353"><span class="linenos">1353</span></a>                <span class="n">msg</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;n_voxels_fault_closures_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">n_voxels</span><span class="si">:</span><span class="s2">08d</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="L-1354"><a href="#-1354"><span class="linenos">1354</span></a>                <span class="nb">print</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="L-1355"><a href="#-1355"><span class="linenos">1355</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="L-1356"><a href="#-1356"><span class="linenos">1356</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="L-1357"><a href="#-1357"><span class="linenos">1357</span></a>                    <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-1358"><a href="#-1358"><span class="linenos">1358</span></a>                    <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span>
</span><span id="L-1359"><a href="#-1359"><span class="linenos">1359</span></a>                    <span class="n">subkey</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;n_fault_closures_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="L-1360"><a href="#-1360"><span class="linenos">1360</span></a>                    <span class="n">val</span><span class="o">=</span><span class="n">num</span><span class="p">,</span>
</span><span id="L-1361"><a href="#-1361"><span class="linenos">1361</span></a>                <span class="p">)</span>
</span><span id="L-1362"><a href="#-1362"><span class="linenos">1362</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="L-1363"><a href="#-1363"><span class="linenos">1363</span></a>                    <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-1364"><a href="#-1364"><span class="linenos">1364</span></a>                    <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span>
</span><span id="L-1365"><a href="#-1365"><span class="linenos">1365</span></a>                    <span class="n">subkey</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;n_voxels_fault_closures_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="L-1366"><a href="#-1366"><span class="linenos">1366</span></a>                    <span class="n">val</span><span class="o">=</span><span class="n">n_voxels</span><span class="p">,</span>
</span><span id="L-1367"><a href="#-1367"><span class="linenos">1367</span></a>                <span class="p">)</span>
</span><span id="L-1368"><a href="#-1368"><span class="linenos">1368</span></a>                <span class="n">closure_statistics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_closure_statistics</span><span class="p">(</span>
</span><span id="L-1369"><a href="#-1369"><span class="linenos">1369</span></a>                    <span class="n">fluid</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Faulted </span><span class="si">{</span><span class="n">name</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-1370"><a href="#-1370"><span class="linenos">1370</span></a>                <span class="p">)</span>
</span><span id="L-1371"><a href="#-1371"><span class="linenos">1371</span></a>                <span class="k">if</span> <span class="n">closure_statistics</span><span class="p">:</span>
</span><span id="L-1372"><a href="#-1372"><span class="linenos">1372</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="n">closure_statistics</span><span class="p">)</span>
</span><span id="L-1373"><a href="#-1373"><span class="linenos">1373</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span><span class="n">closure_statistics</span><span class="p">)</span>
</span><span id="L-1374"><a href="#-1374"><span class="linenos">1374</span></a>
</span><span id="L-1375"><a href="#-1375"><span class="linenos">1375</span></a>        <span class="k">if</span> <span class="s2">&quot;onlap&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">closure_types</span><span class="p">:</span>
</span><span id="L-1376"><a href="#-1376"><span class="linenos">1376</span></a>            <span class="c1"># Onlap Closures</span>
</span><span id="L-1377"><a href="#-1377"><span class="linenos">1377</span></a>            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">fluid</span><span class="p">,</span> <span class="n">num</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
</span><span id="L-1378"><a href="#-1378"><span class="linenos">1378</span></a>                <span class="n">fluid_types</span><span class="p">,</span>
</span><span id="L-1379"><a href="#-1379"><span class="linenos">1379</span></a>                <span class="p">[</span>
</span><span id="L-1380"><a href="#-1380"><span class="linenos">1380</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">onlap_closures_oil</span><span class="p">[:],</span>
</span><span id="L-1381"><a href="#-1381"><span class="linenos">1381</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">onlap_closures_gas</span><span class="p">[:],</span>
</span><span id="L-1382"><a href="#-1382"><span class="linenos">1382</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">onlap_closures_brine</span><span class="p">[:],</span>
</span><span id="L-1383"><a href="#-1383"><span class="linenos">1383</span></a>                <span class="p">],</span>
</span><span id="L-1384"><a href="#-1384"><span class="linenos">1384</span></a>                <span class="p">[</span>
</span><span id="L-1385"><a href="#-1385"><span class="linenos">1385</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">n_onlap_closures_oil</span><span class="p">,</span>
</span><span id="L-1386"><a href="#-1386"><span class="linenos">1386</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">n_onlap_closures_gas</span><span class="p">,</span>
</span><span id="L-1387"><a href="#-1387"><span class="linenos">1387</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">n_onlap_closures_brine</span><span class="p">,</span>
</span><span id="L-1388"><a href="#-1388"><span class="linenos">1388</span></a>                <span class="p">],</span>
</span><span id="L-1389"><a href="#-1389"><span class="linenos">1389</span></a>            <span class="p">):</span>
</span><span id="L-1390"><a href="#-1390"><span class="linenos">1390</span></a>                <span class="n">n_voxels</span> <span class="o">=</span> <span class="n">fluid</span><span class="p">[</span><span class="n">fluid</span><span class="p">[:]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="L-1391"><a href="#-1391"><span class="linenos">1391</span></a>                <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;n_onlap_closures_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">num</span><span class="si">:</span><span class="s2">03d</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="L-1392"><a href="#-1392"><span class="linenos">1392</span></a>                <span class="n">msg</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;n_voxels_onlap_closures_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">n_voxels</span><span class="si">:</span><span class="s2">08d</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="L-1393"><a href="#-1393"><span class="linenos">1393</span></a>                <span class="nb">print</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="L-1394"><a href="#-1394"><span class="linenos">1394</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="L-1395"><a href="#-1395"><span class="linenos">1395</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="L-1396"><a href="#-1396"><span class="linenos">1396</span></a>                    <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-1397"><a href="#-1397"><span class="linenos">1397</span></a>                    <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span>
</span><span id="L-1398"><a href="#-1398"><span class="linenos">1398</span></a>                    <span class="n">subkey</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;n_onlap_closures_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="L-1399"><a href="#-1399"><span class="linenos">1399</span></a>                    <span class="n">val</span><span class="o">=</span><span class="n">num</span><span class="p">,</span>
</span><span id="L-1400"><a href="#-1400"><span class="linenos">1400</span></a>                <span class="p">)</span>
</span><span id="L-1401"><a href="#-1401"><span class="linenos">1401</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="L-1402"><a href="#-1402"><span class="linenos">1402</span></a>                    <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-1403"><a href="#-1403"><span class="linenos">1403</span></a>                    <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span>
</span><span id="L-1404"><a href="#-1404"><span class="linenos">1404</span></a>                    <span class="n">subkey</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;n_voxels_onlap_closures_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="L-1405"><a href="#-1405"><span class="linenos">1405</span></a>                    <span class="n">val</span><span class="o">=</span><span class="n">n_voxels</span><span class="p">,</span>
</span><span id="L-1406"><a href="#-1406"><span class="linenos">1406</span></a>                <span class="p">)</span>
</span><span id="L-1407"><a href="#-1407"><span class="linenos">1407</span></a>                <span class="n">closure_statistics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_closure_statistics</span><span class="p">(</span>
</span><span id="L-1408"><a href="#-1408"><span class="linenos">1408</span></a>                    <span class="n">fluid</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Onlap </span><span class="si">{</span><span class="n">name</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-1409"><a href="#-1409"><span class="linenos">1409</span></a>                <span class="p">)</span>
</span><span id="L-1410"><a href="#-1410"><span class="linenos">1410</span></a>                <span class="k">if</span> <span class="n">closure_statistics</span><span class="p">:</span>
</span><span id="L-1411"><a href="#-1411"><span class="linenos">1411</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="n">closure_statistics</span><span class="p">)</span>
</span><span id="L-1412"><a href="#-1412"><span class="linenos">1412</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span><span class="n">closure_statistics</span><span class="p">)</span>
</span><span id="L-1413"><a href="#-1413"><span class="linenos">1413</span></a>
</span><span id="L-1414"><a href="#-1414"><span class="linenos">1414</span></a>        <span class="k">if</span> <span class="s2">&quot;simple&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">closure_types</span><span class="p">:</span>
</span><span id="L-1415"><a href="#-1415"><span class="linenos">1415</span></a>            <span class="c1"># Simple Closures</span>
</span><span id="L-1416"><a href="#-1416"><span class="linenos">1416</span></a>            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">fluid</span><span class="p">,</span> <span class="n">num</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
</span><span id="L-1417"><a href="#-1417"><span class="linenos">1417</span></a>                <span class="n">fluid_types</span><span class="p">,</span>
</span><span id="L-1418"><a href="#-1418"><span class="linenos">1418</span></a>                <span class="p">[</span>
</span><span id="L-1419"><a href="#-1419"><span class="linenos">1419</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">simple_closures_oil</span><span class="p">[:],</span>
</span><span id="L-1420"><a href="#-1420"><span class="linenos">1420</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">simple_closures_gas</span><span class="p">[:],</span>
</span><span id="L-1421"><a href="#-1421"><span class="linenos">1421</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">simple_closures_brine</span><span class="p">[:],</span>
</span><span id="L-1422"><a href="#-1422"><span class="linenos">1422</span></a>                <span class="p">],</span>
</span><span id="L-1423"><a href="#-1423"><span class="linenos">1423</span></a>                <span class="p">[</span>
</span><span id="L-1424"><a href="#-1424"><span class="linenos">1424</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">n_4way_closures_oil</span><span class="p">,</span>
</span><span id="L-1425"><a href="#-1425"><span class="linenos">1425</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">n_4way_closures_gas</span><span class="p">,</span>
</span><span id="L-1426"><a href="#-1426"><span class="linenos">1426</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">n_4way_closures_brine</span><span class="p">,</span>
</span><span id="L-1427"><a href="#-1427"><span class="linenos">1427</span></a>                <span class="p">],</span>
</span><span id="L-1428"><a href="#-1428"><span class="linenos">1428</span></a>            <span class="p">):</span>
</span><span id="L-1429"><a href="#-1429"><span class="linenos">1429</span></a>                <span class="n">n_voxels</span> <span class="o">=</span> <span class="n">fluid</span><span class="p">[</span><span class="n">fluid</span><span class="p">[:]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="L-1430"><a href="#-1430"><span class="linenos">1430</span></a>                <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;n_4way_closures_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">num</span><span class="si">:</span><span class="s2">03d</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="L-1431"><a href="#-1431"><span class="linenos">1431</span></a>                <span class="n">msg</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;n_voxels_4way_closures_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">n_voxels</span><span class="si">:</span><span class="s2">08d</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="L-1432"><a href="#-1432"><span class="linenos">1432</span></a>                <span class="nb">print</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="L-1433"><a href="#-1433"><span class="linenos">1433</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="L-1434"><a href="#-1434"><span class="linenos">1434</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="L-1435"><a href="#-1435"><span class="linenos">1435</span></a>                    <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-1436"><a href="#-1436"><span class="linenos">1436</span></a>                    <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span>
</span><span id="L-1437"><a href="#-1437"><span class="linenos">1437</span></a>                    <span class="n">subkey</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;n_4way_closures_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="L-1438"><a href="#-1438"><span class="linenos">1438</span></a>                    <span class="n">val</span><span class="o">=</span><span class="n">num</span><span class="p">,</span>
</span><span id="L-1439"><a href="#-1439"><span class="linenos">1439</span></a>                <span class="p">)</span>
</span><span id="L-1440"><a href="#-1440"><span class="linenos">1440</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="L-1441"><a href="#-1441"><span class="linenos">1441</span></a>                    <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-1442"><a href="#-1442"><span class="linenos">1442</span></a>                    <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span>
</span><span id="L-1443"><a href="#-1443"><span class="linenos">1443</span></a>                    <span class="n">subkey</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;n_voxels_4way_closures_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="L-1444"><a href="#-1444"><span class="linenos">1444</span></a>                    <span class="n">val</span><span class="o">=</span><span class="n">n_voxels</span><span class="p">,</span>
</span><span id="L-1445"><a href="#-1445"><span class="linenos">1445</span></a>                <span class="p">)</span>
</span><span id="L-1446"><a href="#-1446"><span class="linenos">1446</span></a>                <span class="n">closure_statistics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_closure_statistics</span><span class="p">(</span>
</span><span id="L-1447"><a href="#-1447"><span class="linenos">1447</span></a>                    <span class="n">fluid</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;4-Way </span><span class="si">{</span><span class="n">name</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-1448"><a href="#-1448"><span class="linenos">1448</span></a>                <span class="p">)</span>
</span><span id="L-1449"><a href="#-1449"><span class="linenos">1449</span></a>                <span class="k">if</span> <span class="n">closure_statistics</span><span class="p">:</span>
</span><span id="L-1450"><a href="#-1450"><span class="linenos">1450</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="n">closure_statistics</span><span class="p">)</span>
</span><span id="L-1451"><a href="#-1451"><span class="linenos">1451</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span><span class="n">closure_statistics</span><span class="p">)</span>
</span><span id="L-1452"><a href="#-1452"><span class="linenos">1452</span></a>
</span><span id="L-1453"><a href="#-1453"><span class="linenos">1453</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">include_salt</span><span class="p">:</span>
</span><span id="L-1454"><a href="#-1454"><span class="linenos">1454</span></a>            <span class="c1"># Salt-Bounded Closures</span>
</span><span id="L-1455"><a href="#-1455"><span class="linenos">1455</span></a>            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">fluid</span><span class="p">,</span> <span class="n">num</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
</span><span id="L-1456"><a href="#-1456"><span class="linenos">1456</span></a>                <span class="n">fluid_types</span><span class="p">,</span>
</span><span id="L-1457"><a href="#-1457"><span class="linenos">1457</span></a>                <span class="p">[</span>
</span><span id="L-1458"><a href="#-1458"><span class="linenos">1458</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">salt_closures_oil</span><span class="p">[:],</span>
</span><span id="L-1459"><a href="#-1459"><span class="linenos">1459</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">salt_closures_gas</span><span class="p">[:],</span>
</span><span id="L-1460"><a href="#-1460"><span class="linenos">1460</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">salt_closures_brine</span><span class="p">[:],</span>
</span><span id="L-1461"><a href="#-1461"><span class="linenos">1461</span></a>                <span class="p">],</span>
</span><span id="L-1462"><a href="#-1462"><span class="linenos">1462</span></a>                <span class="p">[</span>
</span><span id="L-1463"><a href="#-1463"><span class="linenos">1463</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">n_salt_closures_oil</span><span class="p">,</span>
</span><span id="L-1464"><a href="#-1464"><span class="linenos">1464</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">n_salt_closures_gas</span><span class="p">,</span>
</span><span id="L-1465"><a href="#-1465"><span class="linenos">1465</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">n_salt_closures_brine</span><span class="p">,</span>
</span><span id="L-1466"><a href="#-1466"><span class="linenos">1466</span></a>                <span class="p">],</span>
</span><span id="L-1467"><a href="#-1467"><span class="linenos">1467</span></a>            <span class="p">):</span>
</span><span id="L-1468"><a href="#-1468"><span class="linenos">1468</span></a>                <span class="n">n_voxels</span> <span class="o">=</span> <span class="n">fluid</span><span class="p">[</span><span class="n">fluid</span><span class="p">[:]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="L-1469"><a href="#-1469"><span class="linenos">1469</span></a>                <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;n_salt_closures_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">num</span><span class="si">:</span><span class="s2">03d</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="L-1470"><a href="#-1470"><span class="linenos">1470</span></a>                <span class="n">msg</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;n_voxels_salt_closures_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">n_voxels</span><span class="si">:</span><span class="s2">08d</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="L-1471"><a href="#-1471"><span class="linenos">1471</span></a>                <span class="nb">print</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="L-1472"><a href="#-1472"><span class="linenos">1472</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="L-1473"><a href="#-1473"><span class="linenos">1473</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="L-1474"><a href="#-1474"><span class="linenos">1474</span></a>                    <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-1475"><a href="#-1475"><span class="linenos">1475</span></a>                    <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span>
</span><span id="L-1476"><a href="#-1476"><span class="linenos">1476</span></a>                    <span class="n">subkey</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;n_salt_closures_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="L-1477"><a href="#-1477"><span class="linenos">1477</span></a>                    <span class="n">val</span><span class="o">=</span><span class="n">num</span><span class="p">,</span>
</span><span id="L-1478"><a href="#-1478"><span class="linenos">1478</span></a>                <span class="p">)</span>
</span><span id="L-1479"><a href="#-1479"><span class="linenos">1479</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="L-1480"><a href="#-1480"><span class="linenos">1480</span></a>                    <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-1481"><a href="#-1481"><span class="linenos">1481</span></a>                    <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span>
</span><span id="L-1482"><a href="#-1482"><span class="linenos">1482</span></a>                    <span class="n">subkey</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;n_voxels_salt_closures_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="L-1483"><a href="#-1483"><span class="linenos">1483</span></a>                    <span class="n">val</span><span class="o">=</span><span class="n">n_voxels</span><span class="p">,</span>
</span><span id="L-1484"><a href="#-1484"><span class="linenos">1484</span></a>                <span class="p">)</span>
</span><span id="L-1485"><a href="#-1485"><span class="linenos">1485</span></a>                <span class="n">closure_statistics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_closure_statistics</span><span class="p">(</span>
</span><span id="L-1486"><a href="#-1486"><span class="linenos">1486</span></a>                    <span class="n">fluid</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Salt </span><span class="si">{</span><span class="n">name</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-1487"><a href="#-1487"><span class="linenos">1487</span></a>                <span class="p">)</span>
</span><span id="L-1488"><a href="#-1488"><span class="linenos">1488</span></a>                <span class="k">if</span> <span class="n">closure_statistics</span><span class="p">:</span>
</span><span id="L-1489"><a href="#-1489"><span class="linenos">1489</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="n">closure_statistics</span><span class="p">)</span>
</span><span id="L-1490"><a href="#-1490"><span class="linenos">1490</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span><span class="n">closure_statistics</span><span class="p">)</span>
</span><span id="L-1491"><a href="#-1491"><span class="linenos">1491</span></a>
</span><span id="L-1492"><a href="#-1492"><span class="linenos">1492</span></a>    <span class="k">def</span> <span class="nf">get_voxel_counts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">closures</span><span class="p">):</span>
</span><span id="L-1493"><a href="#-1493"><span class="linenos">1493</span></a>        <span class="n">next_label</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-1494"><a href="#-1494"><span class="linenos">1494</span></a>        <span class="n">label_values</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-1495"><a href="#-1495"><span class="linenos">1495</span></a>        <span class="n">label_counts</span> <span class="o">=</span> <span class="p">[</span><span class="n">closures</span><span class="p">[</span><span class="n">closures</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">]</span>
</span><span id="L-1496"><a href="#-1496"><span class="linenos">1496</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">closures</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="L-1497"><a href="#-1497"><span class="linenos">1497</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="L-1498"><a href="#-1498"><span class="linenos">1498</span></a>                <span class="n">next_label</span> <span class="o">=</span> <span class="n">closures</span><span class="p">[</span><span class="n">closures</span> <span class="o">&gt;</span> <span class="n">next_label</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
</span><span id="L-1499"><a href="#-1499"><span class="linenos">1499</span></a>            <span class="k">except</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
</span><span id="L-1500"><a href="#-1500"><span class="linenos">1500</span></a>                <span class="k">break</span>
</span><span id="L-1501"><a href="#-1501"><span class="linenos">1501</span></a>            <span class="n">label_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">next_label</span><span class="p">)</span>
</span><span id="L-1502"><a href="#-1502"><span class="linenos">1502</span></a>            <span class="n">label_counts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">closures</span><span class="p">[</span><span class="n">closures</span> <span class="o">==</span> <span class="n">next_label</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
</span><span id="L-1503"><a href="#-1503"><span class="linenos">1503</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="L-1504"><a href="#-1504"><span class="linenos">1504</span></a>                <span class="sa">f</span><span class="s2">&quot;Label: </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">, label_values: </span><span class="si">{</span><span class="n">label_values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">, label_counts: </span><span class="si">{</span><span class="n">label_counts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-1505"><a href="#-1505"><span class="linenos">1505</span></a>            <span class="p">)</span>
</span><span id="L-1506"><a href="#-1506"><span class="linenos">1506</span></a>
</span><span id="L-1507"><a href="#-1507"><span class="linenos">1507</span></a>        <span class="nb">print</span><span class="p">(</span>
</span><span id="L-1508"><a href="#-1508"><span class="linenos">1508</span></a>            <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="mi">72</span> <span class="o">*</span> <span class="s2">&quot;*&quot;</span><span class="si">}</span><span class="se">\n\t</span><span class="s1">Num Closures: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">label_counts</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="si">}</span><span class="se">\n\t</span><span class="s1">Voxel counts</span><span class="se">\n</span><span class="si">{</span><span class="n">label_counts</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="si">}</span><span class="se">\n</span><span class="si">{</span><span class="mi">72</span> <span class="o">*</span> <span class="s2">&quot;*&quot;</span><span class="si">}</span><span class="s1">&#39;</span>
</span><span id="L-1509"><a href="#-1509"><span class="linenos">1509</span></a>        <span class="p">)</span>
</span><span id="L-1510"><a href="#-1510"><span class="linenos">1510</span></a>        <span class="k">for</span> <span class="n">vox_count</span> <span class="ow">in</span> <span class="n">label_counts</span><span class="p">:</span>
</span><span id="L-1511"><a href="#-1511"><span class="linenos">1511</span></a>            <span class="k">if</span> <span class="n">vox_count</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">closure_min_voxels</span><span class="p">:</span>
</span><span id="L-1512"><a href="#-1512"><span class="linenos">1512</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;voxel_count: </span><span class="si">{</span><span class="n">vox_count</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1513"><a href="#-1513"><span class="linenos">1513</span></a>
</span><span id="L-1514"><a href="#-1514"><span class="linenos">1514</span></a>    <span class="k">def</span> <span class="nf">populate_closure_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">fluid</span><span class="p">,</span> <span class="n">seismic_nmf</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-1515"><a href="#-1515"><span class="linenos">1515</span></a>        <span class="n">clist</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-1516"><a href="#-1516"><span class="linenos">1516</span></a>        <span class="n">max_num</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>
</span><span id="L-1517"><a href="#-1517"><span class="linenos">1517</span></a>        <span class="k">if</span> <span class="n">seismic_nmf</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1518"><a href="#-1518"><span class="linenos">1518</span></a>            <span class="c1"># calculate ai_gi</span>
</span><span id="L-1519"><a href="#-1519"><span class="linenos">1519</span></a>            <span class="n">ai</span><span class="p">,</span> <span class="n">gi</span> <span class="o">=</span> <span class="n">compute_ai_gi</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="p">,</span> <span class="n">seismic_nmf</span><span class="p">)</span>
</span><span id="L-1520"><a href="#-1520"><span class="linenos">1520</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_num</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="L-1521"><a href="#-1521"><span class="linenos">1521</span></a>            <span class="n">_c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">labels</span> <span class="o">==</span> <span class="n">i</span><span class="p">)</span>
</span><span id="L-1522"><a href="#-1522"><span class="linenos">1522</span></a>            <span class="n">cl</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
</span><span id="L-1523"><a href="#-1523"><span class="linenos">1523</span></a>            <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;model_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">work_subfolder</span><span class="p">)</span>
</span><span id="L-1524"><a href="#-1524"><span class="linenos">1524</span></a>            <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;fluid&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fluid</span>
</span><span id="L-1525"><a href="#-1525"><span class="linenos">1525</span></a>            <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;n_voxels&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">_c</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-1526"><a href="#-1526"><span class="linenos">1526</span></a>            <span class="c1"># np.min() or x.min() returns type numpy.int64 which SQLITE cannot handle. Convert to int</span>
</span><span id="L-1527"><a href="#-1527"><span class="linenos">1527</span></a>            <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;x_min&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">_c</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</span><span id="L-1528"><a href="#-1528"><span class="linenos">1528</span></a>            <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;x_max&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">_c</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</span><span id="L-1529"><a href="#-1529"><span class="linenos">1529</span></a>            <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;y_min&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">_c</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
</span><span id="L-1530"><a href="#-1530"><span class="linenos">1530</span></a>            <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;y_max&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">_c</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
</span><span id="L-1531"><a href="#-1531"><span class="linenos">1531</span></a>            <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;z_min&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">_c</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
</span><span id="L-1532"><a href="#-1532"><span class="linenos">1532</span></a>            <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;z_max&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">_c</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
</span><span id="L-1533"><a href="#-1533"><span class="linenos">1533</span></a>            <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;zbml_min&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">faulted_depth</span><span class="p">[</span><span class="n">_c</span><span class="p">])</span>
</span><span id="L-1534"><a href="#-1534"><span class="linenos">1534</span></a>            <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;zbml_max&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">faulted_depth</span><span class="p">[</span><span class="n">_c</span><span class="p">])</span>
</span><span id="L-1535"><a href="#-1535"><span class="linenos">1535</span></a>            <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;zbml_avg&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">faulted_depth</span><span class="p">[</span><span class="n">_c</span><span class="p">])</span>
</span><span id="L-1536"><a href="#-1536"><span class="linenos">1536</span></a>            <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;zbml_std&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">faulted_depth</span><span class="p">[</span><span class="n">_c</span><span class="p">])</span>
</span><span id="L-1537"><a href="#-1537"><span class="linenos">1537</span></a>            <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;zbml_25pct&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">faulted_depth</span><span class="p">[</span><span class="n">_c</span><span class="p">],</span> <span class="mi">25</span><span class="p">)</span>
</span><span id="L-1538"><a href="#-1538"><span class="linenos">1538</span></a>            <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;zbml_median&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">faulted_depth</span><span class="p">[</span><span class="n">_c</span><span class="p">],</span> <span class="mi">50</span><span class="p">)</span>
</span><span id="L-1539"><a href="#-1539"><span class="linenos">1539</span></a>            <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;zbml_75pct&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">faulted_depth</span><span class="p">[</span><span class="n">_c</span><span class="p">],</span> <span class="mi">75</span><span class="p">)</span>
</span><span id="L-1540"><a href="#-1540"><span class="linenos">1540</span></a>            <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;ng_min&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">faulted_net_to_gross</span><span class="p">[</span><span class="n">_c</span><span class="p">])</span>
</span><span id="L-1541"><a href="#-1541"><span class="linenos">1541</span></a>            <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;ng_max&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">faulted_net_to_gross</span><span class="p">[</span><span class="n">_c</span><span class="p">])</span>
</span><span id="L-1542"><a href="#-1542"><span class="linenos">1542</span></a>            <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;ng_avg&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">faulted_net_to_gross</span><span class="p">[</span><span class="n">_c</span><span class="p">])</span>
</span><span id="L-1543"><a href="#-1543"><span class="linenos">1543</span></a>            <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;ng_std&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">faulted_net_to_gross</span><span class="p">[</span><span class="n">_c</span><span class="p">])</span>
</span><span id="L-1544"><a href="#-1544"><span class="linenos">1544</span></a>            <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;ng_25pct&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">faulted_net_to_gross</span><span class="p">[</span><span class="n">_c</span><span class="p">],</span> <span class="mi">25</span><span class="p">)</span>
</span><span id="L-1545"><a href="#-1545"><span class="linenos">1545</span></a>            <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;ng_median&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">faulted_net_to_gross</span><span class="p">[</span><span class="n">_c</span><span class="p">])</span>
</span><span id="L-1546"><a href="#-1546"><span class="linenos">1546</span></a>            <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;ng_75pct&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">faulted_net_to_gross</span><span class="p">[</span><span class="n">_c</span><span class="p">],</span> <span class="mi">75</span><span class="p">)</span>
</span><span id="L-1547"><a href="#-1547"><span class="linenos">1547</span></a>            <span class="c1"># Check for intersections with faults, salt and onlaps for closure type</span>
</span><span id="L-1548"><a href="#-1548"><span class="linenos">1548</span></a>            <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;intersects_fault&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-1549"><a href="#-1549"><span class="linenos">1549</span></a>            <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;intersects_onlap&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-1550"><a href="#-1550"><span class="linenos">1550</span></a>            <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;intersects_salt&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-1551"><a href="#-1551"><span class="linenos">1551</span></a>            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wide_faults</span><span class="p">[</span><span class="n">_c</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
</span><span id="L-1552"><a href="#-1552"><span class="linenos">1552</span></a>                <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;intersects_fault&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-1553"><a href="#-1553"><span class="linenos">1553</span></a>            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">onlaps_upward</span><span class="p">[</span><span class="n">_c</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
</span><span id="L-1554"><a href="#-1554"><span class="linenos">1554</span></a>                <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;intersects_onlap&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-1555"><a href="#-1555"><span class="linenos">1555</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">include_salt</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wide_salt</span><span class="p">[</span><span class="n">_c</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
</span><span id="L-1556"><a href="#-1556"><span class="linenos">1556</span></a>                <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;intersects_salt&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-1557"><a href="#-1557"><span class="linenos">1557</span></a>
</span><span id="L-1558"><a href="#-1558"><span class="linenos">1558</span></a>            <span class="k">if</span> <span class="n">seismic_nmf</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1559"><a href="#-1559"><span class="linenos">1559</span></a>                <span class="c1"># Using only the top of the closure, calculate seismic properties</span>
</span><span id="L-1560"><a href="#-1560"><span class="linenos">1560</span></a>                <span class="n">labels_copy</span> <span class="o">=</span> <span class="n">labels</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-1561"><a href="#-1561"><span class="linenos">1561</span></a>                <span class="n">labels_copy</span><span class="p">[</span><span class="n">labels_copy</span> <span class="o">!=</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-1562"><a href="#-1562"><span class="linenos">1562</span></a>                <span class="n">top_closure</span> <span class="o">=</span> <span class="n">get_top_of_closure</span><span class="p">(</span><span class="n">labels_copy</span><span class="p">)</span>
</span><span id="L-1563"><a href="#-1563"><span class="linenos">1563</span></a>                <span class="n">near</span> <span class="o">=</span> <span class="n">seismic_nmf</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">...</span><span class="p">][</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">top_closure</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)]</span>
</span><span id="L-1564"><a href="#-1564"><span class="linenos">1564</span></a>                <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;near_min&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">near</span><span class="p">)</span>
</span><span id="L-1565"><a href="#-1565"><span class="linenos">1565</span></a>                <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;near_max&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">near</span><span class="p">)</span>
</span><span id="L-1566"><a href="#-1566"><span class="linenos">1566</span></a>                <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;near_avg&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">near</span><span class="p">)</span>
</span><span id="L-1567"><a href="#-1567"><span class="linenos">1567</span></a>                <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;near_std&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">near</span><span class="p">)</span>
</span><span id="L-1568"><a href="#-1568"><span class="linenos">1568</span></a>                <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;near_25pct&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">near</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span>
</span><span id="L-1569"><a href="#-1569"><span class="linenos">1569</span></a>                <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;near_median&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">near</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
</span><span id="L-1570"><a href="#-1570"><span class="linenos">1570</span></a>                <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;near_75pct&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">near</span><span class="p">,</span> <span class="mi">75</span><span class="p">)</span>
</span><span id="L-1571"><a href="#-1571"><span class="linenos">1571</span></a>                <span class="n">mid</span> <span class="o">=</span> <span class="n">seismic_nmf</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="o">...</span><span class="p">][</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">top_closure</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)]</span>
</span><span id="L-1572"><a href="#-1572"><span class="linenos">1572</span></a>                <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;mid_min&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">mid</span><span class="p">)</span>
</span><span id="L-1573"><a href="#-1573"><span class="linenos">1573</span></a>                <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;mid_max&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">mid</span><span class="p">)</span>
</span><span id="L-1574"><a href="#-1574"><span class="linenos">1574</span></a>                <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;mid_avg&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">mid</span><span class="p">)</span>
</span><span id="L-1575"><a href="#-1575"><span class="linenos">1575</span></a>                <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;mid_std&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">mid</span><span class="p">)</span>
</span><span id="L-1576"><a href="#-1576"><span class="linenos">1576</span></a>                <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;mid_25pct&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">mid</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span>
</span><span id="L-1577"><a href="#-1577"><span class="linenos">1577</span></a>                <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;mid_median&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">mid</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
</span><span id="L-1578"><a href="#-1578"><span class="linenos">1578</span></a>                <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;mid_75pct&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">mid</span><span class="p">,</span> <span class="mi">75</span><span class="p">)</span>
</span><span id="L-1579"><a href="#-1579"><span class="linenos">1579</span></a>                <span class="n">far</span> <span class="o">=</span> <span class="n">seismic_nmf</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="o">...</span><span class="p">][</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">top_closure</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)]</span>
</span><span id="L-1580"><a href="#-1580"><span class="linenos">1580</span></a>                <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;far_min&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">far</span><span class="p">)</span>
</span><span id="L-1581"><a href="#-1581"><span class="linenos">1581</span></a>                <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;far_max&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">far</span><span class="p">)</span>
</span><span id="L-1582"><a href="#-1582"><span class="linenos">1582</span></a>                <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;far_avg&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">far</span><span class="p">)</span>
</span><span id="L-1583"><a href="#-1583"><span class="linenos">1583</span></a>                <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;far_std&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">far</span><span class="p">)</span>
</span><span id="L-1584"><a href="#-1584"><span class="linenos">1584</span></a>                <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;far_25pct&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">far</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span>
</span><span id="L-1585"><a href="#-1585"><span class="linenos">1585</span></a>                <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;far_median&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">far</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
</span><span id="L-1586"><a href="#-1586"><span class="linenos">1586</span></a>                <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;far_75pct&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">far</span><span class="p">,</span> <span class="mi">75</span><span class="p">)</span>
</span><span id="L-1587"><a href="#-1587"><span class="linenos">1587</span></a>                <span class="n">intercept</span> <span class="o">=</span> <span class="n">ai</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">top_closure</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)]</span>
</span><span id="L-1588"><a href="#-1588"><span class="linenos">1588</span></a>                <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;intercept_min&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">intercept</span><span class="p">)</span>
</span><span id="L-1589"><a href="#-1589"><span class="linenos">1589</span></a>                <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;intercept_max&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">intercept</span><span class="p">)</span>
</span><span id="L-1590"><a href="#-1590"><span class="linenos">1590</span></a>                <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;intercept_avg&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">intercept</span><span class="p">)</span>
</span><span id="L-1591"><a href="#-1591"><span class="linenos">1591</span></a>                <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;intercept_std&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">intercept</span><span class="p">)</span>
</span><span id="L-1592"><a href="#-1592"><span class="linenos">1592</span></a>                <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;intercept_25pct&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">intercept</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span>
</span><span id="L-1593"><a href="#-1593"><span class="linenos">1593</span></a>                <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;intercept_median&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">intercept</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
</span><span id="L-1594"><a href="#-1594"><span class="linenos">1594</span></a>                <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;intercept_75pct&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">intercept</span><span class="p">,</span> <span class="mi">75</span><span class="p">)</span>
</span><span id="L-1595"><a href="#-1595"><span class="linenos">1595</span></a>                <span class="n">gradient</span> <span class="o">=</span> <span class="n">gi</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">top_closure</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)]</span>
</span><span id="L-1596"><a href="#-1596"><span class="linenos">1596</span></a>                <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;gradient_min&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">gradient</span><span class="p">)</span>
</span><span id="L-1597"><a href="#-1597"><span class="linenos">1597</span></a>                <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;gradient_max&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">gradient</span><span class="p">)</span>
</span><span id="L-1598"><a href="#-1598"><span class="linenos">1598</span></a>                <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;gradient_avg&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">gradient</span><span class="p">)</span>
</span><span id="L-1599"><a href="#-1599"><span class="linenos">1599</span></a>                <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;gradient_std&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">gradient</span><span class="p">)</span>
</span><span id="L-1600"><a href="#-1600"><span class="linenos">1600</span></a>                <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;gradient_25pct&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">gradient</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span>
</span><span id="L-1601"><a href="#-1601"><span class="linenos">1601</span></a>                <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;gradient_median&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">gradient</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
</span><span id="L-1602"><a href="#-1602"><span class="linenos">1602</span></a>                <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;gradient_75pct&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">gradient</span><span class="p">,</span> <span class="mi">75</span><span class="p">)</span>
</span><span id="L-1603"><a href="#-1603"><span class="linenos">1603</span></a>
</span><span id="L-1604"><a href="#-1604"><span class="linenos">1604</span></a>            <span class="n">clist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cl</span><span class="p">)</span>
</span><span id="L-1605"><a href="#-1605"><span class="linenos">1605</span></a>
</span><span id="L-1606"><a href="#-1606"><span class="linenos">1606</span></a>        <span class="k">return</span> <span class="n">clist</span>
</span><span id="L-1607"><a href="#-1607"><span class="linenos">1607</span></a>
</span><span id="L-1608"><a href="#-1608"><span class="linenos">1608</span></a>    <span class="k">def</span> <span class="nf">write_closure_info_to_log</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seismic_nmf</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-1609"><a href="#-1609"><span class="linenos">1609</span></a>        <span class="sd">&quot;&quot;&quot;store info about closure in log file&quot;&quot;&quot;</span>
</span><span id="L-1610"><a href="#-1610"><span class="linenos">1610</span></a>        <span class="n">top_sand_layers</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">top_lith_indices</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">facies</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">==</span> <span class="mf">1.0</span><span class="p">]</span>
</span><span id="L-1611"><a href="#-1611"><span class="linenos">1611</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="L-1612"><a href="#-1612"><span class="linenos">1612</span></a>            <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-1613"><a href="#-1613"><span class="linenos">1613</span></a>            <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span>
</span><span id="L-1614"><a href="#-1614"><span class="linenos">1614</span></a>            <span class="n">subkey</span><span class="o">=</span><span class="s2">&quot;top_sand_layers&quot;</span><span class="p">,</span>
</span><span id="L-1615"><a href="#-1615"><span class="linenos">1615</span></a>            <span class="n">val</span><span class="o">=</span><span class="n">top_sand_layers</span><span class="p">,</span>
</span><span id="L-1616"><a href="#-1616"><span class="linenos">1616</span></a>        <span class="p">)</span>
</span><span id="L-1617"><a href="#-1617"><span class="linenos">1617</span></a>        <span class="n">o</span> <span class="o">=</span> <span class="n">measure</span><span class="o">.</span><span class="n">label</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">oil_closures</span><span class="p">[:],</span> <span class="n">connectivity</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">background</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-1618"><a href="#-1618"><span class="linenos">1618</span></a>        <span class="n">g</span> <span class="o">=</span> <span class="n">measure</span><span class="o">.</span><span class="n">label</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gas_closures</span><span class="p">[:],</span> <span class="n">connectivity</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">background</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-1619"><a href="#-1619"><span class="linenos">1619</span></a>        <span class="n">b</span> <span class="o">=</span> <span class="n">measure</span><span class="o">.</span><span class="n">label</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">brine_closures</span><span class="p">[:],</span> <span class="n">connectivity</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">background</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-1620"><a href="#-1620"><span class="linenos">1620</span></a>        <span class="n">oil_closures</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">populate_closure_dict</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="s2">&quot;oil&quot;</span><span class="p">,</span> <span class="n">seismic_nmf</span><span class="p">)</span>
</span><span id="L-1621"><a href="#-1621"><span class="linenos">1621</span></a>        <span class="n">gas_closures</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">populate_closure_dict</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="s2">&quot;gas&quot;</span><span class="p">,</span> <span class="n">seismic_nmf</span><span class="p">)</span>
</span><span id="L-1622"><a href="#-1622"><span class="linenos">1622</span></a>        <span class="n">brine_closures</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">populate_closure_dict</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="s2">&quot;brine&quot;</span><span class="p">,</span> <span class="n">seismic_nmf</span><span class="p">)</span>
</span><span id="L-1623"><a href="#-1623"><span class="linenos">1623</span></a>        <span class="n">all_closures</span> <span class="o">=</span> <span class="n">oil_closures</span> <span class="o">+</span> <span class="n">gas_closures</span> <span class="o">+</span> <span class="n">brine_closures</span>
</span><span id="L-1624"><a href="#-1624"><span class="linenos">1624</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">all_closures</span><span class="p">):</span>
</span><span id="L-1625"><a href="#-1625"><span class="linenos">1625</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">sqldict</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;closure_</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">c</span>
</span><span id="L-1626"><a href="#-1626"><span class="linenos">1626</span></a>        <span class="n">num_labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">o</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
</span><span id="L-1627"><a href="#-1627"><span class="linenos">1627</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="L-1628"><a href="#-1628"><span class="linenos">1628</span></a>            <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-1629"><a href="#-1629"><span class="linenos">1629</span></a>            <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span>
</span><span id="L-1630"><a href="#-1630"><span class="linenos">1630</span></a>            <span class="n">subkey</span><span class="o">=</span><span class="s2">&quot;number_hc_closures&quot;</span><span class="p">,</span>
</span><span id="L-1631"><a href="#-1631"><span class="linenos">1631</span></a>            <span class="n">val</span><span class="o">=</span><span class="n">num_labels</span><span class="p">,</span>
</span><span id="L-1632"><a href="#-1632"><span class="linenos">1632</span></a>        <span class="p">)</span>
</span><span id="L-1633"><a href="#-1633"><span class="linenos">1633</span></a>        <span class="c1"># Add total number of closure voxels, with ratio of closure voxels given as a percentage</span>
</span><span id="L-1634"><a href="#-1634"><span class="linenos">1634</span></a>        <span class="n">closure_voxel_count</span> <span class="o">=</span> <span class="n">o</span><span class="p">[</span><span class="n">o</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="o">+</span> <span class="n">g</span><span class="p">[</span><span class="n">g</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="L-1635"><a href="#-1635"><span class="linenos">1635</span></a>        <span class="n">closure_voxel_pct</span> <span class="o">=</span> <span class="n">closure_voxel_count</span> <span class="o">/</span> <span class="n">o</span><span class="o">.</span><span class="n">size</span>
</span><span id="L-1636"><a href="#-1636"><span class="linenos">1636</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="L-1637"><a href="#-1637"><span class="linenos">1637</span></a>            <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-1638"><a href="#-1638"><span class="linenos">1638</span></a>            <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span>
</span><span id="L-1639"><a href="#-1639"><span class="linenos">1639</span></a>            <span class="n">subkey</span><span class="o">=</span><span class="s2">&quot;closure_voxel_count&quot;</span><span class="p">,</span>
</span><span id="L-1640"><a href="#-1640"><span class="linenos">1640</span></a>            <span class="n">val</span><span class="o">=</span><span class="n">closure_voxel_count</span><span class="p">,</span>
</span><span id="L-1641"><a href="#-1641"><span class="linenos">1641</span></a>        <span class="p">)</span>
</span><span id="L-1642"><a href="#-1642"><span class="linenos">1642</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="L-1643"><a href="#-1643"><span class="linenos">1643</span></a>            <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-1644"><a href="#-1644"><span class="linenos">1644</span></a>            <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span>
</span><span id="L-1645"><a href="#-1645"><span class="linenos">1645</span></a>            <span class="n">subkey</span><span class="o">=</span><span class="s2">&quot;closure_voxel_pct&quot;</span><span class="p">,</span>
</span><span id="L-1646"><a href="#-1646"><span class="linenos">1646</span></a>            <span class="n">val</span><span class="o">=</span><span class="n">closure_voxel_pct</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span>
</span><span id="L-1647"><a href="#-1647"><span class="linenos">1647</span></a>        <span class="p">)</span>
</span><span id="L-1648"><a href="#-1648"><span class="linenos">1648</span></a>        <span class="c1"># Same for Brine</span>
</span><span id="L-1649"><a href="#-1649"><span class="linenos">1649</span></a>        <span class="n">_brine_voxels</span> <span class="o">=</span> <span class="n">b</span><span class="p">[</span><span class="n">b</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="L-1650"><a href="#-1650"><span class="linenos">1650</span></a>        <span class="n">_brine_voxels_pct</span> <span class="o">=</span> <span class="n">_brine_voxels</span> <span class="o">/</span> <span class="n">b</span><span class="o">.</span><span class="n">size</span>
</span><span id="L-1651"><a href="#-1651"><span class="linenos">1651</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="L-1652"><a href="#-1652"><span class="linenos">1652</span></a>            <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-1653"><a href="#-1653"><span class="linenos">1653</span></a>            <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span>
</span><span id="L-1654"><a href="#-1654"><span class="linenos">1654</span></a>            <span class="n">subkey</span><span class="o">=</span><span class="s2">&quot;closure_voxel_count_brine&quot;</span><span class="p">,</span>
</span><span id="L-1655"><a href="#-1655"><span class="linenos">1655</span></a>            <span class="n">val</span><span class="o">=</span><span class="n">_brine_voxels</span><span class="p">,</span>
</span><span id="L-1656"><a href="#-1656"><span class="linenos">1656</span></a>        <span class="p">)</span>
</span><span id="L-1657"><a href="#-1657"><span class="linenos">1657</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="L-1658"><a href="#-1658"><span class="linenos">1658</span></a>            <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-1659"><a href="#-1659"><span class="linenos">1659</span></a>            <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span>
</span><span id="L-1660"><a href="#-1660"><span class="linenos">1660</span></a>            <span class="n">subkey</span><span class="o">=</span><span class="s2">&quot;closure_voxel_pct_brine&quot;</span><span class="p">,</span>
</span><span id="L-1661"><a href="#-1661"><span class="linenos">1661</span></a>            <span class="n">val</span><span class="o">=</span><span class="n">_brine_voxels_pct</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span>
</span><span id="L-1662"><a href="#-1662"><span class="linenos">1662</span></a>        <span class="p">)</span>
</span><span id="L-1663"><a href="#-1663"><span class="linenos">1663</span></a>        <span class="c1"># Same for Oil</span>
</span><span id="L-1664"><a href="#-1664"><span class="linenos">1664</span></a>        <span class="n">_oil_voxels</span> <span class="o">=</span> <span class="n">o</span><span class="p">[</span><span class="n">o</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="L-1665"><a href="#-1665"><span class="linenos">1665</span></a>        <span class="n">_oil_voxels_pct</span> <span class="o">=</span> <span class="n">_oil_voxels</span> <span class="o">/</span> <span class="n">o</span><span class="o">.</span><span class="n">size</span>
</span><span id="L-1666"><a href="#-1666"><span class="linenos">1666</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="L-1667"><a href="#-1667"><span class="linenos">1667</span></a>            <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-1668"><a href="#-1668"><span class="linenos">1668</span></a>            <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span>
</span><span id="L-1669"><a href="#-1669"><span class="linenos">1669</span></a>            <span class="n">subkey</span><span class="o">=</span><span class="s2">&quot;closure_voxel_count_oil&quot;</span><span class="p">,</span>
</span><span id="L-1670"><a href="#-1670"><span class="linenos">1670</span></a>            <span class="n">val</span><span class="o">=</span><span class="n">_oil_voxels</span><span class="p">,</span>
</span><span id="L-1671"><a href="#-1671"><span class="linenos">1671</span></a>        <span class="p">)</span>
</span><span id="L-1672"><a href="#-1672"><span class="linenos">1672</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="L-1673"><a href="#-1673"><span class="linenos">1673</span></a>            <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-1674"><a href="#-1674"><span class="linenos">1674</span></a>            <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span>
</span><span id="L-1675"><a href="#-1675"><span class="linenos">1675</span></a>            <span class="n">subkey</span><span class="o">=</span><span class="s2">&quot;closure_voxel_pct_oil&quot;</span><span class="p">,</span>
</span><span id="L-1676"><a href="#-1676"><span class="linenos">1676</span></a>            <span class="n">val</span><span class="o">=</span><span class="n">_oil_voxels_pct</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span>
</span><span id="L-1677"><a href="#-1677"><span class="linenos">1677</span></a>        <span class="p">)</span>
</span><span id="L-1678"><a href="#-1678"><span class="linenos">1678</span></a>        <span class="c1"># Same for Gas</span>
</span><span id="L-1679"><a href="#-1679"><span class="linenos">1679</span></a>        <span class="n">_gas_voxels</span> <span class="o">=</span> <span class="n">g</span><span class="p">[</span><span class="n">g</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="L-1680"><a href="#-1680"><span class="linenos">1680</span></a>        <span class="n">_gas_voxels_pct</span> <span class="o">=</span> <span class="n">_gas_voxels</span> <span class="o">/</span> <span class="n">g</span><span class="o">.</span><span class="n">size</span>
</span><span id="L-1681"><a href="#-1681"><span class="linenos">1681</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="L-1682"><a href="#-1682"><span class="linenos">1682</span></a>            <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-1683"><a href="#-1683"><span class="linenos">1683</span></a>            <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span>
</span><span id="L-1684"><a href="#-1684"><span class="linenos">1684</span></a>            <span class="n">subkey</span><span class="o">=</span><span class="s2">&quot;closure_voxel_count_gas&quot;</span><span class="p">,</span>
</span><span id="L-1685"><a href="#-1685"><span class="linenos">1685</span></a>            <span class="n">val</span><span class="o">=</span><span class="n">_gas_voxels</span><span class="p">,</span>
</span><span id="L-1686"><a href="#-1686"><span class="linenos">1686</span></a>        <span class="p">)</span>
</span><span id="L-1687"><a href="#-1687"><span class="linenos">1687</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="L-1688"><a href="#-1688"><span class="linenos">1688</span></a>            <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-1689"><a href="#-1689"><span class="linenos">1689</span></a>            <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span>
</span><span id="L-1690"><a href="#-1690"><span class="linenos">1690</span></a>            <span class="n">subkey</span><span class="o">=</span><span class="s2">&quot;closure_voxel_pct_gas&quot;</span><span class="p">,</span>
</span><span id="L-1691"><a href="#-1691"><span class="linenos">1691</span></a>            <span class="n">val</span><span class="o">=</span><span class="n">_gas_voxels_pct</span><span class="p">,</span>
</span><span id="L-1692"><a href="#-1692"><span class="linenos">1692</span></a>        <span class="p">)</span>
</span><span id="L-1693"><a href="#-1693"><span class="linenos">1693</span></a>        <span class="c1"># Write old logfile as well as the sql dict</span>
</span><span id="L-1694"><a href="#-1694"><span class="linenos">1694</span></a>        <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;layers for closure computation: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">top_lith_indices</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="L-1695"><a href="#-1695"><span class="linenos">1695</span></a>        <span class="n">msg</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;Number of HC Closures : </span><span class="si">{</span><span class="n">num_labels</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="L-1696"><a href="#-1696"><span class="linenos">1696</span></a>        <span class="n">msg</span> <span class="o">+=</span> <span class="p">(</span>
</span><span id="L-1697"><a href="#-1697"><span class="linenos">1697</span></a>            <span class="sa">f</span><span class="s2">&quot;Closure voxel count: </span><span class="si">{</span><span class="n">closure_voxel_count</span><span class="si">}</span><span class="s2"> - &quot;</span>
</span><span id="L-1698"><a href="#-1698"><span class="linenos">1698</span></a>            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">closure_voxel_pct</span><span class="si">:</span><span class="s2">5.2%</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="L-1699"><a href="#-1699"><span class="linenos">1699</span></a>        <span class="p">)</span>
</span><span id="L-1700"><a href="#-1700"><span class="linenos">1700</span></a>        <span class="n">msg</span> <span class="o">+=</span> <span class="p">(</span>
</span><span id="L-1701"><a href="#-1701"><span class="linenos">1701</span></a>            <span class="sa">f</span><span class="s2">&quot;Closure voxel count: (brine) </span><span class="si">{</span><span class="n">_brine_voxels</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">_brine_voxels_pct</span><span class="si">:</span><span class="s2">5.2%</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="L-1702"><a href="#-1702"><span class="linenos">1702</span></a>        <span class="p">)</span>
</span><span id="L-1703"><a href="#-1703"><span class="linenos">1703</span></a>        <span class="n">msg</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;Closure voxel count: (oil) </span><span class="si">{</span><span class="n">_oil_voxels</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">_oil_voxels_pct</span><span class="si">:</span><span class="s2">5.2%</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="L-1704"><a href="#-1704"><span class="linenos">1704</span></a>        <span class="n">msg</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;Closure voxel count: (gas) </span><span class="si">{</span><span class="n">_gas_voxels</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">_gas_voxels_pct</span><span class="si">:</span><span class="s2">5.2%</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="L-1705"><a href="#-1705"><span class="linenos">1705</span></a>        <span class="nb">print</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="L-1706"><a href="#-1706"><span class="linenos">1706</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">facies</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="L-1707"><a href="#-1707"><span class="linenos">1707</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">facies</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-1708"><a href="#-1708"><span class="linenos">1708</span></a>                <span class="n">msg</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;  layers for closure computation:   </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">, sand</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="L-1709"><a href="#-1709"><span class="linenos">1709</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-1710"><a href="#-1710"><span class="linenos">1710</span></a>                <span class="n">msg</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;  layers for closure computation:   </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">, shale</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="L-1711"><a href="#-1711"><span class="linenos">1711</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="L-1712"><a href="#-1712"><span class="linenos">1712</span></a>
</span><span id="L-1713"><a href="#-1713"><span class="linenos">1713</span></a>    <span class="k">def</span> <span class="nf">parse_label_values_and_counts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">labels_clean</span><span class="p">):</span>
</span><span id="L-1714"><a href="#-1714"><span class="linenos">1714</span></a>        <span class="sd">&quot;&quot;&quot;parse label values and counts&quot;&quot;&quot;</span>
</span><span id="L-1715"><a href="#-1715"><span class="linenos">1715</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="L-1716"><a href="#-1716"><span class="linenos">1716</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; Inside parse_label_values_and_counts&quot;</span><span class="p">)</span>
</span><span id="L-1717"><a href="#-1717"><span class="linenos">1717</span></a>        <span class="n">next_label</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-1718"><a href="#-1718"><span class="linenos">1718</span></a>        <span class="n">label_values</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-1719"><a href="#-1719"><span class="linenos">1719</span></a>        <span class="n">label_counts</span> <span class="o">=</span> <span class="p">[</span><span class="n">labels_clean</span><span class="p">[</span><span class="n">labels_clean</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">]</span>
</span><span id="L-1720"><a href="#-1720"><span class="linenos">1720</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">labels_clean</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="L-1721"><a href="#-1721"><span class="linenos">1721</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="L-1722"><a href="#-1722"><span class="linenos">1722</span></a>                <span class="n">next_label</span> <span class="o">=</span> <span class="n">labels_clean</span><span class="p">[</span><span class="n">labels_clean</span> <span class="o">&gt;</span> <span class="n">next_label</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
</span><span id="L-1723"><a href="#-1723"><span class="linenos">1723</span></a>            <span class="k">except</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
</span><span id="L-1724"><a href="#-1724"><span class="linenos">1724</span></a>                <span class="k">break</span>
</span><span id="L-1725"><a href="#-1725"><span class="linenos">1725</span></a>            <span class="n">label_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">next_label</span><span class="p">)</span>
</span><span id="L-1726"><a href="#-1726"><span class="linenos">1726</span></a>            <span class="n">label_counts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">labels_clean</span><span class="p">[</span><span class="n">labels_clean</span> <span class="o">==</span> <span class="n">next_label</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
</span><span id="L-1727"><a href="#-1727"><span class="linenos">1727</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="L-1728"><a href="#-1728"><span class="linenos">1728</span></a>                <span class="sa">f</span><span class="s2">&quot;Label: </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">, label_values: </span><span class="si">{</span><span class="n">label_values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">, label_counts: </span><span class="si">{</span><span class="n">label_counts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-1729"><a href="#-1729"><span class="linenos">1729</span></a>            <span class="p">)</span>
</span><span id="L-1730"><a href="#-1730"><span class="linenos">1730</span></a>        <span class="c1"># force labels to use consecutive integer values</span>
</span><span id="L-1731"><a href="#-1731"><span class="linenos">1731</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ilabel</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">label_values</span><span class="p">):</span>
</span><span id="L-1732"><a href="#-1732"><span class="linenos">1732</span></a>            <span class="n">labels_clean</span><span class="p">[</span><span class="n">labels_clean</span> <span class="o">==</span> <span class="n">ilabel</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
</span><span id="L-1733"><a href="#-1733"><span class="linenos">1733</span></a>            <span class="n">label_values</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
</span><span id="L-1734"><a href="#-1734"><span class="linenos">1734</span></a>        <span class="c1"># labels_clean = self.remove_small_objects(labels_clean)  # already applied to labels_clean</span>
</span><span id="L-1735"><a href="#-1735"><span class="linenos">1735</span></a>        <span class="c1"># Remove label_value 0</span>
</span><span id="L-1736"><a href="#-1736"><span class="linenos">1736</span></a>        <span class="n">label_values</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-1737"><a href="#-1737"><span class="linenos">1737</span></a>        <span class="k">return</span> <span class="n">label_values</span><span class="p">,</span> <span class="n">labels_clean</span>
</span><span id="L-1738"><a href="#-1738"><span class="linenos">1738</span></a>
</span><span id="L-1739"><a href="#-1739"><span class="linenos">1739</span></a>    <span class="k">def</span> <span class="nf">assign_fluid_types</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">label_values</span><span class="p">,</span> <span class="n">labels_clean</span><span class="p">):</span>
</span><span id="L-1740"><a href="#-1740"><span class="linenos">1740</span></a>        <span class="sd">&quot;&quot;&quot;randomly assign oil or gas to closure&quot;&quot;&quot;</span>
</span><span id="L-1741"><a href="#-1741"><span class="linenos">1741</span></a>        <span class="nb">print</span><span class="p">(</span>
</span><span id="L-1742"><a href="#-1742"><span class="linenos">1742</span></a>            <span class="s2">&quot; labels_clean.min(), labels_clean.max() = &quot;</span><span class="p">,</span>
</span><span id="L-1743"><a href="#-1743"><span class="linenos">1743</span></a>            <span class="n">labels_clean</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
</span><span id="L-1744"><a href="#-1744"><span class="linenos">1744</span></a>            <span class="n">labels_clean</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span>
</span><span id="L-1745"><a href="#-1745"><span class="linenos">1745</span></a>        <span class="p">)</span>
</span><span id="L-1746"><a href="#-1746"><span class="linenos">1746</span></a>        <span class="n">_brine_closures</span> <span class="o">=</span> <span class="p">(</span><span class="n">labels_clean</span> <span class="o">*</span> <span class="mf">0.0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;uint8&quot;</span><span class="p">)</span>
</span><span id="L-1747"><a href="#-1747"><span class="linenos">1747</span></a>        <span class="n">_oil_closures</span> <span class="o">=</span> <span class="p">(</span><span class="n">labels_clean</span> <span class="o">*</span> <span class="mf">0.0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;uint8&quot;</span><span class="p">)</span>
</span><span id="L-1748"><a href="#-1748"><span class="linenos">1748</span></a>        <span class="n">_gas_closures</span> <span class="o">=</span> <span class="p">(</span><span class="n">labels_clean</span> <span class="o">*</span> <span class="mf">0.0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;uint8&quot;</span><span class="p">)</span>
</span><span id="L-1749"><a href="#-1749"><span class="linenos">1749</span></a>
</span><span id="L-1750"><a href="#-1750"><span class="linenos">1750</span></a>        <span class="n">fluid_type_code</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">labels_clean</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-1751"><a href="#-1751"><span class="linenos">1751</span></a>
</span><span id="L-1752"><a href="#-1752"><span class="linenos">1752</span></a>        <span class="n">_closure_segments</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">closure_segments</span><span class="p">[:]</span>
</span><span id="L-1753"><a href="#-1753"><span class="linenos">1753</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">labels_clean</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="L-1754"><a href="#-1754"><span class="linenos">1754</span></a>            <span class="n">voxel_count</span> <span class="o">=</span> <span class="n">labels_clean</span><span class="p">[</span><span class="n">labels_clean</span> <span class="o">==</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="L-1755"><a href="#-1755"><span class="linenos">1755</span></a>            <span class="k">if</span> <span class="n">voxel_count</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-1756"><a href="#-1756"><span class="linenos">1756</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Voxel Count: </span><span class="si">{</span><span class="n">voxel_count</span><span class="si">}</span><span class="se">\t</span><span class="s2">Fluid type: </span><span class="si">{</span><span class="n">fluid_type_code</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1757"><a href="#-1757"><span class="linenos">1757</span></a>            <span class="c1"># not in closure = 0</span>
</span><span id="L-1758"><a href="#-1758"><span class="linenos">1758</span></a>            <span class="c1"># closure with brine filled reservoir fluid_type_code = 1</span>
</span><span id="L-1759"><a href="#-1759"><span class="linenos">1759</span></a>            <span class="c1"># closure with oil filled reservoir fluid_type_code = 2</span>
</span><span id="L-1760"><a href="#-1760"><span class="linenos">1760</span></a>            <span class="c1"># closure with gas filled reservoir fluid_type_code = 3</span>
</span><span id="L-1761"><a href="#-1761"><span class="linenos">1761</span></a>            <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">label_values</span><span class="p">:</span>
</span><span id="L-1762"><a href="#-1762"><span class="linenos">1762</span></a>                <span class="k">if</span> <span class="n">fluid_type_code</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-1763"><a href="#-1763"><span class="linenos">1763</span></a>                    <span class="c1"># brine: change labels_clean contents to fluid_type_code = 1 (same as background)</span>
</span><span id="L-1764"><a href="#-1764"><span class="linenos">1764</span></a>                    <span class="n">_brine_closures</span><span class="p">[</span>
</span><span id="L-1765"><a href="#-1765"><span class="linenos">1765</span></a>                        <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">labels_clean</span> <span class="o">==</span> <span class="n">i</span><span class="p">,</span> <span class="n">_closure_segments</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="L-1766"><a href="#-1766"><span class="linenos">1766</span></a>                    <span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-1767"><a href="#-1767"><span class="linenos">1767</span></a>                <span class="k">elif</span> <span class="n">fluid_type_code</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-1768"><a href="#-1768"><span class="linenos">1768</span></a>                    <span class="c1"># oil: change labels_clean contents to fluid_type_code = 2</span>
</span><span id="L-1769"><a href="#-1769"><span class="linenos">1769</span></a>                    <span class="n">_oil_closures</span><span class="p">[</span><span class="n">labels_clean</span> <span class="o">==</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-1770"><a href="#-1770"><span class="linenos">1770</span></a>                <span class="k">elif</span> <span class="n">fluid_type_code</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="L-1771"><a href="#-1771"><span class="linenos">1771</span></a>                    <span class="c1"># gas: change labels_clean contents to fluid_type_code = 3</span>
</span><span id="L-1772"><a href="#-1772"><span class="linenos">1772</span></a>                    <span class="n">_gas_closures</span><span class="p">[</span><span class="n">labels_clean</span> <span class="o">==</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-1773"><a href="#-1773"><span class="linenos">1773</span></a>        <span class="k">return</span> <span class="n">_oil_closures</span><span class="p">,</span> <span class="n">_gas_closures</span><span class="p">,</span> <span class="n">_brine_closures</span>
</span><span id="L-1774"><a href="#-1774"><span class="linenos">1774</span></a>
</span><span id="L-1775"><a href="#-1775"><span class="linenos">1775</span></a>    <span class="k">def</span> <span class="nf">remove_small_objects</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">min_filter</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="L-1776"><a href="#-1776"><span class="linenos">1776</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-1777"><a href="#-1777"><span class="linenos">1777</span></a>            <span class="c1"># Use the global minimum voxel size initially, before closure types are identified</span>
</span><span id="L-1778"><a href="#-1778"><span class="linenos">1778</span></a>            <span class="n">labels_clean</span> <span class="o">=</span> <span class="n">morphology</span><span class="o">.</span><span class="n">remove_small_objects</span><span class="p">(</span>
</span><span id="L-1779"><a href="#-1779"><span class="linenos">1779</span></a>                <span class="n">labels</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">closure_min_voxels</span>
</span><span id="L-1780"><a href="#-1780"><span class="linenos">1780</span></a>            <span class="p">)</span>
</span><span id="L-1781"><a href="#-1781"><span class="linenos">1781</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="L-1782"><a href="#-1782"><span class="linenos">1782</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;labels_clean succeeded.&quot;</span><span class="p">)</span>
</span><span id="L-1783"><a href="#-1783"><span class="linenos">1783</span></a>                <span class="nb">print</span><span class="p">(</span>
</span><span id="L-1784"><a href="#-1784"><span class="linenos">1784</span></a>                    <span class="s2">&quot; labels.min:</span><span class="si">{}</span><span class="s2">, labels.max: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">labels</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">labels</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
</span><span id="L-1785"><a href="#-1785"><span class="linenos">1785</span></a>                <span class="p">)</span>
</span><span id="L-1786"><a href="#-1786"><span class="linenos">1786</span></a>                <span class="nb">print</span><span class="p">(</span>
</span><span id="L-1787"><a href="#-1787"><span class="linenos">1787</span></a>                    <span class="s2">&quot; labels_clean min:</span><span class="si">{}</span><span class="s2">, labels_clean max: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="L-1788"><a href="#-1788"><span class="linenos">1788</span></a>                        <span class="n">labels_clean</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">labels_clean</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</span><span id="L-1789"><a href="#-1789"><span class="linenos">1789</span></a>                    <span class="p">)</span>
</span><span id="L-1790"><a href="#-1790"><span class="linenos">1790</span></a>                <span class="p">)</span>
</span><span id="L-1791"><a href="#-1791"><span class="linenos">1791</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="L-1792"><a href="#-1792"><span class="linenos">1792</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="L-1793"><a href="#-1793"><span class="linenos">1793</span></a>                <span class="sa">f</span><span class="s2">&quot;Closures/create_closures: labels_clean (remove_small_objects) did not succeed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-1794"><a href="#-1794"><span class="linenos">1794</span></a>            <span class="p">)</span>
</span><span id="L-1795"><a href="#-1795"><span class="linenos">1795</span></a>            <span class="k">if</span> <span class="n">min_filter</span><span class="p">:</span>
</span><span id="L-1796"><a href="#-1796"><span class="linenos">1796</span></a>                <span class="n">labels_clean</span> <span class="o">=</span> <span class="n">minimum_filter</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
</span><span id="L-1797"><a href="#-1797"><span class="linenos">1797</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="L-1798"><a href="#-1798"><span class="linenos">1798</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="L-1799"><a href="#-1799"><span class="linenos">1799</span></a>                        <span class="s2">&quot; labels.min:</span><span class="si">{}</span><span class="s2">, labels.max: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="L-1800"><a href="#-1800"><span class="linenos">1800</span></a>                            <span class="n">labels</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">labels</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</span><span id="L-1801"><a href="#-1801"><span class="linenos">1801</span></a>                        <span class="p">)</span>
</span><span id="L-1802"><a href="#-1802"><span class="linenos">1802</span></a>                    <span class="p">)</span>
</span><span id="L-1803"><a href="#-1803"><span class="linenos">1803</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="L-1804"><a href="#-1804"><span class="linenos">1804</span></a>                        <span class="s2">&quot; labels_clean min:</span><span class="si">{}</span><span class="s2">, labels_clean max: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="L-1805"><a href="#-1805"><span class="linenos">1805</span></a>                            <span class="n">labels_clean</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">labels_clean</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</span><span id="L-1806"><a href="#-1806"><span class="linenos">1806</span></a>                        <span class="p">)</span>
</span><span id="L-1807"><a href="#-1807"><span class="linenos">1807</span></a>                    <span class="p">)</span>
</span><span id="L-1808"><a href="#-1808"><span class="linenos">1808</span></a>        <span class="k">return</span> <span class="n">labels_clean</span>
</span><span id="L-1809"><a href="#-1809"><span class="linenos">1809</span></a>
</span><span id="L-1810"><a href="#-1810"><span class="linenos">1810</span></a>    <span class="k">def</span> <span class="nf">segment_closures</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_closure_segments</span><span class="p">,</span> <span class="n">remove_shale</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="L-1811"><a href="#-1811"><span class="linenos">1811</span></a>        <span class="sd">&quot;&quot;&quot;Segment the closures so that they can be randomly filled with hydrocarbons&quot;&quot;&quot;</span>
</span><span id="L-1812"><a href="#-1812"><span class="linenos">1812</span></a>
</span><span id="L-1813"><a href="#-1813"><span class="linenos">1813</span></a>        <span class="n">_closure_segments</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">_closure_segments</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
</span><span id="L-1814"><a href="#-1814"><span class="linenos">1814</span></a>        <span class="c1"># remove tiny clusters</span>
</span><span id="L-1815"><a href="#-1815"><span class="linenos">1815</span></a>        <span class="n">_closure_segments</span> <span class="o">=</span> <span class="n">minimum_filter</span><span class="p">(</span>
</span><span id="L-1816"><a href="#-1816"><span class="linenos">1816</span></a>            <span class="n">_closure_segments</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;int16&quot;</span><span class="p">),</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-1817"><a href="#-1817"><span class="linenos">1817</span></a>        <span class="p">)</span>
</span><span id="L-1818"><a href="#-1818"><span class="linenos">1818</span></a>        <span class="n">_closure_segments</span> <span class="o">=</span> <span class="n">maximum_filter</span><span class="p">(</span><span class="n">_closure_segments</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</span><span id="L-1819"><a href="#-1819"><span class="linenos">1819</span></a>
</span><span id="L-1820"><a href="#-1820"><span class="linenos">1820</span></a>        <span class="k">if</span> <span class="n">remove_shale</span><span class="p">:</span>
</span><span id="L-1821"><a href="#-1821"><span class="linenos">1821</span></a>            <span class="c1"># restrict closures to sand (non-shale) voxels</span>
</span><span id="L-1822"><a href="#-1822"><span class="linenos">1822</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">faulted_lithology</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="n">_closure_segments</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
</span><span id="L-1823"><a href="#-1823"><span class="linenos">1823</span></a>                <span class="n">sand_shale</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">faulted_lithology</span><span class="p">[:]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-1824"><a href="#-1824"><span class="linenos">1824</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-1825"><a href="#-1825"><span class="linenos">1825</span></a>                <span class="n">sand_shale</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">faulted_lithology</span><span class="p">[</span>
</span><span id="L-1826"><a href="#-1826"><span class="linenos">1826</span></a>                    <span class="p">:,</span> <span class="p">:,</span> <span class="p">::</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">infill_factor</span>
</span><span id="L-1827"><a href="#-1827"><span class="linenos">1827</span></a>                <span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-1828"><a href="#-1828"><span class="linenos">1828</span></a>            <span class="n">_closure_segments</span><span class="p">[</span><span class="n">sand_shale</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-1829"><a href="#-1829"><span class="linenos">1829</span></a>            <span class="k">del</span> <span class="n">sand_shale</span>
</span><span id="L-1830"><a href="#-1830"><span class="linenos">1830</span></a>        <span class="n">labels</span> <span class="o">=</span> <span class="n">measure</span><span class="o">.</span><span class="n">label</span><span class="p">(</span><span class="n">_closure_segments</span><span class="p">,</span> <span class="n">connectivity</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">background</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-1831"><a href="#-1831"><span class="linenos">1831</span></a>
</span><span id="L-1832"><a href="#-1832"><span class="linenos">1832</span></a>        <span class="n">labels_clean</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">remove_small_objects</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>
</span><span id="L-1833"><a href="#-1833"><span class="linenos">1833</span></a>        <span class="k">return</span> <span class="n">labels_clean</span><span class="p">,</span> <span class="n">_closure_segments</span>
</span><span id="L-1834"><a href="#-1834"><span class="linenos">1834</span></a>
</span><span id="L-1835"><a href="#-1835"><span class="linenos">1835</span></a>    <span class="k">def</span> <span class="nf">write_closure_volumes_to_disk</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-1836"><a href="#-1836"><span class="linenos">1836</span></a>        <span class="c1"># Create files for closure volumes</span>
</span><span id="L-1837"><a href="#-1837"><span class="linenos">1837</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">write_cube_to_disk</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">brine_closures</span><span class="p">[:],</span> <span class="s2">&quot;closure_segments_brine&quot;</span><span class="p">)</span>
</span><span id="L-1838"><a href="#-1838"><span class="linenos">1838</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">write_cube_to_disk</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">oil_closures</span><span class="p">[:],</span> <span class="s2">&quot;closure_segments_oil&quot;</span><span class="p">)</span>
</span><span id="L-1839"><a href="#-1839"><span class="linenos">1839</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">write_cube_to_disk</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gas_closures</span><span class="p">[:],</span> <span class="s2">&quot;closure_segments_gas&quot;</span><span class="p">)</span>
</span><span id="L-1840"><a href="#-1840"><span class="linenos">1840</span></a>        <span class="c1"># Create combined HC cube by adding oil and gas closures</span>
</span><span id="L-1841"><a href="#-1841"><span class="linenos">1841</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">hc_labels</span><span class="p">[:]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">oil_closures</span><span class="p">[:]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">gas_closures</span><span class="p">[:])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span>
</span><span id="L-1842"><a href="#-1842"><span class="linenos">1842</span></a>            <span class="s2">&quot;uint8&quot;</span>
</span><span id="L-1843"><a href="#-1843"><span class="linenos">1843</span></a>        <span class="p">)</span>
</span><span id="L-1844"><a href="#-1844"><span class="linenos">1844</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">write_cube_to_disk</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hc_labels</span><span class="p">[:],</span> <span class="s2">&quot;closure_segments_hc&quot;</span><span class="p">)</span>
</span><span id="L-1845"><a href="#-1845"><span class="linenos">1845</span></a>
</span><span id="L-1846"><a href="#-1846"><span class="linenos">1846</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">model_qc_volumes</span><span class="p">:</span>
</span><span id="L-1847"><a href="#-1847"><span class="linenos">1847</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">write_cube_to_disk</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">closure_segments</span><span class="p">,</span> <span class="s2">&quot;closure_segments_raw_all&quot;</span><span class="p">)</span>
</span><span id="L-1848"><a href="#-1848"><span class="linenos">1848</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">write_cube_to_disk</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">simple_closures</span><span class="p">,</span> <span class="s2">&quot;closure_segments_simple&quot;</span><span class="p">)</span>
</span><span id="L-1849"><a href="#-1849"><span class="linenos">1849</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">write_cube_to_disk</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">strat_closures</span><span class="p">,</span> <span class="s2">&quot;closure_segments_strat&quot;</span><span class="p">)</span>
</span><span id="L-1850"><a href="#-1850"><span class="linenos">1850</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">write_cube_to_disk</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fault_closures</span><span class="p">,</span> <span class="s2">&quot;closure_segments_fault&quot;</span><span class="p">)</span>
</span><span id="L-1851"><a href="#-1851"><span class="linenos">1851</span></a>
</span><span id="L-1852"><a href="#-1852"><span class="linenos">1852</span></a>        <span class="c1"># Triple check that no small closures exist in the final closure files</span>
</span><span id="L-1853"><a href="#-1853"><span class="linenos">1853</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span>
</span><span id="L-1854"><a href="#-1854"><span class="linenos">1854</span></a>            <span class="p">[</span>
</span><span id="L-1855"><a href="#-1855"><span class="linenos">1855</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">oil_closures</span><span class="p">,</span>
</span><span id="L-1856"><a href="#-1856"><span class="linenos">1856</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">gas_closures</span><span class="p">,</span>
</span><span id="L-1857"><a href="#-1857"><span class="linenos">1857</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">simple_closures</span><span class="p">,</span>
</span><span id="L-1858"><a href="#-1858"><span class="linenos">1858</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">strat_closures</span><span class="p">,</span>
</span><span id="L-1859"><a href="#-1859"><span class="linenos">1859</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">fault_closures</span><span class="p">,</span>
</span><span id="L-1860"><a href="#-1860"><span class="linenos">1860</span></a>            <span class="p">]</span>
</span><span id="L-1861"><a href="#-1861"><span class="linenos">1861</span></a>        <span class="p">):</span>
</span><span id="L-1862"><a href="#-1862"><span class="linenos">1862</span></a>            <span class="n">_t</span> <span class="o">=</span> <span class="n">measure</span><span class="o">.</span><span class="n">label</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">connectivity</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">background</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-1863"><a href="#-1863"><span class="linenos">1863</span></a>            <span class="n">counts</span> <span class="o">=</span> <span class="p">[</span><span class="n">_t</span><span class="p">[</span><span class="n">_t</span> <span class="o">==</span> <span class="n">x</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">_t</span><span class="p">))]</span>
</span><span id="L-1864"><a href="#-1864"><span class="linenos">1864</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Final closure volume voxels sizes: </span><span class="si">{</span><span class="n">counts</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1865"><a href="#-1865"><span class="linenos">1865</span></a>            <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">counts</span><span class="p">):</span>
</span><span id="L-1866"><a href="#-1866"><span class="linenos">1866</span></a>                <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">closure_min_voxels</span><span class="p">:</span>
</span><span id="L-1867"><a href="#-1867"><span class="linenos">1867</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Voxel count: </span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="se">\t</span><span class="s2"> Count:</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">, index: </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1868"><a href="#-1868"><span class="linenos">1868</span></a>
</span><span id="L-1869"><a href="#-1869"><span class="linenos">1869</span></a>        <span class="c1"># Return the hydrocarbon closure labels so that augmentation can be applied to the data &amp; labels</span>
</span><span id="L-1870"><a href="#-1870"><span class="linenos">1870</span></a>        <span class="c1"># return self.oil_closures + self.gas_closures</span>
</span><span id="L-1871"><a href="#-1871"><span class="linenos">1871</span></a>
</span><span id="L-1872"><a href="#-1872"><span class="linenos">1872</span></a>    <span class="k">def</span> <span class="nf">calculate_closure_statistics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">in_array</span><span class="p">,</span> <span class="n">closure_type</span><span class="p">):</span>
</span><span id="L-1873"><a href="#-1873"><span class="linenos">1873</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1874"><a href="#-1874"><span class="linenos">1874</span></a><span class="sd">        Calculate the size and location of isolated features in an array</span>
</span><span id="L-1875"><a href="#-1875"><span class="linenos">1875</span></a>
</span><span id="L-1876"><a href="#-1876"><span class="linenos">1876</span></a><span class="sd">        :param in_array: ndarray. Input array to be labelled, where non-zero values are counted as features</span>
</span><span id="L-1877"><a href="#-1877"><span class="linenos">1877</span></a><span class="sd">        :param closure_type: string. Closure type label</span>
</span><span id="L-1878"><a href="#-1878"><span class="linenos">1878</span></a><span class="sd">        :param digi: int or float. To convert depth values from samples to units</span>
</span><span id="L-1879"><a href="#-1879"><span class="linenos">1879</span></a><span class="sd">        :return: string. Concatenated string of closure statistics to be written to log</span>
</span><span id="L-1880"><a href="#-1880"><span class="linenos">1880</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1881"><a href="#-1881"><span class="linenos">1881</span></a>        <span class="n">labelled_array</span><span class="p">,</span> <span class="n">max_labels</span> <span class="o">=</span> <span class="n">measure</span><span class="o">.</span><span class="n">label</span><span class="p">(</span>
</span><span id="L-1882"><a href="#-1882"><span class="linenos">1882</span></a>            <span class="n">in_array</span><span class="p">,</span> <span class="n">connectivity</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">return_num</span><span class="o">=</span><span class="kc">True</span>
</span><span id="L-1883"><a href="#-1883"><span class="linenos">1883</span></a>        <span class="p">)</span>
</span><span id="L-1884"><a href="#-1884"><span class="linenos">1884</span></a>        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="L-1885"><a href="#-1885"><span class="linenos">1885</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_labels</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>  <span class="c1"># start at 1 to avoid counting 0&#39;s</span>
</span><span id="L-1886"><a href="#-1886"><span class="linenos">1886</span></a>            <span class="n">trap</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">labelled_array</span> <span class="o">==</span> <span class="n">i</span><span class="p">)</span>
</span><span id="L-1887"><a href="#-1887"><span class="linenos">1887</span></a>            <span class="n">ranges</span> <span class="o">=</span> <span class="p">[([</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">trap</span><span class="p">[</span><span class="n">x</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">trap</span><span class="p">[</span><span class="n">x</span><span class="p">])])</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">trap</span><span class="p">)]</span>
</span><span id="L-1888"><a href="#-1888"><span class="linenos">1888</span></a>            <span class="n">sizes</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">ranges</span><span class="p">]</span>
</span><span id="L-1889"><a href="#-1889"><span class="linenos">1889</span></a>            <span class="n">n_voxels</span> <span class="o">=</span> <span class="n">labelled_array</span><span class="p">[</span><span class="n">labelled_array</span> <span class="o">==</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="L-1890"><a href="#-1890"><span class="linenos">1890</span></a>            <span class="k">if</span> <span class="nb">sum</span><span class="p">(</span><span class="n">sizes</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-1891"><a href="#-1891"><span class="linenos">1891</span></a>                <span class="n">msg</span> <span class="o">+=</span> <span class="p">(</span>
</span><span id="L-1892"><a href="#-1892"><span class="linenos">1892</span></a>                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">closure_type</span><span class="si">}</span><span class="se">\t</span><span class="s2">&quot;</span>
</span><span id="L-1893"><a href="#-1893"><span class="linenos">1893</span></a>                    <span class="sa">f</span><span class="s2">&quot;Num X,Y,Z Samples: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">sizes</span><span class="p">)</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span><span class="si">}</span><span class="se">\t</span><span class="s2">&quot;</span>
</span><span id="L-1894"><a href="#-1894"><span class="linenos">1894</span></a>                    <span class="sa">f</span><span class="s2">&quot;Num Voxels: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">n_voxels</span><span class="p">)</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="si">}</span><span class="se">\t</span><span class="s2">&quot;</span>
</span><span id="L-1895"><a href="#-1895"><span class="linenos">1895</span></a>                    <span class="sa">f</span><span class="s2">&quot;Track: </span><span class="si">{</span><span class="mi">2000</span> <span class="o">+</span> <span class="n">ranges</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="mi">2000</span> <span class="o">+</span> <span class="n">ranges</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="se">\t</span><span class="s2">&quot;</span>
</span><span id="L-1896"><a href="#-1896"><span class="linenos">1896</span></a>                    <span class="sa">f</span><span class="s2">&quot;Bin: </span><span class="si">{</span><span class="mi">1000</span> <span class="o">+</span> <span class="n">ranges</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="mi">1000</span> <span class="o">+</span> <span class="n">ranges</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="se">\t</span><span class="s2">&quot;</span>
</span><span id="L-1897"><a href="#-1897"><span class="linenos">1897</span></a>                    <span class="sa">f</span><span class="s2">&quot;Depth: </span><span class="si">{</span><span class="n">ranges</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">digi</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">ranges</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">digi</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">digi</span> <span class="o">/</span> <span class="mi">2</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="L-1898"><a href="#-1898"><span class="linenos">1898</span></a>                <span class="p">)</span>
</span><span id="L-1899"><a href="#-1899"><span class="linenos">1899</span></a>        <span class="k">return</span> <span class="n">msg</span>
</span><span id="L-1900"><a href="#-1900"><span class="linenos">1900</span></a>
</span><span id="L-1901"><a href="#-1901"><span class="linenos">1901</span></a>    <span class="k">def</span> <span class="nf">find_faulted_closures</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">closure_segment_list</span><span class="p">,</span> <span class="n">closure_segments</span><span class="p">):</span>
</span><span id="L-1902"><a href="#-1902"><span class="linenos">1902</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dilate_faults</span><span class="p">()</span>
</span><span id="L-1903"><a href="#-1903"><span class="linenos">1903</span></a>        <span class="k">for</span> <span class="n">iclosure</span> <span class="ow">in</span> <span class="n">closure_segment_list</span><span class="p">:</span>
</span><span id="L-1904"><a href="#-1904"><span class="linenos">1904</span></a>            <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">closure_segments</span> <span class="o">==</span> <span class="n">iclosure</span><span class="p">)</span>
</span><span id="L-1905"><a href="#-1905"><span class="linenos">1905</span></a>            <span class="n">faults_within_closure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wide_faults</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span>
</span><span id="L-1906"><a href="#-1906"><span class="linenos">1906</span></a>            <span class="k">if</span> <span class="n">faults_within_closure</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-1907"><a href="#-1907"><span class="linenos">1907</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">oil_closures</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-1908"><a href="#-1908"><span class="linenos">1908</span></a>                    <span class="c1"># Faulted oil closure</span>
</span><span id="L-1909"><a href="#-1909"><span class="linenos">1909</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">faulted_closures_oil</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="L-1910"><a href="#-1910"><span class="linenos">1910</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">n_fault_closures_oil</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-1911"><a href="#-1911"><span class="linenos">1911</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">fault_closures_oil_segment_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">iclosure</span><span class="p">)</span>
</span><span id="L-1912"><a href="#-1912"><span class="linenos">1912</span></a>                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">gas_closures</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-1913"><a href="#-1913"><span class="linenos">1913</span></a>                    <span class="c1"># Faulted gas closure</span>
</span><span id="L-1914"><a href="#-1914"><span class="linenos">1914</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">faulted_closures_gas</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="L-1915"><a href="#-1915"><span class="linenos">1915</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">n_fault_closures_gas</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-1916"><a href="#-1916"><span class="linenos">1916</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">fault_closures_gas_segment_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">iclosure</span><span class="p">)</span>
</span><span id="L-1917"><a href="#-1917"><span class="linenos">1917</span></a>                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">brine_closures</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-1918"><a href="#-1918"><span class="linenos">1918</span></a>                    <span class="c1"># Faulted brine closure</span>
</span><span id="L-1919"><a href="#-1919"><span class="linenos">1919</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">faulted_closures_brine</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="L-1920"><a href="#-1920"><span class="linenos">1920</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">n_fault_closures_brine</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-1921"><a href="#-1921"><span class="linenos">1921</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">fault_closures_brine_segment_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">iclosure</span><span class="p">)</span>
</span><span id="L-1922"><a href="#-1922"><span class="linenos">1922</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-1923"><a href="#-1923"><span class="linenos">1923</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="L-1924"><a href="#-1924"><span class="linenos">1924</span></a>                        <span class="s2">&quot;Closure is faulted but does not have oil, gas or brine assigned&quot;</span>
</span><span id="L-1925"><a href="#-1925"><span class="linenos">1925</span></a>                    <span class="p">)</span>
</span><span id="L-1926"><a href="#-1926"><span class="linenos">1926</span></a>
</span><span id="L-1927"><a href="#-1927"><span class="linenos">1927</span></a>    <span class="k">def</span> <span class="nf">find_onlap_closures</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">closure_segment_list</span><span class="p">,</span> <span class="n">closure_segments</span><span class="p">):</span>
</span><span id="L-1928"><a href="#-1928"><span class="linenos">1928</span></a>        <span class="k">for</span> <span class="n">iclosure</span> <span class="ow">in</span> <span class="n">closure_segment_list</span><span class="p">:</span>
</span><span id="L-1929"><a href="#-1929"><span class="linenos">1929</span></a>            <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">closure_segments</span> <span class="o">==</span> <span class="n">iclosure</span><span class="p">)</span>
</span><span id="L-1930"><a href="#-1930"><span class="linenos">1930</span></a>            <span class="n">onlaps_within_closure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">onlaps_upward</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span>
</span><span id="L-1931"><a href="#-1931"><span class="linenos">1931</span></a>            <span class="k">if</span> <span class="n">onlaps_within_closure</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-1932"><a href="#-1932"><span class="linenos">1932</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">oil_closures</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-1933"><a href="#-1933"><span class="linenos">1933</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">onlap_closures_oil</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="L-1934"><a href="#-1934"><span class="linenos">1934</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">n_onlap_closures_oil</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-1935"><a href="#-1935"><span class="linenos">1935</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">onlap_closures_oil_segment_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">iclosure</span><span class="p">)</span>
</span><span id="L-1936"><a href="#-1936"><span class="linenos">1936</span></a>                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">gas_closures</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-1937"><a href="#-1937"><span class="linenos">1937</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">onlap_closures_gas</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="L-1938"><a href="#-1938"><span class="linenos">1938</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">n_onlap_closures_gas</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-1939"><a href="#-1939"><span class="linenos">1939</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">onlap_closures_gas_segment_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">iclosure</span><span class="p">)</span>
</span><span id="L-1940"><a href="#-1940"><span class="linenos">1940</span></a>                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">brine_closures</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-1941"><a href="#-1941"><span class="linenos">1941</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">onlap_closures_brine</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="L-1942"><a href="#-1942"><span class="linenos">1942</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">n_onlap_closures_brine</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-1943"><a href="#-1943"><span class="linenos">1943</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">onlap_closures_brine_segment_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">iclosure</span><span class="p">)</span>
</span><span id="L-1944"><a href="#-1944"><span class="linenos">1944</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-1945"><a href="#-1945"><span class="linenos">1945</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="L-1946"><a href="#-1946"><span class="linenos">1946</span></a>                        <span class="s2">&quot;Closure is onlap but does not have oil, gas or brine assigned&quot;</span>
</span><span id="L-1947"><a href="#-1947"><span class="linenos">1947</span></a>                    <span class="p">)</span>
</span><span id="L-1948"><a href="#-1948"><span class="linenos">1948</span></a>
</span><span id="L-1949"><a href="#-1949"><span class="linenos">1949</span></a>    <span class="k">def</span> <span class="nf">find_simple_closures</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">closure_segment_list</span><span class="p">,</span> <span class="n">closure_segments</span><span class="p">):</span>
</span><span id="L-1950"><a href="#-1950"><span class="linenos">1950</span></a>        <span class="k">for</span> <span class="n">iclosure</span> <span class="ow">in</span> <span class="n">closure_segment_list</span><span class="p">:</span>
</span><span id="L-1951"><a href="#-1951"><span class="linenos">1951</span></a>            <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">closure_segments</span> <span class="o">==</span> <span class="n">iclosure</span><span class="p">)</span>
</span><span id="L-1952"><a href="#-1952"><span class="linenos">1952</span></a>            <span class="n">faults_within_closure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wide_faults</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span>
</span><span id="L-1953"><a href="#-1953"><span class="linenos">1953</span></a>            <span class="n">onlaps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_threshold_volumes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">faulted_onlap_segments</span><span class="p">[:])</span>
</span><span id="L-1954"><a href="#-1954"><span class="linenos">1954</span></a>            <span class="n">onlaps_within_closure</span> <span class="o">=</span> <span class="n">onlaps</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span>
</span><span id="L-1955"><a href="#-1955"><span class="linenos">1955</span></a>            <span class="n">oil_within_closure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">oil_closures</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span>
</span><span id="L-1956"><a href="#-1956"><span class="linenos">1956</span></a>            <span class="n">gas_within_closure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gas_closures</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span>
</span><span id="L-1957"><a href="#-1957"><span class="linenos">1957</span></a>            <span class="n">brine_within_closure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">brine_closures</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span>
</span><span id="L-1958"><a href="#-1958"><span class="linenos">1958</span></a>            <span class="k">if</span> <span class="n">faults_within_closure</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">onlaps_within_closure</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-1959"><a href="#-1959"><span class="linenos">1959</span></a>                <span class="k">if</span> <span class="n">oil_within_closure</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-1960"><a href="#-1960"><span class="linenos">1960</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">simple_closures_oil</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="L-1961"><a href="#-1961"><span class="linenos">1961</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">n_4way_closures_oil</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-1962"><a href="#-1962"><span class="linenos">1962</span></a>                <span class="k">elif</span> <span class="n">gas_within_closure</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-1963"><a href="#-1963"><span class="linenos">1963</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">simple_closures_gas</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="L-1964"><a href="#-1964"><span class="linenos">1964</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">n_4way_closures_gas</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-1965"><a href="#-1965"><span class="linenos">1965</span></a>                <span class="k">elif</span> <span class="n">brine_within_closure</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-1966"><a href="#-1966"><span class="linenos">1966</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">simple_closures_brine</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="L-1967"><a href="#-1967"><span class="linenos">1967</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">n_4way_closures_brine</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-1968"><a href="#-1968"><span class="linenos">1968</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-1969"><a href="#-1969"><span class="linenos">1969</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="L-1970"><a href="#-1970"><span class="linenos">1970</span></a>                        <span class="s2">&quot;Closure is not faulted or onlap but does not have oil, gas or brine assigned&quot;</span>
</span><span id="L-1971"><a href="#-1971"><span class="linenos">1971</span></a>                    <span class="p">)</span>
</span><span id="L-1972"><a href="#-1972"><span class="linenos">1972</span></a>
</span><span id="L-1973"><a href="#-1973"><span class="linenos">1973</span></a>    <span class="k">def</span> <span class="nf">find_false_closures</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">closure_segment_list</span><span class="p">,</span> <span class="n">closure_segments</span><span class="p">):</span>
</span><span id="L-1974"><a href="#-1974"><span class="linenos">1974</span></a>        <span class="k">for</span> <span class="n">iclosure</span> <span class="ow">in</span> <span class="n">closure_segment_list</span><span class="p">:</span>
</span><span id="L-1975"><a href="#-1975"><span class="linenos">1975</span></a>            <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">closure_segments</span> <span class="o">==</span> <span class="n">iclosure</span><span class="p">)</span>
</span><span id="L-1976"><a href="#-1976"><span class="linenos">1976</span></a>            <span class="n">faults_within_closure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fat_faults</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span>
</span><span id="L-1977"><a href="#-1977"><span class="linenos">1977</span></a>            <span class="n">onlaps_within_closure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">onlaps_downward</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span>
</span><span id="L-1978"><a href="#-1978"><span class="linenos">1978</span></a>            <span class="k">for</span> <span class="n">fluid</span><span class="p">,</span> <span class="n">false</span><span class="p">,</span> <span class="n">num</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
</span><span id="L-1979"><a href="#-1979"><span class="linenos">1979</span></a>                <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">oil_closures</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gas_closures</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">brine_closures</span><span class="p">],</span>
</span><span id="L-1980"><a href="#-1980"><span class="linenos">1980</span></a>                <span class="p">[</span>
</span><span id="L-1981"><a href="#-1981"><span class="linenos">1981</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">false_closures_oil</span><span class="p">,</span>
</span><span id="L-1982"><a href="#-1982"><span class="linenos">1982</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">false_closures_gas</span><span class="p">,</span>
</span><span id="L-1983"><a href="#-1983"><span class="linenos">1983</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">false_closures_brine</span><span class="p">,</span>
</span><span id="L-1984"><a href="#-1984"><span class="linenos">1984</span></a>                <span class="p">],</span>
</span><span id="L-1985"><a href="#-1985"><span class="linenos">1985</span></a>                <span class="p">[</span>
</span><span id="L-1986"><a href="#-1986"><span class="linenos">1986</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">n_false_closures_oil</span><span class="p">,</span>
</span><span id="L-1987"><a href="#-1987"><span class="linenos">1987</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">n_false_closures_gas</span><span class="p">,</span>
</span><span id="L-1988"><a href="#-1988"><span class="linenos">1988</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">n_false_closures_brine</span><span class="p">,</span>
</span><span id="L-1989"><a href="#-1989"><span class="linenos">1989</span></a>                <span class="p">],</span>
</span><span id="L-1990"><a href="#-1990"><span class="linenos">1990</span></a>            <span class="p">):</span>
</span><span id="L-1991"><a href="#-1991"><span class="linenos">1991</span></a>                <span class="n">fluid_within_closure</span> <span class="o">=</span> <span class="n">fluid</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span>
</span><span id="L-1992"><a href="#-1992"><span class="linenos">1992</span></a>                <span class="k">if</span> <span class="n">fluid_within_closure</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-1993"><a href="#-1993"><span class="linenos">1993</span></a>                    <span class="k">if</span> <span class="n">onlaps_within_closure</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-1994"><a href="#-1994"><span class="linenos">1994</span></a>                        <span class="n">_faulted_closure_threshold</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span>
</span><span id="L-1995"><a href="#-1995"><span class="linenos">1995</span></a>                            <span class="n">faults_within_closure</span><span class="p">[</span><span class="n">faults_within_closure</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="L-1996"><a href="#-1996"><span class="linenos">1996</span></a>                            <span class="o">/</span> <span class="n">fluid_within_closure</span><span class="p">[</span><span class="n">fluid_within_closure</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="L-1997"><a href="#-1997"><span class="linenos">1997</span></a>                        <span class="p">)</span>
</span><span id="L-1998"><a href="#-1998"><span class="linenos">1998</span></a>                        <span class="n">_onlap_closure_threshold</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span>
</span><span id="L-1999"><a href="#-1999"><span class="linenos">1999</span></a>                            <span class="n">onlaps_within_closure</span><span class="p">[</span><span class="n">onlaps_within_closure</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="L-2000"><a href="#-2000"><span class="linenos">2000</span></a>                            <span class="o">/</span> <span class="n">fluid_within_closure</span><span class="p">[</span><span class="n">fluid_within_closure</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="L-2001"><a href="#-2001"><span class="linenos">2001</span></a>                        <span class="p">)</span>
</span><span id="L-2002"><a href="#-2002"><span class="linenos">2002</span></a>                        <span class="k">if</span> <span class="p">(</span>
</span><span id="L-2003"><a href="#-2003"><span class="linenos">2003</span></a>                            <span class="n">_faulted_closure_threshold</span> <span class="o">&gt;</span> <span class="mf">0.65</span>
</span><span id="L-2004"><a href="#-2004"><span class="linenos">2004</span></a>                            <span class="ow">and</span> <span class="n">_onlap_closure_threshold</span> <span class="o">&gt;</span> <span class="mf">0.65</span>
</span><span id="L-2005"><a href="#-2005"><span class="linenos">2005</span></a>                        <span class="p">):</span>
</span><span id="L-2006"><a href="#-2006"><span class="linenos">2006</span></a>                            <span class="n">false</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-2007"><a href="#-2007"><span class="linenos">2007</span></a>                            <span class="n">num</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-2008"><a href="#-2008"><span class="linenos">2008</span></a>
</span><span id="L-2009"><a href="#-2009"><span class="linenos">2009</span></a>    <span class="k">def</span> <span class="nf">find_salt_bounded_closures</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">closure_segment_list</span><span class="p">,</span> <span class="n">closure_segments</span><span class="p">):</span>
</span><span id="L-2010"><a href="#-2010"><span class="linenos">2010</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dilate_salt</span><span class="p">()</span>
</span><span id="L-2011"><a href="#-2011"><span class="linenos">2011</span></a>        <span class="k">for</span> <span class="n">iclosure</span> <span class="ow">in</span> <span class="n">closure_segment_list</span><span class="p">:</span>
</span><span id="L-2012"><a href="#-2012"><span class="linenos">2012</span></a>            <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">closure_segments</span> <span class="o">==</span> <span class="n">iclosure</span><span class="p">)</span>
</span><span id="L-2013"><a href="#-2013"><span class="linenos">2013</span></a>            <span class="n">salt_within_closure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wide_salt</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span>
</span><span id="L-2014"><a href="#-2014"><span class="linenos">2014</span></a>            <span class="k">if</span> <span class="n">salt_within_closure</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-2015"><a href="#-2015"><span class="linenos">2015</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">oil_closures</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-2016"><a href="#-2016"><span class="linenos">2016</span></a>                    <span class="c1"># salt bounded oil closure</span>
</span><span id="L-2017"><a href="#-2017"><span class="linenos">2017</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">salt_closures_oil</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="L-2018"><a href="#-2018"><span class="linenos">2018</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">n_salt_closures_oil</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-2019"><a href="#-2019"><span class="linenos">2019</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">salt_closures_oil_segment_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">iclosure</span><span class="p">)</span>
</span><span id="L-2020"><a href="#-2020"><span class="linenos">2020</span></a>                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">gas_closures</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-2021"><a href="#-2021"><span class="linenos">2021</span></a>                    <span class="c1"># salt bounded gas closure</span>
</span><span id="L-2022"><a href="#-2022"><span class="linenos">2022</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">salt_closures_gas</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="L-2023"><a href="#-2023"><span class="linenos">2023</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">n_salt_closures_gas</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-2024"><a href="#-2024"><span class="linenos">2024</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">salt_closures_gas_segment_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">iclosure</span><span class="p">)</span>
</span><span id="L-2025"><a href="#-2025"><span class="linenos">2025</span></a>                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">brine_closures</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-2026"><a href="#-2026"><span class="linenos">2026</span></a>                    <span class="c1"># salt bounded brine closure</span>
</span><span id="L-2027"><a href="#-2027"><span class="linenos">2027</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">salt_closures_brine</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="L-2028"><a href="#-2028"><span class="linenos">2028</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">n_salt_closures_brine</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-2029"><a href="#-2029"><span class="linenos">2029</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">salt_closures_brine_segment_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">iclosure</span><span class="p">)</span>
</span><span id="L-2030"><a href="#-2030"><span class="linenos">2030</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-2031"><a href="#-2031"><span class="linenos">2031</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="L-2032"><a href="#-2032"><span class="linenos">2032</span></a>                        <span class="s2">&quot;Closure is salt bounded but does not have oil, gas or brine assigned&quot;</span>
</span><span id="L-2033"><a href="#-2033"><span class="linenos">2033</span></a>                    <span class="p">)</span>
</span><span id="L-2034"><a href="#-2034"><span class="linenos">2034</span></a>
</span><span id="L-2035"><a href="#-2035"><span class="linenos">2035</span></a>    <span class="k">def</span> <span class="nf">find_faulted_all_closures</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">closure_segment_list</span><span class="p">,</span> <span class="n">closure_segments</span><span class="p">):</span>
</span><span id="L-2036"><a href="#-2036"><span class="linenos">2036</span></a>        <span class="k">for</span> <span class="n">iclosure</span> <span class="ow">in</span> <span class="n">closure_segment_list</span><span class="p">:</span>
</span><span id="L-2037"><a href="#-2037"><span class="linenos">2037</span></a>            <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">closure_segments</span> <span class="o">==</span> <span class="n">iclosure</span><span class="p">)</span>
</span><span id="L-2038"><a href="#-2038"><span class="linenos">2038</span></a>            <span class="n">faults_within_closure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wide_faults</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span>
</span><span id="L-2039"><a href="#-2039"><span class="linenos">2039</span></a>            <span class="k">if</span> <span class="n">faults_within_closure</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-2040"><a href="#-2040"><span class="linenos">2040</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">faulted_all_closures</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="L-2041"><a href="#-2041"><span class="linenos">2041</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">n_fault_all_closures</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-2042"><a href="#-2042"><span class="linenos">2042</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">fault_all_closures_segment_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">iclosure</span><span class="p">)</span>
</span><span id="L-2043"><a href="#-2043"><span class="linenos">2043</span></a>
</span><span id="L-2044"><a href="#-2044"><span class="linenos">2044</span></a>    <span class="k">def</span> <span class="nf">find_onlap_all_closures</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">closure_segment_list</span><span class="p">,</span> <span class="n">closure_segments</span><span class="p">):</span>
</span><span id="L-2045"><a href="#-2045"><span class="linenos">2045</span></a>        <span class="k">for</span> <span class="n">iclosure</span> <span class="ow">in</span> <span class="n">closure_segment_list</span><span class="p">:</span>
</span><span id="L-2046"><a href="#-2046"><span class="linenos">2046</span></a>            <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">closure_segments</span> <span class="o">==</span> <span class="n">iclosure</span><span class="p">)</span>
</span><span id="L-2047"><a href="#-2047"><span class="linenos">2047</span></a>            <span class="n">onlaps_within_closure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">onlaps_upward</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span>
</span><span id="L-2048"><a href="#-2048"><span class="linenos">2048</span></a>            <span class="k">if</span> <span class="n">onlaps_within_closure</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-2049"><a href="#-2049"><span class="linenos">2049</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">onlap_all_closures</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="L-2050"><a href="#-2050"><span class="linenos">2050</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">n_onlap_all_closures</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-2051"><a href="#-2051"><span class="linenos">2051</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">onlap_all_closures_segment_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">iclosure</span><span class="p">)</span>
</span><span id="L-2052"><a href="#-2052"><span class="linenos">2052</span></a>
</span><span id="L-2053"><a href="#-2053"><span class="linenos">2053</span></a>    <span class="k">def</span> <span class="nf">find_simple_all_closures</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">closure_segment_list</span><span class="p">,</span> <span class="n">closure_segments</span><span class="p">):</span>
</span><span id="L-2054"><a href="#-2054"><span class="linenos">2054</span></a>        <span class="k">for</span> <span class="n">iclosure</span> <span class="ow">in</span> <span class="n">closure_segment_list</span><span class="p">:</span>
</span><span id="L-2055"><a href="#-2055"><span class="linenos">2055</span></a>            <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">closure_segments</span> <span class="o">==</span> <span class="n">iclosure</span><span class="p">)</span>
</span><span id="L-2056"><a href="#-2056"><span class="linenos">2056</span></a>            <span class="n">faults_within_closure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wide_faults</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span>
</span><span id="L-2057"><a href="#-2057"><span class="linenos">2057</span></a>            <span class="n">onlaps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_threshold_volumes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">faulted_onlap_segments</span><span class="p">[:])</span>
</span><span id="L-2058"><a href="#-2058"><span class="linenos">2058</span></a>            <span class="n">onlaps_within_closure</span> <span class="o">=</span> <span class="n">onlaps</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span>
</span><span id="L-2059"><a href="#-2059"><span class="linenos">2059</span></a>            <span class="k">if</span> <span class="n">faults_within_closure</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">onlaps_within_closure</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-2060"><a href="#-2060"><span class="linenos">2060</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">simple_all_closures</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="L-2061"><a href="#-2061"><span class="linenos">2061</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">n_4way_all_closures</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-2062"><a href="#-2062"><span class="linenos">2062</span></a>
</span><span id="L-2063"><a href="#-2063"><span class="linenos">2063</span></a>    <span class="k">def</span> <span class="nf">find_false_all_closures</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">closure_segment_list</span><span class="p">,</span> <span class="n">closure_segments</span><span class="p">):</span>
</span><span id="L-2064"><a href="#-2064"><span class="linenos">2064</span></a>        <span class="k">for</span> <span class="n">iclosure</span> <span class="ow">in</span> <span class="n">closure_segment_list</span><span class="p">:</span>
</span><span id="L-2065"><a href="#-2065"><span class="linenos">2065</span></a>            <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">closure_segments</span> <span class="o">==</span> <span class="n">iclosure</span><span class="p">)</span>
</span><span id="L-2066"><a href="#-2066"><span class="linenos">2066</span></a>            <span class="n">faults_within_closure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fat_faults</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span>
</span><span id="L-2067"><a href="#-2067"><span class="linenos">2067</span></a>            <span class="n">onlaps_within_closure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">onlaps_downward</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span>
</span><span id="L-2068"><a href="#-2068"><span class="linenos">2068</span></a>            <span class="k">if</span> <span class="n">onlaps_within_closure</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-2069"><a href="#-2069"><span class="linenos">2069</span></a>                <span class="n">_faulted_closure_threshold</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span>
</span><span id="L-2070"><a href="#-2070"><span class="linenos">2070</span></a>                    <span class="n">faults_within_closure</span><span class="p">[</span><span class="n">faults_within_closure</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="o">/</span> <span class="n">i</span><span class="o">.</span><span class="n">size</span>
</span><span id="L-2071"><a href="#-2071"><span class="linenos">2071</span></a>                <span class="p">)</span>
</span><span id="L-2072"><a href="#-2072"><span class="linenos">2072</span></a>                <span class="n">_onlap_closure_threshold</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span>
</span><span id="L-2073"><a href="#-2073"><span class="linenos">2073</span></a>                    <span class="n">onlaps_within_closure</span><span class="p">[</span><span class="n">onlaps_within_closure</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="o">/</span> <span class="n">i</span><span class="o">.</span><span class="n">size</span>
</span><span id="L-2074"><a href="#-2074"><span class="linenos">2074</span></a>                <span class="p">)</span>
</span><span id="L-2075"><a href="#-2075"><span class="linenos">2075</span></a>                <span class="k">if</span> <span class="p">(</span>
</span><span id="L-2076"><a href="#-2076"><span class="linenos">2076</span></a>                    <span class="n">_faulted_closure_threshold</span> <span class="o">&gt;</span> <span class="mf">0.65</span>
</span><span id="L-2077"><a href="#-2077"><span class="linenos">2077</span></a>                    <span class="ow">and</span> <span class="n">_onlap_closure_threshold</span> <span class="o">&gt;</span> <span class="mf">0.65</span>
</span><span id="L-2078"><a href="#-2078"><span class="linenos">2078</span></a>                <span class="p">):</span>
</span><span id="L-2079"><a href="#-2079"><span class="linenos">2079</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">false_all_closures</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-2080"><a href="#-2080"><span class="linenos">2080</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">n_false_all_closures</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-2081"><a href="#-2081"><span class="linenos">2081</span></a>
</span><span id="L-2082"><a href="#-2082"><span class="linenos">2082</span></a>    <span class="k">def</span> <span class="nf">find_salt_bounded_all_closures</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">closure_segment_list</span><span class="p">,</span> <span class="n">closure_segments</span><span class="p">):</span>
</span><span id="L-2083"><a href="#-2083"><span class="linenos">2083</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dilate_salt</span><span class="p">()</span>
</span><span id="L-2084"><a href="#-2084"><span class="linenos">2084</span></a>        <span class="k">for</span> <span class="n">iclosure</span> <span class="ow">in</span> <span class="n">closure_segment_list</span><span class="p">:</span>
</span><span id="L-2085"><a href="#-2085"><span class="linenos">2085</span></a>            <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">closure_segments</span> <span class="o">==</span> <span class="n">iclosure</span><span class="p">)</span>
</span><span id="L-2086"><a href="#-2086"><span class="linenos">2086</span></a>            <span class="n">salt_within_closure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wide_salt</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span>
</span><span id="L-2087"><a href="#-2087"><span class="linenos">2087</span></a>            <span class="k">if</span> <span class="n">salt_within_closure</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-2088"><a href="#-2088"><span class="linenos">2088</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">salt_all_closures</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="L-2089"><a href="#-2089"><span class="linenos">2089</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">n_salt_all_closures</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-2090"><a href="#-2090"><span class="linenos">2090</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">salt_all_closures_segment_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">iclosure</span><span class="p">)</span>
</span><span id="L-2091"><a href="#-2091"><span class="linenos">2091</span></a>
</span><span id="L-2092"><a href="#-2092"><span class="linenos">2092</span></a>    <span class="k">def</span> <span class="nf">_dilate_faults</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-2093"><a href="#-2093"><span class="linenos">2093</span></a>        <span class="n">thresholded_faults</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_threshold_volumes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">fault_planes</span><span class="p">[:])</span>
</span><span id="L-2094"><a href="#-2094"><span class="linenos">2094</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">wide_faults</span><span class="p">[:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grow_lateral</span><span class="p">(</span>
</span><span id="L-2095"><a href="#-2095"><span class="linenos">2095</span></a>            <span class="n">thresholded_faults</span><span class="p">,</span> <span class="n">iterations</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="mi">1</span>
</span><span id="L-2096"><a href="#-2096"><span class="linenos">2096</span></a>        <span class="p">)</span>
</span><span id="L-2097"><a href="#-2097"><span class="linenos">2097</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fat_faults</span><span class="p">[:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grow_lateral</span><span class="p">(</span>
</span><span id="L-2098"><a href="#-2098"><span class="linenos">2098</span></a>            <span class="n">thresholded_faults</span><span class="p">,</span> <span class="n">iterations</span><span class="o">=</span><span class="mi">21</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="mi">1</span>
</span><span id="L-2099"><a href="#-2099"><span class="linenos">2099</span></a>        <span class="p">)</span>
</span><span id="L-2100"><a href="#-2100"><span class="linenos">2100</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">include_salt</span><span class="p">:</span>
</span><span id="L-2101"><a href="#-2101"><span class="linenos">2101</span></a>            <span class="c1"># Treat the salt body as a fault to grow closures to boundary</span>
</span><span id="L-2102"><a href="#-2102"><span class="linenos">2102</span></a>            <span class="n">thresholded_salt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_threshold_volumes</span><span class="p">(</span>
</span><span id="L-2103"><a href="#-2103"><span class="linenos">2103</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">salt_model</span><span class="o">.</span><span class="n">salt_segments</span><span class="p">[:]</span>
</span><span id="L-2104"><a href="#-2104"><span class="linenos">2104</span></a>            <span class="p">)</span>
</span><span id="L-2105"><a href="#-2105"><span class="linenos">2105</span></a>            <span class="n">wide_salt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grow_lateral</span><span class="p">(</span><span class="n">thresholded_salt</span><span class="p">,</span> <span class="n">iterations</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-2106"><a href="#-2106"><span class="linenos">2106</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">wide_salt</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">wide_salt</span>
</span><span id="L-2107"><a href="#-2107"><span class="linenos">2107</span></a>            <span class="c1"># Add salt to faults to cehck if growing the closure works</span>
</span><span id="L-2108"><a href="#-2108"><span class="linenos">2108</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">wide_faults</span><span class="p">[:]</span> <span class="o">+=</span> <span class="n">wide_salt</span>
</span><span id="L-2109"><a href="#-2109"><span class="linenos">2109</span></a>
</span><span id="L-2110"><a href="#-2110"><span class="linenos">2110</span></a>    <span class="k">def</span> <span class="nf">_dilate_salt</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-2111"><a href="#-2111"><span class="linenos">2111</span></a>        <span class="n">thresholded_salt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_threshold_volumes</span><span class="p">(</span>
</span><span id="L-2112"><a href="#-2112"><span class="linenos">2112</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">salt_model</span><span class="o">.</span><span class="n">salt_segments</span><span class="p">[:]</span>
</span><span id="L-2113"><a href="#-2113"><span class="linenos">2113</span></a>        <span class="p">)</span>
</span><span id="L-2114"><a href="#-2114"><span class="linenos">2114</span></a>        <span class="n">wide_salt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grow_lateral</span><span class="p">(</span><span class="n">thresholded_salt</span><span class="p">,</span> <span class="n">iterations</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-2115"><a href="#-2115"><span class="linenos">2115</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">wide_salt</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">wide_salt</span>
</span><span id="L-2116"><a href="#-2116"><span class="linenos">2116</span></a>
</span><span id="L-2117"><a href="#-2117"><span class="linenos">2117</span></a>    <span class="k">def</span> <span class="nf">_dilate_onlaps</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-2118"><a href="#-2118"><span class="linenos">2118</span></a>        <span class="n">onlaps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_threshold_volumes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">faulted_onlap_segments</span><span class="p">[:])</span>
</span><span id="L-2119"><a href="#-2119"><span class="linenos">2119</span></a>        <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
</span><span id="L-2120"><a href="#-2120"><span class="linenos">2120</span></a>        <span class="n">mask</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-2121"><a href="#-2121"><span class="linenos">2121</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">onlaps_upward</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">morphology</span><span class="o">.</span><span class="n">binary_dilation</span><span class="p">(</span><span class="n">onlaps</span><span class="p">,</span> <span class="n">mask</span><span class="p">)</span>
</span><span id="L-2122"><a href="#-2122"><span class="linenos">2122</span></a>        <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
</span><span id="L-2123"><a href="#-2123"><span class="linenos">2123</span></a>        <span class="n">mask</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">:]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-2124"><a href="#-2124"><span class="linenos">2124</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">onlaps_downward</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">onlaps</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-2125"><a href="#-2125"><span class="linenos">2125</span></a>        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">30</span><span class="p">):</span>
</span><span id="L-2126"><a href="#-2126"><span class="linenos">2126</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="L-2127"><a href="#-2127"><span class="linenos">2127</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">onlaps_downward</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">morphology</span><span class="o">.</span><span class="n">binary_dilation</span><span class="p">(</span>
</span><span id="L-2128"><a href="#-2128"><span class="linenos">2128</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">onlaps_downward</span><span class="p">[:],</span> <span class="n">mask</span>
</span><span id="L-2129"><a href="#-2129"><span class="linenos">2129</span></a>                <span class="p">)</span>
</span><span id="L-2130"><a href="#-2130"><span class="linenos">2130</span></a>            <span class="k">except</span><span class="p">:</span>
</span><span id="L-2131"><a href="#-2131"><span class="linenos">2131</span></a>                <span class="k">break</span>
</span><span id="L-2132"><a href="#-2132"><span class="linenos">2132</span></a>
</span><span id="L-2133"><a href="#-2133"><span class="linenos">2133</span></a>    <span class="k">def</span> <span class="nf">grow_to_fault2</span><span class="p">(</span>
</span><span id="L-2134"><a href="#-2134"><span class="linenos">2134</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">closures</span><span class="p">,</span> <span class="n">grow_only_sand_closures</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">remove_small_closures</span><span class="o">=</span><span class="kc">True</span>
</span><span id="L-2135"><a href="#-2135"><span class="linenos">2135</span></a>    <span class="p">):</span>
</span><span id="L-2136"><a href="#-2136"><span class="linenos">2136</span></a>        <span class="c1"># - grow closures laterally and up within layer and within fault block</span>
</span><span id="L-2137"><a href="#-2137"><span class="linenos">2137</span></a>        <span class="nb">print</span><span class="p">(</span>
</span><span id="L-2138"><a href="#-2138"><span class="linenos">2138</span></a>            <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2"> ... grow_to_fault2: grow closures laterally and up within layer and within fault block ...&quot;</span>
</span><span id="L-2139"><a href="#-2139"><span class="linenos">2139</span></a>        <span class="p">)</span>
</span><span id="L-2140"><a href="#-2140"><span class="linenos">2140</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span><span class="s2">&quot;growing closures to fault plane: grow_to_fault2&quot;</span><span class="p">)</span>
</span><span id="L-2141"><a href="#-2141"><span class="linenos">2141</span></a>
</span><span id="L-2142"><a href="#-2142"><span class="linenos">2142</span></a>        <span class="c1"># dilated_fault_closures = closures.copy()</span>
</span><span id="L-2143"><a href="#-2143"><span class="linenos">2143</span></a>        <span class="c1"># n_faulted_closures = dilated_fault_closures.max()</span>
</span><span id="L-2144"><a href="#-2144"><span class="linenos">2144</span></a>        <span class="n">labels_clean</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">closure_segments</span><span class="p">[:]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-2145"><a href="#-2145"><span class="linenos">2145</span></a>        <span class="n">labels_clean</span><span class="p">[</span><span class="n">closures</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-2146"><a href="#-2146"><span class="linenos">2146</span></a>        <span class="n">labels_clean_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">labels_clean</span><span class="o">.</span><span class="n">flatten</span><span class="p">()))</span>
</span><span id="L-2147"><a href="#-2147"><span class="linenos">2147</span></a>        <span class="n">labels_clean_list</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-2148"><a href="#-2148"><span class="linenos">2148</span></a>        <span class="n">initial_closures</span> <span class="o">=</span> <span class="n">labels_clean</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-2149"><a href="#-2149"><span class="linenos">2149</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">    ... grow_to_fault2: n_faulted_closures = &quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">labels_clean_list</span><span class="p">))</span>
</span><span id="L-2150"><a href="#-2150"><span class="linenos">2150</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    ... grow_to_fault2: faulted_closures = &quot;</span><span class="p">,</span> <span class="n">labels_clean_list</span><span class="p">)</span>
</span><span id="L-2151"><a href="#-2151"><span class="linenos">2151</span></a>
</span><span id="L-2152"><a href="#-2152"><span class="linenos">2152</span></a>        <span class="c1"># TODO remove this once small closures are found and fixed</span>
</span><span id="L-2153"><a href="#-2153"><span class="linenos">2153</span></a>        <span class="n">voxel_sizes</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-2154"><a href="#-2154"><span class="linenos">2154</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">closure_segments</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">closure_segments</span><span class="p">[:]</span> <span class="o">==</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="L-2155"><a href="#-2155"><span class="linenos">2155</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">labels_clean_list</span>
</span><span id="L-2156"><a href="#-2156"><span class="linenos">2156</span></a>        <span class="p">]</span>
</span><span id="L-2157"><a href="#-2157"><span class="linenos">2157</span></a>        <span class="k">for</span> <span class="n">_v</span> <span class="ow">in</span> <span class="n">voxel_sizes</span><span class="p">:</span>
</span><span id="L-2158"><a href="#-2158"><span class="linenos">2158</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Voxel_Sizes: </span><span class="si">{</span><span class="n">_v</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-2159"><a href="#-2159"><span class="linenos">2159</span></a>            <span class="k">if</span> <span class="n">_v</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">closure_min_voxels</span><span class="p">:</span>
</span><span id="L-2160"><a href="#-2160"><span class="linenos">2160</span></a>                <span class="nb">print</span><span class="p">(</span><span class="n">_v</span><span class="p">)</span>
</span><span id="L-2161"><a href="#-2161"><span class="linenos">2161</span></a>
</span><span id="L-2162"><a href="#-2162"><span class="linenos">2162</span></a>        <span class="n">depth_cube</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">faulted_age_volume</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span>
</span><span id="L-2163"><a href="#-2163"><span class="linenos">2163</span></a>        <span class="n">_depths</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">faulted_age_volume</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</span><span id="L-2164"><a href="#-2164"><span class="linenos">2164</span></a>        <span class="n">depth_cube</span> <span class="o">+=</span> <span class="n">_depths</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">faulted_age_volume</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</span><span id="L-2165"><a href="#-2165"><span class="linenos">2165</span></a>        <span class="n">_ng</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">faulted_net_to_gross</span><span class="p">[:]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-2166"><a href="#-2166"><span class="linenos">2166</span></a>        <span class="c1"># Cannot solely use NG anymore since shales may have variable net to gross</span>
</span><span id="L-2167"><a href="#-2167"><span class="linenos">2167</span></a>        <span class="n">_lith</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">faulted_lithology</span><span class="p">[:]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-2168"><a href="#-2168"><span class="linenos">2168</span></a>        <span class="n">_age</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">faulted_age_volume</span><span class="p">[:]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-2169"><a href="#-2169"><span class="linenos">2169</span></a>        <span class="n">fault_throw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">max_fault_throw</span><span class="p">[:]</span>
</span><span id="L-2170"><a href="#-2170"><span class="linenos">2170</span></a>
</span><span id="L-2171"><a href="#-2171"><span class="linenos">2171</span></a>        <span class="k">for</span> <span class="n">il</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">labels_clean_list</span><span class="p">):</span>
</span><span id="L-2172"><a href="#-2172"><span class="linenos">2172</span></a>            <span class="n">fault_blocks_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">fault_throw</span><span class="p">[</span><span class="n">labels_clean</span> <span class="o">==</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()))</span>
</span><span id="L-2173"><a href="#-2173"><span class="linenos">2173</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    ... grow_to_fault2: fault_blocks_list = &quot;</span><span class="p">,</span> <span class="n">fault_blocks_list</span><span class="p">)</span>
</span><span id="L-2174"><a href="#-2174"><span class="linenos">2174</span></a>            <span class="k">for</span> <span class="n">jl</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">fault_blocks_list</span><span class="p">):</span>
</span><span id="L-2175"><a href="#-2175"><span class="linenos">2175</span></a>                <span class="nb">print</span><span class="p">(</span>
</span><span id="L-2176"><a href="#-2176"><span class="linenos">2176</span></a>                    <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">    ... label, throw = &quot;</span><span class="p">,</span>
</span><span id="L-2177"><a href="#-2177"><span class="linenos">2177</span></a>                    <span class="n">i</span><span class="p">,</span>
</span><span id="L-2178"><a href="#-2178"><span class="linenos">2178</span></a>                    <span class="n">j</span><span class="p">,</span>
</span><span id="L-2179"><a href="#-2179"><span class="linenos">2179</span></a>                    <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">fault_throw</span><span class="p">[</span><span class="n">labels_clean</span> <span class="o">==</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">())),</span>
</span><span id="L-2180"><a href="#-2180"><span class="linenos">2180</span></a>                    <span class="n">labels_clean</span><span class="p">[</span><span class="n">labels_clean</span> <span class="o">==</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">,</span>
</span><span id="L-2181"><a href="#-2181"><span class="linenos">2181</span></a>                    <span class="n">fault_throw</span><span class="p">[</span><span class="n">fault_throw</span> <span class="o">==</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">,</span>
</span><span id="L-2182"><a href="#-2182"><span class="linenos">2182</span></a>                    <span class="n">fault_throw</span><span class="p">[</span>
</span><span id="L-2183"><a href="#-2183"><span class="linenos">2183</span></a>                        <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">labels_clean</span> <span class="o">==</span> <span class="n">i</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">fault_throw</span><span class="p">[:]</span> <span class="o">==</span> <span class="n">j</span><span class="p">))</span>
</span><span id="L-2184"><a href="#-2184"><span class="linenos">2184</span></a>                    <span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">,</span>
</span><span id="L-2185"><a href="#-2185"><span class="linenos">2185</span></a>                <span class="p">)</span>
</span><span id="L-2186"><a href="#-2186"><span class="linenos">2186</span></a>                <span class="n">single_closure</span> <span class="o">=</span> <span class="n">labels_clean</span> <span class="o">*</span> <span class="mf">0.0</span>
</span><span id="L-2187"><a href="#-2187"><span class="linenos">2187</span></a>                <span class="n">size</span> <span class="o">=</span> <span class="n">single_closure</span><span class="p">[</span>
</span><span id="L-2188"><a href="#-2188"><span class="linenos">2188</span></a>                    <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">labels_clean</span> <span class="o">==</span> <span class="n">i</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">fault_throw</span> <span class="o">-</span> <span class="n">j</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.25</span><span class="p">))</span>
</span><span id="L-2189"><a href="#-2189"><span class="linenos">2189</span></a>                <span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="L-2190"><a href="#-2190"><span class="linenos">2190</span></a>                <span class="k">if</span> <span class="n">size</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">closure_min_voxels</span><span class="p">:</span>
</span><span id="L-2191"><a href="#-2191"><span class="linenos">2191</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Label: </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">, fault_block: </span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s2">, Voxel_Count: </span><span class="si">{</span><span class="n">size</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-2192"><a href="#-2192"><span class="linenos">2192</span></a>                    <span class="n">single_closure</span><span class="p">[</span>
</span><span id="L-2193"><a href="#-2193"><span class="linenos">2193</span></a>                        <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">labels_clean</span> <span class="o">==</span> <span class="n">i</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">fault_throw</span> <span class="o">-</span> <span class="n">j</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.25</span><span class="p">))</span>
</span><span id="L-2194"><a href="#-2194"><span class="linenos">2194</span></a>                    <span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-2195"><a href="#-2195"><span class="linenos">2195</span></a>                <span class="k">if</span> <span class="n">single_closure</span><span class="p">[</span><span class="n">single_closure</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-2196"><a href="#-2196"><span class="linenos">2196</span></a>                    <span class="c1"># labels_clean[np.where((labels_clean == i) &amp; (np.abs(self.fault_throw - j) &lt; .25))] = 0</span>
</span><span id="L-2197"><a href="#-2197"><span class="linenos">2197</span></a>                    <span class="n">labels_clean</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">labels_clean</span> <span class="o">==</span> <span class="n">i</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-2198"><a href="#-2198"><span class="linenos">2198</span></a>                    <span class="k">continue</span>
</span><span id="L-2199"><a href="#-2199"><span class="linenos">2199</span></a>                <span class="n">avg_ng</span> <span class="o">=</span> <span class="n">_ng</span><span class="p">[</span><span class="n">single_closure</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</span><span id="L-2200"><a href="#-2200"><span class="linenos">2200</span></a>                <span class="n">_geo_age_voxels</span> <span class="o">=</span> <span class="p">(</span><span class="n">_age</span><span class="p">[</span><span class="n">single_closure</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;int&quot;</span><span class="p">)</span>
</span><span id="L-2201"><a href="#-2201"><span class="linenos">2201</span></a>                <span class="n">_ng_voxels</span> <span class="o">=</span> <span class="n">_ng</span><span class="p">[</span><span class="n">single_closure</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="L-2202"><a href="#-2202"><span class="linenos">2202</span></a>                <span class="n">_geo_age_voxels</span> <span class="o">=</span> <span class="n">_geo_age_voxels</span><span class="p">[</span><span class="n">_ng_voxels</span> <span class="o">&gt;=</span> <span class="n">avg_ng</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">]</span>
</span><span id="L-2203"><a href="#-2203"><span class="linenos">2203</span></a>                <span class="n">min_geo_age</span> <span class="o">=</span> <span class="n">_geo_age_voxels</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">-</span> <span class="mf">0.5</span>
</span><span id="L-2204"><a href="#-2204"><span class="linenos">2204</span></a>                <span class="n">avg_geo_age</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">_geo_age_voxels</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
</span><span id="L-2205"><a href="#-2205"><span class="linenos">2205</span></a>                <span class="n">max_geo_age</span> <span class="o">=</span> <span class="n">_geo_age_voxels</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="mf">0.5</span>
</span><span id="L-2206"><a href="#-2206"><span class="linenos">2206</span></a>                <span class="n">_depth_geobody_voxels</span> <span class="o">=</span> <span class="n">depth_cube</span><span class="p">[</span><span class="n">single_closure</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="L-2207"><a href="#-2207"><span class="linenos">2207</span></a>                <span class="n">min_depth</span> <span class="o">=</span> <span class="n">_depth_geobody_voxels</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
</span><span id="L-2208"><a href="#-2208"><span class="linenos">2208</span></a>                <span class="n">max_depth</span> <span class="o">=</span> <span class="n">_depth_geobody_voxels</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</span><span id="L-2209"><a href="#-2209"><span class="linenos">2209</span></a>                <span class="n">avg_throw</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">fault_throw</span><span class="p">[</span><span class="n">single_closure</span> <span class="o">==</span> <span class="mi">1</span><span class="p">])</span>
</span><span id="L-2210"><a href="#-2210"><span class="linenos">2210</span></a>
</span><span id="L-2211"><a href="#-2211"><span class="linenos">2211</span></a>                <span class="n">closure_boundary_cube</span> <span class="o">=</span> <span class="n">closures</span> <span class="o">*</span> <span class="mf">0.0</span>
</span><span id="L-2212"><a href="#-2212"><span class="linenos">2212</span></a>                <span class="k">if</span> <span class="n">grow_only_sand_closures</span><span class="p">:</span>
</span><span id="L-2213"><a href="#-2213"><span class="linenos">2213</span></a>                    <span class="n">lith_flag</span> <span class="o">=</span> <span class="n">_lith</span> <span class="o">&gt;</span> <span class="mf">0.0</span>
</span><span id="L-2214"><a href="#-2214"><span class="linenos">2214</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-2215"><a href="#-2215"><span class="linenos">2215</span></a>                    <span class="n">lith_flag</span> <span class="o">=</span> <span class="n">_lith</span> <span class="o">&gt;=</span> <span class="mf">0.0</span>
</span><span id="L-2216"><a href="#-2216"><span class="linenos">2216</span></a>                <span class="n">closure_boundary_cube</span><span class="p">[</span>
</span><span id="L-2217"><a href="#-2217"><span class="linenos">2217</span></a>                    <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
</span><span id="L-2218"><a href="#-2218"><span class="linenos">2218</span></a>                        <span class="n">lith_flag</span>
</span><span id="L-2219"><a href="#-2219"><span class="linenos">2219</span></a>                        <span class="o">&amp;</span> <span class="p">(</span><span class="n">_age</span> <span class="o">&gt;</span> <span class="n">min_geo_age</span><span class="p">)</span>
</span><span id="L-2220"><a href="#-2220"><span class="linenos">2220</span></a>                        <span class="o">&amp;</span> <span class="p">(</span><span class="n">_age</span> <span class="o">&lt;</span> <span class="n">max_geo_age</span><span class="p">)</span>
</span><span id="L-2221"><a href="#-2221"><span class="linenos">2221</span></a>                        <span class="o">&amp;</span> <span class="p">(</span><span class="n">fault_throw</span> <span class="o">==</span> <span class="n">avg_throw</span><span class="p">)</span>
</span><span id="L-2222"><a href="#-2222"><span class="linenos">2222</span></a>                        <span class="o">&amp;</span> <span class="p">(</span><span class="n">depth_cube</span> <span class="o">&lt;=</span> <span class="n">max_depth</span><span class="p">)</span>
</span><span id="L-2223"><a href="#-2223"><span class="linenos">2223</span></a>                    <span class="p">)</span>
</span><span id="L-2224"><a href="#-2224"><span class="linenos">2224</span></a>                <span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="L-2225"><a href="#-2225"><span class="linenos">2225</span></a>                <span class="nb">print</span><span class="p">(</span>
</span><span id="L-2226"><a href="#-2226"><span class="linenos">2226</span></a>                    <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">    ... grow_to_fault2: closure_boundary_cube voxels = &quot;</span><span class="p">,</span>
</span><span id="L-2227"><a href="#-2227"><span class="linenos">2227</span></a>                    <span class="n">closure_boundary_cube</span><span class="p">[</span><span class="n">closure_boundary_cube</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">,</span>
</span><span id="L-2228"><a href="#-2228"><span class="linenos">2228</span></a>                <span class="p">)</span>
</span><span id="L-2229"><a href="#-2229"><span class="linenos">2229</span></a>
</span><span id="L-2230"><a href="#-2230"><span class="linenos">2230</span></a>                <span class="n">n_voxel</span> <span class="o">=</span> <span class="n">single_closure</span><span class="p">[</span><span class="n">single_closure</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="L-2231"><a href="#-2231"><span class="linenos">2231</span></a>
</span><span id="L-2232"><a href="#-2232"><span class="linenos">2232</span></a>                <span class="n">original_voxels</span> <span class="o">=</span> <span class="n">n_voxel</span> <span class="o">+</span> <span class="mi">0</span>
</span><span id="L-2233"><a href="#-2233"><span class="linenos">2233</span></a>                <span class="nb">print</span><span class="p">(</span>
</span><span id="L-2234"><a href="#-2234"><span class="linenos">2234</span></a>                    <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">    ... closure label number, avg_throw, geobody shape, geo_age min/mean/max, depth min/max, avg_ng = &quot;</span><span class="p">,</span>
</span><span id="L-2235"><a href="#-2235"><span class="linenos">2235</span></a>                    <span class="n">i</span><span class="p">,</span>
</span><span id="L-2236"><a href="#-2236"><span class="linenos">2236</span></a>                    <span class="n">j</span><span class="p">,</span>
</span><span id="L-2237"><a href="#-2237"><span class="linenos">2237</span></a>                    <span class="n">n_voxel</span><span class="p">,</span>
</span><span id="L-2238"><a href="#-2238"><span class="linenos">2238</span></a>                    <span class="p">(</span><span class="n">min_geo_age</span><span class="p">,</span> <span class="n">avg_geo_age</span><span class="p">,</span> <span class="n">max_geo_age</span><span class="p">),</span>
</span><span id="L-2239"><a href="#-2239"><span class="linenos">2239</span></a>                    <span class="p">(</span><span class="n">min_depth</span><span class="p">,</span> <span class="n">max_depth</span><span class="p">),</span>
</span><span id="L-2240"><a href="#-2240"><span class="linenos">2240</span></a>                    <span class="n">avg_ng</span><span class="p">,</span>
</span><span id="L-2241"><a href="#-2241"><span class="linenos">2241</span></a>                    <span class="n">il</span><span class="p">,</span>
</span><span id="L-2242"><a href="#-2242"><span class="linenos">2242</span></a>                    <span class="s2">&quot; / &quot;</span><span class="p">,</span>
</span><span id="L-2243"><a href="#-2243"><span class="linenos">2243</span></a>                    <span class="nb">len</span><span class="p">(</span><span class="n">labels_clean_list</span><span class="p">),</span>
</span><span id="L-2244"><a href="#-2244"><span class="linenos">2244</span></a>                <span class="p">)</span>
</span><span id="L-2245"><a href="#-2245"><span class="linenos">2245</span></a>
</span><span id="L-2246"><a href="#-2246"><span class="linenos">2246</span></a>                <span class="n">grown_closure</span> <span class="o">=</span> <span class="n">single_closure</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-2247"><a href="#-2247"><span class="linenos">2247</span></a>                <span class="n">grown_closure</span><span class="p">[</span><span class="n">depth_cube</span> <span class="o">&gt;=</span> <span class="n">max_depth</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-2248"><a href="#-2248"><span class="linenos">2248</span></a>                <span class="n">delta_voxel</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-2249"><a href="#-2249"><span class="linenos">2249</span></a>                <span class="n">previous_delta_voxel</span> <span class="o">=</span> <span class="mf">1e9</span>
</span><span id="L-2250"><a href="#-2250"><span class="linenos">2250</span></a>                <span class="n">converged</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-2251"><a href="#-2251"><span class="linenos">2251</span></a>                <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">15</span><span class="p">):</span>
</span><span id="L-2252"><a href="#-2252"><span class="linenos">2252</span></a>                    <span class="n">grown_closure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grow_lateral</span><span class="p">(</span><span class="n">grown_closure</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span><span id="L-2253"><a href="#-2253"><span class="linenos">2253</span></a>                    <span class="n">grown_closure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grow_upward</span><span class="p">(</span><span class="n">grown_closure</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-2254"><a href="#-2254"><span class="linenos">2254</span></a>                    <span class="c1"># stay within layer, within age, within fault block, above HCWC</span>
</span><span id="L-2255"><a href="#-2255"><span class="linenos">2255</span></a>                    <span class="n">grown_closure</span><span class="p">[</span><span class="n">closure_boundary_cube</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="L-2256"><a href="#-2256"><span class="linenos">2256</span></a>                    <span class="n">single_closure</span> <span class="o">=</span> <span class="n">single_closure</span> <span class="o">+</span> <span class="n">grown_closure</span>
</span><span id="L-2257"><a href="#-2257"><span class="linenos">2257</span></a>                    <span class="n">single_closure</span><span class="p">[</span><span class="n">single_closure</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
</span><span id="L-2258"><a href="#-2258"><span class="linenos">2258</span></a>                    <span class="n">new_n_voxel</span> <span class="o">=</span> <span class="n">single_closure</span><span class="p">[</span><span class="n">single_closure</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="L-2259"><a href="#-2259"><span class="linenos">2259</span></a>                    <span class="n">previous_delta_voxel</span> <span class="o">=</span> <span class="n">delta_voxel</span> <span class="o">+</span> <span class="mi">0</span>
</span><span id="L-2260"><a href="#-2260"><span class="linenos">2260</span></a>                    <span class="n">delta_voxel</span> <span class="o">=</span> <span class="n">new_n_voxel</span> <span class="o">-</span> <span class="n">n_voxel</span>
</span><span id="L-2261"><a href="#-2261"><span class="linenos">2261</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="L-2262"><a href="#-2262"><span class="linenos">2262</span></a>                        <span class="s2">&quot;    ... i, ii, closure label number, geobody shape, delta_voxel, previous_delta_voxel,&quot;</span>
</span><span id="L-2263"><a href="#-2263"><span class="linenos">2263</span></a>                        <span class="s2">&quot; delta_voxel&gt;previous_delta_voxel = &quot;</span><span class="p">,</span>
</span><span id="L-2264"><a href="#-2264"><span class="linenos">2264</span></a>                        <span class="n">i</span><span class="p">,</span>
</span><span id="L-2265"><a href="#-2265"><span class="linenos">2265</span></a>                        <span class="n">ii</span><span class="p">,</span>
</span><span id="L-2266"><a href="#-2266"><span class="linenos">2266</span></a>                        <span class="n">new_n_voxel</span><span class="p">,</span>
</span><span id="L-2267"><a href="#-2267"><span class="linenos">2267</span></a>                        <span class="n">delta_voxel</span><span class="p">,</span>
</span><span id="L-2268"><a href="#-2268"><span class="linenos">2268</span></a>                        <span class="n">previous_delta_voxel</span><span class="p">,</span>
</span><span id="L-2269"><a href="#-2269"><span class="linenos">2269</span></a>                        <span class="n">delta_voxel</span> <span class="o">&gt;</span> <span class="n">previous_delta_voxel</span><span class="p">,</span>
</span><span id="L-2270"><a href="#-2270"><span class="linenos">2270</span></a>                    <span class="p">)</span>
</span><span id="L-2271"><a href="#-2271"><span class="linenos">2271</span></a>                    <span class="k">if</span> <span class="n">n_voxel</span> <span class="o">==</span> <span class="n">new_n_voxel</span><span class="p">:</span>
</span><span id="L-2272"><a href="#-2272"><span class="linenos">2272</span></a>                        <span class="c1"># finish bottom voxel layer near &quot;HCWC&quot;</span>
</span><span id="L-2273"><a href="#-2273"><span class="linenos">2273</span></a>                        <span class="n">grown_closure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grow_downward</span><span class="p">(</span>
</span><span id="L-2274"><a href="#-2274"><span class="linenos">2274</span></a>                            <span class="n">grown_closure</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span>
</span><span id="L-2275"><a href="#-2275"><span class="linenos">2275</span></a>                        <span class="p">)</span>
</span><span id="L-2276"><a href="#-2276"><span class="linenos">2276</span></a>                        <span class="c1"># stay within layer, within age, within fault block, above HCWC</span>
</span><span id="L-2277"><a href="#-2277"><span class="linenos">2277</span></a>                        <span class="n">grown_closure</span><span class="p">[</span><span class="n">closure_boundary_cube</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="L-2278"><a href="#-2278"><span class="linenos">2278</span></a>                        <span class="n">single_closure</span> <span class="o">=</span> <span class="n">single_closure</span> <span class="o">+</span> <span class="n">grown_closure</span>
</span><span id="L-2279"><a href="#-2279"><span class="linenos">2279</span></a>                        <span class="n">single_closure</span><span class="p">[</span><span class="n">single_closure</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
</span><span id="L-2280"><a href="#-2280"><span class="linenos">2280</span></a>                        <span class="n">converged</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-2281"><a href="#-2281"><span class="linenos">2281</span></a>                        <span class="k">break</span>
</span><span id="L-2282"><a href="#-2282"><span class="linenos">2282</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="L-2283"><a href="#-2283"><span class="linenos">2283</span></a>                        <span class="n">n_voxel</span> <span class="o">=</span> <span class="n">new_n_voxel</span>
</span><span id="L-2284"><a href="#-2284"><span class="linenos">2284</span></a>                    <span class="n">previous_delta_voxel</span> <span class="o">=</span> <span class="n">delta_voxel</span> <span class="o">+</span> <span class="mi">0</span>
</span><span id="L-2285"><a href="#-2285"><span class="linenos">2285</span></a>                <span class="k">if</span> <span class="n">converged</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="L-2286"><a href="#-2286"><span class="linenos">2286</span></a>                    <span class="n">labels_clean</span><span class="p">[</span><span class="n">single_closure</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
</span><span id="L-2287"><a href="#-2287"><span class="linenos">2287</span></a>                    <span class="n">msg_postscript</span> <span class="o">=</span> <span class="s2">&quot; converged&quot;</span>
</span><span id="L-2288"><a href="#-2288"><span class="linenos">2288</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-2289"><a href="#-2289"><span class="linenos">2289</span></a>                    <span class="n">labels_clean</span><span class="p">[</span><span class="n">labels_clean</span> <span class="o">==</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">i</span>
</span><span id="L-2290"><a href="#-2290"><span class="linenos">2290</span></a>                    <span class="n">msg_postscript</span> <span class="o">=</span> <span class="s2">&quot; NOT converged&quot;</span>
</span><span id="L-2291"><a href="#-2291"><span class="linenos">2291</span></a>                <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-2292"><a href="#-2292"><span class="linenos">2292</span></a>                    <span class="sa">f</span><span class="s2">&quot;closure_id: </span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="si">:</span><span class="s2">04d</span><span class="si">}</span><span class="s2">, fault_id: </span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">j</span> <span class="o">+</span> <span class="mf">.5</span><span class="p">)</span><span class="si">:</span><span class="s2">04d</span><span class="si">}</span><span class="s2">, &quot;</span>
</span><span id="L-2293"><a href="#-2293"><span class="linenos">2293</span></a>                    <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;original_voxels: </span><span class="si">{</span><span class="n">original_voxels</span><span class="si">:</span><span class="s2">11.0f</span><span class="si">}</span><span class="s2">, new_n_voxel: </span><span class="si">{</span><span class="n">new_n_voxel</span><span class="si">:</span><span class="s2">11.0f</span><span class="si">}</span><span class="s2">, &quot;</span>
</span><span id="L-2294"><a href="#-2294"><span class="linenos">2294</span></a>                    <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;percent_growth: </span><span class="si">{</span><span class="nb">float</span><span class="p">(</span><span class="n">new_n_voxel</span> <span class="o">/</span> <span class="n">original_voxels</span><span class="p">)</span><span class="si">:</span><span class="s2">6.2f</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-2295"><a href="#-2295"><span class="linenos">2295</span></a>                <span class="p">)</span>
</span><span id="L-2296"><a href="#-2296"><span class="linenos">2296</span></a>                <span class="nb">print</span><span class="p">(</span><span class="n">msg</span> <span class="o">+</span> <span class="n">msg_postscript</span><span class="p">)</span>
</span><span id="L-2297"><a href="#-2297"><span class="linenos">2297</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span><span class="n">msg</span> <span class="o">+</span> <span class="n">msg_postscript</span><span class="p">)</span>
</span><span id="L-2298"><a href="#-2298"><span class="linenos">2298</span></a>
</span><span id="L-2299"><a href="#-2299"><span class="linenos">2299</span></a>        <span class="c1"># Set small closures to 0 after growth</span>
</span><span id="L-2300"><a href="#-2300"><span class="linenos">2300</span></a>        <span class="c1"># _grown_labels = measure.label(labels_clean, connectivity=2, background=0)</span>
</span><span id="L-2301"><a href="#-2301"><span class="linenos">2301</span></a>        <span class="c1"># for x in np.unique(_grown_labels):</span>
</span><span id="L-2302"><a href="#-2302"><span class="linenos">2302</span></a>        <span class="c1">#     size = _grown_labels[_grown_labels == x].size</span>
</span><span id="L-2303"><a href="#-2303"><span class="linenos">2303</span></a>        <span class="c1">#     print(f&#39;Size before editing: {size}&#39;)</span>
</span><span id="L-2304"><a href="#-2304"><span class="linenos">2304</span></a>        <span class="c1">#     if size &lt; self.cfg.closure_min_voxels:</span>
</span><span id="L-2305"><a href="#-2305"><span class="linenos">2305</span></a>        <span class="c1">#         labels_clean[_grown_labels == x] = 0.</span>
</span><span id="L-2306"><a href="#-2306"><span class="linenos">2306</span></a>        <span class="c1"># for x in np.unique(labels_clean):</span>
</span><span id="L-2307"><a href="#-2307"><span class="linenos">2307</span></a>        <span class="c1">#     size = labels_clean[labels_clean == x].size</span>
</span><span id="L-2308"><a href="#-2308"><span class="linenos">2308</span></a>        <span class="c1">#     print(f&#39;Size after editing: {size}&#39;)</span>
</span><span id="L-2309"><a href="#-2309"><span class="linenos">2309</span></a>
</span><span id="L-2310"><a href="#-2310"><span class="linenos">2310</span></a>        <span class="k">if</span> <span class="n">remove_small_closures</span><span class="p">:</span>
</span><span id="L-2311"><a href="#-2311"><span class="linenos">2311</span></a>            <span class="n">_initial_labels</span> <span class="o">=</span> <span class="n">measure</span><span class="o">.</span><span class="n">label</span><span class="p">(</span>
</span><span id="L-2312"><a href="#-2312"><span class="linenos">2312</span></a>                <span class="n">initial_closures</span><span class="p">,</span> <span class="n">connectivity</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">background</span><span class="o">=</span><span class="mi">0</span>
</span><span id="L-2313"><a href="#-2313"><span class="linenos">2313</span></a>            <span class="p">)</span>
</span><span id="L-2314"><a href="#-2314"><span class="linenos">2314</span></a>            <span class="n">_grown_labels</span> <span class="o">=</span> <span class="n">measure</span><span class="o">.</span><span class="n">label</span><span class="p">(</span><span class="n">labels_clean</span><span class="p">,</span> <span class="n">connectivity</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">background</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-2315"><a href="#-2315"><span class="linenos">2315</span></a>            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">_grown_labels</span><span class="p">):</span>
</span><span id="L-2316"><a href="#-2316"><span class="linenos">2316</span></a>                <span class="n">size_initial</span> <span class="o">=</span> <span class="n">_initial_labels</span><span class="p">[</span><span class="n">_initial_labels</span> <span class="o">==</span> <span class="n">x</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="L-2317"><a href="#-2317"><span class="linenos">2317</span></a>                <span class="n">size_grown</span> <span class="o">=</span> <span class="n">_grown_labels</span><span class="p">[</span><span class="n">_grown_labels</span> <span class="o">==</span> <span class="n">x</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="L-2318"><a href="#-2318"><span class="linenos">2318</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Size before editing: </span><span class="si">{</span><span class="n">size_initial</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-2319"><a href="#-2319"><span class="linenos">2319</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Size after editing: </span><span class="si">{</span><span class="n">size_grown</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-2320"><a href="#-2320"><span class="linenos">2320</span></a>                <span class="k">if</span> <span class="n">size_grown</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">closure_min_voxels</span><span class="p">:</span>
</span><span id="L-2321"><a href="#-2321"><span class="linenos">2321</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="L-2322"><a href="#-2322"><span class="linenos">2322</span></a>                        <span class="sa">f</span><span class="s2">&quot;Closure below threshold of </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">closure_min_voxels</span><span class="si">}</span><span class="s2"> and will be removed&quot;</span>
</span><span id="L-2323"><a href="#-2323"><span class="linenos">2323</span></a>                    <span class="p">)</span>
</span><span id="L-2324"><a href="#-2324"><span class="linenos">2324</span></a>                    <span class="n">labels_clean</span><span class="p">[</span><span class="n">_grown_labels</span> <span class="o">==</span> <span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="L-2325"><a href="#-2325"><span class="linenos">2325</span></a>        <span class="k">return</span> <span class="n">labels_clean</span>
</span><span id="L-2326"><a href="#-2326"><span class="linenos">2326</span></a>
</span><span id="L-2327"><a href="#-2327"><span class="linenos">2327</span></a>    <span class="k">def</span> <span class="nf">grow_to_salt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">closures</span><span class="p">):</span>
</span><span id="L-2328"><a href="#-2328"><span class="linenos">2328</span></a>        <span class="c1"># - grow closures laterally and up within layer up to salt body</span>
</span><span id="L-2329"><a href="#-2329"><span class="linenos">2329</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2"> ... grow_to_salt: grow closures laterally and up within layer ...&quot;</span><span class="p">)</span>
</span><span id="L-2330"><a href="#-2330"><span class="linenos">2330</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span><span class="s2">&quot;growing closures to salt body: grow_to_salt&quot;</span><span class="p">)</span>
</span><span id="L-2331"><a href="#-2331"><span class="linenos">2331</span></a>
</span><span id="L-2332"><a href="#-2332"><span class="linenos">2332</span></a>        <span class="n">labels_clean</span> <span class="o">=</span> <span class="n">measure</span><span class="o">.</span><span class="n">label</span><span class="p">(</span>
</span><span id="L-2333"><a href="#-2333"><span class="linenos">2333</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">closure_segments</span><span class="p">[:],</span> <span class="n">connectivity</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">background</span><span class="o">=</span><span class="mi">0</span>
</span><span id="L-2334"><a href="#-2334"><span class="linenos">2334</span></a>        <span class="p">)</span>
</span><span id="L-2335"><a href="#-2335"><span class="linenos">2335</span></a>        <span class="n">labels_clean</span><span class="p">[</span><span class="n">closures</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-2336"><a href="#-2336"><span class="linenos">2336</span></a>        <span class="c1"># labels_clean = self.closure_segments[:].copy()</span>
</span><span id="L-2337"><a href="#-2337"><span class="linenos">2337</span></a>        <span class="c1"># labels_clean[closures == 0] = 0</span>
</span><span id="L-2338"><a href="#-2338"><span class="linenos">2338</span></a>        <span class="n">labels_clean_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">labels_clean</span><span class="o">.</span><span class="n">flatten</span><span class="p">()))</span>
</span><span id="L-2339"><a href="#-2339"><span class="linenos">2339</span></a>        <span class="n">labels_clean_list</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-2340"><a href="#-2340"><span class="linenos">2340</span></a>        <span class="n">initial_closures</span> <span class="o">=</span> <span class="n">labels_clean</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-2341"><a href="#-2341"><span class="linenos">2341</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">    ... grow_to_salt: n_salt_closures = &quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">labels_clean_list</span><span class="p">))</span>
</span><span id="L-2342"><a href="#-2342"><span class="linenos">2342</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    ... grow_to_salt: salt_closures = &quot;</span><span class="p">,</span> <span class="n">labels_clean_list</span><span class="p">)</span>
</span><span id="L-2343"><a href="#-2343"><span class="linenos">2343</span></a>
</span><span id="L-2344"><a href="#-2344"><span class="linenos">2344</span></a>        <span class="n">depth_cube</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">faulted_age_volume</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span>
</span><span id="L-2345"><a href="#-2345"><span class="linenos">2345</span></a>        <span class="n">_depths</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">faulted_age_volume</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</span><span id="L-2346"><a href="#-2346"><span class="linenos">2346</span></a>        <span class="n">depth_cube</span> <span class="o">+=</span> <span class="n">_depths</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">faulted_age_volume</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</span><span id="L-2347"><a href="#-2347"><span class="linenos">2347</span></a>        <span class="n">_ng</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">faulted_net_to_gross</span><span class="p">[:]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-2348"><a href="#-2348"><span class="linenos">2348</span></a>        <span class="n">_age</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">faulted_age_volume</span><span class="p">[:]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-2349"><a href="#-2349"><span class="linenos">2349</span></a>        <span class="n">salt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">salt_model</span><span class="o">.</span><span class="n">salt_segments</span><span class="p">[:]</span>
</span><span id="L-2350"><a href="#-2350"><span class="linenos">2350</span></a>
</span><span id="L-2351"><a href="#-2351"><span class="linenos">2351</span></a>        <span class="k">for</span> <span class="n">il</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">labels_clean_list</span><span class="p">):</span>
</span><span id="L-2352"><a href="#-2352"><span class="linenos">2352</span></a>            <span class="n">salt_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">salt</span><span class="p">[</span><span class="n">labels_clean</span> <span class="o">==</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()))</span>
</span><span id="L-2353"><a href="#-2353"><span class="linenos">2353</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    ... grow_to_fault2: salt_list = &quot;</span><span class="p">,</span> <span class="n">salt_list</span><span class="p">)</span>
</span><span id="L-2354"><a href="#-2354"><span class="linenos">2354</span></a>            <span class="n">single_closure</span> <span class="o">=</span> <span class="n">labels_clean</span> <span class="o">*</span> <span class="mf">0.0</span>
</span><span id="L-2355"><a href="#-2355"><span class="linenos">2355</span></a>            <span class="n">size</span> <span class="o">=</span> <span class="n">single_closure</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">labels_clean</span> <span class="o">==</span> <span class="n">i</span><span class="p">)]</span><span class="o">.</span><span class="n">size</span>
</span><span id="L-2356"><a href="#-2356"><span class="linenos">2356</span></a>            <span class="k">if</span> <span class="n">size</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">closure_min_voxels</span><span class="p">:</span>
</span><span id="L-2357"><a href="#-2357"><span class="linenos">2357</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Label: </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">, Voxel_Count: </span><span class="si">{</span><span class="n">size</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-2358"><a href="#-2358"><span class="linenos">2358</span></a>                <span class="n">single_closure</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">labels_clean</span> <span class="o">==</span> <span class="n">i</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-2359"><a href="#-2359"><span class="linenos">2359</span></a>            <span class="k">if</span> <span class="n">single_closure</span><span class="p">[</span><span class="n">single_closure</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-2360"><a href="#-2360"><span class="linenos">2360</span></a>                <span class="n">labels_clean</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">labels_clean</span> <span class="o">==</span> <span class="n">i</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-2361"><a href="#-2361"><span class="linenos">2361</span></a>                <span class="k">continue</span>
</span><span id="L-2362"><a href="#-2362"><span class="linenos">2362</span></a>            <span class="n">avg_ng</span> <span class="o">=</span> <span class="n">_ng</span><span class="p">[</span><span class="n">single_closure</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</span><span id="L-2363"><a href="#-2363"><span class="linenos">2363</span></a>            <span class="n">_geo_age_voxels</span> <span class="o">=</span> <span class="p">(</span><span class="n">_age</span><span class="p">[</span><span class="n">single_closure</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;int&quot;</span><span class="p">)</span>
</span><span id="L-2364"><a href="#-2364"><span class="linenos">2364</span></a>            <span class="n">_ng_voxels</span> <span class="o">=</span> <span class="n">_ng</span><span class="p">[</span><span class="n">single_closure</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="L-2365"><a href="#-2365"><span class="linenos">2365</span></a>            <span class="n">_geo_age_voxels</span> <span class="o">=</span> <span class="n">_geo_age_voxels</span><span class="p">[</span><span class="n">_ng_voxels</span> <span class="o">&gt;=</span> <span class="n">avg_ng</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">]</span>
</span><span id="L-2366"><a href="#-2366"><span class="linenos">2366</span></a>            <span class="n">min_geo_age</span> <span class="o">=</span> <span class="n">_geo_age_voxels</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">-</span> <span class="mf">0.5</span>
</span><span id="L-2367"><a href="#-2367"><span class="linenos">2367</span></a>            <span class="n">avg_geo_age</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">_geo_age_voxels</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
</span><span id="L-2368"><a href="#-2368"><span class="linenos">2368</span></a>            <span class="n">max_geo_age</span> <span class="o">=</span> <span class="n">_geo_age_voxels</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="mf">0.5</span>
</span><span id="L-2369"><a href="#-2369"><span class="linenos">2369</span></a>            <span class="n">_depth_geobody_voxels</span> <span class="o">=</span> <span class="n">depth_cube</span><span class="p">[</span><span class="n">single_closure</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="L-2370"><a href="#-2370"><span class="linenos">2370</span></a>            <span class="n">min_depth</span> <span class="o">=</span> <span class="n">_depth_geobody_voxels</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
</span><span id="L-2371"><a href="#-2371"><span class="linenos">2371</span></a>            <span class="n">max_depth</span> <span class="o">=</span> <span class="n">_depth_geobody_voxels</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</span><span id="L-2372"><a href="#-2372"><span class="linenos">2372</span></a>            <span class="c1"># Define AOI where salt has been dilated</span>
</span><span id="L-2373"><a href="#-2373"><span class="linenos">2373</span></a>            <span class="c1"># close_to_salt = np.zeros_like(salt)</span>
</span><span id="L-2374"><a href="#-2374"><span class="linenos">2374</span></a>            <span class="c1"># close_to_salt[self.wide_salt[:] == 1] = 1.0</span>
</span><span id="L-2375"><a href="#-2375"><span class="linenos">2375</span></a>            <span class="c1"># close_to_salt[salt == 1] = 0.0</span>
</span><span id="L-2376"><a href="#-2376"><span class="linenos">2376</span></a>
</span><span id="L-2377"><a href="#-2377"><span class="linenos">2377</span></a>            <span class="n">closure_boundary_cube</span> <span class="o">=</span> <span class="n">closures</span> <span class="o">*</span> <span class="mf">0.0</span>
</span><span id="L-2378"><a href="#-2378"><span class="linenos">2378</span></a>            <span class="n">closure_boundary_cube</span><span class="p">[</span>
</span><span id="L-2379"><a href="#-2379"><span class="linenos">2379</span></a>                <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
</span><span id="L-2380"><a href="#-2380"><span class="linenos">2380</span></a>                    <span class="p">(</span><span class="n">_ng</span> <span class="o">&gt;</span> <span class="mf">0.3</span><span class="p">)</span>
</span><span id="L-2381"><a href="#-2381"><span class="linenos">2381</span></a>                    <span class="o">&amp;</span> <span class="p">(</span><span class="n">_age</span> <span class="o">&gt;</span> <span class="n">min_geo_age</span><span class="p">)</span>  <span class="c1"># account for partial voxels</span>
</span><span id="L-2382"><a href="#-2382"><span class="linenos">2382</span></a>                    <span class="o">&amp;</span> <span class="p">(</span><span class="n">_age</span> <span class="o">&lt;</span> <span class="n">max_geo_age</span><span class="p">)</span>
</span><span id="L-2383"><a href="#-2383"><span class="linenos">2383</span></a>                    <span class="o">&amp;</span> <span class="p">(</span><span class="n">salt</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">)</span>
</span><span id="L-2384"><a href="#-2384"><span class="linenos">2384</span></a>                    <span class="o">&amp;</span> <span class="p">(</span><span class="n">depth_cube</span> <span class="o">&lt;=</span> <span class="n">max_depth</span><span class="p">)</span>
</span><span id="L-2385"><a href="#-2385"><span class="linenos">2385</span></a>                <span class="p">)</span>
</span><span id="L-2386"><a href="#-2386"><span class="linenos">2386</span></a>            <span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="L-2387"><a href="#-2387"><span class="linenos">2387</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="L-2388"><a href="#-2388"><span class="linenos">2388</span></a>                <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">    ... grow_to_fault2: closure_boundary_cube voxels = &quot;</span><span class="p">,</span>
</span><span id="L-2389"><a href="#-2389"><span class="linenos">2389</span></a>                <span class="n">closure_boundary_cube</span><span class="p">[</span><span class="n">closure_boundary_cube</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">,</span>
</span><span id="L-2390"><a href="#-2390"><span class="linenos">2390</span></a>            <span class="p">)</span>
</span><span id="L-2391"><a href="#-2391"><span class="linenos">2391</span></a>
</span><span id="L-2392"><a href="#-2392"><span class="linenos">2392</span></a>            <span class="n">n_voxel</span> <span class="o">=</span> <span class="n">single_closure</span><span class="p">[</span><span class="n">single_closure</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="L-2393"><a href="#-2393"><span class="linenos">2393</span></a>
</span><span id="L-2394"><a href="#-2394"><span class="linenos">2394</span></a>            <span class="n">original_voxels</span> <span class="o">=</span> <span class="n">n_voxel</span> <span class="o">+</span> <span class="mi">0</span>
</span><span id="L-2395"><a href="#-2395"><span class="linenos">2395</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="L-2396"><a href="#-2396"><span class="linenos">2396</span></a>                <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">    ... closure label number, avg_throw, geobody shape, geo_age min/mean/max, depth min/max, avg_ng = &quot;</span><span class="p">,</span>
</span><span id="L-2397"><a href="#-2397"><span class="linenos">2397</span></a>                <span class="n">i</span><span class="p">,</span>
</span><span id="L-2398"><a href="#-2398"><span class="linenos">2398</span></a>                <span class="n">n_voxel</span><span class="p">,</span>
</span><span id="L-2399"><a href="#-2399"><span class="linenos">2399</span></a>                <span class="p">(</span><span class="n">min_geo_age</span><span class="p">,</span> <span class="n">avg_geo_age</span><span class="p">,</span> <span class="n">max_geo_age</span><span class="p">),</span>
</span><span id="L-2400"><a href="#-2400"><span class="linenos">2400</span></a>                <span class="p">(</span><span class="n">min_depth</span><span class="p">,</span> <span class="n">max_depth</span><span class="p">),</span>
</span><span id="L-2401"><a href="#-2401"><span class="linenos">2401</span></a>                <span class="n">avg_ng</span><span class="p">,</span>
</span><span id="L-2402"><a href="#-2402"><span class="linenos">2402</span></a>                <span class="n">il</span><span class="p">,</span>
</span><span id="L-2403"><a href="#-2403"><span class="linenos">2403</span></a>                <span class="s2">&quot; / &quot;</span><span class="p">,</span>
</span><span id="L-2404"><a href="#-2404"><span class="linenos">2404</span></a>                <span class="nb">len</span><span class="p">(</span><span class="n">labels_clean_list</span><span class="p">),</span>
</span><span id="L-2405"><a href="#-2405"><span class="linenos">2405</span></a>            <span class="p">)</span>
</span><span id="L-2406"><a href="#-2406"><span class="linenos">2406</span></a>
</span><span id="L-2407"><a href="#-2407"><span class="linenos">2407</span></a>            <span class="n">grown_closure</span> <span class="o">=</span> <span class="n">single_closure</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-2408"><a href="#-2408"><span class="linenos">2408</span></a>            <span class="n">grown_closure</span><span class="p">[</span><span class="n">depth_cube</span> <span class="o">&gt;=</span> <span class="n">max_depth</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-2409"><a href="#-2409"><span class="linenos">2409</span></a>            <span class="n">delta_voxel</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-2410"><a href="#-2410"><span class="linenos">2410</span></a>            <span class="n">previous_delta_voxel</span> <span class="o">=</span> <span class="mf">1e9</span>
</span><span id="L-2411"><a href="#-2411"><span class="linenos">2411</span></a>            <span class="n">converged</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-2412"><a href="#-2412"><span class="linenos">2412</span></a>            <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">99</span><span class="p">):</span>
</span><span id="L-2413"><a href="#-2413"><span class="linenos">2413</span></a>                <span class="n">grown_closure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grow_lateral</span><span class="p">(</span><span class="n">grown_closure</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span><span id="L-2414"><a href="#-2414"><span class="linenos">2414</span></a>                <span class="n">grown_closure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grow_upward</span><span class="p">(</span><span class="n">grown_closure</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-2415"><a href="#-2415"><span class="linenos">2415</span></a>                <span class="c1"># stay within layer, within age, close to salt and above HCWC</span>
</span><span id="L-2416"><a href="#-2416"><span class="linenos">2416</span></a>                <span class="n">grown_closure</span><span class="p">[</span><span class="n">closure_boundary_cube</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="L-2417"><a href="#-2417"><span class="linenos">2417</span></a>                <span class="n">single_closure</span> <span class="o">=</span> <span class="n">single_closure</span> <span class="o">+</span> <span class="n">grown_closure</span>
</span><span id="L-2418"><a href="#-2418"><span class="linenos">2418</span></a>                <span class="n">single_closure</span><span class="p">[</span><span class="n">single_closure</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
</span><span id="L-2419"><a href="#-2419"><span class="linenos">2419</span></a>                <span class="n">new_n_voxel</span> <span class="o">=</span> <span class="n">single_closure</span><span class="p">[</span><span class="n">single_closure</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="L-2420"><a href="#-2420"><span class="linenos">2420</span></a>                <span class="n">previous_delta_voxel</span> <span class="o">=</span> <span class="n">delta_voxel</span> <span class="o">+</span> <span class="mi">0</span>
</span><span id="L-2421"><a href="#-2421"><span class="linenos">2421</span></a>                <span class="n">delta_voxel</span> <span class="o">=</span> <span class="n">new_n_voxel</span> <span class="o">-</span> <span class="n">n_voxel</span>
</span><span id="L-2422"><a href="#-2422"><span class="linenos">2422</span></a>                <span class="nb">print</span><span class="p">(</span>
</span><span id="L-2423"><a href="#-2423"><span class="linenos">2423</span></a>                    <span class="s2">&quot;    ... i, ii, closure label number, geobody shape, delta_voxel, previous_delta_voxel,&quot;</span>
</span><span id="L-2424"><a href="#-2424"><span class="linenos">2424</span></a>                    <span class="s2">&quot; delta_voxel&gt;previous_delta_voxel = &quot;</span><span class="p">,</span>
</span><span id="L-2425"><a href="#-2425"><span class="linenos">2425</span></a>                    <span class="n">i</span><span class="p">,</span>
</span><span id="L-2426"><a href="#-2426"><span class="linenos">2426</span></a>                    <span class="n">ii</span><span class="p">,</span>
</span><span id="L-2427"><a href="#-2427"><span class="linenos">2427</span></a>                    <span class="n">new_n_voxel</span><span class="p">,</span>
</span><span id="L-2428"><a href="#-2428"><span class="linenos">2428</span></a>                    <span class="n">delta_voxel</span><span class="p">,</span>
</span><span id="L-2429"><a href="#-2429"><span class="linenos">2429</span></a>                    <span class="n">previous_delta_voxel</span><span class="p">,</span>
</span><span id="L-2430"><a href="#-2430"><span class="linenos">2430</span></a>                    <span class="n">delta_voxel</span> <span class="o">&gt;</span> <span class="n">previous_delta_voxel</span><span class="p">,</span>
</span><span id="L-2431"><a href="#-2431"><span class="linenos">2431</span></a>                <span class="p">)</span>
</span><span id="L-2432"><a href="#-2432"><span class="linenos">2432</span></a>
</span><span id="L-2433"><a href="#-2433"><span class="linenos">2433</span></a>                <span class="c1"># If grown voxel is touching the egde of survey, stop and remove closure</span>
</span><span id="L-2434"><a href="#-2434"><span class="linenos">2434</span></a>                <span class="n">_a</span><span class="p">,</span> <span class="n">_b</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">single_closure</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="L-2435"><a href="#-2435"><span class="linenos">2435</span></a>                <span class="n">max_boundary_i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>
</span><span id="L-2436"><a href="#-2436"><span class="linenos">2436</span></a>                <span class="n">max_boundary_j</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>
</span><span id="L-2437"><a href="#-2437"><span class="linenos">2437</span></a>                <span class="k">if</span> <span class="p">(</span>
</span><span id="L-2438"><a href="#-2438"><span class="linenos">2438</span></a>                    <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">_a</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>
</span><span id="L-2439"><a href="#-2439"><span class="linenos">2439</span></a>                    <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">_a</span><span class="p">)</span> <span class="o">==</span> <span class="n">max_boundary_i</span>
</span><span id="L-2440"><a href="#-2440"><span class="linenos">2440</span></a>                    <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">_b</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>
</span><span id="L-2441"><a href="#-2441"><span class="linenos">2441</span></a>                    <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">_b</span><span class="p">)</span> <span class="o">==</span> <span class="n">max_boundary_j</span>
</span><span id="L-2442"><a href="#-2442"><span class="linenos">2442</span></a>                <span class="p">):</span>
</span><span id="L-2443"><a href="#-2443"><span class="linenos">2443</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Boundary reached, removing closure&quot;</span><span class="p">)</span>
</span><span id="L-2444"><a href="#-2444"><span class="linenos">2444</span></a>                    <span class="n">converged</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-2445"><a href="#-2445"><span class="linenos">2445</span></a>                    <span class="k">break</span>
</span><span id="L-2446"><a href="#-2446"><span class="linenos">2446</span></a>
</span><span id="L-2447"><a href="#-2447"><span class="linenos">2447</span></a>                <span class="k">if</span> <span class="n">n_voxel</span> <span class="o">==</span> <span class="n">new_n_voxel</span><span class="p">:</span>
</span><span id="L-2448"><a href="#-2448"><span class="linenos">2448</span></a>                    <span class="c1"># finish bottom voxel layer near HCWC</span>
</span><span id="L-2449"><a href="#-2449"><span class="linenos">2449</span></a>                    <span class="n">grown_closure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grow_downward</span><span class="p">(</span>
</span><span id="L-2450"><a href="#-2450"><span class="linenos">2450</span></a>                        <span class="n">grown_closure</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span>
</span><span id="L-2451"><a href="#-2451"><span class="linenos">2451</span></a>                    <span class="p">)</span>
</span><span id="L-2452"><a href="#-2452"><span class="linenos">2452</span></a>                    <span class="c1"># stay within layer, within age, within fault block, above HCWC</span>
</span><span id="L-2453"><a href="#-2453"><span class="linenos">2453</span></a>                    <span class="n">grown_closure</span><span class="p">[</span><span class="n">closure_boundary_cube</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="L-2454"><a href="#-2454"><span class="linenos">2454</span></a>                    <span class="n">single_closure</span> <span class="o">=</span> <span class="n">single_closure</span> <span class="o">+</span> <span class="n">grown_closure</span>
</span><span id="L-2455"><a href="#-2455"><span class="linenos">2455</span></a>                    <span class="n">single_closure</span><span class="p">[</span><span class="n">single_closure</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
</span><span id="L-2456"><a href="#-2456"><span class="linenos">2456</span></a>                    <span class="n">converged</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-2457"><a href="#-2457"><span class="linenos">2457</span></a>                    <span class="k">break</span>
</span><span id="L-2458"><a href="#-2458"><span class="linenos">2458</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-2459"><a href="#-2459"><span class="linenos">2459</span></a>                    <span class="n">n_voxel</span> <span class="o">=</span> <span class="n">new_n_voxel</span>
</span><span id="L-2460"><a href="#-2460"><span class="linenos">2460</span></a>                <span class="n">previous_delta_voxel</span> <span class="o">=</span> <span class="n">delta_voxel</span> <span class="o">+</span> <span class="mi">0</span>
</span><span id="L-2461"><a href="#-2461"><span class="linenos">2461</span></a>            <span class="k">if</span> <span class="n">converged</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="L-2462"><a href="#-2462"><span class="linenos">2462</span></a>                <span class="n">labels_clean</span><span class="p">[</span><span class="n">single_closure</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
</span><span id="L-2463"><a href="#-2463"><span class="linenos">2463</span></a>                <span class="n">msg_postscript</span> <span class="o">=</span> <span class="s2">&quot; converged&quot;</span>
</span><span id="L-2464"><a href="#-2464"><span class="linenos">2464</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-2465"><a href="#-2465"><span class="linenos">2465</span></a>                <span class="n">labels_clean</span><span class="p">[</span><span class="n">labels_clean</span> <span class="o">==</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">i</span>
</span><span id="L-2466"><a href="#-2466"><span class="linenos">2466</span></a>                <span class="n">msg_postscript</span> <span class="o">=</span> <span class="s2">&quot; NOT converged&quot;</span>
</span><span id="L-2467"><a href="#-2467"><span class="linenos">2467</span></a>            <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-2468"><a href="#-2468"><span class="linenos">2468</span></a>                <span class="sa">f</span><span class="s2">&quot;closure_id: </span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="si">:</span><span class="s2">04d</span><span class="si">}</span><span class="s2">, &quot;</span>
</span><span id="L-2469"><a href="#-2469"><span class="linenos">2469</span></a>                <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;original_voxels: </span><span class="si">{</span><span class="n">original_voxels</span><span class="si">:</span><span class="s2">11.0f</span><span class="si">}</span><span class="s2">, new_n_voxel: </span><span class="si">{</span><span class="n">new_n_voxel</span><span class="si">:</span><span class="s2">11.0f</span><span class="si">}</span><span class="s2">, &quot;</span>
</span><span id="L-2470"><a href="#-2470"><span class="linenos">2470</span></a>                <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;percent_growth: </span><span class="si">{</span><span class="nb">float</span><span class="p">(</span><span class="n">new_n_voxel</span> <span class="o">/</span> <span class="n">original_voxels</span><span class="p">)</span><span class="si">:</span><span class="s2">6.2f</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-2471"><a href="#-2471"><span class="linenos">2471</span></a>            <span class="p">)</span>
</span><span id="L-2472"><a href="#-2472"><span class="linenos">2472</span></a>            <span class="nb">print</span><span class="p">(</span><span class="n">msg</span> <span class="o">+</span> <span class="n">msg_postscript</span><span class="p">)</span>
</span><span id="L-2473"><a href="#-2473"><span class="linenos">2473</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span><span class="n">msg</span> <span class="o">+</span> <span class="n">msg_postscript</span><span class="p">)</span>
</span><span id="L-2474"><a href="#-2474"><span class="linenos">2474</span></a>
</span><span id="L-2475"><a href="#-2475"><span class="linenos">2475</span></a>        <span class="c1"># Set small closures to 0 after growth</span>
</span><span id="L-2476"><a href="#-2476"><span class="linenos">2476</span></a>        <span class="n">_initial_labels</span> <span class="o">=</span> <span class="n">measure</span><span class="o">.</span><span class="n">label</span><span class="p">(</span><span class="n">initial_closures</span><span class="p">,</span> <span class="n">connectivity</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">background</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-2477"><a href="#-2477"><span class="linenos">2477</span></a>        <span class="n">_grown_labels</span> <span class="o">=</span> <span class="n">measure</span><span class="o">.</span><span class="n">label</span><span class="p">(</span><span class="n">labels_clean</span><span class="p">,</span> <span class="n">connectivity</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">background</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-2478"><a href="#-2478"><span class="linenos">2478</span></a>        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">_grown_labels</span><span class="p">)[</span>
</span><span id="L-2479"><a href="#-2479"><span class="linenos">2479</span></a>            <span class="mi">1</span><span class="p">:</span>
</span><span id="L-2480"><a href="#-2480"><span class="linenos">2480</span></a>        <span class="p">]:</span>  <span class="c1"># ignore the first label of 0 (closures only)</span>
</span><span id="L-2481"><a href="#-2481"><span class="linenos">2481</span></a>            <span class="n">size_initial</span> <span class="o">=</span> <span class="n">_initial_labels</span><span class="p">[</span><span class="n">_initial_labels</span> <span class="o">==</span> <span class="n">x</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="L-2482"><a href="#-2482"><span class="linenos">2482</span></a>            <span class="n">size_grown</span> <span class="o">=</span> <span class="n">_grown_labels</span><span class="p">[</span><span class="n">_grown_labels</span> <span class="o">==</span> <span class="n">x</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="L-2483"><a href="#-2483"><span class="linenos">2483</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Size before editing: </span><span class="si">{</span><span class="n">size_initial</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-2484"><a href="#-2484"><span class="linenos">2484</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Size after editing: </span><span class="si">{</span><span class="n">size_grown</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-2485"><a href="#-2485"><span class="linenos">2485</span></a>            <span class="k">if</span> <span class="n">size_grown</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">closure_min_voxels</span><span class="p">:</span>
</span><span id="L-2486"><a href="#-2486"><span class="linenos">2486</span></a>                <span class="nb">print</span><span class="p">(</span>
</span><span id="L-2487"><a href="#-2487"><span class="linenos">2487</span></a>                    <span class="sa">f</span><span class="s2">&quot;Closure below threshold of </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">closure_min_voxels</span><span class="si">}</span><span class="s2"> and will be removed&quot;</span>
</span><span id="L-2488"><a href="#-2488"><span class="linenos">2488</span></a>                <span class="p">)</span>
</span><span id="L-2489"><a href="#-2489"><span class="linenos">2489</span></a>                <span class="n">labels_clean</span><span class="p">[</span><span class="n">_grown_labels</span> <span class="o">==</span> <span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="L-2490"><a href="#-2490"><span class="linenos">2490</span></a>
</span><span id="L-2491"><a href="#-2491"><span class="linenos">2491</span></a>        <span class="k">return</span> <span class="n">labels_clean</span>
</span><span id="L-2492"><a href="#-2492"><span class="linenos">2492</span></a>
</span><span id="L-2493"><a href="#-2493"><span class="linenos">2493</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-2494"><a href="#-2494"><span class="linenos">2494</span></a>    <span class="k">def</span> <span class="nf">grow_lateral</span><span class="p">(</span><span class="n">geobody</span><span class="p">,</span> <span class="n">iterations</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="L-2495"><a href="#-2495"><span class="linenos">2495</span></a>        <span class="kn">from</span> <span class="nn">scipy.ndimage.morphology</span> <span class="kn">import</span> <span class="n">grey_dilation</span>
</span><span id="L-2496"><a href="#-2496"><span class="linenos">2496</span></a>
</span><span id="L-2497"><a href="#-2497"><span class="linenos">2497</span></a>        <span class="n">dist_size</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">dist</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="L-2498"><a href="#-2498"><span class="linenos">2498</span></a>        <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">dist_size</span><span class="p">,</span> <span class="n">dist_size</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</span><span id="L-2499"><a href="#-2499"><span class="linenos">2499</span></a>        <span class="n">mask</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-2500"><a href="#-2500"><span class="linenos">2500</span></a>        <span class="n">_geobody</span> <span class="o">=</span> <span class="n">geobody</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-2501"><a href="#-2501"><span class="linenos">2501</span></a>        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="L-2502"><a href="#-2502"><span class="linenos">2502</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; ...grow_lateral: _geobody.shape = &quot;</span><span class="p">,</span> <span class="n">_geobody</span><span class="p">[</span><span class="n">_geobody</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span><span id="L-2503"><a href="#-2503"><span class="linenos">2503</span></a>        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">iterations</span><span class="p">):</span>
</span><span id="L-2504"><a href="#-2504"><span class="linenos">2504</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="L-2505"><a href="#-2505"><span class="linenos">2505</span></a>                <span class="n">_geobody</span> <span class="o">=</span> <span class="n">grey_dilation</span><span class="p">(</span><span class="n">_geobody</span><span class="p">,</span> <span class="n">footprint</span><span class="o">=</span><span class="n">mask</span><span class="p">)</span>
</span><span id="L-2506"><a href="#-2506"><span class="linenos">2506</span></a>                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="L-2507"><a href="#-2507"><span class="linenos">2507</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="L-2508"><a href="#-2508"><span class="linenos">2508</span></a>                        <span class="s2">&quot; ...grow_lateral: k, _geobody.shape = &quot;</span><span class="p">,</span>
</span><span id="L-2509"><a href="#-2509"><span class="linenos">2509</span></a>                        <span class="n">k</span><span class="p">,</span>
</span><span id="L-2510"><a href="#-2510"><span class="linenos">2510</span></a>                        <span class="n">_geobody</span><span class="p">[</span><span class="n">_geobody</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
</span><span id="L-2511"><a href="#-2511"><span class="linenos">2511</span></a>                    <span class="p">)</span>
</span><span id="L-2512"><a href="#-2512"><span class="linenos">2512</span></a>            <span class="k">except</span><span class="p">:</span>
</span><span id="L-2513"><a href="#-2513"><span class="linenos">2513</span></a>                <span class="k">break</span>
</span><span id="L-2514"><a href="#-2514"><span class="linenos">2514</span></a>        <span class="k">return</span> <span class="n">_geobody</span>
</span><span id="L-2515"><a href="#-2515"><span class="linenos">2515</span></a>
</span><span id="L-2516"><a href="#-2516"><span class="linenos">2516</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-2517"><a href="#-2517"><span class="linenos">2517</span></a>    <span class="k">def</span> <span class="nf">grow_upward</span><span class="p">(</span><span class="n">geobody</span><span class="p">,</span> <span class="n">iterations</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="L-2518"><a href="#-2518"><span class="linenos">2518</span></a>        <span class="kn">from</span> <span class="nn">scipy.ndimage.morphology</span> <span class="kn">import</span> <span class="n">grey_dilation</span>
</span><span id="L-2519"><a href="#-2519"><span class="linenos">2519</span></a>
</span><span id="L-2520"><a href="#-2520"><span class="linenos">2520</span></a>        <span class="n">dist_size</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">dist</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="L-2521"><a href="#-2521"><span class="linenos">2521</span></a>        <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dist_size</span><span class="p">))</span>
</span><span id="L-2522"><a href="#-2522"><span class="linenos">2522</span></a>        <span class="n">mask</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:</span> <span class="n">dist</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-2523"><a href="#-2523"><span class="linenos">2523</span></a>        <span class="n">_geobody</span> <span class="o">=</span> <span class="n">geobody</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-2524"><a href="#-2524"><span class="linenos">2524</span></a>        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="L-2525"><a href="#-2525"><span class="linenos">2525</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; ...grow_upward: _geobody.shape = &quot;</span><span class="p">,</span> <span class="n">_geobody</span><span class="p">[</span><span class="n">_geobody</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span><span id="L-2526"><a href="#-2526"><span class="linenos">2526</span></a>        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">iterations</span><span class="p">):</span>
</span><span id="L-2527"><a href="#-2527"><span class="linenos">2527</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="L-2528"><a href="#-2528"><span class="linenos">2528</span></a>                <span class="n">_geobody</span> <span class="o">=</span> <span class="n">grey_dilation</span><span class="p">(</span><span class="n">_geobody</span><span class="p">,</span> <span class="n">footprint</span><span class="o">=</span><span class="n">mask</span><span class="p">)</span>
</span><span id="L-2529"><a href="#-2529"><span class="linenos">2529</span></a>                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="L-2530"><a href="#-2530"><span class="linenos">2530</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="L-2531"><a href="#-2531"><span class="linenos">2531</span></a>                        <span class="s2">&quot; ...grow_upward: k, _geobody.shape = &quot;</span><span class="p">,</span>
</span><span id="L-2532"><a href="#-2532"><span class="linenos">2532</span></a>                        <span class="n">k</span><span class="p">,</span>
</span><span id="L-2533"><a href="#-2533"><span class="linenos">2533</span></a>                        <span class="n">_geobody</span><span class="p">[</span><span class="n">_geobody</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
</span><span id="L-2534"><a href="#-2534"><span class="linenos">2534</span></a>                    <span class="p">)</span>
</span><span id="L-2535"><a href="#-2535"><span class="linenos">2535</span></a>            <span class="k">except</span><span class="p">:</span>
</span><span id="L-2536"><a href="#-2536"><span class="linenos">2536</span></a>                <span class="k">break</span>
</span><span id="L-2537"><a href="#-2537"><span class="linenos">2537</span></a>        <span class="k">return</span> <span class="n">_geobody</span>
</span><span id="L-2538"><a href="#-2538"><span class="linenos">2538</span></a>
</span><span id="L-2539"><a href="#-2539"><span class="linenos">2539</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-2540"><a href="#-2540"><span class="linenos">2540</span></a>    <span class="k">def</span> <span class="nf">grow_downward</span><span class="p">(</span><span class="n">geobody</span><span class="p">,</span> <span class="n">iterations</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="L-2541"><a href="#-2541"><span class="linenos">2541</span></a>        <span class="kn">from</span> <span class="nn">scipy.ndimage.morphology</span> <span class="kn">import</span> <span class="n">grey_dilation</span>
</span><span id="L-2542"><a href="#-2542"><span class="linenos">2542</span></a>
</span><span id="L-2543"><a href="#-2543"><span class="linenos">2543</span></a>        <span class="n">dist_size</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">dist</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="L-2544"><a href="#-2544"><span class="linenos">2544</span></a>        <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dist_size</span><span class="p">))</span>
</span><span id="L-2545"><a href="#-2545"><span class="linenos">2545</span></a>        <span class="n">mask</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">dist</span><span class="p">:]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-2546"><a href="#-2546"><span class="linenos">2546</span></a>        <span class="n">_geobody</span> <span class="o">=</span> <span class="n">geobody</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-2547"><a href="#-2547"><span class="linenos">2547</span></a>        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="L-2548"><a href="#-2548"><span class="linenos">2548</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; ...grow_downward: _geobody.shape = &quot;</span><span class="p">,</span> <span class="n">_geobody</span><span class="p">[</span><span class="n">_geobody</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span><span id="L-2549"><a href="#-2549"><span class="linenos">2549</span></a>        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">iterations</span><span class="p">):</span>
</span><span id="L-2550"><a href="#-2550"><span class="linenos">2550</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="L-2551"><a href="#-2551"><span class="linenos">2551</span></a>                <span class="n">_geobody</span> <span class="o">=</span> <span class="n">grey_dilation</span><span class="p">(</span><span class="n">_geobody</span><span class="p">,</span> <span class="n">footprint</span><span class="o">=</span><span class="n">mask</span><span class="p">)</span>
</span><span id="L-2552"><a href="#-2552"><span class="linenos">2552</span></a>                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="L-2553"><a href="#-2553"><span class="linenos">2553</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="L-2554"><a href="#-2554"><span class="linenos">2554</span></a>                        <span class="s2">&quot; ...grow_downward: k, _geobody.shape = &quot;</span><span class="p">,</span>
</span><span id="L-2555"><a href="#-2555"><span class="linenos">2555</span></a>                        <span class="n">k</span><span class="p">,</span>
</span><span id="L-2556"><a href="#-2556"><span class="linenos">2556</span></a>                        <span class="n">_geobody</span><span class="p">[</span><span class="n">_geobody</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
</span><span id="L-2557"><a href="#-2557"><span class="linenos">2557</span></a>                    <span class="p">)</span>
</span><span id="L-2558"><a href="#-2558"><span class="linenos">2558</span></a>            <span class="k">except</span><span class="p">:</span>
</span><span id="L-2559"><a href="#-2559"><span class="linenos">2559</span></a>                <span class="k">break</span>
</span><span id="L-2560"><a href="#-2560"><span class="linenos">2560</span></a>        <span class="k">return</span> <span class="n">_geobody</span>
</span><span id="L-2561"><a href="#-2561"><span class="linenos">2561</span></a>
</span><span id="L-2562"><a href="#-2562"><span class="linenos">2562</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-2563"><a href="#-2563"><span class="linenos">2563</span></a>    <span class="k">def</span> <span class="nf">_threshold_volumes</span><span class="p">(</span><span class="n">volume</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
</span><span id="L-2564"><a href="#-2564"><span class="linenos">2564</span></a>        <span class="n">volume</span><span class="p">[</span><span class="n">volume</span> <span class="o">&gt;=</span> <span class="n">threshold</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="L-2565"><a href="#-2565"><span class="linenos">2565</span></a>        <span class="n">volume</span><span class="p">[</span><span class="n">volume</span> <span class="o">&lt;</span> <span class="n">threshold</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="L-2566"><a href="#-2566"><span class="linenos">2566</span></a>        <span class="k">return</span> <span class="n">volume</span>
</span><span id="L-2567"><a href="#-2567"><span class="linenos">2567</span></a>
</span><span id="L-2568"><a href="#-2568"><span class="linenos">2568</span></a>    <span class="k">def</span> <span class="nf">parse_closure_codes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hc_closure_codes</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">num</span><span class="p">,</span> <span class="n">code</span><span class="o">=</span><span class="mf">0.1</span><span class="p">):</span>
</span><span id="L-2569"><a href="#-2569"><span class="linenos">2569</span></a>        <span class="n">labels</span> <span class="o">=</span> <span class="n">labels</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;float32&quot;</span><span class="p">)</span>
</span><span id="L-2570"><a href="#-2570"><span class="linenos">2570</span></a>        <span class="k">if</span> <span class="n">num</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-2571"><a href="#-2571"><span class="linenos">2571</span></a>            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">num</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="L-2572"><a href="#-2572"><span class="linenos">2572</span></a>                <span class="n">y</span> <span class="o">=</span> <span class="n">code</span> <span class="o">+</span> <span class="n">labels</span><span class="p">[</span><span class="n">labels</span> <span class="o">==</span> <span class="n">x</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="L-2573"><a href="#-2573"><span class="linenos">2573</span></a>                <span class="n">labels</span><span class="p">[</span><span class="n">labels</span> <span class="o">==</span> <span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span>
</span><span id="L-2574"><a href="#-2574"><span class="linenos">2574</span></a>            <span class="n">hc_closure_codes</span> <span class="o">+=</span> <span class="n">labels</span>
</span><span id="L-2575"><a href="#-2575"><span class="linenos">2575</span></a>        <span class="k">return</span> <span class="n">hc_closure_codes</span>
</span><span id="L-2576"><a href="#-2576"><span class="linenos">2576</span></a>
</span><span id="L-2577"><a href="#-2577"><span class="linenos">2577</span></a>
</span><span id="L-2578"><a href="#-2578"><span class="linenos">2578</span></a><span class="k">class</span> <span class="nc">Intersect3D</span><span class="p">(</span><span class="n">Closures</span><span class="p">):</span>
</span><span id="L-2579"><a href="#-2579"><span class="linenos">2579</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="L-2580"><a href="#-2580"><span class="linenos">2580</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-2581"><a href="#-2581"><span class="linenos">2581</span></a>        <span class="n">faults</span><span class="p">,</span>
</span><span id="L-2582"><a href="#-2582"><span class="linenos">2582</span></a>        <span class="n">onlaps</span><span class="p">,</span>
</span><span id="L-2583"><a href="#-2583"><span class="linenos">2583</span></a>        <span class="n">oil_closures</span><span class="p">,</span>
</span><span id="L-2584"><a href="#-2584"><span class="linenos">2584</span></a>        <span class="n">gas_closures</span><span class="p">,</span>
</span><span id="L-2585"><a href="#-2585"><span class="linenos">2585</span></a>        <span class="n">brine_closures</span><span class="p">,</span>
</span><span id="L-2586"><a href="#-2586"><span class="linenos">2586</span></a>        <span class="n">closure_segment_list</span><span class="p">,</span>
</span><span id="L-2587"><a href="#-2587"><span class="linenos">2587</span></a>        <span class="n">closure_segments</span><span class="p">,</span>
</span><span id="L-2588"><a href="#-2588"><span class="linenos">2588</span></a>        <span class="n">parameters</span><span class="p">,</span>
</span><span id="L-2589"><a href="#-2589"><span class="linenos">2589</span></a>    <span class="p">):</span>
</span><span id="L-2590"><a href="#-2590"><span class="linenos">2590</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">closure_segment_list</span> <span class="o">=</span> <span class="n">closure_segment_list</span>
</span><span id="L-2591"><a href="#-2591"><span class="linenos">2591</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">closure_segments</span> <span class="o">=</span> <span class="n">closure_segments</span>
</span><span id="L-2592"><a href="#-2592"><span class="linenos">2592</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span> <span class="o">=</span> <span class="n">parameters</span>
</span><span id="L-2593"><a href="#-2593"><span class="linenos">2593</span></a>
</span><span id="L-2594"><a href="#-2594"><span class="linenos">2594</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fault_throw</span> <span class="o">=</span> <span class="n">faults</span><span class="o">.</span><span class="n">max_fault_throw</span>
</span><span id="L-2595"><a href="#-2595"><span class="linenos">2595</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">geologic_age</span> <span class="o">=</span> <span class="n">faults</span><span class="o">.</span><span class="n">faulted_age_volume</span>
</span><span id="L-2596"><a href="#-2596"><span class="linenos">2596</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">geomodel_ng</span> <span class="o">=</span> <span class="n">faults</span><span class="o">.</span><span class="n">faulted_net_to_gross</span>
</span><span id="L-2597"><a href="#-2597"><span class="linenos">2597</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">faults</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_threshold_volumes</span><span class="p">(</span><span class="n">faults</span><span class="o">.</span><span class="n">fault_planes</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
</span><span id="L-2598"><a href="#-2598"><span class="linenos">2598</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">onlaps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_threshold_volumes</span><span class="p">(</span><span class="n">onlaps</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
</span><span id="L-2599"><a href="#-2599"><span class="linenos">2599</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">oil_closures</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_threshold_volumes</span><span class="p">(</span><span class="n">oil_closures</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
</span><span id="L-2600"><a href="#-2600"><span class="linenos">2600</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gas_closures</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_threshold_volumes</span><span class="p">(</span><span class="n">gas_closures</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
</span><span id="L-2601"><a href="#-2601"><span class="linenos">2601</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">brine_closures</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_threshold_volumes</span><span class="p">(</span><span class="n">brine_closures</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
</span><span id="L-2602"><a href="#-2602"><span class="linenos">2602</span></a>
</span><span id="L-2603"><a href="#-2603"><span class="linenos">2603</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">wide_faults</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-2604"><a href="#-2604"><span class="linenos">2604</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fat_faults</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-2605"><a href="#-2605"><span class="linenos">2605</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">onlaps_upward</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-2606"><a href="#-2606"><span class="linenos">2606</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">onlaps_downward</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-2607"><a href="#-2607"><span class="linenos">2607</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dilate_faults_and_onlaps</span><span class="p">()</span>
</span><span id="L-2608"><a href="#-2608"><span class="linenos">2608</span></a>
</span><span id="L-2609"><a href="#-2609"><span class="linenos">2609</span></a>        <span class="c1"># Outputs</span>
</span><span id="L-2610"><a href="#-2610"><span class="linenos">2610</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">faulted_closures_oil</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">oil_closures</span><span class="p">)</span>
</span><span id="L-2611"><a href="#-2611"><span class="linenos">2611</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">faulted_closures_gas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gas_closures</span><span class="p">)</span>
</span><span id="L-2612"><a href="#-2612"><span class="linenos">2612</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">faulted_closures_brine</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">brine_closures</span><span class="p">)</span>
</span><span id="L-2613"><a href="#-2613"><span class="linenos">2613</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fault_closures_oil_segment_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
</span><span id="L-2614"><a href="#-2614"><span class="linenos">2614</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fault_closures_gas_segment_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
</span><span id="L-2615"><a href="#-2615"><span class="linenos">2615</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fault_closures_brine_segment_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
</span><span id="L-2616"><a href="#-2616"><span class="linenos">2616</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_fault_closures_oil</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-2617"><a href="#-2617"><span class="linenos">2617</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_fault_closures_gas</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-2618"><a href="#-2618"><span class="linenos">2618</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_fault_closures_brine</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-2619"><a href="#-2619"><span class="linenos">2619</span></a>
</span><span id="L-2620"><a href="#-2620"><span class="linenos">2620</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">onlap_closures_oil</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">oil_closures</span><span class="p">)</span>
</span><span id="L-2621"><a href="#-2621"><span class="linenos">2621</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">onlap_closures_gas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gas_closures</span><span class="p">)</span>
</span><span id="L-2622"><a href="#-2622"><span class="linenos">2622</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">onlap_closures_brine</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">brine_closures</span><span class="p">)</span>
</span><span id="L-2623"><a href="#-2623"><span class="linenos">2623</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">onlap_closures_oil_segment_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
</span><span id="L-2624"><a href="#-2624"><span class="linenos">2624</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">onlap_closures_gas_segment_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
</span><span id="L-2625"><a href="#-2625"><span class="linenos">2625</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">onlap_closures_brine_segment_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
</span><span id="L-2626"><a href="#-2626"><span class="linenos">2626</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_onlap_closures_oil</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-2627"><a href="#-2627"><span class="linenos">2627</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_onlap_closures_gas</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-2628"><a href="#-2628"><span class="linenos">2628</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_onlap_closures_brine</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-2629"><a href="#-2629"><span class="linenos">2629</span></a>
</span><span id="L-2630"><a href="#-2630"><span class="linenos">2630</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">simple_closures_oil</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">oil_closures</span><span class="p">)</span>
</span><span id="L-2631"><a href="#-2631"><span class="linenos">2631</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">simple_closures_gas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gas_closures</span><span class="p">)</span>
</span><span id="L-2632"><a href="#-2632"><span class="linenos">2632</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">simple_closures_brine</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">brine_closures</span><span class="p">)</span>
</span><span id="L-2633"><a href="#-2633"><span class="linenos">2633</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_4way_closures_oil</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-2634"><a href="#-2634"><span class="linenos">2634</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_4way_closures_gas</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-2635"><a href="#-2635"><span class="linenos">2635</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_4way_closures_brine</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-2636"><a href="#-2636"><span class="linenos">2636</span></a>
</span><span id="L-2637"><a href="#-2637"><span class="linenos">2637</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">false_closures_oil</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">oil_closures</span><span class="p">)</span>
</span><span id="L-2638"><a href="#-2638"><span class="linenos">2638</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">false_closures_gas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gas_closures</span><span class="p">)</span>
</span><span id="L-2639"><a href="#-2639"><span class="linenos">2639</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">false_closures_brine</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">brine_closures</span><span class="p">)</span>
</span><span id="L-2640"><a href="#-2640"><span class="linenos">2640</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_false_closures_oil</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-2641"><a href="#-2641"><span class="linenos">2641</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_false_closures_gas</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-2642"><a href="#-2642"><span class="linenos">2642</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_false_closures_brine</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-2643"><a href="#-2643"><span class="linenos">2643</span></a>
</span><span id="L-2644"><a href="#-2644"><span class="linenos">2644</span></a>    <span class="k">def</span> <span class="nf">find_faulted_closures</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-2645"><a href="#-2645"><span class="linenos">2645</span></a>        <span class="k">for</span> <span class="n">iclosure</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">closure_segment_list</span><span class="p">:</span>
</span><span id="L-2646"><a href="#-2646"><span class="linenos">2646</span></a>            <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">closure_segments</span> <span class="o">==</span> <span class="n">iclosure</span><span class="p">)</span>
</span><span id="L-2647"><a href="#-2647"><span class="linenos">2647</span></a>            <span class="n">faults_within_closure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wide_faults</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span>
</span><span id="L-2648"><a href="#-2648"><span class="linenos">2648</span></a>            <span class="k">if</span> <span class="n">faults_within_closure</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-2649"><a href="#-2649"><span class="linenos">2649</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">oil_closures</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-2650"><a href="#-2650"><span class="linenos">2650</span></a>                    <span class="c1"># Faulted oil closure</span>
</span><span id="L-2651"><a href="#-2651"><span class="linenos">2651</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">faulted_closures_oil</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="L-2652"><a href="#-2652"><span class="linenos">2652</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">n_fault_closures_oil</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-2653"><a href="#-2653"><span class="linenos">2653</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">fault_closures_oil_segment_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">iclosure</span><span class="p">)</span>
</span><span id="L-2654"><a href="#-2654"><span class="linenos">2654</span></a>                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">gas_closures</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-2655"><a href="#-2655"><span class="linenos">2655</span></a>                    <span class="c1"># Faulted gas closure</span>
</span><span id="L-2656"><a href="#-2656"><span class="linenos">2656</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">faulted_closures_gas</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="L-2657"><a href="#-2657"><span class="linenos">2657</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">n_fault_closures_gas</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-2658"><a href="#-2658"><span class="linenos">2658</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">fault_closures_gas_segment_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">iclosure</span><span class="p">)</span>
</span><span id="L-2659"><a href="#-2659"><span class="linenos">2659</span></a>                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">brine_closures</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-2660"><a href="#-2660"><span class="linenos">2660</span></a>                    <span class="c1"># Faulted brine closure</span>
</span><span id="L-2661"><a href="#-2661"><span class="linenos">2661</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">faulted_closures_brine</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="L-2662"><a href="#-2662"><span class="linenos">2662</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">n_fault_closures_brine</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-2663"><a href="#-2663"><span class="linenos">2663</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">fault_closures_brine_segment_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">iclosure</span><span class="p">)</span>
</span><span id="L-2664"><a href="#-2664"><span class="linenos">2664</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-2665"><a href="#-2665"><span class="linenos">2665</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="L-2666"><a href="#-2666"><span class="linenos">2666</span></a>                        <span class="s2">&quot;Closure is faulted but does not have oil, gas or brine assigned&quot;</span>
</span><span id="L-2667"><a href="#-2667"><span class="linenos">2667</span></a>                    <span class="p">)</span>
</span><span id="L-2668"><a href="#-2668"><span class="linenos">2668</span></a>
</span><span id="L-2669"><a href="#-2669"><span class="linenos">2669</span></a>    <span class="k">def</span> <span class="nf">find_onlap_closures</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-2670"><a href="#-2670"><span class="linenos">2670</span></a>        <span class="k">for</span> <span class="n">iclosure</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">closure_segment_list</span><span class="p">:</span>
</span><span id="L-2671"><a href="#-2671"><span class="linenos">2671</span></a>            <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">closure_segments</span> <span class="o">==</span> <span class="n">iclosure</span><span class="p">)</span>
</span><span id="L-2672"><a href="#-2672"><span class="linenos">2672</span></a>            <span class="n">onlaps_within_closure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">onlaps_upward</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span>
</span><span id="L-2673"><a href="#-2673"><span class="linenos">2673</span></a>            <span class="k">if</span> <span class="n">onlaps_within_closure</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-2674"><a href="#-2674"><span class="linenos">2674</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">oil_closures</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-2675"><a href="#-2675"><span class="linenos">2675</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">onlap_closures_oil</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="L-2676"><a href="#-2676"><span class="linenos">2676</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">n_onlap_closures_oil</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-2677"><a href="#-2677"><span class="linenos">2677</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">onlap_closures_oil_segment_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">iclosure</span><span class="p">)</span>
</span><span id="L-2678"><a href="#-2678"><span class="linenos">2678</span></a>                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">gas_closures</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-2679"><a href="#-2679"><span class="linenos">2679</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">onlap_closures_gas</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="L-2680"><a href="#-2680"><span class="linenos">2680</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">n_onlap_closures_gas</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-2681"><a href="#-2681"><span class="linenos">2681</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">onlap_closures_gas_segment_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">iclosure</span><span class="p">)</span>
</span><span id="L-2682"><a href="#-2682"><span class="linenos">2682</span></a>                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">brine_closures</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-2683"><a href="#-2683"><span class="linenos">2683</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">onlap_closures_brine</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="L-2684"><a href="#-2684"><span class="linenos">2684</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">n_onlap_closures_brine</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-2685"><a href="#-2685"><span class="linenos">2685</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">onlap_closures_brine_segment_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">iclosure</span><span class="p">)</span>
</span><span id="L-2686"><a href="#-2686"><span class="linenos">2686</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-2687"><a href="#-2687"><span class="linenos">2687</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="L-2688"><a href="#-2688"><span class="linenos">2688</span></a>                        <span class="s2">&quot;Closure is onlap but does not have oil, gas or brine assigned&quot;</span>
</span><span id="L-2689"><a href="#-2689"><span class="linenos">2689</span></a>                    <span class="p">)</span>
</span><span id="L-2690"><a href="#-2690"><span class="linenos">2690</span></a>
</span><span id="L-2691"><a href="#-2691"><span class="linenos">2691</span></a>    <span class="k">def</span> <span class="nf">find_simple_closures</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-2692"><a href="#-2692"><span class="linenos">2692</span></a>        <span class="k">for</span> <span class="n">iclosure</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">closure_segment_list</span><span class="p">:</span>
</span><span id="L-2693"><a href="#-2693"><span class="linenos">2693</span></a>            <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">closure_segments</span> <span class="o">==</span> <span class="n">iclosure</span><span class="p">)</span>
</span><span id="L-2694"><a href="#-2694"><span class="linenos">2694</span></a>            <span class="n">faults_within_closure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wide_faults</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span>
</span><span id="L-2695"><a href="#-2695"><span class="linenos">2695</span></a>            <span class="n">onlaps_within_closure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">onlaps</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span>
</span><span id="L-2696"><a href="#-2696"><span class="linenos">2696</span></a>            <span class="n">oil_within_closure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">oil_closures</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span>
</span><span id="L-2697"><a href="#-2697"><span class="linenos">2697</span></a>            <span class="n">gas_within_closure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gas_closures</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span>
</span><span id="L-2698"><a href="#-2698"><span class="linenos">2698</span></a>            <span class="n">brine_within_closure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">brine_closures</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span>
</span><span id="L-2699"><a href="#-2699"><span class="linenos">2699</span></a>            <span class="k">if</span> <span class="n">faults_within_closure</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">onlaps_within_closure</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-2700"><a href="#-2700"><span class="linenos">2700</span></a>                <span class="k">if</span> <span class="n">oil_within_closure</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-2701"><a href="#-2701"><span class="linenos">2701</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">simple_closures_oil</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="L-2702"><a href="#-2702"><span class="linenos">2702</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">n_4way_closures_oil</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-2703"><a href="#-2703"><span class="linenos">2703</span></a>                <span class="k">elif</span> <span class="n">gas_within_closure</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-2704"><a href="#-2704"><span class="linenos">2704</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">simple_closures_gas</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="L-2705"><a href="#-2705"><span class="linenos">2705</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">n_4way_closures_gas</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-2706"><a href="#-2706"><span class="linenos">2706</span></a>                <span class="k">elif</span> <span class="n">brine_within_closure</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-2707"><a href="#-2707"><span class="linenos">2707</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">simple_closures_brine</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="L-2708"><a href="#-2708"><span class="linenos">2708</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">n_4way_closures_brine</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-2709"><a href="#-2709"><span class="linenos">2709</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-2710"><a href="#-2710"><span class="linenos">2710</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="L-2711"><a href="#-2711"><span class="linenos">2711</span></a>                        <span class="s2">&quot;Closure is not faulted or onlap but does not have oil, gas or brine assigned&quot;</span>
</span><span id="L-2712"><a href="#-2712"><span class="linenos">2712</span></a>                    <span class="p">)</span>
</span><span id="L-2713"><a href="#-2713"><span class="linenos">2713</span></a>
</span><span id="L-2714"><a href="#-2714"><span class="linenos">2714</span></a>    <span class="k">def</span> <span class="nf">find_false_closures</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-2715"><a href="#-2715"><span class="linenos">2715</span></a>        <span class="k">for</span> <span class="n">iclosure</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">closure_segment_list</span><span class="p">:</span>
</span><span id="L-2716"><a href="#-2716"><span class="linenos">2716</span></a>            <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">closure_segments</span> <span class="o">==</span> <span class="n">iclosure</span><span class="p">)</span>
</span><span id="L-2717"><a href="#-2717"><span class="linenos">2717</span></a>            <span class="n">faults_within_closure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fat_faults</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span>
</span><span id="L-2718"><a href="#-2718"><span class="linenos">2718</span></a>            <span class="n">onlaps_within_closure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">onlaps_downward</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span>
</span><span id="L-2719"><a href="#-2719"><span class="linenos">2719</span></a>            <span class="k">for</span> <span class="n">fluid</span><span class="p">,</span> <span class="n">false</span><span class="p">,</span> <span class="n">num</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
</span><span id="L-2720"><a href="#-2720"><span class="linenos">2720</span></a>                <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">oil_closures</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gas_closures</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">brine_closures</span><span class="p">],</span>
</span><span id="L-2721"><a href="#-2721"><span class="linenos">2721</span></a>                <span class="p">[</span>
</span><span id="L-2722"><a href="#-2722"><span class="linenos">2722</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">false_closures_oil</span><span class="p">,</span>
</span><span id="L-2723"><a href="#-2723"><span class="linenos">2723</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">false_closures_gas</span><span class="p">,</span>
</span><span id="L-2724"><a href="#-2724"><span class="linenos">2724</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">false_closures_brine</span><span class="p">,</span>
</span><span id="L-2725"><a href="#-2725"><span class="linenos">2725</span></a>                <span class="p">],</span>
</span><span id="L-2726"><a href="#-2726"><span class="linenos">2726</span></a>                <span class="p">[</span>
</span><span id="L-2727"><a href="#-2727"><span class="linenos">2727</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">n_false_closures_oil</span><span class="p">,</span>
</span><span id="L-2728"><a href="#-2728"><span class="linenos">2728</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">n_false_closures_gas</span><span class="p">,</span>
</span><span id="L-2729"><a href="#-2729"><span class="linenos">2729</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">n_false_closures_brine</span><span class="p">,</span>
</span><span id="L-2730"><a href="#-2730"><span class="linenos">2730</span></a>                <span class="p">],</span>
</span><span id="L-2731"><a href="#-2731"><span class="linenos">2731</span></a>            <span class="p">):</span>
</span><span id="L-2732"><a href="#-2732"><span class="linenos">2732</span></a>                <span class="n">fluid_within_closure</span> <span class="o">=</span> <span class="n">fluid</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span>
</span><span id="L-2733"><a href="#-2733"><span class="linenos">2733</span></a>                <span class="k">if</span> <span class="n">fluid_within_closure</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-2734"><a href="#-2734"><span class="linenos">2734</span></a>                    <span class="k">if</span> <span class="n">onlaps_within_closure</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-2735"><a href="#-2735"><span class="linenos">2735</span></a>                        <span class="n">_faulted_closure_threshold</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span>
</span><span id="L-2736"><a href="#-2736"><span class="linenos">2736</span></a>                            <span class="n">faults_within_closure</span><span class="p">[</span><span class="n">faults_within_closure</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="L-2737"><a href="#-2737"><span class="linenos">2737</span></a>                            <span class="o">/</span> <span class="n">fluid_within_closure</span><span class="p">[</span><span class="n">fluid_within_closure</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="L-2738"><a href="#-2738"><span class="linenos">2738</span></a>                        <span class="p">)</span>
</span><span id="L-2739"><a href="#-2739"><span class="linenos">2739</span></a>                        <span class="n">_onlap_closure_threshold</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span>
</span><span id="L-2740"><a href="#-2740"><span class="linenos">2740</span></a>                            <span class="n">onlaps_within_closure</span><span class="p">[</span><span class="n">onlaps_within_closure</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="L-2741"><a href="#-2741"><span class="linenos">2741</span></a>                            <span class="o">/</span> <span class="n">fluid_within_closure</span><span class="p">[</span><span class="n">fluid_within_closure</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="L-2742"><a href="#-2742"><span class="linenos">2742</span></a>                        <span class="p">)</span>
</span><span id="L-2743"><a href="#-2743"><span class="linenos">2743</span></a>                        <span class="k">if</span> <span class="p">(</span>
</span><span id="L-2744"><a href="#-2744"><span class="linenos">2744</span></a>                            <span class="n">_faulted_closure_threshold</span> <span class="o">&gt;</span> <span class="mf">0.65</span>
</span><span id="L-2745"><a href="#-2745"><span class="linenos">2745</span></a>                            <span class="ow">and</span> <span class="n">_onlap_closure_threshold</span> <span class="o">&gt;</span> <span class="mf">0.65</span>
</span><span id="L-2746"><a href="#-2746"><span class="linenos">2746</span></a>                        <span class="p">):</span>
</span><span id="L-2747"><a href="#-2747"><span class="linenos">2747</span></a>                            <span class="n">false</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-2748"><a href="#-2748"><span class="linenos">2748</span></a>                            <span class="n">num</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-2749"><a href="#-2749"><span class="linenos">2749</span></a>
</span><span id="L-2750"><a href="#-2750"><span class="linenos">2750</span></a>    <span class="k">def</span> <span class="nf">grow_to_fault2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">closures</span><span class="p">):</span>
</span><span id="L-2751"><a href="#-2751"><span class="linenos">2751</span></a>        <span class="c1"># - grow closures laterally and up within layer and within fault block</span>
</span><span id="L-2752"><a href="#-2752"><span class="linenos">2752</span></a>        <span class="nb">print</span><span class="p">(</span>
</span><span id="L-2753"><a href="#-2753"><span class="linenos">2753</span></a>            <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2"> ... grow_to_fault2: grow closures laterally and up within layer and within fault block ...&quot;</span>
</span><span id="L-2754"><a href="#-2754"><span class="linenos">2754</span></a>        <span class="p">)</span>
</span><span id="L-2755"><a href="#-2755"><span class="linenos">2755</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span><span class="s2">&quot;growing closures to fault plane: grow_to_fault2&quot;</span><span class="p">)</span>
</span><span id="L-2756"><a href="#-2756"><span class="linenos">2756</span></a>
</span><span id="L-2757"><a href="#-2757"><span class="linenos">2757</span></a>        <span class="n">dilated_fault_closures</span> <span class="o">=</span> <span class="n">closures</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-2758"><a href="#-2758"><span class="linenos">2758</span></a>        <span class="n">n_faulted_closures</span> <span class="o">=</span> <span class="n">dilated_fault_closures</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</span><span id="L-2759"><a href="#-2759"><span class="linenos">2759</span></a>        <span class="n">labels_clean</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">closure_segments</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-2760"><a href="#-2760"><span class="linenos">2760</span></a>        <span class="n">labels_clean</span><span class="p">[</span><span class="n">closures</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-2761"><a href="#-2761"><span class="linenos">2761</span></a>        <span class="n">labels_clean_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">labels_clean</span><span class="o">.</span><span class="n">flatten</span><span class="p">()))</span>
</span><span id="L-2762"><a href="#-2762"><span class="linenos">2762</span></a>        <span class="n">labels_clean_list</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-2763"><a href="#-2763"><span class="linenos">2763</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">    ... grow_to_fault2: n_faulted_closures = &quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">labels_clean_list</span><span class="p">))</span>
</span><span id="L-2764"><a href="#-2764"><span class="linenos">2764</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    ... grow_to_fault2: faulted_closures = &quot;</span><span class="p">,</span> <span class="n">labels_clean_list</span><span class="p">)</span>
</span><span id="L-2765"><a href="#-2765"><span class="linenos">2765</span></a>
</span><span id="L-2766"><a href="#-2766"><span class="linenos">2766</span></a>        <span class="c1"># fixme remove this once small closures are found and fixed</span>
</span><span id="L-2767"><a href="#-2767"><span class="linenos">2767</span></a>        <span class="n">voxel_sizes</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-2768"><a href="#-2768"><span class="linenos">2768</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">closure_segments</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">closure_segments</span> <span class="o">==</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="L-2769"><a href="#-2769"><span class="linenos">2769</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">labels_clean_list</span>
</span><span id="L-2770"><a href="#-2770"><span class="linenos">2770</span></a>        <span class="p">]</span>
</span><span id="L-2771"><a href="#-2771"><span class="linenos">2771</span></a>        <span class="k">for</span> <span class="n">_v</span> <span class="ow">in</span> <span class="n">voxel_sizes</span><span class="p">:</span>
</span><span id="L-2772"><a href="#-2772"><span class="linenos">2772</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Voxel_Sizes: </span><span class="si">{</span><span class="n">_v</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-2773"><a href="#-2773"><span class="linenos">2773</span></a>            <span class="k">if</span> <span class="n">_v</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">closure_min_voxels</span><span class="p">:</span>
</span><span id="L-2774"><a href="#-2774"><span class="linenos">2774</span></a>                <span class="nb">print</span><span class="p">(</span><span class="n">_v</span><span class="p">)</span>
</span><span id="L-2775"><a href="#-2775"><span class="linenos">2775</span></a>
</span><span id="L-2776"><a href="#-2776"><span class="linenos">2776</span></a>        <span class="n">depth_cube</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">geologic_age</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span>
</span><span id="L-2777"><a href="#-2777"><span class="linenos">2777</span></a>        <span class="n">_depths</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">geologic_age</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</span><span id="L-2778"><a href="#-2778"><span class="linenos">2778</span></a>        <span class="n">depth_cube</span> <span class="o">+=</span> <span class="n">_depths</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">geologic_age</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</span><span id="L-2779"><a href="#-2779"><span class="linenos">2779</span></a>        <span class="n">_ng</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">geomodel_ng</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-2780"><a href="#-2780"><span class="linenos">2780</span></a>        <span class="n">_age</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">geologic_age</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-2781"><a href="#-2781"><span class="linenos">2781</span></a>
</span><span id="L-2782"><a href="#-2782"><span class="linenos">2782</span></a>        <span class="k">for</span> <span class="n">il</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">labels_clean_list</span><span class="p">):</span>
</span><span id="L-2783"><a href="#-2783"><span class="linenos">2783</span></a>            <span class="n">fault_blocks_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fault_throw</span><span class="p">[</span><span class="n">labels_clean</span> <span class="o">==</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()))</span>
</span><span id="L-2784"><a href="#-2784"><span class="linenos">2784</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    ... grow_to_fault2: fault_blocks_list = &quot;</span><span class="p">,</span> <span class="n">fault_blocks_list</span><span class="p">)</span>
</span><span id="L-2785"><a href="#-2785"><span class="linenos">2785</span></a>            <span class="k">for</span> <span class="n">jl</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">fault_blocks_list</span><span class="p">):</span>
</span><span id="L-2786"><a href="#-2786"><span class="linenos">2786</span></a>                <span class="nb">print</span><span class="p">(</span>
</span><span id="L-2787"><a href="#-2787"><span class="linenos">2787</span></a>                    <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">    ... label, throw = &quot;</span><span class="p">,</span>
</span><span id="L-2788"><a href="#-2788"><span class="linenos">2788</span></a>                    <span class="n">i</span><span class="p">,</span>
</span><span id="L-2789"><a href="#-2789"><span class="linenos">2789</span></a>                    <span class="n">j</span><span class="p">,</span>
</span><span id="L-2790"><a href="#-2790"><span class="linenos">2790</span></a>                    <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fault_throw</span><span class="p">[</span><span class="n">labels_clean</span> <span class="o">==</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">())),</span>
</span><span id="L-2791"><a href="#-2791"><span class="linenos">2791</span></a>                    <span class="n">labels_clean</span><span class="p">[</span><span class="n">labels_clean</span> <span class="o">==</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">,</span>
</span><span id="L-2792"><a href="#-2792"><span class="linenos">2792</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">fault_throw</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fault_throw</span> <span class="o">==</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">,</span>
</span><span id="L-2793"><a href="#-2793"><span class="linenos">2793</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">fault_throw</span><span class="p">[</span>
</span><span id="L-2794"><a href="#-2794"><span class="linenos">2794</span></a>                        <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">labels_clean</span> <span class="o">==</span> <span class="n">i</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fault_throw</span> <span class="o">==</span> <span class="n">j</span><span class="p">))</span>
</span><span id="L-2795"><a href="#-2795"><span class="linenos">2795</span></a>                    <span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">,</span>
</span><span id="L-2796"><a href="#-2796"><span class="linenos">2796</span></a>                <span class="p">)</span>
</span><span id="L-2797"><a href="#-2797"><span class="linenos">2797</span></a>                <span class="n">single_closure</span> <span class="o">=</span> <span class="n">labels_clean</span> <span class="o">*</span> <span class="mf">0.0</span>
</span><span id="L-2798"><a href="#-2798"><span class="linenos">2798</span></a>                <span class="n">size</span> <span class="o">=</span> <span class="n">single_closure</span><span class="p">[</span>
</span><span id="L-2799"><a href="#-2799"><span class="linenos">2799</span></a>                    <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
</span><span id="L-2800"><a href="#-2800"><span class="linenos">2800</span></a>                        <span class="p">(</span><span class="n">labels_clean</span> <span class="o">==</span> <span class="n">i</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fault_throw</span> <span class="o">-</span> <span class="n">j</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.25</span><span class="p">)</span>
</span><span id="L-2801"><a href="#-2801"><span class="linenos">2801</span></a>                    <span class="p">)</span>
</span><span id="L-2802"><a href="#-2802"><span class="linenos">2802</span></a>                <span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="L-2803"><a href="#-2803"><span class="linenos">2803</span></a>                <span class="k">if</span> <span class="n">size</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">closure_min_voxels</span><span class="p">:</span>
</span><span id="L-2804"><a href="#-2804"><span class="linenos">2804</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Label: </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">, fault_block: </span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s2">, Voxel_Count: </span><span class="si">{</span><span class="n">size</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-2805"><a href="#-2805"><span class="linenos">2805</span></a>                    <span class="n">single_closure</span><span class="p">[</span>
</span><span id="L-2806"><a href="#-2806"><span class="linenos">2806</span></a>                        <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
</span><span id="L-2807"><a href="#-2807"><span class="linenos">2807</span></a>                            <span class="p">(</span><span class="n">labels_clean</span> <span class="o">==</span> <span class="n">i</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fault_throw</span> <span class="o">-</span> <span class="n">j</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.25</span><span class="p">)</span>
</span><span id="L-2808"><a href="#-2808"><span class="linenos">2808</span></a>                        <span class="p">)</span>
</span><span id="L-2809"><a href="#-2809"><span class="linenos">2809</span></a>                    <span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-2810"><a href="#-2810"><span class="linenos">2810</span></a>                <span class="k">if</span> <span class="n">single_closure</span><span class="p">[</span><span class="n">single_closure</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-2811"><a href="#-2811"><span class="linenos">2811</span></a>                    <span class="c1"># labels_clean[np.where((labels_clean == i) &amp; (np.abs(self.fault_throw - j) &lt; .25))] = 0</span>
</span><span id="L-2812"><a href="#-2812"><span class="linenos">2812</span></a>                    <span class="n">labels_clean</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">labels_clean</span> <span class="o">==</span> <span class="n">i</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-2813"><a href="#-2813"><span class="linenos">2813</span></a>                    <span class="k">continue</span>
</span><span id="L-2814"><a href="#-2814"><span class="linenos">2814</span></a>                <span class="n">avg_ng</span> <span class="o">=</span> <span class="n">_ng</span><span class="p">[</span><span class="n">single_closure</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</span><span id="L-2815"><a href="#-2815"><span class="linenos">2815</span></a>                <span class="n">_geo_age_voxels</span> <span class="o">=</span> <span class="p">(</span><span class="n">_age</span><span class="p">[</span><span class="n">single_closure</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;int&quot;</span><span class="p">)</span>
</span><span id="L-2816"><a href="#-2816"><span class="linenos">2816</span></a>                <span class="n">_ng_voxels</span> <span class="o">=</span> <span class="n">_ng</span><span class="p">[</span><span class="n">single_closure</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="L-2817"><a href="#-2817"><span class="linenos">2817</span></a>                <span class="n">_geo_age_voxels</span> <span class="o">=</span> <span class="n">_geo_age_voxels</span><span class="p">[</span><span class="n">_ng_voxels</span> <span class="o">&gt;=</span> <span class="n">avg_ng</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">]</span>
</span><span id="L-2818"><a href="#-2818"><span class="linenos">2818</span></a>                <span class="n">min_geo_age</span> <span class="o">=</span> <span class="n">_geo_age_voxels</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">-</span> <span class="mf">0.5</span>
</span><span id="L-2819"><a href="#-2819"><span class="linenos">2819</span></a>                <span class="n">avg_geo_age</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">_geo_age_voxels</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
</span><span id="L-2820"><a href="#-2820"><span class="linenos">2820</span></a>                <span class="n">max_geo_age</span> <span class="o">=</span> <span class="n">_geo_age_voxels</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="mf">0.5</span>
</span><span id="L-2821"><a href="#-2821"><span class="linenos">2821</span></a>                <span class="n">_depth_geobody_voxels</span> <span class="o">=</span> <span class="n">depth_cube</span><span class="p">[</span><span class="n">single_closure</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="L-2822"><a href="#-2822"><span class="linenos">2822</span></a>                <span class="n">min_depth</span> <span class="o">=</span> <span class="n">_depth_geobody_voxels</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
</span><span id="L-2823"><a href="#-2823"><span class="linenos">2823</span></a>                <span class="n">max_depth</span> <span class="o">=</span> <span class="n">_depth_geobody_voxels</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</span><span id="L-2824"><a href="#-2824"><span class="linenos">2824</span></a>                <span class="n">avg_throw</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fault_throw</span><span class="p">[</span><span class="n">single_closure</span> <span class="o">==</span> <span class="mi">1</span><span class="p">])</span>
</span><span id="L-2825"><a href="#-2825"><span class="linenos">2825</span></a>
</span><span id="L-2826"><a href="#-2826"><span class="linenos">2826</span></a>                <span class="n">closure_boundary_cube</span> <span class="o">=</span> <span class="n">closures</span> <span class="o">*</span> <span class="mf">0.0</span>
</span><span id="L-2827"><a href="#-2827"><span class="linenos">2827</span></a>                <span class="n">closure_boundary_cube</span><span class="p">[</span>
</span><span id="L-2828"><a href="#-2828"><span class="linenos">2828</span></a>                    <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
</span><span id="L-2829"><a href="#-2829"><span class="linenos">2829</span></a>                        <span class="p">(</span><span class="n">_ng</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">)</span>
</span><span id="L-2830"><a href="#-2830"><span class="linenos">2830</span></a>                        <span class="o">&amp;</span> <span class="p">(</span><span class="n">_age</span> <span class="o">&gt;</span> <span class="n">min_geo_age</span><span class="p">)</span>
</span><span id="L-2831"><a href="#-2831"><span class="linenos">2831</span></a>                        <span class="o">&amp;</span> <span class="p">(</span><span class="n">_age</span> <span class="o">&lt;</span> <span class="n">max_geo_age</span><span class="p">)</span>
</span><span id="L-2832"><a href="#-2832"><span class="linenos">2832</span></a>                        <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fault_throw</span> <span class="o">==</span> <span class="n">avg_throw</span><span class="p">)</span>
</span><span id="L-2833"><a href="#-2833"><span class="linenos">2833</span></a>                        <span class="o">&amp;</span> <span class="p">(</span><span class="n">depth_cube</span> <span class="o">&lt;=</span> <span class="n">max_depth</span><span class="p">)</span>
</span><span id="L-2834"><a href="#-2834"><span class="linenos">2834</span></a>                    <span class="p">)</span>
</span><span id="L-2835"><a href="#-2835"><span class="linenos">2835</span></a>                <span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="L-2836"><a href="#-2836"><span class="linenos">2836</span></a>                <span class="nb">print</span><span class="p">(</span>
</span><span id="L-2837"><a href="#-2837"><span class="linenos">2837</span></a>                    <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">    ... grow_to_fault2: closure_boundary_cube voxels = &quot;</span><span class="p">,</span>
</span><span id="L-2838"><a href="#-2838"><span class="linenos">2838</span></a>                    <span class="n">closure_boundary_cube</span><span class="p">[</span><span class="n">closure_boundary_cube</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">,</span>
</span><span id="L-2839"><a href="#-2839"><span class="linenos">2839</span></a>                <span class="p">)</span>
</span><span id="L-2840"><a href="#-2840"><span class="linenos">2840</span></a>
</span><span id="L-2841"><a href="#-2841"><span class="linenos">2841</span></a>                <span class="n">n_voxel</span> <span class="o">=</span> <span class="n">single_closure</span><span class="p">[</span><span class="n">single_closure</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="L-2842"><a href="#-2842"><span class="linenos">2842</span></a>
</span><span id="L-2843"><a href="#-2843"><span class="linenos">2843</span></a>                <span class="n">original_voxels</span> <span class="o">=</span> <span class="n">n_voxel</span> <span class="o">+</span> <span class="mi">0</span>
</span><span id="L-2844"><a href="#-2844"><span class="linenos">2844</span></a>                <span class="nb">print</span><span class="p">(</span>
</span><span id="L-2845"><a href="#-2845"><span class="linenos">2845</span></a>                    <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">    ... closure label number, avg_throw, geobody shape, geo_age min/mean/max, depth min/max, avg_ng = &quot;</span><span class="p">,</span>
</span><span id="L-2846"><a href="#-2846"><span class="linenos">2846</span></a>                    <span class="n">i</span><span class="p">,</span>
</span><span id="L-2847"><a href="#-2847"><span class="linenos">2847</span></a>                    <span class="n">j</span><span class="p">,</span>
</span><span id="L-2848"><a href="#-2848"><span class="linenos">2848</span></a>                    <span class="n">n_voxel</span><span class="p">,</span>
</span><span id="L-2849"><a href="#-2849"><span class="linenos">2849</span></a>                    <span class="p">(</span><span class="n">min_geo_age</span><span class="p">,</span> <span class="n">avg_geo_age</span><span class="p">,</span> <span class="n">max_geo_age</span><span class="p">),</span>
</span><span id="L-2850"><a href="#-2850"><span class="linenos">2850</span></a>                    <span class="p">(</span><span class="n">min_depth</span><span class="p">,</span> <span class="n">max_depth</span><span class="p">),</span>
</span><span id="L-2851"><a href="#-2851"><span class="linenos">2851</span></a>                    <span class="n">avg_ng</span><span class="p">,</span>
</span><span id="L-2852"><a href="#-2852"><span class="linenos">2852</span></a>                    <span class="n">il</span><span class="p">,</span>
</span><span id="L-2853"><a href="#-2853"><span class="linenos">2853</span></a>                    <span class="s2">&quot; / &quot;</span><span class="p">,</span>
</span><span id="L-2854"><a href="#-2854"><span class="linenos">2854</span></a>                    <span class="nb">len</span><span class="p">(</span><span class="n">labels_clean_list</span><span class="p">),</span>
</span><span id="L-2855"><a href="#-2855"><span class="linenos">2855</span></a>                <span class="p">)</span>
</span><span id="L-2856"><a href="#-2856"><span class="linenos">2856</span></a>
</span><span id="L-2857"><a href="#-2857"><span class="linenos">2857</span></a>                <span class="n">grown_closure</span> <span class="o">=</span> <span class="n">single_closure</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-2858"><a href="#-2858"><span class="linenos">2858</span></a>                <span class="n">grown_closure</span><span class="p">[</span><span class="n">depth_cube</span> <span class="o">&gt;=</span> <span class="n">max_depth</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-2859"><a href="#-2859"><span class="linenos">2859</span></a>                <span class="n">delta_voxel</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-2860"><a href="#-2860"><span class="linenos">2860</span></a>                <span class="n">previous_delta_voxel</span> <span class="o">=</span> <span class="mf">1e9</span>
</span><span id="L-2861"><a href="#-2861"><span class="linenos">2861</span></a>                <span class="n">converged</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-2862"><a href="#-2862"><span class="linenos">2862</span></a>                <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">15</span><span class="p">):</span>
</span><span id="L-2863"><a href="#-2863"><span class="linenos">2863</span></a>                    <span class="n">grown_closure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grow_lateral</span><span class="p">(</span><span class="n">grown_closure</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span><span id="L-2864"><a href="#-2864"><span class="linenos">2864</span></a>                    <span class="n">grown_closure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grow_upward</span><span class="p">(</span><span class="n">grown_closure</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-2865"><a href="#-2865"><span class="linenos">2865</span></a>                    <span class="c1"># stay within layer, within age, within fault block, above HCWC</span>
</span><span id="L-2866"><a href="#-2866"><span class="linenos">2866</span></a>                    <span class="n">grown_closure</span><span class="p">[</span><span class="n">closure_boundary_cube</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="L-2867"><a href="#-2867"><span class="linenos">2867</span></a>                    <span class="n">single_closure</span> <span class="o">=</span> <span class="n">single_closure</span> <span class="o">+</span> <span class="n">grown_closure</span>
</span><span id="L-2868"><a href="#-2868"><span class="linenos">2868</span></a>                    <span class="n">single_closure</span><span class="p">[</span><span class="n">single_closure</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
</span><span id="L-2869"><a href="#-2869"><span class="linenos">2869</span></a>                    <span class="n">new_n_voxel</span> <span class="o">=</span> <span class="n">single_closure</span><span class="p">[</span><span class="n">single_closure</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="L-2870"><a href="#-2870"><span class="linenos">2870</span></a>                    <span class="n">previous_delta_voxel</span> <span class="o">=</span> <span class="n">delta_voxel</span> <span class="o">+</span> <span class="mi">0</span>
</span><span id="L-2871"><a href="#-2871"><span class="linenos">2871</span></a>                    <span class="n">delta_voxel</span> <span class="o">=</span> <span class="n">new_n_voxel</span> <span class="o">-</span> <span class="n">n_voxel</span>
</span><span id="L-2872"><a href="#-2872"><span class="linenos">2872</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="L-2873"><a href="#-2873"><span class="linenos">2873</span></a>                        <span class="s2">&quot;    ... i, ii, closure label number, geobody shape, delta_voxel, previous_delta_voxel,&quot;</span>
</span><span id="L-2874"><a href="#-2874"><span class="linenos">2874</span></a>                        <span class="s2">&quot; delta_voxel&gt;previous_delta_voxel = &quot;</span><span class="p">,</span>
</span><span id="L-2875"><a href="#-2875"><span class="linenos">2875</span></a>                        <span class="n">i</span><span class="p">,</span>
</span><span id="L-2876"><a href="#-2876"><span class="linenos">2876</span></a>                        <span class="n">ii</span><span class="p">,</span>
</span><span id="L-2877"><a href="#-2877"><span class="linenos">2877</span></a>                        <span class="n">new_n_voxel</span><span class="p">,</span>
</span><span id="L-2878"><a href="#-2878"><span class="linenos">2878</span></a>                        <span class="n">delta_voxel</span><span class="p">,</span>
</span><span id="L-2879"><a href="#-2879"><span class="linenos">2879</span></a>                        <span class="n">previous_delta_voxel</span><span class="p">,</span>
</span><span id="L-2880"><a href="#-2880"><span class="linenos">2880</span></a>                        <span class="n">delta_voxel</span> <span class="o">&gt;</span> <span class="n">previous_delta_voxel</span><span class="p">,</span>
</span><span id="L-2881"><a href="#-2881"><span class="linenos">2881</span></a>                    <span class="p">)</span>
</span><span id="L-2882"><a href="#-2882"><span class="linenos">2882</span></a>                    <span class="k">if</span> <span class="n">n_voxel</span> <span class="o">==</span> <span class="n">new_n_voxel</span><span class="p">:</span>
</span><span id="L-2883"><a href="#-2883"><span class="linenos">2883</span></a>                        <span class="c1"># finish bottom voxel layer near &quot;HCWC&quot;</span>
</span><span id="L-2884"><a href="#-2884"><span class="linenos">2884</span></a>                        <span class="n">grown_closure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grow_downward</span><span class="p">(</span>
</span><span id="L-2885"><a href="#-2885"><span class="linenos">2885</span></a>                            <span class="n">grown_closure</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span>
</span><span id="L-2886"><a href="#-2886"><span class="linenos">2886</span></a>                        <span class="p">)</span>
</span><span id="L-2887"><a href="#-2887"><span class="linenos">2887</span></a>                        <span class="c1"># stay within layer, within age, within fault block, above HCWC</span>
</span><span id="L-2888"><a href="#-2888"><span class="linenos">2888</span></a>                        <span class="n">grown_closure</span><span class="p">[</span><span class="n">closure_boundary_cube</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="L-2889"><a href="#-2889"><span class="linenos">2889</span></a>                        <span class="n">single_closure</span> <span class="o">=</span> <span class="n">single_closure</span> <span class="o">+</span> <span class="n">grown_closure</span>
</span><span id="L-2890"><a href="#-2890"><span class="linenos">2890</span></a>                        <span class="n">single_closure</span><span class="p">[</span><span class="n">single_closure</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
</span><span id="L-2891"><a href="#-2891"><span class="linenos">2891</span></a>                        <span class="n">converged</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-2892"><a href="#-2892"><span class="linenos">2892</span></a>                        <span class="k">break</span>
</span><span id="L-2893"><a href="#-2893"><span class="linenos">2893</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="L-2894"><a href="#-2894"><span class="linenos">2894</span></a>                        <span class="n">n_voxel</span> <span class="o">=</span> <span class="n">new_n_voxel</span>
</span><span id="L-2895"><a href="#-2895"><span class="linenos">2895</span></a>                    <span class="n">previous_delta_voxel</span> <span class="o">=</span> <span class="n">delta_voxel</span> <span class="o">+</span> <span class="mi">0</span>
</span><span id="L-2896"><a href="#-2896"><span class="linenos">2896</span></a>                <span class="k">if</span> <span class="n">converged</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="L-2897"><a href="#-2897"><span class="linenos">2897</span></a>                    <span class="n">labels_clean</span><span class="p">[</span><span class="n">single_closure</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
</span><span id="L-2898"><a href="#-2898"><span class="linenos">2898</span></a>                    <span class="n">msg_postscript</span> <span class="o">=</span> <span class="s2">&quot; converged&quot;</span>
</span><span id="L-2899"><a href="#-2899"><span class="linenos">2899</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-2900"><a href="#-2900"><span class="linenos">2900</span></a>                    <span class="n">labels_clean</span><span class="p">[</span><span class="n">labels_clean</span> <span class="o">==</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">i</span>
</span><span id="L-2901"><a href="#-2901"><span class="linenos">2901</span></a>                    <span class="n">msg_postscript</span> <span class="o">=</span> <span class="s2">&quot; NOT converged&quot;</span>
</span><span id="L-2902"><a href="#-2902"><span class="linenos">2902</span></a>                <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-2903"><a href="#-2903"><span class="linenos">2903</span></a>                    <span class="s2">&quot;closure_id: &quot;</span>
</span><span id="L-2904"><a href="#-2904"><span class="linenos">2904</span></a>                    <span class="o">+</span> <span class="nb">format</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="s2">&quot;4d&quot;</span><span class="p">)</span>
</span><span id="L-2905"><a href="#-2905"><span class="linenos">2905</span></a>                    <span class="o">+</span> <span class="s2">&quot;, fault_id: &quot;</span>
</span><span id="L-2906"><a href="#-2906"><span class="linenos">2906</span></a>                    <span class="o">+</span> <span class="nb">format</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">j</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">),</span> <span class="s2">&quot;4d&quot;</span><span class="p">)</span>
</span><span id="L-2907"><a href="#-2907"><span class="linenos">2907</span></a>                    <span class="o">+</span> <span class="s2">&quot;, original_voxels: &quot;</span>
</span><span id="L-2908"><a href="#-2908"><span class="linenos">2908</span></a>                    <span class="o">+</span> <span class="nb">format</span><span class="p">(</span><span class="n">original_voxels</span><span class="p">,</span> <span class="s2">&quot;11,.0f&quot;</span><span class="p">)</span>
</span><span id="L-2909"><a href="#-2909"><span class="linenos">2909</span></a>                    <span class="o">+</span> <span class="s2">&quot;, new_n_voxel: &quot;</span>
</span><span id="L-2910"><a href="#-2910"><span class="linenos">2910</span></a>                    <span class="o">+</span> <span class="nb">format</span><span class="p">(</span><span class="n">new_n_voxel</span><span class="p">,</span> <span class="s2">&quot;11,.0f&quot;</span><span class="p">)</span>
</span><span id="L-2911"><a href="#-2911"><span class="linenos">2911</span></a>                    <span class="o">+</span> <span class="s2">&quot;, percent_growth: &quot;</span>
</span><span id="L-2912"><a href="#-2912"><span class="linenos">2912</span></a>                    <span class="o">+</span> <span class="nb">format</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">new_n_voxel</span><span class="p">)</span> <span class="o">/</span> <span class="n">original_voxels</span><span class="p">,</span> <span class="s2">&quot;6.2f&quot;</span><span class="p">)</span>
</span><span id="L-2913"><a href="#-2913"><span class="linenos">2913</span></a>                <span class="p">)</span>
</span><span id="L-2914"><a href="#-2914"><span class="linenos">2914</span></a>                <span class="nb">print</span><span class="p">(</span><span class="n">msg</span> <span class="o">+</span> <span class="n">msg_postscript</span><span class="p">)</span>
</span><span id="L-2915"><a href="#-2915"><span class="linenos">2915</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span><span class="n">msg</span> <span class="o">+</span> <span class="n">msg_postscript</span><span class="p">)</span>
</span><span id="L-2916"><a href="#-2916"><span class="linenos">2916</span></a>
</span><span id="L-2917"><a href="#-2917"><span class="linenos">2917</span></a>        <span class="c1"># Set small closures to 0 after growth</span>
</span><span id="L-2918"><a href="#-2918"><span class="linenos">2918</span></a>        <span class="n">_grown_labels</span> <span class="o">=</span> <span class="n">measure</span><span class="o">.</span><span class="n">label</span><span class="p">(</span><span class="n">labels_clean</span><span class="p">,</span> <span class="n">connectivity</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">background</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-2919"><a href="#-2919"><span class="linenos">2919</span></a>        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">_grown_labels</span><span class="p">):</span>
</span><span id="L-2920"><a href="#-2920"><span class="linenos">2920</span></a>            <span class="n">size</span> <span class="o">=</span> <span class="n">_grown_labels</span><span class="p">[</span><span class="n">_grown_labels</span> <span class="o">==</span> <span class="n">x</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="L-2921"><a href="#-2921"><span class="linenos">2921</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Size before editing: </span><span class="si">{</span><span class="n">size</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-2922"><a href="#-2922"><span class="linenos">2922</span></a>            <span class="k">if</span> <span class="n">size</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">closure_min_voxels</span><span class="p">:</span>
</span><span id="L-2923"><a href="#-2923"><span class="linenos">2923</span></a>                <span class="n">labels_clean</span><span class="p">[</span><span class="n">_grown_labels</span> <span class="o">==</span> <span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="L-2924"><a href="#-2924"><span class="linenos">2924</span></a>        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">labels_clean</span><span class="p">):</span>
</span><span id="L-2925"><a href="#-2925"><span class="linenos">2925</span></a>            <span class="n">size</span> <span class="o">=</span> <span class="n">labels_clean</span><span class="p">[</span><span class="n">labels_clean</span> <span class="o">==</span> <span class="n">x</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="L-2926"><a href="#-2926"><span class="linenos">2926</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Size after editing: </span><span class="si">{</span><span class="n">size</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-2927"><a href="#-2927"><span class="linenos">2927</span></a>
</span><span id="L-2928"><a href="#-2928"><span class="linenos">2928</span></a>        <span class="k">return</span> <span class="n">labels_clean</span>
</span><span id="L-2929"><a href="#-2929"><span class="linenos">2929</span></a>
</span><span id="L-2930"><a href="#-2930"><span class="linenos">2930</span></a>    <span class="k">def</span> <span class="nf">_dilate_faults_and_onlaps</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-2931"><a href="#-2931"><span class="linenos">2931</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">wide_faults</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grow_lateral</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="L-2932"><a href="#-2932"><span class="linenos">2932</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fat_faults</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grow_lateral</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="L-2933"><a href="#-2933"><span class="linenos">2933</span></a>        <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
</span><span id="L-2934"><a href="#-2934"><span class="linenos">2934</span></a>        <span class="n">mask</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-2935"><a href="#-2935"><span class="linenos">2935</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">onlaps_upward</span> <span class="o">=</span> <span class="n">morphology</span><span class="o">.</span><span class="n">binary_dilation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">onlaps</span><span class="p">,</span> <span class="n">mask</span><span class="p">)</span>
</span><span id="L-2936"><a href="#-2936"><span class="linenos">2936</span></a>        <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
</span><span id="L-2937"><a href="#-2937"><span class="linenos">2937</span></a>        <span class="n">mask</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">:]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-2938"><a href="#-2938"><span class="linenos">2938</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">onlaps_downward</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">onlaps</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-2939"><a href="#-2939"><span class="linenos">2939</span></a>        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">30</span><span class="p">):</span>
</span><span id="L-2940"><a href="#-2940"><span class="linenos">2940</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="L-2941"><a href="#-2941"><span class="linenos">2941</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">onlaps_downward</span> <span class="o">=</span> <span class="n">morphology</span><span class="o">.</span><span class="n">binary_dilation</span><span class="p">(</span>
</span><span id="L-2942"><a href="#-2942"><span class="linenos">2942</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">onlaps_downward</span><span class="p">,</span> <span class="n">mask</span>
</span><span id="L-2943"><a href="#-2943"><span class="linenos">2943</span></a>                <span class="p">)</span>
</span><span id="L-2944"><a href="#-2944"><span class="linenos">2944</span></a>            <span class="k">except</span><span class="p">:</span>
</span><span id="L-2945"><a href="#-2945"><span class="linenos">2945</span></a>                <span class="k">break</span>
</span><span id="L-2946"><a href="#-2946"><span class="linenos">2946</span></a>
</span><span id="L-2947"><a href="#-2947"><span class="linenos">2947</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-2948"><a href="#-2948"><span class="linenos">2948</span></a>    <span class="k">def</span> <span class="nf">_threshold_volumes</span><span class="p">(</span><span class="n">volume</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
</span><span id="L-2949"><a href="#-2949"><span class="linenos">2949</span></a>        <span class="n">volume</span><span class="p">[</span><span class="n">volume</span> <span class="o">&gt;=</span> <span class="n">threshold</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="L-2950"><a href="#-2950"><span class="linenos">2950</span></a>        <span class="n">volume</span><span class="p">[</span><span class="n">volume</span> <span class="o">&lt;</span> <span class="n">threshold</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="L-2951"><a href="#-2951"><span class="linenos">2951</span></a>        <span class="k">return</span> <span class="n">volume</span>
</span><span id="L-2952"><a href="#-2952"><span class="linenos">2952</span></a>
</span><span id="L-2953"><a href="#-2953"><span class="linenos">2953</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-2954"><a href="#-2954"><span class="linenos">2954</span></a>    <span class="k">def</span> <span class="nf">grow_up_and_lateral</span><span class="p">(</span><span class="n">geobody</span><span class="p">,</span> <span class="n">iterations</span><span class="p">,</span> <span class="n">vdist</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">hdist</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="L-2955"><a href="#-2955"><span class="linenos">2955</span></a>        <span class="kn">from</span> <span class="nn">scipy.ndimage</span> <span class="kn">import</span> <span class="n">maximum_filter</span>
</span><span id="L-2956"><a href="#-2956"><span class="linenos">2956</span></a>
</span><span id="L-2957"><a href="#-2957"><span class="linenos">2957</span></a>        <span class="n">hdist_size</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">hdist</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="L-2958"><a href="#-2958"><span class="linenos">2958</span></a>        <span class="n">vdist_size</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">vdist</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="L-2959"><a href="#-2959"><span class="linenos">2959</span></a>        <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">hdist_size</span><span class="p">,</span> <span class="n">hdist_size</span><span class="p">,</span> <span class="n">vdist_size</span><span class="p">))</span>
</span><span id="L-2960"><a href="#-2960"><span class="linenos">2960</span></a>        <span class="n">mask</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:</span> <span class="n">vdist</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-2961"><a href="#-2961"><span class="linenos">2961</span></a>        <span class="n">_geobody</span> <span class="o">=</span> <span class="n">geobody</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-2962"><a href="#-2962"><span class="linenos">2962</span></a>        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="L-2963"><a href="#-2963"><span class="linenos">2963</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="L-2964"><a href="#-2964"><span class="linenos">2964</span></a>                <span class="s2">&quot; ...grow_up_and_lateral: _geobody.shape = &quot;</span><span class="p">,</span>
</span><span id="L-2965"><a href="#-2965"><span class="linenos">2965</span></a>                <span class="n">_geobody</span><span class="p">[</span><span class="n">_geobody</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
</span><span id="L-2966"><a href="#-2966"><span class="linenos">2966</span></a>            <span class="p">)</span>
</span><span id="L-2967"><a href="#-2967"><span class="linenos">2967</span></a>        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">iterations</span><span class="p">):</span>
</span><span id="L-2968"><a href="#-2968"><span class="linenos">2968</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="L-2969"><a href="#-2969"><span class="linenos">2969</span></a>                <span class="n">_geobody</span> <span class="o">=</span> <span class="n">maximum_filter</span><span class="p">(</span><span class="n">_geobody</span><span class="p">,</span> <span class="n">footprint</span><span class="o">=</span><span class="n">mask</span><span class="p">)</span>
</span><span id="L-2970"><a href="#-2970"><span class="linenos">2970</span></a>                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="L-2971"><a href="#-2971"><span class="linenos">2971</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="L-2972"><a href="#-2972"><span class="linenos">2972</span></a>                        <span class="s2">&quot; ...grow_up_and_lateral: k, _geobody.shape = &quot;</span><span class="p">,</span>
</span><span id="L-2973"><a href="#-2973"><span class="linenos">2973</span></a>                        <span class="n">k</span><span class="p">,</span>
</span><span id="L-2974"><a href="#-2974"><span class="linenos">2974</span></a>                        <span class="n">_geobody</span><span class="p">[</span><span class="n">_geobody</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
</span><span id="L-2975"><a href="#-2975"><span class="linenos">2975</span></a>                    <span class="p">)</span>
</span><span id="L-2976"><a href="#-2976"><span class="linenos">2976</span></a>            <span class="k">except</span><span class="p">:</span>
</span><span id="L-2977"><a href="#-2977"><span class="linenos">2977</span></a>                <span class="k">break</span>
</span><span id="L-2978"><a href="#-2978"><span class="linenos">2978</span></a>        <span class="k">return</span> <span class="n">_geobody</span>
</span><span id="L-2979"><a href="#-2979"><span class="linenos">2979</span></a>
</span><span id="L-2980"><a href="#-2980"><span class="linenos">2980</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-2981"><a href="#-2981"><span class="linenos">2981</span></a>    <span class="k">def</span> <span class="nf">grow_lateral</span><span class="p">(</span><span class="n">geobody</span><span class="p">,</span> <span class="n">iterations</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="L-2982"><a href="#-2982"><span class="linenos">2982</span></a>        <span class="kn">from</span> <span class="nn">scipy.ndimage.morphology</span> <span class="kn">import</span> <span class="n">grey_dilation</span>
</span><span id="L-2983"><a href="#-2983"><span class="linenos">2983</span></a>
</span><span id="L-2984"><a href="#-2984"><span class="linenos">2984</span></a>        <span class="n">dist_size</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">dist</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="L-2985"><a href="#-2985"><span class="linenos">2985</span></a>        <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">dist_size</span><span class="p">,</span> <span class="n">dist_size</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</span><span id="L-2986"><a href="#-2986"><span class="linenos">2986</span></a>        <span class="n">mask</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-2987"><a href="#-2987"><span class="linenos">2987</span></a>        <span class="n">_geobody</span> <span class="o">=</span> <span class="n">geobody</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-2988"><a href="#-2988"><span class="linenos">2988</span></a>        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="L-2989"><a href="#-2989"><span class="linenos">2989</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; ...grow_lateral: _geobody.shape = &quot;</span><span class="p">,</span> <span class="n">_geobody</span><span class="p">[</span><span class="n">_geobody</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span><span id="L-2990"><a href="#-2990"><span class="linenos">2990</span></a>        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">iterations</span><span class="p">):</span>
</span><span id="L-2991"><a href="#-2991"><span class="linenos">2991</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="L-2992"><a href="#-2992"><span class="linenos">2992</span></a>                <span class="n">_geobody</span> <span class="o">=</span> <span class="n">grey_dilation</span><span class="p">(</span><span class="n">_geobody</span><span class="p">,</span> <span class="n">footprint</span><span class="o">=</span><span class="n">mask</span><span class="p">)</span>
</span><span id="L-2993"><a href="#-2993"><span class="linenos">2993</span></a>                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="L-2994"><a href="#-2994"><span class="linenos">2994</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="L-2995"><a href="#-2995"><span class="linenos">2995</span></a>                        <span class="s2">&quot; ...grow_lateral: k, _geobody.shape = &quot;</span><span class="p">,</span>
</span><span id="L-2996"><a href="#-2996"><span class="linenos">2996</span></a>                        <span class="n">k</span><span class="p">,</span>
</span><span id="L-2997"><a href="#-2997"><span class="linenos">2997</span></a>                        <span class="n">_geobody</span><span class="p">[</span><span class="n">_geobody</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
</span><span id="L-2998"><a href="#-2998"><span class="linenos">2998</span></a>                    <span class="p">)</span>
</span><span id="L-2999"><a href="#-2999"><span class="linenos">2999</span></a>            <span class="k">except</span><span class="p">:</span>
</span><span id="L-3000"><a href="#-3000"><span class="linenos">3000</span></a>                <span class="k">break</span>
</span><span id="L-3001"><a href="#-3001"><span class="linenos">3001</span></a>        <span class="k">return</span> <span class="n">_geobody</span>
</span><span id="L-3002"><a href="#-3002"><span class="linenos">3002</span></a>
</span><span id="L-3003"><a href="#-3003"><span class="linenos">3003</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-3004"><a href="#-3004"><span class="linenos">3004</span></a>    <span class="k">def</span> <span class="nf">grow_upward</span><span class="p">(</span><span class="n">geobody</span><span class="p">,</span> <span class="n">iterations</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="L-3005"><a href="#-3005"><span class="linenos">3005</span></a>        <span class="kn">from</span> <span class="nn">scipy.ndimage.morphology</span> <span class="kn">import</span> <span class="n">grey_dilation</span>
</span><span id="L-3006"><a href="#-3006"><span class="linenos">3006</span></a>
</span><span id="L-3007"><a href="#-3007"><span class="linenos">3007</span></a>        <span class="n">dist_size</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">dist</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="L-3008"><a href="#-3008"><span class="linenos">3008</span></a>        <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dist_size</span><span class="p">))</span>
</span><span id="L-3009"><a href="#-3009"><span class="linenos">3009</span></a>        <span class="n">mask</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:</span> <span class="n">dist</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-3010"><a href="#-3010"><span class="linenos">3010</span></a>        <span class="n">_geobody</span> <span class="o">=</span> <span class="n">geobody</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-3011"><a href="#-3011"><span class="linenos">3011</span></a>        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="L-3012"><a href="#-3012"><span class="linenos">3012</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; ...grow_upward: _geobody.shape = &quot;</span><span class="p">,</span> <span class="n">_geobody</span><span class="p">[</span><span class="n">_geobody</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span><span id="L-3013"><a href="#-3013"><span class="linenos">3013</span></a>        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">iterations</span><span class="p">):</span>
</span><span id="L-3014"><a href="#-3014"><span class="linenos">3014</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="L-3015"><a href="#-3015"><span class="linenos">3015</span></a>                <span class="n">_geobody</span> <span class="o">=</span> <span class="n">grey_dilation</span><span class="p">(</span><span class="n">_geobody</span><span class="p">,</span> <span class="n">footprint</span><span class="o">=</span><span class="n">mask</span><span class="p">)</span>
</span><span id="L-3016"><a href="#-3016"><span class="linenos">3016</span></a>                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="L-3017"><a href="#-3017"><span class="linenos">3017</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="L-3018"><a href="#-3018"><span class="linenos">3018</span></a>                        <span class="s2">&quot; ...grow_upward: k, _geobody.shape = &quot;</span><span class="p">,</span>
</span><span id="L-3019"><a href="#-3019"><span class="linenos">3019</span></a>                        <span class="n">k</span><span class="p">,</span>
</span><span id="L-3020"><a href="#-3020"><span class="linenos">3020</span></a>                        <span class="n">_geobody</span><span class="p">[</span><span class="n">_geobody</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
</span><span id="L-3021"><a href="#-3021"><span class="linenos">3021</span></a>                    <span class="p">)</span>
</span><span id="L-3022"><a href="#-3022"><span class="linenos">3022</span></a>            <span class="k">except</span><span class="p">:</span>
</span><span id="L-3023"><a href="#-3023"><span class="linenos">3023</span></a>                <span class="k">break</span>
</span><span id="L-3024"><a href="#-3024"><span class="linenos">3024</span></a>        <span class="k">return</span> <span class="n">_geobody</span>
</span><span id="L-3025"><a href="#-3025"><span class="linenos">3025</span></a>
</span><span id="L-3026"><a href="#-3026"><span class="linenos">3026</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-3027"><a href="#-3027"><span class="linenos">3027</span></a>    <span class="k">def</span> <span class="nf">grow_downward</span><span class="p">(</span><span class="n">geobody</span><span class="p">,</span> <span class="n">iterations</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="L-3028"><a href="#-3028"><span class="linenos">3028</span></a>        <span class="kn">from</span> <span class="nn">scipy.ndimage.morphology</span> <span class="kn">import</span> <span class="n">grey_dilation</span>
</span><span id="L-3029"><a href="#-3029"><span class="linenos">3029</span></a>
</span><span id="L-3030"><a href="#-3030"><span class="linenos">3030</span></a>        <span class="n">dist_size</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">dist</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="L-3031"><a href="#-3031"><span class="linenos">3031</span></a>        <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dist_size</span><span class="p">))</span>
</span><span id="L-3032"><a href="#-3032"><span class="linenos">3032</span></a>        <span class="n">mask</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">dist</span><span class="p">:]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-3033"><a href="#-3033"><span class="linenos">3033</span></a>        <span class="n">_geobody</span> <span class="o">=</span> <span class="n">geobody</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-3034"><a href="#-3034"><span class="linenos">3034</span></a>        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="L-3035"><a href="#-3035"><span class="linenos">3035</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; ...grow_downward: _geobody.shape = &quot;</span><span class="p">,</span> <span class="n">_geobody</span><span class="p">[</span><span class="n">_geobody</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span><span id="L-3036"><a href="#-3036"><span class="linenos">3036</span></a>        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">iterations</span><span class="p">):</span>
</span><span id="L-3037"><a href="#-3037"><span class="linenos">3037</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="L-3038"><a href="#-3038"><span class="linenos">3038</span></a>                <span class="n">_geobody</span> <span class="o">=</span> <span class="n">grey_dilation</span><span class="p">(</span><span class="n">_geobody</span><span class="p">,</span> <span class="n">footprint</span><span class="o">=</span><span class="n">mask</span><span class="p">)</span>
</span><span id="L-3039"><a href="#-3039"><span class="linenos">3039</span></a>                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="L-3040"><a href="#-3040"><span class="linenos">3040</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="L-3041"><a href="#-3041"><span class="linenos">3041</span></a>                        <span class="s2">&quot; ...grow_downward: k, _geobody.shape = &quot;</span><span class="p">,</span>
</span><span id="L-3042"><a href="#-3042"><span class="linenos">3042</span></a>                        <span class="n">k</span><span class="p">,</span>
</span><span id="L-3043"><a href="#-3043"><span class="linenos">3043</span></a>                        <span class="n">_geobody</span><span class="p">[</span><span class="n">_geobody</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
</span><span id="L-3044"><a href="#-3044"><span class="linenos">3044</span></a>                    <span class="p">)</span>
</span><span id="L-3045"><a href="#-3045"><span class="linenos">3045</span></a>            <span class="k">except</span><span class="p">:</span>
</span><span id="L-3046"><a href="#-3046"><span class="linenos">3046</span></a>                <span class="k">break</span>
</span><span id="L-3047"><a href="#-3047"><span class="linenos">3047</span></a>        <span class="k">return</span> <span class="n">_geobody</span>
</span><span id="L-3048"><a href="#-3048"><span class="linenos">3048</span></a>
</span><span id="L-3049"><a href="#-3049"><span class="linenos">3049</span></a>
</span><span id="L-3050"><a href="#-3050"><span class="linenos">3050</span></a><span class="k">def</span> <span class="nf">variable_max_column_height</span><span class="p">(</span><span class="n">top_lith_idx</span><span class="p">,</span> <span class="n">num_horizons</span><span class="p">,</span> <span class="n">hmin</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">hmax</span><span class="o">=</span><span class="mi">200</span><span class="p">):</span>
</span><span id="L-3051"><a href="#-3051"><span class="linenos">3051</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-3052"><a href="#-3052"><span class="linenos">3052</span></a><span class="sd">    Create a 1-D array of maximum column heights using linear function in layer numbers</span>
</span><span id="L-3053"><a href="#-3053"><span class="linenos">3053</span></a><span class="sd">    Shallow closures will have small vertical closure heights</span>
</span><span id="L-3054"><a href="#-3054"><span class="linenos">3054</span></a><span class="sd">    Deep closures will have larger vertical closure heights</span>
</span><span id="L-3055"><a href="#-3055"><span class="linenos">3055</span></a>
</span><span id="L-3056"><a href="#-3056"><span class="linenos">3056</span></a><span class="sd">    Would be better to use a pressure profile to determine maximum column heights at given depths</span>
</span><span id="L-3057"><a href="#-3057"><span class="linenos">3057</span></a>
</span><span id="L-3058"><a href="#-3058"><span class="linenos">3058</span></a><span class="sd">    :param top_lith_idx: 1-D array of horizon numbers corresponding to top of layers where lithology changes</span>
</span><span id="L-3059"><a href="#-3059"><span class="linenos">3059</span></a><span class="sd">    :param num_horizons: Total number of horizons in model</span>
</span><span id="L-3060"><a href="#-3060"><span class="linenos">3060</span></a><span class="sd">    :param hmin: Minimum column height to use in linear function</span>
</span><span id="L-3061"><a href="#-3061"><span class="linenos">3061</span></a><span class="sd">    :param hmax: Maximum column height to use in linear function</span>
</span><span id="L-3062"><a href="#-3062"><span class="linenos">3062</span></a><span class="sd">    :return: 1-D array of column heights of closures</span>
</span><span id="L-3063"><a href="#-3063"><span class="linenos">3063</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-3064"><a href="#-3064"><span class="linenos">3064</span></a>    <span class="c1"># Use a linear function to determine max column height based on layer number</span>
</span><span id="L-3065"><a href="#-3065"><span class="linenos">3065</span></a>    <span class="n">column_heights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">hmin</span><span class="p">,</span> <span class="n">hmax</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="n">num_horizons</span><span class="p">)</span>
</span><span id="L-3066"><a href="#-3066"><span class="linenos">3066</span></a>    <span class="n">max_col_heights</span> <span class="o">=</span> <span class="n">column_heights</span><span class="p">[</span><span class="n">top_lith_idx</span><span class="p">]</span>
</span><span id="L-3067"><a href="#-3067"><span class="linenos">3067</span></a>    <span class="k">return</span> <span class="n">max_col_heights</span>
</span><span id="L-3068"><a href="#-3068"><span class="linenos">3068</span></a>
</span><span id="L-3069"><a href="#-3069"><span class="linenos">3069</span></a>
</span><span id="L-3070"><a href="#-3070"><span class="linenos">3070</span></a><span class="c1"># Horizon Spill Point functions</span>
</span><span id="L-3071"><a href="#-3071"><span class="linenos">3071</span></a><span class="k">def</span> <span class="nf">fill_to_spill</span><span class="p">(</span><span class="n">test_array</span><span class="p">,</span> <span class="n">array_flags</span><span class="p">,</span> <span class="n">empty_value</span><span class="o">=</span><span class="mf">1.0e22</span><span class="p">,</span> <span class="n">quiet</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="L-3072"><a href="#-3072"><span class="linenos">3072</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">quiet</span><span class="p">:</span>
</span><span id="L-3073"><a href="#-3073"><span class="linenos">3073</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   ... start fillToSpill ......&quot;</span><span class="p">)</span>
</span><span id="L-3074"><a href="#-3074"><span class="linenos">3074</span></a>    <span class="n">temp_array</span> <span class="o">=</span> <span class="n">test_array</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-3075"><a href="#-3075"><span class="linenos">3075</span></a>    <span class="n">flags</span> <span class="o">=</span> <span class="n">array_flags</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-3076"><a href="#-3076"><span class="linenos">3076</span></a>    <span class="n">test_array_max</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="p">(</span><span class="n">temp_array</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">temp_array</span><span class="p">)])</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</span><span id="L-3077"><a href="#-3077"><span class="linenos">3077</span></a>    <span class="n">temp_array</span><span class="p">[</span><span class="n">array_flags</span> <span class="o">==</span> <span class="mi">255</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">empty_value</span>
</span><span id="L-3078"><a href="#-3078"><span class="linenos">3078</span></a>    <span class="n">flood_filled</span> <span class="o">=</span> <span class="n">test_array_max</span> <span class="o">-</span> <span class="n">flood_fill_heap</span><span class="p">(</span>
</span><span id="L-3079"><a href="#-3079"><span class="linenos">3079</span></a>        <span class="n">test_array_max</span> <span class="o">-</span> <span class="n">temp_array</span><span class="p">,</span> <span class="n">empty_value</span><span class="o">=</span><span class="n">empty_value</span>
</span><span id="L-3080"><a href="#-3080"><span class="linenos">3080</span></a>    <span class="p">)</span>
</span><span id="L-3081"><a href="#-3081"><span class="linenos">3081</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">quiet</span><span class="p">:</span>
</span><span id="L-3082"><a href="#-3082"><span class="linenos">3082</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   ... finish fillToSpill ......&quot;</span><span class="p">)</span>
</span><span id="L-3083"><a href="#-3083"><span class="linenos">3083</span></a>
</span><span id="L-3084"><a href="#-3084"><span class="linenos">3084</span></a>    <span class="n">flood_filled</span><span class="p">[</span><span class="n">array_flags</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-3085"><a href="#-3085"><span class="linenos">3085</span></a>    <span class="n">flood_filled</span><span class="p">[</span><span class="n">flood_filled</span> <span class="o">==</span> <span class="mf">1.0e5</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-3086"><a href="#-3086"><span class="linenos">3086</span></a>    <span class="n">flags</span><span class="p">[</span><span class="n">flood_filled</span> <span class="o">==</span> <span class="n">empty_value</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-3087"><a href="#-3087"><span class="linenos">3087</span></a>
</span><span id="L-3088"><a href="#-3088"><span class="linenos">3088</span></a>    <span class="k">return</span> <span class="n">flood_filled</span>
</span><span id="L-3089"><a href="#-3089"><span class="linenos">3089</span></a>
</span><span id="L-3090"><a href="#-3090"><span class="linenos">3090</span></a>
</span><span id="L-3091"><a href="#-3091"><span class="linenos">3091</span></a><span class="k">def</span> <span class="nf">flood_fill_heap</span><span class="p">(</span><span class="n">test_array</span><span class="p">,</span> <span class="n">empty_value</span><span class="o">=</span><span class="mf">1.0e22</span><span class="p">,</span> <span class="n">quiet</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="L-3092"><a href="#-3092"><span class="linenos">3092</span></a>    <span class="c1"># from internet: http://arcgisandpython.blogspot.co.uk/2012/01/python-flood-fill-algorithm.html</span>
</span><span id="L-3093"><a href="#-3093"><span class="linenos">3093</span></a>
</span><span id="L-3094"><a href="#-3094"><span class="linenos">3094</span></a>    <span class="kn">import</span> <span class="nn">heapq</span>
</span><span id="L-3095"><a href="#-3095"><span class="linenos">3095</span></a>    <span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">ndimage</span>
</span><span id="L-3096"><a href="#-3096"><span class="linenos">3096</span></a>
</span><span id="L-3097"><a href="#-3097"><span class="linenos">3097</span></a>    <span class="n">input_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">test_array</span><span class="p">)</span>
</span><span id="L-3098"><a href="#-3098"><span class="linenos">3098</span></a>    <span class="n">num_validPoints</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-3099"><a href="#-3099"><span class="linenos">3099</span></a>        <span class="n">test_array</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-3100"><a href="#-3100"><span class="linenos">3100</span></a>        <span class="o">-</span> <span class="n">input_array</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">input_array</span><span class="p">)]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-3101"><a href="#-3101"><span class="linenos">3101</span></a>        <span class="o">-</span> <span class="n">input_array</span><span class="p">[</span><span class="n">input_array</span> <span class="o">&gt;</span> <span class="n">empty_value</span> <span class="o">/</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-3102"><a href="#-3102"><span class="linenos">3102</span></a>    <span class="p">)</span>
</span><span id="L-3103"><a href="#-3103"><span class="linenos">3103</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">quiet</span><span class="p">:</span>
</span><span id="L-3104"><a href="#-3104"><span class="linenos">3104</span></a>        <span class="nb">print</span><span class="p">(</span>
</span><span id="L-3105"><a href="#-3105"><span class="linenos">3105</span></a>            <span class="s2">&quot;     ... flood_fill_heap ... number of valid input horizon picks = &quot;</span><span class="p">,</span>
</span><span id="L-3106"><a href="#-3106"><span class="linenos">3106</span></a>            <span class="n">num_validPoints</span><span class="p">,</span>
</span><span id="L-3107"><a href="#-3107"><span class="linenos">3107</span></a>        <span class="p">)</span>
</span><span id="L-3108"><a href="#-3108"><span class="linenos">3108</span></a>
</span><span id="L-3109"><a href="#-3109"><span class="linenos">3109</span></a>    <span class="n">validPoints</span> <span class="o">=</span> <span class="n">input_array</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">input_array</span><span class="p">)]</span>
</span><span id="L-3110"><a href="#-3110"><span class="linenos">3110</span></a>    <span class="n">validPoints</span> <span class="o">=</span> <span class="n">validPoints</span><span class="p">[</span><span class="n">validPoints</span> <span class="o">&lt;</span> <span class="n">empty_value</span> <span class="o">/</span> <span class="mi">2</span><span class="p">]</span>
</span><span id="L-3111"><a href="#-3111"><span class="linenos">3111</span></a>    <span class="n">validPoints</span> <span class="o">=</span> <span class="n">validPoints</span><span class="p">[</span><span class="n">validPoints</span> <span class="o">&lt;</span> <span class="mf">1.0e5</span><span class="p">]</span>
</span><span id="L-3112"><a href="#-3112"><span class="linenos">3112</span></a>    <span class="n">validPoints</span> <span class="o">=</span> <span class="n">validPoints</span><span class="p">[</span><span class="n">validPoints</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">validPoints</span><span class="p">,</span> <span class="mi">2</span><span class="p">)]</span>
</span><span id="L-3113"><a href="#-3113"><span class="linenos">3113</span></a>
</span><span id="L-3114"><a href="#-3114"><span class="linenos">3114</span></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">validPoints</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="L-3115"><a href="#-3115"><span class="linenos">3115</span></a>        <span class="n">amin</span> <span class="o">=</span> <span class="n">validPoints</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
</span><span id="L-3116"><a href="#-3116"><span class="linenos">3116</span></a>        <span class="n">amax</span> <span class="o">=</span> <span class="n">validPoints</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</span><span id="L-3117"><a href="#-3117"><span class="linenos">3117</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-3118"><a href="#-3118"><span class="linenos">3118</span></a>        <span class="k">return</span> <span class="n">test_array</span>
</span><span id="L-3119"><a href="#-3119"><span class="linenos">3119</span></a>
</span><span id="L-3120"><a href="#-3120"><span class="linenos">3120</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">quiet</span><span class="p">:</span>
</span><span id="L-3121"><a href="#-3121"><span class="linenos">3121</span></a>        <span class="nb">print</span><span class="p">(</span>
</span><span id="L-3122"><a href="#-3122"><span class="linenos">3122</span></a>            <span class="s2">&quot;    ... validPoints stats = &quot;</span><span class="p">,</span>
</span><span id="L-3123"><a href="#-3123"><span class="linenos">3123</span></a>            <span class="n">validPoints</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
</span><span id="L-3124"><a href="#-3124"><span class="linenos">3124</span></a>            <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">validPoints</span><span class="p">),</span>
</span><span id="L-3125"><a href="#-3125"><span class="linenos">3125</span></a>            <span class="n">validPoints</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span>
</span><span id="L-3126"><a href="#-3126"><span class="linenos">3126</span></a>            <span class="n">validPoints</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span>
</span><span id="L-3127"><a href="#-3127"><span class="linenos">3127</span></a>        <span class="p">)</span>
</span><span id="L-3128"><a href="#-3128"><span class="linenos">3128</span></a>        <span class="nb">print</span><span class="p">(</span>
</span><span id="L-3129"><a href="#-3129"><span class="linenos">3129</span></a>            <span class="s2">&quot;    ... validPoints %tiles = &quot;</span><span class="p">,</span>
</span><span id="L-3130"><a href="#-3130"><span class="linenos">3130</span></a>            <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">validPoints</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
</span><span id="L-3131"><a href="#-3131"><span class="linenos">3131</span></a>            <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">validPoints</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
</span><span id="L-3132"><a href="#-3132"><span class="linenos">3132</span></a>            <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">validPoints</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
</span><span id="L-3133"><a href="#-3133"><span class="linenos">3133</span></a>            <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">validPoints</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span>
</span><span id="L-3134"><a href="#-3134"><span class="linenos">3134</span></a>            <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">validPoints</span><span class="p">,</span> <span class="mi">25</span><span class="p">),</span>
</span><span id="L-3135"><a href="#-3135"><span class="linenos">3135</span></a>            <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">validPoints</span><span class="p">,</span> <span class="mi">50</span><span class="p">),</span>
</span><span id="L-3136"><a href="#-3136"><span class="linenos">3136</span></a>            <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">validPoints</span><span class="p">,</span> <span class="mi">75</span><span class="p">),</span>
</span><span id="L-3137"><a href="#-3137"><span class="linenos">3137</span></a>            <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">validPoints</span><span class="p">,</span> <span class="mi">90</span><span class="p">),</span>
</span><span id="L-3138"><a href="#-3138"><span class="linenos">3138</span></a>            <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">validPoints</span><span class="p">,</span> <span class="mi">95</span><span class="p">),</span>
</span><span id="L-3139"><a href="#-3139"><span class="linenos">3139</span></a>            <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">validPoints</span><span class="p">,</span> <span class="mi">99</span><span class="p">),</span>
</span><span id="L-3140"><a href="#-3140"><span class="linenos">3140</span></a>            <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">validPoints</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span>
</span><span id="L-3141"><a href="#-3141"><span class="linenos">3141</span></a>        <span class="p">)</span>
</span><span id="L-3142"><a href="#-3142"><span class="linenos">3142</span></a>        <span class="kn">from</span> <span class="nn">datagenerator.util</span> <span class="kn">import</span> <span class="n">import_matplotlib</span>
</span><span id="L-3143"><a href="#-3143"><span class="linenos">3143</span></a>
</span><span id="L-3144"><a href="#-3144"><span class="linenos">3144</span></a>        <span class="n">plt</span> <span class="o">=</span> <span class="n">import_matplotlib</span><span class="p">()</span>
</span><span id="L-3145"><a href="#-3145"><span class="linenos">3145</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</span><span id="L-3146"><a href="#-3146"><span class="linenos">3146</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
</span><span id="L-3147"><a href="#-3147"><span class="linenos">3147</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">input_array</span><span class="p">),</span> <span class="n">vmin</span><span class="o">=</span><span class="n">amin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">amax</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;jet_r&quot;</span><span class="p">)</span>
</span><span id="L-3148"><a href="#-3148"><span class="linenos">3148</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
</span><span id="L-3149"><a href="#-3149"><span class="linenos">3149</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span id="L-3150"><a href="#-3150"><span class="linenos">3150</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;flood_fill.png&quot;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;png&quot;</span><span class="p">)</span>
</span><span id="L-3151"><a href="#-3151"><span class="linenos">3151</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="L-3152"><a href="#-3152"><span class="linenos">3152</span></a>
</span><span id="L-3153"><a href="#-3153"><span class="linenos">3153</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;     ... min &amp; max for surface = &quot;</span><span class="p">,</span> <span class="n">amin</span><span class="p">,</span> <span class="n">amax</span><span class="p">)</span>
</span><span id="L-3154"><a href="#-3154"><span class="linenos">3154</span></a>
</span><span id="L-3155"><a href="#-3155"><span class="linenos">3155</span></a>    <span class="c1"># set empty values and nan&#39;s to huge</span>
</span><span id="L-3156"><a href="#-3156"><span class="linenos">3156</span></a>    <span class="n">input_array</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">input_array</span><span class="p">)]</span> <span class="o">=</span> <span class="n">empty_value</span>
</span><span id="L-3157"><a href="#-3157"><span class="linenos">3157</span></a>
</span><span id="L-3158"><a href="#-3158"><span class="linenos">3158</span></a>    <span class="c1"># Set h_max to a value larger than the array maximum to ensure that the while loop will terminate</span>
</span><span id="L-3159"><a href="#-3159"><span class="linenos">3159</span></a>    <span class="n">h_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">input_array</span> <span class="o">*</span> <span class="mf">2.0</span><span class="p">)</span>
</span><span id="L-3160"><a href="#-3160"><span class="linenos">3160</span></a>
</span><span id="L-3161"><a href="#-3161"><span class="linenos">3161</span></a>    <span class="c1"># Build mask of cells with data not on the edge of the image</span>
</span><span id="L-3162"><a href="#-3162"><span class="linenos">3162</span></a>    <span class="c1"># Use 3x3 square structuring element</span>
</span><span id="L-3163"><a href="#-3163"><span class="linenos">3163</span></a>    <span class="n">el</span> <span class="o">=</span> <span class="n">ndimage</span><span class="o">.</span><span class="n">generate_binary_structure</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">)</span>
</span><span id="L-3164"><a href="#-3164"><span class="linenos">3164</span></a>    <span class="n">inside_mask</span> <span class="o">=</span> <span class="n">ndimage</span><span class="o">.</span><span class="n">binary_erosion</span><span class="p">(</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">input_array</span><span class="p">),</span> <span class="n">structure</span><span class="o">=</span><span class="n">el</span><span class="p">)</span>
</span><span id="L-3165"><a href="#-3165"><span class="linenos">3165</span></a>    <span class="n">inside_mask</span><span class="p">[</span><span class="n">input_array</span> <span class="o">==</span> <span class="n">empty_value</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-3166"><a href="#-3166"><span class="linenos">3166</span></a>    <span class="n">edge_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">invert</span><span class="p">(</span><span class="n">inside_mask</span><span class="p">)</span>
</span><span id="L-3167"><a href="#-3167"><span class="linenos">3167</span></a>    <span class="c1"># Initialize output array as max value test_array except edges</span>
</span><span id="L-3168"><a href="#-3168"><span class="linenos">3168</span></a>    <span class="n">output_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">input_array</span><span class="p">)</span>
</span><span id="L-3169"><a href="#-3169"><span class="linenos">3169</span></a>    <span class="n">output_array</span><span class="p">[</span><span class="n">inside_mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">h_max</span>
</span><span id="L-3170"><a href="#-3170"><span class="linenos">3170</span></a>
</span><span id="L-3171"><a href="#-3171"><span class="linenos">3171</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">quiet</span><span class="p">:</span>
</span><span id="L-3172"><a href="#-3172"><span class="linenos">3172</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
</span><span id="L-3173"><a href="#-3173"><span class="linenos">3173</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
</span><span id="L-3174"><a href="#-3174"><span class="linenos">3174</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">input_array</span><span class="p">),</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;jet_r&quot;</span><span class="p">)</span>
</span><span id="L-3175"><a href="#-3175"><span class="linenos">3175</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
</span><span id="L-3176"><a href="#-3176"><span class="linenos">3176</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span id="L-3177"><a href="#-3177"><span class="linenos">3177</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;flood_fill2.png&quot;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;png&quot;</span><span class="p">)</span>
</span><span id="L-3178"><a href="#-3178"><span class="linenos">3178</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="L-3179"><a href="#-3179"><span class="linenos">3179</span></a>
</span><span id="L-3180"><a href="#-3180"><span class="linenos">3180</span></a>    <span class="c1"># Build priority queue and place edge pixels into priority queue</span>
</span><span id="L-3181"><a href="#-3181"><span class="linenos">3181</span></a>    <span class="c1"># Last value is flag to indicate if cell is an edge cell</span>
</span><span id="L-3182"><a href="#-3182"><span class="linenos">3182</span></a>    <span class="n">put</span> <span class="o">=</span> <span class="n">heapq</span><span class="o">.</span><span class="n">heappush</span>
</span><span id="L-3183"><a href="#-3183"><span class="linenos">3183</span></a>    <span class="n">get</span> <span class="o">=</span> <span class="n">heapq</span><span class="o">.</span><span class="n">heappop</span>
</span><span id="L-3184"><a href="#-3184"><span class="linenos">3184</span></a>    <span class="n">fill_heap</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-3185"><a href="#-3185"><span class="linenos">3185</span></a>        <span class="p">(</span><span class="n">output_array</span><span class="p">[</span><span class="n">t_row</span><span class="p">,</span> <span class="n">t_col</span><span class="p">],</span> <span class="nb">int</span><span class="p">(</span><span class="n">t_row</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">t_col</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-3186"><a href="#-3186"><span class="linenos">3186</span></a>        <span class="k">for</span> <span class="n">t_row</span><span class="p">,</span> <span class="n">t_col</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">edge_mask</span><span class="p">))</span>
</span><span id="L-3187"><a href="#-3187"><span class="linenos">3187</span></a>    <span class="p">]</span>
</span><span id="L-3188"><a href="#-3188"><span class="linenos">3188</span></a>    <span class="n">heapq</span><span class="o">.</span><span class="n">heapify</span><span class="p">(</span><span class="n">fill_heap</span><span class="p">)</span>
</span><span id="L-3189"><a href="#-3189"><span class="linenos">3189</span></a>
</span><span id="L-3190"><a href="#-3190"><span class="linenos">3190</span></a>    <span class="c1"># Iterate until priority queue is empty</span>
</span><span id="L-3191"><a href="#-3191"><span class="linenos">3191</span></a>    <span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-3192"><a href="#-3192"><span class="linenos">3192</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-3193"><a href="#-3193"><span class="linenos">3193</span></a>            <span class="n">h_crt</span><span class="p">,</span> <span class="n">t_row</span><span class="p">,</span> <span class="n">t_col</span><span class="p">,</span> <span class="n">edge_flag</span> <span class="o">=</span> <span class="n">get</span><span class="p">(</span><span class="n">fill_heap</span><span class="p">)</span>
</span><span id="L-3194"><a href="#-3194"><span class="linenos">3194</span></a>        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
</span><span id="L-3195"><a href="#-3195"><span class="linenos">3195</span></a>            <span class="k">break</span>
</span><span id="L-3196"><a href="#-3196"><span class="linenos">3196</span></a>        <span class="k">for</span> <span class="n">n_row</span><span class="p">,</span> <span class="n">n_col</span> <span class="ow">in</span> <span class="p">[</span>
</span><span id="L-3197"><a href="#-3197"><span class="linenos">3197</span></a>            <span class="p">((</span><span class="n">t_row</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span> <span class="n">t_col</span><span class="p">),</span>
</span><span id="L-3198"><a href="#-3198"><span class="linenos">3198</span></a>            <span class="p">((</span><span class="n">t_row</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">t_col</span><span class="p">),</span>
</span><span id="L-3199"><a href="#-3199"><span class="linenos">3199</span></a>            <span class="p">(</span><span class="n">t_row</span><span class="p">,</span> <span class="p">(</span><span class="n">t_col</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)),</span>
</span><span id="L-3200"><a href="#-3200"><span class="linenos">3200</span></a>            <span class="p">(</span><span class="n">t_row</span><span class="p">,</span> <span class="p">(</span><span class="n">t_col</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)),</span>
</span><span id="L-3201"><a href="#-3201"><span class="linenos">3201</span></a>        <span class="p">]:</span>
</span><span id="L-3202"><a href="#-3202"><span class="linenos">3202</span></a>            <span class="c1"># Skip cell if outside array edges</span>
</span><span id="L-3203"><a href="#-3203"><span class="linenos">3203</span></a>            <span class="k">if</span> <span class="n">edge_flag</span><span class="p">:</span>
</span><span id="L-3204"><a href="#-3204"><span class="linenos">3204</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="L-3205"><a href="#-3205"><span class="linenos">3205</span></a>                    <span class="k">if</span> <span class="ow">not</span> <span class="n">inside_mask</span><span class="p">[</span><span class="n">n_row</span><span class="p">,</span> <span class="n">n_col</span><span class="p">]:</span>
</span><span id="L-3206"><a href="#-3206"><span class="linenos">3206</span></a>                        <span class="k">continue</span>
</span><span id="L-3207"><a href="#-3207"><span class="linenos">3207</span></a>                <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
</span><span id="L-3208"><a href="#-3208"><span class="linenos">3208</span></a>                    <span class="k">continue</span>
</span><span id="L-3209"><a href="#-3209"><span class="linenos">3209</span></a>            <span class="k">if</span> <span class="n">output_array</span><span class="p">[</span><span class="n">n_row</span><span class="p">,</span> <span class="n">n_col</span><span class="p">]</span> <span class="o">==</span> <span class="n">h_max</span><span class="p">:</span>
</span><span id="L-3210"><a href="#-3210"><span class="linenos">3210</span></a>                <span class="n">output_array</span><span class="p">[</span><span class="n">n_row</span><span class="p">,</span> <span class="n">n_col</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">h_crt</span><span class="p">,</span> <span class="n">input_array</span><span class="p">[</span><span class="n">n_row</span><span class="p">,</span> <span class="n">n_col</span><span class="p">])</span>
</span><span id="L-3211"><a href="#-3211"><span class="linenos">3211</span></a>                <span class="n">put</span><span class="p">(</span><span class="n">fill_heap</span><span class="p">,</span> <span class="p">(</span><span class="n">output_array</span><span class="p">[</span><span class="n">n_row</span><span class="p">,</span> <span class="n">n_col</span><span class="p">],</span> <span class="n">n_row</span><span class="p">,</span> <span class="n">n_col</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
</span><span id="L-3212"><a href="#-3212"><span class="linenos">3212</span></a>    <span class="n">output_array</span><span class="p">[</span><span class="n">output_array</span> <span class="o">==</span> <span class="n">empty_value</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
</span><span id="L-3213"><a href="#-3213"><span class="linenos">3213</span></a>    <span class="k">return</span> <span class="n">output_array</span>
</span><span id="L-3214"><a href="#-3214"><span class="linenos">3214</span></a>
</span><span id="L-3215"><a href="#-3215"><span class="linenos">3215</span></a>
</span><span id="L-3216"><a href="#-3216"><span class="linenos">3216</span></a><span class="k">def</span> <span class="nf">_flood_fill</span><span class="p">(</span><span class="n">horizon</span><span class="p">,</span> <span class="n">max_column_height</span><span class="o">=</span><span class="mf">20.0</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="L-3217"><a href="#-3217"><span class="linenos">3217</span></a>    <span class="sd">&quot;&quot;&quot;Locate areas on horizon that are in structural closure.</span>
</span><span id="L-3218"><a href="#-3218"><span class="linenos">3218</span></a>
</span><span id="L-3219"><a href="#-3219"><span class="linenos">3219</span></a><span class="sd">    # horizon: depth horizon as 2D numpy array.</span>
</span><span id="L-3220"><a href="#-3220"><span class="linenos">3220</span></a><span class="sd">    # - assume that fault intersections are inserted with value of 0.</span>
</span><span id="L-3221"><a href="#-3221"><span class="linenos">3221</span></a><span class="sd">    # - assume that values represent depth (i.e., bigger values are deeper)&quot;&quot;&quot;</span>
</span><span id="L-3222"><a href="#-3222"><span class="linenos">3222</span></a>    <span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">ndimage</span>
</span><span id="L-3223"><a href="#-3223"><span class="linenos">3223</span></a>
</span><span id="L-3224"><a href="#-3224"><span class="linenos">3224</span></a>    <span class="c1"># copy input array</span>
</span><span id="L-3225"><a href="#-3225"><span class="linenos">3225</span></a>    <span class="n">temp_event</span> <span class="o">=</span> <span class="n">horizon</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-3226"><a href="#-3226"><span class="linenos">3226</span></a>
</span><span id="L-3227"><a href="#-3227"><span class="linenos">3227</span></a>    <span class="n">emptypicks</span> <span class="o">=</span> <span class="n">temp_event</span> <span class="o">*</span> <span class="mf">0.0</span>
</span><span id="L-3228"><a href="#-3228"><span class="linenos">3228</span></a>    <span class="n">emptypicks</span><span class="p">[</span><span class="n">temp_event</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="L-3229"><a href="#-3229"><span class="linenos">3229</span></a>    <span class="n">emptypicks_dilated</span> <span class="o">=</span> <span class="n">ndimage</span><span class="o">.</span><span class="n">grey_dilation</span><span class="p">(</span>
</span><span id="L-3230"><a href="#-3230"><span class="linenos">3230</span></a>        <span class="n">emptypicks</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">structure</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
</span><span id="L-3231"><a href="#-3231"><span class="linenos">3231</span></a>    <span class="p">)</span>
</span><span id="L-3232"><a href="#-3232"><span class="linenos">3232</span></a>    <span class="c1"># dilation removes some of the event - turn this off to honour the input events exactly</span>
</span><span id="L-3233"><a href="#-3233"><span class="linenos">3233</span></a>    <span class="c1"># Changed to avoid vertical closure-boundaries near faults</span>
</span><span id="L-3234"><a href="#-3234"><span class="linenos">3234</span></a>    <span class="c1"># emptypicks_dilated = emptypicks</span>
</span><span id="L-3235"><a href="#-3235"><span class="linenos">3235</span></a>    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="L-3236"><a href="#-3236"><span class="linenos">3236</span></a>        <span class="nb">print</span><span class="p">(</span>
</span><span id="L-3237"><a href="#-3237"><span class="linenos">3237</span></a>            <span class="s2">&quot; emptypicks_dilated min,mean,max = &quot;</span><span class="p">,</span>
</span><span id="L-3238"><a href="#-3238"><span class="linenos">3238</span></a>            <span class="n">emptypicks_dilated</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
</span><span id="L-3239"><a href="#-3239"><span class="linenos">3239</span></a>            <span class="n">emptypicks_dilated</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span>
</span><span id="L-3240"><a href="#-3240"><span class="linenos">3240</span></a>            <span class="n">emptypicks_dilated</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span>
</span><span id="L-3241"><a href="#-3241"><span class="linenos">3241</span></a>        <span class="p">)</span>
</span><span id="L-3242"><a href="#-3242"><span class="linenos">3242</span></a>
</span><span id="L-3243"><a href="#-3243"><span class="linenos">3243</span></a>    <span class="c1"># create boundary around edges of 2D array</span>
</span><span id="L-3244"><a href="#-3244"><span class="linenos">3244</span></a>    <span class="n">temp_event</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="L-3245"><a href="#-3245"><span class="linenos">3245</span></a>    <span class="n">temp_event</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">3</span><span class="p">:]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="L-3246"><a href="#-3246"><span class="linenos">3246</span></a>    <span class="n">temp_event</span><span class="p">[:</span><span class="mi">3</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="L-3247"><a href="#-3247"><span class="linenos">3247</span></a>    <span class="n">temp_event</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="L-3248"><a href="#-3248"><span class="linenos">3248</span></a>
</span><span id="L-3249"><a href="#-3249"><span class="linenos">3249</span></a>    <span class="c1"># replace pixels with value=0 with vertical &#39;wall&#39; that is max_column_height deeper than nearby pixels</span>
</span><span id="L-3250"><a href="#-3250"><span class="linenos">3250</span></a>    <span class="n">temp_event</span><span class="p">[</span>
</span><span id="L-3251"><a href="#-3251"><span class="linenos">3251</span></a>        <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">emptypicks_dilated</span> <span class="o">==</span> <span class="mf">2.0</span><span class="p">,</span> <span class="n">temp_event</span> <span class="o">!=</span> <span class="mf">0.0</span><span class="p">)</span>
</span><span id="L-3252"><a href="#-3252"><span class="linenos">3252</span></a>    <span class="p">]</span> <span class="o">+=</span> <span class="n">max_column_height</span>
</span><span id="L-3253"><a href="#-3253"><span class="linenos">3253</span></a>    <span class="n">temp_event</span><span class="p">[</span><span class="n">emptypicks</span> <span class="o">==</span> <span class="mf">1.0</span><span class="p">]</span> <span class="o">+=</span> <span class="mf">0.0</span>
</span><span id="L-3254"><a href="#-3254"><span class="linenos">3254</span></a>
</span><span id="L-3255"><a href="#-3255"><span class="linenos">3255</span></a>    <span class="c1"># put deep point at map origin to &#39;collect&#39; flood-fill run-off</span>
</span><span id="L-3256"><a href="#-3256"><span class="linenos">3256</span></a>    <span class="n">temp_event</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0e5</span>
</span><span id="L-3257"><a href="#-3257"><span class="linenos">3257</span></a>
</span><span id="L-3258"><a href="#-3258"><span class="linenos">3258</span></a>    <span class="c1"># create flags to indicate pick vs no-pick in 2D array</span>
</span><span id="L-3259"><a href="#-3259"><span class="linenos">3259</span></a>    <span class="n">flags</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">horizon</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">horizon</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="s2">&quot;int&quot;</span><span class="p">)</span>
</span><span id="L-3260"><a href="#-3260"><span class="linenos">3260</span></a>    <span class="n">flags</span><span class="p">[</span><span class="n">temp_event</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-3261"><a href="#-3261"><span class="linenos">3261</span></a>    <span class="n">flags</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-3262"><a href="#-3262"><span class="linenos">3262</span></a>
</span><span id="L-3263"><a href="#-3263"><span class="linenos">3263</span></a>    <span class="n">flood_filled</span> <span class="o">=</span> <span class="o">-</span><span class="n">fill_to_spill</span><span class="p">(</span><span class="o">-</span><span class="n">temp_event</span><span class="p">,</span> <span class="n">flags</span><span class="p">)</span>
</span><span id="L-3264"><a href="#-3264"><span class="linenos">3264</span></a>
</span><span id="L-3265"><a href="#-3265"><span class="linenos">3265</span></a>    <span class="c1"># set pixels near fault gaps to empty</span>
</span><span id="L-3266"><a href="#-3266"><span class="linenos">3266</span></a>    <span class="n">flood_filled</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">emptypicks_dilated</span> <span class="o">==</span> <span class="mf">2.0</span><span class="p">,</span> <span class="n">temp_event</span> <span class="o">!=</span> <span class="mf">0.0</span><span class="p">)]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="L-3267"><a href="#-3267"><span class="linenos">3267</span></a>
</span><span id="L-3268"><a href="#-3268"><span class="linenos">3268</span></a>    <span class="c1"># limit closure heights to max_column_height</span>
</span><span id="L-3269"><a href="#-3269"><span class="linenos">3269</span></a>    <span class="c1"># - Note that this typically causes under-filling of shallow 4-way closures</span>
</span><span id="L-3270"><a href="#-3270"><span class="linenos">3270</span></a>    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="L-3271"><a href="#-3271"><span class="linenos">3271</span></a>        <span class="kn">import</span> <span class="nn">pdb</span>
</span><span id="L-3272"><a href="#-3272"><span class="linenos">3272</span></a>
</span><span id="L-3273"><a href="#-3273"><span class="linenos">3273</span></a>        <span class="n">pdb</span><span class="o">.</span><span class="n">set_trace</span><span class="p">()</span>
</span><span id="L-3274"><a href="#-3274"><span class="linenos">3274</span></a>    <span class="n">ff</span> <span class="o">=</span> <span class="n">flood_filled</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-3275"><a href="#-3275"><span class="linenos">3275</span></a>    <span class="n">diff</span> <span class="o">=</span> <span class="n">horizon</span> <span class="o">-</span> <span class="n">ff</span>
</span><span id="L-3276"><a href="#-3276"><span class="linenos">3276</span></a>    <span class="n">diff</span><span class="p">[</span><span class="n">flood_filled</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="L-3277"><a href="#-3277"><span class="linenos">3277</span></a>    <span class="n">diff</span><span class="p">[</span><span class="n">diff</span> <span class="o">!=</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="L-3278"><a href="#-3278"><span class="linenos">3278</span></a>
</span><span id="L-3279"><a href="#-3279"><span class="linenos">3279</span></a>    <span class="kn">from</span> <span class="nn">skimage</span> <span class="kn">import</span> <span class="n">morphology</span>
</span><span id="L-3280"><a href="#-3280"><span class="linenos">3280</span></a>    <span class="kn">from</span> <span class="nn">skimage</span> <span class="kn">import</span> <span class="n">measure</span>
</span><span id="L-3281"><a href="#-3281"><span class="linenos">3281</span></a>
</span><span id="L-3282"><a href="#-3282"><span class="linenos">3282</span></a>    <span class="n">labels</span> <span class="o">=</span> <span class="n">measure</span><span class="o">.</span><span class="n">label</span><span class="p">(</span><span class="n">diff</span><span class="p">,</span> <span class="n">connectivity</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">background</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-3283"><a href="#-3283"><span class="linenos">3283</span></a>    <span class="n">labels_clean</span> <span class="o">=</span> <span class="n">morphology</span><span class="o">.</span><span class="n">remove_small_objects</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
</span><span id="L-3284"><a href="#-3284"><span class="linenos">3284</span></a>    <span class="n">labels_clean_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">labels_clean</span><span class="o">.</span><span class="n">flatten</span><span class="p">()))</span>
</span><span id="L-3285"><a href="#-3285"><span class="linenos">3285</span></a>    <span class="n">labels_clean_list</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
</span><span id="L-3286"><a href="#-3286"><span class="linenos">3286</span></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">labels_clean_list</span><span class="p">:</span>
</span><span id="L-3287"><a href="#-3287"><span class="linenos">3287</span></a>        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-3288"><a href="#-3288"><span class="linenos">3288</span></a>            <span class="k">continue</span>
</span><span id="L-3289"><a href="#-3289"><span class="linenos">3289</span></a>        <span class="n">trap_crest</span> <span class="o">=</span> <span class="o">-</span><span class="n">horizon</span><span class="p">[</span><span class="n">labels_clean</span> <span class="o">==</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
</span><span id="L-3290"><a href="#-3290"><span class="linenos">3290</span></a>        <span class="n">initial_size</span> <span class="o">=</span> <span class="n">horizon</span><span class="p">[</span><span class="n">labels_clean</span> <span class="o">==</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="L-3291"><a href="#-3291"><span class="linenos">3291</span></a>        <span class="n">spill_depth_map</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">horizon</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">trap_crest</span> <span class="o">-</span> <span class="n">max_column_height</span><span class="p">)</span>
</span><span id="L-3292"><a href="#-3292"><span class="linenos">3292</span></a>        <span class="n">spill_points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dstack</span><span class="p">((</span><span class="o">-</span><span class="n">flood_filled</span><span class="p">,</span> <span class="n">spill_depth_map</span><span class="p">))</span>
</span><span id="L-3293"><a href="#-3293"><span class="linenos">3293</span></a>        <span class="n">spill_point_map</span> <span class="o">=</span> <span class="n">spill_points</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-3294"><a href="#-3294"><span class="linenos">3294</span></a>        <span class="n">spill_point_map</span><span class="p">[</span><span class="n">spill_point_map</span> <span class="o">==</span> <span class="o">-</span><span class="mf">100000.0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="L-3295"><a href="#-3295"><span class="linenos">3295</span></a>        <span class="n">spill_point_map</span><span class="p">[</span><span class="n">spill_point_map</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="L-3296"><a href="#-3296"><span class="linenos">3296</span></a>        <span class="n">flood_filled</span><span class="p">[</span><span class="n">labels_clean</span> <span class="o">==</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">spill_point_map</span><span class="p">[</span><span class="n">labels_clean</span> <span class="o">==</span> <span class="n">i</span><span class="p">]</span>
</span><span id="L-3297"><a href="#-3297"><span class="linenos">3297</span></a>        <span class="n">flood_filled</span><span class="p">[</span><span class="n">flood_filled</span> <span class="o">&lt;</span> <span class="n">horizon</span><span class="p">]</span> <span class="o">=</span> <span class="n">horizon</span><span class="p">[</span><span class="n">flood_filled</span> <span class="o">&lt;</span> <span class="n">horizon</span><span class="p">]</span>
</span><span id="L-3298"><a href="#-3298"><span class="linenos">3298</span></a>        <span class="n">final_size</span> <span class="o">=</span> <span class="n">horizon</span><span class="p">[</span>
</span><span id="L-3299"><a href="#-3299"><span class="linenos">3299</span></a>            <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">horizon</span> <span class="o">-</span> <span class="n">flood_filled</span> <span class="o">!=</span> <span class="mf">0.0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">labels_clean</span> <span class="o">==</span> <span class="n">i</span><span class="p">))</span>
</span><span id="L-3300"><a href="#-3300"><span class="linenos">3300</span></a>        <span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="L-3301"><a href="#-3301"><span class="linenos">3301</span></a>        <span class="nb">print</span><span class="p">(</span>
</span><span id="L-3302"><a href="#-3302"><span class="linenos">3302</span></a>            <span class="s2">&quot;  ...inside _flood_fill: i, initial_size, final_size = &quot;</span><span class="p">,</span>
</span><span id="L-3303"><a href="#-3303"><span class="linenos">3303</span></a>            <span class="n">i</span><span class="p">,</span>
</span><span id="L-3304"><a href="#-3304"><span class="linenos">3304</span></a>            <span class="n">initial_size</span><span class="p">,</span>
</span><span id="L-3305"><a href="#-3305"><span class="linenos">3305</span></a>            <span class="n">final_size</span><span class="p">,</span>
</span><span id="L-3306"><a href="#-3306"><span class="linenos">3306</span></a>        <span class="p">)</span>
</span><span id="L-3307"><a href="#-3307"><span class="linenos">3307</span></a>        <span class="k">del</span> <span class="n">spill_depth_map</span>
</span><span id="L-3308"><a href="#-3308"><span class="linenos">3308</span></a>        <span class="k">del</span> <span class="n">spill_points</span>
</span><span id="L-3309"><a href="#-3309"><span class="linenos">3309</span></a>        <span class="k">del</span> <span class="n">spill_point_map</span>
</span><span id="L-3310"><a href="#-3310"><span class="linenos">3310</span></a>    <span class="k">del</span> <span class="n">ff</span>
</span><span id="L-3311"><a href="#-3311"><span class="linenos">3311</span></a>    <span class="k">del</span> <span class="n">diff</span>
</span><span id="L-3312"><a href="#-3312"><span class="linenos">3312</span></a>    <span class="k">del</span> <span class="n">labels</span>
</span><span id="L-3313"><a href="#-3313"><span class="linenos">3313</span></a>    <span class="k">del</span> <span class="n">labels_clean</span>
</span><span id="L-3314"><a href="#-3314"><span class="linenos">3314</span></a>
</span><span id="L-3315"><a href="#-3315"><span class="linenos">3315</span></a>    <span class="k">return</span> <span class="n">flood_filled</span>
</span><span id="L-3316"><a href="#-3316"><span class="linenos">3316</span></a>
</span><span id="L-3317"><a href="#-3317"><span class="linenos">3317</span></a>
</span><span id="L-3318"><a href="#-3318"><span class="linenos">3318</span></a><span class="k">def</span> <span class="nf">get_top_of_closure</span><span class="p">(</span><span class="n">inarray</span><span class="p">,</span> <span class="n">pad_up</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">pad_down</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
</span><span id="L-3319"><a href="#-3319"><span class="linenos">3319</span></a>    <span class="sd">&quot;&quot;&quot;Create a mask leaving only the top of a closure.&quot;&quot;&quot;</span>
</span><span id="L-3320"><a href="#-3320"><span class="linenos">3320</span></a>    <span class="n">mask</span> <span class="o">=</span> <span class="n">inarray</span> <span class="o">!=</span> <span class="mi">0</span>
</span><span id="L-3321"><a href="#-3321"><span class="linenos">3321</span></a>    <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">),</span> <span class="n">mask</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">),</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-3322"><a href="#-3322"><span class="linenos">3322</span></a>    <span class="n">xy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="n">t</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="L-3323"><a href="#-3323"><span class="linenos">3323</span></a>    <span class="n">z</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="n">t</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
</span><span id="L-3324"><a href="#-3324"><span class="linenos">3324</span></a>    <span class="n">outarray</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">inarray</span><span class="p">)</span>
</span><span id="L-3325"><a href="#-3325"><span class="linenos">3325</span></a>    <span class="k">for</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="n">z</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">xy</span><span class="p">,</span> <span class="n">z</span><span class="p">):</span>
</span><span id="L-3326"><a href="#-3326"><span class="linenos">3326</span></a>        <span class="n">zmin</span> <span class="o">=</span> <span class="n">z</span> <span class="o">-</span> <span class="n">pad_up</span>
</span><span id="L-3327"><a href="#-3327"><span class="linenos">3327</span></a>        <span class="n">zmax</span> <span class="o">=</span> <span class="n">z</span> <span class="o">+</span> <span class="n">pad_down</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="L-3328"><a href="#-3328"><span class="linenos">3328</span></a>        <span class="n">outarray</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">zmin</span><span class="p">:</span><span class="n">zmax</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-3329"><a href="#-3329"><span class="linenos">3329</span></a>    <span class="k">return</span> <span class="n">outarray</span>
</span><span id="L-3330"><a href="#-3330"><span class="linenos">3330</span></a>
</span><span id="L-3331"><a href="#-3331"><span class="linenos">3331</span></a>
</span><span id="L-3332"><a href="#-3332"><span class="linenos">3332</span></a><span class="k">def</span> <span class="nf">lsq</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">):</span>
</span><span id="L-3333"><a href="#-3333"><span class="linenos">3333</span></a>    <span class="c1">###</span>
</span><span id="L-3334"><a href="#-3334"><span class="linenos">3334</span></a>    <span class="c1">### compute the slope and intercept for an array with points to be fit</span>
</span><span id="L-3335"><a href="#-3335"><span class="linenos">3335</span></a>    <span class="c1">### in the last dimension. can be in other axis using the &#39;axis&#39; parmameter.</span>
</span><span id="L-3336"><a href="#-3336"><span class="linenos">3336</span></a>    <span class="c1">###</span>
</span><span id="L-3337"><a href="#-3337"><span class="linenos">3337</span></a>    <span class="c1">### returns:</span>
</span><span id="L-3338"><a href="#-3338"><span class="linenos">3338</span></a>    <span class="c1">### - intercept</span>
</span><span id="L-3339"><a href="#-3339"><span class="linenos">3339</span></a>    <span class="c1">### - slope</span>
</span><span id="L-3340"><a href="#-3340"><span class="linenos">3340</span></a>    <span class="c1">### - pearson r (normalized cross-correlation coefficient)</span>
</span><span id="L-3341"><a href="#-3341"><span class="linenos">3341</span></a>    <span class="c1">###</span>
</span><span id="L-3342"><a href="#-3342"><span class="linenos">3342</span></a>    <span class="c1">### output will have dimensions of input with one less axis</span>
</span><span id="L-3343"><a href="#-3343"><span class="linenos">3343</span></a>    <span class="c1">### - (specified by axis parameter)</span>
</span><span id="L-3344"><a href="#-3344"><span class="linenos">3344</span></a>    <span class="c1">###</span>
</span><span id="L-3345"><a href="#-3345"><span class="linenos">3345</span></a>
</span><span id="L-3346"><a href="#-3346"><span class="linenos">3346</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-3347"><a href="#-3347"><span class="linenos">3347</span></a><span class="sd">    # compute x and y with mean removed</span>
</span><span id="L-3348"><a href="#-3348"><span class="linenos">3348</span></a><span class="sd">    x_zeromean = x * 1.</span>
</span><span id="L-3349"><a href="#-3349"><span class="linenos">3349</span></a><span class="sd">    x_zeromean -= x.mean(axis=axis).reshape(x.shape[0],x.shape[1],1)</span>
</span><span id="L-3350"><a href="#-3350"><span class="linenos">3350</span></a><span class="sd">    y_zeromean = y * 1.</span>
</span><span id="L-3351"><a href="#-3351"><span class="linenos">3351</span></a><span class="sd">    y_zeromean -= y.mean(axis=axis).reshape(y.shape[0],y.shape[1],1)</span>
</span><span id="L-3352"><a href="#-3352"><span class="linenos">3352</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-3353"><a href="#-3353"><span class="linenos">3353</span></a>
</span><span id="L-3354"><a href="#-3354"><span class="linenos">3354</span></a>    <span class="c1"># compute pearsonr</span>
</span><span id="L-3355"><a href="#-3355"><span class="linenos">3355</span></a>    <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="n">y</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">)</span> <span class="o">/</span> <span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">axis</span><span class="p">]</span>
</span><span id="L-3356"><a href="#-3356"><span class="linenos">3356</span></a>    <span class="n">r</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span>
</span><span id="L-3357"><a href="#-3357"><span class="linenos">3357</span></a>        <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">x</span> <span class="o">**</span> <span class="mi">2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">axis</span><span class="p">])</span>
</span><span id="L-3358"><a href="#-3358"><span class="linenos">3358</span></a>        <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">y</span> <span class="o">**</span> <span class="mi">2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">axis</span><span class="p">])</span>
</span><span id="L-3359"><a href="#-3359"><span class="linenos">3359</span></a>    <span class="p">)</span>
</span><span id="L-3360"><a href="#-3360"><span class="linenos">3360</span></a>
</span><span id="L-3361"><a href="#-3361"><span class="linenos">3361</span></a>    <span class="c1"># compute slope</span>
</span><span id="L-3362"><a href="#-3362"><span class="linenos">3362</span></a>    <span class="n">slope</span> <span class="o">=</span> <span class="n">r</span> <span class="o">*</span> <span class="n">y</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">)</span> <span class="o">/</span> <span class="n">x</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">)</span>
</span><span id="L-3363"><a href="#-3363"><span class="linenos">3363</span></a>
</span><span id="L-3364"><a href="#-3364"><span class="linenos">3364</span></a>    <span class="c1"># compute intercept</span>
</span><span id="L-3365"><a href="#-3365"><span class="linenos">3365</span></a>    <span class="n">intercept</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">)</span> <span class="o">-</span> <span class="n">slope</span> <span class="o">*</span> <span class="n">x</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">)</span>
</span><span id="L-3366"><a href="#-3366"><span class="linenos">3366</span></a>
</span><span id="L-3367"><a href="#-3367"><span class="linenos">3367</span></a>    <span class="k">return</span> <span class="n">intercept</span><span class="p">,</span> <span class="n">slope</span><span class="p">,</span> <span class="n">r</span>
</span><span id="L-3368"><a href="#-3368"><span class="linenos">3368</span></a>
</span><span id="L-3369"><a href="#-3369"><span class="linenos">3369</span></a>
</span><span id="L-3370"><a href="#-3370"><span class="linenos">3370</span></a><span class="k">def</span> <span class="nf">compute_ai_gi</span><span class="p">(</span><span class="n">parameters</span><span class="p">,</span> <span class="n">seismic_data</span><span class="p">):</span>
</span><span id="L-3371"><a href="#-3371"><span class="linenos">3371</span></a>    <span class="sd">&quot;&quot;&quot;[summary]</span>
</span><span id="L-3372"><a href="#-3372"><span class="linenos">3372</span></a>
</span><span id="L-3373"><a href="#-3373"><span class="linenos">3373</span></a><span class="sd">    Args:</span>
</span><span id="L-3374"><a href="#-3374"><span class="linenos">3374</span></a><span class="sd">        cfg (Parameter class object): Model Parameters</span>
</span><span id="L-3375"><a href="#-3375"><span class="linenos">3375</span></a><span class="sd">        seismic_data (np.array): Seismic data with shape n * x * y * z,</span>
</span><span id="L-3376"><a href="#-3376"><span class="linenos">3376</span></a><span class="sd">                                 where n is number of angle stacks</span>
</span><span id="L-3377"><a href="#-3377"><span class="linenos">3377</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-3378"><a href="#-3378"><span class="linenos">3378</span></a>    <span class="n">inc_angles</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">parameters</span><span class="o">.</span><span class="n">incident_angles</span><span class="p">)</span>
</span><span id="L-3379"><a href="#-3379"><span class="linenos">3379</span></a>    <span class="n">inc_angles</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">inc_angles</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">180.0</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
</span><span id="L-3380"><a href="#-3380"><span class="linenos">3380</span></a>    <span class="n">inc_angles</span> <span class="o">=</span> <span class="n">inc_angles</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">inc_angles</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-3381"><a href="#-3381"><span class="linenos">3381</span></a>
</span><span id="L-3382"><a href="#-3382"><span class="linenos">3382</span></a>    <span class="n">intercept</span><span class="p">,</span> <span class="n">slope</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">lsq</span><span class="p">(</span><span class="n">inc_angles</span><span class="p">,</span> <span class="n">seismic_data</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-3383"><a href="#-3383"><span class="linenos">3383</span></a>
</span><span id="L-3384"><a href="#-3384"><span class="linenos">3384</span></a>    <span class="n">intercept</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">intercept</span><span class="p">)]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="L-3385"><a href="#-3385"><span class="linenos">3385</span></a>    <span class="n">slope</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">slope</span><span class="p">)]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="L-3386"><a href="#-3386"><span class="linenos">3386</span></a>    <span class="n">intercept</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="n">intercept</span><span class="p">)]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="L-3387"><a href="#-3387"><span class="linenos">3387</span></a>    <span class="n">slope</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="n">slope</span><span class="p">)]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="L-3388"><a href="#-3388"><span class="linenos">3388</span></a>    <span class="k">return</span> <span class="n">intercept</span><span class="p">,</span> <span class="n">slope</span>
</span></pre></div>


            </section>
                <section id="Closures">
                            <input id="Closures-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">Closures</span><wbr>(<span class="base"><a href="Horizons.html#Horizons">datagenerator.Horizons.Horizons</a></span>, <span class="base"><a href="Geomodels.html#Geomodel">datagenerator.Geomodels.Geomodel</a></span>, <span class="base"><a href="Parameters.html#Parameters">datagenerator.Parameters.Parameters</a></span>):

                <label class="view-source-button" for="Closures-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Closures"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Closures-12"><a href="#-12"><span class="linenos">  12</span></a><span class="k">class</span> <span class="nc">Closures</span><span class="p">(</span><span class="n">Horizons</span><span class="p">,</span> <span class="n">Geomodel</span><span class="p">,</span> <span class="n">Parameters</span><span class="p">):</span>
</span><span id="Closures-13"><a href="#-13"><span class="linenos">  13</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parameters</span><span class="p">,</span> <span class="n">faults</span><span class="p">,</span> <span class="n">facies</span><span class="p">,</span> <span class="n">onlap_horizon_list</span><span class="p">):</span>
</span><span id="Closures-14"><a href="#-14"><span class="linenos">  14</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">closure_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
</span><span id="Closures-15"><a href="#-15"><span class="linenos">  15</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span> <span class="o">=</span> <span class="n">parameters</span>
</span><span id="Closures-16"><a href="#-16"><span class="linenos">  16</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">faults</span> <span class="o">=</span> <span class="n">faults</span>
</span><span id="Closures-17"><a href="#-17"><span class="linenos">  17</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">facies</span> <span class="o">=</span> <span class="n">facies</span>
</span><span id="Closures-18"><a href="#-18"><span class="linenos">  18</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">onlap_list</span> <span class="o">=</span> <span class="n">onlap_horizon_list</span>
</span><span id="Closures-19"><a href="#-19"><span class="linenos">  19</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">top_lith_facies</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Closures-20"><a href="#-20"><span class="linenos">  20</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">closure_vol_shape</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">faulted_age_volume</span><span class="o">.</span><span class="n">shape</span>
</span><span id="Closures-21"><a href="#-21"><span class="linenos">  21</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">closure_segments</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="Closures-22"><a href="#-22"><span class="linenos">  22</span></a>            <span class="s2">&quot;closure_segments&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">closure_vol_shape</span>
</span><span id="Closures-23"><a href="#-23"><span class="linenos">  23</span></a>        <span class="p">)</span>
</span><span id="Closures-24"><a href="#-24"><span class="linenos">  24</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">oil_closures</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="Closures-25"><a href="#-25"><span class="linenos">  25</span></a>            <span class="s2">&quot;oil_closures&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">closure_vol_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;uint8&quot;</span>
</span><span id="Closures-26"><a href="#-26"><span class="linenos">  26</span></a>        <span class="p">)</span>
</span><span id="Closures-27"><a href="#-27"><span class="linenos">  27</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gas_closures</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="Closures-28"><a href="#-28"><span class="linenos">  28</span></a>            <span class="s2">&quot;gas_closures&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">closure_vol_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;uint8&quot;</span>
</span><span id="Closures-29"><a href="#-29"><span class="linenos">  29</span></a>        <span class="p">)</span>
</span><span id="Closures-30"><a href="#-30"><span class="linenos">  30</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">brine_closures</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="Closures-31"><a href="#-31"><span class="linenos">  31</span></a>            <span class="s2">&quot;brine_closures&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">closure_vol_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;uint8&quot;</span>
</span><span id="Closures-32"><a href="#-32"><span class="linenos">  32</span></a>        <span class="p">)</span>
</span><span id="Closures-33"><a href="#-33"><span class="linenos">  33</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">simple_closures</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="Closures-34"><a href="#-34"><span class="linenos">  34</span></a>            <span class="s2">&quot;simple_closures&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">closure_vol_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;uint8&quot;</span>
</span><span id="Closures-35"><a href="#-35"><span class="linenos">  35</span></a>        <span class="p">)</span>
</span><span id="Closures-36"><a href="#-36"><span class="linenos">  36</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">strat_closures</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="Closures-37"><a href="#-37"><span class="linenos">  37</span></a>            <span class="s2">&quot;strat_closures&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">closure_vol_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;uint8&quot;</span>
</span><span id="Closures-38"><a href="#-38"><span class="linenos">  38</span></a>        <span class="p">)</span>
</span><span id="Closures-39"><a href="#-39"><span class="linenos">  39</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fault_closures</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="Closures-40"><a href="#-40"><span class="linenos">  40</span></a>            <span class="s2">&quot;fault_closures&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">closure_vol_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;uint8&quot;</span>
</span><span id="Closures-41"><a href="#-41"><span class="linenos">  41</span></a>        <span class="p">)</span>
</span><span id="Closures-42"><a href="#-42"><span class="linenos">  42</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">hc_labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="Closures-43"><a href="#-43"><span class="linenos">  43</span></a>            <span class="s2">&quot;hc_labels&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">closure_vol_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;uint8&quot;</span>
</span><span id="Closures-44"><a href="#-44"><span class="linenos">  44</span></a>        <span class="p">)</span>
</span><span id="Closures-45"><a href="#-45"><span class="linenos">  45</span></a>
</span><span id="Closures-46"><a href="#-46"><span class="linenos">  46</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">all_closure_segments</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="Closures-47"><a href="#-47"><span class="linenos">  47</span></a>            <span class="s2">&quot;all_closure_segments&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">closure_vol_shape</span>
</span><span id="Closures-48"><a href="#-48"><span class="linenos">  48</span></a>        <span class="p">)</span>
</span><span id="Closures-49"><a href="#-49"><span class="linenos">  49</span></a>
</span><span id="Closures-50"><a href="#-50"><span class="linenos">  50</span></a>        <span class="c1"># Class attributes added from Intersect3D</span>
</span><span id="Closures-51"><a href="#-51"><span class="linenos">  51</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">wide_faults</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="Closures-52"><a href="#-52"><span class="linenos">  52</span></a>            <span class="s2">&quot;wide_faults&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">closure_vol_shape</span>
</span><span id="Closures-53"><a href="#-53"><span class="linenos">  53</span></a>        <span class="p">)</span>
</span><span id="Closures-54"><a href="#-54"><span class="linenos">  54</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fat_faults</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span><span class="s2">&quot;fat_faults&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">closure_vol_shape</span><span class="p">)</span>
</span><span id="Closures-55"><a href="#-55"><span class="linenos">  55</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">onlaps_upward</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="Closures-56"><a href="#-56"><span class="linenos">  56</span></a>            <span class="s2">&quot;onlaps_upward&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">closure_vol_shape</span>
</span><span id="Closures-57"><a href="#-57"><span class="linenos">  57</span></a>        <span class="p">)</span>
</span><span id="Closures-58"><a href="#-58"><span class="linenos">  58</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">onlaps_downward</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="Closures-59"><a href="#-59"><span class="linenos">  59</span></a>            <span class="s2">&quot;onlaps_downward&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">closure_vol_shape</span>
</span><span id="Closures-60"><a href="#-60"><span class="linenos">  60</span></a>        <span class="p">)</span>
</span><span id="Closures-61"><a href="#-61"><span class="linenos">  61</span></a>
</span><span id="Closures-62"><a href="#-62"><span class="linenos">  62</span></a>        <span class="c1"># Faulted closures</span>
</span><span id="Closures-63"><a href="#-63"><span class="linenos">  63</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">faulted_closures_oil</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="Closures-64"><a href="#-64"><span class="linenos">  64</span></a>            <span class="s2">&quot;faulted_closures_oil&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">closure_vol_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;uint8&quot;</span>
</span><span id="Closures-65"><a href="#-65"><span class="linenos">  65</span></a>        <span class="p">)</span>
</span><span id="Closures-66"><a href="#-66"><span class="linenos">  66</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">faulted_closures_gas</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="Closures-67"><a href="#-67"><span class="linenos">  67</span></a>            <span class="s2">&quot;faulted_closures_gas&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">closure_vol_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;uint8&quot;</span>
</span><span id="Closures-68"><a href="#-68"><span class="linenos">  68</span></a>        <span class="p">)</span>
</span><span id="Closures-69"><a href="#-69"><span class="linenos">  69</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">faulted_closures_brine</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="Closures-70"><a href="#-70"><span class="linenos">  70</span></a>            <span class="s2">&quot;faulted_closures_brine&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">closure_vol_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;uint8&quot;</span>
</span><span id="Closures-71"><a href="#-71"><span class="linenos">  71</span></a>        <span class="p">)</span>
</span><span id="Closures-72"><a href="#-72"><span class="linenos">  72</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fault_closures_oil_segment_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
</span><span id="Closures-73"><a href="#-73"><span class="linenos">  73</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fault_closures_gas_segment_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
</span><span id="Closures-74"><a href="#-74"><span class="linenos">  74</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fault_closures_brine_segment_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
</span><span id="Closures-75"><a href="#-75"><span class="linenos">  75</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_fault_closures_oil</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Closures-76"><a href="#-76"><span class="linenos">  76</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_fault_closures_gas</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Closures-77"><a href="#-77"><span class="linenos">  77</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_fault_closures_brine</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Closures-78"><a href="#-78"><span class="linenos">  78</span></a>
</span><span id="Closures-79"><a href="#-79"><span class="linenos">  79</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">faulted_all_closures</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="Closures-80"><a href="#-80"><span class="linenos">  80</span></a>            <span class="s2">&quot;faulted_all_closures&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">closure_vol_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;uint8&quot;</span>
</span><span id="Closures-81"><a href="#-81"><span class="linenos">  81</span></a>        <span class="p">)</span>
</span><span id="Closures-82"><a href="#-82"><span class="linenos">  82</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fault_all_closures_segment_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
</span><span id="Closures-83"><a href="#-83"><span class="linenos">  83</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_fault_all_closures</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Closures-84"><a href="#-84"><span class="linenos">  84</span></a>
</span><span id="Closures-85"><a href="#-85"><span class="linenos">  85</span></a>        <span class="c1"># Onlap closures</span>
</span><span id="Closures-86"><a href="#-86"><span class="linenos">  86</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">onlap_closures_oil</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="Closures-87"><a href="#-87"><span class="linenos">  87</span></a>            <span class="s2">&quot;onlap_closures_oil&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">closure_vol_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;uint8&quot;</span>
</span><span id="Closures-88"><a href="#-88"><span class="linenos">  88</span></a>        <span class="p">)</span>
</span><span id="Closures-89"><a href="#-89"><span class="linenos">  89</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">onlap_closures_gas</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="Closures-90"><a href="#-90"><span class="linenos">  90</span></a>            <span class="s2">&quot;onlap_closures_gas&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">closure_vol_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;uint8&quot;</span>
</span><span id="Closures-91"><a href="#-91"><span class="linenos">  91</span></a>        <span class="p">)</span>
</span><span id="Closures-92"><a href="#-92"><span class="linenos">  92</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">onlap_closures_brine</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="Closures-93"><a href="#-93"><span class="linenos">  93</span></a>            <span class="s2">&quot;onlap_closures_brine&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">closure_vol_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;uint8&quot;</span>
</span><span id="Closures-94"><a href="#-94"><span class="linenos">  94</span></a>        <span class="p">)</span>
</span><span id="Closures-95"><a href="#-95"><span class="linenos">  95</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">onlap_closures_oil_segment_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
</span><span id="Closures-96"><a href="#-96"><span class="linenos">  96</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">onlap_closures_gas_segment_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
</span><span id="Closures-97"><a href="#-97"><span class="linenos">  97</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">onlap_closures_brine_segment_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
</span><span id="Closures-98"><a href="#-98"><span class="linenos">  98</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_onlap_closures_oil</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Closures-99"><a href="#-99"><span class="linenos">  99</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_onlap_closures_gas</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Closures-100"><a href="#-100"><span class="linenos"> 100</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_onlap_closures_brine</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Closures-101"><a href="#-101"><span class="linenos"> 101</span></a>
</span><span id="Closures-102"><a href="#-102"><span class="linenos"> 102</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">onlap_all_closures</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="Closures-103"><a href="#-103"><span class="linenos"> 103</span></a>            <span class="s2">&quot;onlap_all_closures&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">closure_vol_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;uint8&quot;</span>
</span><span id="Closures-104"><a href="#-104"><span class="linenos"> 104</span></a>        <span class="p">)</span>
</span><span id="Closures-105"><a href="#-105"><span class="linenos"> 105</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">onlap_all_closures_segment_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
</span><span id="Closures-106"><a href="#-106"><span class="linenos"> 106</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_onlap_all_closures_oil</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Closures-107"><a href="#-107"><span class="linenos"> 107</span></a>
</span><span id="Closures-108"><a href="#-108"><span class="linenos"> 108</span></a>        <span class="c1"># Simple closures</span>
</span><span id="Closures-109"><a href="#-109"><span class="linenos"> 109</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">simple_closures_oil</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="Closures-110"><a href="#-110"><span class="linenos"> 110</span></a>            <span class="s2">&quot;simple_closures_oil&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">closure_vol_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;uint8&quot;</span>
</span><span id="Closures-111"><a href="#-111"><span class="linenos"> 111</span></a>        <span class="p">)</span>
</span><span id="Closures-112"><a href="#-112"><span class="linenos"> 112</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">simple_closures_gas</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="Closures-113"><a href="#-113"><span class="linenos"> 113</span></a>            <span class="s2">&quot;simple_closures_gas&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">closure_vol_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;uint8&quot;</span>
</span><span id="Closures-114"><a href="#-114"><span class="linenos"> 114</span></a>        <span class="p">)</span>
</span><span id="Closures-115"><a href="#-115"><span class="linenos"> 115</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">simple_closures_brine</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="Closures-116"><a href="#-116"><span class="linenos"> 116</span></a>            <span class="s2">&quot;simple_closures_brine&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">closure_vol_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;uint8&quot;</span>
</span><span id="Closures-117"><a href="#-117"><span class="linenos"> 117</span></a>        <span class="p">)</span>
</span><span id="Closures-118"><a href="#-118"><span class="linenos"> 118</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">simple_closures_oil_segment_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
</span><span id="Closures-119"><a href="#-119"><span class="linenos"> 119</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">simple_closures_gas_segment_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
</span><span id="Closures-120"><a href="#-120"><span class="linenos"> 120</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">simple_closures_brine_segment_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
</span><span id="Closures-121"><a href="#-121"><span class="linenos"> 121</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_4way_closures_oil</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Closures-122"><a href="#-122"><span class="linenos"> 122</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_4way_closures_gas</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Closures-123"><a href="#-123"><span class="linenos"> 123</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_4way_closures_brine</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Closures-124"><a href="#-124"><span class="linenos"> 124</span></a>
</span><span id="Closures-125"><a href="#-125"><span class="linenos"> 125</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">simple_all_closures</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="Closures-126"><a href="#-126"><span class="linenos"> 126</span></a>            <span class="s2">&quot;simple_all_closures&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">closure_vol_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;uint8&quot;</span>
</span><span id="Closures-127"><a href="#-127"><span class="linenos"> 127</span></a>        <span class="p">)</span>
</span><span id="Closures-128"><a href="#-128"><span class="linenos"> 128</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">simple_all_closures_segment_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
</span><span id="Closures-129"><a href="#-129"><span class="linenos"> 129</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_4way_all_closures</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Closures-130"><a href="#-130"><span class="linenos"> 130</span></a>
</span><span id="Closures-131"><a href="#-131"><span class="linenos"> 131</span></a>        <span class="c1"># False closures</span>
</span><span id="Closures-132"><a href="#-132"><span class="linenos"> 132</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">false_closures_oil</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="Closures-133"><a href="#-133"><span class="linenos"> 133</span></a>            <span class="s2">&quot;false_closures_oil&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">closure_vol_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;uint8&quot;</span>
</span><span id="Closures-134"><a href="#-134"><span class="linenos"> 134</span></a>        <span class="p">)</span>
</span><span id="Closures-135"><a href="#-135"><span class="linenos"> 135</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">false_closures_gas</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="Closures-136"><a href="#-136"><span class="linenos"> 136</span></a>            <span class="s2">&quot;false_closures_gas&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">closure_vol_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;uint8&quot;</span>
</span><span id="Closures-137"><a href="#-137"><span class="linenos"> 137</span></a>        <span class="p">)</span>
</span><span id="Closures-138"><a href="#-138"><span class="linenos"> 138</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">false_closures_brine</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="Closures-139"><a href="#-139"><span class="linenos"> 139</span></a>            <span class="s2">&quot;false_closures_brine&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">closure_vol_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;uint8&quot;</span>
</span><span id="Closures-140"><a href="#-140"><span class="linenos"> 140</span></a>        <span class="p">)</span>
</span><span id="Closures-141"><a href="#-141"><span class="linenos"> 141</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_false_closures_oil</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Closures-142"><a href="#-142"><span class="linenos"> 142</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_false_closures_gas</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Closures-143"><a href="#-143"><span class="linenos"> 143</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_false_closures_brine</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Closures-144"><a href="#-144"><span class="linenos"> 144</span></a>
</span><span id="Closures-145"><a href="#-145"><span class="linenos"> 145</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">false_all_closures</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="Closures-146"><a href="#-146"><span class="linenos"> 146</span></a>            <span class="s2">&quot;false_all_closures&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">closure_vol_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;uint8&quot;</span>
</span><span id="Closures-147"><a href="#-147"><span class="linenos"> 147</span></a>        <span class="p">)</span>
</span><span id="Closures-148"><a href="#-148"><span class="linenos"> 148</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_false_all_closures</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Closures-149"><a href="#-149"><span class="linenos"> 149</span></a>
</span><span id="Closures-150"><a href="#-150"><span class="linenos"> 150</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">include_salt</span><span class="p">:</span>
</span><span id="Closures-151"><a href="#-151"><span class="linenos"> 151</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">salt_closures</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="Closures-152"><a href="#-152"><span class="linenos"> 152</span></a>                <span class="s2">&quot;salt_closures&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">closure_vol_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;uint8&quot;</span>
</span><span id="Closures-153"><a href="#-153"><span class="linenos"> 153</span></a>            <span class="p">)</span>
</span><span id="Closures-154"><a href="#-154"><span class="linenos"> 154</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">wide_salt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="Closures-155"><a href="#-155"><span class="linenos"> 155</span></a>                <span class="s2">&quot;wide_salt&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">closure_vol_shape</span>
</span><span id="Closures-156"><a href="#-156"><span class="linenos"> 156</span></a>            <span class="p">)</span>
</span><span id="Closures-157"><a href="#-157"><span class="linenos"> 157</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">salt_closures_oil</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="Closures-158"><a href="#-158"><span class="linenos"> 158</span></a>                <span class="s2">&quot;salt_bounded_closures_oil&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">closure_vol_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;uint8&quot;</span>
</span><span id="Closures-159"><a href="#-159"><span class="linenos"> 159</span></a>            <span class="p">)</span>
</span><span id="Closures-160"><a href="#-160"><span class="linenos"> 160</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">salt_closures_gas</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="Closures-161"><a href="#-161"><span class="linenos"> 161</span></a>                <span class="s2">&quot;salt_bounded_closures_gas&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">closure_vol_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;uint8&quot;</span>
</span><span id="Closures-162"><a href="#-162"><span class="linenos"> 162</span></a>            <span class="p">)</span>
</span><span id="Closures-163"><a href="#-163"><span class="linenos"> 163</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">salt_closures_brine</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="Closures-164"><a href="#-164"><span class="linenos"> 164</span></a>                <span class="s2">&quot;salt_bounded_closures_brine&quot;</span><span class="p">,</span>
</span><span id="Closures-165"><a href="#-165"><span class="linenos"> 165</span></a>                <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">closure_vol_shape</span><span class="p">,</span>
</span><span id="Closures-166"><a href="#-166"><span class="linenos"> 166</span></a>                <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;uint8&quot;</span><span class="p">,</span>
</span><span id="Closures-167"><a href="#-167"><span class="linenos"> 167</span></a>            <span class="p">)</span>
</span><span id="Closures-168"><a href="#-168"><span class="linenos"> 168</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">salt_closures_oil_segment_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
</span><span id="Closures-169"><a href="#-169"><span class="linenos"> 169</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">salt_closures_gas_segment_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
</span><span id="Closures-170"><a href="#-170"><span class="linenos"> 170</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">salt_closures_brine_segment_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
</span><span id="Closures-171"><a href="#-171"><span class="linenos"> 171</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">n_salt_closures_oil</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Closures-172"><a href="#-172"><span class="linenos"> 172</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">n_salt_closures_gas</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Closures-173"><a href="#-173"><span class="linenos"> 173</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">n_salt_closures_brine</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Closures-174"><a href="#-174"><span class="linenos"> 174</span></a>
</span><span id="Closures-175"><a href="#-175"><span class="linenos"> 175</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">salt_all_closures</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="Closures-176"><a href="#-176"><span class="linenos"> 176</span></a>                <span class="s2">&quot;salt_bounded_all_closures&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">closure_vol_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;uint8&quot;</span>
</span><span id="Closures-177"><a href="#-177"><span class="linenos"> 177</span></a>            <span class="p">)</span>
</span><span id="Closures-178"><a href="#-178"><span class="linenos"> 178</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">salt_all_closures_segment_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
</span><span id="Closures-179"><a href="#-179"><span class="linenos"> 179</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">n_salt_all_closures</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Closures-180"><a href="#-180"><span class="linenos"> 180</span></a>
</span><span id="Closures-181"><a href="#-181"><span class="linenos"> 181</span></a>    <span class="k">def</span> <span class="nf">create_closure_labels_from_depth_maps</span><span class="p">(</span>
</span><span id="Closures-182"><a href="#-182"><span class="linenos"> 182</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">depth_maps</span><span class="p">,</span> <span class="n">depth_maps_infilled</span><span class="p">,</span> <span class="n">max_col_height</span>
</span><span id="Closures-183"><a href="#-183"><span class="linenos"> 183</span></a>    <span class="p">):</span>
</span><span id="Closures-184"><a href="#-184"><span class="linenos"> 184</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Closures-185"><a href="#-185"><span class="linenos"> 185</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\t</span><span class="s2">... inside insertClosureLabels3D &quot;</span><span class="p">)</span>
</span><span id="Closures-186"><a href="#-186"><span class="linenos"> 186</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="Closures-187"><a href="#-187"><span class="linenos"> 187</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">... depth_maps min </span><span class="si">{</span><span class="n">depth_maps</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, mean </span><span class="si">{</span><span class="n">depth_maps</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">,&quot;</span>
</span><span id="Closures-188"><a href="#-188"><span class="linenos"> 188</span></a>                <span class="sa">f</span><span class="s2">&quot; max </span><span class="si">{</span><span class="n">depth_maps</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, cube_shape </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Closures-189"><a href="#-189"><span class="linenos"> 189</span></a>            <span class="p">)</span>
</span><span id="Closures-190"><a href="#-190"><span class="linenos"> 190</span></a>
</span><span id="Closures-191"><a href="#-191"><span class="linenos"> 191</span></a>        <span class="c1"># create 3D cube to hold segmentation results</span>
</span><span id="Closures-192"><a href="#-192"><span class="linenos"> 192</span></a>        <span class="n">closure_segments</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">faulted_lithology</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="s2">&quot;float32&quot;</span><span class="p">)</span>
</span><span id="Closures-193"><a href="#-193"><span class="linenos"> 193</span></a>
</span><span id="Closures-194"><a href="#-194"><span class="linenos"> 194</span></a>        <span class="c1"># create grids with grid indices</span>
</span><span id="Closures-195"><a href="#-195"><span class="linenos"> 195</span></a>        <span class="n">ii</span><span class="p">,</span> <span class="n">jj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">build_meshgrid</span><span class="p">()</span>
</span><span id="Closures-196"><a href="#-196"><span class="linenos"> 196</span></a>
</span><span id="Closures-197"><a href="#-197"><span class="linenos"> 197</span></a>        <span class="c1"># loop through horizons in &#39;depth_maps&#39;</span>
</span><span id="Closures-198"><a href="#-198"><span class="linenos"> 198</span></a>        <span class="n">voxel_change_count</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
</span><span id="Closures-199"><a href="#-199"><span class="linenos"> 199</span></a>        <span class="n">layers_with_closure</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Closures-200"><a href="#-200"><span class="linenos"> 200</span></a>
</span><span id="Closures-201"><a href="#-201"><span class="linenos"> 201</span></a>        <span class="n">avg_sand_thickness</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
</span><span id="Closures-202"><a href="#-202"><span class="linenos"> 202</span></a>        <span class="n">avg_shale_thickness</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
</span><span id="Closures-203"><a href="#-203"><span class="linenos"> 203</span></a>        <span class="n">avg_unit_thickness</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
</span><span id="Closures-204"><a href="#-204"><span class="linenos"> 204</span></a>        <span class="k">for</span> <span class="n">ihorizon</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">depth_maps</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="Closures-205"><a href="#-205"><span class="linenos"> 205</span></a>            <span class="n">avg_unit_thickness</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="Closures-206"><a href="#-206"><span class="linenos"> 206</span></a>                <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span>
</span><span id="Closures-207"><a href="#-207"><span class="linenos"> 207</span></a>                    <span class="n">depth_maps_infilled</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">ihorizon</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="Closures-208"><a href="#-208"><span class="linenos"> 208</span></a>                    <span class="o">-</span> <span class="n">depth_maps_infilled</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">ihorizon</span><span class="p">]</span>
</span><span id="Closures-209"><a href="#-209"><span class="linenos"> 209</span></a>                <span class="p">)</span>
</span><span id="Closures-210"><a href="#-210"><span class="linenos"> 210</span></a>            <span class="p">)</span>
</span><span id="Closures-211"><a href="#-211"><span class="linenos"> 211</span></a>
</span><span id="Closures-212"><a href="#-212"><span class="linenos"> 212</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">top_lith_facies</span><span class="p">[</span><span class="n">ihorizon</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Closures-213"><a href="#-213"><span class="linenos"> 213</span></a>                <span class="c1"># If facies is not shale, calculate a closure map for the layer</span>
</span><span id="Closures-214"><a href="#-214"><span class="linenos"> 214</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Closures-215"><a href="#-215"><span class="linenos"> 215</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="Closures-216"><a href="#-216"><span class="linenos"> 216</span></a>                        <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">...closure voxels computation for layer </span><span class="si">{</span><span class="n">ihorizon</span><span class="si">}</span><span class="s2"> in horizon list.&quot;</span>
</span><span id="Closures-217"><a href="#-217"><span class="linenos"> 217</span></a>                    <span class="p">)</span>
</span><span id="Closures-218"><a href="#-218"><span class="linenos"> 218</span></a>                <span class="n">avg_sand_thickness</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="Closures-219"><a href="#-219"><span class="linenos"> 219</span></a>                    <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span>
</span><span id="Closures-220"><a href="#-220"><span class="linenos"> 220</span></a>                        <span class="n">depth_maps_infilled</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">ihorizon</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="Closures-221"><a href="#-221"><span class="linenos"> 221</span></a>                        <span class="o">-</span> <span class="n">depth_maps_infilled</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">ihorizon</span><span class="p">]</span>
</span><span id="Closures-222"><a href="#-222"><span class="linenos"> 222</span></a>                    <span class="p">)</span>
</span><span id="Closures-223"><a href="#-223"><span class="linenos"> 223</span></a>                <span class="p">)</span>
</span><span id="Closures-224"><a href="#-224"><span class="linenos"> 224</span></a>                <span class="c1"># compute a closure map</span>
</span><span id="Closures-225"><a href="#-225"><span class="linenos"> 225</span></a>                <span class="c1"># - identical to top structure map when not in closure, &#39;max flooding&#39; depth when in closure</span>
</span><span id="Closures-226"><a href="#-226"><span class="linenos"> 226</span></a>                <span class="c1"># - use thicknesses converted to samples instead of ft or ms</span>
</span><span id="Closures-227"><a href="#-227"><span class="linenos"> 227</span></a>                <span class="c1"># - assumes that fault intersections are inserted in input map with value of 0.</span>
</span><span id="Closures-228"><a href="#-228"><span class="linenos"> 228</span></a>                <span class="c1"># - assumes that input map values represent depth (i.e., bigger values are deeper)</span>
</span><span id="Closures-229"><a href="#-229"><span class="linenos"> 229</span></a>                <span class="n">top_structure_depth_map</span> <span class="o">=</span> <span class="n">depth_maps</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">ihorizon</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Closures-230"><a href="#-230"><span class="linenos"> 230</span></a>                <span class="n">top_structure_depth_map</span><span class="p">[</span>
</span><span id="Closures-231"><a href="#-231"><span class="linenos"> 231</span></a>                    <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">top_structure_depth_map</span><span class="p">)</span>
</span><span id="Closures-232"><a href="#-232"><span class="linenos"> 232</span></a>                <span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>  <span class="c1"># replace nans with 0.</span>
</span><span id="Closures-233"><a href="#-233"><span class="linenos"> 233</span></a>                <span class="n">top_structure_depth_map</span> <span class="o">/=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">digi</span><span class="p">)</span>
</span><span id="Closures-234"><a href="#-234"><span class="linenos"> 234</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">partial_voxels</span><span class="p">:</span>
</span><span id="Closures-235"><a href="#-235"><span class="linenos"> 235</span></a>                    <span class="n">top_structure_depth_map</span> <span class="o">-=</span> <span class="p">(</span>
</span><span id="Closures-236"><a href="#-236"><span class="linenos"> 236</span></a>                        <span class="mf">1.0</span>  <span class="c1"># account for voxels partially in layer</span>
</span><span id="Closures-237"><a href="#-237"><span class="linenos"> 237</span></a>                    <span class="p">)</span>
</span><span id="Closures-238"><a href="#-238"><span class="linenos"> 238</span></a>                <span class="n">base_structure_depth_map</span> <span class="o">=</span> <span class="n">depth_maps_infilled</span><span class="p">[</span>
</span><span id="Closures-239"><a href="#-239"><span class="linenos"> 239</span></a>                    <span class="p">:,</span> <span class="p">:,</span> <span class="n">ihorizon</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="Closures-240"><a href="#-240"><span class="linenos"> 240</span></a>                <span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Closures-241"><a href="#-241"><span class="linenos"> 241</span></a>                <span class="n">base_structure_depth_map</span><span class="p">[</span>
</span><span id="Closures-242"><a href="#-242"><span class="linenos"> 242</span></a>                    <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">top_structure_depth_map</span><span class="p">)</span>
</span><span id="Closures-243"><a href="#-243"><span class="linenos"> 243</span></a>                <span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>  <span class="c1"># replace nans with 0.</span>
</span><span id="Closures-244"><a href="#-244"><span class="linenos"> 244</span></a>                <span class="n">base_structure_depth_map</span> <span class="o">/=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">digi</span><span class="p">)</span>
</span><span id="Closures-245"><a href="#-245"><span class="linenos"> 245</span></a>                <span class="nb">print</span><span class="p">(</span>
</span><span id="Closures-246"><a href="#-246"><span class="linenos"> 246</span></a>                    <span class="s2">&quot; ...inside create_closure_labels_from_depth_maps... ihorizon, self.top_lith_facies[ihorizon] = &quot;</span><span class="p">,</span>
</span><span id="Closures-247"><a href="#-247"><span class="linenos"> 247</span></a>                    <span class="n">ihorizon</span><span class="p">,</span>
</span><span id="Closures-248"><a href="#-248"><span class="linenos"> 248</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">top_lith_facies</span><span class="p">[</span><span class="n">ihorizon</span><span class="p">],</span>
</span><span id="Closures-249"><a href="#-249"><span class="linenos"> 249</span></a>                <span class="p">)</span>
</span><span id="Closures-250"><a href="#-250"><span class="linenos"> 250</span></a>                <span class="c1"># if there is non-zero thickness between top/base closure</span>
</span><span id="Closures-251"><a href="#-251"><span class="linenos"> 251</span></a>                <span class="k">if</span> <span class="n">top_structure_depth_map</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">!=</span> <span class="n">top_structure_depth_map</span><span class="o">.</span><span class="n">max</span><span class="p">():</span>
</span><span id="Closures-252"><a href="#-252"><span class="linenos"> 252</span></a>                    <span class="n">max_column</span> <span class="o">=</span> <span class="n">max_col_height</span><span class="p">[</span><span class="n">ihorizon</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">digi</span>
</span><span id="Closures-253"><a href="#-253"><span class="linenos"> 253</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Closures-254"><a href="#-254"><span class="linenos"> 254</span></a>                        <span class="nb">print</span><span class="p">(</span>
</span><span id="Closures-255"><a href="#-255"><span class="linenos"> 255</span></a>                            <span class="sa">f</span><span class="s2">&quot;   ...avg depth for layer </span><span class="si">{</span><span class="n">ihorizon</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">,</span>
</span><span id="Closures-256"><a href="#-256"><span class="linenos"> 256</span></a>                            <span class="n">top_structure_depth_map</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span>
</span><span id="Closures-257"><a href="#-257"><span class="linenos"> 257</span></a>                        <span class="p">)</span>
</span><span id="Closures-258"><a href="#-258"><span class="linenos"> 258</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Closures-259"><a href="#-259"><span class="linenos"> 259</span></a>                        <span class="nb">print</span><span class="p">(</span>
</span><span id="Closures-260"><a href="#-260"><span class="linenos"> 260</span></a>                            <span class="sa">f</span><span class="s2">&quot;   ...maximum column height for layer </span><span class="si">{</span><span class="n">ihorizon</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">,</span>
</span><span id="Closures-261"><a href="#-261"><span class="linenos"> 261</span></a>                            <span class="n">max_column</span><span class="p">,</span>
</span><span id="Closures-262"><a href="#-262"><span class="linenos"> 262</span></a>                        <span class="p">)</span>
</span><span id="Closures-263"><a href="#-263"><span class="linenos"> 263</span></a>
</span><span id="Closures-264"><a href="#-264"><span class="linenos"> 264</span></a>                    <span class="k">if</span> <span class="n">ihorizon</span> <span class="o">==</span> <span class="mi">27000</span> <span class="ow">or</span> <span class="n">ihorizon</span> <span class="o">==</span> <span class="mi">1000</span><span class="p">:</span>
</span><span id="Closures-265"><a href="#-265"><span class="linenos"> 265</span></a>                        <span class="n">closure_depth_map</span> <span class="o">=</span> <span class="n">_flood_fill</span><span class="p">(</span>
</span><span id="Closures-266"><a href="#-266"><span class="linenos"> 266</span></a>                            <span class="n">top_structure_depth_map</span><span class="p">,</span>
</span><span id="Closures-267"><a href="#-267"><span class="linenos"> 267</span></a>                            <span class="n">max_column_height</span><span class="o">=</span><span class="n">max_column</span><span class="p">,</span>
</span><span id="Closures-268"><a href="#-268"><span class="linenos"> 268</span></a>                            <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="Closures-269"><a href="#-269"><span class="linenos"> 269</span></a>                            <span class="n">debug</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="Closures-270"><a href="#-270"><span class="linenos"> 270</span></a>                        <span class="p">)</span>
</span><span id="Closures-271"><a href="#-271"><span class="linenos"> 271</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="Closures-272"><a href="#-272"><span class="linenos"> 272</span></a>                        <span class="n">closure_depth_map</span> <span class="o">=</span> <span class="n">_flood_fill</span><span class="p">(</span>
</span><span id="Closures-273"><a href="#-273"><span class="linenos"> 273</span></a>                            <span class="n">top_structure_depth_map</span><span class="p">,</span> <span class="n">max_column_height</span><span class="o">=</span><span class="n">max_column</span>
</span><span id="Closures-274"><a href="#-274"><span class="linenos"> 274</span></a>                        <span class="p">)</span>
</span><span id="Closures-275"><a href="#-275"><span class="linenos"> 275</span></a>                    <span class="n">closure_depth_map</span><span class="p">[</span><span class="n">closure_depth_map</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">top_structure_depth_map</span><span class="p">[</span>
</span><span id="Closures-276"><a href="#-276"><span class="linenos"> 276</span></a>                        <span class="n">closure_depth_map</span> <span class="o">==</span> <span class="mi">0</span>
</span><span id="Closures-277"><a href="#-277"><span class="linenos"> 277</span></a>                    <span class="p">]</span>
</span><span id="Closures-278"><a href="#-278"><span class="linenos"> 278</span></a>                    <span class="n">closure_depth_map</span><span class="p">[</span><span class="n">closure_depth_map</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">top_structure_depth_map</span><span class="p">[</span>
</span><span id="Closures-279"><a href="#-279"><span class="linenos"> 279</span></a>                        <span class="n">closure_depth_map</span> <span class="o">==</span> <span class="mi">1</span>
</span><span id="Closures-280"><a href="#-280"><span class="linenos"> 280</span></a>                    <span class="p">]</span>
</span><span id="Closures-281"><a href="#-281"><span class="linenos"> 281</span></a>                    <span class="n">closure_depth_map</span><span class="p">[</span>
</span><span id="Closures-282"><a href="#-282"><span class="linenos"> 282</span></a>                        <span class="n">closure_depth_map</span> <span class="o">==</span> <span class="mf">1e5</span>
</span><span id="Closures-283"><a href="#-283"><span class="linenos"> 283</span></a>                    <span class="p">]</span> <span class="o">=</span> <span class="n">top_structure_depth_map</span><span class="p">[</span><span class="n">closure_depth_map</span> <span class="o">==</span> <span class="mf">1e5</span><span class="p">]</span>
</span><span id="Closures-284"><a href="#-284"><span class="linenos"> 284</span></a>                    <span class="c1"># Select the maximum value between the top sand map and the flood-filled closure map</span>
</span><span id="Closures-285"><a href="#-285"><span class="linenos"> 285</span></a>                    <span class="n">closure_depth_map</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span>
</span><span id="Closures-286"><a href="#-286"><span class="linenos"> 286</span></a>                        <span class="n">np</span><span class="o">.</span><span class="n">dstack</span><span class="p">((</span><span class="n">closure_depth_map</span><span class="p">,</span> <span class="n">top_structure_depth_map</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span>
</span><span id="Closures-287"><a href="#-287"><span class="linenos"> 287</span></a>                    <span class="p">)</span>
</span><span id="Closures-288"><a href="#-288"><span class="linenos"> 288</span></a>                    <span class="n">closure_depth_map</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span>
</span><span id="Closures-289"><a href="#-289"><span class="linenos"> 289</span></a>                        <span class="n">np</span><span class="o">.</span><span class="n">dstack</span><span class="p">((</span><span class="n">closure_depth_map</span><span class="p">,</span> <span class="n">base_structure_depth_map</span><span class="p">)),</span>
</span><span id="Closures-290"><a href="#-290"><span class="linenos"> 290</span></a>                        <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
</span><span id="Closures-291"><a href="#-291"><span class="linenos"> 291</span></a>                    <span class="p">)</span>
</span><span id="Closures-292"><a href="#-292"><span class="linenos"> 292</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Closures-293"><a href="#-293"><span class="linenos"> 293</span></a>                        <span class="nb">print</span><span class="p">(</span>
</span><span id="Closures-294"><a href="#-294"><span class="linenos"> 294</span></a>                            <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">    ... layer </span><span class="si">{</span><span class="n">ihorizon</span><span class="si">}</span><span class="s2">,&quot;</span>
</span><span id="Closures-295"><a href="#-295"><span class="linenos"> 295</span></a>                            <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n\t</span><span class="s2">top structure map min, max </span><span class="si">{</span><span class="n">top_structure_depth_map</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">,&quot;</span>
</span><span id="Closures-296"><a href="#-296"><span class="linenos"> 296</span></a>                            <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">top_structure_depth_map</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="se">\n\t</span><span class="s2">closure_depth_map min, max&quot;</span>
</span><span id="Closures-297"><a href="#-297"><span class="linenos"> 297</span></a>                            <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">closure_depth_map</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">closure_depth_map</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Closures-298"><a href="#-298"><span class="linenos"> 298</span></a>                        <span class="p">)</span>
</span><span id="Closures-299"><a href="#-299"><span class="linenos"> 299</span></a>                    <span class="n">closure_thickness</span> <span class="o">=</span> <span class="n">closure_depth_map</span> <span class="o">-</span> <span class="n">top_structure_depth_map</span>
</span><span id="Closures-300"><a href="#-300"><span class="linenos"> 300</span></a>                    <span class="n">closure_thickness_no_nan</span> <span class="o">=</span> <span class="n">closure_thickness</span><span class="p">[</span>
</span><span id="Closures-301"><a href="#-301"><span class="linenos"> 301</span></a>                        <span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">closure_thickness</span><span class="p">)</span>
</span><span id="Closures-302"><a href="#-302"><span class="linenos"> 302</span></a>                    <span class="p">]</span>
</span><span id="Closures-303"><a href="#-303"><span class="linenos"> 303</span></a>                    <span class="n">max_closure</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">closure_thickness_no_nan</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="mi">0</span><span class="p">))</span>
</span><span id="Closures-304"><a href="#-304"><span class="linenos"> 304</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Closures-305"><a href="#-305"><span class="linenos"> 305</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    ... layer </span><span class="si">{</span><span class="n">ihorizon</span><span class="si">}</span><span class="s2">, max_closure </span><span class="si">{</span><span class="n">max_closure</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Closures-306"><a href="#-306"><span class="linenos"> 306</span></a>
</span><span id="Closures-307"><a href="#-307"><span class="linenos"> 307</span></a>                    <span class="c1"># locate 3D zone in closure after checking that closures exist for this horizon</span>
</span><span id="Closures-308"><a href="#-308"><span class="linenos"> 308</span></a>                    <span class="c1"># if False in (top_structure_depth_map == closure_depth_map):</span>
</span><span id="Closures-309"><a href="#-309"><span class="linenos"> 309</span></a>                    <span class="k">if</span> <span class="n">max_closure</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Closures-310"><a href="#-310"><span class="linenos"> 310</span></a>                        <span class="c1"># locate voxels anywhere in layer where top_structure_depth_map &lt; closure_depth_map</span>
</span><span id="Closures-311"><a href="#-311"><span class="linenos"> 311</span></a>                        <span class="c1"># put label in cube between top_structure_depth_map and closure_depth_map</span>
</span><span id="Closures-312"><a href="#-312"><span class="linenos"> 312</span></a>                        <span class="n">top_structure_depth_map_integer</span> <span class="o">=</span> <span class="n">top_structure_depth_map</span>
</span><span id="Closures-313"><a href="#-313"><span class="linenos"> 313</span></a>                        <span class="n">closure_depth_map_integer</span> <span class="o">=</span> <span class="n">closure_depth_map</span>
</span><span id="Closures-314"><a href="#-314"><span class="linenos"> 314</span></a>
</span><span id="Closures-315"><a href="#-315"><span class="linenos"> 315</span></a>                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Closures-316"><a href="#-316"><span class="linenos"> 316</span></a>                            <span class="n">closure_map_min</span> <span class="o">=</span> <span class="n">closure_depth_map_integer</span><span class="p">[</span>
</span><span id="Closures-317"><a href="#-317"><span class="linenos"> 317</span></a>                                <span class="n">closure_depth_map_integer</span> <span class="o">&gt;</span> <span class="mf">0.1</span>
</span><span id="Closures-318"><a href="#-318"><span class="linenos"> 318</span></a>                            <span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
</span><span id="Closures-319"><a href="#-319"><span class="linenos"> 319</span></a>                            <span class="n">closure_map_max</span> <span class="o">=</span> <span class="n">closure_depth_map_integer</span><span class="p">[</span>
</span><span id="Closures-320"><a href="#-320"><span class="linenos"> 320</span></a>                                <span class="n">closure_depth_map_integer</span> <span class="o">&gt;</span> <span class="mf">0.1</span>
</span><span id="Closures-321"><a href="#-321"><span class="linenos"> 321</span></a>                            <span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</span><span id="Closures-322"><a href="#-322"><span class="linenos"> 322</span></a>                            <span class="nb">print</span><span class="p">(</span>
</span><span id="Closures-323"><a href="#-323"><span class="linenos"> 323</span></a>                                <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">... (2) layer: </span><span class="si">{</span><span class="n">ihorizon</span><span class="si">}</span><span class="s2">, max_closure; </span><span class="si">{</span><span class="n">max_closure</span><span class="si">}</span><span class="s2">, top structure map min, &quot;</span>
</span><span id="Closures-324"><a href="#-324"><span class="linenos"> 324</span></a>                                <span class="sa">f</span><span class="s2">&quot;max: </span><span class="si">{</span><span class="n">top_structure_depth_map</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">top_structure_depth_map_integer</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">}</span><span class="s2">,&quot;</span>
</span><span id="Closures-325"><a href="#-325"><span class="linenos"> 325</span></a>                                <span class="sa">f</span><span class="s2">&quot; closure map min, max: </span><span class="si">{</span><span class="n">closure_map_min</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">closure_map_max</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Closures-326"><a href="#-326"><span class="linenos"> 326</span></a>                            <span class="p">)</span>
</span><span id="Closures-327"><a href="#-327"><span class="linenos"> 327</span></a>
</span><span id="Closures-328"><a href="#-328"><span class="linenos"> 328</span></a>                        <span class="n">slices_with_substitution</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Closures-329"><a href="#-329"><span class="linenos"> 329</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    ... max_closure: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">max_closure</span><span class="p">))</span>
</span><span id="Closures-330"><a href="#-330"><span class="linenos"> 330</span></a>                        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span>
</span><span id="Closures-331"><a href="#-331"><span class="linenos"> 331</span></a>                            <span class="n">max_closure</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="Closures-332"><a href="#-332"><span class="linenos"> 332</span></a>                        <span class="p">):</span>  <span class="c1"># add one more sample than seemingly needed for round-off</span>
</span><span id="Closures-333"><a href="#-333"><span class="linenos"> 333</span></a>                            <span class="c1"># Subtract 2 from the closure cube shape since adding one later</span>
</span><span id="Closures-334"><a href="#-334"><span class="linenos"> 334</span></a>                            <span class="n">horizon_slice</span> <span class="o">=</span> <span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="n">top_structure_depth_map</span><span class="p">)</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span>
</span><span id="Closures-335"><a href="#-335"><span class="linenos"> 335</span></a>                                <span class="mi">0</span><span class="p">,</span> <span class="n">closure_segments</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="mi">2</span>
</span><span id="Closures-336"><a href="#-336"><span class="linenos"> 336</span></a>                            <span class="p">)</span>
</span><span id="Closures-337"><a href="#-337"><span class="linenos"> 337</span></a>                            <span class="n">sublayer_kk</span> <span class="o">=</span> <span class="n">horizon_slice</span><span class="p">[</span>
</span><span id="Closures-338"><a href="#-338"><span class="linenos"> 338</span></a>                                <span class="n">horizon_slice</span> <span class="o">&lt;</span> <span class="n">closure_depth_map</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;int&quot;</span><span class="p">)</span>
</span><span id="Closures-339"><a href="#-339"><span class="linenos"> 339</span></a>                            <span class="p">]</span>
</span><span id="Closures-340"><a href="#-340"><span class="linenos"> 340</span></a>                            <span class="n">sublayer_ii</span> <span class="o">=</span> <span class="n">ii</span><span class="p">[</span>
</span><span id="Closures-341"><a href="#-341"><span class="linenos"> 341</span></a>                                <span class="n">horizon_slice</span> <span class="o">&lt;</span> <span class="n">closure_depth_map</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;int&quot;</span><span class="p">)</span>
</span><span id="Closures-342"><a href="#-342"><span class="linenos"> 342</span></a>                            <span class="p">]</span>
</span><span id="Closures-343"><a href="#-343"><span class="linenos"> 343</span></a>                            <span class="n">sublayer_jj</span> <span class="o">=</span> <span class="n">jj</span><span class="p">[</span>
</span><span id="Closures-344"><a href="#-344"><span class="linenos"> 344</span></a>                                <span class="n">horizon_slice</span> <span class="o">&lt;</span> <span class="n">closure_depth_map</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;int&quot;</span><span class="p">)</span>
</span><span id="Closures-345"><a href="#-345"><span class="linenos"> 345</span></a>                            <span class="p">]</span>
</span><span id="Closures-346"><a href="#-346"><span class="linenos"> 346</span></a>
</span><span id="Closures-347"><a href="#-347"><span class="linenos"> 347</span></a>                            <span class="k">if</span> <span class="n">sublayer_ii</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Closures-348"><a href="#-348"><span class="linenos"> 348</span></a>                                <span class="n">slices_with_substitution</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="Closures-349"><a href="#-349"><span class="linenos"> 349</span></a>
</span><span id="Closures-350"><a href="#-350"><span class="linenos"> 350</span></a>                                <span class="n">i_indices</span> <span class="o">=</span> <span class="n">sublayer_ii</span>
</span><span id="Closures-351"><a href="#-351"><span class="linenos"> 351</span></a>                                <span class="n">j_indices</span> <span class="o">=</span> <span class="n">sublayer_jj</span>
</span><span id="Closures-352"><a href="#-352"><span class="linenos"> 352</span></a>                                <span class="n">k_indices</span> <span class="o">=</span> <span class="n">sublayer_kk</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="Closures-353"><a href="#-353"><span class="linenos"> 353</span></a>
</span><span id="Closures-354"><a href="#-354"><span class="linenos"> 354</span></a>                                <span class="k">try</span><span class="p">:</span>
</span><span id="Closures-355"><a href="#-355"><span class="linenos"> 355</span></a>                                    <span class="n">closure_segments</span><span class="p">[</span>
</span><span id="Closures-356"><a href="#-356"><span class="linenos"> 356</span></a>                                        <span class="n">i_indices</span><span class="p">,</span> <span class="n">j_indices</span><span class="p">,</span> <span class="n">k_indices</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;int&quot;</span><span class="p">)</span>
</span><span id="Closures-357"><a href="#-357"><span class="linenos"> 357</span></a>                                    <span class="p">]</span> <span class="o">+=</span> <span class="mf">1.0</span>
</span><span id="Closures-358"><a href="#-358"><span class="linenos"> 358</span></a>                                    <span class="n">voxel_change_count</span><span class="p">[</span>
</span><span id="Closures-359"><a href="#-359"><span class="linenos"> 359</span></a>                                        <span class="n">i_indices</span><span class="p">,</span> <span class="n">j_indices</span><span class="p">,</span> <span class="n">k_indices</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;int&quot;</span><span class="p">)</span>
</span><span id="Closures-360"><a href="#-360"><span class="linenos"> 360</span></a>                                    <span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="Closures-361"><a href="#-361"><span class="linenos"> 361</span></a>                                <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
</span><span id="Closures-362"><a href="#-362"><span class="linenos"> 362</span></a>                                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Index is out of bounds.&quot;</span><span class="p">)</span>
</span><span id="Closures-363"><a href="#-363"><span class="linenos"> 363</span></a>                                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">closure_segments: </span><span class="si">{</span><span class="n">closure_segments</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Closures-364"><a href="#-364"><span class="linenos"> 364</span></a>                                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">voxel_change_count: </span><span class="si">{</span><span class="n">voxel_change_count</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Closures-365"><a href="#-365"><span class="linenos"> 365</span></a>                                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">i_indices: </span><span class="si">{</span><span class="n">i_indices</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Closures-366"><a href="#-366"><span class="linenos"> 366</span></a>                                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">j_indices: </span><span class="si">{</span><span class="n">j_indices</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Closures-367"><a href="#-367"><span class="linenos"> 367</span></a>                                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">k_indices: </span><span class="si">{</span><span class="n">k_indices</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;int&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Closures-368"><a href="#-368"><span class="linenos"> 368</span></a>                                    <span class="k">pass</span>
</span><span id="Closures-369"><a href="#-369"><span class="linenos"> 369</span></a>
</span><span id="Closures-370"><a href="#-370"><span class="linenos"> 370</span></a>                        <span class="k">if</span> <span class="n">slices_with_substitution</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Closures-371"><a href="#-371"><span class="linenos"> 371</span></a>                            <span class="n">layers_with_closure</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="Closures-372"><a href="#-372"><span class="linenos"> 372</span></a>
</span><span id="Closures-373"><a href="#-373"><span class="linenos"> 373</span></a>                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Closures-374"><a href="#-374"><span class="linenos"> 374</span></a>                            <span class="nb">print</span><span class="p">(</span>
</span><span id="Closures-375"><a href="#-375"><span class="linenos"> 375</span></a>                                <span class="s2">&quot;    ... finished putting closures in closures_segments for layer ...&quot;</span><span class="p">,</span>
</span><span id="Closures-376"><a href="#-376"><span class="linenos"> 376</span></a>                                <span class="n">ihorizon</span><span class="p">,</span>
</span><span id="Closures-377"><a href="#-377"><span class="linenos"> 377</span></a>                            <span class="p">)</span>
</span><span id="Closures-378"><a href="#-378"><span class="linenos"> 378</span></a>
</span><span id="Closures-379"><a href="#-379"><span class="linenos"> 379</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="Closures-380"><a href="#-380"><span class="linenos"> 380</span></a>                        <span class="k">continue</span>
</span><span id="Closures-381"><a href="#-381"><span class="linenos"> 381</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Closures-382"><a href="#-382"><span class="linenos"> 382</span></a>                <span class="c1"># Calculate shale unit thicknesses</span>
</span><span id="Closures-383"><a href="#-383"><span class="linenos"> 383</span></a>                <span class="n">avg_shale_thickness</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="Closures-384"><a href="#-384"><span class="linenos"> 384</span></a>                    <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span>
</span><span id="Closures-385"><a href="#-385"><span class="linenos"> 385</span></a>                        <span class="n">depth_maps_infilled</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">ihorizon</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="Closures-386"><a href="#-386"><span class="linenos"> 386</span></a>                        <span class="o">-</span> <span class="n">depth_maps_infilled</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">ihorizon</span><span class="p">]</span>
</span><span id="Closures-387"><a href="#-387"><span class="linenos"> 387</span></a>                    <span class="p">)</span>
</span><span id="Closures-388"><a href="#-388"><span class="linenos"> 388</span></a>                <span class="p">)</span>
</span><span id="Closures-389"><a href="#-389"><span class="linenos"> 389</span></a>
</span><span id="Closures-390"><a href="#-390"><span class="linenos"> 390</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">avg_sand_thickness</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Closures-391"><a href="#-391"><span class="linenos"> 391</span></a>            <span class="n">avg_sand_thickness</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Closures-392"><a href="#-392"><span class="linenos"> 392</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="Closures-393"><a href="#-393"><span class="linenos"> 393</span></a>            <span class="sa">f</span><span class="s2">&quot;Sand Unit Thickness (m): mean: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">avg_sand_thickness</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, &quot;</span>
</span><span id="Closures-394"><a href="#-394"><span class="linenos"> 394</span></a>            <span class="sa">f</span><span class="s2">&quot;std: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">avg_sand_thickness</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, min: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">avg_sand_thickness</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, &quot;</span>
</span><span id="Closures-395"><a href="#-395"><span class="linenos"> 395</span></a>            <span class="sa">f</span><span class="s2">&quot;max: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">avg_sand_thickness</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Closures-396"><a href="#-396"><span class="linenos"> 396</span></a>        <span class="p">)</span>
</span><span id="Closures-397"><a href="#-397"><span class="linenos"> 397</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="Closures-398"><a href="#-398"><span class="linenos"> 398</span></a>            <span class="sa">f</span><span class="s2">&quot;Shale Unit Thickness (m): mean: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">avg_shale_thickness</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, &quot;</span>
</span><span id="Closures-399"><a href="#-399"><span class="linenos"> 399</span></a>            <span class="sa">f</span><span class="s2">&quot;std: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">avg_shale_thickness</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, min: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">avg_shale_thickness</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, &quot;</span>
</span><span id="Closures-400"><a href="#-400"><span class="linenos"> 400</span></a>            <span class="sa">f</span><span class="s2">&quot;max: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">avg_shale_thickness</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Closures-401"><a href="#-401"><span class="linenos"> 401</span></a>        <span class="p">)</span>
</span><span id="Closures-402"><a href="#-402"><span class="linenos"> 402</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="Closures-403"><a href="#-403"><span class="linenos"> 403</span></a>            <span class="sa">f</span><span class="s2">&quot;Overall Unit Thickness (m): mean: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">avg_unit_thickness</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, &quot;</span>
</span><span id="Closures-404"><a href="#-404"><span class="linenos"> 404</span></a>            <span class="sa">f</span><span class="s2">&quot;std: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">avg_unit_thickness</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, min: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">avg_unit_thickness</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, &quot;</span>
</span><span id="Closures-405"><a href="#-405"><span class="linenos"> 405</span></a>            <span class="sa">f</span><span class="s2">&quot;max: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">avg_unit_thickness</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Closures-406"><a href="#-406"><span class="linenos"> 406</span></a>        <span class="p">)</span>
</span><span id="Closures-407"><a href="#-407"><span class="linenos"> 407</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="Closures-408"><a href="#-408"><span class="linenos"> 408</span></a>            <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="Closures-409"><a href="#-409"><span class="linenos"> 409</span></a>            <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span>
</span><span id="Closures-410"><a href="#-410"><span class="linenos"> 410</span></a>            <span class="n">subkey</span><span class="o">=</span><span class="s2">&quot;sand_unit_thickness_combined_mean&quot;</span><span class="p">,</span>
</span><span id="Closures-411"><a href="#-411"><span class="linenos"> 411</span></a>            <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">avg_sand_thickness</span><span class="p">),</span>
</span><span id="Closures-412"><a href="#-412"><span class="linenos"> 412</span></a>        <span class="p">)</span>
</span><span id="Closures-413"><a href="#-413"><span class="linenos"> 413</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="Closures-414"><a href="#-414"><span class="linenos"> 414</span></a>            <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="Closures-415"><a href="#-415"><span class="linenos"> 415</span></a>            <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span>
</span><span id="Closures-416"><a href="#-416"><span class="linenos"> 416</span></a>            <span class="n">subkey</span><span class="o">=</span><span class="s2">&quot;sand_unit_thickness_combined_std&quot;</span><span class="p">,</span>
</span><span id="Closures-417"><a href="#-417"><span class="linenos"> 417</span></a>            <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">avg_sand_thickness</span><span class="p">),</span>
</span><span id="Closures-418"><a href="#-418"><span class="linenos"> 418</span></a>        <span class="p">)</span>
</span><span id="Closures-419"><a href="#-419"><span class="linenos"> 419</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="Closures-420"><a href="#-420"><span class="linenos"> 420</span></a>            <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="Closures-421"><a href="#-421"><span class="linenos"> 421</span></a>            <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span>
</span><span id="Closures-422"><a href="#-422"><span class="linenos"> 422</span></a>            <span class="n">subkey</span><span class="o">=</span><span class="s2">&quot;sand_unit_thickness_combined_min&quot;</span><span class="p">,</span>
</span><span id="Closures-423"><a href="#-423"><span class="linenos"> 423</span></a>            <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">avg_sand_thickness</span><span class="p">),</span>
</span><span id="Closures-424"><a href="#-424"><span class="linenos"> 424</span></a>        <span class="p">)</span>
</span><span id="Closures-425"><a href="#-425"><span class="linenos"> 425</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="Closures-426"><a href="#-426"><span class="linenos"> 426</span></a>            <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="Closures-427"><a href="#-427"><span class="linenos"> 427</span></a>            <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span>
</span><span id="Closures-428"><a href="#-428"><span class="linenos"> 428</span></a>            <span class="n">subkey</span><span class="o">=</span><span class="s2">&quot;sand_unit_thickness_combined_max&quot;</span><span class="p">,</span>
</span><span id="Closures-429"><a href="#-429"><span class="linenos"> 429</span></a>            <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">avg_sand_thickness</span><span class="p">),</span>
</span><span id="Closures-430"><a href="#-430"><span class="linenos"> 430</span></a>        <span class="p">)</span>
</span><span id="Closures-431"><a href="#-431"><span class="linenos"> 431</span></a>        <span class="c1">#</span>
</span><span id="Closures-432"><a href="#-432"><span class="linenos"> 432</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="Closures-433"><a href="#-433"><span class="linenos"> 433</span></a>            <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="Closures-434"><a href="#-434"><span class="linenos"> 434</span></a>            <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span>
</span><span id="Closures-435"><a href="#-435"><span class="linenos"> 435</span></a>            <span class="n">subkey</span><span class="o">=</span><span class="s2">&quot;shale_unit_thickness_combined_mean&quot;</span><span class="p">,</span>
</span><span id="Closures-436"><a href="#-436"><span class="linenos"> 436</span></a>            <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">avg_shale_thickness</span><span class="p">),</span>
</span><span id="Closures-437"><a href="#-437"><span class="linenos"> 437</span></a>        <span class="p">)</span>
</span><span id="Closures-438"><a href="#-438"><span class="linenos"> 438</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="Closures-439"><a href="#-439"><span class="linenos"> 439</span></a>            <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="Closures-440"><a href="#-440"><span class="linenos"> 440</span></a>            <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span>
</span><span id="Closures-441"><a href="#-441"><span class="linenos"> 441</span></a>            <span class="n">subkey</span><span class="o">=</span><span class="s2">&quot;shale_unit_thickness_combined_std&quot;</span><span class="p">,</span>
</span><span id="Closures-442"><a href="#-442"><span class="linenos"> 442</span></a>            <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">avg_shale_thickness</span><span class="p">),</span>
</span><span id="Closures-443"><a href="#-443"><span class="linenos"> 443</span></a>        <span class="p">)</span>
</span><span id="Closures-444"><a href="#-444"><span class="linenos"> 444</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="Closures-445"><a href="#-445"><span class="linenos"> 445</span></a>            <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="Closures-446"><a href="#-446"><span class="linenos"> 446</span></a>            <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span>
</span><span id="Closures-447"><a href="#-447"><span class="linenos"> 447</span></a>            <span class="n">subkey</span><span class="o">=</span><span class="s2">&quot;shale_unit_thickness_combined_min&quot;</span><span class="p">,</span>
</span><span id="Closures-448"><a href="#-448"><span class="linenos"> 448</span></a>            <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">avg_shale_thickness</span><span class="p">),</span>
</span><span id="Closures-449"><a href="#-449"><span class="linenos"> 449</span></a>        <span class="p">)</span>
</span><span id="Closures-450"><a href="#-450"><span class="linenos"> 450</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="Closures-451"><a href="#-451"><span class="linenos"> 451</span></a>            <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="Closures-452"><a href="#-452"><span class="linenos"> 452</span></a>            <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span>
</span><span id="Closures-453"><a href="#-453"><span class="linenos"> 453</span></a>            <span class="n">subkey</span><span class="o">=</span><span class="s2">&quot;shale_unit_thickness_combined_max&quot;</span><span class="p">,</span>
</span><span id="Closures-454"><a href="#-454"><span class="linenos"> 454</span></a>            <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">avg_shale_thickness</span><span class="p">),</span>
</span><span id="Closures-455"><a href="#-455"><span class="linenos"> 455</span></a>        <span class="p">)</span>
</span><span id="Closures-456"><a href="#-456"><span class="linenos"> 456</span></a>
</span><span id="Closures-457"><a href="#-457"><span class="linenos"> 457</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="Closures-458"><a href="#-458"><span class="linenos"> 458</span></a>            <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="Closures-459"><a href="#-459"><span class="linenos"> 459</span></a>            <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span>
</span><span id="Closures-460"><a href="#-460"><span class="linenos"> 460</span></a>            <span class="n">subkey</span><span class="o">=</span><span class="s2">&quot;overall_unit_thickness_combined_mean&quot;</span><span class="p">,</span>
</span><span id="Closures-461"><a href="#-461"><span class="linenos"> 461</span></a>            <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">avg_unit_thickness</span><span class="p">),</span>
</span><span id="Closures-462"><a href="#-462"><span class="linenos"> 462</span></a>        <span class="p">)</span>
</span><span id="Closures-463"><a href="#-463"><span class="linenos"> 463</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="Closures-464"><a href="#-464"><span class="linenos"> 464</span></a>            <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="Closures-465"><a href="#-465"><span class="linenos"> 465</span></a>            <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span>
</span><span id="Closures-466"><a href="#-466"><span class="linenos"> 466</span></a>            <span class="n">subkey</span><span class="o">=</span><span class="s2">&quot;overall_unit_thickness_combined_std&quot;</span><span class="p">,</span>
</span><span id="Closures-467"><a href="#-467"><span class="linenos"> 467</span></a>            <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">avg_unit_thickness</span><span class="p">),</span>
</span><span id="Closures-468"><a href="#-468"><span class="linenos"> 468</span></a>        <span class="p">)</span>
</span><span id="Closures-469"><a href="#-469"><span class="linenos"> 469</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="Closures-470"><a href="#-470"><span class="linenos"> 470</span></a>            <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="Closures-471"><a href="#-471"><span class="linenos"> 471</span></a>            <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span>
</span><span id="Closures-472"><a href="#-472"><span class="linenos"> 472</span></a>            <span class="n">subkey</span><span class="o">=</span><span class="s2">&quot;overall_unit_thickness_combined_min&quot;</span><span class="p">,</span>
</span><span id="Closures-473"><a href="#-473"><span class="linenos"> 473</span></a>            <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">avg_unit_thickness</span><span class="p">),</span>
</span><span id="Closures-474"><a href="#-474"><span class="linenos"> 474</span></a>        <span class="p">)</span>
</span><span id="Closures-475"><a href="#-475"><span class="linenos"> 475</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="Closures-476"><a href="#-476"><span class="linenos"> 476</span></a>            <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="Closures-477"><a href="#-477"><span class="linenos"> 477</span></a>            <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span>
</span><span id="Closures-478"><a href="#-478"><span class="linenos"> 478</span></a>            <span class="n">subkey</span><span class="o">=</span><span class="s2">&quot;overall_unit_thickness_combined_max&quot;</span><span class="p">,</span>
</span><span id="Closures-479"><a href="#-479"><span class="linenos"> 479</span></a>            <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">avg_unit_thickness</span><span class="p">),</span>
</span><span id="Closures-480"><a href="#-480"><span class="linenos"> 480</span></a>        <span class="p">)</span>
</span><span id="Closures-481"><a href="#-481"><span class="linenos"> 481</span></a>
</span><span id="Closures-482"><a href="#-482"><span class="linenos"> 482</span></a>        <span class="n">non_zero_pixels</span> <span class="o">=</span> <span class="n">closure_segments</span><span class="p">[</span><span class="n">closure_segments</span> <span class="o">!=</span> <span class="mf">0.0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Closures-483"><a href="#-483"><span class="linenos"> 483</span></a>        <span class="n">pct_non_zero</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">non_zero_pixels</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span>
</span><span id="Closures-484"><a href="#-484"><span class="linenos"> 484</span></a>            <span class="n">closure_segments</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Closures-485"><a href="#-485"><span class="linenos"> 485</span></a>            <span class="o">*</span> <span class="n">closure_segments</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="Closures-486"><a href="#-486"><span class="linenos"> 486</span></a>            <span class="o">*</span> <span class="n">closure_segments</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
</span><span id="Closures-487"><a href="#-487"><span class="linenos"> 487</span></a>        <span class="p">)</span>
</span><span id="Closures-488"><a href="#-488"><span class="linenos"> 488</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Closures-489"><a href="#-489"><span class="linenos"> 489</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="Closures-490"><a href="#-490"><span class="linenos"> 490</span></a>                <span class="s2">&quot;    ...closure_segments min </span><span class="si">{}</span><span class="s2">, mean </span><span class="si">{}</span><span class="s2">, max </span><span class="si">{}</span><span class="s2">, % non-zero </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="Closures-491"><a href="#-491"><span class="linenos"> 491</span></a>                    <span class="n">closure_segments</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
</span><span id="Closures-492"><a href="#-492"><span class="linenos"> 492</span></a>                    <span class="n">closure_segments</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span>
</span><span id="Closures-493"><a href="#-493"><span class="linenos"> 493</span></a>                    <span class="n">closure_segments</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span>
</span><span id="Closures-494"><a href="#-494"><span class="linenos"> 494</span></a>                    <span class="n">pct_non_zero</span><span class="p">,</span>
</span><span id="Closures-495"><a href="#-495"><span class="linenos"> 495</span></a>                <span class="p">)</span>
</span><span id="Closures-496"><a href="#-496"><span class="linenos"> 496</span></a>            <span class="p">)</span>
</span><span id="Closures-497"><a href="#-497"><span class="linenos"> 497</span></a>
</span><span id="Closures-498"><a href="#-498"><span class="linenos"> 498</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">... layers_with_closure </span><span class="si">{</span><span class="n">layers_with_closure</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Closures-499"><a href="#-499"><span class="linenos"> 499</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">... finished putting closures in closure_segments ...</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Closures-500"><a href="#-500"><span class="linenos"> 500</span></a>
</span><span id="Closures-501"><a href="#-501"><span class="linenos"> 501</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Closures-502"><a href="#-502"><span class="linenos"> 502</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="Closures-503"><a href="#-503"><span class="linenos"> 503</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">   ...closure segments created. min: </span><span class="si">{</span><span class="n">closure_segments</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="si">}</span><span class="s2">, &quot;</span>
</span><span id="Closures-504"><a href="#-504"><span class="linenos"> 504</span></a>                <span class="sa">f</span><span class="s2">&quot;mean: </span><span class="si">{</span><span class="n">closure_segments</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, max: </span><span class="si">{</span><span class="n">closure_segments</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Closures-505"><a href="#-505"><span class="linenos"> 505</span></a>                <span class="sa">f</span><span class="s2">&quot; voxel count: </span><span class="si">{</span><span class="n">closure_segments</span><span class="p">[</span><span class="n">closure_segments</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Closures-506"><a href="#-506"><span class="linenos"> 506</span></a>            <span class="p">)</span>
</span><span id="Closures-507"><a href="#-507"><span class="linenos"> 507</span></a>
</span><span id="Closures-508"><a href="#-508"><span class="linenos"> 508</span></a>        <span class="k">return</span> <span class="n">closure_segments</span>
</span><span id="Closures-509"><a href="#-509"><span class="linenos"> 509</span></a>
</span><span id="Closures-510"><a href="#-510"><span class="linenos"> 510</span></a>    <span class="k">def</span> <span class="nf">create_closure_labels_from_all_depth_maps</span><span class="p">(</span>
</span><span id="Closures-511"><a href="#-511"><span class="linenos"> 511</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">depth_maps</span><span class="p">,</span> <span class="n">depth_maps_infilled</span><span class="p">,</span> <span class="n">max_col_height</span>
</span><span id="Closures-512"><a href="#-512"><span class="linenos"> 512</span></a>    <span class="p">):</span>
</span><span id="Closures-513"><a href="#-513"><span class="linenos"> 513</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Closures-514"><a href="#-514"><span class="linenos"> 514</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\t</span><span class="s2">... inside insertClosureLabels3D &quot;</span><span class="p">)</span>
</span><span id="Closures-515"><a href="#-515"><span class="linenos"> 515</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="Closures-516"><a href="#-516"><span class="linenos"> 516</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">... depth_maps min </span><span class="si">{</span><span class="n">depth_maps</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, mean </span><span class="si">{</span><span class="n">depth_maps</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">,&quot;</span>
</span><span id="Closures-517"><a href="#-517"><span class="linenos"> 517</span></a>                <span class="sa">f</span><span class="s2">&quot; max </span><span class="si">{</span><span class="n">depth_maps</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, cube_shape </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Closures-518"><a href="#-518"><span class="linenos"> 518</span></a>            <span class="p">)</span>
</span><span id="Closures-519"><a href="#-519"><span class="linenos"> 519</span></a>
</span><span id="Closures-520"><a href="#-520"><span class="linenos"> 520</span></a>        <span class="c1"># create 3D cube to hold segmentation results</span>
</span><span id="Closures-521"><a href="#-521"><span class="linenos"> 521</span></a>        <span class="n">closure_segments</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">faulted_lithology</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="s2">&quot;float32&quot;</span><span class="p">)</span>
</span><span id="Closures-522"><a href="#-522"><span class="linenos"> 522</span></a>
</span><span id="Closures-523"><a href="#-523"><span class="linenos"> 523</span></a>        <span class="c1"># create grids with grid indices</span>
</span><span id="Closures-524"><a href="#-524"><span class="linenos"> 524</span></a>        <span class="n">ii</span><span class="p">,</span> <span class="n">jj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">build_meshgrid</span><span class="p">()</span>
</span><span id="Closures-525"><a href="#-525"><span class="linenos"> 525</span></a>
</span><span id="Closures-526"><a href="#-526"><span class="linenos"> 526</span></a>        <span class="c1"># loop through horizons in &#39;depth_maps&#39;</span>
</span><span id="Closures-527"><a href="#-527"><span class="linenos"> 527</span></a>        <span class="n">voxel_change_count</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
</span><span id="Closures-528"><a href="#-528"><span class="linenos"> 528</span></a>        <span class="n">layers_with_closure</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Closures-529"><a href="#-529"><span class="linenos"> 529</span></a>
</span><span id="Closures-530"><a href="#-530"><span class="linenos"> 530</span></a>        <span class="n">avg_sand_thickness</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
</span><span id="Closures-531"><a href="#-531"><span class="linenos"> 531</span></a>        <span class="n">avg_shale_thickness</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
</span><span id="Closures-532"><a href="#-532"><span class="linenos"> 532</span></a>        <span class="n">avg_unit_thickness</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
</span><span id="Closures-533"><a href="#-533"><span class="linenos"> 533</span></a>        <span class="k">for</span> <span class="n">ihorizon</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">depth_maps</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="Closures-534"><a href="#-534"><span class="linenos"> 534</span></a>            <span class="n">avg_unit_thickness</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="Closures-535"><a href="#-535"><span class="linenos"> 535</span></a>                <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span>
</span><span id="Closures-536"><a href="#-536"><span class="linenos"> 536</span></a>                    <span class="n">depth_maps_infilled</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">ihorizon</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="Closures-537"><a href="#-537"><span class="linenos"> 537</span></a>                    <span class="o">-</span> <span class="n">depth_maps_infilled</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">ihorizon</span><span class="p">]</span>
</span><span id="Closures-538"><a href="#-538"><span class="linenos"> 538</span></a>                <span class="p">)</span>
</span><span id="Closures-539"><a href="#-539"><span class="linenos"> 539</span></a>            <span class="p">)</span>
</span><span id="Closures-540"><a href="#-540"><span class="linenos"> 540</span></a>            <span class="c1"># calculate a closure map for the layer</span>
</span><span id="Closures-541"><a href="#-541"><span class="linenos"> 541</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Closures-542"><a href="#-542"><span class="linenos"> 542</span></a>                <span class="nb">print</span><span class="p">(</span>
</span><span id="Closures-543"><a href="#-543"><span class="linenos"> 543</span></a>                    <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">...closure voxels computation for layer </span><span class="si">{</span><span class="n">ihorizon</span><span class="si">}</span><span class="s2"> in horizon list.&quot;</span>
</span><span id="Closures-544"><a href="#-544"><span class="linenos"> 544</span></a>                <span class="p">)</span>
</span><span id="Closures-545"><a href="#-545"><span class="linenos"> 545</span></a>
</span><span id="Closures-546"><a href="#-546"><span class="linenos"> 546</span></a>            <span class="c1"># compute a closure map</span>
</span><span id="Closures-547"><a href="#-547"><span class="linenos"> 547</span></a>            <span class="c1"># - identical to top structure map when not in closure, &#39;max flooding&#39; depth when in closure</span>
</span><span id="Closures-548"><a href="#-548"><span class="linenos"> 548</span></a>            <span class="c1"># - use thicknesses converted to samples instead of ft or ms</span>
</span><span id="Closures-549"><a href="#-549"><span class="linenos"> 549</span></a>            <span class="c1"># - assumes that fault intersections are inserted in input map with value of 0.</span>
</span><span id="Closures-550"><a href="#-550"><span class="linenos"> 550</span></a>            <span class="c1"># - assumes that input map values represent depth (i.e., bigger values are deeper)</span>
</span><span id="Closures-551"><a href="#-551"><span class="linenos"> 551</span></a>            <span class="n">top_structure_depth_map</span> <span class="o">=</span> <span class="n">depth_maps</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">ihorizon</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Closures-552"><a href="#-552"><span class="linenos"> 552</span></a>            <span class="n">top_structure_depth_map</span><span class="p">[</span>
</span><span id="Closures-553"><a href="#-553"><span class="linenos"> 553</span></a>                <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">top_structure_depth_map</span><span class="p">)</span>
</span><span id="Closures-554"><a href="#-554"><span class="linenos"> 554</span></a>            <span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>  <span class="c1"># replace nans with 0.</span>
</span><span id="Closures-555"><a href="#-555"><span class="linenos"> 555</span></a>            <span class="n">top_structure_depth_map</span> <span class="o">/=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">digi</span><span class="p">)</span>
</span><span id="Closures-556"><a href="#-556"><span class="linenos"> 556</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">partial_voxels</span><span class="p">:</span>
</span><span id="Closures-557"><a href="#-557"><span class="linenos"> 557</span></a>                <span class="n">top_structure_depth_map</span> <span class="o">-=</span> <span class="mf">1.0</span>  <span class="c1"># account for voxels partially in layer</span>
</span><span id="Closures-558"><a href="#-558"><span class="linenos"> 558</span></a>            <span class="n">base_structure_depth_map</span> <span class="o">=</span> <span class="n">depth_maps_infilled</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">ihorizon</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Closures-559"><a href="#-559"><span class="linenos"> 559</span></a>            <span class="n">base_structure_depth_map</span><span class="p">[</span>
</span><span id="Closures-560"><a href="#-560"><span class="linenos"> 560</span></a>                <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">top_structure_depth_map</span><span class="p">)</span>
</span><span id="Closures-561"><a href="#-561"><span class="linenos"> 561</span></a>            <span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>  <span class="c1"># replace nans with 0.</span>
</span><span id="Closures-562"><a href="#-562"><span class="linenos"> 562</span></a>            <span class="n">base_structure_depth_map</span> <span class="o">/=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">digi</span><span class="p">)</span>
</span><span id="Closures-563"><a href="#-563"><span class="linenos"> 563</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="Closures-564"><a href="#-564"><span class="linenos"> 564</span></a>                <span class="s2">&quot; ...inside create_closure_labels_from_depth_maps... ihorizon = &quot;</span><span class="p">,</span>
</span><span id="Closures-565"><a href="#-565"><span class="linenos"> 565</span></a>                <span class="n">ihorizon</span><span class="p">,</span>
</span><span id="Closures-566"><a href="#-566"><span class="linenos"> 566</span></a>            <span class="p">)</span>
</span><span id="Closures-567"><a href="#-567"><span class="linenos"> 567</span></a>            <span class="c1"># if there is non-zero thickness between top/base closure</span>
</span><span id="Closures-568"><a href="#-568"><span class="linenos"> 568</span></a>            <span class="k">if</span> <span class="n">top_structure_depth_map</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">!=</span> <span class="n">top_structure_depth_map</span><span class="o">.</span><span class="n">max</span><span class="p">():</span>
</span><span id="Closures-569"><a href="#-569"><span class="linenos"> 569</span></a>                <span class="n">max_column</span> <span class="o">=</span> <span class="n">max_col_height</span><span class="p">[</span><span class="n">ihorizon</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">digi</span>
</span><span id="Closures-570"><a href="#-570"><span class="linenos"> 570</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Closures-571"><a href="#-571"><span class="linenos"> 571</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="Closures-572"><a href="#-572"><span class="linenos"> 572</span></a>                        <span class="sa">f</span><span class="s2">&quot;   ...avg depth for layer </span><span class="si">{</span><span class="n">ihorizon</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">,</span>
</span><span id="Closures-573"><a href="#-573"><span class="linenos"> 573</span></a>                        <span class="n">top_structure_depth_map</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span>
</span><span id="Closures-574"><a href="#-574"><span class="linenos"> 574</span></a>                    <span class="p">)</span>
</span><span id="Closures-575"><a href="#-575"><span class="linenos"> 575</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Closures-576"><a href="#-576"><span class="linenos"> 576</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="Closures-577"><a href="#-577"><span class="linenos"> 577</span></a>                        <span class="sa">f</span><span class="s2">&quot;   ...maximum column height for layer </span><span class="si">{</span><span class="n">ihorizon</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">,</span> <span class="n">max_column</span>
</span><span id="Closures-578"><a href="#-578"><span class="linenos"> 578</span></a>                    <span class="p">)</span>
</span><span id="Closures-579"><a href="#-579"><span class="linenos"> 579</span></a>
</span><span id="Closures-580"><a href="#-580"><span class="linenos"> 580</span></a>                <span class="k">if</span> <span class="n">ihorizon</span> <span class="o">==</span> <span class="mi">27000</span> <span class="ow">or</span> <span class="n">ihorizon</span> <span class="o">==</span> <span class="mi">1000</span><span class="p">:</span>
</span><span id="Closures-581"><a href="#-581"><span class="linenos"> 581</span></a>                    <span class="n">closure_depth_map</span> <span class="o">=</span> <span class="n">_flood_fill</span><span class="p">(</span>
</span><span id="Closures-582"><a href="#-582"><span class="linenos"> 582</span></a>                        <span class="n">top_structure_depth_map</span><span class="p">,</span>
</span><span id="Closures-583"><a href="#-583"><span class="linenos"> 583</span></a>                        <span class="n">max_column_height</span><span class="o">=</span><span class="n">max_column</span><span class="p">,</span>
</span><span id="Closures-584"><a href="#-584"><span class="linenos"> 584</span></a>                        <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="Closures-585"><a href="#-585"><span class="linenos"> 585</span></a>                        <span class="n">debug</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="Closures-586"><a href="#-586"><span class="linenos"> 586</span></a>                    <span class="p">)</span>
</span><span id="Closures-587"><a href="#-587"><span class="linenos"> 587</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Closures-588"><a href="#-588"><span class="linenos"> 588</span></a>                    <span class="n">closure_depth_map</span> <span class="o">=</span> <span class="n">_flood_fill</span><span class="p">(</span>
</span><span id="Closures-589"><a href="#-589"><span class="linenos"> 589</span></a>                        <span class="n">top_structure_depth_map</span><span class="p">,</span> <span class="n">max_column_height</span><span class="o">=</span><span class="n">max_column</span>
</span><span id="Closures-590"><a href="#-590"><span class="linenos"> 590</span></a>                    <span class="p">)</span>
</span><span id="Closures-591"><a href="#-591"><span class="linenos"> 591</span></a>                <span class="n">closure_depth_map</span><span class="p">[</span><span class="n">closure_depth_map</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">top_structure_depth_map</span><span class="p">[</span>
</span><span id="Closures-592"><a href="#-592"><span class="linenos"> 592</span></a>                    <span class="n">closure_depth_map</span> <span class="o">==</span> <span class="mi">0</span>
</span><span id="Closures-593"><a href="#-593"><span class="linenos"> 593</span></a>                <span class="p">]</span>
</span><span id="Closures-594"><a href="#-594"><span class="linenos"> 594</span></a>                <span class="n">closure_depth_map</span><span class="p">[</span><span class="n">closure_depth_map</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">top_structure_depth_map</span><span class="p">[</span>
</span><span id="Closures-595"><a href="#-595"><span class="linenos"> 595</span></a>                    <span class="n">closure_depth_map</span> <span class="o">==</span> <span class="mi">1</span>
</span><span id="Closures-596"><a href="#-596"><span class="linenos"> 596</span></a>                <span class="p">]</span>
</span><span id="Closures-597"><a href="#-597"><span class="linenos"> 597</span></a>                <span class="n">closure_depth_map</span><span class="p">[</span><span class="n">closure_depth_map</span> <span class="o">==</span> <span class="mf">1e5</span><span class="p">]</span> <span class="o">=</span> <span class="n">top_structure_depth_map</span><span class="p">[</span>
</span><span id="Closures-598"><a href="#-598"><span class="linenos"> 598</span></a>                    <span class="n">closure_depth_map</span> <span class="o">==</span> <span class="mf">1e5</span>
</span><span id="Closures-599"><a href="#-599"><span class="linenos"> 599</span></a>                <span class="p">]</span>
</span><span id="Closures-600"><a href="#-600"><span class="linenos"> 600</span></a>                <span class="c1"># Select the maximum value between the top sand map and the flood-filled closure map</span>
</span><span id="Closures-601"><a href="#-601"><span class="linenos"> 601</span></a>                <span class="n">closure_depth_map</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span>
</span><span id="Closures-602"><a href="#-602"><span class="linenos"> 602</span></a>                    <span class="n">np</span><span class="o">.</span><span class="n">dstack</span><span class="p">((</span><span class="n">closure_depth_map</span><span class="p">,</span> <span class="n">top_structure_depth_map</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span>
</span><span id="Closures-603"><a href="#-603"><span class="linenos"> 603</span></a>                <span class="p">)</span>
</span><span id="Closures-604"><a href="#-604"><span class="linenos"> 604</span></a>                <span class="n">closure_depth_map</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span>
</span><span id="Closures-605"><a href="#-605"><span class="linenos"> 605</span></a>                    <span class="n">np</span><span class="o">.</span><span class="n">dstack</span><span class="p">((</span><span class="n">closure_depth_map</span><span class="p">,</span> <span class="n">base_structure_depth_map</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span>
</span><span id="Closures-606"><a href="#-606"><span class="linenos"> 606</span></a>                <span class="p">)</span>
</span><span id="Closures-607"><a href="#-607"><span class="linenos"> 607</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Closures-608"><a href="#-608"><span class="linenos"> 608</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="Closures-609"><a href="#-609"><span class="linenos"> 609</span></a>                        <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">    ... layer </span><span class="si">{</span><span class="n">ihorizon</span><span class="si">}</span><span class="s2">,&quot;</span>
</span><span id="Closures-610"><a href="#-610"><span class="linenos"> 610</span></a>                        <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n\t</span><span class="s2">top structure map min, max </span><span class="si">{</span><span class="n">top_structure_depth_map</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">,&quot;</span>
</span><span id="Closures-611"><a href="#-611"><span class="linenos"> 611</span></a>                        <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">top_structure_depth_map</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="se">\n\t</span><span class="s2">closure_depth_map min, max&quot;</span>
</span><span id="Closures-612"><a href="#-612"><span class="linenos"> 612</span></a>                        <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">closure_depth_map</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">closure_depth_map</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Closures-613"><a href="#-613"><span class="linenos"> 613</span></a>                    <span class="p">)</span>
</span><span id="Closures-614"><a href="#-614"><span class="linenos"> 614</span></a>                <span class="n">closure_thickness</span> <span class="o">=</span> <span class="n">closure_depth_map</span> <span class="o">-</span> <span class="n">top_structure_depth_map</span>
</span><span id="Closures-615"><a href="#-615"><span class="linenos"> 615</span></a>                <span class="n">closure_thickness_no_nan</span> <span class="o">=</span> <span class="n">closure_thickness</span><span class="p">[</span>
</span><span id="Closures-616"><a href="#-616"><span class="linenos"> 616</span></a>                    <span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">closure_thickness</span><span class="p">)</span>
</span><span id="Closures-617"><a href="#-617"><span class="linenos"> 617</span></a>                <span class="p">]</span>
</span><span id="Closures-618"><a href="#-618"><span class="linenos"> 618</span></a>                <span class="n">max_closure</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">closure_thickness_no_nan</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="mi">0</span><span class="p">))</span>
</span><span id="Closures-619"><a href="#-619"><span class="linenos"> 619</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Closures-620"><a href="#-620"><span class="linenos"> 620</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    ... layer </span><span class="si">{</span><span class="n">ihorizon</span><span class="si">}</span><span class="s2">, max_closure </span><span class="si">{</span><span class="n">max_closure</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Closures-621"><a href="#-621"><span class="linenos"> 621</span></a>
</span><span id="Closures-622"><a href="#-622"><span class="linenos"> 622</span></a>                <span class="c1"># locate 3D zone in closure after checking that closures exist for this horizon</span>
</span><span id="Closures-623"><a href="#-623"><span class="linenos"> 623</span></a>                <span class="c1"># if False in (top_structure_depth_map == closure_depth_map):</span>
</span><span id="Closures-624"><a href="#-624"><span class="linenos"> 624</span></a>                <span class="k">if</span> <span class="n">max_closure</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Closures-625"><a href="#-625"><span class="linenos"> 625</span></a>                    <span class="c1"># locate voxels anywhere in layer where top_structure_depth_map &lt; closure_depth_map</span>
</span><span id="Closures-626"><a href="#-626"><span class="linenos"> 626</span></a>                    <span class="c1"># put label in cube between top_structure_depth_map and closure_depth_map</span>
</span><span id="Closures-627"><a href="#-627"><span class="linenos"> 627</span></a>                    <span class="n">top_structure_depth_map_integer</span> <span class="o">=</span> <span class="n">top_structure_depth_map</span>
</span><span id="Closures-628"><a href="#-628"><span class="linenos"> 628</span></a>                    <span class="n">closure_depth_map_integer</span> <span class="o">=</span> <span class="n">closure_depth_map</span>
</span><span id="Closures-629"><a href="#-629"><span class="linenos"> 629</span></a>
</span><span id="Closures-630"><a href="#-630"><span class="linenos"> 630</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Closures-631"><a href="#-631"><span class="linenos"> 631</span></a>                        <span class="n">closure_map_min</span> <span class="o">=</span> <span class="n">closure_depth_map_integer</span><span class="p">[</span>
</span><span id="Closures-632"><a href="#-632"><span class="linenos"> 632</span></a>                            <span class="n">closure_depth_map_integer</span> <span class="o">&gt;</span> <span class="mf">0.1</span>
</span><span id="Closures-633"><a href="#-633"><span class="linenos"> 633</span></a>                        <span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
</span><span id="Closures-634"><a href="#-634"><span class="linenos"> 634</span></a>                        <span class="n">closure_map_max</span> <span class="o">=</span> <span class="n">closure_depth_map_integer</span><span class="p">[</span>
</span><span id="Closures-635"><a href="#-635"><span class="linenos"> 635</span></a>                            <span class="n">closure_depth_map_integer</span> <span class="o">&gt;</span> <span class="mf">0.1</span>
</span><span id="Closures-636"><a href="#-636"><span class="linenos"> 636</span></a>                        <span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</span><span id="Closures-637"><a href="#-637"><span class="linenos"> 637</span></a>                        <span class="nb">print</span><span class="p">(</span>
</span><span id="Closures-638"><a href="#-638"><span class="linenos"> 638</span></a>                            <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">... (2) layer: </span><span class="si">{</span><span class="n">ihorizon</span><span class="si">}</span><span class="s2">, max_closure; </span><span class="si">{</span><span class="n">max_closure</span><span class="si">}</span><span class="s2">, top structure map min, &quot;</span>
</span><span id="Closures-639"><a href="#-639"><span class="linenos"> 639</span></a>                            <span class="sa">f</span><span class="s2">&quot;max: </span><span class="si">{</span><span class="n">top_structure_depth_map</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">top_structure_depth_map_integer</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">}</span><span class="s2">,&quot;</span>
</span><span id="Closures-640"><a href="#-640"><span class="linenos"> 640</span></a>                            <span class="sa">f</span><span class="s2">&quot; closure map min, max: </span><span class="si">{</span><span class="n">closure_map_min</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">closure_map_max</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Closures-641"><a href="#-641"><span class="linenos"> 641</span></a>                        <span class="p">)</span>
</span><span id="Closures-642"><a href="#-642"><span class="linenos"> 642</span></a>
</span><span id="Closures-643"><a href="#-643"><span class="linenos"> 643</span></a>                    <span class="n">slices_with_substitution</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Closures-644"><a href="#-644"><span class="linenos"> 644</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    ... max_closure: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">max_closure</span><span class="p">))</span>
</span><span id="Closures-645"><a href="#-645"><span class="linenos"> 645</span></a>                    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span>
</span><span id="Closures-646"><a href="#-646"><span class="linenos"> 646</span></a>                        <span class="n">max_closure</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="Closures-647"><a href="#-647"><span class="linenos"> 647</span></a>                    <span class="p">):</span>  <span class="c1"># add one more sample than seemingly needed for round-off</span>
</span><span id="Closures-648"><a href="#-648"><span class="linenos"> 648</span></a>                        <span class="c1"># Subtract 2 from the closure cube shape since adding one later</span>
</span><span id="Closures-649"><a href="#-649"><span class="linenos"> 649</span></a>                        <span class="n">horizon_slice</span> <span class="o">=</span> <span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="n">top_structure_depth_map</span><span class="p">)</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span>
</span><span id="Closures-650"><a href="#-650"><span class="linenos"> 650</span></a>                            <span class="mi">0</span><span class="p">,</span> <span class="n">closure_segments</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="mi">2</span>
</span><span id="Closures-651"><a href="#-651"><span class="linenos"> 651</span></a>                        <span class="p">)</span>
</span><span id="Closures-652"><a href="#-652"><span class="linenos"> 652</span></a>                        <span class="n">sublayer_kk</span> <span class="o">=</span> <span class="n">horizon_slice</span><span class="p">[</span>
</span><span id="Closures-653"><a href="#-653"><span class="linenos"> 653</span></a>                            <span class="n">horizon_slice</span> <span class="o">&lt;</span> <span class="n">closure_depth_map</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;int&quot;</span><span class="p">)</span>
</span><span id="Closures-654"><a href="#-654"><span class="linenos"> 654</span></a>                        <span class="p">]</span>
</span><span id="Closures-655"><a href="#-655"><span class="linenos"> 655</span></a>                        <span class="n">sublayer_ii</span> <span class="o">=</span> <span class="n">ii</span><span class="p">[</span>
</span><span id="Closures-656"><a href="#-656"><span class="linenos"> 656</span></a>                            <span class="n">horizon_slice</span> <span class="o">&lt;</span> <span class="n">closure_depth_map</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;int&quot;</span><span class="p">)</span>
</span><span id="Closures-657"><a href="#-657"><span class="linenos"> 657</span></a>                        <span class="p">]</span>
</span><span id="Closures-658"><a href="#-658"><span class="linenos"> 658</span></a>                        <span class="n">sublayer_jj</span> <span class="o">=</span> <span class="n">jj</span><span class="p">[</span>
</span><span id="Closures-659"><a href="#-659"><span class="linenos"> 659</span></a>                            <span class="n">horizon_slice</span> <span class="o">&lt;</span> <span class="n">closure_depth_map</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;int&quot;</span><span class="p">)</span>
</span><span id="Closures-660"><a href="#-660"><span class="linenos"> 660</span></a>                        <span class="p">]</span>
</span><span id="Closures-661"><a href="#-661"><span class="linenos"> 661</span></a>
</span><span id="Closures-662"><a href="#-662"><span class="linenos"> 662</span></a>                        <span class="k">if</span> <span class="n">sublayer_ii</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Closures-663"><a href="#-663"><span class="linenos"> 663</span></a>                            <span class="n">slices_with_substitution</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="Closures-664"><a href="#-664"><span class="linenos"> 664</span></a>
</span><span id="Closures-665"><a href="#-665"><span class="linenos"> 665</span></a>                            <span class="n">i_indices</span> <span class="o">=</span> <span class="n">sublayer_ii</span>
</span><span id="Closures-666"><a href="#-666"><span class="linenos"> 666</span></a>                            <span class="n">j_indices</span> <span class="o">=</span> <span class="n">sublayer_jj</span>
</span><span id="Closures-667"><a href="#-667"><span class="linenos"> 667</span></a>                            <span class="n">k_indices</span> <span class="o">=</span> <span class="n">sublayer_kk</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="Closures-668"><a href="#-668"><span class="linenos"> 668</span></a>
</span><span id="Closures-669"><a href="#-669"><span class="linenos"> 669</span></a>                            <span class="k">try</span><span class="p">:</span>
</span><span id="Closures-670"><a href="#-670"><span class="linenos"> 670</span></a>                                <span class="n">closure_segments</span><span class="p">[</span>
</span><span id="Closures-671"><a href="#-671"><span class="linenos"> 671</span></a>                                    <span class="n">i_indices</span><span class="p">,</span> <span class="n">j_indices</span><span class="p">,</span> <span class="n">k_indices</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;int&quot;</span><span class="p">)</span>
</span><span id="Closures-672"><a href="#-672"><span class="linenos"> 672</span></a>                                <span class="p">]</span> <span class="o">+=</span> <span class="mf">1.0</span>
</span><span id="Closures-673"><a href="#-673"><span class="linenos"> 673</span></a>                                <span class="n">voxel_change_count</span><span class="p">[</span>
</span><span id="Closures-674"><a href="#-674"><span class="linenos"> 674</span></a>                                    <span class="n">i_indices</span><span class="p">,</span> <span class="n">j_indices</span><span class="p">,</span> <span class="n">k_indices</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;int&quot;</span><span class="p">)</span>
</span><span id="Closures-675"><a href="#-675"><span class="linenos"> 675</span></a>                                <span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="Closures-676"><a href="#-676"><span class="linenos"> 676</span></a>                            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
</span><span id="Closures-677"><a href="#-677"><span class="linenos"> 677</span></a>                                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Index is out of bounds.&quot;</span><span class="p">)</span>
</span><span id="Closures-678"><a href="#-678"><span class="linenos"> 678</span></a>                                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">closure_segments: </span><span class="si">{</span><span class="n">closure_segments</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Closures-679"><a href="#-679"><span class="linenos"> 679</span></a>                                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">voxel_change_count: </span><span class="si">{</span><span class="n">voxel_change_count</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Closures-680"><a href="#-680"><span class="linenos"> 680</span></a>                                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">i_indices: </span><span class="si">{</span><span class="n">i_indices</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Closures-681"><a href="#-681"><span class="linenos"> 681</span></a>                                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">j_indices: </span><span class="si">{</span><span class="n">j_indices</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Closures-682"><a href="#-682"><span class="linenos"> 682</span></a>                                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">k_indices: </span><span class="si">{</span><span class="n">k_indices</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;int&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Closures-683"><a href="#-683"><span class="linenos"> 683</span></a>                                <span class="k">pass</span>
</span><span id="Closures-684"><a href="#-684"><span class="linenos"> 684</span></a>
</span><span id="Closures-685"><a href="#-685"><span class="linenos"> 685</span></a>                    <span class="k">if</span> <span class="n">slices_with_substitution</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Closures-686"><a href="#-686"><span class="linenos"> 686</span></a>                        <span class="n">layers_with_closure</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="Closures-687"><a href="#-687"><span class="linenos"> 687</span></a>
</span><span id="Closures-688"><a href="#-688"><span class="linenos"> 688</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Closures-689"><a href="#-689"><span class="linenos"> 689</span></a>                        <span class="nb">print</span><span class="p">(</span>
</span><span id="Closures-690"><a href="#-690"><span class="linenos"> 690</span></a>                            <span class="s2">&quot;    ... finished putting closures in closures_segments for layer ...&quot;</span><span class="p">,</span>
</span><span id="Closures-691"><a href="#-691"><span class="linenos"> 691</span></a>                            <span class="n">ihorizon</span><span class="p">,</span>
</span><span id="Closures-692"><a href="#-692"><span class="linenos"> 692</span></a>                        <span class="p">)</span>
</span><span id="Closures-693"><a href="#-693"><span class="linenos"> 693</span></a>
</span><span id="Closures-694"><a href="#-694"><span class="linenos"> 694</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Closures-695"><a href="#-695"><span class="linenos"> 695</span></a>                    <span class="k">continue</span>
</span><span id="Closures-696"><a href="#-696"><span class="linenos"> 696</span></a>
</span><span id="Closures-697"><a href="#-697"><span class="linenos"> 697</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">facies</span><span class="p">[</span><span class="n">ihorizon</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Closures-698"><a href="#-698"><span class="linenos"> 698</span></a>                <span class="n">avg_sand_thickness</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="Closures-699"><a href="#-699"><span class="linenos"> 699</span></a>                    <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span>
</span><span id="Closures-700"><a href="#-700"><span class="linenos"> 700</span></a>                        <span class="n">depth_maps_infilled</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">ihorizon</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="Closures-701"><a href="#-701"><span class="linenos"> 701</span></a>                        <span class="o">-</span> <span class="n">depth_maps_infilled</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">ihorizon</span><span class="p">]</span>
</span><span id="Closures-702"><a href="#-702"><span class="linenos"> 702</span></a>                    <span class="p">)</span>
</span><span id="Closures-703"><a href="#-703"><span class="linenos"> 703</span></a>                <span class="p">)</span>
</span><span id="Closures-704"><a href="#-704"><span class="linenos"> 704</span></a>            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">facies</span><span class="p">[</span><span class="n">ihorizon</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Closures-705"><a href="#-705"><span class="linenos"> 705</span></a>                <span class="c1"># Calculate shale unit thicknesses</span>
</span><span id="Closures-706"><a href="#-706"><span class="linenos"> 706</span></a>                <span class="n">avg_shale_thickness</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="Closures-707"><a href="#-707"><span class="linenos"> 707</span></a>                    <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span>
</span><span id="Closures-708"><a href="#-708"><span class="linenos"> 708</span></a>                        <span class="n">depth_maps_infilled</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">ihorizon</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="Closures-709"><a href="#-709"><span class="linenos"> 709</span></a>                        <span class="o">-</span> <span class="n">depth_maps_infilled</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">ihorizon</span><span class="p">]</span>
</span><span id="Closures-710"><a href="#-710"><span class="linenos"> 710</span></a>                    <span class="p">)</span>
</span><span id="Closures-711"><a href="#-711"><span class="linenos"> 711</span></a>                <span class="p">)</span>
</span><span id="Closures-712"><a href="#-712"><span class="linenos"> 712</span></a>
</span><span id="Closures-713"><a href="#-713"><span class="linenos"> 713</span></a>        <span class="c1"># TODO  handle case where avg_sand_thickness is zero-size array</span>
</span><span id="Closures-714"><a href="#-714"><span class="linenos"> 714</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="Closures-715"><a href="#-715"><span class="linenos"> 715</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="Closures-716"><a href="#-716"><span class="linenos"> 716</span></a>                <span class="sa">f</span><span class="s2">&quot;Sand Unit Thickness (m): mean: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">avg_sand_thickness</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, &quot;</span>
</span><span id="Closures-717"><a href="#-717"><span class="linenos"> 717</span></a>                <span class="sa">f</span><span class="s2">&quot;std: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">avg_sand_thickness</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, min: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">avg_sand_thickness</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, &quot;</span>
</span><span id="Closures-718"><a href="#-718"><span class="linenos"> 718</span></a>                <span class="sa">f</span><span class="s2">&quot;max: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">avg_sand_thickness</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Closures-719"><a href="#-719"><span class="linenos"> 719</span></a>            <span class="p">)</span>
</span><span id="Closures-720"><a href="#-720"><span class="linenos"> 720</span></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="Closures-721"><a href="#-721"><span class="linenos"> 721</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No sands in model&quot;</span><span class="p">)</span>
</span><span id="Closures-722"><a href="#-722"><span class="linenos"> 722</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="Closures-723"><a href="#-723"><span class="linenos"> 723</span></a>            <span class="sa">f</span><span class="s2">&quot;Shale Unit Thickness (m): mean: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">avg_shale_thickness</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, &quot;</span>
</span><span id="Closures-724"><a href="#-724"><span class="linenos"> 724</span></a>            <span class="sa">f</span><span class="s2">&quot;std: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">avg_shale_thickness</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, min: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">avg_shale_thickness</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, &quot;</span>
</span><span id="Closures-725"><a href="#-725"><span class="linenos"> 725</span></a>            <span class="sa">f</span><span class="s2">&quot;max: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">avg_shale_thickness</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Closures-726"><a href="#-726"><span class="linenos"> 726</span></a>        <span class="p">)</span>
</span><span id="Closures-727"><a href="#-727"><span class="linenos"> 727</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="Closures-728"><a href="#-728"><span class="linenos"> 728</span></a>            <span class="sa">f</span><span class="s2">&quot;Overall Unit Thickness (m): mean: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">avg_unit_thickness</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, &quot;</span>
</span><span id="Closures-729"><a href="#-729"><span class="linenos"> 729</span></a>            <span class="sa">f</span><span class="s2">&quot;std: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">avg_unit_thickness</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, min: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">avg_unit_thickness</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, &quot;</span>
</span><span id="Closures-730"><a href="#-730"><span class="linenos"> 730</span></a>            <span class="sa">f</span><span class="s2">&quot;max: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">avg_unit_thickness</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Closures-731"><a href="#-731"><span class="linenos"> 731</span></a>        <span class="p">)</span>
</span><span id="Closures-732"><a href="#-732"><span class="linenos"> 732</span></a>
</span><span id="Closures-733"><a href="#-733"><span class="linenos"> 733</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="Closures-734"><a href="#-734"><span class="linenos"> 734</span></a>            <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="Closures-735"><a href="#-735"><span class="linenos"> 735</span></a>            <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span>
</span><span id="Closures-736"><a href="#-736"><span class="linenos"> 736</span></a>            <span class="n">subkey</span><span class="o">=</span><span class="s2">&quot;sand_unit_thickness_mean&quot;</span><span class="p">,</span>
</span><span id="Closures-737"><a href="#-737"><span class="linenos"> 737</span></a>            <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">avg_sand_thickness</span><span class="p">),</span>
</span><span id="Closures-738"><a href="#-738"><span class="linenos"> 738</span></a>        <span class="p">)</span>
</span><span id="Closures-739"><a href="#-739"><span class="linenos"> 739</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="Closures-740"><a href="#-740"><span class="linenos"> 740</span></a>            <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="Closures-741"><a href="#-741"><span class="linenos"> 741</span></a>            <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span>
</span><span id="Closures-742"><a href="#-742"><span class="linenos"> 742</span></a>            <span class="n">subkey</span><span class="o">=</span><span class="s2">&quot;sand_unit_thickness_std&quot;</span><span class="p">,</span>
</span><span id="Closures-743"><a href="#-743"><span class="linenos"> 743</span></a>            <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">avg_sand_thickness</span><span class="p">),</span>
</span><span id="Closures-744"><a href="#-744"><span class="linenos"> 744</span></a>        <span class="p">)</span>
</span><span id="Closures-745"><a href="#-745"><span class="linenos"> 745</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="Closures-746"><a href="#-746"><span class="linenos"> 746</span></a>            <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="Closures-747"><a href="#-747"><span class="linenos"> 747</span></a>            <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span>
</span><span id="Closures-748"><a href="#-748"><span class="linenos"> 748</span></a>            <span class="n">subkey</span><span class="o">=</span><span class="s2">&quot;sand_unit_thickness_min&quot;</span><span class="p">,</span>
</span><span id="Closures-749"><a href="#-749"><span class="linenos"> 749</span></a>            <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">avg_sand_thickness</span><span class="p">),</span>
</span><span id="Closures-750"><a href="#-750"><span class="linenos"> 750</span></a>        <span class="p">)</span>
</span><span id="Closures-751"><a href="#-751"><span class="linenos"> 751</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="Closures-752"><a href="#-752"><span class="linenos"> 752</span></a>            <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="Closures-753"><a href="#-753"><span class="linenos"> 753</span></a>            <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span>
</span><span id="Closures-754"><a href="#-754"><span class="linenos"> 754</span></a>            <span class="n">subkey</span><span class="o">=</span><span class="s2">&quot;sand_unit_thickness_max&quot;</span><span class="p">,</span>
</span><span id="Closures-755"><a href="#-755"><span class="linenos"> 755</span></a>            <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">avg_sand_thickness</span><span class="p">),</span>
</span><span id="Closures-756"><a href="#-756"><span class="linenos"> 756</span></a>        <span class="p">)</span>
</span><span id="Closures-757"><a href="#-757"><span class="linenos"> 757</span></a>        <span class="c1">#</span>
</span><span id="Closures-758"><a href="#-758"><span class="linenos"> 758</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="Closures-759"><a href="#-759"><span class="linenos"> 759</span></a>            <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="Closures-760"><a href="#-760"><span class="linenos"> 760</span></a>            <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span>
</span><span id="Closures-761"><a href="#-761"><span class="linenos"> 761</span></a>            <span class="n">subkey</span><span class="o">=</span><span class="s2">&quot;shale_unit_thickness_mean&quot;</span><span class="p">,</span>
</span><span id="Closures-762"><a href="#-762"><span class="linenos"> 762</span></a>            <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">avg_shale_thickness</span><span class="p">),</span>
</span><span id="Closures-763"><a href="#-763"><span class="linenos"> 763</span></a>        <span class="p">)</span>
</span><span id="Closures-764"><a href="#-764"><span class="linenos"> 764</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="Closures-765"><a href="#-765"><span class="linenos"> 765</span></a>            <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="Closures-766"><a href="#-766"><span class="linenos"> 766</span></a>            <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span>
</span><span id="Closures-767"><a href="#-767"><span class="linenos"> 767</span></a>            <span class="n">subkey</span><span class="o">=</span><span class="s2">&quot;shale_unit_thickness_std&quot;</span><span class="p">,</span>
</span><span id="Closures-768"><a href="#-768"><span class="linenos"> 768</span></a>            <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">avg_shale_thickness</span><span class="p">),</span>
</span><span id="Closures-769"><a href="#-769"><span class="linenos"> 769</span></a>        <span class="p">)</span>
</span><span id="Closures-770"><a href="#-770"><span class="linenos"> 770</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="Closures-771"><a href="#-771"><span class="linenos"> 771</span></a>            <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="Closures-772"><a href="#-772"><span class="linenos"> 772</span></a>            <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span>
</span><span id="Closures-773"><a href="#-773"><span class="linenos"> 773</span></a>            <span class="n">subkey</span><span class="o">=</span><span class="s2">&quot;shale_unit_thickness_min&quot;</span><span class="p">,</span>
</span><span id="Closures-774"><a href="#-774"><span class="linenos"> 774</span></a>            <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">avg_shale_thickness</span><span class="p">),</span>
</span><span id="Closures-775"><a href="#-775"><span class="linenos"> 775</span></a>        <span class="p">)</span>
</span><span id="Closures-776"><a href="#-776"><span class="linenos"> 776</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="Closures-777"><a href="#-777"><span class="linenos"> 777</span></a>            <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="Closures-778"><a href="#-778"><span class="linenos"> 778</span></a>            <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span>
</span><span id="Closures-779"><a href="#-779"><span class="linenos"> 779</span></a>            <span class="n">subkey</span><span class="o">=</span><span class="s2">&quot;shale_unit_thickness_max&quot;</span><span class="p">,</span>
</span><span id="Closures-780"><a href="#-780"><span class="linenos"> 780</span></a>            <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">avg_shale_thickness</span><span class="p">),</span>
</span><span id="Closures-781"><a href="#-781"><span class="linenos"> 781</span></a>        <span class="p">)</span>
</span><span id="Closures-782"><a href="#-782"><span class="linenos"> 782</span></a>
</span><span id="Closures-783"><a href="#-783"><span class="linenos"> 783</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="Closures-784"><a href="#-784"><span class="linenos"> 784</span></a>            <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="Closures-785"><a href="#-785"><span class="linenos"> 785</span></a>            <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span>
</span><span id="Closures-786"><a href="#-786"><span class="linenos"> 786</span></a>            <span class="n">subkey</span><span class="o">=</span><span class="s2">&quot;overall_unit_thickness_mean&quot;</span><span class="p">,</span>
</span><span id="Closures-787"><a href="#-787"><span class="linenos"> 787</span></a>            <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">avg_unit_thickness</span><span class="p">),</span>
</span><span id="Closures-788"><a href="#-788"><span class="linenos"> 788</span></a>        <span class="p">)</span>
</span><span id="Closures-789"><a href="#-789"><span class="linenos"> 789</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="Closures-790"><a href="#-790"><span class="linenos"> 790</span></a>            <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="Closures-791"><a href="#-791"><span class="linenos"> 791</span></a>            <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span>
</span><span id="Closures-792"><a href="#-792"><span class="linenos"> 792</span></a>            <span class="n">subkey</span><span class="o">=</span><span class="s2">&quot;overall_unit_thickness_std&quot;</span><span class="p">,</span>
</span><span id="Closures-793"><a href="#-793"><span class="linenos"> 793</span></a>            <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">avg_unit_thickness</span><span class="p">),</span>
</span><span id="Closures-794"><a href="#-794"><span class="linenos"> 794</span></a>        <span class="p">)</span>
</span><span id="Closures-795"><a href="#-795"><span class="linenos"> 795</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="Closures-796"><a href="#-796"><span class="linenos"> 796</span></a>            <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="Closures-797"><a href="#-797"><span class="linenos"> 797</span></a>            <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span>
</span><span id="Closures-798"><a href="#-798"><span class="linenos"> 798</span></a>            <span class="n">subkey</span><span class="o">=</span><span class="s2">&quot;overall_unit_thickness_min&quot;</span><span class="p">,</span>
</span><span id="Closures-799"><a href="#-799"><span class="linenos"> 799</span></a>            <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">avg_unit_thickness</span><span class="p">),</span>
</span><span id="Closures-800"><a href="#-800"><span class="linenos"> 800</span></a>        <span class="p">)</span>
</span><span id="Closures-801"><a href="#-801"><span class="linenos"> 801</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="Closures-802"><a href="#-802"><span class="linenos"> 802</span></a>            <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="Closures-803"><a href="#-803"><span class="linenos"> 803</span></a>            <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span>
</span><span id="Closures-804"><a href="#-804"><span class="linenos"> 804</span></a>            <span class="n">subkey</span><span class="o">=</span><span class="s2">&quot;overall_unit_thickness_max&quot;</span><span class="p">,</span>
</span><span id="Closures-805"><a href="#-805"><span class="linenos"> 805</span></a>            <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">avg_unit_thickness</span><span class="p">),</span>
</span><span id="Closures-806"><a href="#-806"><span class="linenos"> 806</span></a>        <span class="p">)</span>
</span><span id="Closures-807"><a href="#-807"><span class="linenos"> 807</span></a>
</span><span id="Closures-808"><a href="#-808"><span class="linenos"> 808</span></a>        <span class="n">non_zero_pixels</span> <span class="o">=</span> <span class="n">closure_segments</span><span class="p">[</span><span class="n">closure_segments</span> <span class="o">!=</span> <span class="mf">0.0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Closures-809"><a href="#-809"><span class="linenos"> 809</span></a>        <span class="n">pct_non_zero</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">non_zero_pixels</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span>
</span><span id="Closures-810"><a href="#-810"><span class="linenos"> 810</span></a>            <span class="n">closure_segments</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Closures-811"><a href="#-811"><span class="linenos"> 811</span></a>            <span class="o">*</span> <span class="n">closure_segments</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="Closures-812"><a href="#-812"><span class="linenos"> 812</span></a>            <span class="o">*</span> <span class="n">closure_segments</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
</span><span id="Closures-813"><a href="#-813"><span class="linenos"> 813</span></a>        <span class="p">)</span>
</span><span id="Closures-814"><a href="#-814"><span class="linenos"> 814</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Closures-815"><a href="#-815"><span class="linenos"> 815</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="Closures-816"><a href="#-816"><span class="linenos"> 816</span></a>                <span class="s2">&quot;    ...closure_segments min </span><span class="si">{}</span><span class="s2">, mean </span><span class="si">{}</span><span class="s2">, max </span><span class="si">{}</span><span class="s2">, % non-zero </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="Closures-817"><a href="#-817"><span class="linenos"> 817</span></a>                    <span class="n">closure_segments</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
</span><span id="Closures-818"><a href="#-818"><span class="linenos"> 818</span></a>                    <span class="n">closure_segments</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span>
</span><span id="Closures-819"><a href="#-819"><span class="linenos"> 819</span></a>                    <span class="n">closure_segments</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span>
</span><span id="Closures-820"><a href="#-820"><span class="linenos"> 820</span></a>                    <span class="n">pct_non_zero</span><span class="p">,</span>
</span><span id="Closures-821"><a href="#-821"><span class="linenos"> 821</span></a>                <span class="p">)</span>
</span><span id="Closures-822"><a href="#-822"><span class="linenos"> 822</span></a>            <span class="p">)</span>
</span><span id="Closures-823"><a href="#-823"><span class="linenos"> 823</span></a>
</span><span id="Closures-824"><a href="#-824"><span class="linenos"> 824</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">... layers_with_closure </span><span class="si">{</span><span class="n">layers_with_closure</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Closures-825"><a href="#-825"><span class="linenos"> 825</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">... finished putting closures in closure_segments ...</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Closures-826"><a href="#-826"><span class="linenos"> 826</span></a>
</span><span id="Closures-827"><a href="#-827"><span class="linenos"> 827</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Closures-828"><a href="#-828"><span class="linenos"> 828</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="Closures-829"><a href="#-829"><span class="linenos"> 829</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">   ...closure segments created. min: </span><span class="si">{</span><span class="n">closure_segments</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="si">}</span><span class="s2">, &quot;</span>
</span><span id="Closures-830"><a href="#-830"><span class="linenos"> 830</span></a>                <span class="sa">f</span><span class="s2">&quot;mean: </span><span class="si">{</span><span class="n">closure_segments</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, max: </span><span class="si">{</span><span class="n">closure_segments</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Closures-831"><a href="#-831"><span class="linenos"> 831</span></a>                <span class="sa">f</span><span class="s2">&quot; voxel count: </span><span class="si">{</span><span class="n">closure_segments</span><span class="p">[</span><span class="n">closure_segments</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Closures-832"><a href="#-832"><span class="linenos"> 832</span></a>            <span class="p">)</span>
</span><span id="Closures-833"><a href="#-833"><span class="linenos"> 833</span></a>
</span><span id="Closures-834"><a href="#-834"><span class="linenos"> 834</span></a>        <span class="k">return</span> <span class="n">closure_segments</span>
</span><span id="Closures-835"><a href="#-835"><span class="linenos"> 835</span></a>
</span><span id="Closures-836"><a href="#-836"><span class="linenos"> 836</span></a>    <span class="k">def</span> <span class="nf">find_top_lith_horizons</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Closures-837"><a href="#-837"><span class="linenos"> 837</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="Closures-838"><a href="#-838"><span class="linenos"> 838</span></a><span class="sd">        Find horizons which are the top of layers where the lithology changes</span>
</span><span id="Closures-839"><a href="#-839"><span class="linenos"> 839</span></a>
</span><span id="Closures-840"><a href="#-840"><span class="linenos"> 840</span></a><span class="sd">        Combine layers of the same lithology and retain the top of these new layers for closure calculations.</span>
</span><span id="Closures-841"><a href="#-841"><span class="linenos"> 841</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Closures-842"><a href="#-842"><span class="linenos"> 842</span></a>        <span class="n">top_lith_indices</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">onlap_list</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="Closures-843"><a href="#-843"><span class="linenos"> 843</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">facies</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
</span><span id="Closures-844"><a href="#-844"><span class="linenos"> 844</span></a>            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Closures-845"><a href="#-845"><span class="linenos"> 845</span></a>                <span class="k">continue</span>
</span><span id="Closures-846"><a href="#-846"><span class="linenos"> 846</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="Closures-847"><a href="#-847"><span class="linenos"> 847</span></a>                <span class="sa">f</span><span class="s2">&quot;i: </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">, sand_layer_label[i-1]: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">facies</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">,&quot;</span>
</span><span id="Closures-848"><a href="#-848"><span class="linenos"> 848</span></a>                <span class="sa">f</span><span class="s2">&quot; sand_layer_label[i]: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">facies</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Closures-849"><a href="#-849"><span class="linenos"> 849</span></a>            <span class="p">)</span>
</span><span id="Closures-850"><a href="#-850"><span class="linenos"> 850</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">facies</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">facies</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]:</span>
</span><span id="Closures-851"><a href="#-851"><span class="linenos"> 851</span></a>                <span class="n">top_lith_indices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</span><span id="Closures-852"><a href="#-852"><span class="linenos"> 852</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Closures-853"><a href="#-853"><span class="linenos"> 853</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="Closures-854"><a href="#-854"><span class="linenos"> 854</span></a>                        <span class="s2">&quot;  ... layer lith different than layer above it. i = </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="Closures-855"><a href="#-855"><span class="linenos"> 855</span></a>                            <span class="n">i</span>
</span><span id="Closures-856"><a href="#-856"><span class="linenos"> 856</span></a>                        <span class="p">)</span>
</span><span id="Closures-857"><a href="#-857"><span class="linenos"> 857</span></a>                    <span class="p">)</span>
</span><span id="Closures-858"><a href="#-858"><span class="linenos"> 858</span></a>        <span class="n">top_lith_indices</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
</span><span id="Closures-859"><a href="#-859"><span class="linenos"> 859</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Closures-860"><a href="#-860"><span class="linenos"> 860</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="Closures-861"><a href="#-861"><span class="linenos"> 861</span></a>                <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">   ...layers selected for closure computations...</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="Closures-862"><a href="#-862"><span class="linenos"> 862</span></a>                <span class="n">top_lith_indices</span><span class="p">,</span>
</span><span id="Closures-863"><a href="#-863"><span class="linenos"> 863</span></a>            <span class="p">)</span>
</span><span id="Closures-864"><a href="#-864"><span class="linenos"> 864</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">top_lith_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">top_lith_indices</span><span class="p">)</span>
</span><span id="Closures-865"><a href="#-865"><span class="linenos"> 865</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">top_lith_facies</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">facies</span><span class="p">[</span><span class="n">top_lith_indices</span><span class="p">]</span>
</span><span id="Closures-866"><a href="#-866"><span class="linenos"> 866</span></a>
</span><span id="Closures-867"><a href="#-867"><span class="linenos"> 867</span></a>        <span class="c1"># return top_lith_indices</span>
</span><span id="Closures-868"><a href="#-868"><span class="linenos"> 868</span></a>
</span><span id="Closures-869"><a href="#-869"><span class="linenos"> 869</span></a>    <span class="k">def</span> <span class="nf">create_closures</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Closures-870"><a href="#-870"><span class="linenos"> 870</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Closures-871"><a href="#-871"><span class="linenos"> 871</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2"> ... create 3D labels for closure&quot;</span><span class="p">)</span>
</span><span id="Closures-872"><a href="#-872"><span class="linenos"> 872</span></a>
</span><span id="Closures-873"><a href="#-873"><span class="linenos"> 873</span></a>        <span class="c1"># Convert nan to 0&#39;s</span>
</span><span id="Closures-874"><a href="#-874"><span class="linenos"> 874</span></a>        <span class="n">old_depth_maps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">faulted_depth_maps</span><span class="p">[:],</span> <span class="n">copy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Closures-875"><a href="#-875"><span class="linenos"> 875</span></a>        <span class="n">old_depth_maps_gaps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span>
</span><span id="Closures-876"><a href="#-876"><span class="linenos"> 876</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">faulted_depth_maps_gaps</span><span class="p">[:],</span> <span class="n">copy</span><span class="o">=</span><span class="kc">True</span>
</span><span id="Closures-877"><a href="#-877"><span class="linenos"> 877</span></a>        <span class="p">)</span>
</span><span id="Closures-878"><a href="#-878"><span class="linenos"> 878</span></a>
</span><span id="Closures-879"><a href="#-879"><span class="linenos"> 879</span></a>        <span class="c1"># Convert from samples to units</span>
</span><span id="Closures-880"><a href="#-880"><span class="linenos"> 880</span></a>        <span class="n">old_depth_maps_gaps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">convert_map_from_samples_to_units</span><span class="p">(</span>
</span><span id="Closures-881"><a href="#-881"><span class="linenos"> 881</span></a>            <span class="n">old_depth_maps_gaps</span>
</span><span id="Closures-882"><a href="#-882"><span class="linenos"> 882</span></a>        <span class="p">)</span>
</span><span id="Closures-883"><a href="#-883"><span class="linenos"> 883</span></a>        <span class="n">old_depth_maps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">convert_map_from_samples_to_units</span><span class="p">(</span><span class="n">old_depth_maps</span><span class="p">)</span>
</span><span id="Closures-884"><a href="#-884"><span class="linenos"> 884</span></a>
</span><span id="Closures-885"><a href="#-885"><span class="linenos"> 885</span></a>        <span class="c1"># keep only horizons corresponding to top of layers where lithology changes</span>
</span><span id="Closures-886"><a href="#-886"><span class="linenos"> 886</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">find_top_lith_horizons</span><span class="p">()</span>
</span><span id="Closures-887"><a href="#-887"><span class="linenos"> 887</span></a>        <span class="n">all_lith_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">old_depth_maps</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</span><span id="Closures-888"><a href="#-888"><span class="linenos"> 888</span></a>        <span class="kn">import</span> <span class="nn">sys</span>
</span><span id="Closures-889"><a href="#-889"><span class="linenos"> 889</span></a>
</span><span id="Closures-890"><a href="#-890"><span class="linenos"> 890</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;All lith indices (last, then all):&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">facies</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">all_lith_indices</span><span class="p">)</span>
</span><span id="Closures-891"><a href="#-891"><span class="linenos"> 891</span></a>        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</span><span id="Closures-892"><a href="#-892"><span class="linenos"> 892</span></a>
</span><span id="Closures-893"><a href="#-893"><span class="linenos"> 893</span></a>        <span class="n">depth_maps_gaps_top_lith</span> <span class="o">=</span> <span class="n">old_depth_maps_gaps</span><span class="p">[</span>
</span><span id="Closures-894"><a href="#-894"><span class="linenos"> 894</span></a>            <span class="p">:,</span> <span class="p">:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top_lith_indices</span>
</span><span id="Closures-895"><a href="#-895"><span class="linenos"> 895</span></a>        <span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Closures-896"><a href="#-896"><span class="linenos"> 896</span></a>        <span class="n">depth_maps_gaps_all_lith</span> <span class="o">=</span> <span class="n">old_depth_maps_gaps</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">all_lith_indices</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Closures-897"><a href="#-897"><span class="linenos"> 897</span></a>        <span class="n">depth_maps_top_lith</span> <span class="o">=</span> <span class="n">old_depth_maps</span><span class="p">[:,</span> <span class="p">:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top_lith_indices</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Closures-898"><a href="#-898"><span class="linenos"> 898</span></a>        <span class="n">depth_maps_all_lith</span> <span class="o">=</span> <span class="n">old_depth_maps</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">all_lith_indices</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Closures-899"><a href="#-899"><span class="linenos"> 899</span></a>        <span class="n">max_column_heights</span> <span class="o">=</span> <span class="n">variable_max_column_height</span><span class="p">(</span>
</span><span id="Closures-900"><a href="#-900"><span class="linenos"> 900</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">top_lith_indices</span><span class="p">,</span>
</span><span id="Closures-901"><a href="#-901"><span class="linenos"> 901</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">faulted_depth_maps_gaps</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
</span><span id="Closures-902"><a href="#-902"><span class="linenos"> 902</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">max_column_height</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
</span><span id="Closures-903"><a href="#-903"><span class="linenos"> 903</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">max_column_height</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
</span><span id="Closures-904"><a href="#-904"><span class="linenos"> 904</span></a>        <span class="p">)</span>
</span><span id="Closures-905"><a href="#-905"><span class="linenos"> 905</span></a>        <span class="n">all_max_column_heights</span> <span class="o">=</span> <span class="n">variable_max_column_height</span><span class="p">(</span>
</span><span id="Closures-906"><a href="#-906"><span class="linenos"> 906</span></a>            <span class="n">all_lith_indices</span><span class="p">,</span>
</span><span id="Closures-907"><a href="#-907"><span class="linenos"> 907</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">faulted_depth_maps_gaps</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
</span><span id="Closures-908"><a href="#-908"><span class="linenos"> 908</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">max_column_height</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
</span><span id="Closures-909"><a href="#-909"><span class="linenos"> 909</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">max_column_height</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
</span><span id="Closures-910"><a href="#-910"><span class="linenos"> 910</span></a>        <span class="p">)</span>
</span><span id="Closures-911"><a href="#-911"><span class="linenos"> 911</span></a>
</span><span id="Closures-912"><a href="#-912"><span class="linenos"> 912</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Closures-913"><a href="#-913"><span class="linenos"> 913</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">   ...facies for closure computations...</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top_lith_facies</span><span class="p">)</span>
</span><span id="Closures-914"><a href="#-914"><span class="linenos"> 914</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="Closures-915"><a href="#-915"><span class="linenos"> 915</span></a>                <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">   ...max column heights for closure computations...</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="Closures-916"><a href="#-916"><span class="linenos"> 916</span></a>                <span class="n">max_column_heights</span><span class="p">,</span>
</span><span id="Closures-917"><a href="#-917"><span class="linenos"> 917</span></a>            <span class="p">)</span>
</span><span id="Closures-918"><a href="#-918"><span class="linenos"> 918</span></a>
</span><span id="Closures-919"><a href="#-919"><span class="linenos"> 919</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">closure_segments</span><span class="p">[:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_closure_labels_from_depth_maps</span><span class="p">(</span>
</span><span id="Closures-920"><a href="#-920"><span class="linenos"> 920</span></a>            <span class="n">depth_maps_gaps_top_lith</span><span class="p">,</span> <span class="n">depth_maps_top_lith</span><span class="p">,</span> <span class="n">max_column_heights</span>
</span><span id="Closures-921"><a href="#-921"><span class="linenos"> 921</span></a>        <span class="p">)</span>
</span><span id="Closures-922"><a href="#-922"><span class="linenos"> 922</span></a>
</span><span id="Closures-923"><a href="#-923"><span class="linenos"> 923</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">all_closure_segments</span><span class="p">[:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_closure_labels_from_all_depth_maps</span><span class="p">(</span>
</span><span id="Closures-924"><a href="#-924"><span class="linenos"> 924</span></a>            <span class="n">depth_maps_gaps_all_lith</span><span class="p">,</span> <span class="n">depth_maps_all_lith</span><span class="p">,</span> <span class="n">all_max_column_heights</span>
</span><span id="Closures-925"><a href="#-925"><span class="linenos"> 925</span></a>        <span class="p">)</span>
</span><span id="Closures-926"><a href="#-926"><span class="linenos"> 926</span></a>
</span><span id="Closures-927"><a href="#-927"><span class="linenos"> 927</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Closures-928"><a href="#-928"><span class="linenos"> 928</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="Closures-929"><a href="#-929"><span class="linenos"> 929</span></a>                <span class="s2">&quot;     ...+++... number of nan&#39;s in depth_maps_gaps before insertClosureLabels3D ...+++... </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="Closures-930"><a href="#-930"><span class="linenos"> 930</span></a>                    <span class="n">old_depth_maps_gaps</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">old_depth_maps_gaps</span><span class="p">)]</span><span class="o">.</span><span class="n">shape</span>
</span><span id="Closures-931"><a href="#-931"><span class="linenos"> 931</span></a>                <span class="p">)</span>
</span><span id="Closures-932"><a href="#-932"><span class="linenos"> 932</span></a>            <span class="p">)</span>
</span><span id="Closures-933"><a href="#-933"><span class="linenos"> 933</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="Closures-934"><a href="#-934"><span class="linenos"> 934</span></a>                <span class="s2">&quot;     ...+++... number of nan&#39;s in depth_maps_gaps after insertClosureLabels3D ...+++... </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="Closures-935"><a href="#-935"><span class="linenos"> 935</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">faulted_depth_maps_gaps</span><span class="p">[</span>
</span><span id="Closures-936"><a href="#-936"><span class="linenos"> 936</span></a>                        <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">faulted_depth_maps_gaps</span><span class="p">)</span>
</span><span id="Closures-937"><a href="#-937"><span class="linenos"> 937</span></a>                    <span class="p">]</span><span class="o">.</span><span class="n">shape</span>
</span><span id="Closures-938"><a href="#-938"><span class="linenos"> 938</span></a>                <span class="p">)</span>
</span><span id="Closures-939"><a href="#-939"><span class="linenos"> 939</span></a>            <span class="p">)</span>
</span><span id="Closures-940"><a href="#-940"><span class="linenos"> 940</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="Closures-941"><a href="#-941"><span class="linenos"> 941</span></a>                <span class="s2">&quot;     ...+++... number of nan&#39;s in depth_maps after insertClosureLabels3D ...+++... </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="Closures-942"><a href="#-942"><span class="linenos"> 942</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">faulted_depth_maps</span><span class="p">[</span>
</span><span id="Closures-943"><a href="#-943"><span class="linenos"> 943</span></a>                        <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">faulted_depth_maps</span><span class="p">)</span>
</span><span id="Closures-944"><a href="#-944"><span class="linenos"> 944</span></a>                    <span class="p">]</span><span class="o">.</span><span class="n">shape</span>
</span><span id="Closures-945"><a href="#-945"><span class="linenos"> 945</span></a>                <span class="p">)</span>
</span><span id="Closures-946"><a href="#-946"><span class="linenos"> 946</span></a>            <span class="p">)</span>
</span><span id="Closures-947"><a href="#-947"><span class="linenos"> 947</span></a>            <span class="n">_closure_segments</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">closure_segments</span><span class="p">[:]</span>
</span><span id="Closures-948"><a href="#-948"><span class="linenos"> 948</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="Closures-949"><a href="#-949"><span class="linenos"> 949</span></a>                <span class="s2">&quot;     ...+++... number of closure voxels in self.closure_segments ...+++... </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="Closures-950"><a href="#-950"><span class="linenos"> 950</span></a>                    <span class="n">_closure_segments</span><span class="p">[</span><span class="n">_closure_segments</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span>
</span><span id="Closures-951"><a href="#-951"><span class="linenos"> 951</span></a>                <span class="p">)</span>
</span><span id="Closures-952"><a href="#-952"><span class="linenos"> 952</span></a>            <span class="p">)</span>
</span><span id="Closures-953"><a href="#-953"><span class="linenos"> 953</span></a>            <span class="k">del</span> <span class="n">_closure_segments</span>
</span><span id="Closures-954"><a href="#-954"><span class="linenos"> 954</span></a>
</span><span id="Closures-955"><a href="#-955"><span class="linenos"> 955</span></a>        <span class="n">labels_clean</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">closure_segments</span><span class="p">[:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">segment_closures</span><span class="p">(</span>
</span><span id="Closures-956"><a href="#-956"><span class="linenos"> 956</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">closure_segments</span><span class="p">[:],</span> <span class="n">remove_shale</span><span class="o">=</span><span class="kc">True</span>
</span><span id="Closures-957"><a href="#-957"><span class="linenos"> 957</span></a>        <span class="p">)</span>
</span><span id="Closures-958"><a href="#-958"><span class="linenos"> 958</span></a>        <span class="n">label_values</span><span class="p">,</span> <span class="n">labels_clean</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_label_values_and_counts</span><span class="p">(</span><span class="n">labels_clean</span><span class="p">)</span>
</span><span id="Closures-959"><a href="#-959"><span class="linenos"> 959</span></a>
</span><span id="Closures-960"><a href="#-960"><span class="linenos"> 960</span></a>        <span class="n">labels_clean_all</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_closure_segments</span><span class="p">[:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">segment_closures</span><span class="p">(</span>
</span><span id="Closures-961"><a href="#-961"><span class="linenos"> 961</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">all_closure_segments</span><span class="p">[:],</span> <span class="n">remove_shale</span><span class="o">=</span><span class="kc">False</span>
</span><span id="Closures-962"><a href="#-962"><span class="linenos"> 962</span></a>        <span class="p">)</span>
</span><span id="Closures-963"><a href="#-963"><span class="linenos"> 963</span></a>        <span class="n">label_values_all</span><span class="p">,</span> <span class="n">labels_clean_all</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_label_values_and_counts</span><span class="p">(</span>
</span><span id="Closures-964"><a href="#-964"><span class="linenos"> 964</span></a>            <span class="n">labels_clean_all</span>
</span><span id="Closures-965"><a href="#-965"><span class="linenos"> 965</span></a>        <span class="p">)</span>
</span><span id="Closures-966"><a href="#-966"><span class="linenos"> 966</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">write_cube_to_disk</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">all_closure_segments</span><span class="p">[:],</span> <span class="s2">&quot;all_closure_segments&quot;</span><span class="p">)</span>
</span><span id="Closures-967"><a href="#-967"><span class="linenos"> 967</span></a>
</span><span id="Closures-968"><a href="#-968"><span class="linenos"> 968</span></a>        <span class="c1"># Assign fluid types</span>
</span><span id="Closures-969"><a href="#-969"><span class="linenos"> 969</span></a>        <span class="p">(</span>
</span><span id="Closures-970"><a href="#-970"><span class="linenos"> 970</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">oil_closures</span><span class="p">[:],</span>
</span><span id="Closures-971"><a href="#-971"><span class="linenos"> 971</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">gas_closures</span><span class="p">[:],</span>
</span><span id="Closures-972"><a href="#-972"><span class="linenos"> 972</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">brine_closures</span><span class="p">[:],</span>
</span><span id="Closures-973"><a href="#-973"><span class="linenos"> 973</span></a>        <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assign_fluid_types</span><span class="p">(</span><span class="n">label_values</span><span class="p">,</span> <span class="n">labels_clean</span><span class="p">)</span>
</span><span id="Closures-974"><a href="#-974"><span class="linenos"> 974</span></a>        <span class="n">all_closures_final</span> <span class="o">=</span> <span class="p">(</span><span class="n">labels_clean_all</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;uint8&quot;</span><span class="p">)</span>
</span><span id="Closures-975"><a href="#-975"><span class="linenos"> 975</span></a>
</span><span id="Closures-976"><a href="#-976"><span class="linenos"> 976</span></a>        <span class="c1"># Identify closures by type (simple, faulted, onlap or salt bounded)</span>
</span><span id="Closures-977"><a href="#-977"><span class="linenos"> 977</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">find_faulted_closures</span><span class="p">(</span><span class="n">label_values</span><span class="p">,</span> <span class="n">labels_clean</span><span class="p">)</span>
</span><span id="Closures-978"><a href="#-978"><span class="linenos"> 978</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">find_onlap_closures</span><span class="p">(</span><span class="n">label_values</span><span class="p">,</span> <span class="n">labels_clean</span><span class="p">)</span>
</span><span id="Closures-979"><a href="#-979"><span class="linenos"> 979</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">find_simple_closures</span><span class="p">(</span><span class="n">label_values</span><span class="p">,</span> <span class="n">labels_clean</span><span class="p">)</span>
</span><span id="Closures-980"><a href="#-980"><span class="linenos"> 980</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">find_false_closures</span><span class="p">(</span><span class="n">label_values</span><span class="p">,</span> <span class="n">labels_clean</span><span class="p">)</span>
</span><span id="Closures-981"><a href="#-981"><span class="linenos"> 981</span></a>
</span><span id="Closures-982"><a href="#-982"><span class="linenos"> 982</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">find_faulted_all_closures</span><span class="p">(</span><span class="n">label_values_all</span><span class="p">,</span> <span class="n">labels_clean_all</span><span class="p">)</span>
</span><span id="Closures-983"><a href="#-983"><span class="linenos"> 983</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">find_onlap_all_closures</span><span class="p">(</span><span class="n">label_values_all</span><span class="p">,</span> <span class="n">labels_clean_all</span><span class="p">)</span>
</span><span id="Closures-984"><a href="#-984"><span class="linenos"> 984</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">find_simple_all_closures</span><span class="p">(</span><span class="n">label_values_all</span><span class="p">,</span> <span class="n">labels_clean_all</span><span class="p">)</span>
</span><span id="Closures-985"><a href="#-985"><span class="linenos"> 985</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">find_false_all_closures</span><span class="p">(</span><span class="n">label_values_all</span><span class="p">,</span> <span class="n">labels_clean_all</span><span class="p">)</span>
</span><span id="Closures-986"><a href="#-986"><span class="linenos"> 986</span></a>
</span><span id="Closures-987"><a href="#-987"><span class="linenos"> 987</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">include_salt</span><span class="p">:</span>
</span><span id="Closures-988"><a href="#-988"><span class="linenos"> 988</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">find_salt_bounded_closures</span><span class="p">(</span><span class="n">label_values</span><span class="p">,</span> <span class="n">labels_clean</span><span class="p">)</span>
</span><span id="Closures-989"><a href="#-989"><span class="linenos"> 989</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">find_salt_bounded_all_closures</span><span class="p">(</span><span class="n">label_values_all</span><span class="p">,</span> <span class="n">labels_clean_all</span><span class="p">)</span>
</span><span id="Closures-990"><a href="#-990"><span class="linenos"> 990</span></a>
</span><span id="Closures-991"><a href="#-991"><span class="linenos"> 991</span></a>        <span class="c1"># Remove false closures from oil &amp; gas closure cubes</span>
</span><span id="Closures-992"><a href="#-992"><span class="linenos"> 992</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_false_closures_oil</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Closures-993"><a href="#-993"><span class="linenos"> 993</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Removing </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">n_false_closures_oil</span><span class="si">}</span><span class="s2"> false oil closures&quot;</span><span class="p">)</span>
</span><span id="Closures-994"><a href="#-994"><span class="linenos"> 994</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">oil_closures</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">false_closures_oil</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="Closures-995"><a href="#-995"><span class="linenos"> 995</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_false_closures_gas</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Closures-996"><a href="#-996"><span class="linenos"> 996</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Removing </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">n_false_closures_gas</span><span class="si">}</span><span class="s2"> false gas closures&quot;</span><span class="p">)</span>
</span><span id="Closures-997"><a href="#-997"><span class="linenos"> 997</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">gas_closures</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">false_closures_gas</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="Closures-998"><a href="#-998"><span class="linenos"> 998</span></a>
</span><span id="Closures-999"><a href="#-999"><span class="linenos"> 999</span></a>        <span class="c1"># Remove false closures from allclosure cube</span>
</span><span id="Closures-1000"><a href="#-1000"><span class="linenos">1000</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_false_all_closures</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Closures-1001"><a href="#-1001"><span class="linenos">1001</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Removing </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">n_false_all_closures</span><span class="si">}</span><span class="s2"> false all closures&quot;</span><span class="p">)</span>
</span><span id="Closures-1002"><a href="#-1002"><span class="linenos">1002</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">all_closure_segments</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">false_all_closures</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="Closures-1003"><a href="#-1003"><span class="linenos">1003</span></a>
</span><span id="Closures-1004"><a href="#-1004"><span class="linenos">1004</span></a>        <span class="c1"># Create a closure cube with voxel count as labels, and include closure type in decimal</span>
</span><span id="Closures-1005"><a href="#-1005"><span class="linenos">1005</span></a>        <span class="c1"># e.g. simple closure of size 5000 = 5000.1</span>
</span><span id="Closures-1006"><a href="#-1006"><span class="linenos">1006</span></a>        <span class="c1">#      faulted closure of size 5000 = 5000.2</span>
</span><span id="Closures-1007"><a href="#-1007"><span class="linenos">1007</span></a>        <span class="c1">#      onlap closure of size 5000 = 5000.3</span>
</span><span id="Closures-1008"><a href="#-1008"><span class="linenos">1008</span></a>        <span class="c1">#      salt-bounded closure of size 5000 = 5000.4</span>
</span><span id="Closures-1009"><a href="#-1009"><span class="linenos">1009</span></a>        <span class="n">hc_closure_codes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gas_closures</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;float32&quot;</span><span class="p">)</span>
</span><span id="Closures-1010"><a href="#-1010"><span class="linenos">1010</span></a>
</span><span id="Closures-1011"><a href="#-1011"><span class="linenos">1011</span></a>        <span class="c1"># AZ: COULD RUN THESE CLOSURE SIZE FILTERS ON ALL_CLOSURES, IF DESIRED</span>
</span><span id="Closures-1012"><a href="#-1012"><span class="linenos">1012</span></a>
</span><span id="Closures-1013"><a href="#-1013"><span class="linenos">1013</span></a>        <span class="k">if</span> <span class="s2">&quot;simple&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">closure_types</span><span class="p">:</span>
</span><span id="Closures-1014"><a href="#-1014"><span class="linenos">1014</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Filtering 4 Way Closures&quot;</span><span class="p">)</span>
</span><span id="Closures-1015"><a href="#-1015"><span class="linenos">1015</span></a>            <span class="p">(</span>
</span><span id="Closures-1016"><a href="#-1016"><span class="linenos">1016</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">simple_closures_oil</span><span class="p">[:],</span>
</span><span id="Closures-1017"><a href="#-1017"><span class="linenos">1017</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">n_4way_closures_oil</span><span class="p">,</span>
</span><span id="Closures-1018"><a href="#-1018"><span class="linenos">1018</span></a>            <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">closure_size_filter</span><span class="p">(</span>
</span><span id="Closures-1019"><a href="#-1019"><span class="linenos">1019</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">simple_closures_oil</span><span class="p">[:],</span>
</span><span id="Closures-1020"><a href="#-1020"><span class="linenos">1020</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">closure_min_voxels_simple</span><span class="p">,</span>
</span><span id="Closures-1021"><a href="#-1021"><span class="linenos">1021</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">n_4way_closures_oil</span><span class="p">,</span>
</span><span id="Closures-1022"><a href="#-1022"><span class="linenos">1022</span></a>            <span class="p">)</span>
</span><span id="Closures-1023"><a href="#-1023"><span class="linenos">1023</span></a>            <span class="p">(</span>
</span><span id="Closures-1024"><a href="#-1024"><span class="linenos">1024</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">simple_closures_gas</span><span class="p">[:],</span>
</span><span id="Closures-1025"><a href="#-1025"><span class="linenos">1025</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">n_4way_closures_gas</span><span class="p">,</span>
</span><span id="Closures-1026"><a href="#-1026"><span class="linenos">1026</span></a>            <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">closure_size_filter</span><span class="p">(</span>
</span><span id="Closures-1027"><a href="#-1027"><span class="linenos">1027</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">simple_closures_gas</span><span class="p">[:],</span>
</span><span id="Closures-1028"><a href="#-1028"><span class="linenos">1028</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">closure_min_voxels_simple</span><span class="p">,</span>
</span><span id="Closures-1029"><a href="#-1029"><span class="linenos">1029</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">n_4way_closures_gas</span><span class="p">,</span>
</span><span id="Closures-1030"><a href="#-1030"><span class="linenos">1030</span></a>            <span class="p">)</span>
</span><span id="Closures-1031"><a href="#-1031"><span class="linenos">1031</span></a>
</span><span id="Closures-1032"><a href="#-1032"><span class="linenos">1032</span></a>            <span class="c1"># Add simple closures to closure code cube</span>
</span><span id="Closures-1033"><a href="#-1033"><span class="linenos">1033</span></a>            <span class="n">hc_closures</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="Closures-1034"><a href="#-1034"><span class="linenos">1034</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">simple_closures_oil</span><span class="p">[:]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">simple_closures_gas</span><span class="p">[:]</span>
</span><span id="Closures-1035"><a href="#-1035"><span class="linenos">1035</span></a>            <span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;float32&quot;</span><span class="p">)</span>
</span><span id="Closures-1036"><a href="#-1036"><span class="linenos">1036</span></a>            <span class="n">labels</span><span class="p">,</span> <span class="n">num</span> <span class="o">=</span> <span class="n">measure</span><span class="o">.</span><span class="n">label</span><span class="p">(</span>
</span><span id="Closures-1037"><a href="#-1037"><span class="linenos">1037</span></a>                <span class="n">hc_closures</span><span class="p">,</span> <span class="n">connectivity</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">background</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">return_num</span><span class="o">=</span><span class="kc">True</span>
</span><span id="Closures-1038"><a href="#-1038"><span class="linenos">1038</span></a>            <span class="p">)</span>
</span><span id="Closures-1039"><a href="#-1039"><span class="linenos">1039</span></a>            <span class="n">hc_closure_codes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_closure_codes</span><span class="p">(</span>
</span><span id="Closures-1040"><a href="#-1040"><span class="linenos">1040</span></a>                <span class="n">hc_closure_codes</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">num</span><span class="p">,</span> <span class="n">code</span><span class="o">=</span><span class="mf">0.1</span>
</span><span id="Closures-1041"><a href="#-1041"><span class="linenos">1041</span></a>            <span class="p">)</span>
</span><span id="Closures-1042"><a href="#-1042"><span class="linenos">1042</span></a>        <span class="k">else</span><span class="p">:</span>  <span class="c1"># if closure type not in config, set HC closures to 0</span>
</span><span id="Closures-1043"><a href="#-1043"><span class="linenos">1043</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">simple_closures_oil</span><span class="p">[:]</span> <span class="o">*=</span> <span class="mi">0</span>
</span><span id="Closures-1044"><a href="#-1044"><span class="linenos">1044</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">simple_closures_gas</span><span class="p">[:]</span> <span class="o">*=</span> <span class="mi">0</span>
</span><span id="Closures-1045"><a href="#-1045"><span class="linenos">1045</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">simple_all_closures</span><span class="p">[:]</span> <span class="o">*=</span> <span class="mi">0</span>
</span><span id="Closures-1046"><a href="#-1046"><span class="linenos">1046</span></a>
</span><span id="Closures-1047"><a href="#-1047"><span class="linenos">1047</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">oil_closures</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">simple_closures_oil</span><span class="p">[:]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="Closures-1048"><a href="#-1048"><span class="linenos">1048</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">oil_closures</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">simple_closures_oil</span><span class="p">[:]</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="Closures-1049"><a href="#-1049"><span class="linenos">1049</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gas_closures</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">simple_closures_gas</span><span class="p">[:]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="Closures-1050"><a href="#-1050"><span class="linenos">1050</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gas_closures</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">simple_closures_gas</span><span class="p">[:]</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="Closures-1051"><a href="#-1051"><span class="linenos">1051</span></a>
</span><span id="Closures-1052"><a href="#-1052"><span class="linenos">1052</span></a>        <span class="n">all_closures_final</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">simple_all_closures</span><span class="p">[:]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="Closures-1053"><a href="#-1053"><span class="linenos">1053</span></a>        <span class="n">all_closures_final</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">simple_all_closures</span><span class="p">[:]</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="Closures-1054"><a href="#-1054"><span class="linenos">1054</span></a>
</span><span id="Closures-1055"><a href="#-1055"><span class="linenos">1055</span></a>        <span class="k">if</span> <span class="s2">&quot;faulted&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">closure_types</span><span class="p">:</span>
</span><span id="Closures-1056"><a href="#-1056"><span class="linenos">1056</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Filtering 4 Way Closures&quot;</span><span class="p">)</span>
</span><span id="Closures-1057"><a href="#-1057"><span class="linenos">1057</span></a>            <span class="c1"># Grow the faulted closures to the fault planes</span>
</span><span id="Closures-1058"><a href="#-1058"><span class="linenos">1058</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">faulted_closures_oil</span><span class="p">[:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grow_to_fault2</span><span class="p">(</span>
</span><span id="Closures-1059"><a href="#-1059"><span class="linenos">1059</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">faulted_closures_oil</span><span class="p">[:]</span>
</span><span id="Closures-1060"><a href="#-1060"><span class="linenos">1060</span></a>            <span class="p">)</span>
</span><span id="Closures-1061"><a href="#-1061"><span class="linenos">1061</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">faulted_closures_gas</span><span class="p">[:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grow_to_fault2</span><span class="p">(</span>
</span><span id="Closures-1062"><a href="#-1062"><span class="linenos">1062</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">faulted_closures_gas</span><span class="p">[:]</span>
</span><span id="Closures-1063"><a href="#-1063"><span class="linenos">1063</span></a>            <span class="p">)</span>
</span><span id="Closures-1064"><a href="#-1064"><span class="linenos">1064</span></a>
</span><span id="Closures-1065"><a href="#-1065"><span class="linenos">1065</span></a>            <span class="p">(</span>
</span><span id="Closures-1066"><a href="#-1066"><span class="linenos">1066</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">faulted_closures_oil</span><span class="p">[:],</span>
</span><span id="Closures-1067"><a href="#-1067"><span class="linenos">1067</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">n_fault_closures_oil</span><span class="p">,</span>
</span><span id="Closures-1068"><a href="#-1068"><span class="linenos">1068</span></a>            <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">closure_size_filter</span><span class="p">(</span>
</span><span id="Closures-1069"><a href="#-1069"><span class="linenos">1069</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">faulted_closures_oil</span><span class="p">[:],</span>
</span><span id="Closures-1070"><a href="#-1070"><span class="linenos">1070</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">closure_min_voxels_faulted</span><span class="p">,</span>
</span><span id="Closures-1071"><a href="#-1071"><span class="linenos">1071</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">n_fault_closures_oil</span><span class="p">,</span>
</span><span id="Closures-1072"><a href="#-1072"><span class="linenos">1072</span></a>            <span class="p">)</span>
</span><span id="Closures-1073"><a href="#-1073"><span class="linenos">1073</span></a>            <span class="p">(</span>
</span><span id="Closures-1074"><a href="#-1074"><span class="linenos">1074</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">faulted_closures_gas</span><span class="p">[:],</span>
</span><span id="Closures-1075"><a href="#-1075"><span class="linenos">1075</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">n_fault_closures_gas</span><span class="p">,</span>
</span><span id="Closures-1076"><a href="#-1076"><span class="linenos">1076</span></a>            <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">closure_size_filter</span><span class="p">(</span>
</span><span id="Closures-1077"><a href="#-1077"><span class="linenos">1077</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">faulted_closures_gas</span><span class="p">[:],</span>
</span><span id="Closures-1078"><a href="#-1078"><span class="linenos">1078</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">closure_min_voxels_faulted</span><span class="p">,</span>
</span><span id="Closures-1079"><a href="#-1079"><span class="linenos">1079</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">n_fault_closures_gas</span><span class="p">,</span>
</span><span id="Closures-1080"><a href="#-1080"><span class="linenos">1080</span></a>            <span class="p">)</span>
</span><span id="Closures-1081"><a href="#-1081"><span class="linenos">1081</span></a>
</span><span id="Closures-1082"><a href="#-1082"><span class="linenos">1082</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">faulted_all_closures</span><span class="p">[:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grow_to_fault2</span><span class="p">(</span>
</span><span id="Closures-1083"><a href="#-1083"><span class="linenos">1083</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">faulted_all_closures</span><span class="p">[:],</span>
</span><span id="Closures-1084"><a href="#-1084"><span class="linenos">1084</span></a>                <span class="n">grow_only_sand_closures</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="Closures-1085"><a href="#-1085"><span class="linenos">1085</span></a>                <span class="n">remove_small_closures</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="Closures-1086"><a href="#-1086"><span class="linenos">1086</span></a>            <span class="p">)</span>
</span><span id="Closures-1087"><a href="#-1087"><span class="linenos">1087</span></a>
</span><span id="Closures-1088"><a href="#-1088"><span class="linenos">1088</span></a>            <span class="c1"># Add faulted closures to closure code cube</span>
</span><span id="Closures-1089"><a href="#-1089"><span class="linenos">1089</span></a>            <span class="n">hc_closures</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">faulted_closures_oil</span><span class="p">[:]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">faulted_closures_gas</span><span class="p">[:]</span>
</span><span id="Closures-1090"><a href="#-1090"><span class="linenos">1090</span></a>            <span class="n">labels</span><span class="p">,</span> <span class="n">num</span> <span class="o">=</span> <span class="n">measure</span><span class="o">.</span><span class="n">label</span><span class="p">(</span>
</span><span id="Closures-1091"><a href="#-1091"><span class="linenos">1091</span></a>                <span class="n">hc_closures</span><span class="p">,</span> <span class="n">connectivity</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">background</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">return_num</span><span class="o">=</span><span class="kc">True</span>
</span><span id="Closures-1092"><a href="#-1092"><span class="linenos">1092</span></a>            <span class="p">)</span>
</span><span id="Closures-1093"><a href="#-1093"><span class="linenos">1093</span></a>            <span class="n">hc_closure_codes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_closure_codes</span><span class="p">(</span>
</span><span id="Closures-1094"><a href="#-1094"><span class="linenos">1094</span></a>                <span class="n">hc_closure_codes</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">num</span><span class="p">,</span> <span class="n">code</span><span class="o">=</span><span class="mf">0.2</span>
</span><span id="Closures-1095"><a href="#-1095"><span class="linenos">1095</span></a>            <span class="p">)</span>
</span><span id="Closures-1096"><a href="#-1096"><span class="linenos">1096</span></a>        <span class="k">else</span><span class="p">:</span>  <span class="c1"># if closure type not in config, set HC closures to 0</span>
</span><span id="Closures-1097"><a href="#-1097"><span class="linenos">1097</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">faulted_closures_oil</span><span class="p">[:]</span> <span class="o">*=</span> <span class="mi">0</span>
</span><span id="Closures-1098"><a href="#-1098"><span class="linenos">1098</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">faulted_closures_gas</span><span class="p">[:]</span> <span class="o">*=</span> <span class="mi">0</span>
</span><span id="Closures-1099"><a href="#-1099"><span class="linenos">1099</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">faulted_all_closures</span><span class="p">[:]</span> <span class="o">*=</span> <span class="mi">0</span>
</span><span id="Closures-1100"><a href="#-1100"><span class="linenos">1100</span></a>
</span><span id="Closures-1101"><a href="#-1101"><span class="linenos">1101</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">oil_closures</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">faulted_closures_oil</span><span class="p">[:]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="Closures-1102"><a href="#-1102"><span class="linenos">1102</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">oil_closures</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">faulted_closures_oil</span><span class="p">[:]</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="Closures-1103"><a href="#-1103"><span class="linenos">1103</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gas_closures</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">faulted_closures_gas</span><span class="p">[:]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="Closures-1104"><a href="#-1104"><span class="linenos">1104</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gas_closures</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">faulted_closures_gas</span><span class="p">[:]</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="Closures-1105"><a href="#-1105"><span class="linenos">1105</span></a>
</span><span id="Closures-1106"><a href="#-1106"><span class="linenos">1106</span></a>        <span class="n">all_closures_final</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">faulted_all_closures</span><span class="p">[:]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="Closures-1107"><a href="#-1107"><span class="linenos">1107</span></a>        <span class="n">all_closures_final</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">faulted_all_closures</span><span class="p">[:]</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="Closures-1108"><a href="#-1108"><span class="linenos">1108</span></a>
</span><span id="Closures-1109"><a href="#-1109"><span class="linenos">1109</span></a>        <span class="k">if</span> <span class="s2">&quot;onlap&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">closure_types</span><span class="p">:</span>
</span><span id="Closures-1110"><a href="#-1110"><span class="linenos">1110</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Filtering Onlap Closures&quot;</span><span class="p">)</span>
</span><span id="Closures-1111"><a href="#-1111"><span class="linenos">1111</span></a>            <span class="p">(</span>
</span><span id="Closures-1112"><a href="#-1112"><span class="linenos">1112</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">onlap_closures_oil</span><span class="p">[:],</span>
</span><span id="Closures-1113"><a href="#-1113"><span class="linenos">1113</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">n_onlap_closures_oil</span><span class="p">,</span>
</span><span id="Closures-1114"><a href="#-1114"><span class="linenos">1114</span></a>            <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">closure_size_filter</span><span class="p">(</span>
</span><span id="Closures-1115"><a href="#-1115"><span class="linenos">1115</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">onlap_closures_oil</span><span class="p">[:],</span>
</span><span id="Closures-1116"><a href="#-1116"><span class="linenos">1116</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">closure_min_voxels_onlap</span><span class="p">,</span>
</span><span id="Closures-1117"><a href="#-1117"><span class="linenos">1117</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">n_onlap_closures_oil</span><span class="p">,</span>
</span><span id="Closures-1118"><a href="#-1118"><span class="linenos">1118</span></a>            <span class="p">)</span>
</span><span id="Closures-1119"><a href="#-1119"><span class="linenos">1119</span></a>            <span class="p">(</span>
</span><span id="Closures-1120"><a href="#-1120"><span class="linenos">1120</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">onlap_closures_gas</span><span class="p">[:],</span>
</span><span id="Closures-1121"><a href="#-1121"><span class="linenos">1121</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">n_onlap_closures_gas</span><span class="p">,</span>
</span><span id="Closures-1122"><a href="#-1122"><span class="linenos">1122</span></a>            <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">closure_size_filter</span><span class="p">(</span>
</span><span id="Closures-1123"><a href="#-1123"><span class="linenos">1123</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">onlap_closures_gas</span><span class="p">[:],</span>
</span><span id="Closures-1124"><a href="#-1124"><span class="linenos">1124</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">closure_min_voxels_onlap</span><span class="p">,</span>
</span><span id="Closures-1125"><a href="#-1125"><span class="linenos">1125</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">n_onlap_closures_gas</span><span class="p">,</span>
</span><span id="Closures-1126"><a href="#-1126"><span class="linenos">1126</span></a>            <span class="p">)</span>
</span><span id="Closures-1127"><a href="#-1127"><span class="linenos">1127</span></a>
</span><span id="Closures-1128"><a href="#-1128"><span class="linenos">1128</span></a>            <span class="c1"># Add faulted closures to closure code cube</span>
</span><span id="Closures-1129"><a href="#-1129"><span class="linenos">1129</span></a>            <span class="n">hc_closures</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">onlap_closures_oil</span><span class="p">[:]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">onlap_closures_gas</span><span class="p">[:]</span>
</span><span id="Closures-1130"><a href="#-1130"><span class="linenos">1130</span></a>            <span class="n">labels</span><span class="p">,</span> <span class="n">num</span> <span class="o">=</span> <span class="n">measure</span><span class="o">.</span><span class="n">label</span><span class="p">(</span>
</span><span id="Closures-1131"><a href="#-1131"><span class="linenos">1131</span></a>                <span class="n">hc_closures</span><span class="p">,</span> <span class="n">connectivity</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">background</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">return_num</span><span class="o">=</span><span class="kc">True</span>
</span><span id="Closures-1132"><a href="#-1132"><span class="linenos">1132</span></a>            <span class="p">)</span>
</span><span id="Closures-1133"><a href="#-1133"><span class="linenos">1133</span></a>            <span class="n">hc_closure_codes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_closure_codes</span><span class="p">(</span>
</span><span id="Closures-1134"><a href="#-1134"><span class="linenos">1134</span></a>                <span class="n">hc_closure_codes</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">num</span><span class="p">,</span> <span class="n">code</span><span class="o">=</span><span class="mf">0.3</span>
</span><span id="Closures-1135"><a href="#-1135"><span class="linenos">1135</span></a>            <span class="p">)</span>
</span><span id="Closures-1136"><a href="#-1136"><span class="linenos">1136</span></a>            <span class="c1"># labels = labels.astype(&#39;float32&#39;)</span>
</span><span id="Closures-1137"><a href="#-1137"><span class="linenos">1137</span></a>            <span class="c1"># if num &gt; 0:</span>
</span><span id="Closures-1138"><a href="#-1138"><span class="linenos">1138</span></a>            <span class="c1">#     for x in range(1, num + 1):</span>
</span><span id="Closures-1139"><a href="#-1139"><span class="linenos">1139</span></a>            <span class="c1">#         y = 0.3 + labels[labels == x].size</span>
</span><span id="Closures-1140"><a href="#-1140"><span class="linenos">1140</span></a>            <span class="c1">#         labels[labels == x] = y</span>
</span><span id="Closures-1141"><a href="#-1141"><span class="linenos">1141</span></a>            <span class="c1">#     hc_closure_codes += labels</span>
</span><span id="Closures-1142"><a href="#-1142"><span class="linenos">1142</span></a>        <span class="k">else</span><span class="p">:</span>  <span class="c1"># if closure type not in config, set HC closures to 0</span>
</span><span id="Closures-1143"><a href="#-1143"><span class="linenos">1143</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">onlap_closures_oil</span><span class="p">[:]</span> <span class="o">*=</span> <span class="mi">0</span>
</span><span id="Closures-1144"><a href="#-1144"><span class="linenos">1144</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">onlap_closures_gas</span><span class="p">[:]</span> <span class="o">*=</span> <span class="mi">0</span>
</span><span id="Closures-1145"><a href="#-1145"><span class="linenos">1145</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">onlap_all_closures</span><span class="p">[:]</span> <span class="o">*=</span> <span class="mi">0</span>
</span><span id="Closures-1146"><a href="#-1146"><span class="linenos">1146</span></a>
</span><span id="Closures-1147"><a href="#-1147"><span class="linenos">1147</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">oil_closures</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">onlap_closures_oil</span><span class="p">[:]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="Closures-1148"><a href="#-1148"><span class="linenos">1148</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">oil_closures</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">onlap_closures_oil</span><span class="p">[:]</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="Closures-1149"><a href="#-1149"><span class="linenos">1149</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gas_closures</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">onlap_closures_gas</span><span class="p">[:]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="Closures-1150"><a href="#-1150"><span class="linenos">1150</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gas_closures</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">onlap_closures_gas</span><span class="p">[:]</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="Closures-1151"><a href="#-1151"><span class="linenos">1151</span></a>        <span class="n">all_closures_final</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">onlap_all_closures</span><span class="p">[:]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="Closures-1152"><a href="#-1152"><span class="linenos">1152</span></a>        <span class="n">all_closures_final</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">onlap_all_closures</span><span class="p">[:]</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="Closures-1153"><a href="#-1153"><span class="linenos">1153</span></a>
</span><span id="Closures-1154"><a href="#-1154"><span class="linenos">1154</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">include_salt</span><span class="p">:</span>
</span><span id="Closures-1155"><a href="#-1155"><span class="linenos">1155</span></a>            <span class="c1"># Grow the salt-bounded closures to the salt body</span>
</span><span id="Closures-1156"><a href="#-1156"><span class="linenos">1156</span></a>            <span class="n">salt_closures_oil_grown</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">salt_closures_oil</span><span class="p">[:])</span>
</span><span id="Closures-1157"><a href="#-1157"><span class="linenos">1157</span></a>            <span class="n">salt_closures_gas_grown</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">salt_closures_gas</span><span class="p">[:])</span>
</span><span id="Closures-1158"><a href="#-1158"><span class="linenos">1158</span></a>
</span><span id="Closures-1159"><a href="#-1159"><span class="linenos">1159</span></a>            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">salt_closures_oil</span><span class="p">[:])</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
</span><span id="Closures-1160"><a href="#-1160"><span class="linenos">1160</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">write_cube_to_disk</span><span class="p">(</span>
</span><span id="Closures-1161"><a href="#-1161"><span class="linenos">1161</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">salt_closures_oil</span><span class="p">[:],</span> <span class="s2">&quot;salt_closures_oil_initial&quot;</span>
</span><span id="Closures-1162"><a href="#-1162"><span class="linenos">1162</span></a>                <span class="p">)</span>
</span><span id="Closures-1163"><a href="#-1163"><span class="linenos">1163</span></a>                <span class="nb">print</span><span class="p">(</span>
</span><span id="Closures-1164"><a href="#-1164"><span class="linenos">1164</span></a>                    <span class="sa">f</span><span class="s2">&quot;Salt-bounded Oil Closure voxel count: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">salt_closures_oil</span><span class="p">[:][</span><span class="bp">self</span><span class="o">.</span><span class="n">salt_closures_oil</span><span class="p">[:]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Closures-1165"><a href="#-1165"><span class="linenos">1165</span></a>                <span class="p">)</span>
</span><span id="Closures-1166"><a href="#-1166"><span class="linenos">1166</span></a>                <span class="n">salt_closures_oil_grown</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grow_to_salt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">salt_closures_oil</span><span class="p">[:])</span>
</span><span id="Closures-1167"><a href="#-1167"><span class="linenos">1167</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">salt_closures_oil</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">salt_closures_oil_grown</span>
</span><span id="Closures-1168"><a href="#-1168"><span class="linenos">1168</span></a>                <span class="nb">print</span><span class="p">(</span>
</span><span id="Closures-1169"><a href="#-1169"><span class="linenos">1169</span></a>                    <span class="sa">f</span><span class="s2">&quot;Salt-bounded Oil Closure voxel count: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">salt_closures_oil</span><span class="p">[:][</span><span class="bp">self</span><span class="o">.</span><span class="n">salt_closures_oil</span><span class="p">[:]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Closures-1170"><a href="#-1170"><span class="linenos">1170</span></a>                <span class="p">)</span>
</span><span id="Closures-1171"><a href="#-1171"><span class="linenos">1171</span></a>            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">salt_closures_gas</span><span class="p">[:])</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
</span><span id="Closures-1172"><a href="#-1172"><span class="linenos">1172</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">write_cube_to_disk</span><span class="p">(</span>
</span><span id="Closures-1173"><a href="#-1173"><span class="linenos">1173</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">salt_closures_gas</span><span class="p">[:],</span> <span class="s2">&quot;salt_closures_gas_initial&quot;</span>
</span><span id="Closures-1174"><a href="#-1174"><span class="linenos">1174</span></a>                <span class="p">)</span>
</span><span id="Closures-1175"><a href="#-1175"><span class="linenos">1175</span></a>                <span class="nb">print</span><span class="p">(</span>
</span><span id="Closures-1176"><a href="#-1176"><span class="linenos">1176</span></a>                    <span class="sa">f</span><span class="s2">&quot;Salt-bounded Gas Closure voxel count: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">salt_closures_gas</span><span class="p">[:][</span><span class="bp">self</span><span class="o">.</span><span class="n">salt_closures_gas</span><span class="p">[:]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Closures-1177"><a href="#-1177"><span class="linenos">1177</span></a>                <span class="p">)</span>
</span><span id="Closures-1178"><a href="#-1178"><span class="linenos">1178</span></a>                <span class="n">salt_closures_gas_grown</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grow_to_salt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">salt_closures_gas</span><span class="p">[:])</span>
</span><span id="Closures-1179"><a href="#-1179"><span class="linenos">1179</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">salt_closures_gas</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">salt_closures_gas_grown</span>
</span><span id="Closures-1180"><a href="#-1180"><span class="linenos">1180</span></a>                <span class="nb">print</span><span class="p">(</span>
</span><span id="Closures-1181"><a href="#-1181"><span class="linenos">1181</span></a>                    <span class="sa">f</span><span class="s2">&quot;Salt-bounded Gas Closure voxel count: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">salt_closures_gas</span><span class="p">[:][</span><span class="bp">self</span><span class="o">.</span><span class="n">salt_closures_gas</span><span class="p">[:]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Closures-1182"><a href="#-1182"><span class="linenos">1182</span></a>                <span class="p">)</span>
</span><span id="Closures-1183"><a href="#-1183"><span class="linenos">1183</span></a>            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">salt_all_closures</span><span class="p">[:])</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
</span><span id="Closures-1184"><a href="#-1184"><span class="linenos">1184</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">write_cube_to_disk</span><span class="p">(</span>
</span><span id="Closures-1185"><a href="#-1185"><span class="linenos">1185</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">salt_all_closures</span><span class="p">[:],</span> <span class="s2">&quot;salt_all_closures_initial&quot;</span>
</span><span id="Closures-1186"><a href="#-1186"><span class="linenos">1186</span></a>                <span class="p">)</span>  <span class="c1"># maybe remove later</span>
</span><span id="Closures-1187"><a href="#-1187"><span class="linenos">1187</span></a>                <span class="nb">print</span><span class="p">(</span>
</span><span id="Closures-1188"><a href="#-1188"><span class="linenos">1188</span></a>                    <span class="sa">f</span><span class="s2">&quot;Salt-bounded All Closure voxel count: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">salt_all_closures</span><span class="p">[:][</span><span class="bp">self</span><span class="o">.</span><span class="n">salt_all_closures</span><span class="p">[:]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Closures-1189"><a href="#-1189"><span class="linenos">1189</span></a>                <span class="p">)</span>
</span><span id="Closures-1190"><a href="#-1190"><span class="linenos">1190</span></a>                <span class="n">salt_all_closures_grown</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grow_to_salt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">salt_all_closures</span><span class="p">[:])</span>
</span><span id="Closures-1191"><a href="#-1191"><span class="linenos">1191</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">salt_all_closures</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">salt_all_closures_grown</span>
</span><span id="Closures-1192"><a href="#-1192"><span class="linenos">1192</span></a>                <span class="nb">print</span><span class="p">(</span>
</span><span id="Closures-1193"><a href="#-1193"><span class="linenos">1193</span></a>                    <span class="sa">f</span><span class="s2">&quot;Salt-bounded All Closure voxel count: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">salt_all_closures</span><span class="p">[:][</span><span class="bp">self</span><span class="o">.</span><span class="n">salt_all_closures</span><span class="p">[:]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Closures-1194"><a href="#-1194"><span class="linenos">1194</span></a>                <span class="p">)</span>
</span><span id="Closures-1195"><a href="#-1195"><span class="linenos">1195</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Closures-1196"><a href="#-1196"><span class="linenos">1196</span></a>                <span class="n">salt_all_closures_grown</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">salt_all_closures</span><span class="p">)</span>
</span><span id="Closures-1197"><a href="#-1197"><span class="linenos">1197</span></a>
</span><span id="Closures-1198"><a href="#-1198"><span class="linenos">1198</span></a>            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">salt_closures_oil</span><span class="p">[:])</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
</span><span id="Closures-1199"><a href="#-1199"><span class="linenos">1199</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">write_cube_to_disk</span><span class="p">(</span>
</span><span id="Closures-1200"><a href="#-1200"><span class="linenos">1200</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">salt_closures_oil</span><span class="p">[:],</span> <span class="s2">&quot;salt_closures_oil_grown&quot;</span>
</span><span id="Closures-1201"><a href="#-1201"><span class="linenos">1201</span></a>                <span class="p">)</span>
</span><span id="Closures-1202"><a href="#-1202"><span class="linenos">1202</span></a>            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">salt_closures_gas</span><span class="p">[:])</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
</span><span id="Closures-1203"><a href="#-1203"><span class="linenos">1203</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">write_cube_to_disk</span><span class="p">(</span>
</span><span id="Closures-1204"><a href="#-1204"><span class="linenos">1204</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">salt_closures_gas</span><span class="p">[:],</span> <span class="s2">&quot;salt_closures_gas_grown&quot;</span>
</span><span id="Closures-1205"><a href="#-1205"><span class="linenos">1205</span></a>                <span class="p">)</span>
</span><span id="Closures-1206"><a href="#-1206"><span class="linenos">1206</span></a>            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">salt_all_closures</span><span class="p">[:])</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
</span><span id="Closures-1207"><a href="#-1207"><span class="linenos">1207</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">write_cube_to_disk</span><span class="p">(</span>
</span><span id="Closures-1208"><a href="#-1208"><span class="linenos">1208</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">salt_all_closures</span><span class="p">[:],</span> <span class="s2">&quot;salt_all_closures_grown&quot;</span>
</span><span id="Closures-1209"><a href="#-1209"><span class="linenos">1209</span></a>                <span class="p">)</span>  <span class="c1"># maybe remove later</span>
</span><span id="Closures-1210"><a href="#-1210"><span class="linenos">1210</span></a>
</span><span id="Closures-1211"><a href="#-1211"><span class="linenos">1211</span></a>            <span class="p">(</span>
</span><span id="Closures-1212"><a href="#-1212"><span class="linenos">1212</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">salt_closures_oil</span><span class="p">[:],</span>
</span><span id="Closures-1213"><a href="#-1213"><span class="linenos">1213</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">n_salt_closures_oil</span><span class="p">,</span>
</span><span id="Closures-1214"><a href="#-1214"><span class="linenos">1214</span></a>            <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">closure_size_filter</span><span class="p">(</span>
</span><span id="Closures-1215"><a href="#-1215"><span class="linenos">1215</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">salt_closures_oil</span><span class="p">[:],</span>
</span><span id="Closures-1216"><a href="#-1216"><span class="linenos">1216</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">closure_min_voxels</span><span class="p">,</span>
</span><span id="Closures-1217"><a href="#-1217"><span class="linenos">1217</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">n_salt_closures_oil</span><span class="p">,</span>
</span><span id="Closures-1218"><a href="#-1218"><span class="linenos">1218</span></a>            <span class="p">)</span>
</span><span id="Closures-1219"><a href="#-1219"><span class="linenos">1219</span></a>            <span class="p">(</span>
</span><span id="Closures-1220"><a href="#-1220"><span class="linenos">1220</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">salt_closures_gas</span><span class="p">[:],</span>
</span><span id="Closures-1221"><a href="#-1221"><span class="linenos">1221</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">n_salt_closures_gas</span><span class="p">,</span>
</span><span id="Closures-1222"><a href="#-1222"><span class="linenos">1222</span></a>            <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">closure_size_filter</span><span class="p">(</span>
</span><span id="Closures-1223"><a href="#-1223"><span class="linenos">1223</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">salt_closures_gas</span><span class="p">[:],</span>
</span><span id="Closures-1224"><a href="#-1224"><span class="linenos">1224</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">closure_min_voxels</span><span class="p">,</span>
</span><span id="Closures-1225"><a href="#-1225"><span class="linenos">1225</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">n_salt_closures_gas</span><span class="p">,</span>
</span><span id="Closures-1226"><a href="#-1226"><span class="linenos">1226</span></a>            <span class="p">)</span>
</span><span id="Closures-1227"><a href="#-1227"><span class="linenos">1227</span></a>
</span><span id="Closures-1228"><a href="#-1228"><span class="linenos">1228</span></a>            <span class="c1"># Append salt-bounded closures to main closure cubes for oil and gas</span>
</span><span id="Closures-1229"><a href="#-1229"><span class="linenos">1229</span></a>            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">salt_closures_oil_grown</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
</span><span id="Closures-1230"><a href="#-1230"><span class="linenos">1230</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">oil_closures</span><span class="p">[</span><span class="n">salt_closures_oil_grown</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="Closures-1231"><a href="#-1231"><span class="linenos">1231</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">oil_closures</span><span class="p">[</span><span class="n">salt_closures_oil_grown</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="Closures-1232"><a href="#-1232"><span class="linenos">1232</span></a>            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">salt_closures_gas_grown</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
</span><span id="Closures-1233"><a href="#-1233"><span class="linenos">1233</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">gas_closures</span><span class="p">[</span><span class="n">salt_closures_gas_grown</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="Closures-1234"><a href="#-1234"><span class="linenos">1234</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">gas_closures</span><span class="p">[</span><span class="n">salt_closures_gas_grown</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="Closures-1235"><a href="#-1235"><span class="linenos">1235</span></a>            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">salt_all_closures_grown</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
</span><span id="Closures-1236"><a href="#-1236"><span class="linenos">1236</span></a>                <span class="n">all_closures_final</span><span class="p">[</span><span class="n">salt_all_closures_grown</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="Closures-1237"><a href="#-1237"><span class="linenos">1237</span></a>                <span class="n">all_closures_final</span><span class="p">[</span><span class="n">salt_all_closures_grown</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="Closures-1238"><a href="#-1238"><span class="linenos">1238</span></a>
</span><span id="Closures-1239"><a href="#-1239"><span class="linenos">1239</span></a>            <span class="c1"># Add faulted closures to closure code cube</span>
</span><span id="Closures-1240"><a href="#-1240"><span class="linenos">1240</span></a>            <span class="n">hc_closures</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">salt_closures_oil</span><span class="p">[:]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">salt_closures_gas</span><span class="p">[:]</span>
</span><span id="Closures-1241"><a href="#-1241"><span class="linenos">1241</span></a>            <span class="n">labels</span><span class="p">,</span> <span class="n">num</span> <span class="o">=</span> <span class="n">measure</span><span class="o">.</span><span class="n">label</span><span class="p">(</span>
</span><span id="Closures-1242"><a href="#-1242"><span class="linenos">1242</span></a>                <span class="n">hc_closures</span><span class="p">,</span> <span class="n">connectivity</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">background</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">return_num</span><span class="o">=</span><span class="kc">True</span>
</span><span id="Closures-1243"><a href="#-1243"><span class="linenos">1243</span></a>            <span class="p">)</span>
</span><span id="Closures-1244"><a href="#-1244"><span class="linenos">1244</span></a>            <span class="n">hc_closure_codes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_closure_codes</span><span class="p">(</span>
</span><span id="Closures-1245"><a href="#-1245"><span class="linenos">1245</span></a>                <span class="n">hc_closure_codes</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">num</span><span class="p">,</span> <span class="n">code</span><span class="o">=</span><span class="mf">0.4</span>
</span><span id="Closures-1246"><a href="#-1246"><span class="linenos">1246</span></a>            <span class="p">)</span>
</span><span id="Closures-1247"><a href="#-1247"><span class="linenos">1247</span></a>
</span><span id="Closures-1248"><a href="#-1248"><span class="linenos">1248</span></a>        <span class="c1"># Write hc_closure_codes to disk</span>
</span><span id="Closures-1249"><a href="#-1249"><span class="linenos">1249</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">write_cube_to_disk</span><span class="p">(</span><span class="n">hc_closure_codes</span><span class="p">,</span> <span class="s2">&quot;closure_segments_hc_voxelcount&quot;</span><span class="p">)</span>
</span><span id="Closures-1250"><a href="#-1250"><span class="linenos">1250</span></a>
</span><span id="Closures-1251"><a href="#-1251"><span class="linenos">1251</span></a>        <span class="c1"># Create closure volumes by type</span>
</span><span id="Closures-1252"><a href="#-1252"><span class="linenos">1252</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">simple_closures</span><span class="p">[:]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Closures-1253"><a href="#-1253"><span class="linenos">1253</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">simple_closures</span><span class="p">[:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">simple_closures_oil</span><span class="p">[:]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;uint8&quot;</span><span class="p">)</span>
</span><span id="Closures-1254"><a href="#-1254"><span class="linenos">1254</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Closures-1255"><a href="#-1255"><span class="linenos">1255</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">simple_closures</span><span class="p">[:]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">simple_closures_oil</span><span class="p">[:]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;uint8&quot;</span><span class="p">)</span>
</span><span id="Closures-1256"><a href="#-1256"><span class="linenos">1256</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">simple_closures</span><span class="p">[:]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">simple_closures_gas</span><span class="p">[:]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;uint8&quot;</span><span class="p">)</span>
</span><span id="Closures-1257"><a href="#-1257"><span class="linenos">1257</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">simple_closures</span><span class="p">[:]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">simple_closures_brine</span><span class="p">[:]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;uint8&quot;</span><span class="p">)</span>
</span><span id="Closures-1258"><a href="#-1258"><span class="linenos">1258</span></a>        <span class="c1"># Onlap closures</span>
</span><span id="Closures-1259"><a href="#-1259"><span class="linenos">1259</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">strat_closures</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Closures-1260"><a href="#-1260"><span class="linenos">1260</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">strat_closures</span><span class="p">[:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">onlap_closures_oil</span><span class="p">[:]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;uint8&quot;</span><span class="p">)</span>
</span><span id="Closures-1261"><a href="#-1261"><span class="linenos">1261</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Closures-1262"><a href="#-1262"><span class="linenos">1262</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">strat_closures</span><span class="p">[:]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">onlap_closures_oil</span><span class="p">[:]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;uint8&quot;</span><span class="p">)</span>
</span><span id="Closures-1263"><a href="#-1263"><span class="linenos">1263</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">strat_closures</span><span class="p">[:]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">onlap_closures_gas</span><span class="p">[:]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;uint8&quot;</span><span class="p">)</span>
</span><span id="Closures-1264"><a href="#-1264"><span class="linenos">1264</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">strat_closures</span><span class="p">[:]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">onlap_closures_brine</span><span class="p">[:]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;uint8&quot;</span><span class="p">)</span>
</span><span id="Closures-1265"><a href="#-1265"><span class="linenos">1265</span></a>        <span class="c1"># Fault closures</span>
</span><span id="Closures-1266"><a href="#-1266"><span class="linenos">1266</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fault_closures</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Closures-1267"><a href="#-1267"><span class="linenos">1267</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">fault_closures</span><span class="p">[:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">faulted_closures_oil</span><span class="p">[:]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;uint8&quot;</span><span class="p">)</span>
</span><span id="Closures-1268"><a href="#-1268"><span class="linenos">1268</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Closures-1269"><a href="#-1269"><span class="linenos">1269</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">fault_closures</span><span class="p">[:]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">faulted_closures_oil</span><span class="p">[:]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;uint8&quot;</span><span class="p">)</span>
</span><span id="Closures-1270"><a href="#-1270"><span class="linenos">1270</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fault_closures</span><span class="p">[:]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">faulted_closures_gas</span><span class="p">[:]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;uint8&quot;</span><span class="p">)</span>
</span><span id="Closures-1271"><a href="#-1271"><span class="linenos">1271</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fault_closures</span><span class="p">[:]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">faulted_closures_brine</span><span class="p">[:]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;uint8&quot;</span><span class="p">)</span>
</span><span id="Closures-1272"><a href="#-1272"><span class="linenos">1272</span></a>
</span><span id="Closures-1273"><a href="#-1273"><span class="linenos">1273</span></a>        <span class="c1"># Salt-bounded closures</span>
</span><span id="Closures-1274"><a href="#-1274"><span class="linenos">1274</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">include_salt</span><span class="p">:</span>
</span><span id="Closures-1275"><a href="#-1275"><span class="linenos">1275</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">salt_closures</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Closures-1276"><a href="#-1276"><span class="linenos">1276</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">salt_closures</span><span class="p">[:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">salt_closures_oil</span><span class="p">[:]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;uint8&quot;</span><span class="p">)</span>
</span><span id="Closures-1277"><a href="#-1277"><span class="linenos">1277</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Closures-1278"><a href="#-1278"><span class="linenos">1278</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">salt_closures</span><span class="p">[:]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">salt_closures_oil</span><span class="p">[:]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;uint8&quot;</span><span class="p">)</span>
</span><span id="Closures-1279"><a href="#-1279"><span class="linenos">1279</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">salt_closures</span><span class="p">[:]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">salt_closures_gas</span><span class="p">[:]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;uint8&quot;</span><span class="p">)</span>
</span><span id="Closures-1280"><a href="#-1280"><span class="linenos">1280</span></a>
</span><span id="Closures-1281"><a href="#-1281"><span class="linenos">1281</span></a>        <span class="c1"># Convert closure cubes from int16 to uint8 for writing to disk</span>
</span><span id="Closures-1282"><a href="#-1282"><span class="linenos">1282</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">closure_segments</span><span class="p">[:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">closure_segments</span><span class="p">[:]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;uint8&quot;</span><span class="p">)</span>
</span><span id="Closures-1283"><a href="#-1283"><span class="linenos">1283</span></a>
</span><span id="Closures-1284"><a href="#-1284"><span class="linenos">1284</span></a>        <span class="c1"># add any oil/gas/brine closures into all_closures_final in case missed</span>
</span><span id="Closures-1285"><a href="#-1285"><span class="linenos">1285</span></a>        <span class="n">all_closures_final</span><span class="p">[:][</span><span class="bp">self</span><span class="o">.</span><span class="n">oil_closures</span><span class="p">[:]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="Closures-1286"><a href="#-1286"><span class="linenos">1286</span></a>        <span class="n">all_closures_final</span><span class="p">[:][</span><span class="bp">self</span><span class="o">.</span><span class="n">gas_closures</span><span class="p">[:]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="Closures-1287"><a href="#-1287"><span class="linenos">1287</span></a>        <span class="n">all_closures_final</span><span class="p">[:][</span><span class="bp">self</span><span class="o">.</span><span class="n">gas_closures</span><span class="p">[:]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="Closures-1288"><a href="#-1288"><span class="linenos">1288</span></a>        <span class="c1"># Write all_closures_final to disk</span>
</span><span id="Closures-1289"><a href="#-1289"><span class="linenos">1289</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">write_cube_to_disk</span><span class="p">(</span><span class="n">all_closures_final</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;uint8&quot;</span><span class="p">),</span> <span class="s2">&quot;trap_label&quot;</span><span class="p">)</span>
</span><span id="Closures-1290"><a href="#-1290"><span class="linenos">1290</span></a>
</span><span id="Closures-1291"><a href="#-1291"><span class="linenos">1291</span></a>        <span class="c1"># add any oil/gas/brine closures into reservoir in case missed</span>
</span><span id="Closures-1292"><a href="#-1292"><span class="linenos">1292</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">reservoir</span><span class="p">[:][</span><span class="bp">self</span><span class="o">.</span><span class="n">oil_closures</span><span class="p">[:]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="Closures-1293"><a href="#-1293"><span class="linenos">1293</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">reservoir</span><span class="p">[:][</span><span class="bp">self</span><span class="o">.</span><span class="n">gas_closures</span><span class="p">[:]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="Closures-1294"><a href="#-1294"><span class="linenos">1294</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">reservoir</span><span class="p">[:][</span><span class="bp">self</span><span class="o">.</span><span class="n">brine_closures</span><span class="p">[:]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="Closures-1295"><a href="#-1295"><span class="linenos">1295</span></a>        <span class="c1"># write reservoir_label to disk</span>
</span><span id="Closures-1296"><a href="#-1296"><span class="linenos">1296</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">write_cube_to_disk</span><span class="p">(</span>
</span><span id="Closures-1297"><a href="#-1297"><span class="linenos">1297</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">reservoir</span><span class="p">[:]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;uint8&quot;</span><span class="p">),</span> <span class="s2">&quot;reservoir_label&quot;</span>
</span><span id="Closures-1298"><a href="#-1298"><span class="linenos">1298</span></a>        <span class="p">)</span>
</span><span id="Closures-1299"><a href="#-1299"><span class="linenos">1299</span></a>
</span><span id="Closures-1300"><a href="#-1300"><span class="linenos">1300</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">qc_plots</span><span class="p">:</span>
</span><span id="Closures-1301"><a href="#-1301"><span class="linenos">1301</span></a>            <span class="kn">from</span> <span class="nn">datagenerator.util</span> <span class="kn">import</span> <span class="n">plot_xsection</span>
</span><span id="Closures-1302"><a href="#-1302"><span class="linenos">1302</span></a>            <span class="kn">from</span> <span class="nn">datagenerator.util</span> <span class="kn">import</span> <span class="n">find_line_with_most_voxels</span>
</span><span id="Closures-1303"><a href="#-1303"><span class="linenos">1303</span></a>
</span><span id="Closures-1304"><a href="#-1304"><span class="linenos">1304</span></a>            <span class="c1"># visualize closures QC</span>
</span><span id="Closures-1305"><a href="#-1305"><span class="linenos">1305</span></a>            <span class="n">inline_index_cl</span> <span class="o">=</span> <span class="n">find_line_with_most_voxels</span><span class="p">(</span>
</span><span id="Closures-1306"><a href="#-1306"><span class="linenos">1306</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">closure_segments</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span>
</span><span id="Closures-1307"><a href="#-1307"><span class="linenos">1307</span></a>            <span class="p">)</span>
</span><span id="Closures-1308"><a href="#-1308"><span class="linenos">1308</span></a>            <span class="n">plot_xsection</span><span class="p">(</span>
</span><span id="Closures-1309"><a href="#-1309"><span class="linenos">1309</span></a>                <span class="n">volume</span><span class="o">=</span><span class="n">labels_clean</span><span class="p">,</span>
</span><span id="Closures-1310"><a href="#-1310"><span class="linenos">1310</span></a>                <span class="n">maps</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">faulted_depth_maps_gaps</span><span class="p">,</span>
</span><span id="Closures-1311"><a href="#-1311"><span class="linenos">1311</span></a>                <span class="n">line_num</span><span class="o">=</span><span class="n">inline_index_cl</span><span class="p">,</span>
</span><span id="Closures-1312"><a href="#-1312"><span class="linenos">1312</span></a>                <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Example Trav through 3D model</span><span class="se">\n</span><span class="s2">closures after faulting&quot;</span><span class="p">,</span>
</span><span id="Closures-1313"><a href="#-1313"><span class="linenos">1313</span></a>                <span class="n">png_name</span><span class="o">=</span><span class="s2">&quot;QC_plot__AfterFaulting_closure_segments.png&quot;</span><span class="p">,</span>
</span><span id="Closures-1314"><a href="#-1314"><span class="linenos">1314</span></a>                <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;gist_ncar_r&quot;</span><span class="p">,</span>
</span><span id="Closures-1315"><a href="#-1315"><span class="linenos">1315</span></a>                <span class="n">cfg</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="p">,</span>
</span><span id="Closures-1316"><a href="#-1316"><span class="linenos">1316</span></a>            <span class="p">)</span>
</span><span id="Closures-1317"><a href="#-1317"><span class="linenos">1317</span></a>
</span><span id="Closures-1318"><a href="#-1318"><span class="linenos">1318</span></a>    <span class="k">def</span> <span class="nf">closure_size_filter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">closure_type</span><span class="p">,</span> <span class="n">threshold</span><span class="p">,</span> <span class="n">count</span><span class="p">):</span>
</span><span id="Closures-1319"><a href="#-1319"><span class="linenos">1319</span></a>        <span class="n">labels</span><span class="p">,</span> <span class="n">num</span> <span class="o">=</span> <span class="n">measure</span><span class="o">.</span><span class="n">label</span><span class="p">(</span>
</span><span id="Closures-1320"><a href="#-1320"><span class="linenos">1320</span></a>            <span class="n">closure_type</span><span class="p">,</span> <span class="n">connectivity</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">background</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">return_num</span><span class="o">=</span><span class="kc">True</span>
</span><span id="Closures-1321"><a href="#-1321"><span class="linenos">1321</span></a>        <span class="p">)</span>
</span><span id="Closures-1322"><a href="#-1322"><span class="linenos">1322</span></a>        <span class="k">if</span> <span class="p">(</span>
</span><span id="Closures-1323"><a href="#-1323"><span class="linenos">1323</span></a>            <span class="n">num</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Closures-1324"><a href="#-1324"><span class="linenos">1324</span></a>        <span class="p">):</span>  <span class="c1"># TODO add whether smallest closure is below threshold constraint too</span>
</span><span id="Closures-1325"><a href="#-1325"><span class="linenos">1325</span></a>            <span class="n">s</span> <span class="o">=</span> <span class="p">[</span><span class="n">labels</span><span class="p">[</span><span class="n">labels</span> <span class="o">==</span> <span class="n">x</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">labels</span><span class="p">))]</span>
</span><span id="Closures-1326"><a href="#-1326"><span class="linenos">1326</span></a>            <span class="n">labels</span> <span class="o">=</span> <span class="n">morphology</span><span class="o">.</span><span class="n">remove_small_objects</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">threshold</span><span class="p">,</span> <span class="n">connectivity</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span><span id="Closures-1327"><a href="#-1327"><span class="linenos">1327</span></a>            <span class="n">t</span> <span class="o">=</span> <span class="p">[</span><span class="n">labels</span><span class="p">[</span><span class="n">labels</span> <span class="o">==</span> <span class="n">x</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">labels</span><span class="p">))]</span>
</span><span id="Closures-1328"><a href="#-1328"><span class="linenos">1328</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="Closures-1329"><a href="#-1329"><span class="linenos">1329</span></a>                <span class="sa">f</span><span class="s2">&quot;Closure sizes before filter: </span><span class="si">{</span><span class="n">s</span><span class="si">}</span><span class="se">\n</span><span class="s2">Threshold: </span><span class="si">{</span><span class="n">threshold</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="Closures-1330"><a href="#-1330"><span class="linenos">1330</span></a>                <span class="sa">f</span><span class="s2">&quot;Closure sizes after filter: </span><span class="si">{</span><span class="n">t</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Closures-1331"><a href="#-1331"><span class="linenos">1331</span></a>            <span class="p">)</span>
</span><span id="Closures-1332"><a href="#-1332"><span class="linenos">1332</span></a>            <span class="n">count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
</span><span id="Closures-1333"><a href="#-1333"><span class="linenos">1333</span></a>        <span class="k">return</span> <span class="n">labels</span><span class="p">,</span> <span class="n">count</span>
</span><span id="Closures-1334"><a href="#-1334"><span class="linenos">1334</span></a>
</span><span id="Closures-1335"><a href="#-1335"><span class="linenos">1335</span></a>    <span class="k">def</span> <span class="nf">closure_type_info_for_log</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Closures-1336"><a href="#-1336"><span class="linenos">1336</span></a>        <span class="n">fluid_types</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;oil&quot;</span><span class="p">,</span> <span class="s2">&quot;gas&quot;</span><span class="p">,</span> <span class="s2">&quot;brine&quot;</span><span class="p">]</span>
</span><span id="Closures-1337"><a href="#-1337"><span class="linenos">1337</span></a>        <span class="k">if</span> <span class="s2">&quot;faulted&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">closure_types</span><span class="p">:</span>
</span><span id="Closures-1338"><a href="#-1338"><span class="linenos">1338</span></a>            <span class="c1"># Faulted closures</span>
</span><span id="Closures-1339"><a href="#-1339"><span class="linenos">1339</span></a>            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">fluid</span><span class="p">,</span> <span class="n">num</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
</span><span id="Closures-1340"><a href="#-1340"><span class="linenos">1340</span></a>                <span class="n">fluid_types</span><span class="p">,</span>
</span><span id="Closures-1341"><a href="#-1341"><span class="linenos">1341</span></a>                <span class="p">[</span>
</span><span id="Closures-1342"><a href="#-1342"><span class="linenos">1342</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">faulted_closures_oil</span><span class="p">[:],</span>
</span><span id="Closures-1343"><a href="#-1343"><span class="linenos">1343</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">faulted_closures_gas</span><span class="p">[:],</span>
</span><span id="Closures-1344"><a href="#-1344"><span class="linenos">1344</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">faulted_closures_brine</span><span class="p">[:],</span>
</span><span id="Closures-1345"><a href="#-1345"><span class="linenos">1345</span></a>                <span class="p">],</span>
</span><span id="Closures-1346"><a href="#-1346"><span class="linenos">1346</span></a>                <span class="p">[</span>
</span><span id="Closures-1347"><a href="#-1347"><span class="linenos">1347</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">n_fault_closures_oil</span><span class="p">,</span>
</span><span id="Closures-1348"><a href="#-1348"><span class="linenos">1348</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">n_fault_closures_gas</span><span class="p">,</span>
</span><span id="Closures-1349"><a href="#-1349"><span class="linenos">1349</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">n_fault_closures_brine</span><span class="p">,</span>
</span><span id="Closures-1350"><a href="#-1350"><span class="linenos">1350</span></a>                <span class="p">],</span>
</span><span id="Closures-1351"><a href="#-1351"><span class="linenos">1351</span></a>            <span class="p">):</span>
</span><span id="Closures-1352"><a href="#-1352"><span class="linenos">1352</span></a>                <span class="n">n_voxels</span> <span class="o">=</span> <span class="n">fluid</span><span class="p">[</span><span class="n">fluid</span><span class="p">[:]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="Closures-1353"><a href="#-1353"><span class="linenos">1353</span></a>                <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;n_fault_closures_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">num</span><span class="si">:</span><span class="s2">03d</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="Closures-1354"><a href="#-1354"><span class="linenos">1354</span></a>                <span class="n">msg</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;n_voxels_fault_closures_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">n_voxels</span><span class="si">:</span><span class="s2">08d</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="Closures-1355"><a href="#-1355"><span class="linenos">1355</span></a>                <span class="nb">print</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="Closures-1356"><a href="#-1356"><span class="linenos">1356</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="Closures-1357"><a href="#-1357"><span class="linenos">1357</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="Closures-1358"><a href="#-1358"><span class="linenos">1358</span></a>                    <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="Closures-1359"><a href="#-1359"><span class="linenos">1359</span></a>                    <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span>
</span><span id="Closures-1360"><a href="#-1360"><span class="linenos">1360</span></a>                    <span class="n">subkey</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;n_fault_closures_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="Closures-1361"><a href="#-1361"><span class="linenos">1361</span></a>                    <span class="n">val</span><span class="o">=</span><span class="n">num</span><span class="p">,</span>
</span><span id="Closures-1362"><a href="#-1362"><span class="linenos">1362</span></a>                <span class="p">)</span>
</span><span id="Closures-1363"><a href="#-1363"><span class="linenos">1363</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="Closures-1364"><a href="#-1364"><span class="linenos">1364</span></a>                    <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="Closures-1365"><a href="#-1365"><span class="linenos">1365</span></a>                    <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span>
</span><span id="Closures-1366"><a href="#-1366"><span class="linenos">1366</span></a>                    <span class="n">subkey</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;n_voxels_fault_closures_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="Closures-1367"><a href="#-1367"><span class="linenos">1367</span></a>                    <span class="n">val</span><span class="o">=</span><span class="n">n_voxels</span><span class="p">,</span>
</span><span id="Closures-1368"><a href="#-1368"><span class="linenos">1368</span></a>                <span class="p">)</span>
</span><span id="Closures-1369"><a href="#-1369"><span class="linenos">1369</span></a>                <span class="n">closure_statistics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_closure_statistics</span><span class="p">(</span>
</span><span id="Closures-1370"><a href="#-1370"><span class="linenos">1370</span></a>                    <span class="n">fluid</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Faulted </span><span class="si">{</span><span class="n">name</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Closures-1371"><a href="#-1371"><span class="linenos">1371</span></a>                <span class="p">)</span>
</span><span id="Closures-1372"><a href="#-1372"><span class="linenos">1372</span></a>                <span class="k">if</span> <span class="n">closure_statistics</span><span class="p">:</span>
</span><span id="Closures-1373"><a href="#-1373"><span class="linenos">1373</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="n">closure_statistics</span><span class="p">)</span>
</span><span id="Closures-1374"><a href="#-1374"><span class="linenos">1374</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span><span class="n">closure_statistics</span><span class="p">)</span>
</span><span id="Closures-1375"><a href="#-1375"><span class="linenos">1375</span></a>
</span><span id="Closures-1376"><a href="#-1376"><span class="linenos">1376</span></a>        <span class="k">if</span> <span class="s2">&quot;onlap&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">closure_types</span><span class="p">:</span>
</span><span id="Closures-1377"><a href="#-1377"><span class="linenos">1377</span></a>            <span class="c1"># Onlap Closures</span>
</span><span id="Closures-1378"><a href="#-1378"><span class="linenos">1378</span></a>            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">fluid</span><span class="p">,</span> <span class="n">num</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
</span><span id="Closures-1379"><a href="#-1379"><span class="linenos">1379</span></a>                <span class="n">fluid_types</span><span class="p">,</span>
</span><span id="Closures-1380"><a href="#-1380"><span class="linenos">1380</span></a>                <span class="p">[</span>
</span><span id="Closures-1381"><a href="#-1381"><span class="linenos">1381</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">onlap_closures_oil</span><span class="p">[:],</span>
</span><span id="Closures-1382"><a href="#-1382"><span class="linenos">1382</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">onlap_closures_gas</span><span class="p">[:],</span>
</span><span id="Closures-1383"><a href="#-1383"><span class="linenos">1383</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">onlap_closures_brine</span><span class="p">[:],</span>
</span><span id="Closures-1384"><a href="#-1384"><span class="linenos">1384</span></a>                <span class="p">],</span>
</span><span id="Closures-1385"><a href="#-1385"><span class="linenos">1385</span></a>                <span class="p">[</span>
</span><span id="Closures-1386"><a href="#-1386"><span class="linenos">1386</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">n_onlap_closures_oil</span><span class="p">,</span>
</span><span id="Closures-1387"><a href="#-1387"><span class="linenos">1387</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">n_onlap_closures_gas</span><span class="p">,</span>
</span><span id="Closures-1388"><a href="#-1388"><span class="linenos">1388</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">n_onlap_closures_brine</span><span class="p">,</span>
</span><span id="Closures-1389"><a href="#-1389"><span class="linenos">1389</span></a>                <span class="p">],</span>
</span><span id="Closures-1390"><a href="#-1390"><span class="linenos">1390</span></a>            <span class="p">):</span>
</span><span id="Closures-1391"><a href="#-1391"><span class="linenos">1391</span></a>                <span class="n">n_voxels</span> <span class="o">=</span> <span class="n">fluid</span><span class="p">[</span><span class="n">fluid</span><span class="p">[:]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="Closures-1392"><a href="#-1392"><span class="linenos">1392</span></a>                <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;n_onlap_closures_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">num</span><span class="si">:</span><span class="s2">03d</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="Closures-1393"><a href="#-1393"><span class="linenos">1393</span></a>                <span class="n">msg</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;n_voxels_onlap_closures_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">n_voxels</span><span class="si">:</span><span class="s2">08d</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="Closures-1394"><a href="#-1394"><span class="linenos">1394</span></a>                <span class="nb">print</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="Closures-1395"><a href="#-1395"><span class="linenos">1395</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="Closures-1396"><a href="#-1396"><span class="linenos">1396</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="Closures-1397"><a href="#-1397"><span class="linenos">1397</span></a>                    <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="Closures-1398"><a href="#-1398"><span class="linenos">1398</span></a>                    <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span>
</span><span id="Closures-1399"><a href="#-1399"><span class="linenos">1399</span></a>                    <span class="n">subkey</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;n_onlap_closures_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="Closures-1400"><a href="#-1400"><span class="linenos">1400</span></a>                    <span class="n">val</span><span class="o">=</span><span class="n">num</span><span class="p">,</span>
</span><span id="Closures-1401"><a href="#-1401"><span class="linenos">1401</span></a>                <span class="p">)</span>
</span><span id="Closures-1402"><a href="#-1402"><span class="linenos">1402</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="Closures-1403"><a href="#-1403"><span class="linenos">1403</span></a>                    <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="Closures-1404"><a href="#-1404"><span class="linenos">1404</span></a>                    <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span>
</span><span id="Closures-1405"><a href="#-1405"><span class="linenos">1405</span></a>                    <span class="n">subkey</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;n_voxels_onlap_closures_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="Closures-1406"><a href="#-1406"><span class="linenos">1406</span></a>                    <span class="n">val</span><span class="o">=</span><span class="n">n_voxels</span><span class="p">,</span>
</span><span id="Closures-1407"><a href="#-1407"><span class="linenos">1407</span></a>                <span class="p">)</span>
</span><span id="Closures-1408"><a href="#-1408"><span class="linenos">1408</span></a>                <span class="n">closure_statistics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_closure_statistics</span><span class="p">(</span>
</span><span id="Closures-1409"><a href="#-1409"><span class="linenos">1409</span></a>                    <span class="n">fluid</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Onlap </span><span class="si">{</span><span class="n">name</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Closures-1410"><a href="#-1410"><span class="linenos">1410</span></a>                <span class="p">)</span>
</span><span id="Closures-1411"><a href="#-1411"><span class="linenos">1411</span></a>                <span class="k">if</span> <span class="n">closure_statistics</span><span class="p">:</span>
</span><span id="Closures-1412"><a href="#-1412"><span class="linenos">1412</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="n">closure_statistics</span><span class="p">)</span>
</span><span id="Closures-1413"><a href="#-1413"><span class="linenos">1413</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span><span class="n">closure_statistics</span><span class="p">)</span>
</span><span id="Closures-1414"><a href="#-1414"><span class="linenos">1414</span></a>
</span><span id="Closures-1415"><a href="#-1415"><span class="linenos">1415</span></a>        <span class="k">if</span> <span class="s2">&quot;simple&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">closure_types</span><span class="p">:</span>
</span><span id="Closures-1416"><a href="#-1416"><span class="linenos">1416</span></a>            <span class="c1"># Simple Closures</span>
</span><span id="Closures-1417"><a href="#-1417"><span class="linenos">1417</span></a>            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">fluid</span><span class="p">,</span> <span class="n">num</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
</span><span id="Closures-1418"><a href="#-1418"><span class="linenos">1418</span></a>                <span class="n">fluid_types</span><span class="p">,</span>
</span><span id="Closures-1419"><a href="#-1419"><span class="linenos">1419</span></a>                <span class="p">[</span>
</span><span id="Closures-1420"><a href="#-1420"><span class="linenos">1420</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">simple_closures_oil</span><span class="p">[:],</span>
</span><span id="Closures-1421"><a href="#-1421"><span class="linenos">1421</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">simple_closures_gas</span><span class="p">[:],</span>
</span><span id="Closures-1422"><a href="#-1422"><span class="linenos">1422</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">simple_closures_brine</span><span class="p">[:],</span>
</span><span id="Closures-1423"><a href="#-1423"><span class="linenos">1423</span></a>                <span class="p">],</span>
</span><span id="Closures-1424"><a href="#-1424"><span class="linenos">1424</span></a>                <span class="p">[</span>
</span><span id="Closures-1425"><a href="#-1425"><span class="linenos">1425</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">n_4way_closures_oil</span><span class="p">,</span>
</span><span id="Closures-1426"><a href="#-1426"><span class="linenos">1426</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">n_4way_closures_gas</span><span class="p">,</span>
</span><span id="Closures-1427"><a href="#-1427"><span class="linenos">1427</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">n_4way_closures_brine</span><span class="p">,</span>
</span><span id="Closures-1428"><a href="#-1428"><span class="linenos">1428</span></a>                <span class="p">],</span>
</span><span id="Closures-1429"><a href="#-1429"><span class="linenos">1429</span></a>            <span class="p">):</span>
</span><span id="Closures-1430"><a href="#-1430"><span class="linenos">1430</span></a>                <span class="n">n_voxels</span> <span class="o">=</span> <span class="n">fluid</span><span class="p">[</span><span class="n">fluid</span><span class="p">[:]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="Closures-1431"><a href="#-1431"><span class="linenos">1431</span></a>                <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;n_4way_closures_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">num</span><span class="si">:</span><span class="s2">03d</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="Closures-1432"><a href="#-1432"><span class="linenos">1432</span></a>                <span class="n">msg</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;n_voxels_4way_closures_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">n_voxels</span><span class="si">:</span><span class="s2">08d</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="Closures-1433"><a href="#-1433"><span class="linenos">1433</span></a>                <span class="nb">print</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="Closures-1434"><a href="#-1434"><span class="linenos">1434</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="Closures-1435"><a href="#-1435"><span class="linenos">1435</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="Closures-1436"><a href="#-1436"><span class="linenos">1436</span></a>                    <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="Closures-1437"><a href="#-1437"><span class="linenos">1437</span></a>                    <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span>
</span><span id="Closures-1438"><a href="#-1438"><span class="linenos">1438</span></a>                    <span class="n">subkey</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;n_4way_closures_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="Closures-1439"><a href="#-1439"><span class="linenos">1439</span></a>                    <span class="n">val</span><span class="o">=</span><span class="n">num</span><span class="p">,</span>
</span><span id="Closures-1440"><a href="#-1440"><span class="linenos">1440</span></a>                <span class="p">)</span>
</span><span id="Closures-1441"><a href="#-1441"><span class="linenos">1441</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="Closures-1442"><a href="#-1442"><span class="linenos">1442</span></a>                    <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="Closures-1443"><a href="#-1443"><span class="linenos">1443</span></a>                    <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span>
</span><span id="Closures-1444"><a href="#-1444"><span class="linenos">1444</span></a>                    <span class="n">subkey</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;n_voxels_4way_closures_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="Closures-1445"><a href="#-1445"><span class="linenos">1445</span></a>                    <span class="n">val</span><span class="o">=</span><span class="n">n_voxels</span><span class="p">,</span>
</span><span id="Closures-1446"><a href="#-1446"><span class="linenos">1446</span></a>                <span class="p">)</span>
</span><span id="Closures-1447"><a href="#-1447"><span class="linenos">1447</span></a>                <span class="n">closure_statistics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_closure_statistics</span><span class="p">(</span>
</span><span id="Closures-1448"><a href="#-1448"><span class="linenos">1448</span></a>                    <span class="n">fluid</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;4-Way </span><span class="si">{</span><span class="n">name</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Closures-1449"><a href="#-1449"><span class="linenos">1449</span></a>                <span class="p">)</span>
</span><span id="Closures-1450"><a href="#-1450"><span class="linenos">1450</span></a>                <span class="k">if</span> <span class="n">closure_statistics</span><span class="p">:</span>
</span><span id="Closures-1451"><a href="#-1451"><span class="linenos">1451</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="n">closure_statistics</span><span class="p">)</span>
</span><span id="Closures-1452"><a href="#-1452"><span class="linenos">1452</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span><span class="n">closure_statistics</span><span class="p">)</span>
</span><span id="Closures-1453"><a href="#-1453"><span class="linenos">1453</span></a>
</span><span id="Closures-1454"><a href="#-1454"><span class="linenos">1454</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">include_salt</span><span class="p">:</span>
</span><span id="Closures-1455"><a href="#-1455"><span class="linenos">1455</span></a>            <span class="c1"># Salt-Bounded Closures</span>
</span><span id="Closures-1456"><a href="#-1456"><span class="linenos">1456</span></a>            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">fluid</span><span class="p">,</span> <span class="n">num</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
</span><span id="Closures-1457"><a href="#-1457"><span class="linenos">1457</span></a>                <span class="n">fluid_types</span><span class="p">,</span>
</span><span id="Closures-1458"><a href="#-1458"><span class="linenos">1458</span></a>                <span class="p">[</span>
</span><span id="Closures-1459"><a href="#-1459"><span class="linenos">1459</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">salt_closures_oil</span><span class="p">[:],</span>
</span><span id="Closures-1460"><a href="#-1460"><span class="linenos">1460</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">salt_closures_gas</span><span class="p">[:],</span>
</span><span id="Closures-1461"><a href="#-1461"><span class="linenos">1461</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">salt_closures_brine</span><span class="p">[:],</span>
</span><span id="Closures-1462"><a href="#-1462"><span class="linenos">1462</span></a>                <span class="p">],</span>
</span><span id="Closures-1463"><a href="#-1463"><span class="linenos">1463</span></a>                <span class="p">[</span>
</span><span id="Closures-1464"><a href="#-1464"><span class="linenos">1464</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">n_salt_closures_oil</span><span class="p">,</span>
</span><span id="Closures-1465"><a href="#-1465"><span class="linenos">1465</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">n_salt_closures_gas</span><span class="p">,</span>
</span><span id="Closures-1466"><a href="#-1466"><span class="linenos">1466</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">n_salt_closures_brine</span><span class="p">,</span>
</span><span id="Closures-1467"><a href="#-1467"><span class="linenos">1467</span></a>                <span class="p">],</span>
</span><span id="Closures-1468"><a href="#-1468"><span class="linenos">1468</span></a>            <span class="p">):</span>
</span><span id="Closures-1469"><a href="#-1469"><span class="linenos">1469</span></a>                <span class="n">n_voxels</span> <span class="o">=</span> <span class="n">fluid</span><span class="p">[</span><span class="n">fluid</span><span class="p">[:]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="Closures-1470"><a href="#-1470"><span class="linenos">1470</span></a>                <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;n_salt_closures_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">num</span><span class="si">:</span><span class="s2">03d</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="Closures-1471"><a href="#-1471"><span class="linenos">1471</span></a>                <span class="n">msg</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;n_voxels_salt_closures_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">n_voxels</span><span class="si">:</span><span class="s2">08d</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="Closures-1472"><a href="#-1472"><span class="linenos">1472</span></a>                <span class="nb">print</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="Closures-1473"><a href="#-1473"><span class="linenos">1473</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="Closures-1474"><a href="#-1474"><span class="linenos">1474</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="Closures-1475"><a href="#-1475"><span class="linenos">1475</span></a>                    <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="Closures-1476"><a href="#-1476"><span class="linenos">1476</span></a>                    <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span>
</span><span id="Closures-1477"><a href="#-1477"><span class="linenos">1477</span></a>                    <span class="n">subkey</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;n_salt_closures_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="Closures-1478"><a href="#-1478"><span class="linenos">1478</span></a>                    <span class="n">val</span><span class="o">=</span><span class="n">num</span><span class="p">,</span>
</span><span id="Closures-1479"><a href="#-1479"><span class="linenos">1479</span></a>                <span class="p">)</span>
</span><span id="Closures-1480"><a href="#-1480"><span class="linenos">1480</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="Closures-1481"><a href="#-1481"><span class="linenos">1481</span></a>                    <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="Closures-1482"><a href="#-1482"><span class="linenos">1482</span></a>                    <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span>
</span><span id="Closures-1483"><a href="#-1483"><span class="linenos">1483</span></a>                    <span class="n">subkey</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;n_voxels_salt_closures_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="Closures-1484"><a href="#-1484"><span class="linenos">1484</span></a>                    <span class="n">val</span><span class="o">=</span><span class="n">n_voxels</span><span class="p">,</span>
</span><span id="Closures-1485"><a href="#-1485"><span class="linenos">1485</span></a>                <span class="p">)</span>
</span><span id="Closures-1486"><a href="#-1486"><span class="linenos">1486</span></a>                <span class="n">closure_statistics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_closure_statistics</span><span class="p">(</span>
</span><span id="Closures-1487"><a href="#-1487"><span class="linenos">1487</span></a>                    <span class="n">fluid</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Salt </span><span class="si">{</span><span class="n">name</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Closures-1488"><a href="#-1488"><span class="linenos">1488</span></a>                <span class="p">)</span>
</span><span id="Closures-1489"><a href="#-1489"><span class="linenos">1489</span></a>                <span class="k">if</span> <span class="n">closure_statistics</span><span class="p">:</span>
</span><span id="Closures-1490"><a href="#-1490"><span class="linenos">1490</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="n">closure_statistics</span><span class="p">)</span>
</span><span id="Closures-1491"><a href="#-1491"><span class="linenos">1491</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span><span class="n">closure_statistics</span><span class="p">)</span>
</span><span id="Closures-1492"><a href="#-1492"><span class="linenos">1492</span></a>
</span><span id="Closures-1493"><a href="#-1493"><span class="linenos">1493</span></a>    <span class="k">def</span> <span class="nf">get_voxel_counts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">closures</span><span class="p">):</span>
</span><span id="Closures-1494"><a href="#-1494"><span class="linenos">1494</span></a>        <span class="n">next_label</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Closures-1495"><a href="#-1495"><span class="linenos">1495</span></a>        <span class="n">label_values</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Closures-1496"><a href="#-1496"><span class="linenos">1496</span></a>        <span class="n">label_counts</span> <span class="o">=</span> <span class="p">[</span><span class="n">closures</span><span class="p">[</span><span class="n">closures</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">]</span>
</span><span id="Closures-1497"><a href="#-1497"><span class="linenos">1497</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">closures</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="Closures-1498"><a href="#-1498"><span class="linenos">1498</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="Closures-1499"><a href="#-1499"><span class="linenos">1499</span></a>                <span class="n">next_label</span> <span class="o">=</span> <span class="n">closures</span><span class="p">[</span><span class="n">closures</span> <span class="o">&gt;</span> <span class="n">next_label</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
</span><span id="Closures-1500"><a href="#-1500"><span class="linenos">1500</span></a>            <span class="k">except</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
</span><span id="Closures-1501"><a href="#-1501"><span class="linenos">1501</span></a>                <span class="k">break</span>
</span><span id="Closures-1502"><a href="#-1502"><span class="linenos">1502</span></a>            <span class="n">label_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">next_label</span><span class="p">)</span>
</span><span id="Closures-1503"><a href="#-1503"><span class="linenos">1503</span></a>            <span class="n">label_counts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">closures</span><span class="p">[</span><span class="n">closures</span> <span class="o">==</span> <span class="n">next_label</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
</span><span id="Closures-1504"><a href="#-1504"><span class="linenos">1504</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="Closures-1505"><a href="#-1505"><span class="linenos">1505</span></a>                <span class="sa">f</span><span class="s2">&quot;Label: </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">, label_values: </span><span class="si">{</span><span class="n">label_values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">, label_counts: </span><span class="si">{</span><span class="n">label_counts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Closures-1506"><a href="#-1506"><span class="linenos">1506</span></a>            <span class="p">)</span>
</span><span id="Closures-1507"><a href="#-1507"><span class="linenos">1507</span></a>
</span><span id="Closures-1508"><a href="#-1508"><span class="linenos">1508</span></a>        <span class="nb">print</span><span class="p">(</span>
</span><span id="Closures-1509"><a href="#-1509"><span class="linenos">1509</span></a>            <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="mi">72</span> <span class="o">*</span> <span class="s2">&quot;*&quot;</span><span class="si">}</span><span class="se">\n\t</span><span class="s1">Num Closures: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">label_counts</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="si">}</span><span class="se">\n\t</span><span class="s1">Voxel counts</span><span class="se">\n</span><span class="si">{</span><span class="n">label_counts</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="si">}</span><span class="se">\n</span><span class="si">{</span><span class="mi">72</span> <span class="o">*</span> <span class="s2">&quot;*&quot;</span><span class="si">}</span><span class="s1">&#39;</span>
</span><span id="Closures-1510"><a href="#-1510"><span class="linenos">1510</span></a>        <span class="p">)</span>
</span><span id="Closures-1511"><a href="#-1511"><span class="linenos">1511</span></a>        <span class="k">for</span> <span class="n">vox_count</span> <span class="ow">in</span> <span class="n">label_counts</span><span class="p">:</span>
</span><span id="Closures-1512"><a href="#-1512"><span class="linenos">1512</span></a>            <span class="k">if</span> <span class="n">vox_count</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">closure_min_voxels</span><span class="p">:</span>
</span><span id="Closures-1513"><a href="#-1513"><span class="linenos">1513</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;voxel_count: </span><span class="si">{</span><span class="n">vox_count</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Closures-1514"><a href="#-1514"><span class="linenos">1514</span></a>
</span><span id="Closures-1515"><a href="#-1515"><span class="linenos">1515</span></a>    <span class="k">def</span> <span class="nf">populate_closure_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">fluid</span><span class="p">,</span> <span class="n">seismic_nmf</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="Closures-1516"><a href="#-1516"><span class="linenos">1516</span></a>        <span class="n">clist</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Closures-1517"><a href="#-1517"><span class="linenos">1517</span></a>        <span class="n">max_num</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>
</span><span id="Closures-1518"><a href="#-1518"><span class="linenos">1518</span></a>        <span class="k">if</span> <span class="n">seismic_nmf</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Closures-1519"><a href="#-1519"><span class="linenos">1519</span></a>            <span class="c1"># calculate ai_gi</span>
</span><span id="Closures-1520"><a href="#-1520"><span class="linenos">1520</span></a>            <span class="n">ai</span><span class="p">,</span> <span class="n">gi</span> <span class="o">=</span> <span class="n">compute_ai_gi</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="p">,</span> <span class="n">seismic_nmf</span><span class="p">)</span>
</span><span id="Closures-1521"><a href="#-1521"><span class="linenos">1521</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_num</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="Closures-1522"><a href="#-1522"><span class="linenos">1522</span></a>            <span class="n">_c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">labels</span> <span class="o">==</span> <span class="n">i</span><span class="p">)</span>
</span><span id="Closures-1523"><a href="#-1523"><span class="linenos">1523</span></a>            <span class="n">cl</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
</span><span id="Closures-1524"><a href="#-1524"><span class="linenos">1524</span></a>            <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;model_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">work_subfolder</span><span class="p">)</span>
</span><span id="Closures-1525"><a href="#-1525"><span class="linenos">1525</span></a>            <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;fluid&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fluid</span>
</span><span id="Closures-1526"><a href="#-1526"><span class="linenos">1526</span></a>            <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;n_voxels&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">_c</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="Closures-1527"><a href="#-1527"><span class="linenos">1527</span></a>            <span class="c1"># np.min() or x.min() returns type numpy.int64 which SQLITE cannot handle. Convert to int</span>
</span><span id="Closures-1528"><a href="#-1528"><span class="linenos">1528</span></a>            <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;x_min&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">_c</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</span><span id="Closures-1529"><a href="#-1529"><span class="linenos">1529</span></a>            <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;x_max&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">_c</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</span><span id="Closures-1530"><a href="#-1530"><span class="linenos">1530</span></a>            <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;y_min&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">_c</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
</span><span id="Closures-1531"><a href="#-1531"><span class="linenos">1531</span></a>            <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;y_max&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">_c</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
</span><span id="Closures-1532"><a href="#-1532"><span class="linenos">1532</span></a>            <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;z_min&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">_c</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
</span><span id="Closures-1533"><a href="#-1533"><span class="linenos">1533</span></a>            <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;z_max&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">_c</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
</span><span id="Closures-1534"><a href="#-1534"><span class="linenos">1534</span></a>            <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;zbml_min&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">faulted_depth</span><span class="p">[</span><span class="n">_c</span><span class="p">])</span>
</span><span id="Closures-1535"><a href="#-1535"><span class="linenos">1535</span></a>            <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;zbml_max&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">faulted_depth</span><span class="p">[</span><span class="n">_c</span><span class="p">])</span>
</span><span id="Closures-1536"><a href="#-1536"><span class="linenos">1536</span></a>            <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;zbml_avg&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">faulted_depth</span><span class="p">[</span><span class="n">_c</span><span class="p">])</span>
</span><span id="Closures-1537"><a href="#-1537"><span class="linenos">1537</span></a>            <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;zbml_std&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">faulted_depth</span><span class="p">[</span><span class="n">_c</span><span class="p">])</span>
</span><span id="Closures-1538"><a href="#-1538"><span class="linenos">1538</span></a>            <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;zbml_25pct&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">faulted_depth</span><span class="p">[</span><span class="n">_c</span><span class="p">],</span> <span class="mi">25</span><span class="p">)</span>
</span><span id="Closures-1539"><a href="#-1539"><span class="linenos">1539</span></a>            <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;zbml_median&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">faulted_depth</span><span class="p">[</span><span class="n">_c</span><span class="p">],</span> <span class="mi">50</span><span class="p">)</span>
</span><span id="Closures-1540"><a href="#-1540"><span class="linenos">1540</span></a>            <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;zbml_75pct&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">faulted_depth</span><span class="p">[</span><span class="n">_c</span><span class="p">],</span> <span class="mi">75</span><span class="p">)</span>
</span><span id="Closures-1541"><a href="#-1541"><span class="linenos">1541</span></a>            <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;ng_min&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">faulted_net_to_gross</span><span class="p">[</span><span class="n">_c</span><span class="p">])</span>
</span><span id="Closures-1542"><a href="#-1542"><span class="linenos">1542</span></a>            <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;ng_max&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">faulted_net_to_gross</span><span class="p">[</span><span class="n">_c</span><span class="p">])</span>
</span><span id="Closures-1543"><a href="#-1543"><span class="linenos">1543</span></a>            <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;ng_avg&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">faulted_net_to_gross</span><span class="p">[</span><span class="n">_c</span><span class="p">])</span>
</span><span id="Closures-1544"><a href="#-1544"><span class="linenos">1544</span></a>            <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;ng_std&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">faulted_net_to_gross</span><span class="p">[</span><span class="n">_c</span><span class="p">])</span>
</span><span id="Closures-1545"><a href="#-1545"><span class="linenos">1545</span></a>            <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;ng_25pct&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">faulted_net_to_gross</span><span class="p">[</span><span class="n">_c</span><span class="p">],</span> <span class="mi">25</span><span class="p">)</span>
</span><span id="Closures-1546"><a href="#-1546"><span class="linenos">1546</span></a>            <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;ng_median&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">faulted_net_to_gross</span><span class="p">[</span><span class="n">_c</span><span class="p">])</span>
</span><span id="Closures-1547"><a href="#-1547"><span class="linenos">1547</span></a>            <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;ng_75pct&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">faulted_net_to_gross</span><span class="p">[</span><span class="n">_c</span><span class="p">],</span> <span class="mi">75</span><span class="p">)</span>
</span><span id="Closures-1548"><a href="#-1548"><span class="linenos">1548</span></a>            <span class="c1"># Check for intersections with faults, salt and onlaps for closure type</span>
</span><span id="Closures-1549"><a href="#-1549"><span class="linenos">1549</span></a>            <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;intersects_fault&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Closures-1550"><a href="#-1550"><span class="linenos">1550</span></a>            <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;intersects_onlap&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Closures-1551"><a href="#-1551"><span class="linenos">1551</span></a>            <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;intersects_salt&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Closures-1552"><a href="#-1552"><span class="linenos">1552</span></a>            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wide_faults</span><span class="p">[</span><span class="n">_c</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
</span><span id="Closures-1553"><a href="#-1553"><span class="linenos">1553</span></a>                <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;intersects_fault&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Closures-1554"><a href="#-1554"><span class="linenos">1554</span></a>            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">onlaps_upward</span><span class="p">[</span><span class="n">_c</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
</span><span id="Closures-1555"><a href="#-1555"><span class="linenos">1555</span></a>                <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;intersects_onlap&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Closures-1556"><a href="#-1556"><span class="linenos">1556</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">include_salt</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wide_salt</span><span class="p">[</span><span class="n">_c</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
</span><span id="Closures-1557"><a href="#-1557"><span class="linenos">1557</span></a>                <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;intersects_salt&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Closures-1558"><a href="#-1558"><span class="linenos">1558</span></a>
</span><span id="Closures-1559"><a href="#-1559"><span class="linenos">1559</span></a>            <span class="k">if</span> <span class="n">seismic_nmf</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Closures-1560"><a href="#-1560"><span class="linenos">1560</span></a>                <span class="c1"># Using only the top of the closure, calculate seismic properties</span>
</span><span id="Closures-1561"><a href="#-1561"><span class="linenos">1561</span></a>                <span class="n">labels_copy</span> <span class="o">=</span> <span class="n">labels</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Closures-1562"><a href="#-1562"><span class="linenos">1562</span></a>                <span class="n">labels_copy</span><span class="p">[</span><span class="n">labels_copy</span> <span class="o">!=</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Closures-1563"><a href="#-1563"><span class="linenos">1563</span></a>                <span class="n">top_closure</span> <span class="o">=</span> <span class="n">get_top_of_closure</span><span class="p">(</span><span class="n">labels_copy</span><span class="p">)</span>
</span><span id="Closures-1564"><a href="#-1564"><span class="linenos">1564</span></a>                <span class="n">near</span> <span class="o">=</span> <span class="n">seismic_nmf</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">...</span><span class="p">][</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">top_closure</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)]</span>
</span><span id="Closures-1565"><a href="#-1565"><span class="linenos">1565</span></a>                <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;near_min&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">near</span><span class="p">)</span>
</span><span id="Closures-1566"><a href="#-1566"><span class="linenos">1566</span></a>                <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;near_max&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">near</span><span class="p">)</span>
</span><span id="Closures-1567"><a href="#-1567"><span class="linenos">1567</span></a>                <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;near_avg&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">near</span><span class="p">)</span>
</span><span id="Closures-1568"><a href="#-1568"><span class="linenos">1568</span></a>                <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;near_std&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">near</span><span class="p">)</span>
</span><span id="Closures-1569"><a href="#-1569"><span class="linenos">1569</span></a>                <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;near_25pct&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">near</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span>
</span><span id="Closures-1570"><a href="#-1570"><span class="linenos">1570</span></a>                <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;near_median&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">near</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
</span><span id="Closures-1571"><a href="#-1571"><span class="linenos">1571</span></a>                <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;near_75pct&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">near</span><span class="p">,</span> <span class="mi">75</span><span class="p">)</span>
</span><span id="Closures-1572"><a href="#-1572"><span class="linenos">1572</span></a>                <span class="n">mid</span> <span class="o">=</span> <span class="n">seismic_nmf</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="o">...</span><span class="p">][</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">top_closure</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)]</span>
</span><span id="Closures-1573"><a href="#-1573"><span class="linenos">1573</span></a>                <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;mid_min&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">mid</span><span class="p">)</span>
</span><span id="Closures-1574"><a href="#-1574"><span class="linenos">1574</span></a>                <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;mid_max&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">mid</span><span class="p">)</span>
</span><span id="Closures-1575"><a href="#-1575"><span class="linenos">1575</span></a>                <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;mid_avg&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">mid</span><span class="p">)</span>
</span><span id="Closures-1576"><a href="#-1576"><span class="linenos">1576</span></a>                <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;mid_std&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">mid</span><span class="p">)</span>
</span><span id="Closures-1577"><a href="#-1577"><span class="linenos">1577</span></a>                <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;mid_25pct&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">mid</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span>
</span><span id="Closures-1578"><a href="#-1578"><span class="linenos">1578</span></a>                <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;mid_median&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">mid</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
</span><span id="Closures-1579"><a href="#-1579"><span class="linenos">1579</span></a>                <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;mid_75pct&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">mid</span><span class="p">,</span> <span class="mi">75</span><span class="p">)</span>
</span><span id="Closures-1580"><a href="#-1580"><span class="linenos">1580</span></a>                <span class="n">far</span> <span class="o">=</span> <span class="n">seismic_nmf</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="o">...</span><span class="p">][</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">top_closure</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)]</span>
</span><span id="Closures-1581"><a href="#-1581"><span class="linenos">1581</span></a>                <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;far_min&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">far</span><span class="p">)</span>
</span><span id="Closures-1582"><a href="#-1582"><span class="linenos">1582</span></a>                <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;far_max&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">far</span><span class="p">)</span>
</span><span id="Closures-1583"><a href="#-1583"><span class="linenos">1583</span></a>                <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;far_avg&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">far</span><span class="p">)</span>
</span><span id="Closures-1584"><a href="#-1584"><span class="linenos">1584</span></a>                <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;far_std&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">far</span><span class="p">)</span>
</span><span id="Closures-1585"><a href="#-1585"><span class="linenos">1585</span></a>                <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;far_25pct&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">far</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span>
</span><span id="Closures-1586"><a href="#-1586"><span class="linenos">1586</span></a>                <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;far_median&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">far</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
</span><span id="Closures-1587"><a href="#-1587"><span class="linenos">1587</span></a>                <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;far_75pct&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">far</span><span class="p">,</span> <span class="mi">75</span><span class="p">)</span>
</span><span id="Closures-1588"><a href="#-1588"><span class="linenos">1588</span></a>                <span class="n">intercept</span> <span class="o">=</span> <span class="n">ai</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">top_closure</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)]</span>
</span><span id="Closures-1589"><a href="#-1589"><span class="linenos">1589</span></a>                <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;intercept_min&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">intercept</span><span class="p">)</span>
</span><span id="Closures-1590"><a href="#-1590"><span class="linenos">1590</span></a>                <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;intercept_max&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">intercept</span><span class="p">)</span>
</span><span id="Closures-1591"><a href="#-1591"><span class="linenos">1591</span></a>                <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;intercept_avg&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">intercept</span><span class="p">)</span>
</span><span id="Closures-1592"><a href="#-1592"><span class="linenos">1592</span></a>                <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;intercept_std&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">intercept</span><span class="p">)</span>
</span><span id="Closures-1593"><a href="#-1593"><span class="linenos">1593</span></a>                <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;intercept_25pct&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">intercept</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span>
</span><span id="Closures-1594"><a href="#-1594"><span class="linenos">1594</span></a>                <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;intercept_median&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">intercept</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
</span><span id="Closures-1595"><a href="#-1595"><span class="linenos">1595</span></a>                <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;intercept_75pct&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">intercept</span><span class="p">,</span> <span class="mi">75</span><span class="p">)</span>
</span><span id="Closures-1596"><a href="#-1596"><span class="linenos">1596</span></a>                <span class="n">gradient</span> <span class="o">=</span> <span class="n">gi</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">top_closure</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)]</span>
</span><span id="Closures-1597"><a href="#-1597"><span class="linenos">1597</span></a>                <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;gradient_min&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">gradient</span><span class="p">)</span>
</span><span id="Closures-1598"><a href="#-1598"><span class="linenos">1598</span></a>                <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;gradient_max&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">gradient</span><span class="p">)</span>
</span><span id="Closures-1599"><a href="#-1599"><span class="linenos">1599</span></a>                <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;gradient_avg&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">gradient</span><span class="p">)</span>
</span><span id="Closures-1600"><a href="#-1600"><span class="linenos">1600</span></a>                <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;gradient_std&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">gradient</span><span class="p">)</span>
</span><span id="Closures-1601"><a href="#-1601"><span class="linenos">1601</span></a>                <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;gradient_25pct&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">gradient</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span>
</span><span id="Closures-1602"><a href="#-1602"><span class="linenos">1602</span></a>                <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;gradient_median&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">gradient</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
</span><span id="Closures-1603"><a href="#-1603"><span class="linenos">1603</span></a>                <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;gradient_75pct&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">gradient</span><span class="p">,</span> <span class="mi">75</span><span class="p">)</span>
</span><span id="Closures-1604"><a href="#-1604"><span class="linenos">1604</span></a>
</span><span id="Closures-1605"><a href="#-1605"><span class="linenos">1605</span></a>            <span class="n">clist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cl</span><span class="p">)</span>
</span><span id="Closures-1606"><a href="#-1606"><span class="linenos">1606</span></a>
</span><span id="Closures-1607"><a href="#-1607"><span class="linenos">1607</span></a>        <span class="k">return</span> <span class="n">clist</span>
</span><span id="Closures-1608"><a href="#-1608"><span class="linenos">1608</span></a>
</span><span id="Closures-1609"><a href="#-1609"><span class="linenos">1609</span></a>    <span class="k">def</span> <span class="nf">write_closure_info_to_log</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seismic_nmf</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="Closures-1610"><a href="#-1610"><span class="linenos">1610</span></a>        <span class="sd">&quot;&quot;&quot;store info about closure in log file&quot;&quot;&quot;</span>
</span><span id="Closures-1611"><a href="#-1611"><span class="linenos">1611</span></a>        <span class="n">top_sand_layers</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">top_lith_indices</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">facies</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">==</span> <span class="mf">1.0</span><span class="p">]</span>
</span><span id="Closures-1612"><a href="#-1612"><span class="linenos">1612</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="Closures-1613"><a href="#-1613"><span class="linenos">1613</span></a>            <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="Closures-1614"><a href="#-1614"><span class="linenos">1614</span></a>            <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span>
</span><span id="Closures-1615"><a href="#-1615"><span class="linenos">1615</span></a>            <span class="n">subkey</span><span class="o">=</span><span class="s2">&quot;top_sand_layers&quot;</span><span class="p">,</span>
</span><span id="Closures-1616"><a href="#-1616"><span class="linenos">1616</span></a>            <span class="n">val</span><span class="o">=</span><span class="n">top_sand_layers</span><span class="p">,</span>
</span><span id="Closures-1617"><a href="#-1617"><span class="linenos">1617</span></a>        <span class="p">)</span>
</span><span id="Closures-1618"><a href="#-1618"><span class="linenos">1618</span></a>        <span class="n">o</span> <span class="o">=</span> <span class="n">measure</span><span class="o">.</span><span class="n">label</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">oil_closures</span><span class="p">[:],</span> <span class="n">connectivity</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">background</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="Closures-1619"><a href="#-1619"><span class="linenos">1619</span></a>        <span class="n">g</span> <span class="o">=</span> <span class="n">measure</span><span class="o">.</span><span class="n">label</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gas_closures</span><span class="p">[:],</span> <span class="n">connectivity</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">background</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="Closures-1620"><a href="#-1620"><span class="linenos">1620</span></a>        <span class="n">b</span> <span class="o">=</span> <span class="n">measure</span><span class="o">.</span><span class="n">label</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">brine_closures</span><span class="p">[:],</span> <span class="n">connectivity</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">background</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="Closures-1621"><a href="#-1621"><span class="linenos">1621</span></a>        <span class="n">oil_closures</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">populate_closure_dict</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="s2">&quot;oil&quot;</span><span class="p">,</span> <span class="n">seismic_nmf</span><span class="p">)</span>
</span><span id="Closures-1622"><a href="#-1622"><span class="linenos">1622</span></a>        <span class="n">gas_closures</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">populate_closure_dict</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="s2">&quot;gas&quot;</span><span class="p">,</span> <span class="n">seismic_nmf</span><span class="p">)</span>
</span><span id="Closures-1623"><a href="#-1623"><span class="linenos">1623</span></a>        <span class="n">brine_closures</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">populate_closure_dict</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="s2">&quot;brine&quot;</span><span class="p">,</span> <span class="n">seismic_nmf</span><span class="p">)</span>
</span><span id="Closures-1624"><a href="#-1624"><span class="linenos">1624</span></a>        <span class="n">all_closures</span> <span class="o">=</span> <span class="n">oil_closures</span> <span class="o">+</span> <span class="n">gas_closures</span> <span class="o">+</span> <span class="n">brine_closures</span>
</span><span id="Closures-1625"><a href="#-1625"><span class="linenos">1625</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">all_closures</span><span class="p">):</span>
</span><span id="Closures-1626"><a href="#-1626"><span class="linenos">1626</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">sqldict</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;closure_</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">c</span>
</span><span id="Closures-1627"><a href="#-1627"><span class="linenos">1627</span></a>        <span class="n">num_labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">o</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
</span><span id="Closures-1628"><a href="#-1628"><span class="linenos">1628</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="Closures-1629"><a href="#-1629"><span class="linenos">1629</span></a>            <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="Closures-1630"><a href="#-1630"><span class="linenos">1630</span></a>            <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span>
</span><span id="Closures-1631"><a href="#-1631"><span class="linenos">1631</span></a>            <span class="n">subkey</span><span class="o">=</span><span class="s2">&quot;number_hc_closures&quot;</span><span class="p">,</span>
</span><span id="Closures-1632"><a href="#-1632"><span class="linenos">1632</span></a>            <span class="n">val</span><span class="o">=</span><span class="n">num_labels</span><span class="p">,</span>
</span><span id="Closures-1633"><a href="#-1633"><span class="linenos">1633</span></a>        <span class="p">)</span>
</span><span id="Closures-1634"><a href="#-1634"><span class="linenos">1634</span></a>        <span class="c1"># Add total number of closure voxels, with ratio of closure voxels given as a percentage</span>
</span><span id="Closures-1635"><a href="#-1635"><span class="linenos">1635</span></a>        <span class="n">closure_voxel_count</span> <span class="o">=</span> <span class="n">o</span><span class="p">[</span><span class="n">o</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="o">+</span> <span class="n">g</span><span class="p">[</span><span class="n">g</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="Closures-1636"><a href="#-1636"><span class="linenos">1636</span></a>        <span class="n">closure_voxel_pct</span> <span class="o">=</span> <span class="n">closure_voxel_count</span> <span class="o">/</span> <span class="n">o</span><span class="o">.</span><span class="n">size</span>
</span><span id="Closures-1637"><a href="#-1637"><span class="linenos">1637</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="Closures-1638"><a href="#-1638"><span class="linenos">1638</span></a>            <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="Closures-1639"><a href="#-1639"><span class="linenos">1639</span></a>            <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span>
</span><span id="Closures-1640"><a href="#-1640"><span class="linenos">1640</span></a>            <span class="n">subkey</span><span class="o">=</span><span class="s2">&quot;closure_voxel_count&quot;</span><span class="p">,</span>
</span><span id="Closures-1641"><a href="#-1641"><span class="linenos">1641</span></a>            <span class="n">val</span><span class="o">=</span><span class="n">closure_voxel_count</span><span class="p">,</span>
</span><span id="Closures-1642"><a href="#-1642"><span class="linenos">1642</span></a>        <span class="p">)</span>
</span><span id="Closures-1643"><a href="#-1643"><span class="linenos">1643</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="Closures-1644"><a href="#-1644"><span class="linenos">1644</span></a>            <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="Closures-1645"><a href="#-1645"><span class="linenos">1645</span></a>            <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span>
</span><span id="Closures-1646"><a href="#-1646"><span class="linenos">1646</span></a>            <span class="n">subkey</span><span class="o">=</span><span class="s2">&quot;closure_voxel_pct&quot;</span><span class="p">,</span>
</span><span id="Closures-1647"><a href="#-1647"><span class="linenos">1647</span></a>            <span class="n">val</span><span class="o">=</span><span class="n">closure_voxel_pct</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span>
</span><span id="Closures-1648"><a href="#-1648"><span class="linenos">1648</span></a>        <span class="p">)</span>
</span><span id="Closures-1649"><a href="#-1649"><span class="linenos">1649</span></a>        <span class="c1"># Same for Brine</span>
</span><span id="Closures-1650"><a href="#-1650"><span class="linenos">1650</span></a>        <span class="n">_brine_voxels</span> <span class="o">=</span> <span class="n">b</span><span class="p">[</span><span class="n">b</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="Closures-1651"><a href="#-1651"><span class="linenos">1651</span></a>        <span class="n">_brine_voxels_pct</span> <span class="o">=</span> <span class="n">_brine_voxels</span> <span class="o">/</span> <span class="n">b</span><span class="o">.</span><span class="n">size</span>
</span><span id="Closures-1652"><a href="#-1652"><span class="linenos">1652</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="Closures-1653"><a href="#-1653"><span class="linenos">1653</span></a>            <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="Closures-1654"><a href="#-1654"><span class="linenos">1654</span></a>            <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span>
</span><span id="Closures-1655"><a href="#-1655"><span class="linenos">1655</span></a>            <span class="n">subkey</span><span class="o">=</span><span class="s2">&quot;closure_voxel_count_brine&quot;</span><span class="p">,</span>
</span><span id="Closures-1656"><a href="#-1656"><span class="linenos">1656</span></a>            <span class="n">val</span><span class="o">=</span><span class="n">_brine_voxels</span><span class="p">,</span>
</span><span id="Closures-1657"><a href="#-1657"><span class="linenos">1657</span></a>        <span class="p">)</span>
</span><span id="Closures-1658"><a href="#-1658"><span class="linenos">1658</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="Closures-1659"><a href="#-1659"><span class="linenos">1659</span></a>            <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="Closures-1660"><a href="#-1660"><span class="linenos">1660</span></a>            <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span>
</span><span id="Closures-1661"><a href="#-1661"><span class="linenos">1661</span></a>            <span class="n">subkey</span><span class="o">=</span><span class="s2">&quot;closure_voxel_pct_brine&quot;</span><span class="p">,</span>
</span><span id="Closures-1662"><a href="#-1662"><span class="linenos">1662</span></a>            <span class="n">val</span><span class="o">=</span><span class="n">_brine_voxels_pct</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span>
</span><span id="Closures-1663"><a href="#-1663"><span class="linenos">1663</span></a>        <span class="p">)</span>
</span><span id="Closures-1664"><a href="#-1664"><span class="linenos">1664</span></a>        <span class="c1"># Same for Oil</span>
</span><span id="Closures-1665"><a href="#-1665"><span class="linenos">1665</span></a>        <span class="n">_oil_voxels</span> <span class="o">=</span> <span class="n">o</span><span class="p">[</span><span class="n">o</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="Closures-1666"><a href="#-1666"><span class="linenos">1666</span></a>        <span class="n">_oil_voxels_pct</span> <span class="o">=</span> <span class="n">_oil_voxels</span> <span class="o">/</span> <span class="n">o</span><span class="o">.</span><span class="n">size</span>
</span><span id="Closures-1667"><a href="#-1667"><span class="linenos">1667</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="Closures-1668"><a href="#-1668"><span class="linenos">1668</span></a>            <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="Closures-1669"><a href="#-1669"><span class="linenos">1669</span></a>            <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span>
</span><span id="Closures-1670"><a href="#-1670"><span class="linenos">1670</span></a>            <span class="n">subkey</span><span class="o">=</span><span class="s2">&quot;closure_voxel_count_oil&quot;</span><span class="p">,</span>
</span><span id="Closures-1671"><a href="#-1671"><span class="linenos">1671</span></a>            <span class="n">val</span><span class="o">=</span><span class="n">_oil_voxels</span><span class="p">,</span>
</span><span id="Closures-1672"><a href="#-1672"><span class="linenos">1672</span></a>        <span class="p">)</span>
</span><span id="Closures-1673"><a href="#-1673"><span class="linenos">1673</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="Closures-1674"><a href="#-1674"><span class="linenos">1674</span></a>            <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="Closures-1675"><a href="#-1675"><span class="linenos">1675</span></a>            <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span>
</span><span id="Closures-1676"><a href="#-1676"><span class="linenos">1676</span></a>            <span class="n">subkey</span><span class="o">=</span><span class="s2">&quot;closure_voxel_pct_oil&quot;</span><span class="p">,</span>
</span><span id="Closures-1677"><a href="#-1677"><span class="linenos">1677</span></a>            <span class="n">val</span><span class="o">=</span><span class="n">_oil_voxels_pct</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span>
</span><span id="Closures-1678"><a href="#-1678"><span class="linenos">1678</span></a>        <span class="p">)</span>
</span><span id="Closures-1679"><a href="#-1679"><span class="linenos">1679</span></a>        <span class="c1"># Same for Gas</span>
</span><span id="Closures-1680"><a href="#-1680"><span class="linenos">1680</span></a>        <span class="n">_gas_voxels</span> <span class="o">=</span> <span class="n">g</span><span class="p">[</span><span class="n">g</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="Closures-1681"><a href="#-1681"><span class="linenos">1681</span></a>        <span class="n">_gas_voxels_pct</span> <span class="o">=</span> <span class="n">_gas_voxels</span> <span class="o">/</span> <span class="n">g</span><span class="o">.</span><span class="n">size</span>
</span><span id="Closures-1682"><a href="#-1682"><span class="linenos">1682</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="Closures-1683"><a href="#-1683"><span class="linenos">1683</span></a>            <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="Closures-1684"><a href="#-1684"><span class="linenos">1684</span></a>            <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span>
</span><span id="Closures-1685"><a href="#-1685"><span class="linenos">1685</span></a>            <span class="n">subkey</span><span class="o">=</span><span class="s2">&quot;closure_voxel_count_gas&quot;</span><span class="p">,</span>
</span><span id="Closures-1686"><a href="#-1686"><span class="linenos">1686</span></a>            <span class="n">val</span><span class="o">=</span><span class="n">_gas_voxels</span><span class="p">,</span>
</span><span id="Closures-1687"><a href="#-1687"><span class="linenos">1687</span></a>        <span class="p">)</span>
</span><span id="Closures-1688"><a href="#-1688"><span class="linenos">1688</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="Closures-1689"><a href="#-1689"><span class="linenos">1689</span></a>            <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="Closures-1690"><a href="#-1690"><span class="linenos">1690</span></a>            <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span>
</span><span id="Closures-1691"><a href="#-1691"><span class="linenos">1691</span></a>            <span class="n">subkey</span><span class="o">=</span><span class="s2">&quot;closure_voxel_pct_gas&quot;</span><span class="p">,</span>
</span><span id="Closures-1692"><a href="#-1692"><span class="linenos">1692</span></a>            <span class="n">val</span><span class="o">=</span><span class="n">_gas_voxels_pct</span><span class="p">,</span>
</span><span id="Closures-1693"><a href="#-1693"><span class="linenos">1693</span></a>        <span class="p">)</span>
</span><span id="Closures-1694"><a href="#-1694"><span class="linenos">1694</span></a>        <span class="c1"># Write old logfile as well as the sql dict</span>
</span><span id="Closures-1695"><a href="#-1695"><span class="linenos">1695</span></a>        <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;layers for closure computation: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">top_lith_indices</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="Closures-1696"><a href="#-1696"><span class="linenos">1696</span></a>        <span class="n">msg</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;Number of HC Closures : </span><span class="si">{</span><span class="n">num_labels</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="Closures-1697"><a href="#-1697"><span class="linenos">1697</span></a>        <span class="n">msg</span> <span class="o">+=</span> <span class="p">(</span>
</span><span id="Closures-1698"><a href="#-1698"><span class="linenos">1698</span></a>            <span class="sa">f</span><span class="s2">&quot;Closure voxel count: </span><span class="si">{</span><span class="n">closure_voxel_count</span><span class="si">}</span><span class="s2"> - &quot;</span>
</span><span id="Closures-1699"><a href="#-1699"><span class="linenos">1699</span></a>            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">closure_voxel_pct</span><span class="si">:</span><span class="s2">5.2%</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="Closures-1700"><a href="#-1700"><span class="linenos">1700</span></a>        <span class="p">)</span>
</span><span id="Closures-1701"><a href="#-1701"><span class="linenos">1701</span></a>        <span class="n">msg</span> <span class="o">+=</span> <span class="p">(</span>
</span><span id="Closures-1702"><a href="#-1702"><span class="linenos">1702</span></a>            <span class="sa">f</span><span class="s2">&quot;Closure voxel count: (brine) </span><span class="si">{</span><span class="n">_brine_voxels</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">_brine_voxels_pct</span><span class="si">:</span><span class="s2">5.2%</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="Closures-1703"><a href="#-1703"><span class="linenos">1703</span></a>        <span class="p">)</span>
</span><span id="Closures-1704"><a href="#-1704"><span class="linenos">1704</span></a>        <span class="n">msg</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;Closure voxel count: (oil) </span><span class="si">{</span><span class="n">_oil_voxels</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">_oil_voxels_pct</span><span class="si">:</span><span class="s2">5.2%</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="Closures-1705"><a href="#-1705"><span class="linenos">1705</span></a>        <span class="n">msg</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;Closure voxel count: (gas) </span><span class="si">{</span><span class="n">_gas_voxels</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">_gas_voxels_pct</span><span class="si">:</span><span class="s2">5.2%</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="Closures-1706"><a href="#-1706"><span class="linenos">1706</span></a>        <span class="nb">print</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="Closures-1707"><a href="#-1707"><span class="linenos">1707</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">facies</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="Closures-1708"><a href="#-1708"><span class="linenos">1708</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">facies</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Closures-1709"><a href="#-1709"><span class="linenos">1709</span></a>                <span class="n">msg</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;  layers for closure computation:   </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">, sand</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="Closures-1710"><a href="#-1710"><span class="linenos">1710</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Closures-1711"><a href="#-1711"><span class="linenos">1711</span></a>                <span class="n">msg</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;  layers for closure computation:   </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">, shale</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="Closures-1712"><a href="#-1712"><span class="linenos">1712</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="Closures-1713"><a href="#-1713"><span class="linenos">1713</span></a>
</span><span id="Closures-1714"><a href="#-1714"><span class="linenos">1714</span></a>    <span class="k">def</span> <span class="nf">parse_label_values_and_counts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">labels_clean</span><span class="p">):</span>
</span><span id="Closures-1715"><a href="#-1715"><span class="linenos">1715</span></a>        <span class="sd">&quot;&quot;&quot;parse label values and counts&quot;&quot;&quot;</span>
</span><span id="Closures-1716"><a href="#-1716"><span class="linenos">1716</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Closures-1717"><a href="#-1717"><span class="linenos">1717</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; Inside parse_label_values_and_counts&quot;</span><span class="p">)</span>
</span><span id="Closures-1718"><a href="#-1718"><span class="linenos">1718</span></a>        <span class="n">next_label</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Closures-1719"><a href="#-1719"><span class="linenos">1719</span></a>        <span class="n">label_values</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Closures-1720"><a href="#-1720"><span class="linenos">1720</span></a>        <span class="n">label_counts</span> <span class="o">=</span> <span class="p">[</span><span class="n">labels_clean</span><span class="p">[</span><span class="n">labels_clean</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">]</span>
</span><span id="Closures-1721"><a href="#-1721"><span class="linenos">1721</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">labels_clean</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="Closures-1722"><a href="#-1722"><span class="linenos">1722</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="Closures-1723"><a href="#-1723"><span class="linenos">1723</span></a>                <span class="n">next_label</span> <span class="o">=</span> <span class="n">labels_clean</span><span class="p">[</span><span class="n">labels_clean</span> <span class="o">&gt;</span> <span class="n">next_label</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
</span><span id="Closures-1724"><a href="#-1724"><span class="linenos">1724</span></a>            <span class="k">except</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
</span><span id="Closures-1725"><a href="#-1725"><span class="linenos">1725</span></a>                <span class="k">break</span>
</span><span id="Closures-1726"><a href="#-1726"><span class="linenos">1726</span></a>            <span class="n">label_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">next_label</span><span class="p">)</span>
</span><span id="Closures-1727"><a href="#-1727"><span class="linenos">1727</span></a>            <span class="n">label_counts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">labels_clean</span><span class="p">[</span><span class="n">labels_clean</span> <span class="o">==</span> <span class="n">next_label</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
</span><span id="Closures-1728"><a href="#-1728"><span class="linenos">1728</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="Closures-1729"><a href="#-1729"><span class="linenos">1729</span></a>                <span class="sa">f</span><span class="s2">&quot;Label: </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">, label_values: </span><span class="si">{</span><span class="n">label_values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">, label_counts: </span><span class="si">{</span><span class="n">label_counts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Closures-1730"><a href="#-1730"><span class="linenos">1730</span></a>            <span class="p">)</span>
</span><span id="Closures-1731"><a href="#-1731"><span class="linenos">1731</span></a>        <span class="c1"># force labels to use consecutive integer values</span>
</span><span id="Closures-1732"><a href="#-1732"><span class="linenos">1732</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ilabel</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">label_values</span><span class="p">):</span>
</span><span id="Closures-1733"><a href="#-1733"><span class="linenos">1733</span></a>            <span class="n">labels_clean</span><span class="p">[</span><span class="n">labels_clean</span> <span class="o">==</span> <span class="n">ilabel</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
</span><span id="Closures-1734"><a href="#-1734"><span class="linenos">1734</span></a>            <span class="n">label_values</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
</span><span id="Closures-1735"><a href="#-1735"><span class="linenos">1735</span></a>        <span class="c1"># labels_clean = self.remove_small_objects(labels_clean)  # already applied to labels_clean</span>
</span><span id="Closures-1736"><a href="#-1736"><span class="linenos">1736</span></a>        <span class="c1"># Remove label_value 0</span>
</span><span id="Closures-1737"><a href="#-1737"><span class="linenos">1737</span></a>        <span class="n">label_values</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="Closures-1738"><a href="#-1738"><span class="linenos">1738</span></a>        <span class="k">return</span> <span class="n">label_values</span><span class="p">,</span> <span class="n">labels_clean</span>
</span><span id="Closures-1739"><a href="#-1739"><span class="linenos">1739</span></a>
</span><span id="Closures-1740"><a href="#-1740"><span class="linenos">1740</span></a>    <span class="k">def</span> <span class="nf">assign_fluid_types</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">label_values</span><span class="p">,</span> <span class="n">labels_clean</span><span class="p">):</span>
</span><span id="Closures-1741"><a href="#-1741"><span class="linenos">1741</span></a>        <span class="sd">&quot;&quot;&quot;randomly assign oil or gas to closure&quot;&quot;&quot;</span>
</span><span id="Closures-1742"><a href="#-1742"><span class="linenos">1742</span></a>        <span class="nb">print</span><span class="p">(</span>
</span><span id="Closures-1743"><a href="#-1743"><span class="linenos">1743</span></a>            <span class="s2">&quot; labels_clean.min(), labels_clean.max() = &quot;</span><span class="p">,</span>
</span><span id="Closures-1744"><a href="#-1744"><span class="linenos">1744</span></a>            <span class="n">labels_clean</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
</span><span id="Closures-1745"><a href="#-1745"><span class="linenos">1745</span></a>            <span class="n">labels_clean</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span>
</span><span id="Closures-1746"><a href="#-1746"><span class="linenos">1746</span></a>        <span class="p">)</span>
</span><span id="Closures-1747"><a href="#-1747"><span class="linenos">1747</span></a>        <span class="n">_brine_closures</span> <span class="o">=</span> <span class="p">(</span><span class="n">labels_clean</span> <span class="o">*</span> <span class="mf">0.0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;uint8&quot;</span><span class="p">)</span>
</span><span id="Closures-1748"><a href="#-1748"><span class="linenos">1748</span></a>        <span class="n">_oil_closures</span> <span class="o">=</span> <span class="p">(</span><span class="n">labels_clean</span> <span class="o">*</span> <span class="mf">0.0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;uint8&quot;</span><span class="p">)</span>
</span><span id="Closures-1749"><a href="#-1749"><span class="linenos">1749</span></a>        <span class="n">_gas_closures</span> <span class="o">=</span> <span class="p">(</span><span class="n">labels_clean</span> <span class="o">*</span> <span class="mf">0.0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;uint8&quot;</span><span class="p">)</span>
</span><span id="Closures-1750"><a href="#-1750"><span class="linenos">1750</span></a>
</span><span id="Closures-1751"><a href="#-1751"><span class="linenos">1751</span></a>        <span class="n">fluid_type_code</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">labels_clean</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="Closures-1752"><a href="#-1752"><span class="linenos">1752</span></a>
</span><span id="Closures-1753"><a href="#-1753"><span class="linenos">1753</span></a>        <span class="n">_closure_segments</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">closure_segments</span><span class="p">[:]</span>
</span><span id="Closures-1754"><a href="#-1754"><span class="linenos">1754</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">labels_clean</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="Closures-1755"><a href="#-1755"><span class="linenos">1755</span></a>            <span class="n">voxel_count</span> <span class="o">=</span> <span class="n">labels_clean</span><span class="p">[</span><span class="n">labels_clean</span> <span class="o">==</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="Closures-1756"><a href="#-1756"><span class="linenos">1756</span></a>            <span class="k">if</span> <span class="n">voxel_count</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Closures-1757"><a href="#-1757"><span class="linenos">1757</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Voxel Count: </span><span class="si">{</span><span class="n">voxel_count</span><span class="si">}</span><span class="se">\t</span><span class="s2">Fluid type: </span><span class="si">{</span><span class="n">fluid_type_code</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Closures-1758"><a href="#-1758"><span class="linenos">1758</span></a>            <span class="c1"># not in closure = 0</span>
</span><span id="Closures-1759"><a href="#-1759"><span class="linenos">1759</span></a>            <span class="c1"># closure with brine filled reservoir fluid_type_code = 1</span>
</span><span id="Closures-1760"><a href="#-1760"><span class="linenos">1760</span></a>            <span class="c1"># closure with oil filled reservoir fluid_type_code = 2</span>
</span><span id="Closures-1761"><a href="#-1761"><span class="linenos">1761</span></a>            <span class="c1"># closure with gas filled reservoir fluid_type_code = 3</span>
</span><span id="Closures-1762"><a href="#-1762"><span class="linenos">1762</span></a>            <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">label_values</span><span class="p">:</span>
</span><span id="Closures-1763"><a href="#-1763"><span class="linenos">1763</span></a>                <span class="k">if</span> <span class="n">fluid_type_code</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Closures-1764"><a href="#-1764"><span class="linenos">1764</span></a>                    <span class="c1"># brine: change labels_clean contents to fluid_type_code = 1 (same as background)</span>
</span><span id="Closures-1765"><a href="#-1765"><span class="linenos">1765</span></a>                    <span class="n">_brine_closures</span><span class="p">[</span>
</span><span id="Closures-1766"><a href="#-1766"><span class="linenos">1766</span></a>                        <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">labels_clean</span> <span class="o">==</span> <span class="n">i</span><span class="p">,</span> <span class="n">_closure_segments</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="Closures-1767"><a href="#-1767"><span class="linenos">1767</span></a>                    <span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="Closures-1768"><a href="#-1768"><span class="linenos">1768</span></a>                <span class="k">elif</span> <span class="n">fluid_type_code</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Closures-1769"><a href="#-1769"><span class="linenos">1769</span></a>                    <span class="c1"># oil: change labels_clean contents to fluid_type_code = 2</span>
</span><span id="Closures-1770"><a href="#-1770"><span class="linenos">1770</span></a>                    <span class="n">_oil_closures</span><span class="p">[</span><span class="n">labels_clean</span> <span class="o">==</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="Closures-1771"><a href="#-1771"><span class="linenos">1771</span></a>                <span class="k">elif</span> <span class="n">fluid_type_code</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="Closures-1772"><a href="#-1772"><span class="linenos">1772</span></a>                    <span class="c1"># gas: change labels_clean contents to fluid_type_code = 3</span>
</span><span id="Closures-1773"><a href="#-1773"><span class="linenos">1773</span></a>                    <span class="n">_gas_closures</span><span class="p">[</span><span class="n">labels_clean</span> <span class="o">==</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="Closures-1774"><a href="#-1774"><span class="linenos">1774</span></a>        <span class="k">return</span> <span class="n">_oil_closures</span><span class="p">,</span> <span class="n">_gas_closures</span><span class="p">,</span> <span class="n">_brine_closures</span>
</span><span id="Closures-1775"><a href="#-1775"><span class="linenos">1775</span></a>
</span><span id="Closures-1776"><a href="#-1776"><span class="linenos">1776</span></a>    <span class="k">def</span> <span class="nf">remove_small_objects</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">min_filter</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="Closures-1777"><a href="#-1777"><span class="linenos">1777</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="Closures-1778"><a href="#-1778"><span class="linenos">1778</span></a>            <span class="c1"># Use the global minimum voxel size initially, before closure types are identified</span>
</span><span id="Closures-1779"><a href="#-1779"><span class="linenos">1779</span></a>            <span class="n">labels_clean</span> <span class="o">=</span> <span class="n">morphology</span><span class="o">.</span><span class="n">remove_small_objects</span><span class="p">(</span>
</span><span id="Closures-1780"><a href="#-1780"><span class="linenos">1780</span></a>                <span class="n">labels</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">closure_min_voxels</span>
</span><span id="Closures-1781"><a href="#-1781"><span class="linenos">1781</span></a>            <span class="p">)</span>
</span><span id="Closures-1782"><a href="#-1782"><span class="linenos">1782</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Closures-1783"><a href="#-1783"><span class="linenos">1783</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;labels_clean succeeded.&quot;</span><span class="p">)</span>
</span><span id="Closures-1784"><a href="#-1784"><span class="linenos">1784</span></a>                <span class="nb">print</span><span class="p">(</span>
</span><span id="Closures-1785"><a href="#-1785"><span class="linenos">1785</span></a>                    <span class="s2">&quot; labels.min:</span><span class="si">{}</span><span class="s2">, labels.max: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">labels</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">labels</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
</span><span id="Closures-1786"><a href="#-1786"><span class="linenos">1786</span></a>                <span class="p">)</span>
</span><span id="Closures-1787"><a href="#-1787"><span class="linenos">1787</span></a>                <span class="nb">print</span><span class="p">(</span>
</span><span id="Closures-1788"><a href="#-1788"><span class="linenos">1788</span></a>                    <span class="s2">&quot; labels_clean min:</span><span class="si">{}</span><span class="s2">, labels_clean max: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="Closures-1789"><a href="#-1789"><span class="linenos">1789</span></a>                        <span class="n">labels_clean</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">labels_clean</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</span><span id="Closures-1790"><a href="#-1790"><span class="linenos">1790</span></a>                    <span class="p">)</span>
</span><span id="Closures-1791"><a href="#-1791"><span class="linenos">1791</span></a>                <span class="p">)</span>
</span><span id="Closures-1792"><a href="#-1792"><span class="linenos">1792</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="Closures-1793"><a href="#-1793"><span class="linenos">1793</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="Closures-1794"><a href="#-1794"><span class="linenos">1794</span></a>                <span class="sa">f</span><span class="s2">&quot;Closures/create_closures: labels_clean (remove_small_objects) did not succeed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Closures-1795"><a href="#-1795"><span class="linenos">1795</span></a>            <span class="p">)</span>
</span><span id="Closures-1796"><a href="#-1796"><span class="linenos">1796</span></a>            <span class="k">if</span> <span class="n">min_filter</span><span class="p">:</span>
</span><span id="Closures-1797"><a href="#-1797"><span class="linenos">1797</span></a>                <span class="n">labels_clean</span> <span class="o">=</span> <span class="n">minimum_filter</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
</span><span id="Closures-1798"><a href="#-1798"><span class="linenos">1798</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Closures-1799"><a href="#-1799"><span class="linenos">1799</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="Closures-1800"><a href="#-1800"><span class="linenos">1800</span></a>                        <span class="s2">&quot; labels.min:</span><span class="si">{}</span><span class="s2">, labels.max: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="Closures-1801"><a href="#-1801"><span class="linenos">1801</span></a>                            <span class="n">labels</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">labels</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</span><span id="Closures-1802"><a href="#-1802"><span class="linenos">1802</span></a>                        <span class="p">)</span>
</span><span id="Closures-1803"><a href="#-1803"><span class="linenos">1803</span></a>                    <span class="p">)</span>
</span><span id="Closures-1804"><a href="#-1804"><span class="linenos">1804</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="Closures-1805"><a href="#-1805"><span class="linenos">1805</span></a>                        <span class="s2">&quot; labels_clean min:</span><span class="si">{}</span><span class="s2">, labels_clean max: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="Closures-1806"><a href="#-1806"><span class="linenos">1806</span></a>                            <span class="n">labels_clean</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">labels_clean</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</span><span id="Closures-1807"><a href="#-1807"><span class="linenos">1807</span></a>                        <span class="p">)</span>
</span><span id="Closures-1808"><a href="#-1808"><span class="linenos">1808</span></a>                    <span class="p">)</span>
</span><span id="Closures-1809"><a href="#-1809"><span class="linenos">1809</span></a>        <span class="k">return</span> <span class="n">labels_clean</span>
</span><span id="Closures-1810"><a href="#-1810"><span class="linenos">1810</span></a>
</span><span id="Closures-1811"><a href="#-1811"><span class="linenos">1811</span></a>    <span class="k">def</span> <span class="nf">segment_closures</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_closure_segments</span><span class="p">,</span> <span class="n">remove_shale</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="Closures-1812"><a href="#-1812"><span class="linenos">1812</span></a>        <span class="sd">&quot;&quot;&quot;Segment the closures so that they can be randomly filled with hydrocarbons&quot;&quot;&quot;</span>
</span><span id="Closures-1813"><a href="#-1813"><span class="linenos">1813</span></a>
</span><span id="Closures-1814"><a href="#-1814"><span class="linenos">1814</span></a>        <span class="n">_closure_segments</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">_closure_segments</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
</span><span id="Closures-1815"><a href="#-1815"><span class="linenos">1815</span></a>        <span class="c1"># remove tiny clusters</span>
</span><span id="Closures-1816"><a href="#-1816"><span class="linenos">1816</span></a>        <span class="n">_closure_segments</span> <span class="o">=</span> <span class="n">minimum_filter</span><span class="p">(</span>
</span><span id="Closures-1817"><a href="#-1817"><span class="linenos">1817</span></a>            <span class="n">_closure_segments</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;int16&quot;</span><span class="p">),</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="Closures-1818"><a href="#-1818"><span class="linenos">1818</span></a>        <span class="p">)</span>
</span><span id="Closures-1819"><a href="#-1819"><span class="linenos">1819</span></a>        <span class="n">_closure_segments</span> <span class="o">=</span> <span class="n">maximum_filter</span><span class="p">(</span><span class="n">_closure_segments</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</span><span id="Closures-1820"><a href="#-1820"><span class="linenos">1820</span></a>
</span><span id="Closures-1821"><a href="#-1821"><span class="linenos">1821</span></a>        <span class="k">if</span> <span class="n">remove_shale</span><span class="p">:</span>
</span><span id="Closures-1822"><a href="#-1822"><span class="linenos">1822</span></a>            <span class="c1"># restrict closures to sand (non-shale) voxels</span>
</span><span id="Closures-1823"><a href="#-1823"><span class="linenos">1823</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">faulted_lithology</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="n">_closure_segments</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
</span><span id="Closures-1824"><a href="#-1824"><span class="linenos">1824</span></a>                <span class="n">sand_shale</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">faulted_lithology</span><span class="p">[:]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Closures-1825"><a href="#-1825"><span class="linenos">1825</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Closures-1826"><a href="#-1826"><span class="linenos">1826</span></a>                <span class="n">sand_shale</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">faulted_lithology</span><span class="p">[</span>
</span><span id="Closures-1827"><a href="#-1827"><span class="linenos">1827</span></a>                    <span class="p">:,</span> <span class="p">:,</span> <span class="p">::</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">infill_factor</span>
</span><span id="Closures-1828"><a href="#-1828"><span class="linenos">1828</span></a>                <span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Closures-1829"><a href="#-1829"><span class="linenos">1829</span></a>            <span class="n">_closure_segments</span><span class="p">[</span><span class="n">sand_shale</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Closures-1830"><a href="#-1830"><span class="linenos">1830</span></a>            <span class="k">del</span> <span class="n">sand_shale</span>
</span><span id="Closures-1831"><a href="#-1831"><span class="linenos">1831</span></a>        <span class="n">labels</span> <span class="o">=</span> <span class="n">measure</span><span class="o">.</span><span class="n">label</span><span class="p">(</span><span class="n">_closure_segments</span><span class="p">,</span> <span class="n">connectivity</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">background</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="Closures-1832"><a href="#-1832"><span class="linenos">1832</span></a>
</span><span id="Closures-1833"><a href="#-1833"><span class="linenos">1833</span></a>        <span class="n">labels_clean</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">remove_small_objects</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>
</span><span id="Closures-1834"><a href="#-1834"><span class="linenos">1834</span></a>        <span class="k">return</span> <span class="n">labels_clean</span><span class="p">,</span> <span class="n">_closure_segments</span>
</span><span id="Closures-1835"><a href="#-1835"><span class="linenos">1835</span></a>
</span><span id="Closures-1836"><a href="#-1836"><span class="linenos">1836</span></a>    <span class="k">def</span> <span class="nf">write_closure_volumes_to_disk</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Closures-1837"><a href="#-1837"><span class="linenos">1837</span></a>        <span class="c1"># Create files for closure volumes</span>
</span><span id="Closures-1838"><a href="#-1838"><span class="linenos">1838</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">write_cube_to_disk</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">brine_closures</span><span class="p">[:],</span> <span class="s2">&quot;closure_segments_brine&quot;</span><span class="p">)</span>
</span><span id="Closures-1839"><a href="#-1839"><span class="linenos">1839</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">write_cube_to_disk</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">oil_closures</span><span class="p">[:],</span> <span class="s2">&quot;closure_segments_oil&quot;</span><span class="p">)</span>
</span><span id="Closures-1840"><a href="#-1840"><span class="linenos">1840</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">write_cube_to_disk</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gas_closures</span><span class="p">[:],</span> <span class="s2">&quot;closure_segments_gas&quot;</span><span class="p">)</span>
</span><span id="Closures-1841"><a href="#-1841"><span class="linenos">1841</span></a>        <span class="c1"># Create combined HC cube by adding oil and gas closures</span>
</span><span id="Closures-1842"><a href="#-1842"><span class="linenos">1842</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">hc_labels</span><span class="p">[:]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">oil_closures</span><span class="p">[:]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">gas_closures</span><span class="p">[:])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span>
</span><span id="Closures-1843"><a href="#-1843"><span class="linenos">1843</span></a>            <span class="s2">&quot;uint8&quot;</span>
</span><span id="Closures-1844"><a href="#-1844"><span class="linenos">1844</span></a>        <span class="p">)</span>
</span><span id="Closures-1845"><a href="#-1845"><span class="linenos">1845</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">write_cube_to_disk</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hc_labels</span><span class="p">[:],</span> <span class="s2">&quot;closure_segments_hc&quot;</span><span class="p">)</span>
</span><span id="Closures-1846"><a href="#-1846"><span class="linenos">1846</span></a>
</span><span id="Closures-1847"><a href="#-1847"><span class="linenos">1847</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">model_qc_volumes</span><span class="p">:</span>
</span><span id="Closures-1848"><a href="#-1848"><span class="linenos">1848</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">write_cube_to_disk</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">closure_segments</span><span class="p">,</span> <span class="s2">&quot;closure_segments_raw_all&quot;</span><span class="p">)</span>
</span><span id="Closures-1849"><a href="#-1849"><span class="linenos">1849</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">write_cube_to_disk</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">simple_closures</span><span class="p">,</span> <span class="s2">&quot;closure_segments_simple&quot;</span><span class="p">)</span>
</span><span id="Closures-1850"><a href="#-1850"><span class="linenos">1850</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">write_cube_to_disk</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">strat_closures</span><span class="p">,</span> <span class="s2">&quot;closure_segments_strat&quot;</span><span class="p">)</span>
</span><span id="Closures-1851"><a href="#-1851"><span class="linenos">1851</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">write_cube_to_disk</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fault_closures</span><span class="p">,</span> <span class="s2">&quot;closure_segments_fault&quot;</span><span class="p">)</span>
</span><span id="Closures-1852"><a href="#-1852"><span class="linenos">1852</span></a>
</span><span id="Closures-1853"><a href="#-1853"><span class="linenos">1853</span></a>        <span class="c1"># Triple check that no small closures exist in the final closure files</span>
</span><span id="Closures-1854"><a href="#-1854"><span class="linenos">1854</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span>
</span><span id="Closures-1855"><a href="#-1855"><span class="linenos">1855</span></a>            <span class="p">[</span>
</span><span id="Closures-1856"><a href="#-1856"><span class="linenos">1856</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">oil_closures</span><span class="p">,</span>
</span><span id="Closures-1857"><a href="#-1857"><span class="linenos">1857</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">gas_closures</span><span class="p">,</span>
</span><span id="Closures-1858"><a href="#-1858"><span class="linenos">1858</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">simple_closures</span><span class="p">,</span>
</span><span id="Closures-1859"><a href="#-1859"><span class="linenos">1859</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">strat_closures</span><span class="p">,</span>
</span><span id="Closures-1860"><a href="#-1860"><span class="linenos">1860</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">fault_closures</span><span class="p">,</span>
</span><span id="Closures-1861"><a href="#-1861"><span class="linenos">1861</span></a>            <span class="p">]</span>
</span><span id="Closures-1862"><a href="#-1862"><span class="linenos">1862</span></a>        <span class="p">):</span>
</span><span id="Closures-1863"><a href="#-1863"><span class="linenos">1863</span></a>            <span class="n">_t</span> <span class="o">=</span> <span class="n">measure</span><span class="o">.</span><span class="n">label</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">connectivity</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">background</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="Closures-1864"><a href="#-1864"><span class="linenos">1864</span></a>            <span class="n">counts</span> <span class="o">=</span> <span class="p">[</span><span class="n">_t</span><span class="p">[</span><span class="n">_t</span> <span class="o">==</span> <span class="n">x</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">_t</span><span class="p">))]</span>
</span><span id="Closures-1865"><a href="#-1865"><span class="linenos">1865</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Final closure volume voxels sizes: </span><span class="si">{</span><span class="n">counts</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Closures-1866"><a href="#-1866"><span class="linenos">1866</span></a>            <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">counts</span><span class="p">):</span>
</span><span id="Closures-1867"><a href="#-1867"><span class="linenos">1867</span></a>                <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">closure_min_voxels</span><span class="p">:</span>
</span><span id="Closures-1868"><a href="#-1868"><span class="linenos">1868</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Voxel count: </span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="se">\t</span><span class="s2"> Count:</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">, index: </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Closures-1869"><a href="#-1869"><span class="linenos">1869</span></a>
</span><span id="Closures-1870"><a href="#-1870"><span class="linenos">1870</span></a>        <span class="c1"># Return the hydrocarbon closure labels so that augmentation can be applied to the data &amp; labels</span>
</span><span id="Closures-1871"><a href="#-1871"><span class="linenos">1871</span></a>        <span class="c1"># return self.oil_closures + self.gas_closures</span>
</span><span id="Closures-1872"><a href="#-1872"><span class="linenos">1872</span></a>
</span><span id="Closures-1873"><a href="#-1873"><span class="linenos">1873</span></a>    <span class="k">def</span> <span class="nf">calculate_closure_statistics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">in_array</span><span class="p">,</span> <span class="n">closure_type</span><span class="p">):</span>
</span><span id="Closures-1874"><a href="#-1874"><span class="linenos">1874</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="Closures-1875"><a href="#-1875"><span class="linenos">1875</span></a><span class="sd">        Calculate the size and location of isolated features in an array</span>
</span><span id="Closures-1876"><a href="#-1876"><span class="linenos">1876</span></a>
</span><span id="Closures-1877"><a href="#-1877"><span class="linenos">1877</span></a><span class="sd">        :param in_array: ndarray. Input array to be labelled, where non-zero values are counted as features</span>
</span><span id="Closures-1878"><a href="#-1878"><span class="linenos">1878</span></a><span class="sd">        :param closure_type: string. Closure type label</span>
</span><span id="Closures-1879"><a href="#-1879"><span class="linenos">1879</span></a><span class="sd">        :param digi: int or float. To convert depth values from samples to units</span>
</span><span id="Closures-1880"><a href="#-1880"><span class="linenos">1880</span></a><span class="sd">        :return: string. Concatenated string of closure statistics to be written to log</span>
</span><span id="Closures-1881"><a href="#-1881"><span class="linenos">1881</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Closures-1882"><a href="#-1882"><span class="linenos">1882</span></a>        <span class="n">labelled_array</span><span class="p">,</span> <span class="n">max_labels</span> <span class="o">=</span> <span class="n">measure</span><span class="o">.</span><span class="n">label</span><span class="p">(</span>
</span><span id="Closures-1883"><a href="#-1883"><span class="linenos">1883</span></a>            <span class="n">in_array</span><span class="p">,</span> <span class="n">connectivity</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">return_num</span><span class="o">=</span><span class="kc">True</span>
</span><span id="Closures-1884"><a href="#-1884"><span class="linenos">1884</span></a>        <span class="p">)</span>
</span><span id="Closures-1885"><a href="#-1885"><span class="linenos">1885</span></a>        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="Closures-1886"><a href="#-1886"><span class="linenos">1886</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_labels</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>  <span class="c1"># start at 1 to avoid counting 0&#39;s</span>
</span><span id="Closures-1887"><a href="#-1887"><span class="linenos">1887</span></a>            <span class="n">trap</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">labelled_array</span> <span class="o">==</span> <span class="n">i</span><span class="p">)</span>
</span><span id="Closures-1888"><a href="#-1888"><span class="linenos">1888</span></a>            <span class="n">ranges</span> <span class="o">=</span> <span class="p">[([</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">trap</span><span class="p">[</span><span class="n">x</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">trap</span><span class="p">[</span><span class="n">x</span><span class="p">])])</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">trap</span><span class="p">)]</span>
</span><span id="Closures-1889"><a href="#-1889"><span class="linenos">1889</span></a>            <span class="n">sizes</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">ranges</span><span class="p">]</span>
</span><span id="Closures-1890"><a href="#-1890"><span class="linenos">1890</span></a>            <span class="n">n_voxels</span> <span class="o">=</span> <span class="n">labelled_array</span><span class="p">[</span><span class="n">labelled_array</span> <span class="o">==</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="Closures-1891"><a href="#-1891"><span class="linenos">1891</span></a>            <span class="k">if</span> <span class="nb">sum</span><span class="p">(</span><span class="n">sizes</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Closures-1892"><a href="#-1892"><span class="linenos">1892</span></a>                <span class="n">msg</span> <span class="o">+=</span> <span class="p">(</span>
</span><span id="Closures-1893"><a href="#-1893"><span class="linenos">1893</span></a>                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">closure_type</span><span class="si">}</span><span class="se">\t</span><span class="s2">&quot;</span>
</span><span id="Closures-1894"><a href="#-1894"><span class="linenos">1894</span></a>                    <span class="sa">f</span><span class="s2">&quot;Num X,Y,Z Samples: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">sizes</span><span class="p">)</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span><span class="si">}</span><span class="se">\t</span><span class="s2">&quot;</span>
</span><span id="Closures-1895"><a href="#-1895"><span class="linenos">1895</span></a>                    <span class="sa">f</span><span class="s2">&quot;Num Voxels: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">n_voxels</span><span class="p">)</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="si">}</span><span class="se">\t</span><span class="s2">&quot;</span>
</span><span id="Closures-1896"><a href="#-1896"><span class="linenos">1896</span></a>                    <span class="sa">f</span><span class="s2">&quot;Track: </span><span class="si">{</span><span class="mi">2000</span> <span class="o">+</span> <span class="n">ranges</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="mi">2000</span> <span class="o">+</span> <span class="n">ranges</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="se">\t</span><span class="s2">&quot;</span>
</span><span id="Closures-1897"><a href="#-1897"><span class="linenos">1897</span></a>                    <span class="sa">f</span><span class="s2">&quot;Bin: </span><span class="si">{</span><span class="mi">1000</span> <span class="o">+</span> <span class="n">ranges</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="mi">1000</span> <span class="o">+</span> <span class="n">ranges</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="se">\t</span><span class="s2">&quot;</span>
</span><span id="Closures-1898"><a href="#-1898"><span class="linenos">1898</span></a>                    <span class="sa">f</span><span class="s2">&quot;Depth: </span><span class="si">{</span><span class="n">ranges</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">digi</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">ranges</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">digi</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">digi</span> <span class="o">/</span> <span class="mi">2</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="Closures-1899"><a href="#-1899"><span class="linenos">1899</span></a>                <span class="p">)</span>
</span><span id="Closures-1900"><a href="#-1900"><span class="linenos">1900</span></a>        <span class="k">return</span> <span class="n">msg</span>
</span><span id="Closures-1901"><a href="#-1901"><span class="linenos">1901</span></a>
</span><span id="Closures-1902"><a href="#-1902"><span class="linenos">1902</span></a>    <span class="k">def</span> <span class="nf">find_faulted_closures</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">closure_segment_list</span><span class="p">,</span> <span class="n">closure_segments</span><span class="p">):</span>
</span><span id="Closures-1903"><a href="#-1903"><span class="linenos">1903</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dilate_faults</span><span class="p">()</span>
</span><span id="Closures-1904"><a href="#-1904"><span class="linenos">1904</span></a>        <span class="k">for</span> <span class="n">iclosure</span> <span class="ow">in</span> <span class="n">closure_segment_list</span><span class="p">:</span>
</span><span id="Closures-1905"><a href="#-1905"><span class="linenos">1905</span></a>            <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">closure_segments</span> <span class="o">==</span> <span class="n">iclosure</span><span class="p">)</span>
</span><span id="Closures-1906"><a href="#-1906"><span class="linenos">1906</span></a>            <span class="n">faults_within_closure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wide_faults</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span>
</span><span id="Closures-1907"><a href="#-1907"><span class="linenos">1907</span></a>            <span class="k">if</span> <span class="n">faults_within_closure</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Closures-1908"><a href="#-1908"><span class="linenos">1908</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">oil_closures</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Closures-1909"><a href="#-1909"><span class="linenos">1909</span></a>                    <span class="c1"># Faulted oil closure</span>
</span><span id="Closures-1910"><a href="#-1910"><span class="linenos">1910</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">faulted_closures_oil</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="Closures-1911"><a href="#-1911"><span class="linenos">1911</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">n_fault_closures_oil</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="Closures-1912"><a href="#-1912"><span class="linenos">1912</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">fault_closures_oil_segment_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">iclosure</span><span class="p">)</span>
</span><span id="Closures-1913"><a href="#-1913"><span class="linenos">1913</span></a>                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">gas_closures</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Closures-1914"><a href="#-1914"><span class="linenos">1914</span></a>                    <span class="c1"># Faulted gas closure</span>
</span><span id="Closures-1915"><a href="#-1915"><span class="linenos">1915</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">faulted_closures_gas</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="Closures-1916"><a href="#-1916"><span class="linenos">1916</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">n_fault_closures_gas</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="Closures-1917"><a href="#-1917"><span class="linenos">1917</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">fault_closures_gas_segment_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">iclosure</span><span class="p">)</span>
</span><span id="Closures-1918"><a href="#-1918"><span class="linenos">1918</span></a>                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">brine_closures</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Closures-1919"><a href="#-1919"><span class="linenos">1919</span></a>                    <span class="c1"># Faulted brine closure</span>
</span><span id="Closures-1920"><a href="#-1920"><span class="linenos">1920</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">faulted_closures_brine</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="Closures-1921"><a href="#-1921"><span class="linenos">1921</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">n_fault_closures_brine</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="Closures-1922"><a href="#-1922"><span class="linenos">1922</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">fault_closures_brine_segment_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">iclosure</span><span class="p">)</span>
</span><span id="Closures-1923"><a href="#-1923"><span class="linenos">1923</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Closures-1924"><a href="#-1924"><span class="linenos">1924</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="Closures-1925"><a href="#-1925"><span class="linenos">1925</span></a>                        <span class="s2">&quot;Closure is faulted but does not have oil, gas or brine assigned&quot;</span>
</span><span id="Closures-1926"><a href="#-1926"><span class="linenos">1926</span></a>                    <span class="p">)</span>
</span><span id="Closures-1927"><a href="#-1927"><span class="linenos">1927</span></a>
</span><span id="Closures-1928"><a href="#-1928"><span class="linenos">1928</span></a>    <span class="k">def</span> <span class="nf">find_onlap_closures</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">closure_segment_list</span><span class="p">,</span> <span class="n">closure_segments</span><span class="p">):</span>
</span><span id="Closures-1929"><a href="#-1929"><span class="linenos">1929</span></a>        <span class="k">for</span> <span class="n">iclosure</span> <span class="ow">in</span> <span class="n">closure_segment_list</span><span class="p">:</span>
</span><span id="Closures-1930"><a href="#-1930"><span class="linenos">1930</span></a>            <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">closure_segments</span> <span class="o">==</span> <span class="n">iclosure</span><span class="p">)</span>
</span><span id="Closures-1931"><a href="#-1931"><span class="linenos">1931</span></a>            <span class="n">onlaps_within_closure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">onlaps_upward</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span>
</span><span id="Closures-1932"><a href="#-1932"><span class="linenos">1932</span></a>            <span class="k">if</span> <span class="n">onlaps_within_closure</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Closures-1933"><a href="#-1933"><span class="linenos">1933</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">oil_closures</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Closures-1934"><a href="#-1934"><span class="linenos">1934</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">onlap_closures_oil</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="Closures-1935"><a href="#-1935"><span class="linenos">1935</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">n_onlap_closures_oil</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="Closures-1936"><a href="#-1936"><span class="linenos">1936</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">onlap_closures_oil_segment_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">iclosure</span><span class="p">)</span>
</span><span id="Closures-1937"><a href="#-1937"><span class="linenos">1937</span></a>                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">gas_closures</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Closures-1938"><a href="#-1938"><span class="linenos">1938</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">onlap_closures_gas</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="Closures-1939"><a href="#-1939"><span class="linenos">1939</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">n_onlap_closures_gas</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="Closures-1940"><a href="#-1940"><span class="linenos">1940</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">onlap_closures_gas_segment_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">iclosure</span><span class="p">)</span>
</span><span id="Closures-1941"><a href="#-1941"><span class="linenos">1941</span></a>                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">brine_closures</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Closures-1942"><a href="#-1942"><span class="linenos">1942</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">onlap_closures_brine</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="Closures-1943"><a href="#-1943"><span class="linenos">1943</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">n_onlap_closures_brine</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="Closures-1944"><a href="#-1944"><span class="linenos">1944</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">onlap_closures_brine_segment_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">iclosure</span><span class="p">)</span>
</span><span id="Closures-1945"><a href="#-1945"><span class="linenos">1945</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Closures-1946"><a href="#-1946"><span class="linenos">1946</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="Closures-1947"><a href="#-1947"><span class="linenos">1947</span></a>                        <span class="s2">&quot;Closure is onlap but does not have oil, gas or brine assigned&quot;</span>
</span><span id="Closures-1948"><a href="#-1948"><span class="linenos">1948</span></a>                    <span class="p">)</span>
</span><span id="Closures-1949"><a href="#-1949"><span class="linenos">1949</span></a>
</span><span id="Closures-1950"><a href="#-1950"><span class="linenos">1950</span></a>    <span class="k">def</span> <span class="nf">find_simple_closures</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">closure_segment_list</span><span class="p">,</span> <span class="n">closure_segments</span><span class="p">):</span>
</span><span id="Closures-1951"><a href="#-1951"><span class="linenos">1951</span></a>        <span class="k">for</span> <span class="n">iclosure</span> <span class="ow">in</span> <span class="n">closure_segment_list</span><span class="p">:</span>
</span><span id="Closures-1952"><a href="#-1952"><span class="linenos">1952</span></a>            <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">closure_segments</span> <span class="o">==</span> <span class="n">iclosure</span><span class="p">)</span>
</span><span id="Closures-1953"><a href="#-1953"><span class="linenos">1953</span></a>            <span class="n">faults_within_closure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wide_faults</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span>
</span><span id="Closures-1954"><a href="#-1954"><span class="linenos">1954</span></a>            <span class="n">onlaps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_threshold_volumes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">faulted_onlap_segments</span><span class="p">[:])</span>
</span><span id="Closures-1955"><a href="#-1955"><span class="linenos">1955</span></a>            <span class="n">onlaps_within_closure</span> <span class="o">=</span> <span class="n">onlaps</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span>
</span><span id="Closures-1956"><a href="#-1956"><span class="linenos">1956</span></a>            <span class="n">oil_within_closure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">oil_closures</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span>
</span><span id="Closures-1957"><a href="#-1957"><span class="linenos">1957</span></a>            <span class="n">gas_within_closure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gas_closures</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span>
</span><span id="Closures-1958"><a href="#-1958"><span class="linenos">1958</span></a>            <span class="n">brine_within_closure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">brine_closures</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span>
</span><span id="Closures-1959"><a href="#-1959"><span class="linenos">1959</span></a>            <span class="k">if</span> <span class="n">faults_within_closure</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">onlaps_within_closure</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Closures-1960"><a href="#-1960"><span class="linenos">1960</span></a>                <span class="k">if</span> <span class="n">oil_within_closure</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Closures-1961"><a href="#-1961"><span class="linenos">1961</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">simple_closures_oil</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="Closures-1962"><a href="#-1962"><span class="linenos">1962</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">n_4way_closures_oil</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="Closures-1963"><a href="#-1963"><span class="linenos">1963</span></a>                <span class="k">elif</span> <span class="n">gas_within_closure</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Closures-1964"><a href="#-1964"><span class="linenos">1964</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">simple_closures_gas</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="Closures-1965"><a href="#-1965"><span class="linenos">1965</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">n_4way_closures_gas</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="Closures-1966"><a href="#-1966"><span class="linenos">1966</span></a>                <span class="k">elif</span> <span class="n">brine_within_closure</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Closures-1967"><a href="#-1967"><span class="linenos">1967</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">simple_closures_brine</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="Closures-1968"><a href="#-1968"><span class="linenos">1968</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">n_4way_closures_brine</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="Closures-1969"><a href="#-1969"><span class="linenos">1969</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Closures-1970"><a href="#-1970"><span class="linenos">1970</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="Closures-1971"><a href="#-1971"><span class="linenos">1971</span></a>                        <span class="s2">&quot;Closure is not faulted or onlap but does not have oil, gas or brine assigned&quot;</span>
</span><span id="Closures-1972"><a href="#-1972"><span class="linenos">1972</span></a>                    <span class="p">)</span>
</span><span id="Closures-1973"><a href="#-1973"><span class="linenos">1973</span></a>
</span><span id="Closures-1974"><a href="#-1974"><span class="linenos">1974</span></a>    <span class="k">def</span> <span class="nf">find_false_closures</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">closure_segment_list</span><span class="p">,</span> <span class="n">closure_segments</span><span class="p">):</span>
</span><span id="Closures-1975"><a href="#-1975"><span class="linenos">1975</span></a>        <span class="k">for</span> <span class="n">iclosure</span> <span class="ow">in</span> <span class="n">closure_segment_list</span><span class="p">:</span>
</span><span id="Closures-1976"><a href="#-1976"><span class="linenos">1976</span></a>            <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">closure_segments</span> <span class="o">==</span> <span class="n">iclosure</span><span class="p">)</span>
</span><span id="Closures-1977"><a href="#-1977"><span class="linenos">1977</span></a>            <span class="n">faults_within_closure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fat_faults</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span>
</span><span id="Closures-1978"><a href="#-1978"><span class="linenos">1978</span></a>            <span class="n">onlaps_within_closure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">onlaps_downward</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span>
</span><span id="Closures-1979"><a href="#-1979"><span class="linenos">1979</span></a>            <span class="k">for</span> <span class="n">fluid</span><span class="p">,</span> <span class="n">false</span><span class="p">,</span> <span class="n">num</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
</span><span id="Closures-1980"><a href="#-1980"><span class="linenos">1980</span></a>                <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">oil_closures</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gas_closures</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">brine_closures</span><span class="p">],</span>
</span><span id="Closures-1981"><a href="#-1981"><span class="linenos">1981</span></a>                <span class="p">[</span>
</span><span id="Closures-1982"><a href="#-1982"><span class="linenos">1982</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">false_closures_oil</span><span class="p">,</span>
</span><span id="Closures-1983"><a href="#-1983"><span class="linenos">1983</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">false_closures_gas</span><span class="p">,</span>
</span><span id="Closures-1984"><a href="#-1984"><span class="linenos">1984</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">false_closures_brine</span><span class="p">,</span>
</span><span id="Closures-1985"><a href="#-1985"><span class="linenos">1985</span></a>                <span class="p">],</span>
</span><span id="Closures-1986"><a href="#-1986"><span class="linenos">1986</span></a>                <span class="p">[</span>
</span><span id="Closures-1987"><a href="#-1987"><span class="linenos">1987</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">n_false_closures_oil</span><span class="p">,</span>
</span><span id="Closures-1988"><a href="#-1988"><span class="linenos">1988</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">n_false_closures_gas</span><span class="p">,</span>
</span><span id="Closures-1989"><a href="#-1989"><span class="linenos">1989</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">n_false_closures_brine</span><span class="p">,</span>
</span><span id="Closures-1990"><a href="#-1990"><span class="linenos">1990</span></a>                <span class="p">],</span>
</span><span id="Closures-1991"><a href="#-1991"><span class="linenos">1991</span></a>            <span class="p">):</span>
</span><span id="Closures-1992"><a href="#-1992"><span class="linenos">1992</span></a>                <span class="n">fluid_within_closure</span> <span class="o">=</span> <span class="n">fluid</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span>
</span><span id="Closures-1993"><a href="#-1993"><span class="linenos">1993</span></a>                <span class="k">if</span> <span class="n">fluid_within_closure</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Closures-1994"><a href="#-1994"><span class="linenos">1994</span></a>                    <span class="k">if</span> <span class="n">onlaps_within_closure</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Closures-1995"><a href="#-1995"><span class="linenos">1995</span></a>                        <span class="n">_faulted_closure_threshold</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span>
</span><span id="Closures-1996"><a href="#-1996"><span class="linenos">1996</span></a>                            <span class="n">faults_within_closure</span><span class="p">[</span><span class="n">faults_within_closure</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="Closures-1997"><a href="#-1997"><span class="linenos">1997</span></a>                            <span class="o">/</span> <span class="n">fluid_within_closure</span><span class="p">[</span><span class="n">fluid_within_closure</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="Closures-1998"><a href="#-1998"><span class="linenos">1998</span></a>                        <span class="p">)</span>
</span><span id="Closures-1999"><a href="#-1999"><span class="linenos">1999</span></a>                        <span class="n">_onlap_closure_threshold</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span>
</span><span id="Closures-2000"><a href="#-2000"><span class="linenos">2000</span></a>                            <span class="n">onlaps_within_closure</span><span class="p">[</span><span class="n">onlaps_within_closure</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="Closures-2001"><a href="#-2001"><span class="linenos">2001</span></a>                            <span class="o">/</span> <span class="n">fluid_within_closure</span><span class="p">[</span><span class="n">fluid_within_closure</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="Closures-2002"><a href="#-2002"><span class="linenos">2002</span></a>                        <span class="p">)</span>
</span><span id="Closures-2003"><a href="#-2003"><span class="linenos">2003</span></a>                        <span class="k">if</span> <span class="p">(</span>
</span><span id="Closures-2004"><a href="#-2004"><span class="linenos">2004</span></a>                            <span class="n">_faulted_closure_threshold</span> <span class="o">&gt;</span> <span class="mf">0.65</span>
</span><span id="Closures-2005"><a href="#-2005"><span class="linenos">2005</span></a>                            <span class="ow">and</span> <span class="n">_onlap_closure_threshold</span> <span class="o">&gt;</span> <span class="mf">0.65</span>
</span><span id="Closures-2006"><a href="#-2006"><span class="linenos">2006</span></a>                        <span class="p">):</span>
</span><span id="Closures-2007"><a href="#-2007"><span class="linenos">2007</span></a>                            <span class="n">false</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="Closures-2008"><a href="#-2008"><span class="linenos">2008</span></a>                            <span class="n">num</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="Closures-2009"><a href="#-2009"><span class="linenos">2009</span></a>
</span><span id="Closures-2010"><a href="#-2010"><span class="linenos">2010</span></a>    <span class="k">def</span> <span class="nf">find_salt_bounded_closures</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">closure_segment_list</span><span class="p">,</span> <span class="n">closure_segments</span><span class="p">):</span>
</span><span id="Closures-2011"><a href="#-2011"><span class="linenos">2011</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dilate_salt</span><span class="p">()</span>
</span><span id="Closures-2012"><a href="#-2012"><span class="linenos">2012</span></a>        <span class="k">for</span> <span class="n">iclosure</span> <span class="ow">in</span> <span class="n">closure_segment_list</span><span class="p">:</span>
</span><span id="Closures-2013"><a href="#-2013"><span class="linenos">2013</span></a>            <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">closure_segments</span> <span class="o">==</span> <span class="n">iclosure</span><span class="p">)</span>
</span><span id="Closures-2014"><a href="#-2014"><span class="linenos">2014</span></a>            <span class="n">salt_within_closure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wide_salt</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span>
</span><span id="Closures-2015"><a href="#-2015"><span class="linenos">2015</span></a>            <span class="k">if</span> <span class="n">salt_within_closure</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Closures-2016"><a href="#-2016"><span class="linenos">2016</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">oil_closures</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Closures-2017"><a href="#-2017"><span class="linenos">2017</span></a>                    <span class="c1"># salt bounded oil closure</span>
</span><span id="Closures-2018"><a href="#-2018"><span class="linenos">2018</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">salt_closures_oil</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="Closures-2019"><a href="#-2019"><span class="linenos">2019</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">n_salt_closures_oil</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="Closures-2020"><a href="#-2020"><span class="linenos">2020</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">salt_closures_oil_segment_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">iclosure</span><span class="p">)</span>
</span><span id="Closures-2021"><a href="#-2021"><span class="linenos">2021</span></a>                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">gas_closures</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Closures-2022"><a href="#-2022"><span class="linenos">2022</span></a>                    <span class="c1"># salt bounded gas closure</span>
</span><span id="Closures-2023"><a href="#-2023"><span class="linenos">2023</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">salt_closures_gas</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="Closures-2024"><a href="#-2024"><span class="linenos">2024</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">n_salt_closures_gas</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="Closures-2025"><a href="#-2025"><span class="linenos">2025</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">salt_closures_gas_segment_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">iclosure</span><span class="p">)</span>
</span><span id="Closures-2026"><a href="#-2026"><span class="linenos">2026</span></a>                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">brine_closures</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Closures-2027"><a href="#-2027"><span class="linenos">2027</span></a>                    <span class="c1"># salt bounded brine closure</span>
</span><span id="Closures-2028"><a href="#-2028"><span class="linenos">2028</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">salt_closures_brine</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="Closures-2029"><a href="#-2029"><span class="linenos">2029</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">n_salt_closures_brine</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="Closures-2030"><a href="#-2030"><span class="linenos">2030</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">salt_closures_brine_segment_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">iclosure</span><span class="p">)</span>
</span><span id="Closures-2031"><a href="#-2031"><span class="linenos">2031</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Closures-2032"><a href="#-2032"><span class="linenos">2032</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="Closures-2033"><a href="#-2033"><span class="linenos">2033</span></a>                        <span class="s2">&quot;Closure is salt bounded but does not have oil, gas or brine assigned&quot;</span>
</span><span id="Closures-2034"><a href="#-2034"><span class="linenos">2034</span></a>                    <span class="p">)</span>
</span><span id="Closures-2035"><a href="#-2035"><span class="linenos">2035</span></a>
</span><span id="Closures-2036"><a href="#-2036"><span class="linenos">2036</span></a>    <span class="k">def</span> <span class="nf">find_faulted_all_closures</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">closure_segment_list</span><span class="p">,</span> <span class="n">closure_segments</span><span class="p">):</span>
</span><span id="Closures-2037"><a href="#-2037"><span class="linenos">2037</span></a>        <span class="k">for</span> <span class="n">iclosure</span> <span class="ow">in</span> <span class="n">closure_segment_list</span><span class="p">:</span>
</span><span id="Closures-2038"><a href="#-2038"><span class="linenos">2038</span></a>            <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">closure_segments</span> <span class="o">==</span> <span class="n">iclosure</span><span class="p">)</span>
</span><span id="Closures-2039"><a href="#-2039"><span class="linenos">2039</span></a>            <span class="n">faults_within_closure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wide_faults</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span>
</span><span id="Closures-2040"><a href="#-2040"><span class="linenos">2040</span></a>            <span class="k">if</span> <span class="n">faults_within_closure</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Closures-2041"><a href="#-2041"><span class="linenos">2041</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">faulted_all_closures</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="Closures-2042"><a href="#-2042"><span class="linenos">2042</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">n_fault_all_closures</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="Closures-2043"><a href="#-2043"><span class="linenos">2043</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">fault_all_closures_segment_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">iclosure</span><span class="p">)</span>
</span><span id="Closures-2044"><a href="#-2044"><span class="linenos">2044</span></a>
</span><span id="Closures-2045"><a href="#-2045"><span class="linenos">2045</span></a>    <span class="k">def</span> <span class="nf">find_onlap_all_closures</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">closure_segment_list</span><span class="p">,</span> <span class="n">closure_segments</span><span class="p">):</span>
</span><span id="Closures-2046"><a href="#-2046"><span class="linenos">2046</span></a>        <span class="k">for</span> <span class="n">iclosure</span> <span class="ow">in</span> <span class="n">closure_segment_list</span><span class="p">:</span>
</span><span id="Closures-2047"><a href="#-2047"><span class="linenos">2047</span></a>            <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">closure_segments</span> <span class="o">==</span> <span class="n">iclosure</span><span class="p">)</span>
</span><span id="Closures-2048"><a href="#-2048"><span class="linenos">2048</span></a>            <span class="n">onlaps_within_closure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">onlaps_upward</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span>
</span><span id="Closures-2049"><a href="#-2049"><span class="linenos">2049</span></a>            <span class="k">if</span> <span class="n">onlaps_within_closure</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Closures-2050"><a href="#-2050"><span class="linenos">2050</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">onlap_all_closures</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="Closures-2051"><a href="#-2051"><span class="linenos">2051</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">n_onlap_all_closures</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="Closures-2052"><a href="#-2052"><span class="linenos">2052</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">onlap_all_closures_segment_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">iclosure</span><span class="p">)</span>
</span><span id="Closures-2053"><a href="#-2053"><span class="linenos">2053</span></a>
</span><span id="Closures-2054"><a href="#-2054"><span class="linenos">2054</span></a>    <span class="k">def</span> <span class="nf">find_simple_all_closures</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">closure_segment_list</span><span class="p">,</span> <span class="n">closure_segments</span><span class="p">):</span>
</span><span id="Closures-2055"><a href="#-2055"><span class="linenos">2055</span></a>        <span class="k">for</span> <span class="n">iclosure</span> <span class="ow">in</span> <span class="n">closure_segment_list</span><span class="p">:</span>
</span><span id="Closures-2056"><a href="#-2056"><span class="linenos">2056</span></a>            <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">closure_segments</span> <span class="o">==</span> <span class="n">iclosure</span><span class="p">)</span>
</span><span id="Closures-2057"><a href="#-2057"><span class="linenos">2057</span></a>            <span class="n">faults_within_closure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wide_faults</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span>
</span><span id="Closures-2058"><a href="#-2058"><span class="linenos">2058</span></a>            <span class="n">onlaps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_threshold_volumes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">faulted_onlap_segments</span><span class="p">[:])</span>
</span><span id="Closures-2059"><a href="#-2059"><span class="linenos">2059</span></a>            <span class="n">onlaps_within_closure</span> <span class="o">=</span> <span class="n">onlaps</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span>
</span><span id="Closures-2060"><a href="#-2060"><span class="linenos">2060</span></a>            <span class="k">if</span> <span class="n">faults_within_closure</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">onlaps_within_closure</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Closures-2061"><a href="#-2061"><span class="linenos">2061</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">simple_all_closures</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="Closures-2062"><a href="#-2062"><span class="linenos">2062</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">n_4way_all_closures</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="Closures-2063"><a href="#-2063"><span class="linenos">2063</span></a>
</span><span id="Closures-2064"><a href="#-2064"><span class="linenos">2064</span></a>    <span class="k">def</span> <span class="nf">find_false_all_closures</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">closure_segment_list</span><span class="p">,</span> <span class="n">closure_segments</span><span class="p">):</span>
</span><span id="Closures-2065"><a href="#-2065"><span class="linenos">2065</span></a>        <span class="k">for</span> <span class="n">iclosure</span> <span class="ow">in</span> <span class="n">closure_segment_list</span><span class="p">:</span>
</span><span id="Closures-2066"><a href="#-2066"><span class="linenos">2066</span></a>            <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">closure_segments</span> <span class="o">==</span> <span class="n">iclosure</span><span class="p">)</span>
</span><span id="Closures-2067"><a href="#-2067"><span class="linenos">2067</span></a>            <span class="n">faults_within_closure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fat_faults</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span>
</span><span id="Closures-2068"><a href="#-2068"><span class="linenos">2068</span></a>            <span class="n">onlaps_within_closure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">onlaps_downward</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span>
</span><span id="Closures-2069"><a href="#-2069"><span class="linenos">2069</span></a>            <span class="k">if</span> <span class="n">onlaps_within_closure</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Closures-2070"><a href="#-2070"><span class="linenos">2070</span></a>                <span class="n">_faulted_closure_threshold</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span>
</span><span id="Closures-2071"><a href="#-2071"><span class="linenos">2071</span></a>                    <span class="n">faults_within_closure</span><span class="p">[</span><span class="n">faults_within_closure</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="o">/</span> <span class="n">i</span><span class="o">.</span><span class="n">size</span>
</span><span id="Closures-2072"><a href="#-2072"><span class="linenos">2072</span></a>                <span class="p">)</span>
</span><span id="Closures-2073"><a href="#-2073"><span class="linenos">2073</span></a>                <span class="n">_onlap_closure_threshold</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span>
</span><span id="Closures-2074"><a href="#-2074"><span class="linenos">2074</span></a>                    <span class="n">onlaps_within_closure</span><span class="p">[</span><span class="n">onlaps_within_closure</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="o">/</span> <span class="n">i</span><span class="o">.</span><span class="n">size</span>
</span><span id="Closures-2075"><a href="#-2075"><span class="linenos">2075</span></a>                <span class="p">)</span>
</span><span id="Closures-2076"><a href="#-2076"><span class="linenos">2076</span></a>                <span class="k">if</span> <span class="p">(</span>
</span><span id="Closures-2077"><a href="#-2077"><span class="linenos">2077</span></a>                    <span class="n">_faulted_closure_threshold</span> <span class="o">&gt;</span> <span class="mf">0.65</span>
</span><span id="Closures-2078"><a href="#-2078"><span class="linenos">2078</span></a>                    <span class="ow">and</span> <span class="n">_onlap_closure_threshold</span> <span class="o">&gt;</span> <span class="mf">0.65</span>
</span><span id="Closures-2079"><a href="#-2079"><span class="linenos">2079</span></a>                <span class="p">):</span>
</span><span id="Closures-2080"><a href="#-2080"><span class="linenos">2080</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">false_all_closures</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="Closures-2081"><a href="#-2081"><span class="linenos">2081</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">n_false_all_closures</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="Closures-2082"><a href="#-2082"><span class="linenos">2082</span></a>
</span><span id="Closures-2083"><a href="#-2083"><span class="linenos">2083</span></a>    <span class="k">def</span> <span class="nf">find_salt_bounded_all_closures</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">closure_segment_list</span><span class="p">,</span> <span class="n">closure_segments</span><span class="p">):</span>
</span><span id="Closures-2084"><a href="#-2084"><span class="linenos">2084</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dilate_salt</span><span class="p">()</span>
</span><span id="Closures-2085"><a href="#-2085"><span class="linenos">2085</span></a>        <span class="k">for</span> <span class="n">iclosure</span> <span class="ow">in</span> <span class="n">closure_segment_list</span><span class="p">:</span>
</span><span id="Closures-2086"><a href="#-2086"><span class="linenos">2086</span></a>            <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">closure_segments</span> <span class="o">==</span> <span class="n">iclosure</span><span class="p">)</span>
</span><span id="Closures-2087"><a href="#-2087"><span class="linenos">2087</span></a>            <span class="n">salt_within_closure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wide_salt</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span>
</span><span id="Closures-2088"><a href="#-2088"><span class="linenos">2088</span></a>            <span class="k">if</span> <span class="n">salt_within_closure</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Closures-2089"><a href="#-2089"><span class="linenos">2089</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">salt_all_closures</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="Closures-2090"><a href="#-2090"><span class="linenos">2090</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">n_salt_all_closures</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="Closures-2091"><a href="#-2091"><span class="linenos">2091</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">salt_all_closures_segment_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">iclosure</span><span class="p">)</span>
</span><span id="Closures-2092"><a href="#-2092"><span class="linenos">2092</span></a>
</span><span id="Closures-2093"><a href="#-2093"><span class="linenos">2093</span></a>    <span class="k">def</span> <span class="nf">_dilate_faults</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Closures-2094"><a href="#-2094"><span class="linenos">2094</span></a>        <span class="n">thresholded_faults</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_threshold_volumes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">fault_planes</span><span class="p">[:])</span>
</span><span id="Closures-2095"><a href="#-2095"><span class="linenos">2095</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">wide_faults</span><span class="p">[:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grow_lateral</span><span class="p">(</span>
</span><span id="Closures-2096"><a href="#-2096"><span class="linenos">2096</span></a>            <span class="n">thresholded_faults</span><span class="p">,</span> <span class="n">iterations</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="mi">1</span>
</span><span id="Closures-2097"><a href="#-2097"><span class="linenos">2097</span></a>        <span class="p">)</span>
</span><span id="Closures-2098"><a href="#-2098"><span class="linenos">2098</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fat_faults</span><span class="p">[:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grow_lateral</span><span class="p">(</span>
</span><span id="Closures-2099"><a href="#-2099"><span class="linenos">2099</span></a>            <span class="n">thresholded_faults</span><span class="p">,</span> <span class="n">iterations</span><span class="o">=</span><span class="mi">21</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="mi">1</span>
</span><span id="Closures-2100"><a href="#-2100"><span class="linenos">2100</span></a>        <span class="p">)</span>
</span><span id="Closures-2101"><a href="#-2101"><span class="linenos">2101</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">include_salt</span><span class="p">:</span>
</span><span id="Closures-2102"><a href="#-2102"><span class="linenos">2102</span></a>            <span class="c1"># Treat the salt body as a fault to grow closures to boundary</span>
</span><span id="Closures-2103"><a href="#-2103"><span class="linenos">2103</span></a>            <span class="n">thresholded_salt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_threshold_volumes</span><span class="p">(</span>
</span><span id="Closures-2104"><a href="#-2104"><span class="linenos">2104</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">salt_model</span><span class="o">.</span><span class="n">salt_segments</span><span class="p">[:]</span>
</span><span id="Closures-2105"><a href="#-2105"><span class="linenos">2105</span></a>            <span class="p">)</span>
</span><span id="Closures-2106"><a href="#-2106"><span class="linenos">2106</span></a>            <span class="n">wide_salt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grow_lateral</span><span class="p">(</span><span class="n">thresholded_salt</span><span class="p">,</span> <span class="n">iterations</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="Closures-2107"><a href="#-2107"><span class="linenos">2107</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">wide_salt</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">wide_salt</span>
</span><span id="Closures-2108"><a href="#-2108"><span class="linenos">2108</span></a>            <span class="c1"># Add salt to faults to cehck if growing the closure works</span>
</span><span id="Closures-2109"><a href="#-2109"><span class="linenos">2109</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">wide_faults</span><span class="p">[:]</span> <span class="o">+=</span> <span class="n">wide_salt</span>
</span><span id="Closures-2110"><a href="#-2110"><span class="linenos">2110</span></a>
</span><span id="Closures-2111"><a href="#-2111"><span class="linenos">2111</span></a>    <span class="k">def</span> <span class="nf">_dilate_salt</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Closures-2112"><a href="#-2112"><span class="linenos">2112</span></a>        <span class="n">thresholded_salt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_threshold_volumes</span><span class="p">(</span>
</span><span id="Closures-2113"><a href="#-2113"><span class="linenos">2113</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">salt_model</span><span class="o">.</span><span class="n">salt_segments</span><span class="p">[:]</span>
</span><span id="Closures-2114"><a href="#-2114"><span class="linenos">2114</span></a>        <span class="p">)</span>
</span><span id="Closures-2115"><a href="#-2115"><span class="linenos">2115</span></a>        <span class="n">wide_salt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grow_lateral</span><span class="p">(</span><span class="n">thresholded_salt</span><span class="p">,</span> <span class="n">iterations</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="Closures-2116"><a href="#-2116"><span class="linenos">2116</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">wide_salt</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">wide_salt</span>
</span><span id="Closures-2117"><a href="#-2117"><span class="linenos">2117</span></a>
</span><span id="Closures-2118"><a href="#-2118"><span class="linenos">2118</span></a>    <span class="k">def</span> <span class="nf">_dilate_onlaps</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Closures-2119"><a href="#-2119"><span class="linenos">2119</span></a>        <span class="n">onlaps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_threshold_volumes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">faulted_onlap_segments</span><span class="p">[:])</span>
</span><span id="Closures-2120"><a href="#-2120"><span class="linenos">2120</span></a>        <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
</span><span id="Closures-2121"><a href="#-2121"><span class="linenos">2121</span></a>        <span class="n">mask</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="Closures-2122"><a href="#-2122"><span class="linenos">2122</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">onlaps_upward</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">morphology</span><span class="o">.</span><span class="n">binary_dilation</span><span class="p">(</span><span class="n">onlaps</span><span class="p">,</span> <span class="n">mask</span><span class="p">)</span>
</span><span id="Closures-2123"><a href="#-2123"><span class="linenos">2123</span></a>        <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
</span><span id="Closures-2124"><a href="#-2124"><span class="linenos">2124</span></a>        <span class="n">mask</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">:]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="Closures-2125"><a href="#-2125"><span class="linenos">2125</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">onlaps_downward</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">onlaps</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Closures-2126"><a href="#-2126"><span class="linenos">2126</span></a>        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">30</span><span class="p">):</span>
</span><span id="Closures-2127"><a href="#-2127"><span class="linenos">2127</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="Closures-2128"><a href="#-2128"><span class="linenos">2128</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">onlaps_downward</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">morphology</span><span class="o">.</span><span class="n">binary_dilation</span><span class="p">(</span>
</span><span id="Closures-2129"><a href="#-2129"><span class="linenos">2129</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">onlaps_downward</span><span class="p">[:],</span> <span class="n">mask</span>
</span><span id="Closures-2130"><a href="#-2130"><span class="linenos">2130</span></a>                <span class="p">)</span>
</span><span id="Closures-2131"><a href="#-2131"><span class="linenos">2131</span></a>            <span class="k">except</span><span class="p">:</span>
</span><span id="Closures-2132"><a href="#-2132"><span class="linenos">2132</span></a>                <span class="k">break</span>
</span><span id="Closures-2133"><a href="#-2133"><span class="linenos">2133</span></a>
</span><span id="Closures-2134"><a href="#-2134"><span class="linenos">2134</span></a>    <span class="k">def</span> <span class="nf">grow_to_fault2</span><span class="p">(</span>
</span><span id="Closures-2135"><a href="#-2135"><span class="linenos">2135</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">closures</span><span class="p">,</span> <span class="n">grow_only_sand_closures</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">remove_small_closures</span><span class="o">=</span><span class="kc">True</span>
</span><span id="Closures-2136"><a href="#-2136"><span class="linenos">2136</span></a>    <span class="p">):</span>
</span><span id="Closures-2137"><a href="#-2137"><span class="linenos">2137</span></a>        <span class="c1"># - grow closures laterally and up within layer and within fault block</span>
</span><span id="Closures-2138"><a href="#-2138"><span class="linenos">2138</span></a>        <span class="nb">print</span><span class="p">(</span>
</span><span id="Closures-2139"><a href="#-2139"><span class="linenos">2139</span></a>            <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2"> ... grow_to_fault2: grow closures laterally and up within layer and within fault block ...&quot;</span>
</span><span id="Closures-2140"><a href="#-2140"><span class="linenos">2140</span></a>        <span class="p">)</span>
</span><span id="Closures-2141"><a href="#-2141"><span class="linenos">2141</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span><span class="s2">&quot;growing closures to fault plane: grow_to_fault2&quot;</span><span class="p">)</span>
</span><span id="Closures-2142"><a href="#-2142"><span class="linenos">2142</span></a>
</span><span id="Closures-2143"><a href="#-2143"><span class="linenos">2143</span></a>        <span class="c1"># dilated_fault_closures = closures.copy()</span>
</span><span id="Closures-2144"><a href="#-2144"><span class="linenos">2144</span></a>        <span class="c1"># n_faulted_closures = dilated_fault_closures.max()</span>
</span><span id="Closures-2145"><a href="#-2145"><span class="linenos">2145</span></a>        <span class="n">labels_clean</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">closure_segments</span><span class="p">[:]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Closures-2146"><a href="#-2146"><span class="linenos">2146</span></a>        <span class="n">labels_clean</span><span class="p">[</span><span class="n">closures</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Closures-2147"><a href="#-2147"><span class="linenos">2147</span></a>        <span class="n">labels_clean_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">labels_clean</span><span class="o">.</span><span class="n">flatten</span><span class="p">()))</span>
</span><span id="Closures-2148"><a href="#-2148"><span class="linenos">2148</span></a>        <span class="n">labels_clean_list</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="Closures-2149"><a href="#-2149"><span class="linenos">2149</span></a>        <span class="n">initial_closures</span> <span class="o">=</span> <span class="n">labels_clean</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Closures-2150"><a href="#-2150"><span class="linenos">2150</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">    ... grow_to_fault2: n_faulted_closures = &quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">labels_clean_list</span><span class="p">))</span>
</span><span id="Closures-2151"><a href="#-2151"><span class="linenos">2151</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    ... grow_to_fault2: faulted_closures = &quot;</span><span class="p">,</span> <span class="n">labels_clean_list</span><span class="p">)</span>
</span><span id="Closures-2152"><a href="#-2152"><span class="linenos">2152</span></a>
</span><span id="Closures-2153"><a href="#-2153"><span class="linenos">2153</span></a>        <span class="c1"># TODO remove this once small closures are found and fixed</span>
</span><span id="Closures-2154"><a href="#-2154"><span class="linenos">2154</span></a>        <span class="n">voxel_sizes</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="Closures-2155"><a href="#-2155"><span class="linenos">2155</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">closure_segments</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">closure_segments</span><span class="p">[:]</span> <span class="o">==</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="Closures-2156"><a href="#-2156"><span class="linenos">2156</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">labels_clean_list</span>
</span><span id="Closures-2157"><a href="#-2157"><span class="linenos">2157</span></a>        <span class="p">]</span>
</span><span id="Closures-2158"><a href="#-2158"><span class="linenos">2158</span></a>        <span class="k">for</span> <span class="n">_v</span> <span class="ow">in</span> <span class="n">voxel_sizes</span><span class="p">:</span>
</span><span id="Closures-2159"><a href="#-2159"><span class="linenos">2159</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Voxel_Sizes: </span><span class="si">{</span><span class="n">_v</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Closures-2160"><a href="#-2160"><span class="linenos">2160</span></a>            <span class="k">if</span> <span class="n">_v</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">closure_min_voxels</span><span class="p">:</span>
</span><span id="Closures-2161"><a href="#-2161"><span class="linenos">2161</span></a>                <span class="nb">print</span><span class="p">(</span><span class="n">_v</span><span class="p">)</span>
</span><span id="Closures-2162"><a href="#-2162"><span class="linenos">2162</span></a>
</span><span id="Closures-2163"><a href="#-2163"><span class="linenos">2163</span></a>        <span class="n">depth_cube</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">faulted_age_volume</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span>
</span><span id="Closures-2164"><a href="#-2164"><span class="linenos">2164</span></a>        <span class="n">_depths</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">faulted_age_volume</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</span><span id="Closures-2165"><a href="#-2165"><span class="linenos">2165</span></a>        <span class="n">depth_cube</span> <span class="o">+=</span> <span class="n">_depths</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">faulted_age_volume</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</span><span id="Closures-2166"><a href="#-2166"><span class="linenos">2166</span></a>        <span class="n">_ng</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">faulted_net_to_gross</span><span class="p">[:]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Closures-2167"><a href="#-2167"><span class="linenos">2167</span></a>        <span class="c1"># Cannot solely use NG anymore since shales may have variable net to gross</span>
</span><span id="Closures-2168"><a href="#-2168"><span class="linenos">2168</span></a>        <span class="n">_lith</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">faulted_lithology</span><span class="p">[:]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Closures-2169"><a href="#-2169"><span class="linenos">2169</span></a>        <span class="n">_age</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">faulted_age_volume</span><span class="p">[:]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Closures-2170"><a href="#-2170"><span class="linenos">2170</span></a>        <span class="n">fault_throw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">max_fault_throw</span><span class="p">[:]</span>
</span><span id="Closures-2171"><a href="#-2171"><span class="linenos">2171</span></a>
</span><span id="Closures-2172"><a href="#-2172"><span class="linenos">2172</span></a>        <span class="k">for</span> <span class="n">il</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">labels_clean_list</span><span class="p">):</span>
</span><span id="Closures-2173"><a href="#-2173"><span class="linenos">2173</span></a>            <span class="n">fault_blocks_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">fault_throw</span><span class="p">[</span><span class="n">labels_clean</span> <span class="o">==</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()))</span>
</span><span id="Closures-2174"><a href="#-2174"><span class="linenos">2174</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    ... grow_to_fault2: fault_blocks_list = &quot;</span><span class="p">,</span> <span class="n">fault_blocks_list</span><span class="p">)</span>
</span><span id="Closures-2175"><a href="#-2175"><span class="linenos">2175</span></a>            <span class="k">for</span> <span class="n">jl</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">fault_blocks_list</span><span class="p">):</span>
</span><span id="Closures-2176"><a href="#-2176"><span class="linenos">2176</span></a>                <span class="nb">print</span><span class="p">(</span>
</span><span id="Closures-2177"><a href="#-2177"><span class="linenos">2177</span></a>                    <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">    ... label, throw = &quot;</span><span class="p">,</span>
</span><span id="Closures-2178"><a href="#-2178"><span class="linenos">2178</span></a>                    <span class="n">i</span><span class="p">,</span>
</span><span id="Closures-2179"><a href="#-2179"><span class="linenos">2179</span></a>                    <span class="n">j</span><span class="p">,</span>
</span><span id="Closures-2180"><a href="#-2180"><span class="linenos">2180</span></a>                    <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">fault_throw</span><span class="p">[</span><span class="n">labels_clean</span> <span class="o">==</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">())),</span>
</span><span id="Closures-2181"><a href="#-2181"><span class="linenos">2181</span></a>                    <span class="n">labels_clean</span><span class="p">[</span><span class="n">labels_clean</span> <span class="o">==</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">,</span>
</span><span id="Closures-2182"><a href="#-2182"><span class="linenos">2182</span></a>                    <span class="n">fault_throw</span><span class="p">[</span><span class="n">fault_throw</span> <span class="o">==</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">,</span>
</span><span id="Closures-2183"><a href="#-2183"><span class="linenos">2183</span></a>                    <span class="n">fault_throw</span><span class="p">[</span>
</span><span id="Closures-2184"><a href="#-2184"><span class="linenos">2184</span></a>                        <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">labels_clean</span> <span class="o">==</span> <span class="n">i</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">fault_throw</span><span class="p">[:]</span> <span class="o">==</span> <span class="n">j</span><span class="p">))</span>
</span><span id="Closures-2185"><a href="#-2185"><span class="linenos">2185</span></a>                    <span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">,</span>
</span><span id="Closures-2186"><a href="#-2186"><span class="linenos">2186</span></a>                <span class="p">)</span>
</span><span id="Closures-2187"><a href="#-2187"><span class="linenos">2187</span></a>                <span class="n">single_closure</span> <span class="o">=</span> <span class="n">labels_clean</span> <span class="o">*</span> <span class="mf">0.0</span>
</span><span id="Closures-2188"><a href="#-2188"><span class="linenos">2188</span></a>                <span class="n">size</span> <span class="o">=</span> <span class="n">single_closure</span><span class="p">[</span>
</span><span id="Closures-2189"><a href="#-2189"><span class="linenos">2189</span></a>                    <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">labels_clean</span> <span class="o">==</span> <span class="n">i</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">fault_throw</span> <span class="o">-</span> <span class="n">j</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.25</span><span class="p">))</span>
</span><span id="Closures-2190"><a href="#-2190"><span class="linenos">2190</span></a>                <span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="Closures-2191"><a href="#-2191"><span class="linenos">2191</span></a>                <span class="k">if</span> <span class="n">size</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">closure_min_voxels</span><span class="p">:</span>
</span><span id="Closures-2192"><a href="#-2192"><span class="linenos">2192</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Label: </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">, fault_block: </span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s2">, Voxel_Count: </span><span class="si">{</span><span class="n">size</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Closures-2193"><a href="#-2193"><span class="linenos">2193</span></a>                    <span class="n">single_closure</span><span class="p">[</span>
</span><span id="Closures-2194"><a href="#-2194"><span class="linenos">2194</span></a>                        <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">labels_clean</span> <span class="o">==</span> <span class="n">i</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">fault_throw</span> <span class="o">-</span> <span class="n">j</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.25</span><span class="p">))</span>
</span><span id="Closures-2195"><a href="#-2195"><span class="linenos">2195</span></a>                    <span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="Closures-2196"><a href="#-2196"><span class="linenos">2196</span></a>                <span class="k">if</span> <span class="n">single_closure</span><span class="p">[</span><span class="n">single_closure</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Closures-2197"><a href="#-2197"><span class="linenos">2197</span></a>                    <span class="c1"># labels_clean[np.where((labels_clean == i) &amp; (np.abs(self.fault_throw - j) &lt; .25))] = 0</span>
</span><span id="Closures-2198"><a href="#-2198"><span class="linenos">2198</span></a>                    <span class="n">labels_clean</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">labels_clean</span> <span class="o">==</span> <span class="n">i</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Closures-2199"><a href="#-2199"><span class="linenos">2199</span></a>                    <span class="k">continue</span>
</span><span id="Closures-2200"><a href="#-2200"><span class="linenos">2200</span></a>                <span class="n">avg_ng</span> <span class="o">=</span> <span class="n">_ng</span><span class="p">[</span><span class="n">single_closure</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</span><span id="Closures-2201"><a href="#-2201"><span class="linenos">2201</span></a>                <span class="n">_geo_age_voxels</span> <span class="o">=</span> <span class="p">(</span><span class="n">_age</span><span class="p">[</span><span class="n">single_closure</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;int&quot;</span><span class="p">)</span>
</span><span id="Closures-2202"><a href="#-2202"><span class="linenos">2202</span></a>                <span class="n">_ng_voxels</span> <span class="o">=</span> <span class="n">_ng</span><span class="p">[</span><span class="n">single_closure</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="Closures-2203"><a href="#-2203"><span class="linenos">2203</span></a>                <span class="n">_geo_age_voxels</span> <span class="o">=</span> <span class="n">_geo_age_voxels</span><span class="p">[</span><span class="n">_ng_voxels</span> <span class="o">&gt;=</span> <span class="n">avg_ng</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">]</span>
</span><span id="Closures-2204"><a href="#-2204"><span class="linenos">2204</span></a>                <span class="n">min_geo_age</span> <span class="o">=</span> <span class="n">_geo_age_voxels</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">-</span> <span class="mf">0.5</span>
</span><span id="Closures-2205"><a href="#-2205"><span class="linenos">2205</span></a>                <span class="n">avg_geo_age</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">_geo_age_voxels</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
</span><span id="Closures-2206"><a href="#-2206"><span class="linenos">2206</span></a>                <span class="n">max_geo_age</span> <span class="o">=</span> <span class="n">_geo_age_voxels</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="mf">0.5</span>
</span><span id="Closures-2207"><a href="#-2207"><span class="linenos">2207</span></a>                <span class="n">_depth_geobody_voxels</span> <span class="o">=</span> <span class="n">depth_cube</span><span class="p">[</span><span class="n">single_closure</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="Closures-2208"><a href="#-2208"><span class="linenos">2208</span></a>                <span class="n">min_depth</span> <span class="o">=</span> <span class="n">_depth_geobody_voxels</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
</span><span id="Closures-2209"><a href="#-2209"><span class="linenos">2209</span></a>                <span class="n">max_depth</span> <span class="o">=</span> <span class="n">_depth_geobody_voxels</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</span><span id="Closures-2210"><a href="#-2210"><span class="linenos">2210</span></a>                <span class="n">avg_throw</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">fault_throw</span><span class="p">[</span><span class="n">single_closure</span> <span class="o">==</span> <span class="mi">1</span><span class="p">])</span>
</span><span id="Closures-2211"><a href="#-2211"><span class="linenos">2211</span></a>
</span><span id="Closures-2212"><a href="#-2212"><span class="linenos">2212</span></a>                <span class="n">closure_boundary_cube</span> <span class="o">=</span> <span class="n">closures</span> <span class="o">*</span> <span class="mf">0.0</span>
</span><span id="Closures-2213"><a href="#-2213"><span class="linenos">2213</span></a>                <span class="k">if</span> <span class="n">grow_only_sand_closures</span><span class="p">:</span>
</span><span id="Closures-2214"><a href="#-2214"><span class="linenos">2214</span></a>                    <span class="n">lith_flag</span> <span class="o">=</span> <span class="n">_lith</span> <span class="o">&gt;</span> <span class="mf">0.0</span>
</span><span id="Closures-2215"><a href="#-2215"><span class="linenos">2215</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Closures-2216"><a href="#-2216"><span class="linenos">2216</span></a>                    <span class="n">lith_flag</span> <span class="o">=</span> <span class="n">_lith</span> <span class="o">&gt;=</span> <span class="mf">0.0</span>
</span><span id="Closures-2217"><a href="#-2217"><span class="linenos">2217</span></a>                <span class="n">closure_boundary_cube</span><span class="p">[</span>
</span><span id="Closures-2218"><a href="#-2218"><span class="linenos">2218</span></a>                    <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
</span><span id="Closures-2219"><a href="#-2219"><span class="linenos">2219</span></a>                        <span class="n">lith_flag</span>
</span><span id="Closures-2220"><a href="#-2220"><span class="linenos">2220</span></a>                        <span class="o">&amp;</span> <span class="p">(</span><span class="n">_age</span> <span class="o">&gt;</span> <span class="n">min_geo_age</span><span class="p">)</span>
</span><span id="Closures-2221"><a href="#-2221"><span class="linenos">2221</span></a>                        <span class="o">&amp;</span> <span class="p">(</span><span class="n">_age</span> <span class="o">&lt;</span> <span class="n">max_geo_age</span><span class="p">)</span>
</span><span id="Closures-2222"><a href="#-2222"><span class="linenos">2222</span></a>                        <span class="o">&amp;</span> <span class="p">(</span><span class="n">fault_throw</span> <span class="o">==</span> <span class="n">avg_throw</span><span class="p">)</span>
</span><span id="Closures-2223"><a href="#-2223"><span class="linenos">2223</span></a>                        <span class="o">&amp;</span> <span class="p">(</span><span class="n">depth_cube</span> <span class="o">&lt;=</span> <span class="n">max_depth</span><span class="p">)</span>
</span><span id="Closures-2224"><a href="#-2224"><span class="linenos">2224</span></a>                    <span class="p">)</span>
</span><span id="Closures-2225"><a href="#-2225"><span class="linenos">2225</span></a>                <span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="Closures-2226"><a href="#-2226"><span class="linenos">2226</span></a>                <span class="nb">print</span><span class="p">(</span>
</span><span id="Closures-2227"><a href="#-2227"><span class="linenos">2227</span></a>                    <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">    ... grow_to_fault2: closure_boundary_cube voxels = &quot;</span><span class="p">,</span>
</span><span id="Closures-2228"><a href="#-2228"><span class="linenos">2228</span></a>                    <span class="n">closure_boundary_cube</span><span class="p">[</span><span class="n">closure_boundary_cube</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">,</span>
</span><span id="Closures-2229"><a href="#-2229"><span class="linenos">2229</span></a>                <span class="p">)</span>
</span><span id="Closures-2230"><a href="#-2230"><span class="linenos">2230</span></a>
</span><span id="Closures-2231"><a href="#-2231"><span class="linenos">2231</span></a>                <span class="n">n_voxel</span> <span class="o">=</span> <span class="n">single_closure</span><span class="p">[</span><span class="n">single_closure</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="Closures-2232"><a href="#-2232"><span class="linenos">2232</span></a>
</span><span id="Closures-2233"><a href="#-2233"><span class="linenos">2233</span></a>                <span class="n">original_voxels</span> <span class="o">=</span> <span class="n">n_voxel</span> <span class="o">+</span> <span class="mi">0</span>
</span><span id="Closures-2234"><a href="#-2234"><span class="linenos">2234</span></a>                <span class="nb">print</span><span class="p">(</span>
</span><span id="Closures-2235"><a href="#-2235"><span class="linenos">2235</span></a>                    <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">    ... closure label number, avg_throw, geobody shape, geo_age min/mean/max, depth min/max, avg_ng = &quot;</span><span class="p">,</span>
</span><span id="Closures-2236"><a href="#-2236"><span class="linenos">2236</span></a>                    <span class="n">i</span><span class="p">,</span>
</span><span id="Closures-2237"><a href="#-2237"><span class="linenos">2237</span></a>                    <span class="n">j</span><span class="p">,</span>
</span><span id="Closures-2238"><a href="#-2238"><span class="linenos">2238</span></a>                    <span class="n">n_voxel</span><span class="p">,</span>
</span><span id="Closures-2239"><a href="#-2239"><span class="linenos">2239</span></a>                    <span class="p">(</span><span class="n">min_geo_age</span><span class="p">,</span> <span class="n">avg_geo_age</span><span class="p">,</span> <span class="n">max_geo_age</span><span class="p">),</span>
</span><span id="Closures-2240"><a href="#-2240"><span class="linenos">2240</span></a>                    <span class="p">(</span><span class="n">min_depth</span><span class="p">,</span> <span class="n">max_depth</span><span class="p">),</span>
</span><span id="Closures-2241"><a href="#-2241"><span class="linenos">2241</span></a>                    <span class="n">avg_ng</span><span class="p">,</span>
</span><span id="Closures-2242"><a href="#-2242"><span class="linenos">2242</span></a>                    <span class="n">il</span><span class="p">,</span>
</span><span id="Closures-2243"><a href="#-2243"><span class="linenos">2243</span></a>                    <span class="s2">&quot; / &quot;</span><span class="p">,</span>
</span><span id="Closures-2244"><a href="#-2244"><span class="linenos">2244</span></a>                    <span class="nb">len</span><span class="p">(</span><span class="n">labels_clean_list</span><span class="p">),</span>
</span><span id="Closures-2245"><a href="#-2245"><span class="linenos">2245</span></a>                <span class="p">)</span>
</span><span id="Closures-2246"><a href="#-2246"><span class="linenos">2246</span></a>
</span><span id="Closures-2247"><a href="#-2247"><span class="linenos">2247</span></a>                <span class="n">grown_closure</span> <span class="o">=</span> <span class="n">single_closure</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Closures-2248"><a href="#-2248"><span class="linenos">2248</span></a>                <span class="n">grown_closure</span><span class="p">[</span><span class="n">depth_cube</span> <span class="o">&gt;=</span> <span class="n">max_depth</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Closures-2249"><a href="#-2249"><span class="linenos">2249</span></a>                <span class="n">delta_voxel</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Closures-2250"><a href="#-2250"><span class="linenos">2250</span></a>                <span class="n">previous_delta_voxel</span> <span class="o">=</span> <span class="mf">1e9</span>
</span><span id="Closures-2251"><a href="#-2251"><span class="linenos">2251</span></a>                <span class="n">converged</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Closures-2252"><a href="#-2252"><span class="linenos">2252</span></a>                <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">15</span><span class="p">):</span>
</span><span id="Closures-2253"><a href="#-2253"><span class="linenos">2253</span></a>                    <span class="n">grown_closure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grow_lateral</span><span class="p">(</span><span class="n">grown_closure</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span><span id="Closures-2254"><a href="#-2254"><span class="linenos">2254</span></a>                    <span class="n">grown_closure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grow_upward</span><span class="p">(</span><span class="n">grown_closure</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="Closures-2255"><a href="#-2255"><span class="linenos">2255</span></a>                    <span class="c1"># stay within layer, within age, within fault block, above HCWC</span>
</span><span id="Closures-2256"><a href="#-2256"><span class="linenos">2256</span></a>                    <span class="n">grown_closure</span><span class="p">[</span><span class="n">closure_boundary_cube</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="Closures-2257"><a href="#-2257"><span class="linenos">2257</span></a>                    <span class="n">single_closure</span> <span class="o">=</span> <span class="n">single_closure</span> <span class="o">+</span> <span class="n">grown_closure</span>
</span><span id="Closures-2258"><a href="#-2258"><span class="linenos">2258</span></a>                    <span class="n">single_closure</span><span class="p">[</span><span class="n">single_closure</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
</span><span id="Closures-2259"><a href="#-2259"><span class="linenos">2259</span></a>                    <span class="n">new_n_voxel</span> <span class="o">=</span> <span class="n">single_closure</span><span class="p">[</span><span class="n">single_closure</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="Closures-2260"><a href="#-2260"><span class="linenos">2260</span></a>                    <span class="n">previous_delta_voxel</span> <span class="o">=</span> <span class="n">delta_voxel</span> <span class="o">+</span> <span class="mi">0</span>
</span><span id="Closures-2261"><a href="#-2261"><span class="linenos">2261</span></a>                    <span class="n">delta_voxel</span> <span class="o">=</span> <span class="n">new_n_voxel</span> <span class="o">-</span> <span class="n">n_voxel</span>
</span><span id="Closures-2262"><a href="#-2262"><span class="linenos">2262</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="Closures-2263"><a href="#-2263"><span class="linenos">2263</span></a>                        <span class="s2">&quot;    ... i, ii, closure label number, geobody shape, delta_voxel, previous_delta_voxel,&quot;</span>
</span><span id="Closures-2264"><a href="#-2264"><span class="linenos">2264</span></a>                        <span class="s2">&quot; delta_voxel&gt;previous_delta_voxel = &quot;</span><span class="p">,</span>
</span><span id="Closures-2265"><a href="#-2265"><span class="linenos">2265</span></a>                        <span class="n">i</span><span class="p">,</span>
</span><span id="Closures-2266"><a href="#-2266"><span class="linenos">2266</span></a>                        <span class="n">ii</span><span class="p">,</span>
</span><span id="Closures-2267"><a href="#-2267"><span class="linenos">2267</span></a>                        <span class="n">new_n_voxel</span><span class="p">,</span>
</span><span id="Closures-2268"><a href="#-2268"><span class="linenos">2268</span></a>                        <span class="n">delta_voxel</span><span class="p">,</span>
</span><span id="Closures-2269"><a href="#-2269"><span class="linenos">2269</span></a>                        <span class="n">previous_delta_voxel</span><span class="p">,</span>
</span><span id="Closures-2270"><a href="#-2270"><span class="linenos">2270</span></a>                        <span class="n">delta_voxel</span> <span class="o">&gt;</span> <span class="n">previous_delta_voxel</span><span class="p">,</span>
</span><span id="Closures-2271"><a href="#-2271"><span class="linenos">2271</span></a>                    <span class="p">)</span>
</span><span id="Closures-2272"><a href="#-2272"><span class="linenos">2272</span></a>                    <span class="k">if</span> <span class="n">n_voxel</span> <span class="o">==</span> <span class="n">new_n_voxel</span><span class="p">:</span>
</span><span id="Closures-2273"><a href="#-2273"><span class="linenos">2273</span></a>                        <span class="c1"># finish bottom voxel layer near &quot;HCWC&quot;</span>
</span><span id="Closures-2274"><a href="#-2274"><span class="linenos">2274</span></a>                        <span class="n">grown_closure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grow_downward</span><span class="p">(</span>
</span><span id="Closures-2275"><a href="#-2275"><span class="linenos">2275</span></a>                            <span class="n">grown_closure</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span>
</span><span id="Closures-2276"><a href="#-2276"><span class="linenos">2276</span></a>                        <span class="p">)</span>
</span><span id="Closures-2277"><a href="#-2277"><span class="linenos">2277</span></a>                        <span class="c1"># stay within layer, within age, within fault block, above HCWC</span>
</span><span id="Closures-2278"><a href="#-2278"><span class="linenos">2278</span></a>                        <span class="n">grown_closure</span><span class="p">[</span><span class="n">closure_boundary_cube</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="Closures-2279"><a href="#-2279"><span class="linenos">2279</span></a>                        <span class="n">single_closure</span> <span class="o">=</span> <span class="n">single_closure</span> <span class="o">+</span> <span class="n">grown_closure</span>
</span><span id="Closures-2280"><a href="#-2280"><span class="linenos">2280</span></a>                        <span class="n">single_closure</span><span class="p">[</span><span class="n">single_closure</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
</span><span id="Closures-2281"><a href="#-2281"><span class="linenos">2281</span></a>                        <span class="n">converged</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Closures-2282"><a href="#-2282"><span class="linenos">2282</span></a>                        <span class="k">break</span>
</span><span id="Closures-2283"><a href="#-2283"><span class="linenos">2283</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="Closures-2284"><a href="#-2284"><span class="linenos">2284</span></a>                        <span class="n">n_voxel</span> <span class="o">=</span> <span class="n">new_n_voxel</span>
</span><span id="Closures-2285"><a href="#-2285"><span class="linenos">2285</span></a>                    <span class="n">previous_delta_voxel</span> <span class="o">=</span> <span class="n">delta_voxel</span> <span class="o">+</span> <span class="mi">0</span>
</span><span id="Closures-2286"><a href="#-2286"><span class="linenos">2286</span></a>                <span class="k">if</span> <span class="n">converged</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="Closures-2287"><a href="#-2287"><span class="linenos">2287</span></a>                    <span class="n">labels_clean</span><span class="p">[</span><span class="n">single_closure</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
</span><span id="Closures-2288"><a href="#-2288"><span class="linenos">2288</span></a>                    <span class="n">msg_postscript</span> <span class="o">=</span> <span class="s2">&quot; converged&quot;</span>
</span><span id="Closures-2289"><a href="#-2289"><span class="linenos">2289</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Closures-2290"><a href="#-2290"><span class="linenos">2290</span></a>                    <span class="n">labels_clean</span><span class="p">[</span><span class="n">labels_clean</span> <span class="o">==</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">i</span>
</span><span id="Closures-2291"><a href="#-2291"><span class="linenos">2291</span></a>                    <span class="n">msg_postscript</span> <span class="o">=</span> <span class="s2">&quot; NOT converged&quot;</span>
</span><span id="Closures-2292"><a href="#-2292"><span class="linenos">2292</span></a>                <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="Closures-2293"><a href="#-2293"><span class="linenos">2293</span></a>                    <span class="sa">f</span><span class="s2">&quot;closure_id: </span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="si">:</span><span class="s2">04d</span><span class="si">}</span><span class="s2">, fault_id: </span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">j</span> <span class="o">+</span> <span class="mf">.5</span><span class="p">)</span><span class="si">:</span><span class="s2">04d</span><span class="si">}</span><span class="s2">, &quot;</span>
</span><span id="Closures-2294"><a href="#-2294"><span class="linenos">2294</span></a>                    <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;original_voxels: </span><span class="si">{</span><span class="n">original_voxels</span><span class="si">:</span><span class="s2">11.0f</span><span class="si">}</span><span class="s2">, new_n_voxel: </span><span class="si">{</span><span class="n">new_n_voxel</span><span class="si">:</span><span class="s2">11.0f</span><span class="si">}</span><span class="s2">, &quot;</span>
</span><span id="Closures-2295"><a href="#-2295"><span class="linenos">2295</span></a>                    <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;percent_growth: </span><span class="si">{</span><span class="nb">float</span><span class="p">(</span><span class="n">new_n_voxel</span> <span class="o">/</span> <span class="n">original_voxels</span><span class="p">)</span><span class="si">:</span><span class="s2">6.2f</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Closures-2296"><a href="#-2296"><span class="linenos">2296</span></a>                <span class="p">)</span>
</span><span id="Closures-2297"><a href="#-2297"><span class="linenos">2297</span></a>                <span class="nb">print</span><span class="p">(</span><span class="n">msg</span> <span class="o">+</span> <span class="n">msg_postscript</span><span class="p">)</span>
</span><span id="Closures-2298"><a href="#-2298"><span class="linenos">2298</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span><span class="n">msg</span> <span class="o">+</span> <span class="n">msg_postscript</span><span class="p">)</span>
</span><span id="Closures-2299"><a href="#-2299"><span class="linenos">2299</span></a>
</span><span id="Closures-2300"><a href="#-2300"><span class="linenos">2300</span></a>        <span class="c1"># Set small closures to 0 after growth</span>
</span><span id="Closures-2301"><a href="#-2301"><span class="linenos">2301</span></a>        <span class="c1"># _grown_labels = measure.label(labels_clean, connectivity=2, background=0)</span>
</span><span id="Closures-2302"><a href="#-2302"><span class="linenos">2302</span></a>        <span class="c1"># for x in np.unique(_grown_labels):</span>
</span><span id="Closures-2303"><a href="#-2303"><span class="linenos">2303</span></a>        <span class="c1">#     size = _grown_labels[_grown_labels == x].size</span>
</span><span id="Closures-2304"><a href="#-2304"><span class="linenos">2304</span></a>        <span class="c1">#     print(f&#39;Size before editing: {size}&#39;)</span>
</span><span id="Closures-2305"><a href="#-2305"><span class="linenos">2305</span></a>        <span class="c1">#     if size &lt; self.cfg.closure_min_voxels:</span>
</span><span id="Closures-2306"><a href="#-2306"><span class="linenos">2306</span></a>        <span class="c1">#         labels_clean[_grown_labels == x] = 0.</span>
</span><span id="Closures-2307"><a href="#-2307"><span class="linenos">2307</span></a>        <span class="c1"># for x in np.unique(labels_clean):</span>
</span><span id="Closures-2308"><a href="#-2308"><span class="linenos">2308</span></a>        <span class="c1">#     size = labels_clean[labels_clean == x].size</span>
</span><span id="Closures-2309"><a href="#-2309"><span class="linenos">2309</span></a>        <span class="c1">#     print(f&#39;Size after editing: {size}&#39;)</span>
</span><span id="Closures-2310"><a href="#-2310"><span class="linenos">2310</span></a>
</span><span id="Closures-2311"><a href="#-2311"><span class="linenos">2311</span></a>        <span class="k">if</span> <span class="n">remove_small_closures</span><span class="p">:</span>
</span><span id="Closures-2312"><a href="#-2312"><span class="linenos">2312</span></a>            <span class="n">_initial_labels</span> <span class="o">=</span> <span class="n">measure</span><span class="o">.</span><span class="n">label</span><span class="p">(</span>
</span><span id="Closures-2313"><a href="#-2313"><span class="linenos">2313</span></a>                <span class="n">initial_closures</span><span class="p">,</span> <span class="n">connectivity</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">background</span><span class="o">=</span><span class="mi">0</span>
</span><span id="Closures-2314"><a href="#-2314"><span class="linenos">2314</span></a>            <span class="p">)</span>
</span><span id="Closures-2315"><a href="#-2315"><span class="linenos">2315</span></a>            <span class="n">_grown_labels</span> <span class="o">=</span> <span class="n">measure</span><span class="o">.</span><span class="n">label</span><span class="p">(</span><span class="n">labels_clean</span><span class="p">,</span> <span class="n">connectivity</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">background</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="Closures-2316"><a href="#-2316"><span class="linenos">2316</span></a>            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">_grown_labels</span><span class="p">):</span>
</span><span id="Closures-2317"><a href="#-2317"><span class="linenos">2317</span></a>                <span class="n">size_initial</span> <span class="o">=</span> <span class="n">_initial_labels</span><span class="p">[</span><span class="n">_initial_labels</span> <span class="o">==</span> <span class="n">x</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="Closures-2318"><a href="#-2318"><span class="linenos">2318</span></a>                <span class="n">size_grown</span> <span class="o">=</span> <span class="n">_grown_labels</span><span class="p">[</span><span class="n">_grown_labels</span> <span class="o">==</span> <span class="n">x</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="Closures-2319"><a href="#-2319"><span class="linenos">2319</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Size before editing: </span><span class="si">{</span><span class="n">size_initial</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Closures-2320"><a href="#-2320"><span class="linenos">2320</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Size after editing: </span><span class="si">{</span><span class="n">size_grown</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Closures-2321"><a href="#-2321"><span class="linenos">2321</span></a>                <span class="k">if</span> <span class="n">size_grown</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">closure_min_voxels</span><span class="p">:</span>
</span><span id="Closures-2322"><a href="#-2322"><span class="linenos">2322</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="Closures-2323"><a href="#-2323"><span class="linenos">2323</span></a>                        <span class="sa">f</span><span class="s2">&quot;Closure below threshold of </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">closure_min_voxels</span><span class="si">}</span><span class="s2"> and will be removed&quot;</span>
</span><span id="Closures-2324"><a href="#-2324"><span class="linenos">2324</span></a>                    <span class="p">)</span>
</span><span id="Closures-2325"><a href="#-2325"><span class="linenos">2325</span></a>                    <span class="n">labels_clean</span><span class="p">[</span><span class="n">_grown_labels</span> <span class="o">==</span> <span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="Closures-2326"><a href="#-2326"><span class="linenos">2326</span></a>        <span class="k">return</span> <span class="n">labels_clean</span>
</span><span id="Closures-2327"><a href="#-2327"><span class="linenos">2327</span></a>
</span><span id="Closures-2328"><a href="#-2328"><span class="linenos">2328</span></a>    <span class="k">def</span> <span class="nf">grow_to_salt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">closures</span><span class="p">):</span>
</span><span id="Closures-2329"><a href="#-2329"><span class="linenos">2329</span></a>        <span class="c1"># - grow closures laterally and up within layer up to salt body</span>
</span><span id="Closures-2330"><a href="#-2330"><span class="linenos">2330</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2"> ... grow_to_salt: grow closures laterally and up within layer ...&quot;</span><span class="p">)</span>
</span><span id="Closures-2331"><a href="#-2331"><span class="linenos">2331</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span><span class="s2">&quot;growing closures to salt body: grow_to_salt&quot;</span><span class="p">)</span>
</span><span id="Closures-2332"><a href="#-2332"><span class="linenos">2332</span></a>
</span><span id="Closures-2333"><a href="#-2333"><span class="linenos">2333</span></a>        <span class="n">labels_clean</span> <span class="o">=</span> <span class="n">measure</span><span class="o">.</span><span class="n">label</span><span class="p">(</span>
</span><span id="Closures-2334"><a href="#-2334"><span class="linenos">2334</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">closure_segments</span><span class="p">[:],</span> <span class="n">connectivity</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">background</span><span class="o">=</span><span class="mi">0</span>
</span><span id="Closures-2335"><a href="#-2335"><span class="linenos">2335</span></a>        <span class="p">)</span>
</span><span id="Closures-2336"><a href="#-2336"><span class="linenos">2336</span></a>        <span class="n">labels_clean</span><span class="p">[</span><span class="n">closures</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Closures-2337"><a href="#-2337"><span class="linenos">2337</span></a>        <span class="c1"># labels_clean = self.closure_segments[:].copy()</span>
</span><span id="Closures-2338"><a href="#-2338"><span class="linenos">2338</span></a>        <span class="c1"># labels_clean[closures == 0] = 0</span>
</span><span id="Closures-2339"><a href="#-2339"><span class="linenos">2339</span></a>        <span class="n">labels_clean_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">labels_clean</span><span class="o">.</span><span class="n">flatten</span><span class="p">()))</span>
</span><span id="Closures-2340"><a href="#-2340"><span class="linenos">2340</span></a>        <span class="n">labels_clean_list</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="Closures-2341"><a href="#-2341"><span class="linenos">2341</span></a>        <span class="n">initial_closures</span> <span class="o">=</span> <span class="n">labels_clean</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Closures-2342"><a href="#-2342"><span class="linenos">2342</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">    ... grow_to_salt: n_salt_closures = &quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">labels_clean_list</span><span class="p">))</span>
</span><span id="Closures-2343"><a href="#-2343"><span class="linenos">2343</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    ... grow_to_salt: salt_closures = &quot;</span><span class="p">,</span> <span class="n">labels_clean_list</span><span class="p">)</span>
</span><span id="Closures-2344"><a href="#-2344"><span class="linenos">2344</span></a>
</span><span id="Closures-2345"><a href="#-2345"><span class="linenos">2345</span></a>        <span class="n">depth_cube</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">faulted_age_volume</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span>
</span><span id="Closures-2346"><a href="#-2346"><span class="linenos">2346</span></a>        <span class="n">_depths</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">faulted_age_volume</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</span><span id="Closures-2347"><a href="#-2347"><span class="linenos">2347</span></a>        <span class="n">depth_cube</span> <span class="o">+=</span> <span class="n">_depths</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">faulted_age_volume</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</span><span id="Closures-2348"><a href="#-2348"><span class="linenos">2348</span></a>        <span class="n">_ng</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">faulted_net_to_gross</span><span class="p">[:]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Closures-2349"><a href="#-2349"><span class="linenos">2349</span></a>        <span class="n">_age</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">faulted_age_volume</span><span class="p">[:]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Closures-2350"><a href="#-2350"><span class="linenos">2350</span></a>        <span class="n">salt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">salt_model</span><span class="o">.</span><span class="n">salt_segments</span><span class="p">[:]</span>
</span><span id="Closures-2351"><a href="#-2351"><span class="linenos">2351</span></a>
</span><span id="Closures-2352"><a href="#-2352"><span class="linenos">2352</span></a>        <span class="k">for</span> <span class="n">il</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">labels_clean_list</span><span class="p">):</span>
</span><span id="Closures-2353"><a href="#-2353"><span class="linenos">2353</span></a>            <span class="n">salt_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">salt</span><span class="p">[</span><span class="n">labels_clean</span> <span class="o">==</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()))</span>
</span><span id="Closures-2354"><a href="#-2354"><span class="linenos">2354</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    ... grow_to_fault2: salt_list = &quot;</span><span class="p">,</span> <span class="n">salt_list</span><span class="p">)</span>
</span><span id="Closures-2355"><a href="#-2355"><span class="linenos">2355</span></a>            <span class="n">single_closure</span> <span class="o">=</span> <span class="n">labels_clean</span> <span class="o">*</span> <span class="mf">0.0</span>
</span><span id="Closures-2356"><a href="#-2356"><span class="linenos">2356</span></a>            <span class="n">size</span> <span class="o">=</span> <span class="n">single_closure</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">labels_clean</span> <span class="o">==</span> <span class="n">i</span><span class="p">)]</span><span class="o">.</span><span class="n">size</span>
</span><span id="Closures-2357"><a href="#-2357"><span class="linenos">2357</span></a>            <span class="k">if</span> <span class="n">size</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">closure_min_voxels</span><span class="p">:</span>
</span><span id="Closures-2358"><a href="#-2358"><span class="linenos">2358</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Label: </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">, Voxel_Count: </span><span class="si">{</span><span class="n">size</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Closures-2359"><a href="#-2359"><span class="linenos">2359</span></a>                <span class="n">single_closure</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">labels_clean</span> <span class="o">==</span> <span class="n">i</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="Closures-2360"><a href="#-2360"><span class="linenos">2360</span></a>            <span class="k">if</span> <span class="n">single_closure</span><span class="p">[</span><span class="n">single_closure</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Closures-2361"><a href="#-2361"><span class="linenos">2361</span></a>                <span class="n">labels_clean</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">labels_clean</span> <span class="o">==</span> <span class="n">i</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Closures-2362"><a href="#-2362"><span class="linenos">2362</span></a>                <span class="k">continue</span>
</span><span id="Closures-2363"><a href="#-2363"><span class="linenos">2363</span></a>            <span class="n">avg_ng</span> <span class="o">=</span> <span class="n">_ng</span><span class="p">[</span><span class="n">single_closure</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</span><span id="Closures-2364"><a href="#-2364"><span class="linenos">2364</span></a>            <span class="n">_geo_age_voxels</span> <span class="o">=</span> <span class="p">(</span><span class="n">_age</span><span class="p">[</span><span class="n">single_closure</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;int&quot;</span><span class="p">)</span>
</span><span id="Closures-2365"><a href="#-2365"><span class="linenos">2365</span></a>            <span class="n">_ng_voxels</span> <span class="o">=</span> <span class="n">_ng</span><span class="p">[</span><span class="n">single_closure</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="Closures-2366"><a href="#-2366"><span class="linenos">2366</span></a>            <span class="n">_geo_age_voxels</span> <span class="o">=</span> <span class="n">_geo_age_voxels</span><span class="p">[</span><span class="n">_ng_voxels</span> <span class="o">&gt;=</span> <span class="n">avg_ng</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">]</span>
</span><span id="Closures-2367"><a href="#-2367"><span class="linenos">2367</span></a>            <span class="n">min_geo_age</span> <span class="o">=</span> <span class="n">_geo_age_voxels</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">-</span> <span class="mf">0.5</span>
</span><span id="Closures-2368"><a href="#-2368"><span class="linenos">2368</span></a>            <span class="n">avg_geo_age</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">_geo_age_voxels</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
</span><span id="Closures-2369"><a href="#-2369"><span class="linenos">2369</span></a>            <span class="n">max_geo_age</span> <span class="o">=</span> <span class="n">_geo_age_voxels</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="mf">0.5</span>
</span><span id="Closures-2370"><a href="#-2370"><span class="linenos">2370</span></a>            <span class="n">_depth_geobody_voxels</span> <span class="o">=</span> <span class="n">depth_cube</span><span class="p">[</span><span class="n">single_closure</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="Closures-2371"><a href="#-2371"><span class="linenos">2371</span></a>            <span class="n">min_depth</span> <span class="o">=</span> <span class="n">_depth_geobody_voxels</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
</span><span id="Closures-2372"><a href="#-2372"><span class="linenos">2372</span></a>            <span class="n">max_depth</span> <span class="o">=</span> <span class="n">_depth_geobody_voxels</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</span><span id="Closures-2373"><a href="#-2373"><span class="linenos">2373</span></a>            <span class="c1"># Define AOI where salt has been dilated</span>
</span><span id="Closures-2374"><a href="#-2374"><span class="linenos">2374</span></a>            <span class="c1"># close_to_salt = np.zeros_like(salt)</span>
</span><span id="Closures-2375"><a href="#-2375"><span class="linenos">2375</span></a>            <span class="c1"># close_to_salt[self.wide_salt[:] == 1] = 1.0</span>
</span><span id="Closures-2376"><a href="#-2376"><span class="linenos">2376</span></a>            <span class="c1"># close_to_salt[salt == 1] = 0.0</span>
</span><span id="Closures-2377"><a href="#-2377"><span class="linenos">2377</span></a>
</span><span id="Closures-2378"><a href="#-2378"><span class="linenos">2378</span></a>            <span class="n">closure_boundary_cube</span> <span class="o">=</span> <span class="n">closures</span> <span class="o">*</span> <span class="mf">0.0</span>
</span><span id="Closures-2379"><a href="#-2379"><span class="linenos">2379</span></a>            <span class="n">closure_boundary_cube</span><span class="p">[</span>
</span><span id="Closures-2380"><a href="#-2380"><span class="linenos">2380</span></a>                <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
</span><span id="Closures-2381"><a href="#-2381"><span class="linenos">2381</span></a>                    <span class="p">(</span><span class="n">_ng</span> <span class="o">&gt;</span> <span class="mf">0.3</span><span class="p">)</span>
</span><span id="Closures-2382"><a href="#-2382"><span class="linenos">2382</span></a>                    <span class="o">&amp;</span> <span class="p">(</span><span class="n">_age</span> <span class="o">&gt;</span> <span class="n">min_geo_age</span><span class="p">)</span>  <span class="c1"># account for partial voxels</span>
</span><span id="Closures-2383"><a href="#-2383"><span class="linenos">2383</span></a>                    <span class="o">&amp;</span> <span class="p">(</span><span class="n">_age</span> <span class="o">&lt;</span> <span class="n">max_geo_age</span><span class="p">)</span>
</span><span id="Closures-2384"><a href="#-2384"><span class="linenos">2384</span></a>                    <span class="o">&amp;</span> <span class="p">(</span><span class="n">salt</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">)</span>
</span><span id="Closures-2385"><a href="#-2385"><span class="linenos">2385</span></a>                    <span class="o">&amp;</span> <span class="p">(</span><span class="n">depth_cube</span> <span class="o">&lt;=</span> <span class="n">max_depth</span><span class="p">)</span>
</span><span id="Closures-2386"><a href="#-2386"><span class="linenos">2386</span></a>                <span class="p">)</span>
</span><span id="Closures-2387"><a href="#-2387"><span class="linenos">2387</span></a>            <span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="Closures-2388"><a href="#-2388"><span class="linenos">2388</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="Closures-2389"><a href="#-2389"><span class="linenos">2389</span></a>                <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">    ... grow_to_fault2: closure_boundary_cube voxels = &quot;</span><span class="p">,</span>
</span><span id="Closures-2390"><a href="#-2390"><span class="linenos">2390</span></a>                <span class="n">closure_boundary_cube</span><span class="p">[</span><span class="n">closure_boundary_cube</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">,</span>
</span><span id="Closures-2391"><a href="#-2391"><span class="linenos">2391</span></a>            <span class="p">)</span>
</span><span id="Closures-2392"><a href="#-2392"><span class="linenos">2392</span></a>
</span><span id="Closures-2393"><a href="#-2393"><span class="linenos">2393</span></a>            <span class="n">n_voxel</span> <span class="o">=</span> <span class="n">single_closure</span><span class="p">[</span><span class="n">single_closure</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="Closures-2394"><a href="#-2394"><span class="linenos">2394</span></a>
</span><span id="Closures-2395"><a href="#-2395"><span class="linenos">2395</span></a>            <span class="n">original_voxels</span> <span class="o">=</span> <span class="n">n_voxel</span> <span class="o">+</span> <span class="mi">0</span>
</span><span id="Closures-2396"><a href="#-2396"><span class="linenos">2396</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="Closures-2397"><a href="#-2397"><span class="linenos">2397</span></a>                <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">    ... closure label number, avg_throw, geobody shape, geo_age min/mean/max, depth min/max, avg_ng = &quot;</span><span class="p">,</span>
</span><span id="Closures-2398"><a href="#-2398"><span class="linenos">2398</span></a>                <span class="n">i</span><span class="p">,</span>
</span><span id="Closures-2399"><a href="#-2399"><span class="linenos">2399</span></a>                <span class="n">n_voxel</span><span class="p">,</span>
</span><span id="Closures-2400"><a href="#-2400"><span class="linenos">2400</span></a>                <span class="p">(</span><span class="n">min_geo_age</span><span class="p">,</span> <span class="n">avg_geo_age</span><span class="p">,</span> <span class="n">max_geo_age</span><span class="p">),</span>
</span><span id="Closures-2401"><a href="#-2401"><span class="linenos">2401</span></a>                <span class="p">(</span><span class="n">min_depth</span><span class="p">,</span> <span class="n">max_depth</span><span class="p">),</span>
</span><span id="Closures-2402"><a href="#-2402"><span class="linenos">2402</span></a>                <span class="n">avg_ng</span><span class="p">,</span>
</span><span id="Closures-2403"><a href="#-2403"><span class="linenos">2403</span></a>                <span class="n">il</span><span class="p">,</span>
</span><span id="Closures-2404"><a href="#-2404"><span class="linenos">2404</span></a>                <span class="s2">&quot; / &quot;</span><span class="p">,</span>
</span><span id="Closures-2405"><a href="#-2405"><span class="linenos">2405</span></a>                <span class="nb">len</span><span class="p">(</span><span class="n">labels_clean_list</span><span class="p">),</span>
</span><span id="Closures-2406"><a href="#-2406"><span class="linenos">2406</span></a>            <span class="p">)</span>
</span><span id="Closures-2407"><a href="#-2407"><span class="linenos">2407</span></a>
</span><span id="Closures-2408"><a href="#-2408"><span class="linenos">2408</span></a>            <span class="n">grown_closure</span> <span class="o">=</span> <span class="n">single_closure</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Closures-2409"><a href="#-2409"><span class="linenos">2409</span></a>            <span class="n">grown_closure</span><span class="p">[</span><span class="n">depth_cube</span> <span class="o">&gt;=</span> <span class="n">max_depth</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Closures-2410"><a href="#-2410"><span class="linenos">2410</span></a>            <span class="n">delta_voxel</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Closures-2411"><a href="#-2411"><span class="linenos">2411</span></a>            <span class="n">previous_delta_voxel</span> <span class="o">=</span> <span class="mf">1e9</span>
</span><span id="Closures-2412"><a href="#-2412"><span class="linenos">2412</span></a>            <span class="n">converged</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Closures-2413"><a href="#-2413"><span class="linenos">2413</span></a>            <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">99</span><span class="p">):</span>
</span><span id="Closures-2414"><a href="#-2414"><span class="linenos">2414</span></a>                <span class="n">grown_closure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grow_lateral</span><span class="p">(</span><span class="n">grown_closure</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span><span id="Closures-2415"><a href="#-2415"><span class="linenos">2415</span></a>                <span class="n">grown_closure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grow_upward</span><span class="p">(</span><span class="n">grown_closure</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="Closures-2416"><a href="#-2416"><span class="linenos">2416</span></a>                <span class="c1"># stay within layer, within age, close to salt and above HCWC</span>
</span><span id="Closures-2417"><a href="#-2417"><span class="linenos">2417</span></a>                <span class="n">grown_closure</span><span class="p">[</span><span class="n">closure_boundary_cube</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="Closures-2418"><a href="#-2418"><span class="linenos">2418</span></a>                <span class="n">single_closure</span> <span class="o">=</span> <span class="n">single_closure</span> <span class="o">+</span> <span class="n">grown_closure</span>
</span><span id="Closures-2419"><a href="#-2419"><span class="linenos">2419</span></a>                <span class="n">single_closure</span><span class="p">[</span><span class="n">single_closure</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
</span><span id="Closures-2420"><a href="#-2420"><span class="linenos">2420</span></a>                <span class="n">new_n_voxel</span> <span class="o">=</span> <span class="n">single_closure</span><span class="p">[</span><span class="n">single_closure</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="Closures-2421"><a href="#-2421"><span class="linenos">2421</span></a>                <span class="n">previous_delta_voxel</span> <span class="o">=</span> <span class="n">delta_voxel</span> <span class="o">+</span> <span class="mi">0</span>
</span><span id="Closures-2422"><a href="#-2422"><span class="linenos">2422</span></a>                <span class="n">delta_voxel</span> <span class="o">=</span> <span class="n">new_n_voxel</span> <span class="o">-</span> <span class="n">n_voxel</span>
</span><span id="Closures-2423"><a href="#-2423"><span class="linenos">2423</span></a>                <span class="nb">print</span><span class="p">(</span>
</span><span id="Closures-2424"><a href="#-2424"><span class="linenos">2424</span></a>                    <span class="s2">&quot;    ... i, ii, closure label number, geobody shape, delta_voxel, previous_delta_voxel,&quot;</span>
</span><span id="Closures-2425"><a href="#-2425"><span class="linenos">2425</span></a>                    <span class="s2">&quot; delta_voxel&gt;previous_delta_voxel = &quot;</span><span class="p">,</span>
</span><span id="Closures-2426"><a href="#-2426"><span class="linenos">2426</span></a>                    <span class="n">i</span><span class="p">,</span>
</span><span id="Closures-2427"><a href="#-2427"><span class="linenos">2427</span></a>                    <span class="n">ii</span><span class="p">,</span>
</span><span id="Closures-2428"><a href="#-2428"><span class="linenos">2428</span></a>                    <span class="n">new_n_voxel</span><span class="p">,</span>
</span><span id="Closures-2429"><a href="#-2429"><span class="linenos">2429</span></a>                    <span class="n">delta_voxel</span><span class="p">,</span>
</span><span id="Closures-2430"><a href="#-2430"><span class="linenos">2430</span></a>                    <span class="n">previous_delta_voxel</span><span class="p">,</span>
</span><span id="Closures-2431"><a href="#-2431"><span class="linenos">2431</span></a>                    <span class="n">delta_voxel</span> <span class="o">&gt;</span> <span class="n">previous_delta_voxel</span><span class="p">,</span>
</span><span id="Closures-2432"><a href="#-2432"><span class="linenos">2432</span></a>                <span class="p">)</span>
</span><span id="Closures-2433"><a href="#-2433"><span class="linenos">2433</span></a>
</span><span id="Closures-2434"><a href="#-2434"><span class="linenos">2434</span></a>                <span class="c1"># If grown voxel is touching the egde of survey, stop and remove closure</span>
</span><span id="Closures-2435"><a href="#-2435"><span class="linenos">2435</span></a>                <span class="n">_a</span><span class="p">,</span> <span class="n">_b</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">single_closure</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="Closures-2436"><a href="#-2436"><span class="linenos">2436</span></a>                <span class="n">max_boundary_i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>
</span><span id="Closures-2437"><a href="#-2437"><span class="linenos">2437</span></a>                <span class="n">max_boundary_j</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>
</span><span id="Closures-2438"><a href="#-2438"><span class="linenos">2438</span></a>                <span class="k">if</span> <span class="p">(</span>
</span><span id="Closures-2439"><a href="#-2439"><span class="linenos">2439</span></a>                    <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">_a</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>
</span><span id="Closures-2440"><a href="#-2440"><span class="linenos">2440</span></a>                    <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">_a</span><span class="p">)</span> <span class="o">==</span> <span class="n">max_boundary_i</span>
</span><span id="Closures-2441"><a href="#-2441"><span class="linenos">2441</span></a>                    <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">_b</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>
</span><span id="Closures-2442"><a href="#-2442"><span class="linenos">2442</span></a>                    <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">_b</span><span class="p">)</span> <span class="o">==</span> <span class="n">max_boundary_j</span>
</span><span id="Closures-2443"><a href="#-2443"><span class="linenos">2443</span></a>                <span class="p">):</span>
</span><span id="Closures-2444"><a href="#-2444"><span class="linenos">2444</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Boundary reached, removing closure&quot;</span><span class="p">)</span>
</span><span id="Closures-2445"><a href="#-2445"><span class="linenos">2445</span></a>                    <span class="n">converged</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Closures-2446"><a href="#-2446"><span class="linenos">2446</span></a>                    <span class="k">break</span>
</span><span id="Closures-2447"><a href="#-2447"><span class="linenos">2447</span></a>
</span><span id="Closures-2448"><a href="#-2448"><span class="linenos">2448</span></a>                <span class="k">if</span> <span class="n">n_voxel</span> <span class="o">==</span> <span class="n">new_n_voxel</span><span class="p">:</span>
</span><span id="Closures-2449"><a href="#-2449"><span class="linenos">2449</span></a>                    <span class="c1"># finish bottom voxel layer near HCWC</span>
</span><span id="Closures-2450"><a href="#-2450"><span class="linenos">2450</span></a>                    <span class="n">grown_closure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grow_downward</span><span class="p">(</span>
</span><span id="Closures-2451"><a href="#-2451"><span class="linenos">2451</span></a>                        <span class="n">grown_closure</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span>
</span><span id="Closures-2452"><a href="#-2452"><span class="linenos">2452</span></a>                    <span class="p">)</span>
</span><span id="Closures-2453"><a href="#-2453"><span class="linenos">2453</span></a>                    <span class="c1"># stay within layer, within age, within fault block, above HCWC</span>
</span><span id="Closures-2454"><a href="#-2454"><span class="linenos">2454</span></a>                    <span class="n">grown_closure</span><span class="p">[</span><span class="n">closure_boundary_cube</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="Closures-2455"><a href="#-2455"><span class="linenos">2455</span></a>                    <span class="n">single_closure</span> <span class="o">=</span> <span class="n">single_closure</span> <span class="o">+</span> <span class="n">grown_closure</span>
</span><span id="Closures-2456"><a href="#-2456"><span class="linenos">2456</span></a>                    <span class="n">single_closure</span><span class="p">[</span><span class="n">single_closure</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
</span><span id="Closures-2457"><a href="#-2457"><span class="linenos">2457</span></a>                    <span class="n">converged</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Closures-2458"><a href="#-2458"><span class="linenos">2458</span></a>                    <span class="k">break</span>
</span><span id="Closures-2459"><a href="#-2459"><span class="linenos">2459</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Closures-2460"><a href="#-2460"><span class="linenos">2460</span></a>                    <span class="n">n_voxel</span> <span class="o">=</span> <span class="n">new_n_voxel</span>
</span><span id="Closures-2461"><a href="#-2461"><span class="linenos">2461</span></a>                <span class="n">previous_delta_voxel</span> <span class="o">=</span> <span class="n">delta_voxel</span> <span class="o">+</span> <span class="mi">0</span>
</span><span id="Closures-2462"><a href="#-2462"><span class="linenos">2462</span></a>            <span class="k">if</span> <span class="n">converged</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="Closures-2463"><a href="#-2463"><span class="linenos">2463</span></a>                <span class="n">labels_clean</span><span class="p">[</span><span class="n">single_closure</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
</span><span id="Closures-2464"><a href="#-2464"><span class="linenos">2464</span></a>                <span class="n">msg_postscript</span> <span class="o">=</span> <span class="s2">&quot; converged&quot;</span>
</span><span id="Closures-2465"><a href="#-2465"><span class="linenos">2465</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Closures-2466"><a href="#-2466"><span class="linenos">2466</span></a>                <span class="n">labels_clean</span><span class="p">[</span><span class="n">labels_clean</span> <span class="o">==</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">i</span>
</span><span id="Closures-2467"><a href="#-2467"><span class="linenos">2467</span></a>                <span class="n">msg_postscript</span> <span class="o">=</span> <span class="s2">&quot; NOT converged&quot;</span>
</span><span id="Closures-2468"><a href="#-2468"><span class="linenos">2468</span></a>            <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="Closures-2469"><a href="#-2469"><span class="linenos">2469</span></a>                <span class="sa">f</span><span class="s2">&quot;closure_id: </span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="si">:</span><span class="s2">04d</span><span class="si">}</span><span class="s2">, &quot;</span>
</span><span id="Closures-2470"><a href="#-2470"><span class="linenos">2470</span></a>                <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;original_voxels: </span><span class="si">{</span><span class="n">original_voxels</span><span class="si">:</span><span class="s2">11.0f</span><span class="si">}</span><span class="s2">, new_n_voxel: </span><span class="si">{</span><span class="n">new_n_voxel</span><span class="si">:</span><span class="s2">11.0f</span><span class="si">}</span><span class="s2">, &quot;</span>
</span><span id="Closures-2471"><a href="#-2471"><span class="linenos">2471</span></a>                <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;percent_growth: </span><span class="si">{</span><span class="nb">float</span><span class="p">(</span><span class="n">new_n_voxel</span> <span class="o">/</span> <span class="n">original_voxels</span><span class="p">)</span><span class="si">:</span><span class="s2">6.2f</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Closures-2472"><a href="#-2472"><span class="linenos">2472</span></a>            <span class="p">)</span>
</span><span id="Closures-2473"><a href="#-2473"><span class="linenos">2473</span></a>            <span class="nb">print</span><span class="p">(</span><span class="n">msg</span> <span class="o">+</span> <span class="n">msg_postscript</span><span class="p">)</span>
</span><span id="Closures-2474"><a href="#-2474"><span class="linenos">2474</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span><span class="n">msg</span> <span class="o">+</span> <span class="n">msg_postscript</span><span class="p">)</span>
</span><span id="Closures-2475"><a href="#-2475"><span class="linenos">2475</span></a>
</span><span id="Closures-2476"><a href="#-2476"><span class="linenos">2476</span></a>        <span class="c1"># Set small closures to 0 after growth</span>
</span><span id="Closures-2477"><a href="#-2477"><span class="linenos">2477</span></a>        <span class="n">_initial_labels</span> <span class="o">=</span> <span class="n">measure</span><span class="o">.</span><span class="n">label</span><span class="p">(</span><span class="n">initial_closures</span><span class="p">,</span> <span class="n">connectivity</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">background</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="Closures-2478"><a href="#-2478"><span class="linenos">2478</span></a>        <span class="n">_grown_labels</span> <span class="o">=</span> <span class="n">measure</span><span class="o">.</span><span class="n">label</span><span class="p">(</span><span class="n">labels_clean</span><span class="p">,</span> <span class="n">connectivity</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">background</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="Closures-2479"><a href="#-2479"><span class="linenos">2479</span></a>        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">_grown_labels</span><span class="p">)[</span>
</span><span id="Closures-2480"><a href="#-2480"><span class="linenos">2480</span></a>            <span class="mi">1</span><span class="p">:</span>
</span><span id="Closures-2481"><a href="#-2481"><span class="linenos">2481</span></a>        <span class="p">]:</span>  <span class="c1"># ignore the first label of 0 (closures only)</span>
</span><span id="Closures-2482"><a href="#-2482"><span class="linenos">2482</span></a>            <span class="n">size_initial</span> <span class="o">=</span> <span class="n">_initial_labels</span><span class="p">[</span><span class="n">_initial_labels</span> <span class="o">==</span> <span class="n">x</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="Closures-2483"><a href="#-2483"><span class="linenos">2483</span></a>            <span class="n">size_grown</span> <span class="o">=</span> <span class="n">_grown_labels</span><span class="p">[</span><span class="n">_grown_labels</span> <span class="o">==</span> <span class="n">x</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="Closures-2484"><a href="#-2484"><span class="linenos">2484</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Size before editing: </span><span class="si">{</span><span class="n">size_initial</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Closures-2485"><a href="#-2485"><span class="linenos">2485</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Size after editing: </span><span class="si">{</span><span class="n">size_grown</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Closures-2486"><a href="#-2486"><span class="linenos">2486</span></a>            <span class="k">if</span> <span class="n">size_grown</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">closure_min_voxels</span><span class="p">:</span>
</span><span id="Closures-2487"><a href="#-2487"><span class="linenos">2487</span></a>                <span class="nb">print</span><span class="p">(</span>
</span><span id="Closures-2488"><a href="#-2488"><span class="linenos">2488</span></a>                    <span class="sa">f</span><span class="s2">&quot;Closure below threshold of </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">closure_min_voxels</span><span class="si">}</span><span class="s2"> and will be removed&quot;</span>
</span><span id="Closures-2489"><a href="#-2489"><span class="linenos">2489</span></a>                <span class="p">)</span>
</span><span id="Closures-2490"><a href="#-2490"><span class="linenos">2490</span></a>                <span class="n">labels_clean</span><span class="p">[</span><span class="n">_grown_labels</span> <span class="o">==</span> <span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="Closures-2491"><a href="#-2491"><span class="linenos">2491</span></a>
</span><span id="Closures-2492"><a href="#-2492"><span class="linenos">2492</span></a>        <span class="k">return</span> <span class="n">labels_clean</span>
</span><span id="Closures-2493"><a href="#-2493"><span class="linenos">2493</span></a>
</span><span id="Closures-2494"><a href="#-2494"><span class="linenos">2494</span></a>    <span class="nd">@staticmethod</span>
</span><span id="Closures-2495"><a href="#-2495"><span class="linenos">2495</span></a>    <span class="k">def</span> <span class="nf">grow_lateral</span><span class="p">(</span><span class="n">geobody</span><span class="p">,</span> <span class="n">iterations</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="Closures-2496"><a href="#-2496"><span class="linenos">2496</span></a>        <span class="kn">from</span> <span class="nn">scipy.ndimage.morphology</span> <span class="kn">import</span> <span class="n">grey_dilation</span>
</span><span id="Closures-2497"><a href="#-2497"><span class="linenos">2497</span></a>
</span><span id="Closures-2498"><a href="#-2498"><span class="linenos">2498</span></a>        <span class="n">dist_size</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">dist</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="Closures-2499"><a href="#-2499"><span class="linenos">2499</span></a>        <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">dist_size</span><span class="p">,</span> <span class="n">dist_size</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</span><span id="Closures-2500"><a href="#-2500"><span class="linenos">2500</span></a>        <span class="n">mask</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="Closures-2501"><a href="#-2501"><span class="linenos">2501</span></a>        <span class="n">_geobody</span> <span class="o">=</span> <span class="n">geobody</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Closures-2502"><a href="#-2502"><span class="linenos">2502</span></a>        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="Closures-2503"><a href="#-2503"><span class="linenos">2503</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; ...grow_lateral: _geobody.shape = &quot;</span><span class="p">,</span> <span class="n">_geobody</span><span class="p">[</span><span class="n">_geobody</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span><span id="Closures-2504"><a href="#-2504"><span class="linenos">2504</span></a>        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">iterations</span><span class="p">):</span>
</span><span id="Closures-2505"><a href="#-2505"><span class="linenos">2505</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="Closures-2506"><a href="#-2506"><span class="linenos">2506</span></a>                <span class="n">_geobody</span> <span class="o">=</span> <span class="n">grey_dilation</span><span class="p">(</span><span class="n">_geobody</span><span class="p">,</span> <span class="n">footprint</span><span class="o">=</span><span class="n">mask</span><span class="p">)</span>
</span><span id="Closures-2507"><a href="#-2507"><span class="linenos">2507</span></a>                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="Closures-2508"><a href="#-2508"><span class="linenos">2508</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="Closures-2509"><a href="#-2509"><span class="linenos">2509</span></a>                        <span class="s2">&quot; ...grow_lateral: k, _geobody.shape = &quot;</span><span class="p">,</span>
</span><span id="Closures-2510"><a href="#-2510"><span class="linenos">2510</span></a>                        <span class="n">k</span><span class="p">,</span>
</span><span id="Closures-2511"><a href="#-2511"><span class="linenos">2511</span></a>                        <span class="n">_geobody</span><span class="p">[</span><span class="n">_geobody</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
</span><span id="Closures-2512"><a href="#-2512"><span class="linenos">2512</span></a>                    <span class="p">)</span>
</span><span id="Closures-2513"><a href="#-2513"><span class="linenos">2513</span></a>            <span class="k">except</span><span class="p">:</span>
</span><span id="Closures-2514"><a href="#-2514"><span class="linenos">2514</span></a>                <span class="k">break</span>
</span><span id="Closures-2515"><a href="#-2515"><span class="linenos">2515</span></a>        <span class="k">return</span> <span class="n">_geobody</span>
</span><span id="Closures-2516"><a href="#-2516"><span class="linenos">2516</span></a>
</span><span id="Closures-2517"><a href="#-2517"><span class="linenos">2517</span></a>    <span class="nd">@staticmethod</span>
</span><span id="Closures-2518"><a href="#-2518"><span class="linenos">2518</span></a>    <span class="k">def</span> <span class="nf">grow_upward</span><span class="p">(</span><span class="n">geobody</span><span class="p">,</span> <span class="n">iterations</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="Closures-2519"><a href="#-2519"><span class="linenos">2519</span></a>        <span class="kn">from</span> <span class="nn">scipy.ndimage.morphology</span> <span class="kn">import</span> <span class="n">grey_dilation</span>
</span><span id="Closures-2520"><a href="#-2520"><span class="linenos">2520</span></a>
</span><span id="Closures-2521"><a href="#-2521"><span class="linenos">2521</span></a>        <span class="n">dist_size</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">dist</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="Closures-2522"><a href="#-2522"><span class="linenos">2522</span></a>        <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dist_size</span><span class="p">))</span>
</span><span id="Closures-2523"><a href="#-2523"><span class="linenos">2523</span></a>        <span class="n">mask</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:</span> <span class="n">dist</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="Closures-2524"><a href="#-2524"><span class="linenos">2524</span></a>        <span class="n">_geobody</span> <span class="o">=</span> <span class="n">geobody</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Closures-2525"><a href="#-2525"><span class="linenos">2525</span></a>        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="Closures-2526"><a href="#-2526"><span class="linenos">2526</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; ...grow_upward: _geobody.shape = &quot;</span><span class="p">,</span> <span class="n">_geobody</span><span class="p">[</span><span class="n">_geobody</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span><span id="Closures-2527"><a href="#-2527"><span class="linenos">2527</span></a>        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">iterations</span><span class="p">):</span>
</span><span id="Closures-2528"><a href="#-2528"><span class="linenos">2528</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="Closures-2529"><a href="#-2529"><span class="linenos">2529</span></a>                <span class="n">_geobody</span> <span class="o">=</span> <span class="n">grey_dilation</span><span class="p">(</span><span class="n">_geobody</span><span class="p">,</span> <span class="n">footprint</span><span class="o">=</span><span class="n">mask</span><span class="p">)</span>
</span><span id="Closures-2530"><a href="#-2530"><span class="linenos">2530</span></a>                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="Closures-2531"><a href="#-2531"><span class="linenos">2531</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="Closures-2532"><a href="#-2532"><span class="linenos">2532</span></a>                        <span class="s2">&quot; ...grow_upward: k, _geobody.shape = &quot;</span><span class="p">,</span>
</span><span id="Closures-2533"><a href="#-2533"><span class="linenos">2533</span></a>                        <span class="n">k</span><span class="p">,</span>
</span><span id="Closures-2534"><a href="#-2534"><span class="linenos">2534</span></a>                        <span class="n">_geobody</span><span class="p">[</span><span class="n">_geobody</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
</span><span id="Closures-2535"><a href="#-2535"><span class="linenos">2535</span></a>                    <span class="p">)</span>
</span><span id="Closures-2536"><a href="#-2536"><span class="linenos">2536</span></a>            <span class="k">except</span><span class="p">:</span>
</span><span id="Closures-2537"><a href="#-2537"><span class="linenos">2537</span></a>                <span class="k">break</span>
</span><span id="Closures-2538"><a href="#-2538"><span class="linenos">2538</span></a>        <span class="k">return</span> <span class="n">_geobody</span>
</span><span id="Closures-2539"><a href="#-2539"><span class="linenos">2539</span></a>
</span><span id="Closures-2540"><a href="#-2540"><span class="linenos">2540</span></a>    <span class="nd">@staticmethod</span>
</span><span id="Closures-2541"><a href="#-2541"><span class="linenos">2541</span></a>    <span class="k">def</span> <span class="nf">grow_downward</span><span class="p">(</span><span class="n">geobody</span><span class="p">,</span> <span class="n">iterations</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="Closures-2542"><a href="#-2542"><span class="linenos">2542</span></a>        <span class="kn">from</span> <span class="nn">scipy.ndimage.morphology</span> <span class="kn">import</span> <span class="n">grey_dilation</span>
</span><span id="Closures-2543"><a href="#-2543"><span class="linenos">2543</span></a>
</span><span id="Closures-2544"><a href="#-2544"><span class="linenos">2544</span></a>        <span class="n">dist_size</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">dist</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="Closures-2545"><a href="#-2545"><span class="linenos">2545</span></a>        <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dist_size</span><span class="p">))</span>
</span><span id="Closures-2546"><a href="#-2546"><span class="linenos">2546</span></a>        <span class="n">mask</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">dist</span><span class="p">:]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="Closures-2547"><a href="#-2547"><span class="linenos">2547</span></a>        <span class="n">_geobody</span> <span class="o">=</span> <span class="n">geobody</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Closures-2548"><a href="#-2548"><span class="linenos">2548</span></a>        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="Closures-2549"><a href="#-2549"><span class="linenos">2549</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; ...grow_downward: _geobody.shape = &quot;</span><span class="p">,</span> <span class="n">_geobody</span><span class="p">[</span><span class="n">_geobody</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span><span id="Closures-2550"><a href="#-2550"><span class="linenos">2550</span></a>        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">iterations</span><span class="p">):</span>
</span><span id="Closures-2551"><a href="#-2551"><span class="linenos">2551</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="Closures-2552"><a href="#-2552"><span class="linenos">2552</span></a>                <span class="n">_geobody</span> <span class="o">=</span> <span class="n">grey_dilation</span><span class="p">(</span><span class="n">_geobody</span><span class="p">,</span> <span class="n">footprint</span><span class="o">=</span><span class="n">mask</span><span class="p">)</span>
</span><span id="Closures-2553"><a href="#-2553"><span class="linenos">2553</span></a>                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="Closures-2554"><a href="#-2554"><span class="linenos">2554</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="Closures-2555"><a href="#-2555"><span class="linenos">2555</span></a>                        <span class="s2">&quot; ...grow_downward: k, _geobody.shape = &quot;</span><span class="p">,</span>
</span><span id="Closures-2556"><a href="#-2556"><span class="linenos">2556</span></a>                        <span class="n">k</span><span class="p">,</span>
</span><span id="Closures-2557"><a href="#-2557"><span class="linenos">2557</span></a>                        <span class="n">_geobody</span><span class="p">[</span><span class="n">_geobody</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
</span><span id="Closures-2558"><a href="#-2558"><span class="linenos">2558</span></a>                    <span class="p">)</span>
</span><span id="Closures-2559"><a href="#-2559"><span class="linenos">2559</span></a>            <span class="k">except</span><span class="p">:</span>
</span><span id="Closures-2560"><a href="#-2560"><span class="linenos">2560</span></a>                <span class="k">break</span>
</span><span id="Closures-2561"><a href="#-2561"><span class="linenos">2561</span></a>        <span class="k">return</span> <span class="n">_geobody</span>
</span><span id="Closures-2562"><a href="#-2562"><span class="linenos">2562</span></a>
</span><span id="Closures-2563"><a href="#-2563"><span class="linenos">2563</span></a>    <span class="nd">@staticmethod</span>
</span><span id="Closures-2564"><a href="#-2564"><span class="linenos">2564</span></a>    <span class="k">def</span> <span class="nf">_threshold_volumes</span><span class="p">(</span><span class="n">volume</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
</span><span id="Closures-2565"><a href="#-2565"><span class="linenos">2565</span></a>        <span class="n">volume</span><span class="p">[</span><span class="n">volume</span> <span class="o">&gt;=</span> <span class="n">threshold</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="Closures-2566"><a href="#-2566"><span class="linenos">2566</span></a>        <span class="n">volume</span><span class="p">[</span><span class="n">volume</span> <span class="o">&lt;</span> <span class="n">threshold</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="Closures-2567"><a href="#-2567"><span class="linenos">2567</span></a>        <span class="k">return</span> <span class="n">volume</span>
</span><span id="Closures-2568"><a href="#-2568"><span class="linenos">2568</span></a>
</span><span id="Closures-2569"><a href="#-2569"><span class="linenos">2569</span></a>    <span class="k">def</span> <span class="nf">parse_closure_codes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hc_closure_codes</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">num</span><span class="p">,</span> <span class="n">code</span><span class="o">=</span><span class="mf">0.1</span><span class="p">):</span>
</span><span id="Closures-2570"><a href="#-2570"><span class="linenos">2570</span></a>        <span class="n">labels</span> <span class="o">=</span> <span class="n">labels</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;float32&quot;</span><span class="p">)</span>
</span><span id="Closures-2571"><a href="#-2571"><span class="linenos">2571</span></a>        <span class="k">if</span> <span class="n">num</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Closures-2572"><a href="#-2572"><span class="linenos">2572</span></a>            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">num</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="Closures-2573"><a href="#-2573"><span class="linenos">2573</span></a>                <span class="n">y</span> <span class="o">=</span> <span class="n">code</span> <span class="o">+</span> <span class="n">labels</span><span class="p">[</span><span class="n">labels</span> <span class="o">==</span> <span class="n">x</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="Closures-2574"><a href="#-2574"><span class="linenos">2574</span></a>                <span class="n">labels</span><span class="p">[</span><span class="n">labels</span> <span class="o">==</span> <span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span>
</span><span id="Closures-2575"><a href="#-2575"><span class="linenos">2575</span></a>            <span class="n">hc_closure_codes</span> <span class="o">+=</span> <span class="n">labels</span>
</span><span id="Closures-2576"><a href="#-2576"><span class="linenos">2576</span></a>        <span class="k">return</span> <span class="n">hc_closure_codes</span>
</span></pre></div>


            <div class="docstring"><h6 id="geomodel">Geomodel</h6>

<p>The class of the Geomodel object.</p>

<p>This class contains all the items that make up the Geologic model.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>parameters</strong> (<a href="Parameters.html">datagenerator.Parameters</a>):
Parameter object storing all model parameters.</li>
<li><strong>depth_maps</strong> (np.ndarray):
A numpy array containing the depth maps.</li>
<li><strong>onlap_horizon_list</strong> (list):
A list of the onlap horizons.</li>
<li><strong>facies</strong> (np.ndarray):
The generated facies.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>None</strong></li>
</ul>
</div>


                            <div id="Closures.__init__" class="classattr">
                                        <input id="Closures.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">Closures</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">parameters</span>, </span><span class="param"><span class="n">faults</span>, </span><span class="param"><span class="n">facies</span>, </span><span class="param"><span class="n">onlap_horizon_list</span></span>)</span>

                <label class="view-source-button" for="Closures.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Closures.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Closures.__init__-13"><a href="#-13"><span class="linenos"> 13</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parameters</span><span class="p">,</span> <span class="n">faults</span><span class="p">,</span> <span class="n">facies</span><span class="p">,</span> <span class="n">onlap_horizon_list</span><span class="p">):</span>
</span><span id="Closures.__init__-14"><a href="#-14"><span class="linenos"> 14</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">closure_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
</span><span id="Closures.__init__-15"><a href="#-15"><span class="linenos"> 15</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span> <span class="o">=</span> <span class="n">parameters</span>
</span><span id="Closures.__init__-16"><a href="#-16"><span class="linenos"> 16</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">faults</span> <span class="o">=</span> <span class="n">faults</span>
</span><span id="Closures.__init__-17"><a href="#-17"><span class="linenos"> 17</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">facies</span> <span class="o">=</span> <span class="n">facies</span>
</span><span id="Closures.__init__-18"><a href="#-18"><span class="linenos"> 18</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">onlap_list</span> <span class="o">=</span> <span class="n">onlap_horizon_list</span>
</span><span id="Closures.__init__-19"><a href="#-19"><span class="linenos"> 19</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">top_lith_facies</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Closures.__init__-20"><a href="#-20"><span class="linenos"> 20</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">closure_vol_shape</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">faulted_age_volume</span><span class="o">.</span><span class="n">shape</span>
</span><span id="Closures.__init__-21"><a href="#-21"><span class="linenos"> 21</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">closure_segments</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="Closures.__init__-22"><a href="#-22"><span class="linenos"> 22</span></a>            <span class="s2">&quot;closure_segments&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">closure_vol_shape</span>
</span><span id="Closures.__init__-23"><a href="#-23"><span class="linenos"> 23</span></a>        <span class="p">)</span>
</span><span id="Closures.__init__-24"><a href="#-24"><span class="linenos"> 24</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">oil_closures</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="Closures.__init__-25"><a href="#-25"><span class="linenos"> 25</span></a>            <span class="s2">&quot;oil_closures&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">closure_vol_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;uint8&quot;</span>
</span><span id="Closures.__init__-26"><a href="#-26"><span class="linenos"> 26</span></a>        <span class="p">)</span>
</span><span id="Closures.__init__-27"><a href="#-27"><span class="linenos"> 27</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gas_closures</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="Closures.__init__-28"><a href="#-28"><span class="linenos"> 28</span></a>            <span class="s2">&quot;gas_closures&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">closure_vol_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;uint8&quot;</span>
</span><span id="Closures.__init__-29"><a href="#-29"><span class="linenos"> 29</span></a>        <span class="p">)</span>
</span><span id="Closures.__init__-30"><a href="#-30"><span class="linenos"> 30</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">brine_closures</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="Closures.__init__-31"><a href="#-31"><span class="linenos"> 31</span></a>            <span class="s2">&quot;brine_closures&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">closure_vol_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;uint8&quot;</span>
</span><span id="Closures.__init__-32"><a href="#-32"><span class="linenos"> 32</span></a>        <span class="p">)</span>
</span><span id="Closures.__init__-33"><a href="#-33"><span class="linenos"> 33</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">simple_closures</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="Closures.__init__-34"><a href="#-34"><span class="linenos"> 34</span></a>            <span class="s2">&quot;simple_closures&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">closure_vol_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;uint8&quot;</span>
</span><span id="Closures.__init__-35"><a href="#-35"><span class="linenos"> 35</span></a>        <span class="p">)</span>
</span><span id="Closures.__init__-36"><a href="#-36"><span class="linenos"> 36</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">strat_closures</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="Closures.__init__-37"><a href="#-37"><span class="linenos"> 37</span></a>            <span class="s2">&quot;strat_closures&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">closure_vol_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;uint8&quot;</span>
</span><span id="Closures.__init__-38"><a href="#-38"><span class="linenos"> 38</span></a>        <span class="p">)</span>
</span><span id="Closures.__init__-39"><a href="#-39"><span class="linenos"> 39</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fault_closures</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="Closures.__init__-40"><a href="#-40"><span class="linenos"> 40</span></a>            <span class="s2">&quot;fault_closures&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">closure_vol_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;uint8&quot;</span>
</span><span id="Closures.__init__-41"><a href="#-41"><span class="linenos"> 41</span></a>        <span class="p">)</span>
</span><span id="Closures.__init__-42"><a href="#-42"><span class="linenos"> 42</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">hc_labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="Closures.__init__-43"><a href="#-43"><span class="linenos"> 43</span></a>            <span class="s2">&quot;hc_labels&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">closure_vol_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;uint8&quot;</span>
</span><span id="Closures.__init__-44"><a href="#-44"><span class="linenos"> 44</span></a>        <span class="p">)</span>
</span><span id="Closures.__init__-45"><a href="#-45"><span class="linenos"> 45</span></a>
</span><span id="Closures.__init__-46"><a href="#-46"><span class="linenos"> 46</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">all_closure_segments</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="Closures.__init__-47"><a href="#-47"><span class="linenos"> 47</span></a>            <span class="s2">&quot;all_closure_segments&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">closure_vol_shape</span>
</span><span id="Closures.__init__-48"><a href="#-48"><span class="linenos"> 48</span></a>        <span class="p">)</span>
</span><span id="Closures.__init__-49"><a href="#-49"><span class="linenos"> 49</span></a>
</span><span id="Closures.__init__-50"><a href="#-50"><span class="linenos"> 50</span></a>        <span class="c1"># Class attributes added from Intersect3D</span>
</span><span id="Closures.__init__-51"><a href="#-51"><span class="linenos"> 51</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">wide_faults</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="Closures.__init__-52"><a href="#-52"><span class="linenos"> 52</span></a>            <span class="s2">&quot;wide_faults&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">closure_vol_shape</span>
</span><span id="Closures.__init__-53"><a href="#-53"><span class="linenos"> 53</span></a>        <span class="p">)</span>
</span><span id="Closures.__init__-54"><a href="#-54"><span class="linenos"> 54</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fat_faults</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span><span class="s2">&quot;fat_faults&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">closure_vol_shape</span><span class="p">)</span>
</span><span id="Closures.__init__-55"><a href="#-55"><span class="linenos"> 55</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">onlaps_upward</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="Closures.__init__-56"><a href="#-56"><span class="linenos"> 56</span></a>            <span class="s2">&quot;onlaps_upward&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">closure_vol_shape</span>
</span><span id="Closures.__init__-57"><a href="#-57"><span class="linenos"> 57</span></a>        <span class="p">)</span>
</span><span id="Closures.__init__-58"><a href="#-58"><span class="linenos"> 58</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">onlaps_downward</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="Closures.__init__-59"><a href="#-59"><span class="linenos"> 59</span></a>            <span class="s2">&quot;onlaps_downward&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">closure_vol_shape</span>
</span><span id="Closures.__init__-60"><a href="#-60"><span class="linenos"> 60</span></a>        <span class="p">)</span>
</span><span id="Closures.__init__-61"><a href="#-61"><span class="linenos"> 61</span></a>
</span><span id="Closures.__init__-62"><a href="#-62"><span class="linenos"> 62</span></a>        <span class="c1"># Faulted closures</span>
</span><span id="Closures.__init__-63"><a href="#-63"><span class="linenos"> 63</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">faulted_closures_oil</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="Closures.__init__-64"><a href="#-64"><span class="linenos"> 64</span></a>            <span class="s2">&quot;faulted_closures_oil&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">closure_vol_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;uint8&quot;</span>
</span><span id="Closures.__init__-65"><a href="#-65"><span class="linenos"> 65</span></a>        <span class="p">)</span>
</span><span id="Closures.__init__-66"><a href="#-66"><span class="linenos"> 66</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">faulted_closures_gas</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="Closures.__init__-67"><a href="#-67"><span class="linenos"> 67</span></a>            <span class="s2">&quot;faulted_closures_gas&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">closure_vol_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;uint8&quot;</span>
</span><span id="Closures.__init__-68"><a href="#-68"><span class="linenos"> 68</span></a>        <span class="p">)</span>
</span><span id="Closures.__init__-69"><a href="#-69"><span class="linenos"> 69</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">faulted_closures_brine</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="Closures.__init__-70"><a href="#-70"><span class="linenos"> 70</span></a>            <span class="s2">&quot;faulted_closures_brine&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">closure_vol_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;uint8&quot;</span>
</span><span id="Closures.__init__-71"><a href="#-71"><span class="linenos"> 71</span></a>        <span class="p">)</span>
</span><span id="Closures.__init__-72"><a href="#-72"><span class="linenos"> 72</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fault_closures_oil_segment_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
</span><span id="Closures.__init__-73"><a href="#-73"><span class="linenos"> 73</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fault_closures_gas_segment_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
</span><span id="Closures.__init__-74"><a href="#-74"><span class="linenos"> 74</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fault_closures_brine_segment_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
</span><span id="Closures.__init__-75"><a href="#-75"><span class="linenos"> 75</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_fault_closures_oil</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Closures.__init__-76"><a href="#-76"><span class="linenos"> 76</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_fault_closures_gas</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Closures.__init__-77"><a href="#-77"><span class="linenos"> 77</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_fault_closures_brine</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Closures.__init__-78"><a href="#-78"><span class="linenos"> 78</span></a>
</span><span id="Closures.__init__-79"><a href="#-79"><span class="linenos"> 79</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">faulted_all_closures</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="Closures.__init__-80"><a href="#-80"><span class="linenos"> 80</span></a>            <span class="s2">&quot;faulted_all_closures&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">closure_vol_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;uint8&quot;</span>
</span><span id="Closures.__init__-81"><a href="#-81"><span class="linenos"> 81</span></a>        <span class="p">)</span>
</span><span id="Closures.__init__-82"><a href="#-82"><span class="linenos"> 82</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fault_all_closures_segment_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
</span><span id="Closures.__init__-83"><a href="#-83"><span class="linenos"> 83</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_fault_all_closures</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Closures.__init__-84"><a href="#-84"><span class="linenos"> 84</span></a>
</span><span id="Closures.__init__-85"><a href="#-85"><span class="linenos"> 85</span></a>        <span class="c1"># Onlap closures</span>
</span><span id="Closures.__init__-86"><a href="#-86"><span class="linenos"> 86</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">onlap_closures_oil</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="Closures.__init__-87"><a href="#-87"><span class="linenos"> 87</span></a>            <span class="s2">&quot;onlap_closures_oil&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">closure_vol_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;uint8&quot;</span>
</span><span id="Closures.__init__-88"><a href="#-88"><span class="linenos"> 88</span></a>        <span class="p">)</span>
</span><span id="Closures.__init__-89"><a href="#-89"><span class="linenos"> 89</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">onlap_closures_gas</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="Closures.__init__-90"><a href="#-90"><span class="linenos"> 90</span></a>            <span class="s2">&quot;onlap_closures_gas&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">closure_vol_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;uint8&quot;</span>
</span><span id="Closures.__init__-91"><a href="#-91"><span class="linenos"> 91</span></a>        <span class="p">)</span>
</span><span id="Closures.__init__-92"><a href="#-92"><span class="linenos"> 92</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">onlap_closures_brine</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="Closures.__init__-93"><a href="#-93"><span class="linenos"> 93</span></a>            <span class="s2">&quot;onlap_closures_brine&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">closure_vol_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;uint8&quot;</span>
</span><span id="Closures.__init__-94"><a href="#-94"><span class="linenos"> 94</span></a>        <span class="p">)</span>
</span><span id="Closures.__init__-95"><a href="#-95"><span class="linenos"> 95</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">onlap_closures_oil_segment_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
</span><span id="Closures.__init__-96"><a href="#-96"><span class="linenos"> 96</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">onlap_closures_gas_segment_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
</span><span id="Closures.__init__-97"><a href="#-97"><span class="linenos"> 97</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">onlap_closures_brine_segment_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
</span><span id="Closures.__init__-98"><a href="#-98"><span class="linenos"> 98</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_onlap_closures_oil</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Closures.__init__-99"><a href="#-99"><span class="linenos"> 99</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_onlap_closures_gas</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Closures.__init__-100"><a href="#-100"><span class="linenos">100</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_onlap_closures_brine</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Closures.__init__-101"><a href="#-101"><span class="linenos">101</span></a>
</span><span id="Closures.__init__-102"><a href="#-102"><span class="linenos">102</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">onlap_all_closures</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="Closures.__init__-103"><a href="#-103"><span class="linenos">103</span></a>            <span class="s2">&quot;onlap_all_closures&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">closure_vol_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;uint8&quot;</span>
</span><span id="Closures.__init__-104"><a href="#-104"><span class="linenos">104</span></a>        <span class="p">)</span>
</span><span id="Closures.__init__-105"><a href="#-105"><span class="linenos">105</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">onlap_all_closures_segment_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
</span><span id="Closures.__init__-106"><a href="#-106"><span class="linenos">106</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_onlap_all_closures_oil</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Closures.__init__-107"><a href="#-107"><span class="linenos">107</span></a>
</span><span id="Closures.__init__-108"><a href="#-108"><span class="linenos">108</span></a>        <span class="c1"># Simple closures</span>
</span><span id="Closures.__init__-109"><a href="#-109"><span class="linenos">109</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">simple_closures_oil</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="Closures.__init__-110"><a href="#-110"><span class="linenos">110</span></a>            <span class="s2">&quot;simple_closures_oil&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">closure_vol_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;uint8&quot;</span>
</span><span id="Closures.__init__-111"><a href="#-111"><span class="linenos">111</span></a>        <span class="p">)</span>
</span><span id="Closures.__init__-112"><a href="#-112"><span class="linenos">112</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">simple_closures_gas</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="Closures.__init__-113"><a href="#-113"><span class="linenos">113</span></a>            <span class="s2">&quot;simple_closures_gas&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">closure_vol_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;uint8&quot;</span>
</span><span id="Closures.__init__-114"><a href="#-114"><span class="linenos">114</span></a>        <span class="p">)</span>
</span><span id="Closures.__init__-115"><a href="#-115"><span class="linenos">115</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">simple_closures_brine</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="Closures.__init__-116"><a href="#-116"><span class="linenos">116</span></a>            <span class="s2">&quot;simple_closures_brine&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">closure_vol_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;uint8&quot;</span>
</span><span id="Closures.__init__-117"><a href="#-117"><span class="linenos">117</span></a>        <span class="p">)</span>
</span><span id="Closures.__init__-118"><a href="#-118"><span class="linenos">118</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">simple_closures_oil_segment_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
</span><span id="Closures.__init__-119"><a href="#-119"><span class="linenos">119</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">simple_closures_gas_segment_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
</span><span id="Closures.__init__-120"><a href="#-120"><span class="linenos">120</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">simple_closures_brine_segment_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
</span><span id="Closures.__init__-121"><a href="#-121"><span class="linenos">121</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_4way_closures_oil</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Closures.__init__-122"><a href="#-122"><span class="linenos">122</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_4way_closures_gas</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Closures.__init__-123"><a href="#-123"><span class="linenos">123</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_4way_closures_brine</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Closures.__init__-124"><a href="#-124"><span class="linenos">124</span></a>
</span><span id="Closures.__init__-125"><a href="#-125"><span class="linenos">125</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">simple_all_closures</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="Closures.__init__-126"><a href="#-126"><span class="linenos">126</span></a>            <span class="s2">&quot;simple_all_closures&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">closure_vol_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;uint8&quot;</span>
</span><span id="Closures.__init__-127"><a href="#-127"><span class="linenos">127</span></a>        <span class="p">)</span>
</span><span id="Closures.__init__-128"><a href="#-128"><span class="linenos">128</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">simple_all_closures_segment_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
</span><span id="Closures.__init__-129"><a href="#-129"><span class="linenos">129</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_4way_all_closures</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Closures.__init__-130"><a href="#-130"><span class="linenos">130</span></a>
</span><span id="Closures.__init__-131"><a href="#-131"><span class="linenos">131</span></a>        <span class="c1"># False closures</span>
</span><span id="Closures.__init__-132"><a href="#-132"><span class="linenos">132</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">false_closures_oil</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="Closures.__init__-133"><a href="#-133"><span class="linenos">133</span></a>            <span class="s2">&quot;false_closures_oil&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">closure_vol_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;uint8&quot;</span>
</span><span id="Closures.__init__-134"><a href="#-134"><span class="linenos">134</span></a>        <span class="p">)</span>
</span><span id="Closures.__init__-135"><a href="#-135"><span class="linenos">135</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">false_closures_gas</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="Closures.__init__-136"><a href="#-136"><span class="linenos">136</span></a>            <span class="s2">&quot;false_closures_gas&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">closure_vol_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;uint8&quot;</span>
</span><span id="Closures.__init__-137"><a href="#-137"><span class="linenos">137</span></a>        <span class="p">)</span>
</span><span id="Closures.__init__-138"><a href="#-138"><span class="linenos">138</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">false_closures_brine</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="Closures.__init__-139"><a href="#-139"><span class="linenos">139</span></a>            <span class="s2">&quot;false_closures_brine&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">closure_vol_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;uint8&quot;</span>
</span><span id="Closures.__init__-140"><a href="#-140"><span class="linenos">140</span></a>        <span class="p">)</span>
</span><span id="Closures.__init__-141"><a href="#-141"><span class="linenos">141</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_false_closures_oil</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Closures.__init__-142"><a href="#-142"><span class="linenos">142</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_false_closures_gas</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Closures.__init__-143"><a href="#-143"><span class="linenos">143</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_false_closures_brine</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Closures.__init__-144"><a href="#-144"><span class="linenos">144</span></a>
</span><span id="Closures.__init__-145"><a href="#-145"><span class="linenos">145</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">false_all_closures</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="Closures.__init__-146"><a href="#-146"><span class="linenos">146</span></a>            <span class="s2">&quot;false_all_closures&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">closure_vol_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;uint8&quot;</span>
</span><span id="Closures.__init__-147"><a href="#-147"><span class="linenos">147</span></a>        <span class="p">)</span>
</span><span id="Closures.__init__-148"><a href="#-148"><span class="linenos">148</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_false_all_closures</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Closures.__init__-149"><a href="#-149"><span class="linenos">149</span></a>
</span><span id="Closures.__init__-150"><a href="#-150"><span class="linenos">150</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">include_salt</span><span class="p">:</span>
</span><span id="Closures.__init__-151"><a href="#-151"><span class="linenos">151</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">salt_closures</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="Closures.__init__-152"><a href="#-152"><span class="linenos">152</span></a>                <span class="s2">&quot;salt_closures&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">closure_vol_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;uint8&quot;</span>
</span><span id="Closures.__init__-153"><a href="#-153"><span class="linenos">153</span></a>            <span class="p">)</span>
</span><span id="Closures.__init__-154"><a href="#-154"><span class="linenos">154</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">wide_salt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="Closures.__init__-155"><a href="#-155"><span class="linenos">155</span></a>                <span class="s2">&quot;wide_salt&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">closure_vol_shape</span>
</span><span id="Closures.__init__-156"><a href="#-156"><span class="linenos">156</span></a>            <span class="p">)</span>
</span><span id="Closures.__init__-157"><a href="#-157"><span class="linenos">157</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">salt_closures_oil</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="Closures.__init__-158"><a href="#-158"><span class="linenos">158</span></a>                <span class="s2">&quot;salt_bounded_closures_oil&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">closure_vol_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;uint8&quot;</span>
</span><span id="Closures.__init__-159"><a href="#-159"><span class="linenos">159</span></a>            <span class="p">)</span>
</span><span id="Closures.__init__-160"><a href="#-160"><span class="linenos">160</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">salt_closures_gas</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="Closures.__init__-161"><a href="#-161"><span class="linenos">161</span></a>                <span class="s2">&quot;salt_bounded_closures_gas&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">closure_vol_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;uint8&quot;</span>
</span><span id="Closures.__init__-162"><a href="#-162"><span class="linenos">162</span></a>            <span class="p">)</span>
</span><span id="Closures.__init__-163"><a href="#-163"><span class="linenos">163</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">salt_closures_brine</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="Closures.__init__-164"><a href="#-164"><span class="linenos">164</span></a>                <span class="s2">&quot;salt_bounded_closures_brine&quot;</span><span class="p">,</span>
</span><span id="Closures.__init__-165"><a href="#-165"><span class="linenos">165</span></a>                <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">closure_vol_shape</span><span class="p">,</span>
</span><span id="Closures.__init__-166"><a href="#-166"><span class="linenos">166</span></a>                <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;uint8&quot;</span><span class="p">,</span>
</span><span id="Closures.__init__-167"><a href="#-167"><span class="linenos">167</span></a>            <span class="p">)</span>
</span><span id="Closures.__init__-168"><a href="#-168"><span class="linenos">168</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">salt_closures_oil_segment_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
</span><span id="Closures.__init__-169"><a href="#-169"><span class="linenos">169</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">salt_closures_gas_segment_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
</span><span id="Closures.__init__-170"><a href="#-170"><span class="linenos">170</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">salt_closures_brine_segment_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
</span><span id="Closures.__init__-171"><a href="#-171"><span class="linenos">171</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">n_salt_closures_oil</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Closures.__init__-172"><a href="#-172"><span class="linenos">172</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">n_salt_closures_gas</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Closures.__init__-173"><a href="#-173"><span class="linenos">173</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">n_salt_closures_brine</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Closures.__init__-174"><a href="#-174"><span class="linenos">174</span></a>
</span><span id="Closures.__init__-175"><a href="#-175"><span class="linenos">175</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">salt_all_closures</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="Closures.__init__-176"><a href="#-176"><span class="linenos">176</span></a>                <span class="s2">&quot;salt_bounded_all_closures&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">closure_vol_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;uint8&quot;</span>
</span><span id="Closures.__init__-177"><a href="#-177"><span class="linenos">177</span></a>            <span class="p">)</span>
</span><span id="Closures.__init__-178"><a href="#-178"><span class="linenos">178</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">salt_all_closures_segment_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
</span><span id="Closures.__init__-179"><a href="#-179"><span class="linenos">179</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">n_salt_all_closures</span> <span class="o">=</span> <span class="mi">0</span>
</span></pre></div>


            <div class="docstring"><p>__init__</p>

<p>Initializer for the Geomodel class.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>parameters</strong> (<a href="Parameters.html">datagenerator.Parameters</a>):
Parameter object storing all model parameters.</li>
<li><strong>depth_maps</strong> (np.ndarray):
A numpy array containing the depth maps.</li>
<li><strong>onlap_horizon_list</strong> (list):
A list of the onlap horizons.</li>
<li><strong>facies</strong> (np.ndarray):
The generated facies.</li>
</ul>
</div>


                            </div>
                            <div id="Closures.create_closure_labels_from_depth_maps" class="classattr">
                                        <input id="Closures.create_closure_labels_from_depth_maps-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">create_closure_labels_from_depth_maps</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">depth_maps</span>, </span><span class="param"><span class="n">depth_maps_infilled</span>, </span><span class="param"><span class="n">max_col_height</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Closures.create_closure_labels_from_depth_maps-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Closures.create_closure_labels_from_depth_maps"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Closures.create_closure_labels_from_depth_maps-181"><a href="#-181"><span class="linenos">181</span></a>    <span class="k">def</span> <span class="nf">create_closure_labels_from_depth_maps</span><span class="p">(</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-182"><a href="#-182"><span class="linenos">182</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">depth_maps</span><span class="p">,</span> <span class="n">depth_maps_infilled</span><span class="p">,</span> <span class="n">max_col_height</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-183"><a href="#-183"><span class="linenos">183</span></a>    <span class="p">):</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-184"><a href="#-184"><span class="linenos">184</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-185"><a href="#-185"><span class="linenos">185</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\t</span><span class="s2">... inside insertClosureLabels3D &quot;</span><span class="p">)</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-186"><a href="#-186"><span class="linenos">186</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-187"><a href="#-187"><span class="linenos">187</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">... depth_maps min </span><span class="si">{</span><span class="n">depth_maps</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, mean </span><span class="si">{</span><span class="n">depth_maps</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">,&quot;</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-188"><a href="#-188"><span class="linenos">188</span></a>                <span class="sa">f</span><span class="s2">&quot; max </span><span class="si">{</span><span class="n">depth_maps</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, cube_shape </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-189"><a href="#-189"><span class="linenos">189</span></a>            <span class="p">)</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-190"><a href="#-190"><span class="linenos">190</span></a>
</span><span id="Closures.create_closure_labels_from_depth_maps-191"><a href="#-191"><span class="linenos">191</span></a>        <span class="c1"># create 3D cube to hold segmentation results</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-192"><a href="#-192"><span class="linenos">192</span></a>        <span class="n">closure_segments</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">faulted_lithology</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="s2">&quot;float32&quot;</span><span class="p">)</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-193"><a href="#-193"><span class="linenos">193</span></a>
</span><span id="Closures.create_closure_labels_from_depth_maps-194"><a href="#-194"><span class="linenos">194</span></a>        <span class="c1"># create grids with grid indices</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-195"><a href="#-195"><span class="linenos">195</span></a>        <span class="n">ii</span><span class="p">,</span> <span class="n">jj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">build_meshgrid</span><span class="p">()</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-196"><a href="#-196"><span class="linenos">196</span></a>
</span><span id="Closures.create_closure_labels_from_depth_maps-197"><a href="#-197"><span class="linenos">197</span></a>        <span class="c1"># loop through horizons in &#39;depth_maps&#39;</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-198"><a href="#-198"><span class="linenos">198</span></a>        <span class="n">voxel_change_count</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-199"><a href="#-199"><span class="linenos">199</span></a>        <span class="n">layers_with_closure</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-200"><a href="#-200"><span class="linenos">200</span></a>
</span><span id="Closures.create_closure_labels_from_depth_maps-201"><a href="#-201"><span class="linenos">201</span></a>        <span class="n">avg_sand_thickness</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-202"><a href="#-202"><span class="linenos">202</span></a>        <span class="n">avg_shale_thickness</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-203"><a href="#-203"><span class="linenos">203</span></a>        <span class="n">avg_unit_thickness</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-204"><a href="#-204"><span class="linenos">204</span></a>        <span class="k">for</span> <span class="n">ihorizon</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">depth_maps</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-205"><a href="#-205"><span class="linenos">205</span></a>            <span class="n">avg_unit_thickness</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-206"><a href="#-206"><span class="linenos">206</span></a>                <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-207"><a href="#-207"><span class="linenos">207</span></a>                    <span class="n">depth_maps_infilled</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">ihorizon</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-208"><a href="#-208"><span class="linenos">208</span></a>                    <span class="o">-</span> <span class="n">depth_maps_infilled</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">ihorizon</span><span class="p">]</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-209"><a href="#-209"><span class="linenos">209</span></a>                <span class="p">)</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-210"><a href="#-210"><span class="linenos">210</span></a>            <span class="p">)</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-211"><a href="#-211"><span class="linenos">211</span></a>
</span><span id="Closures.create_closure_labels_from_depth_maps-212"><a href="#-212"><span class="linenos">212</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">top_lith_facies</span><span class="p">[</span><span class="n">ihorizon</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-213"><a href="#-213"><span class="linenos">213</span></a>                <span class="c1"># If facies is not shale, calculate a closure map for the layer</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-214"><a href="#-214"><span class="linenos">214</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-215"><a href="#-215"><span class="linenos">215</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-216"><a href="#-216"><span class="linenos">216</span></a>                        <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">...closure voxels computation for layer </span><span class="si">{</span><span class="n">ihorizon</span><span class="si">}</span><span class="s2"> in horizon list.&quot;</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-217"><a href="#-217"><span class="linenos">217</span></a>                    <span class="p">)</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-218"><a href="#-218"><span class="linenos">218</span></a>                <span class="n">avg_sand_thickness</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-219"><a href="#-219"><span class="linenos">219</span></a>                    <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-220"><a href="#-220"><span class="linenos">220</span></a>                        <span class="n">depth_maps_infilled</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">ihorizon</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-221"><a href="#-221"><span class="linenos">221</span></a>                        <span class="o">-</span> <span class="n">depth_maps_infilled</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">ihorizon</span><span class="p">]</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-222"><a href="#-222"><span class="linenos">222</span></a>                    <span class="p">)</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-223"><a href="#-223"><span class="linenos">223</span></a>                <span class="p">)</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-224"><a href="#-224"><span class="linenos">224</span></a>                <span class="c1"># compute a closure map</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-225"><a href="#-225"><span class="linenos">225</span></a>                <span class="c1"># - identical to top structure map when not in closure, &#39;max flooding&#39; depth when in closure</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-226"><a href="#-226"><span class="linenos">226</span></a>                <span class="c1"># - use thicknesses converted to samples instead of ft or ms</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-227"><a href="#-227"><span class="linenos">227</span></a>                <span class="c1"># - assumes that fault intersections are inserted in input map with value of 0.</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-228"><a href="#-228"><span class="linenos">228</span></a>                <span class="c1"># - assumes that input map values represent depth (i.e., bigger values are deeper)</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-229"><a href="#-229"><span class="linenos">229</span></a>                <span class="n">top_structure_depth_map</span> <span class="o">=</span> <span class="n">depth_maps</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">ihorizon</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-230"><a href="#-230"><span class="linenos">230</span></a>                <span class="n">top_structure_depth_map</span><span class="p">[</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-231"><a href="#-231"><span class="linenos">231</span></a>                    <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">top_structure_depth_map</span><span class="p">)</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-232"><a href="#-232"><span class="linenos">232</span></a>                <span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>  <span class="c1"># replace nans with 0.</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-233"><a href="#-233"><span class="linenos">233</span></a>                <span class="n">top_structure_depth_map</span> <span class="o">/=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">digi</span><span class="p">)</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-234"><a href="#-234"><span class="linenos">234</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">partial_voxels</span><span class="p">:</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-235"><a href="#-235"><span class="linenos">235</span></a>                    <span class="n">top_structure_depth_map</span> <span class="o">-=</span> <span class="p">(</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-236"><a href="#-236"><span class="linenos">236</span></a>                        <span class="mf">1.0</span>  <span class="c1"># account for voxels partially in layer</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-237"><a href="#-237"><span class="linenos">237</span></a>                    <span class="p">)</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-238"><a href="#-238"><span class="linenos">238</span></a>                <span class="n">base_structure_depth_map</span> <span class="o">=</span> <span class="n">depth_maps_infilled</span><span class="p">[</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-239"><a href="#-239"><span class="linenos">239</span></a>                    <span class="p">:,</span> <span class="p">:,</span> <span class="n">ihorizon</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-240"><a href="#-240"><span class="linenos">240</span></a>                <span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-241"><a href="#-241"><span class="linenos">241</span></a>                <span class="n">base_structure_depth_map</span><span class="p">[</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-242"><a href="#-242"><span class="linenos">242</span></a>                    <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">top_structure_depth_map</span><span class="p">)</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-243"><a href="#-243"><span class="linenos">243</span></a>                <span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>  <span class="c1"># replace nans with 0.</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-244"><a href="#-244"><span class="linenos">244</span></a>                <span class="n">base_structure_depth_map</span> <span class="o">/=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">digi</span><span class="p">)</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-245"><a href="#-245"><span class="linenos">245</span></a>                <span class="nb">print</span><span class="p">(</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-246"><a href="#-246"><span class="linenos">246</span></a>                    <span class="s2">&quot; ...inside create_closure_labels_from_depth_maps... ihorizon, self.top_lith_facies[ihorizon] = &quot;</span><span class="p">,</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-247"><a href="#-247"><span class="linenos">247</span></a>                    <span class="n">ihorizon</span><span class="p">,</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-248"><a href="#-248"><span class="linenos">248</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">top_lith_facies</span><span class="p">[</span><span class="n">ihorizon</span><span class="p">],</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-249"><a href="#-249"><span class="linenos">249</span></a>                <span class="p">)</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-250"><a href="#-250"><span class="linenos">250</span></a>                <span class="c1"># if there is non-zero thickness between top/base closure</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-251"><a href="#-251"><span class="linenos">251</span></a>                <span class="k">if</span> <span class="n">top_structure_depth_map</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">!=</span> <span class="n">top_structure_depth_map</span><span class="o">.</span><span class="n">max</span><span class="p">():</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-252"><a href="#-252"><span class="linenos">252</span></a>                    <span class="n">max_column</span> <span class="o">=</span> <span class="n">max_col_height</span><span class="p">[</span><span class="n">ihorizon</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">digi</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-253"><a href="#-253"><span class="linenos">253</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-254"><a href="#-254"><span class="linenos">254</span></a>                        <span class="nb">print</span><span class="p">(</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-255"><a href="#-255"><span class="linenos">255</span></a>                            <span class="sa">f</span><span class="s2">&quot;   ...avg depth for layer </span><span class="si">{</span><span class="n">ihorizon</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">,</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-256"><a href="#-256"><span class="linenos">256</span></a>                            <span class="n">top_structure_depth_map</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-257"><a href="#-257"><span class="linenos">257</span></a>                        <span class="p">)</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-258"><a href="#-258"><span class="linenos">258</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-259"><a href="#-259"><span class="linenos">259</span></a>                        <span class="nb">print</span><span class="p">(</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-260"><a href="#-260"><span class="linenos">260</span></a>                            <span class="sa">f</span><span class="s2">&quot;   ...maximum column height for layer </span><span class="si">{</span><span class="n">ihorizon</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">,</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-261"><a href="#-261"><span class="linenos">261</span></a>                            <span class="n">max_column</span><span class="p">,</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-262"><a href="#-262"><span class="linenos">262</span></a>                        <span class="p">)</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-263"><a href="#-263"><span class="linenos">263</span></a>
</span><span id="Closures.create_closure_labels_from_depth_maps-264"><a href="#-264"><span class="linenos">264</span></a>                    <span class="k">if</span> <span class="n">ihorizon</span> <span class="o">==</span> <span class="mi">27000</span> <span class="ow">or</span> <span class="n">ihorizon</span> <span class="o">==</span> <span class="mi">1000</span><span class="p">:</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-265"><a href="#-265"><span class="linenos">265</span></a>                        <span class="n">closure_depth_map</span> <span class="o">=</span> <span class="n">_flood_fill</span><span class="p">(</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-266"><a href="#-266"><span class="linenos">266</span></a>                            <span class="n">top_structure_depth_map</span><span class="p">,</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-267"><a href="#-267"><span class="linenos">267</span></a>                            <span class="n">max_column_height</span><span class="o">=</span><span class="n">max_column</span><span class="p">,</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-268"><a href="#-268"><span class="linenos">268</span></a>                            <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-269"><a href="#-269"><span class="linenos">269</span></a>                            <span class="n">debug</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-270"><a href="#-270"><span class="linenos">270</span></a>                        <span class="p">)</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-271"><a href="#-271"><span class="linenos">271</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-272"><a href="#-272"><span class="linenos">272</span></a>                        <span class="n">closure_depth_map</span> <span class="o">=</span> <span class="n">_flood_fill</span><span class="p">(</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-273"><a href="#-273"><span class="linenos">273</span></a>                            <span class="n">top_structure_depth_map</span><span class="p">,</span> <span class="n">max_column_height</span><span class="o">=</span><span class="n">max_column</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-274"><a href="#-274"><span class="linenos">274</span></a>                        <span class="p">)</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-275"><a href="#-275"><span class="linenos">275</span></a>                    <span class="n">closure_depth_map</span><span class="p">[</span><span class="n">closure_depth_map</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">top_structure_depth_map</span><span class="p">[</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-276"><a href="#-276"><span class="linenos">276</span></a>                        <span class="n">closure_depth_map</span> <span class="o">==</span> <span class="mi">0</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-277"><a href="#-277"><span class="linenos">277</span></a>                    <span class="p">]</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-278"><a href="#-278"><span class="linenos">278</span></a>                    <span class="n">closure_depth_map</span><span class="p">[</span><span class="n">closure_depth_map</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">top_structure_depth_map</span><span class="p">[</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-279"><a href="#-279"><span class="linenos">279</span></a>                        <span class="n">closure_depth_map</span> <span class="o">==</span> <span class="mi">1</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-280"><a href="#-280"><span class="linenos">280</span></a>                    <span class="p">]</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-281"><a href="#-281"><span class="linenos">281</span></a>                    <span class="n">closure_depth_map</span><span class="p">[</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-282"><a href="#-282"><span class="linenos">282</span></a>                        <span class="n">closure_depth_map</span> <span class="o">==</span> <span class="mf">1e5</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-283"><a href="#-283"><span class="linenos">283</span></a>                    <span class="p">]</span> <span class="o">=</span> <span class="n">top_structure_depth_map</span><span class="p">[</span><span class="n">closure_depth_map</span> <span class="o">==</span> <span class="mf">1e5</span><span class="p">]</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-284"><a href="#-284"><span class="linenos">284</span></a>                    <span class="c1"># Select the maximum value between the top sand map and the flood-filled closure map</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-285"><a href="#-285"><span class="linenos">285</span></a>                    <span class="n">closure_depth_map</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-286"><a href="#-286"><span class="linenos">286</span></a>                        <span class="n">np</span><span class="o">.</span><span class="n">dstack</span><span class="p">((</span><span class="n">closure_depth_map</span><span class="p">,</span> <span class="n">top_structure_depth_map</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-287"><a href="#-287"><span class="linenos">287</span></a>                    <span class="p">)</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-288"><a href="#-288"><span class="linenos">288</span></a>                    <span class="n">closure_depth_map</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-289"><a href="#-289"><span class="linenos">289</span></a>                        <span class="n">np</span><span class="o">.</span><span class="n">dstack</span><span class="p">((</span><span class="n">closure_depth_map</span><span class="p">,</span> <span class="n">base_structure_depth_map</span><span class="p">)),</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-290"><a href="#-290"><span class="linenos">290</span></a>                        <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-291"><a href="#-291"><span class="linenos">291</span></a>                    <span class="p">)</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-292"><a href="#-292"><span class="linenos">292</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-293"><a href="#-293"><span class="linenos">293</span></a>                        <span class="nb">print</span><span class="p">(</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-294"><a href="#-294"><span class="linenos">294</span></a>                            <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">    ... layer </span><span class="si">{</span><span class="n">ihorizon</span><span class="si">}</span><span class="s2">,&quot;</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-295"><a href="#-295"><span class="linenos">295</span></a>                            <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n\t</span><span class="s2">top structure map min, max </span><span class="si">{</span><span class="n">top_structure_depth_map</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">,&quot;</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-296"><a href="#-296"><span class="linenos">296</span></a>                            <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">top_structure_depth_map</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="se">\n\t</span><span class="s2">closure_depth_map min, max&quot;</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-297"><a href="#-297"><span class="linenos">297</span></a>                            <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">closure_depth_map</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">closure_depth_map</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-298"><a href="#-298"><span class="linenos">298</span></a>                        <span class="p">)</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-299"><a href="#-299"><span class="linenos">299</span></a>                    <span class="n">closure_thickness</span> <span class="o">=</span> <span class="n">closure_depth_map</span> <span class="o">-</span> <span class="n">top_structure_depth_map</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-300"><a href="#-300"><span class="linenos">300</span></a>                    <span class="n">closure_thickness_no_nan</span> <span class="o">=</span> <span class="n">closure_thickness</span><span class="p">[</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-301"><a href="#-301"><span class="linenos">301</span></a>                        <span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">closure_thickness</span><span class="p">)</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-302"><a href="#-302"><span class="linenos">302</span></a>                    <span class="p">]</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-303"><a href="#-303"><span class="linenos">303</span></a>                    <span class="n">max_closure</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">closure_thickness_no_nan</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="mi">0</span><span class="p">))</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-304"><a href="#-304"><span class="linenos">304</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-305"><a href="#-305"><span class="linenos">305</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    ... layer </span><span class="si">{</span><span class="n">ihorizon</span><span class="si">}</span><span class="s2">, max_closure </span><span class="si">{</span><span class="n">max_closure</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-306"><a href="#-306"><span class="linenos">306</span></a>
</span><span id="Closures.create_closure_labels_from_depth_maps-307"><a href="#-307"><span class="linenos">307</span></a>                    <span class="c1"># locate 3D zone in closure after checking that closures exist for this horizon</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-308"><a href="#-308"><span class="linenos">308</span></a>                    <span class="c1"># if False in (top_structure_depth_map == closure_depth_map):</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-309"><a href="#-309"><span class="linenos">309</span></a>                    <span class="k">if</span> <span class="n">max_closure</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-310"><a href="#-310"><span class="linenos">310</span></a>                        <span class="c1"># locate voxels anywhere in layer where top_structure_depth_map &lt; closure_depth_map</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-311"><a href="#-311"><span class="linenos">311</span></a>                        <span class="c1"># put label in cube between top_structure_depth_map and closure_depth_map</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-312"><a href="#-312"><span class="linenos">312</span></a>                        <span class="n">top_structure_depth_map_integer</span> <span class="o">=</span> <span class="n">top_structure_depth_map</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-313"><a href="#-313"><span class="linenos">313</span></a>                        <span class="n">closure_depth_map_integer</span> <span class="o">=</span> <span class="n">closure_depth_map</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-314"><a href="#-314"><span class="linenos">314</span></a>
</span><span id="Closures.create_closure_labels_from_depth_maps-315"><a href="#-315"><span class="linenos">315</span></a>                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-316"><a href="#-316"><span class="linenos">316</span></a>                            <span class="n">closure_map_min</span> <span class="o">=</span> <span class="n">closure_depth_map_integer</span><span class="p">[</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-317"><a href="#-317"><span class="linenos">317</span></a>                                <span class="n">closure_depth_map_integer</span> <span class="o">&gt;</span> <span class="mf">0.1</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-318"><a href="#-318"><span class="linenos">318</span></a>                            <span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-319"><a href="#-319"><span class="linenos">319</span></a>                            <span class="n">closure_map_max</span> <span class="o">=</span> <span class="n">closure_depth_map_integer</span><span class="p">[</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-320"><a href="#-320"><span class="linenos">320</span></a>                                <span class="n">closure_depth_map_integer</span> <span class="o">&gt;</span> <span class="mf">0.1</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-321"><a href="#-321"><span class="linenos">321</span></a>                            <span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-322"><a href="#-322"><span class="linenos">322</span></a>                            <span class="nb">print</span><span class="p">(</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-323"><a href="#-323"><span class="linenos">323</span></a>                                <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">... (2) layer: </span><span class="si">{</span><span class="n">ihorizon</span><span class="si">}</span><span class="s2">, max_closure; </span><span class="si">{</span><span class="n">max_closure</span><span class="si">}</span><span class="s2">, top structure map min, &quot;</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-324"><a href="#-324"><span class="linenos">324</span></a>                                <span class="sa">f</span><span class="s2">&quot;max: </span><span class="si">{</span><span class="n">top_structure_depth_map</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">top_structure_depth_map_integer</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">}</span><span class="s2">,&quot;</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-325"><a href="#-325"><span class="linenos">325</span></a>                                <span class="sa">f</span><span class="s2">&quot; closure map min, max: </span><span class="si">{</span><span class="n">closure_map_min</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">closure_map_max</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-326"><a href="#-326"><span class="linenos">326</span></a>                            <span class="p">)</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-327"><a href="#-327"><span class="linenos">327</span></a>
</span><span id="Closures.create_closure_labels_from_depth_maps-328"><a href="#-328"><span class="linenos">328</span></a>                        <span class="n">slices_with_substitution</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-329"><a href="#-329"><span class="linenos">329</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    ... max_closure: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">max_closure</span><span class="p">))</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-330"><a href="#-330"><span class="linenos">330</span></a>                        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-331"><a href="#-331"><span class="linenos">331</span></a>                            <span class="n">max_closure</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-332"><a href="#-332"><span class="linenos">332</span></a>                        <span class="p">):</span>  <span class="c1"># add one more sample than seemingly needed for round-off</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-333"><a href="#-333"><span class="linenos">333</span></a>                            <span class="c1"># Subtract 2 from the closure cube shape since adding one later</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-334"><a href="#-334"><span class="linenos">334</span></a>                            <span class="n">horizon_slice</span> <span class="o">=</span> <span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="n">top_structure_depth_map</span><span class="p">)</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-335"><a href="#-335"><span class="linenos">335</span></a>                                <span class="mi">0</span><span class="p">,</span> <span class="n">closure_segments</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="mi">2</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-336"><a href="#-336"><span class="linenos">336</span></a>                            <span class="p">)</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-337"><a href="#-337"><span class="linenos">337</span></a>                            <span class="n">sublayer_kk</span> <span class="o">=</span> <span class="n">horizon_slice</span><span class="p">[</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-338"><a href="#-338"><span class="linenos">338</span></a>                                <span class="n">horizon_slice</span> <span class="o">&lt;</span> <span class="n">closure_depth_map</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;int&quot;</span><span class="p">)</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-339"><a href="#-339"><span class="linenos">339</span></a>                            <span class="p">]</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-340"><a href="#-340"><span class="linenos">340</span></a>                            <span class="n">sublayer_ii</span> <span class="o">=</span> <span class="n">ii</span><span class="p">[</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-341"><a href="#-341"><span class="linenos">341</span></a>                                <span class="n">horizon_slice</span> <span class="o">&lt;</span> <span class="n">closure_depth_map</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;int&quot;</span><span class="p">)</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-342"><a href="#-342"><span class="linenos">342</span></a>                            <span class="p">]</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-343"><a href="#-343"><span class="linenos">343</span></a>                            <span class="n">sublayer_jj</span> <span class="o">=</span> <span class="n">jj</span><span class="p">[</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-344"><a href="#-344"><span class="linenos">344</span></a>                                <span class="n">horizon_slice</span> <span class="o">&lt;</span> <span class="n">closure_depth_map</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;int&quot;</span><span class="p">)</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-345"><a href="#-345"><span class="linenos">345</span></a>                            <span class="p">]</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-346"><a href="#-346"><span class="linenos">346</span></a>
</span><span id="Closures.create_closure_labels_from_depth_maps-347"><a href="#-347"><span class="linenos">347</span></a>                            <span class="k">if</span> <span class="n">sublayer_ii</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-348"><a href="#-348"><span class="linenos">348</span></a>                                <span class="n">slices_with_substitution</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-349"><a href="#-349"><span class="linenos">349</span></a>
</span><span id="Closures.create_closure_labels_from_depth_maps-350"><a href="#-350"><span class="linenos">350</span></a>                                <span class="n">i_indices</span> <span class="o">=</span> <span class="n">sublayer_ii</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-351"><a href="#-351"><span class="linenos">351</span></a>                                <span class="n">j_indices</span> <span class="o">=</span> <span class="n">sublayer_jj</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-352"><a href="#-352"><span class="linenos">352</span></a>                                <span class="n">k_indices</span> <span class="o">=</span> <span class="n">sublayer_kk</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-353"><a href="#-353"><span class="linenos">353</span></a>
</span><span id="Closures.create_closure_labels_from_depth_maps-354"><a href="#-354"><span class="linenos">354</span></a>                                <span class="k">try</span><span class="p">:</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-355"><a href="#-355"><span class="linenos">355</span></a>                                    <span class="n">closure_segments</span><span class="p">[</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-356"><a href="#-356"><span class="linenos">356</span></a>                                        <span class="n">i_indices</span><span class="p">,</span> <span class="n">j_indices</span><span class="p">,</span> <span class="n">k_indices</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;int&quot;</span><span class="p">)</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-357"><a href="#-357"><span class="linenos">357</span></a>                                    <span class="p">]</span> <span class="o">+=</span> <span class="mf">1.0</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-358"><a href="#-358"><span class="linenos">358</span></a>                                    <span class="n">voxel_change_count</span><span class="p">[</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-359"><a href="#-359"><span class="linenos">359</span></a>                                        <span class="n">i_indices</span><span class="p">,</span> <span class="n">j_indices</span><span class="p">,</span> <span class="n">k_indices</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;int&quot;</span><span class="p">)</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-360"><a href="#-360"><span class="linenos">360</span></a>                                    <span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-361"><a href="#-361"><span class="linenos">361</span></a>                                <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-362"><a href="#-362"><span class="linenos">362</span></a>                                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Index is out of bounds.&quot;</span><span class="p">)</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-363"><a href="#-363"><span class="linenos">363</span></a>                                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">closure_segments: </span><span class="si">{</span><span class="n">closure_segments</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-364"><a href="#-364"><span class="linenos">364</span></a>                                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">voxel_change_count: </span><span class="si">{</span><span class="n">voxel_change_count</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-365"><a href="#-365"><span class="linenos">365</span></a>                                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">i_indices: </span><span class="si">{</span><span class="n">i_indices</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-366"><a href="#-366"><span class="linenos">366</span></a>                                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">j_indices: </span><span class="si">{</span><span class="n">j_indices</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-367"><a href="#-367"><span class="linenos">367</span></a>                                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">k_indices: </span><span class="si">{</span><span class="n">k_indices</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;int&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-368"><a href="#-368"><span class="linenos">368</span></a>                                    <span class="k">pass</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-369"><a href="#-369"><span class="linenos">369</span></a>
</span><span id="Closures.create_closure_labels_from_depth_maps-370"><a href="#-370"><span class="linenos">370</span></a>                        <span class="k">if</span> <span class="n">slices_with_substitution</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-371"><a href="#-371"><span class="linenos">371</span></a>                            <span class="n">layers_with_closure</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-372"><a href="#-372"><span class="linenos">372</span></a>
</span><span id="Closures.create_closure_labels_from_depth_maps-373"><a href="#-373"><span class="linenos">373</span></a>                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-374"><a href="#-374"><span class="linenos">374</span></a>                            <span class="nb">print</span><span class="p">(</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-375"><a href="#-375"><span class="linenos">375</span></a>                                <span class="s2">&quot;    ... finished putting closures in closures_segments for layer ...&quot;</span><span class="p">,</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-376"><a href="#-376"><span class="linenos">376</span></a>                                <span class="n">ihorizon</span><span class="p">,</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-377"><a href="#-377"><span class="linenos">377</span></a>                            <span class="p">)</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-378"><a href="#-378"><span class="linenos">378</span></a>
</span><span id="Closures.create_closure_labels_from_depth_maps-379"><a href="#-379"><span class="linenos">379</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-380"><a href="#-380"><span class="linenos">380</span></a>                        <span class="k">continue</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-381"><a href="#-381"><span class="linenos">381</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-382"><a href="#-382"><span class="linenos">382</span></a>                <span class="c1"># Calculate shale unit thicknesses</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-383"><a href="#-383"><span class="linenos">383</span></a>                <span class="n">avg_shale_thickness</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-384"><a href="#-384"><span class="linenos">384</span></a>                    <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-385"><a href="#-385"><span class="linenos">385</span></a>                        <span class="n">depth_maps_infilled</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">ihorizon</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-386"><a href="#-386"><span class="linenos">386</span></a>                        <span class="o">-</span> <span class="n">depth_maps_infilled</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">ihorizon</span><span class="p">]</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-387"><a href="#-387"><span class="linenos">387</span></a>                    <span class="p">)</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-388"><a href="#-388"><span class="linenos">388</span></a>                <span class="p">)</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-389"><a href="#-389"><span class="linenos">389</span></a>
</span><span id="Closures.create_closure_labels_from_depth_maps-390"><a href="#-390"><span class="linenos">390</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">avg_sand_thickness</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-391"><a href="#-391"><span class="linenos">391</span></a>            <span class="n">avg_sand_thickness</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-392"><a href="#-392"><span class="linenos">392</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-393"><a href="#-393"><span class="linenos">393</span></a>            <span class="sa">f</span><span class="s2">&quot;Sand Unit Thickness (m): mean: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">avg_sand_thickness</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, &quot;</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-394"><a href="#-394"><span class="linenos">394</span></a>            <span class="sa">f</span><span class="s2">&quot;std: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">avg_sand_thickness</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, min: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">avg_sand_thickness</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, &quot;</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-395"><a href="#-395"><span class="linenos">395</span></a>            <span class="sa">f</span><span class="s2">&quot;max: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">avg_sand_thickness</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-396"><a href="#-396"><span class="linenos">396</span></a>        <span class="p">)</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-397"><a href="#-397"><span class="linenos">397</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-398"><a href="#-398"><span class="linenos">398</span></a>            <span class="sa">f</span><span class="s2">&quot;Shale Unit Thickness (m): mean: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">avg_shale_thickness</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, &quot;</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-399"><a href="#-399"><span class="linenos">399</span></a>            <span class="sa">f</span><span class="s2">&quot;std: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">avg_shale_thickness</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, min: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">avg_shale_thickness</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, &quot;</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-400"><a href="#-400"><span class="linenos">400</span></a>            <span class="sa">f</span><span class="s2">&quot;max: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">avg_shale_thickness</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-401"><a href="#-401"><span class="linenos">401</span></a>        <span class="p">)</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-402"><a href="#-402"><span class="linenos">402</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-403"><a href="#-403"><span class="linenos">403</span></a>            <span class="sa">f</span><span class="s2">&quot;Overall Unit Thickness (m): mean: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">avg_unit_thickness</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, &quot;</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-404"><a href="#-404"><span class="linenos">404</span></a>            <span class="sa">f</span><span class="s2">&quot;std: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">avg_unit_thickness</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, min: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">avg_unit_thickness</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, &quot;</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-405"><a href="#-405"><span class="linenos">405</span></a>            <span class="sa">f</span><span class="s2">&quot;max: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">avg_unit_thickness</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-406"><a href="#-406"><span class="linenos">406</span></a>        <span class="p">)</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-407"><a href="#-407"><span class="linenos">407</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-408"><a href="#-408"><span class="linenos">408</span></a>            <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-409"><a href="#-409"><span class="linenos">409</span></a>            <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-410"><a href="#-410"><span class="linenos">410</span></a>            <span class="n">subkey</span><span class="o">=</span><span class="s2">&quot;sand_unit_thickness_combined_mean&quot;</span><span class="p">,</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-411"><a href="#-411"><span class="linenos">411</span></a>            <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">avg_sand_thickness</span><span class="p">),</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-412"><a href="#-412"><span class="linenos">412</span></a>        <span class="p">)</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-413"><a href="#-413"><span class="linenos">413</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-414"><a href="#-414"><span class="linenos">414</span></a>            <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-415"><a href="#-415"><span class="linenos">415</span></a>            <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-416"><a href="#-416"><span class="linenos">416</span></a>            <span class="n">subkey</span><span class="o">=</span><span class="s2">&quot;sand_unit_thickness_combined_std&quot;</span><span class="p">,</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-417"><a href="#-417"><span class="linenos">417</span></a>            <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">avg_sand_thickness</span><span class="p">),</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-418"><a href="#-418"><span class="linenos">418</span></a>        <span class="p">)</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-419"><a href="#-419"><span class="linenos">419</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-420"><a href="#-420"><span class="linenos">420</span></a>            <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-421"><a href="#-421"><span class="linenos">421</span></a>            <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-422"><a href="#-422"><span class="linenos">422</span></a>            <span class="n">subkey</span><span class="o">=</span><span class="s2">&quot;sand_unit_thickness_combined_min&quot;</span><span class="p">,</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-423"><a href="#-423"><span class="linenos">423</span></a>            <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">avg_sand_thickness</span><span class="p">),</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-424"><a href="#-424"><span class="linenos">424</span></a>        <span class="p">)</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-425"><a href="#-425"><span class="linenos">425</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-426"><a href="#-426"><span class="linenos">426</span></a>            <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-427"><a href="#-427"><span class="linenos">427</span></a>            <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-428"><a href="#-428"><span class="linenos">428</span></a>            <span class="n">subkey</span><span class="o">=</span><span class="s2">&quot;sand_unit_thickness_combined_max&quot;</span><span class="p">,</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-429"><a href="#-429"><span class="linenos">429</span></a>            <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">avg_sand_thickness</span><span class="p">),</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-430"><a href="#-430"><span class="linenos">430</span></a>        <span class="p">)</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-431"><a href="#-431"><span class="linenos">431</span></a>        <span class="c1">#</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-432"><a href="#-432"><span class="linenos">432</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-433"><a href="#-433"><span class="linenos">433</span></a>            <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-434"><a href="#-434"><span class="linenos">434</span></a>            <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-435"><a href="#-435"><span class="linenos">435</span></a>            <span class="n">subkey</span><span class="o">=</span><span class="s2">&quot;shale_unit_thickness_combined_mean&quot;</span><span class="p">,</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-436"><a href="#-436"><span class="linenos">436</span></a>            <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">avg_shale_thickness</span><span class="p">),</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-437"><a href="#-437"><span class="linenos">437</span></a>        <span class="p">)</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-438"><a href="#-438"><span class="linenos">438</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-439"><a href="#-439"><span class="linenos">439</span></a>            <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-440"><a href="#-440"><span class="linenos">440</span></a>            <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-441"><a href="#-441"><span class="linenos">441</span></a>            <span class="n">subkey</span><span class="o">=</span><span class="s2">&quot;shale_unit_thickness_combined_std&quot;</span><span class="p">,</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-442"><a href="#-442"><span class="linenos">442</span></a>            <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">avg_shale_thickness</span><span class="p">),</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-443"><a href="#-443"><span class="linenos">443</span></a>        <span class="p">)</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-444"><a href="#-444"><span class="linenos">444</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-445"><a href="#-445"><span class="linenos">445</span></a>            <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-446"><a href="#-446"><span class="linenos">446</span></a>            <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-447"><a href="#-447"><span class="linenos">447</span></a>            <span class="n">subkey</span><span class="o">=</span><span class="s2">&quot;shale_unit_thickness_combined_min&quot;</span><span class="p">,</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-448"><a href="#-448"><span class="linenos">448</span></a>            <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">avg_shale_thickness</span><span class="p">),</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-449"><a href="#-449"><span class="linenos">449</span></a>        <span class="p">)</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-450"><a href="#-450"><span class="linenos">450</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-451"><a href="#-451"><span class="linenos">451</span></a>            <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-452"><a href="#-452"><span class="linenos">452</span></a>            <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-453"><a href="#-453"><span class="linenos">453</span></a>            <span class="n">subkey</span><span class="o">=</span><span class="s2">&quot;shale_unit_thickness_combined_max&quot;</span><span class="p">,</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-454"><a href="#-454"><span class="linenos">454</span></a>            <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">avg_shale_thickness</span><span class="p">),</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-455"><a href="#-455"><span class="linenos">455</span></a>        <span class="p">)</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-456"><a href="#-456"><span class="linenos">456</span></a>
</span><span id="Closures.create_closure_labels_from_depth_maps-457"><a href="#-457"><span class="linenos">457</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-458"><a href="#-458"><span class="linenos">458</span></a>            <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-459"><a href="#-459"><span class="linenos">459</span></a>            <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-460"><a href="#-460"><span class="linenos">460</span></a>            <span class="n">subkey</span><span class="o">=</span><span class="s2">&quot;overall_unit_thickness_combined_mean&quot;</span><span class="p">,</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-461"><a href="#-461"><span class="linenos">461</span></a>            <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">avg_unit_thickness</span><span class="p">),</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-462"><a href="#-462"><span class="linenos">462</span></a>        <span class="p">)</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-463"><a href="#-463"><span class="linenos">463</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-464"><a href="#-464"><span class="linenos">464</span></a>            <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-465"><a href="#-465"><span class="linenos">465</span></a>            <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-466"><a href="#-466"><span class="linenos">466</span></a>            <span class="n">subkey</span><span class="o">=</span><span class="s2">&quot;overall_unit_thickness_combined_std&quot;</span><span class="p">,</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-467"><a href="#-467"><span class="linenos">467</span></a>            <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">avg_unit_thickness</span><span class="p">),</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-468"><a href="#-468"><span class="linenos">468</span></a>        <span class="p">)</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-469"><a href="#-469"><span class="linenos">469</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-470"><a href="#-470"><span class="linenos">470</span></a>            <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-471"><a href="#-471"><span class="linenos">471</span></a>            <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-472"><a href="#-472"><span class="linenos">472</span></a>            <span class="n">subkey</span><span class="o">=</span><span class="s2">&quot;overall_unit_thickness_combined_min&quot;</span><span class="p">,</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-473"><a href="#-473"><span class="linenos">473</span></a>            <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">avg_unit_thickness</span><span class="p">),</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-474"><a href="#-474"><span class="linenos">474</span></a>        <span class="p">)</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-475"><a href="#-475"><span class="linenos">475</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-476"><a href="#-476"><span class="linenos">476</span></a>            <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-477"><a href="#-477"><span class="linenos">477</span></a>            <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-478"><a href="#-478"><span class="linenos">478</span></a>            <span class="n">subkey</span><span class="o">=</span><span class="s2">&quot;overall_unit_thickness_combined_max&quot;</span><span class="p">,</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-479"><a href="#-479"><span class="linenos">479</span></a>            <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">avg_unit_thickness</span><span class="p">),</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-480"><a href="#-480"><span class="linenos">480</span></a>        <span class="p">)</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-481"><a href="#-481"><span class="linenos">481</span></a>
</span><span id="Closures.create_closure_labels_from_depth_maps-482"><a href="#-482"><span class="linenos">482</span></a>        <span class="n">non_zero_pixels</span> <span class="o">=</span> <span class="n">closure_segments</span><span class="p">[</span><span class="n">closure_segments</span> <span class="o">!=</span> <span class="mf">0.0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-483"><a href="#-483"><span class="linenos">483</span></a>        <span class="n">pct_non_zero</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">non_zero_pixels</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-484"><a href="#-484"><span class="linenos">484</span></a>            <span class="n">closure_segments</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-485"><a href="#-485"><span class="linenos">485</span></a>            <span class="o">*</span> <span class="n">closure_segments</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-486"><a href="#-486"><span class="linenos">486</span></a>            <span class="o">*</span> <span class="n">closure_segments</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-487"><a href="#-487"><span class="linenos">487</span></a>        <span class="p">)</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-488"><a href="#-488"><span class="linenos">488</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-489"><a href="#-489"><span class="linenos">489</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-490"><a href="#-490"><span class="linenos">490</span></a>                <span class="s2">&quot;    ...closure_segments min </span><span class="si">{}</span><span class="s2">, mean </span><span class="si">{}</span><span class="s2">, max </span><span class="si">{}</span><span class="s2">, % non-zero </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-491"><a href="#-491"><span class="linenos">491</span></a>                    <span class="n">closure_segments</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-492"><a href="#-492"><span class="linenos">492</span></a>                    <span class="n">closure_segments</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-493"><a href="#-493"><span class="linenos">493</span></a>                    <span class="n">closure_segments</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-494"><a href="#-494"><span class="linenos">494</span></a>                    <span class="n">pct_non_zero</span><span class="p">,</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-495"><a href="#-495"><span class="linenos">495</span></a>                <span class="p">)</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-496"><a href="#-496"><span class="linenos">496</span></a>            <span class="p">)</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-497"><a href="#-497"><span class="linenos">497</span></a>
</span><span id="Closures.create_closure_labels_from_depth_maps-498"><a href="#-498"><span class="linenos">498</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">... layers_with_closure </span><span class="si">{</span><span class="n">layers_with_closure</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-499"><a href="#-499"><span class="linenos">499</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">... finished putting closures in closure_segments ...</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-500"><a href="#-500"><span class="linenos">500</span></a>
</span><span id="Closures.create_closure_labels_from_depth_maps-501"><a href="#-501"><span class="linenos">501</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-502"><a href="#-502"><span class="linenos">502</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-503"><a href="#-503"><span class="linenos">503</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">   ...closure segments created. min: </span><span class="si">{</span><span class="n">closure_segments</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="si">}</span><span class="s2">, &quot;</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-504"><a href="#-504"><span class="linenos">504</span></a>                <span class="sa">f</span><span class="s2">&quot;mean: </span><span class="si">{</span><span class="n">closure_segments</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, max: </span><span class="si">{</span><span class="n">closure_segments</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-505"><a href="#-505"><span class="linenos">505</span></a>                <span class="sa">f</span><span class="s2">&quot; voxel count: </span><span class="si">{</span><span class="n">closure_segments</span><span class="p">[</span><span class="n">closure_segments</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-506"><a href="#-506"><span class="linenos">506</span></a>            <span class="p">)</span>
</span><span id="Closures.create_closure_labels_from_depth_maps-507"><a href="#-507"><span class="linenos">507</span></a>
</span><span id="Closures.create_closure_labels_from_depth_maps-508"><a href="#-508"><span class="linenos">508</span></a>        <span class="k">return</span> <span class="n">closure_segments</span>
</span></pre></div>


    

                            </div>
                            <div id="Closures.create_closure_labels_from_all_depth_maps" class="classattr">
                                        <input id="Closures.create_closure_labels_from_all_depth_maps-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">create_closure_labels_from_all_depth_maps</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">depth_maps</span>, </span><span class="param"><span class="n">depth_maps_infilled</span>, </span><span class="param"><span class="n">max_col_height</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Closures.create_closure_labels_from_all_depth_maps-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Closures.create_closure_labels_from_all_depth_maps"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Closures.create_closure_labels_from_all_depth_maps-510"><a href="#-510"><span class="linenos">510</span></a>    <span class="k">def</span> <span class="nf">create_closure_labels_from_all_depth_maps</span><span class="p">(</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-511"><a href="#-511"><span class="linenos">511</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">depth_maps</span><span class="p">,</span> <span class="n">depth_maps_infilled</span><span class="p">,</span> <span class="n">max_col_height</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-512"><a href="#-512"><span class="linenos">512</span></a>    <span class="p">):</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-513"><a href="#-513"><span class="linenos">513</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-514"><a href="#-514"><span class="linenos">514</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\t</span><span class="s2">... inside insertClosureLabels3D &quot;</span><span class="p">)</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-515"><a href="#-515"><span class="linenos">515</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-516"><a href="#-516"><span class="linenos">516</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">... depth_maps min </span><span class="si">{</span><span class="n">depth_maps</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, mean </span><span class="si">{</span><span class="n">depth_maps</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">,&quot;</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-517"><a href="#-517"><span class="linenos">517</span></a>                <span class="sa">f</span><span class="s2">&quot; max </span><span class="si">{</span><span class="n">depth_maps</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, cube_shape </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-518"><a href="#-518"><span class="linenos">518</span></a>            <span class="p">)</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-519"><a href="#-519"><span class="linenos">519</span></a>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-520"><a href="#-520"><span class="linenos">520</span></a>        <span class="c1"># create 3D cube to hold segmentation results</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-521"><a href="#-521"><span class="linenos">521</span></a>        <span class="n">closure_segments</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">faulted_lithology</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="s2">&quot;float32&quot;</span><span class="p">)</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-522"><a href="#-522"><span class="linenos">522</span></a>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-523"><a href="#-523"><span class="linenos">523</span></a>        <span class="c1"># create grids with grid indices</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-524"><a href="#-524"><span class="linenos">524</span></a>        <span class="n">ii</span><span class="p">,</span> <span class="n">jj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">build_meshgrid</span><span class="p">()</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-525"><a href="#-525"><span class="linenos">525</span></a>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-526"><a href="#-526"><span class="linenos">526</span></a>        <span class="c1"># loop through horizons in &#39;depth_maps&#39;</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-527"><a href="#-527"><span class="linenos">527</span></a>        <span class="n">voxel_change_count</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-528"><a href="#-528"><span class="linenos">528</span></a>        <span class="n">layers_with_closure</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-529"><a href="#-529"><span class="linenos">529</span></a>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-530"><a href="#-530"><span class="linenos">530</span></a>        <span class="n">avg_sand_thickness</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-531"><a href="#-531"><span class="linenos">531</span></a>        <span class="n">avg_shale_thickness</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-532"><a href="#-532"><span class="linenos">532</span></a>        <span class="n">avg_unit_thickness</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-533"><a href="#-533"><span class="linenos">533</span></a>        <span class="k">for</span> <span class="n">ihorizon</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">depth_maps</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-534"><a href="#-534"><span class="linenos">534</span></a>            <span class="n">avg_unit_thickness</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-535"><a href="#-535"><span class="linenos">535</span></a>                <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-536"><a href="#-536"><span class="linenos">536</span></a>                    <span class="n">depth_maps_infilled</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">ihorizon</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-537"><a href="#-537"><span class="linenos">537</span></a>                    <span class="o">-</span> <span class="n">depth_maps_infilled</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">ihorizon</span><span class="p">]</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-538"><a href="#-538"><span class="linenos">538</span></a>                <span class="p">)</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-539"><a href="#-539"><span class="linenos">539</span></a>            <span class="p">)</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-540"><a href="#-540"><span class="linenos">540</span></a>            <span class="c1"># calculate a closure map for the layer</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-541"><a href="#-541"><span class="linenos">541</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-542"><a href="#-542"><span class="linenos">542</span></a>                <span class="nb">print</span><span class="p">(</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-543"><a href="#-543"><span class="linenos">543</span></a>                    <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">...closure voxels computation for layer </span><span class="si">{</span><span class="n">ihorizon</span><span class="si">}</span><span class="s2"> in horizon list.&quot;</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-544"><a href="#-544"><span class="linenos">544</span></a>                <span class="p">)</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-545"><a href="#-545"><span class="linenos">545</span></a>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-546"><a href="#-546"><span class="linenos">546</span></a>            <span class="c1"># compute a closure map</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-547"><a href="#-547"><span class="linenos">547</span></a>            <span class="c1"># - identical to top structure map when not in closure, &#39;max flooding&#39; depth when in closure</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-548"><a href="#-548"><span class="linenos">548</span></a>            <span class="c1"># - use thicknesses converted to samples instead of ft or ms</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-549"><a href="#-549"><span class="linenos">549</span></a>            <span class="c1"># - assumes that fault intersections are inserted in input map with value of 0.</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-550"><a href="#-550"><span class="linenos">550</span></a>            <span class="c1"># - assumes that input map values represent depth (i.e., bigger values are deeper)</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-551"><a href="#-551"><span class="linenos">551</span></a>            <span class="n">top_structure_depth_map</span> <span class="o">=</span> <span class="n">depth_maps</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">ihorizon</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-552"><a href="#-552"><span class="linenos">552</span></a>            <span class="n">top_structure_depth_map</span><span class="p">[</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-553"><a href="#-553"><span class="linenos">553</span></a>                <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">top_structure_depth_map</span><span class="p">)</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-554"><a href="#-554"><span class="linenos">554</span></a>            <span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>  <span class="c1"># replace nans with 0.</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-555"><a href="#-555"><span class="linenos">555</span></a>            <span class="n">top_structure_depth_map</span> <span class="o">/=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">digi</span><span class="p">)</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-556"><a href="#-556"><span class="linenos">556</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">partial_voxels</span><span class="p">:</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-557"><a href="#-557"><span class="linenos">557</span></a>                <span class="n">top_structure_depth_map</span> <span class="o">-=</span> <span class="mf">1.0</span>  <span class="c1"># account for voxels partially in layer</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-558"><a href="#-558"><span class="linenos">558</span></a>            <span class="n">base_structure_depth_map</span> <span class="o">=</span> <span class="n">depth_maps_infilled</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">ihorizon</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-559"><a href="#-559"><span class="linenos">559</span></a>            <span class="n">base_structure_depth_map</span><span class="p">[</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-560"><a href="#-560"><span class="linenos">560</span></a>                <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">top_structure_depth_map</span><span class="p">)</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-561"><a href="#-561"><span class="linenos">561</span></a>            <span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>  <span class="c1"># replace nans with 0.</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-562"><a href="#-562"><span class="linenos">562</span></a>            <span class="n">base_structure_depth_map</span> <span class="o">/=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">digi</span><span class="p">)</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-563"><a href="#-563"><span class="linenos">563</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-564"><a href="#-564"><span class="linenos">564</span></a>                <span class="s2">&quot; ...inside create_closure_labels_from_depth_maps... ihorizon = &quot;</span><span class="p">,</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-565"><a href="#-565"><span class="linenos">565</span></a>                <span class="n">ihorizon</span><span class="p">,</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-566"><a href="#-566"><span class="linenos">566</span></a>            <span class="p">)</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-567"><a href="#-567"><span class="linenos">567</span></a>            <span class="c1"># if there is non-zero thickness between top/base closure</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-568"><a href="#-568"><span class="linenos">568</span></a>            <span class="k">if</span> <span class="n">top_structure_depth_map</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">!=</span> <span class="n">top_structure_depth_map</span><span class="o">.</span><span class="n">max</span><span class="p">():</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-569"><a href="#-569"><span class="linenos">569</span></a>                <span class="n">max_column</span> <span class="o">=</span> <span class="n">max_col_height</span><span class="p">[</span><span class="n">ihorizon</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">digi</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-570"><a href="#-570"><span class="linenos">570</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-571"><a href="#-571"><span class="linenos">571</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-572"><a href="#-572"><span class="linenos">572</span></a>                        <span class="sa">f</span><span class="s2">&quot;   ...avg depth for layer </span><span class="si">{</span><span class="n">ihorizon</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">,</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-573"><a href="#-573"><span class="linenos">573</span></a>                        <span class="n">top_structure_depth_map</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-574"><a href="#-574"><span class="linenos">574</span></a>                    <span class="p">)</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-575"><a href="#-575"><span class="linenos">575</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-576"><a href="#-576"><span class="linenos">576</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-577"><a href="#-577"><span class="linenos">577</span></a>                        <span class="sa">f</span><span class="s2">&quot;   ...maximum column height for layer </span><span class="si">{</span><span class="n">ihorizon</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">,</span> <span class="n">max_column</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-578"><a href="#-578"><span class="linenos">578</span></a>                    <span class="p">)</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-579"><a href="#-579"><span class="linenos">579</span></a>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-580"><a href="#-580"><span class="linenos">580</span></a>                <span class="k">if</span> <span class="n">ihorizon</span> <span class="o">==</span> <span class="mi">27000</span> <span class="ow">or</span> <span class="n">ihorizon</span> <span class="o">==</span> <span class="mi">1000</span><span class="p">:</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-581"><a href="#-581"><span class="linenos">581</span></a>                    <span class="n">closure_depth_map</span> <span class="o">=</span> <span class="n">_flood_fill</span><span class="p">(</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-582"><a href="#-582"><span class="linenos">582</span></a>                        <span class="n">top_structure_depth_map</span><span class="p">,</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-583"><a href="#-583"><span class="linenos">583</span></a>                        <span class="n">max_column_height</span><span class="o">=</span><span class="n">max_column</span><span class="p">,</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-584"><a href="#-584"><span class="linenos">584</span></a>                        <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-585"><a href="#-585"><span class="linenos">585</span></a>                        <span class="n">debug</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-586"><a href="#-586"><span class="linenos">586</span></a>                    <span class="p">)</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-587"><a href="#-587"><span class="linenos">587</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-588"><a href="#-588"><span class="linenos">588</span></a>                    <span class="n">closure_depth_map</span> <span class="o">=</span> <span class="n">_flood_fill</span><span class="p">(</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-589"><a href="#-589"><span class="linenos">589</span></a>                        <span class="n">top_structure_depth_map</span><span class="p">,</span> <span class="n">max_column_height</span><span class="o">=</span><span class="n">max_column</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-590"><a href="#-590"><span class="linenos">590</span></a>                    <span class="p">)</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-591"><a href="#-591"><span class="linenos">591</span></a>                <span class="n">closure_depth_map</span><span class="p">[</span><span class="n">closure_depth_map</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">top_structure_depth_map</span><span class="p">[</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-592"><a href="#-592"><span class="linenos">592</span></a>                    <span class="n">closure_depth_map</span> <span class="o">==</span> <span class="mi">0</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-593"><a href="#-593"><span class="linenos">593</span></a>                <span class="p">]</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-594"><a href="#-594"><span class="linenos">594</span></a>                <span class="n">closure_depth_map</span><span class="p">[</span><span class="n">closure_depth_map</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">top_structure_depth_map</span><span class="p">[</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-595"><a href="#-595"><span class="linenos">595</span></a>                    <span class="n">closure_depth_map</span> <span class="o">==</span> <span class="mi">1</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-596"><a href="#-596"><span class="linenos">596</span></a>                <span class="p">]</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-597"><a href="#-597"><span class="linenos">597</span></a>                <span class="n">closure_depth_map</span><span class="p">[</span><span class="n">closure_depth_map</span> <span class="o">==</span> <span class="mf">1e5</span><span class="p">]</span> <span class="o">=</span> <span class="n">top_structure_depth_map</span><span class="p">[</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-598"><a href="#-598"><span class="linenos">598</span></a>                    <span class="n">closure_depth_map</span> <span class="o">==</span> <span class="mf">1e5</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-599"><a href="#-599"><span class="linenos">599</span></a>                <span class="p">]</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-600"><a href="#-600"><span class="linenos">600</span></a>                <span class="c1"># Select the maximum value between the top sand map and the flood-filled closure map</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-601"><a href="#-601"><span class="linenos">601</span></a>                <span class="n">closure_depth_map</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-602"><a href="#-602"><span class="linenos">602</span></a>                    <span class="n">np</span><span class="o">.</span><span class="n">dstack</span><span class="p">((</span><span class="n">closure_depth_map</span><span class="p">,</span> <span class="n">top_structure_depth_map</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-603"><a href="#-603"><span class="linenos">603</span></a>                <span class="p">)</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-604"><a href="#-604"><span class="linenos">604</span></a>                <span class="n">closure_depth_map</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-605"><a href="#-605"><span class="linenos">605</span></a>                    <span class="n">np</span><span class="o">.</span><span class="n">dstack</span><span class="p">((</span><span class="n">closure_depth_map</span><span class="p">,</span> <span class="n">base_structure_depth_map</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-606"><a href="#-606"><span class="linenos">606</span></a>                <span class="p">)</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-607"><a href="#-607"><span class="linenos">607</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-608"><a href="#-608"><span class="linenos">608</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-609"><a href="#-609"><span class="linenos">609</span></a>                        <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">    ... layer </span><span class="si">{</span><span class="n">ihorizon</span><span class="si">}</span><span class="s2">,&quot;</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-610"><a href="#-610"><span class="linenos">610</span></a>                        <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n\t</span><span class="s2">top structure map min, max </span><span class="si">{</span><span class="n">top_structure_depth_map</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">,&quot;</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-611"><a href="#-611"><span class="linenos">611</span></a>                        <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">top_structure_depth_map</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="se">\n\t</span><span class="s2">closure_depth_map min, max&quot;</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-612"><a href="#-612"><span class="linenos">612</span></a>                        <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">closure_depth_map</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">closure_depth_map</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-613"><a href="#-613"><span class="linenos">613</span></a>                    <span class="p">)</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-614"><a href="#-614"><span class="linenos">614</span></a>                <span class="n">closure_thickness</span> <span class="o">=</span> <span class="n">closure_depth_map</span> <span class="o">-</span> <span class="n">top_structure_depth_map</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-615"><a href="#-615"><span class="linenos">615</span></a>                <span class="n">closure_thickness_no_nan</span> <span class="o">=</span> <span class="n">closure_thickness</span><span class="p">[</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-616"><a href="#-616"><span class="linenos">616</span></a>                    <span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">closure_thickness</span><span class="p">)</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-617"><a href="#-617"><span class="linenos">617</span></a>                <span class="p">]</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-618"><a href="#-618"><span class="linenos">618</span></a>                <span class="n">max_closure</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">closure_thickness_no_nan</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="mi">0</span><span class="p">))</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-619"><a href="#-619"><span class="linenos">619</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-620"><a href="#-620"><span class="linenos">620</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    ... layer </span><span class="si">{</span><span class="n">ihorizon</span><span class="si">}</span><span class="s2">, max_closure </span><span class="si">{</span><span class="n">max_closure</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-621"><a href="#-621"><span class="linenos">621</span></a>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-622"><a href="#-622"><span class="linenos">622</span></a>                <span class="c1"># locate 3D zone in closure after checking that closures exist for this horizon</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-623"><a href="#-623"><span class="linenos">623</span></a>                <span class="c1"># if False in (top_structure_depth_map == closure_depth_map):</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-624"><a href="#-624"><span class="linenos">624</span></a>                <span class="k">if</span> <span class="n">max_closure</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-625"><a href="#-625"><span class="linenos">625</span></a>                    <span class="c1"># locate voxels anywhere in layer where top_structure_depth_map &lt; closure_depth_map</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-626"><a href="#-626"><span class="linenos">626</span></a>                    <span class="c1"># put label in cube between top_structure_depth_map and closure_depth_map</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-627"><a href="#-627"><span class="linenos">627</span></a>                    <span class="n">top_structure_depth_map_integer</span> <span class="o">=</span> <span class="n">top_structure_depth_map</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-628"><a href="#-628"><span class="linenos">628</span></a>                    <span class="n">closure_depth_map_integer</span> <span class="o">=</span> <span class="n">closure_depth_map</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-629"><a href="#-629"><span class="linenos">629</span></a>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-630"><a href="#-630"><span class="linenos">630</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-631"><a href="#-631"><span class="linenos">631</span></a>                        <span class="n">closure_map_min</span> <span class="o">=</span> <span class="n">closure_depth_map_integer</span><span class="p">[</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-632"><a href="#-632"><span class="linenos">632</span></a>                            <span class="n">closure_depth_map_integer</span> <span class="o">&gt;</span> <span class="mf">0.1</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-633"><a href="#-633"><span class="linenos">633</span></a>                        <span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-634"><a href="#-634"><span class="linenos">634</span></a>                        <span class="n">closure_map_max</span> <span class="o">=</span> <span class="n">closure_depth_map_integer</span><span class="p">[</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-635"><a href="#-635"><span class="linenos">635</span></a>                            <span class="n">closure_depth_map_integer</span> <span class="o">&gt;</span> <span class="mf">0.1</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-636"><a href="#-636"><span class="linenos">636</span></a>                        <span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-637"><a href="#-637"><span class="linenos">637</span></a>                        <span class="nb">print</span><span class="p">(</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-638"><a href="#-638"><span class="linenos">638</span></a>                            <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">... (2) layer: </span><span class="si">{</span><span class="n">ihorizon</span><span class="si">}</span><span class="s2">, max_closure; </span><span class="si">{</span><span class="n">max_closure</span><span class="si">}</span><span class="s2">, top structure map min, &quot;</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-639"><a href="#-639"><span class="linenos">639</span></a>                            <span class="sa">f</span><span class="s2">&quot;max: </span><span class="si">{</span><span class="n">top_structure_depth_map</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">top_structure_depth_map_integer</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">}</span><span class="s2">,&quot;</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-640"><a href="#-640"><span class="linenos">640</span></a>                            <span class="sa">f</span><span class="s2">&quot; closure map min, max: </span><span class="si">{</span><span class="n">closure_map_min</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">closure_map_max</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-641"><a href="#-641"><span class="linenos">641</span></a>                        <span class="p">)</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-642"><a href="#-642"><span class="linenos">642</span></a>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-643"><a href="#-643"><span class="linenos">643</span></a>                    <span class="n">slices_with_substitution</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-644"><a href="#-644"><span class="linenos">644</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    ... max_closure: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">max_closure</span><span class="p">))</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-645"><a href="#-645"><span class="linenos">645</span></a>                    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-646"><a href="#-646"><span class="linenos">646</span></a>                        <span class="n">max_closure</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-647"><a href="#-647"><span class="linenos">647</span></a>                    <span class="p">):</span>  <span class="c1"># add one more sample than seemingly needed for round-off</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-648"><a href="#-648"><span class="linenos">648</span></a>                        <span class="c1"># Subtract 2 from the closure cube shape since adding one later</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-649"><a href="#-649"><span class="linenos">649</span></a>                        <span class="n">horizon_slice</span> <span class="o">=</span> <span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="n">top_structure_depth_map</span><span class="p">)</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-650"><a href="#-650"><span class="linenos">650</span></a>                            <span class="mi">0</span><span class="p">,</span> <span class="n">closure_segments</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="mi">2</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-651"><a href="#-651"><span class="linenos">651</span></a>                        <span class="p">)</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-652"><a href="#-652"><span class="linenos">652</span></a>                        <span class="n">sublayer_kk</span> <span class="o">=</span> <span class="n">horizon_slice</span><span class="p">[</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-653"><a href="#-653"><span class="linenos">653</span></a>                            <span class="n">horizon_slice</span> <span class="o">&lt;</span> <span class="n">closure_depth_map</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;int&quot;</span><span class="p">)</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-654"><a href="#-654"><span class="linenos">654</span></a>                        <span class="p">]</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-655"><a href="#-655"><span class="linenos">655</span></a>                        <span class="n">sublayer_ii</span> <span class="o">=</span> <span class="n">ii</span><span class="p">[</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-656"><a href="#-656"><span class="linenos">656</span></a>                            <span class="n">horizon_slice</span> <span class="o">&lt;</span> <span class="n">closure_depth_map</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;int&quot;</span><span class="p">)</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-657"><a href="#-657"><span class="linenos">657</span></a>                        <span class="p">]</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-658"><a href="#-658"><span class="linenos">658</span></a>                        <span class="n">sublayer_jj</span> <span class="o">=</span> <span class="n">jj</span><span class="p">[</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-659"><a href="#-659"><span class="linenos">659</span></a>                            <span class="n">horizon_slice</span> <span class="o">&lt;</span> <span class="n">closure_depth_map</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;int&quot;</span><span class="p">)</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-660"><a href="#-660"><span class="linenos">660</span></a>                        <span class="p">]</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-661"><a href="#-661"><span class="linenos">661</span></a>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-662"><a href="#-662"><span class="linenos">662</span></a>                        <span class="k">if</span> <span class="n">sublayer_ii</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-663"><a href="#-663"><span class="linenos">663</span></a>                            <span class="n">slices_with_substitution</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-664"><a href="#-664"><span class="linenos">664</span></a>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-665"><a href="#-665"><span class="linenos">665</span></a>                            <span class="n">i_indices</span> <span class="o">=</span> <span class="n">sublayer_ii</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-666"><a href="#-666"><span class="linenos">666</span></a>                            <span class="n">j_indices</span> <span class="o">=</span> <span class="n">sublayer_jj</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-667"><a href="#-667"><span class="linenos">667</span></a>                            <span class="n">k_indices</span> <span class="o">=</span> <span class="n">sublayer_kk</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-668"><a href="#-668"><span class="linenos">668</span></a>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-669"><a href="#-669"><span class="linenos">669</span></a>                            <span class="k">try</span><span class="p">:</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-670"><a href="#-670"><span class="linenos">670</span></a>                                <span class="n">closure_segments</span><span class="p">[</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-671"><a href="#-671"><span class="linenos">671</span></a>                                    <span class="n">i_indices</span><span class="p">,</span> <span class="n">j_indices</span><span class="p">,</span> <span class="n">k_indices</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;int&quot;</span><span class="p">)</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-672"><a href="#-672"><span class="linenos">672</span></a>                                <span class="p">]</span> <span class="o">+=</span> <span class="mf">1.0</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-673"><a href="#-673"><span class="linenos">673</span></a>                                <span class="n">voxel_change_count</span><span class="p">[</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-674"><a href="#-674"><span class="linenos">674</span></a>                                    <span class="n">i_indices</span><span class="p">,</span> <span class="n">j_indices</span><span class="p">,</span> <span class="n">k_indices</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;int&quot;</span><span class="p">)</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-675"><a href="#-675"><span class="linenos">675</span></a>                                <span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-676"><a href="#-676"><span class="linenos">676</span></a>                            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-677"><a href="#-677"><span class="linenos">677</span></a>                                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Index is out of bounds.&quot;</span><span class="p">)</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-678"><a href="#-678"><span class="linenos">678</span></a>                                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">closure_segments: </span><span class="si">{</span><span class="n">closure_segments</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-679"><a href="#-679"><span class="linenos">679</span></a>                                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">voxel_change_count: </span><span class="si">{</span><span class="n">voxel_change_count</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-680"><a href="#-680"><span class="linenos">680</span></a>                                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">i_indices: </span><span class="si">{</span><span class="n">i_indices</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-681"><a href="#-681"><span class="linenos">681</span></a>                                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">j_indices: </span><span class="si">{</span><span class="n">j_indices</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-682"><a href="#-682"><span class="linenos">682</span></a>                                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">k_indices: </span><span class="si">{</span><span class="n">k_indices</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;int&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-683"><a href="#-683"><span class="linenos">683</span></a>                                <span class="k">pass</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-684"><a href="#-684"><span class="linenos">684</span></a>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-685"><a href="#-685"><span class="linenos">685</span></a>                    <span class="k">if</span> <span class="n">slices_with_substitution</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-686"><a href="#-686"><span class="linenos">686</span></a>                        <span class="n">layers_with_closure</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-687"><a href="#-687"><span class="linenos">687</span></a>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-688"><a href="#-688"><span class="linenos">688</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-689"><a href="#-689"><span class="linenos">689</span></a>                        <span class="nb">print</span><span class="p">(</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-690"><a href="#-690"><span class="linenos">690</span></a>                            <span class="s2">&quot;    ... finished putting closures in closures_segments for layer ...&quot;</span><span class="p">,</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-691"><a href="#-691"><span class="linenos">691</span></a>                            <span class="n">ihorizon</span><span class="p">,</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-692"><a href="#-692"><span class="linenos">692</span></a>                        <span class="p">)</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-693"><a href="#-693"><span class="linenos">693</span></a>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-694"><a href="#-694"><span class="linenos">694</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-695"><a href="#-695"><span class="linenos">695</span></a>                    <span class="k">continue</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-696"><a href="#-696"><span class="linenos">696</span></a>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-697"><a href="#-697"><span class="linenos">697</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">facies</span><span class="p">[</span><span class="n">ihorizon</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-698"><a href="#-698"><span class="linenos">698</span></a>                <span class="n">avg_sand_thickness</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-699"><a href="#-699"><span class="linenos">699</span></a>                    <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-700"><a href="#-700"><span class="linenos">700</span></a>                        <span class="n">depth_maps_infilled</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">ihorizon</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-701"><a href="#-701"><span class="linenos">701</span></a>                        <span class="o">-</span> <span class="n">depth_maps_infilled</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">ihorizon</span><span class="p">]</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-702"><a href="#-702"><span class="linenos">702</span></a>                    <span class="p">)</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-703"><a href="#-703"><span class="linenos">703</span></a>                <span class="p">)</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-704"><a href="#-704"><span class="linenos">704</span></a>            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">facies</span><span class="p">[</span><span class="n">ihorizon</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-705"><a href="#-705"><span class="linenos">705</span></a>                <span class="c1"># Calculate shale unit thicknesses</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-706"><a href="#-706"><span class="linenos">706</span></a>                <span class="n">avg_shale_thickness</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-707"><a href="#-707"><span class="linenos">707</span></a>                    <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-708"><a href="#-708"><span class="linenos">708</span></a>                        <span class="n">depth_maps_infilled</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">ihorizon</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-709"><a href="#-709"><span class="linenos">709</span></a>                        <span class="o">-</span> <span class="n">depth_maps_infilled</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">ihorizon</span><span class="p">]</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-710"><a href="#-710"><span class="linenos">710</span></a>                    <span class="p">)</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-711"><a href="#-711"><span class="linenos">711</span></a>                <span class="p">)</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-712"><a href="#-712"><span class="linenos">712</span></a>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-713"><a href="#-713"><span class="linenos">713</span></a>        <span class="c1"># TODO  handle case where avg_sand_thickness is zero-size array</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-714"><a href="#-714"><span class="linenos">714</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-715"><a href="#-715"><span class="linenos">715</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-716"><a href="#-716"><span class="linenos">716</span></a>                <span class="sa">f</span><span class="s2">&quot;Sand Unit Thickness (m): mean: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">avg_sand_thickness</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, &quot;</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-717"><a href="#-717"><span class="linenos">717</span></a>                <span class="sa">f</span><span class="s2">&quot;std: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">avg_sand_thickness</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, min: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">avg_sand_thickness</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, &quot;</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-718"><a href="#-718"><span class="linenos">718</span></a>                <span class="sa">f</span><span class="s2">&quot;max: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">avg_sand_thickness</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-719"><a href="#-719"><span class="linenos">719</span></a>            <span class="p">)</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-720"><a href="#-720"><span class="linenos">720</span></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-721"><a href="#-721"><span class="linenos">721</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No sands in model&quot;</span><span class="p">)</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-722"><a href="#-722"><span class="linenos">722</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-723"><a href="#-723"><span class="linenos">723</span></a>            <span class="sa">f</span><span class="s2">&quot;Shale Unit Thickness (m): mean: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">avg_shale_thickness</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, &quot;</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-724"><a href="#-724"><span class="linenos">724</span></a>            <span class="sa">f</span><span class="s2">&quot;std: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">avg_shale_thickness</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, min: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">avg_shale_thickness</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, &quot;</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-725"><a href="#-725"><span class="linenos">725</span></a>            <span class="sa">f</span><span class="s2">&quot;max: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">avg_shale_thickness</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-726"><a href="#-726"><span class="linenos">726</span></a>        <span class="p">)</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-727"><a href="#-727"><span class="linenos">727</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-728"><a href="#-728"><span class="linenos">728</span></a>            <span class="sa">f</span><span class="s2">&quot;Overall Unit Thickness (m): mean: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">avg_unit_thickness</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, &quot;</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-729"><a href="#-729"><span class="linenos">729</span></a>            <span class="sa">f</span><span class="s2">&quot;std: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">avg_unit_thickness</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, min: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">avg_unit_thickness</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, &quot;</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-730"><a href="#-730"><span class="linenos">730</span></a>            <span class="sa">f</span><span class="s2">&quot;max: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">avg_unit_thickness</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-731"><a href="#-731"><span class="linenos">731</span></a>        <span class="p">)</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-732"><a href="#-732"><span class="linenos">732</span></a>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-733"><a href="#-733"><span class="linenos">733</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-734"><a href="#-734"><span class="linenos">734</span></a>            <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-735"><a href="#-735"><span class="linenos">735</span></a>            <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-736"><a href="#-736"><span class="linenos">736</span></a>            <span class="n">subkey</span><span class="o">=</span><span class="s2">&quot;sand_unit_thickness_mean&quot;</span><span class="p">,</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-737"><a href="#-737"><span class="linenos">737</span></a>            <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">avg_sand_thickness</span><span class="p">),</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-738"><a href="#-738"><span class="linenos">738</span></a>        <span class="p">)</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-739"><a href="#-739"><span class="linenos">739</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-740"><a href="#-740"><span class="linenos">740</span></a>            <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-741"><a href="#-741"><span class="linenos">741</span></a>            <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-742"><a href="#-742"><span class="linenos">742</span></a>            <span class="n">subkey</span><span class="o">=</span><span class="s2">&quot;sand_unit_thickness_std&quot;</span><span class="p">,</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-743"><a href="#-743"><span class="linenos">743</span></a>            <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">avg_sand_thickness</span><span class="p">),</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-744"><a href="#-744"><span class="linenos">744</span></a>        <span class="p">)</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-745"><a href="#-745"><span class="linenos">745</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-746"><a href="#-746"><span class="linenos">746</span></a>            <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-747"><a href="#-747"><span class="linenos">747</span></a>            <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-748"><a href="#-748"><span class="linenos">748</span></a>            <span class="n">subkey</span><span class="o">=</span><span class="s2">&quot;sand_unit_thickness_min&quot;</span><span class="p">,</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-749"><a href="#-749"><span class="linenos">749</span></a>            <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">avg_sand_thickness</span><span class="p">),</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-750"><a href="#-750"><span class="linenos">750</span></a>        <span class="p">)</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-751"><a href="#-751"><span class="linenos">751</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-752"><a href="#-752"><span class="linenos">752</span></a>            <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-753"><a href="#-753"><span class="linenos">753</span></a>            <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-754"><a href="#-754"><span class="linenos">754</span></a>            <span class="n">subkey</span><span class="o">=</span><span class="s2">&quot;sand_unit_thickness_max&quot;</span><span class="p">,</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-755"><a href="#-755"><span class="linenos">755</span></a>            <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">avg_sand_thickness</span><span class="p">),</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-756"><a href="#-756"><span class="linenos">756</span></a>        <span class="p">)</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-757"><a href="#-757"><span class="linenos">757</span></a>        <span class="c1">#</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-758"><a href="#-758"><span class="linenos">758</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-759"><a href="#-759"><span class="linenos">759</span></a>            <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-760"><a href="#-760"><span class="linenos">760</span></a>            <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-761"><a href="#-761"><span class="linenos">761</span></a>            <span class="n">subkey</span><span class="o">=</span><span class="s2">&quot;shale_unit_thickness_mean&quot;</span><span class="p">,</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-762"><a href="#-762"><span class="linenos">762</span></a>            <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">avg_shale_thickness</span><span class="p">),</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-763"><a href="#-763"><span class="linenos">763</span></a>        <span class="p">)</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-764"><a href="#-764"><span class="linenos">764</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-765"><a href="#-765"><span class="linenos">765</span></a>            <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-766"><a href="#-766"><span class="linenos">766</span></a>            <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-767"><a href="#-767"><span class="linenos">767</span></a>            <span class="n">subkey</span><span class="o">=</span><span class="s2">&quot;shale_unit_thickness_std&quot;</span><span class="p">,</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-768"><a href="#-768"><span class="linenos">768</span></a>            <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">avg_shale_thickness</span><span class="p">),</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-769"><a href="#-769"><span class="linenos">769</span></a>        <span class="p">)</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-770"><a href="#-770"><span class="linenos">770</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-771"><a href="#-771"><span class="linenos">771</span></a>            <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-772"><a href="#-772"><span class="linenos">772</span></a>            <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-773"><a href="#-773"><span class="linenos">773</span></a>            <span class="n">subkey</span><span class="o">=</span><span class="s2">&quot;shale_unit_thickness_min&quot;</span><span class="p">,</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-774"><a href="#-774"><span class="linenos">774</span></a>            <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">avg_shale_thickness</span><span class="p">),</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-775"><a href="#-775"><span class="linenos">775</span></a>        <span class="p">)</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-776"><a href="#-776"><span class="linenos">776</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-777"><a href="#-777"><span class="linenos">777</span></a>            <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-778"><a href="#-778"><span class="linenos">778</span></a>            <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-779"><a href="#-779"><span class="linenos">779</span></a>            <span class="n">subkey</span><span class="o">=</span><span class="s2">&quot;shale_unit_thickness_max&quot;</span><span class="p">,</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-780"><a href="#-780"><span class="linenos">780</span></a>            <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">avg_shale_thickness</span><span class="p">),</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-781"><a href="#-781"><span class="linenos">781</span></a>        <span class="p">)</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-782"><a href="#-782"><span class="linenos">782</span></a>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-783"><a href="#-783"><span class="linenos">783</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-784"><a href="#-784"><span class="linenos">784</span></a>            <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-785"><a href="#-785"><span class="linenos">785</span></a>            <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-786"><a href="#-786"><span class="linenos">786</span></a>            <span class="n">subkey</span><span class="o">=</span><span class="s2">&quot;overall_unit_thickness_mean&quot;</span><span class="p">,</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-787"><a href="#-787"><span class="linenos">787</span></a>            <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">avg_unit_thickness</span><span class="p">),</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-788"><a href="#-788"><span class="linenos">788</span></a>        <span class="p">)</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-789"><a href="#-789"><span class="linenos">789</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-790"><a href="#-790"><span class="linenos">790</span></a>            <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-791"><a href="#-791"><span class="linenos">791</span></a>            <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-792"><a href="#-792"><span class="linenos">792</span></a>            <span class="n">subkey</span><span class="o">=</span><span class="s2">&quot;overall_unit_thickness_std&quot;</span><span class="p">,</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-793"><a href="#-793"><span class="linenos">793</span></a>            <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">avg_unit_thickness</span><span class="p">),</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-794"><a href="#-794"><span class="linenos">794</span></a>        <span class="p">)</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-795"><a href="#-795"><span class="linenos">795</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-796"><a href="#-796"><span class="linenos">796</span></a>            <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-797"><a href="#-797"><span class="linenos">797</span></a>            <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-798"><a href="#-798"><span class="linenos">798</span></a>            <span class="n">subkey</span><span class="o">=</span><span class="s2">&quot;overall_unit_thickness_min&quot;</span><span class="p">,</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-799"><a href="#-799"><span class="linenos">799</span></a>            <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">avg_unit_thickness</span><span class="p">),</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-800"><a href="#-800"><span class="linenos">800</span></a>        <span class="p">)</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-801"><a href="#-801"><span class="linenos">801</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-802"><a href="#-802"><span class="linenos">802</span></a>            <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-803"><a href="#-803"><span class="linenos">803</span></a>            <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-804"><a href="#-804"><span class="linenos">804</span></a>            <span class="n">subkey</span><span class="o">=</span><span class="s2">&quot;overall_unit_thickness_max&quot;</span><span class="p">,</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-805"><a href="#-805"><span class="linenos">805</span></a>            <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">avg_unit_thickness</span><span class="p">),</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-806"><a href="#-806"><span class="linenos">806</span></a>        <span class="p">)</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-807"><a href="#-807"><span class="linenos">807</span></a>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-808"><a href="#-808"><span class="linenos">808</span></a>        <span class="n">non_zero_pixels</span> <span class="o">=</span> <span class="n">closure_segments</span><span class="p">[</span><span class="n">closure_segments</span> <span class="o">!=</span> <span class="mf">0.0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-809"><a href="#-809"><span class="linenos">809</span></a>        <span class="n">pct_non_zero</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">non_zero_pixels</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-810"><a href="#-810"><span class="linenos">810</span></a>            <span class="n">closure_segments</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-811"><a href="#-811"><span class="linenos">811</span></a>            <span class="o">*</span> <span class="n">closure_segments</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-812"><a href="#-812"><span class="linenos">812</span></a>            <span class="o">*</span> <span class="n">closure_segments</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-813"><a href="#-813"><span class="linenos">813</span></a>        <span class="p">)</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-814"><a href="#-814"><span class="linenos">814</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-815"><a href="#-815"><span class="linenos">815</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-816"><a href="#-816"><span class="linenos">816</span></a>                <span class="s2">&quot;    ...closure_segments min </span><span class="si">{}</span><span class="s2">, mean </span><span class="si">{}</span><span class="s2">, max </span><span class="si">{}</span><span class="s2">, % non-zero </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-817"><a href="#-817"><span class="linenos">817</span></a>                    <span class="n">closure_segments</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-818"><a href="#-818"><span class="linenos">818</span></a>                    <span class="n">closure_segments</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-819"><a href="#-819"><span class="linenos">819</span></a>                    <span class="n">closure_segments</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-820"><a href="#-820"><span class="linenos">820</span></a>                    <span class="n">pct_non_zero</span><span class="p">,</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-821"><a href="#-821"><span class="linenos">821</span></a>                <span class="p">)</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-822"><a href="#-822"><span class="linenos">822</span></a>            <span class="p">)</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-823"><a href="#-823"><span class="linenos">823</span></a>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-824"><a href="#-824"><span class="linenos">824</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">... layers_with_closure </span><span class="si">{</span><span class="n">layers_with_closure</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-825"><a href="#-825"><span class="linenos">825</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">... finished putting closures in closure_segments ...</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-826"><a href="#-826"><span class="linenos">826</span></a>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-827"><a href="#-827"><span class="linenos">827</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-828"><a href="#-828"><span class="linenos">828</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-829"><a href="#-829"><span class="linenos">829</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">   ...closure segments created. min: </span><span class="si">{</span><span class="n">closure_segments</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="si">}</span><span class="s2">, &quot;</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-830"><a href="#-830"><span class="linenos">830</span></a>                <span class="sa">f</span><span class="s2">&quot;mean: </span><span class="si">{</span><span class="n">closure_segments</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, max: </span><span class="si">{</span><span class="n">closure_segments</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-831"><a href="#-831"><span class="linenos">831</span></a>                <span class="sa">f</span><span class="s2">&quot; voxel count: </span><span class="si">{</span><span class="n">closure_segments</span><span class="p">[</span><span class="n">closure_segments</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-832"><a href="#-832"><span class="linenos">832</span></a>            <span class="p">)</span>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-833"><a href="#-833"><span class="linenos">833</span></a>
</span><span id="Closures.create_closure_labels_from_all_depth_maps-834"><a href="#-834"><span class="linenos">834</span></a>        <span class="k">return</span> <span class="n">closure_segments</span>
</span></pre></div>


    

                            </div>
                            <div id="Closures.find_top_lith_horizons" class="classattr">
                                        <input id="Closures.find_top_lith_horizons-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">find_top_lith_horizons</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Closures.find_top_lith_horizons-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Closures.find_top_lith_horizons"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Closures.find_top_lith_horizons-836"><a href="#-836"><span class="linenos">836</span></a>    <span class="k">def</span> <span class="nf">find_top_lith_horizons</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Closures.find_top_lith_horizons-837"><a href="#-837"><span class="linenos">837</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="Closures.find_top_lith_horizons-838"><a href="#-838"><span class="linenos">838</span></a><span class="sd">        Find horizons which are the top of layers where the lithology changes</span>
</span><span id="Closures.find_top_lith_horizons-839"><a href="#-839"><span class="linenos">839</span></a>
</span><span id="Closures.find_top_lith_horizons-840"><a href="#-840"><span class="linenos">840</span></a><span class="sd">        Combine layers of the same lithology and retain the top of these new layers for closure calculations.</span>
</span><span id="Closures.find_top_lith_horizons-841"><a href="#-841"><span class="linenos">841</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Closures.find_top_lith_horizons-842"><a href="#-842"><span class="linenos">842</span></a>        <span class="n">top_lith_indices</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">onlap_list</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="Closures.find_top_lith_horizons-843"><a href="#-843"><span class="linenos">843</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">facies</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
</span><span id="Closures.find_top_lith_horizons-844"><a href="#-844"><span class="linenos">844</span></a>            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Closures.find_top_lith_horizons-845"><a href="#-845"><span class="linenos">845</span></a>                <span class="k">continue</span>
</span><span id="Closures.find_top_lith_horizons-846"><a href="#-846"><span class="linenos">846</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="Closures.find_top_lith_horizons-847"><a href="#-847"><span class="linenos">847</span></a>                <span class="sa">f</span><span class="s2">&quot;i: </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">, sand_layer_label[i-1]: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">facies</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">,&quot;</span>
</span><span id="Closures.find_top_lith_horizons-848"><a href="#-848"><span class="linenos">848</span></a>                <span class="sa">f</span><span class="s2">&quot; sand_layer_label[i]: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">facies</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Closures.find_top_lith_horizons-849"><a href="#-849"><span class="linenos">849</span></a>            <span class="p">)</span>
</span><span id="Closures.find_top_lith_horizons-850"><a href="#-850"><span class="linenos">850</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">facies</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">facies</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]:</span>
</span><span id="Closures.find_top_lith_horizons-851"><a href="#-851"><span class="linenos">851</span></a>                <span class="n">top_lith_indices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</span><span id="Closures.find_top_lith_horizons-852"><a href="#-852"><span class="linenos">852</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Closures.find_top_lith_horizons-853"><a href="#-853"><span class="linenos">853</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="Closures.find_top_lith_horizons-854"><a href="#-854"><span class="linenos">854</span></a>                        <span class="s2">&quot;  ... layer lith different than layer above it. i = </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="Closures.find_top_lith_horizons-855"><a href="#-855"><span class="linenos">855</span></a>                            <span class="n">i</span>
</span><span id="Closures.find_top_lith_horizons-856"><a href="#-856"><span class="linenos">856</span></a>                        <span class="p">)</span>
</span><span id="Closures.find_top_lith_horizons-857"><a href="#-857"><span class="linenos">857</span></a>                    <span class="p">)</span>
</span><span id="Closures.find_top_lith_horizons-858"><a href="#-858"><span class="linenos">858</span></a>        <span class="n">top_lith_indices</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
</span><span id="Closures.find_top_lith_horizons-859"><a href="#-859"><span class="linenos">859</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Closures.find_top_lith_horizons-860"><a href="#-860"><span class="linenos">860</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="Closures.find_top_lith_horizons-861"><a href="#-861"><span class="linenos">861</span></a>                <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">   ...layers selected for closure computations...</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="Closures.find_top_lith_horizons-862"><a href="#-862"><span class="linenos">862</span></a>                <span class="n">top_lith_indices</span><span class="p">,</span>
</span><span id="Closures.find_top_lith_horizons-863"><a href="#-863"><span class="linenos">863</span></a>            <span class="p">)</span>
</span><span id="Closures.find_top_lith_horizons-864"><a href="#-864"><span class="linenos">864</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">top_lith_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">top_lith_indices</span><span class="p">)</span>
</span><span id="Closures.find_top_lith_horizons-865"><a href="#-865"><span class="linenos">865</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">top_lith_facies</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">facies</span><span class="p">[</span><span class="n">top_lith_indices</span><span class="p">]</span>
</span><span id="Closures.find_top_lith_horizons-866"><a href="#-866"><span class="linenos">866</span></a>
</span><span id="Closures.find_top_lith_horizons-867"><a href="#-867"><span class="linenos">867</span></a>        <span class="c1"># return top_lith_indices</span>
</span></pre></div>


            <div class="docstring"><p>Find horizons which are the top of layers where the lithology changes</p>

<p>Combine layers of the same lithology and retain the top of these new layers for closure calculations.</p>
</div>


                            </div>
                            <div id="Closures.create_closures" class="classattr">
                                        <input id="Closures.create_closures-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">create_closures</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Closures.create_closures-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Closures.create_closures"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Closures.create_closures-869"><a href="#-869"><span class="linenos"> 869</span></a>    <span class="k">def</span> <span class="nf">create_closures</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Closures.create_closures-870"><a href="#-870"><span class="linenos"> 870</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Closures.create_closures-871"><a href="#-871"><span class="linenos"> 871</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2"> ... create 3D labels for closure&quot;</span><span class="p">)</span>
</span><span id="Closures.create_closures-872"><a href="#-872"><span class="linenos"> 872</span></a>
</span><span id="Closures.create_closures-873"><a href="#-873"><span class="linenos"> 873</span></a>        <span class="c1"># Convert nan to 0&#39;s</span>
</span><span id="Closures.create_closures-874"><a href="#-874"><span class="linenos"> 874</span></a>        <span class="n">old_depth_maps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">faulted_depth_maps</span><span class="p">[:],</span> <span class="n">copy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Closures.create_closures-875"><a href="#-875"><span class="linenos"> 875</span></a>        <span class="n">old_depth_maps_gaps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span>
</span><span id="Closures.create_closures-876"><a href="#-876"><span class="linenos"> 876</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">faulted_depth_maps_gaps</span><span class="p">[:],</span> <span class="n">copy</span><span class="o">=</span><span class="kc">True</span>
</span><span id="Closures.create_closures-877"><a href="#-877"><span class="linenos"> 877</span></a>        <span class="p">)</span>
</span><span id="Closures.create_closures-878"><a href="#-878"><span class="linenos"> 878</span></a>
</span><span id="Closures.create_closures-879"><a href="#-879"><span class="linenos"> 879</span></a>        <span class="c1"># Convert from samples to units</span>
</span><span id="Closures.create_closures-880"><a href="#-880"><span class="linenos"> 880</span></a>        <span class="n">old_depth_maps_gaps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">convert_map_from_samples_to_units</span><span class="p">(</span>
</span><span id="Closures.create_closures-881"><a href="#-881"><span class="linenos"> 881</span></a>            <span class="n">old_depth_maps_gaps</span>
</span><span id="Closures.create_closures-882"><a href="#-882"><span class="linenos"> 882</span></a>        <span class="p">)</span>
</span><span id="Closures.create_closures-883"><a href="#-883"><span class="linenos"> 883</span></a>        <span class="n">old_depth_maps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">convert_map_from_samples_to_units</span><span class="p">(</span><span class="n">old_depth_maps</span><span class="p">)</span>
</span><span id="Closures.create_closures-884"><a href="#-884"><span class="linenos"> 884</span></a>
</span><span id="Closures.create_closures-885"><a href="#-885"><span class="linenos"> 885</span></a>        <span class="c1"># keep only horizons corresponding to top of layers where lithology changes</span>
</span><span id="Closures.create_closures-886"><a href="#-886"><span class="linenos"> 886</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">find_top_lith_horizons</span><span class="p">()</span>
</span><span id="Closures.create_closures-887"><a href="#-887"><span class="linenos"> 887</span></a>        <span class="n">all_lith_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">old_depth_maps</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</span><span id="Closures.create_closures-888"><a href="#-888"><span class="linenos"> 888</span></a>        <span class="kn">import</span> <span class="nn">sys</span>
</span><span id="Closures.create_closures-889"><a href="#-889"><span class="linenos"> 889</span></a>
</span><span id="Closures.create_closures-890"><a href="#-890"><span class="linenos"> 890</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;All lith indices (last, then all):&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">facies</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">all_lith_indices</span><span class="p">)</span>
</span><span id="Closures.create_closures-891"><a href="#-891"><span class="linenos"> 891</span></a>        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</span><span id="Closures.create_closures-892"><a href="#-892"><span class="linenos"> 892</span></a>
</span><span id="Closures.create_closures-893"><a href="#-893"><span class="linenos"> 893</span></a>        <span class="n">depth_maps_gaps_top_lith</span> <span class="o">=</span> <span class="n">old_depth_maps_gaps</span><span class="p">[</span>
</span><span id="Closures.create_closures-894"><a href="#-894"><span class="linenos"> 894</span></a>            <span class="p">:,</span> <span class="p">:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top_lith_indices</span>
</span><span id="Closures.create_closures-895"><a href="#-895"><span class="linenos"> 895</span></a>        <span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Closures.create_closures-896"><a href="#-896"><span class="linenos"> 896</span></a>        <span class="n">depth_maps_gaps_all_lith</span> <span class="o">=</span> <span class="n">old_depth_maps_gaps</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">all_lith_indices</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Closures.create_closures-897"><a href="#-897"><span class="linenos"> 897</span></a>        <span class="n">depth_maps_top_lith</span> <span class="o">=</span> <span class="n">old_depth_maps</span><span class="p">[:,</span> <span class="p">:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top_lith_indices</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Closures.create_closures-898"><a href="#-898"><span class="linenos"> 898</span></a>        <span class="n">depth_maps_all_lith</span> <span class="o">=</span> <span class="n">old_depth_maps</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">all_lith_indices</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Closures.create_closures-899"><a href="#-899"><span class="linenos"> 899</span></a>        <span class="n">max_column_heights</span> <span class="o">=</span> <span class="n">variable_max_column_height</span><span class="p">(</span>
</span><span id="Closures.create_closures-900"><a href="#-900"><span class="linenos"> 900</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">top_lith_indices</span><span class="p">,</span>
</span><span id="Closures.create_closures-901"><a href="#-901"><span class="linenos"> 901</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">faulted_depth_maps_gaps</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
</span><span id="Closures.create_closures-902"><a href="#-902"><span class="linenos"> 902</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">max_column_height</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
</span><span id="Closures.create_closures-903"><a href="#-903"><span class="linenos"> 903</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">max_column_height</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
</span><span id="Closures.create_closures-904"><a href="#-904"><span class="linenos"> 904</span></a>        <span class="p">)</span>
</span><span id="Closures.create_closures-905"><a href="#-905"><span class="linenos"> 905</span></a>        <span class="n">all_max_column_heights</span> <span class="o">=</span> <span class="n">variable_max_column_height</span><span class="p">(</span>
</span><span id="Closures.create_closures-906"><a href="#-906"><span class="linenos"> 906</span></a>            <span class="n">all_lith_indices</span><span class="p">,</span>
</span><span id="Closures.create_closures-907"><a href="#-907"><span class="linenos"> 907</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">faulted_depth_maps_gaps</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
</span><span id="Closures.create_closures-908"><a href="#-908"><span class="linenos"> 908</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">max_column_height</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
</span><span id="Closures.create_closures-909"><a href="#-909"><span class="linenos"> 909</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">max_column_height</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
</span><span id="Closures.create_closures-910"><a href="#-910"><span class="linenos"> 910</span></a>        <span class="p">)</span>
</span><span id="Closures.create_closures-911"><a href="#-911"><span class="linenos"> 911</span></a>
</span><span id="Closures.create_closures-912"><a href="#-912"><span class="linenos"> 912</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Closures.create_closures-913"><a href="#-913"><span class="linenos"> 913</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">   ...facies for closure computations...</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top_lith_facies</span><span class="p">)</span>
</span><span id="Closures.create_closures-914"><a href="#-914"><span class="linenos"> 914</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="Closures.create_closures-915"><a href="#-915"><span class="linenos"> 915</span></a>                <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">   ...max column heights for closure computations...</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="Closures.create_closures-916"><a href="#-916"><span class="linenos"> 916</span></a>                <span class="n">max_column_heights</span><span class="p">,</span>
</span><span id="Closures.create_closures-917"><a href="#-917"><span class="linenos"> 917</span></a>            <span class="p">)</span>
</span><span id="Closures.create_closures-918"><a href="#-918"><span class="linenos"> 918</span></a>
</span><span id="Closures.create_closures-919"><a href="#-919"><span class="linenos"> 919</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">closure_segments</span><span class="p">[:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_closure_labels_from_depth_maps</span><span class="p">(</span>
</span><span id="Closures.create_closures-920"><a href="#-920"><span class="linenos"> 920</span></a>            <span class="n">depth_maps_gaps_top_lith</span><span class="p">,</span> <span class="n">depth_maps_top_lith</span><span class="p">,</span> <span class="n">max_column_heights</span>
</span><span id="Closures.create_closures-921"><a href="#-921"><span class="linenos"> 921</span></a>        <span class="p">)</span>
</span><span id="Closures.create_closures-922"><a href="#-922"><span class="linenos"> 922</span></a>
</span><span id="Closures.create_closures-923"><a href="#-923"><span class="linenos"> 923</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">all_closure_segments</span><span class="p">[:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_closure_labels_from_all_depth_maps</span><span class="p">(</span>
</span><span id="Closures.create_closures-924"><a href="#-924"><span class="linenos"> 924</span></a>            <span class="n">depth_maps_gaps_all_lith</span><span class="p">,</span> <span class="n">depth_maps_all_lith</span><span class="p">,</span> <span class="n">all_max_column_heights</span>
</span><span id="Closures.create_closures-925"><a href="#-925"><span class="linenos"> 925</span></a>        <span class="p">)</span>
</span><span id="Closures.create_closures-926"><a href="#-926"><span class="linenos"> 926</span></a>
</span><span id="Closures.create_closures-927"><a href="#-927"><span class="linenos"> 927</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Closures.create_closures-928"><a href="#-928"><span class="linenos"> 928</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="Closures.create_closures-929"><a href="#-929"><span class="linenos"> 929</span></a>                <span class="s2">&quot;     ...+++... number of nan&#39;s in depth_maps_gaps before insertClosureLabels3D ...+++... </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="Closures.create_closures-930"><a href="#-930"><span class="linenos"> 930</span></a>                    <span class="n">old_depth_maps_gaps</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">old_depth_maps_gaps</span><span class="p">)]</span><span class="o">.</span><span class="n">shape</span>
</span><span id="Closures.create_closures-931"><a href="#-931"><span class="linenos"> 931</span></a>                <span class="p">)</span>
</span><span id="Closures.create_closures-932"><a href="#-932"><span class="linenos"> 932</span></a>            <span class="p">)</span>
</span><span id="Closures.create_closures-933"><a href="#-933"><span class="linenos"> 933</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="Closures.create_closures-934"><a href="#-934"><span class="linenos"> 934</span></a>                <span class="s2">&quot;     ...+++... number of nan&#39;s in depth_maps_gaps after insertClosureLabels3D ...+++... </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="Closures.create_closures-935"><a href="#-935"><span class="linenos"> 935</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">faulted_depth_maps_gaps</span><span class="p">[</span>
</span><span id="Closures.create_closures-936"><a href="#-936"><span class="linenos"> 936</span></a>                        <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">faulted_depth_maps_gaps</span><span class="p">)</span>
</span><span id="Closures.create_closures-937"><a href="#-937"><span class="linenos"> 937</span></a>                    <span class="p">]</span><span class="o">.</span><span class="n">shape</span>
</span><span id="Closures.create_closures-938"><a href="#-938"><span class="linenos"> 938</span></a>                <span class="p">)</span>
</span><span id="Closures.create_closures-939"><a href="#-939"><span class="linenos"> 939</span></a>            <span class="p">)</span>
</span><span id="Closures.create_closures-940"><a href="#-940"><span class="linenos"> 940</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="Closures.create_closures-941"><a href="#-941"><span class="linenos"> 941</span></a>                <span class="s2">&quot;     ...+++... number of nan&#39;s in depth_maps after insertClosureLabels3D ...+++... </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="Closures.create_closures-942"><a href="#-942"><span class="linenos"> 942</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">faulted_depth_maps</span><span class="p">[</span>
</span><span id="Closures.create_closures-943"><a href="#-943"><span class="linenos"> 943</span></a>                        <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">faulted_depth_maps</span><span class="p">)</span>
</span><span id="Closures.create_closures-944"><a href="#-944"><span class="linenos"> 944</span></a>                    <span class="p">]</span><span class="o">.</span><span class="n">shape</span>
</span><span id="Closures.create_closures-945"><a href="#-945"><span class="linenos"> 945</span></a>                <span class="p">)</span>
</span><span id="Closures.create_closures-946"><a href="#-946"><span class="linenos"> 946</span></a>            <span class="p">)</span>
</span><span id="Closures.create_closures-947"><a href="#-947"><span class="linenos"> 947</span></a>            <span class="n">_closure_segments</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">closure_segments</span><span class="p">[:]</span>
</span><span id="Closures.create_closures-948"><a href="#-948"><span class="linenos"> 948</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="Closures.create_closures-949"><a href="#-949"><span class="linenos"> 949</span></a>                <span class="s2">&quot;     ...+++... number of closure voxels in self.closure_segments ...+++... </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="Closures.create_closures-950"><a href="#-950"><span class="linenos"> 950</span></a>                    <span class="n">_closure_segments</span><span class="p">[</span><span class="n">_closure_segments</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span>
</span><span id="Closures.create_closures-951"><a href="#-951"><span class="linenos"> 951</span></a>                <span class="p">)</span>
</span><span id="Closures.create_closures-952"><a href="#-952"><span class="linenos"> 952</span></a>            <span class="p">)</span>
</span><span id="Closures.create_closures-953"><a href="#-953"><span class="linenos"> 953</span></a>            <span class="k">del</span> <span class="n">_closure_segments</span>
</span><span id="Closures.create_closures-954"><a href="#-954"><span class="linenos"> 954</span></a>
</span><span id="Closures.create_closures-955"><a href="#-955"><span class="linenos"> 955</span></a>        <span class="n">labels_clean</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">closure_segments</span><span class="p">[:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">segment_closures</span><span class="p">(</span>
</span><span id="Closures.create_closures-956"><a href="#-956"><span class="linenos"> 956</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">closure_segments</span><span class="p">[:],</span> <span class="n">remove_shale</span><span class="o">=</span><span class="kc">True</span>
</span><span id="Closures.create_closures-957"><a href="#-957"><span class="linenos"> 957</span></a>        <span class="p">)</span>
</span><span id="Closures.create_closures-958"><a href="#-958"><span class="linenos"> 958</span></a>        <span class="n">label_values</span><span class="p">,</span> <span class="n">labels_clean</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_label_values_and_counts</span><span class="p">(</span><span class="n">labels_clean</span><span class="p">)</span>
</span><span id="Closures.create_closures-959"><a href="#-959"><span class="linenos"> 959</span></a>
</span><span id="Closures.create_closures-960"><a href="#-960"><span class="linenos"> 960</span></a>        <span class="n">labels_clean_all</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_closure_segments</span><span class="p">[:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">segment_closures</span><span class="p">(</span>
</span><span id="Closures.create_closures-961"><a href="#-961"><span class="linenos"> 961</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">all_closure_segments</span><span class="p">[:],</span> <span class="n">remove_shale</span><span class="o">=</span><span class="kc">False</span>
</span><span id="Closures.create_closures-962"><a href="#-962"><span class="linenos"> 962</span></a>        <span class="p">)</span>
</span><span id="Closures.create_closures-963"><a href="#-963"><span class="linenos"> 963</span></a>        <span class="n">label_values_all</span><span class="p">,</span> <span class="n">labels_clean_all</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_label_values_and_counts</span><span class="p">(</span>
</span><span id="Closures.create_closures-964"><a href="#-964"><span class="linenos"> 964</span></a>            <span class="n">labels_clean_all</span>
</span><span id="Closures.create_closures-965"><a href="#-965"><span class="linenos"> 965</span></a>        <span class="p">)</span>
</span><span id="Closures.create_closures-966"><a href="#-966"><span class="linenos"> 966</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">write_cube_to_disk</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">all_closure_segments</span><span class="p">[:],</span> <span class="s2">&quot;all_closure_segments&quot;</span><span class="p">)</span>
</span><span id="Closures.create_closures-967"><a href="#-967"><span class="linenos"> 967</span></a>
</span><span id="Closures.create_closures-968"><a href="#-968"><span class="linenos"> 968</span></a>        <span class="c1"># Assign fluid types</span>
</span><span id="Closures.create_closures-969"><a href="#-969"><span class="linenos"> 969</span></a>        <span class="p">(</span>
</span><span id="Closures.create_closures-970"><a href="#-970"><span class="linenos"> 970</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">oil_closures</span><span class="p">[:],</span>
</span><span id="Closures.create_closures-971"><a href="#-971"><span class="linenos"> 971</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">gas_closures</span><span class="p">[:],</span>
</span><span id="Closures.create_closures-972"><a href="#-972"><span class="linenos"> 972</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">brine_closures</span><span class="p">[:],</span>
</span><span id="Closures.create_closures-973"><a href="#-973"><span class="linenos"> 973</span></a>        <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assign_fluid_types</span><span class="p">(</span><span class="n">label_values</span><span class="p">,</span> <span class="n">labels_clean</span><span class="p">)</span>
</span><span id="Closures.create_closures-974"><a href="#-974"><span class="linenos"> 974</span></a>        <span class="n">all_closures_final</span> <span class="o">=</span> <span class="p">(</span><span class="n">labels_clean_all</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;uint8&quot;</span><span class="p">)</span>
</span><span id="Closures.create_closures-975"><a href="#-975"><span class="linenos"> 975</span></a>
</span><span id="Closures.create_closures-976"><a href="#-976"><span class="linenos"> 976</span></a>        <span class="c1"># Identify closures by type (simple, faulted, onlap or salt bounded)</span>
</span><span id="Closures.create_closures-977"><a href="#-977"><span class="linenos"> 977</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">find_faulted_closures</span><span class="p">(</span><span class="n">label_values</span><span class="p">,</span> <span class="n">labels_clean</span><span class="p">)</span>
</span><span id="Closures.create_closures-978"><a href="#-978"><span class="linenos"> 978</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">find_onlap_closures</span><span class="p">(</span><span class="n">label_values</span><span class="p">,</span> <span class="n">labels_clean</span><span class="p">)</span>
</span><span id="Closures.create_closures-979"><a href="#-979"><span class="linenos"> 979</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">find_simple_closures</span><span class="p">(</span><span class="n">label_values</span><span class="p">,</span> <span class="n">labels_clean</span><span class="p">)</span>
</span><span id="Closures.create_closures-980"><a href="#-980"><span class="linenos"> 980</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">find_false_closures</span><span class="p">(</span><span class="n">label_values</span><span class="p">,</span> <span class="n">labels_clean</span><span class="p">)</span>
</span><span id="Closures.create_closures-981"><a href="#-981"><span class="linenos"> 981</span></a>
</span><span id="Closures.create_closures-982"><a href="#-982"><span class="linenos"> 982</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">find_faulted_all_closures</span><span class="p">(</span><span class="n">label_values_all</span><span class="p">,</span> <span class="n">labels_clean_all</span><span class="p">)</span>
</span><span id="Closures.create_closures-983"><a href="#-983"><span class="linenos"> 983</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">find_onlap_all_closures</span><span class="p">(</span><span class="n">label_values_all</span><span class="p">,</span> <span class="n">labels_clean_all</span><span class="p">)</span>
</span><span id="Closures.create_closures-984"><a href="#-984"><span class="linenos"> 984</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">find_simple_all_closures</span><span class="p">(</span><span class="n">label_values_all</span><span class="p">,</span> <span class="n">labels_clean_all</span><span class="p">)</span>
</span><span id="Closures.create_closures-985"><a href="#-985"><span class="linenos"> 985</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">find_false_all_closures</span><span class="p">(</span><span class="n">label_values_all</span><span class="p">,</span> <span class="n">labels_clean_all</span><span class="p">)</span>
</span><span id="Closures.create_closures-986"><a href="#-986"><span class="linenos"> 986</span></a>
</span><span id="Closures.create_closures-987"><a href="#-987"><span class="linenos"> 987</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">include_salt</span><span class="p">:</span>
</span><span id="Closures.create_closures-988"><a href="#-988"><span class="linenos"> 988</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">find_salt_bounded_closures</span><span class="p">(</span><span class="n">label_values</span><span class="p">,</span> <span class="n">labels_clean</span><span class="p">)</span>
</span><span id="Closures.create_closures-989"><a href="#-989"><span class="linenos"> 989</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">find_salt_bounded_all_closures</span><span class="p">(</span><span class="n">label_values_all</span><span class="p">,</span> <span class="n">labels_clean_all</span><span class="p">)</span>
</span><span id="Closures.create_closures-990"><a href="#-990"><span class="linenos"> 990</span></a>
</span><span id="Closures.create_closures-991"><a href="#-991"><span class="linenos"> 991</span></a>        <span class="c1"># Remove false closures from oil &amp; gas closure cubes</span>
</span><span id="Closures.create_closures-992"><a href="#-992"><span class="linenos"> 992</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_false_closures_oil</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Closures.create_closures-993"><a href="#-993"><span class="linenos"> 993</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Removing </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">n_false_closures_oil</span><span class="si">}</span><span class="s2"> false oil closures&quot;</span><span class="p">)</span>
</span><span id="Closures.create_closures-994"><a href="#-994"><span class="linenos"> 994</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">oil_closures</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">false_closures_oil</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="Closures.create_closures-995"><a href="#-995"><span class="linenos"> 995</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_false_closures_gas</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Closures.create_closures-996"><a href="#-996"><span class="linenos"> 996</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Removing </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">n_false_closures_gas</span><span class="si">}</span><span class="s2"> false gas closures&quot;</span><span class="p">)</span>
</span><span id="Closures.create_closures-997"><a href="#-997"><span class="linenos"> 997</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">gas_closures</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">false_closures_gas</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="Closures.create_closures-998"><a href="#-998"><span class="linenos"> 998</span></a>
</span><span id="Closures.create_closures-999"><a href="#-999"><span class="linenos"> 999</span></a>        <span class="c1"># Remove false closures from allclosure cube</span>
</span><span id="Closures.create_closures-1000"><a href="#-1000"><span class="linenos">1000</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_false_all_closures</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Closures.create_closures-1001"><a href="#-1001"><span class="linenos">1001</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Removing </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">n_false_all_closures</span><span class="si">}</span><span class="s2"> false all closures&quot;</span><span class="p">)</span>
</span><span id="Closures.create_closures-1002"><a href="#-1002"><span class="linenos">1002</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">all_closure_segments</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">false_all_closures</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="Closures.create_closures-1003"><a href="#-1003"><span class="linenos">1003</span></a>
</span><span id="Closures.create_closures-1004"><a href="#-1004"><span class="linenos">1004</span></a>        <span class="c1"># Create a closure cube with voxel count as labels, and include closure type in decimal</span>
</span><span id="Closures.create_closures-1005"><a href="#-1005"><span class="linenos">1005</span></a>        <span class="c1"># e.g. simple closure of size 5000 = 5000.1</span>
</span><span id="Closures.create_closures-1006"><a href="#-1006"><span class="linenos">1006</span></a>        <span class="c1">#      faulted closure of size 5000 = 5000.2</span>
</span><span id="Closures.create_closures-1007"><a href="#-1007"><span class="linenos">1007</span></a>        <span class="c1">#      onlap closure of size 5000 = 5000.3</span>
</span><span id="Closures.create_closures-1008"><a href="#-1008"><span class="linenos">1008</span></a>        <span class="c1">#      salt-bounded closure of size 5000 = 5000.4</span>
</span><span id="Closures.create_closures-1009"><a href="#-1009"><span class="linenos">1009</span></a>        <span class="n">hc_closure_codes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gas_closures</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;float32&quot;</span><span class="p">)</span>
</span><span id="Closures.create_closures-1010"><a href="#-1010"><span class="linenos">1010</span></a>
</span><span id="Closures.create_closures-1011"><a href="#-1011"><span class="linenos">1011</span></a>        <span class="c1"># AZ: COULD RUN THESE CLOSURE SIZE FILTERS ON ALL_CLOSURES, IF DESIRED</span>
</span><span id="Closures.create_closures-1012"><a href="#-1012"><span class="linenos">1012</span></a>
</span><span id="Closures.create_closures-1013"><a href="#-1013"><span class="linenos">1013</span></a>        <span class="k">if</span> <span class="s2">&quot;simple&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">closure_types</span><span class="p">:</span>
</span><span id="Closures.create_closures-1014"><a href="#-1014"><span class="linenos">1014</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Filtering 4 Way Closures&quot;</span><span class="p">)</span>
</span><span id="Closures.create_closures-1015"><a href="#-1015"><span class="linenos">1015</span></a>            <span class="p">(</span>
</span><span id="Closures.create_closures-1016"><a href="#-1016"><span class="linenos">1016</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">simple_closures_oil</span><span class="p">[:],</span>
</span><span id="Closures.create_closures-1017"><a href="#-1017"><span class="linenos">1017</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">n_4way_closures_oil</span><span class="p">,</span>
</span><span id="Closures.create_closures-1018"><a href="#-1018"><span class="linenos">1018</span></a>            <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">closure_size_filter</span><span class="p">(</span>
</span><span id="Closures.create_closures-1019"><a href="#-1019"><span class="linenos">1019</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">simple_closures_oil</span><span class="p">[:],</span>
</span><span id="Closures.create_closures-1020"><a href="#-1020"><span class="linenos">1020</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">closure_min_voxels_simple</span><span class="p">,</span>
</span><span id="Closures.create_closures-1021"><a href="#-1021"><span class="linenos">1021</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">n_4way_closures_oil</span><span class="p">,</span>
</span><span id="Closures.create_closures-1022"><a href="#-1022"><span class="linenos">1022</span></a>            <span class="p">)</span>
</span><span id="Closures.create_closures-1023"><a href="#-1023"><span class="linenos">1023</span></a>            <span class="p">(</span>
</span><span id="Closures.create_closures-1024"><a href="#-1024"><span class="linenos">1024</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">simple_closures_gas</span><span class="p">[:],</span>
</span><span id="Closures.create_closures-1025"><a href="#-1025"><span class="linenos">1025</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">n_4way_closures_gas</span><span class="p">,</span>
</span><span id="Closures.create_closures-1026"><a href="#-1026"><span class="linenos">1026</span></a>            <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">closure_size_filter</span><span class="p">(</span>
</span><span id="Closures.create_closures-1027"><a href="#-1027"><span class="linenos">1027</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">simple_closures_gas</span><span class="p">[:],</span>
</span><span id="Closures.create_closures-1028"><a href="#-1028"><span class="linenos">1028</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">closure_min_voxels_simple</span><span class="p">,</span>
</span><span id="Closures.create_closures-1029"><a href="#-1029"><span class="linenos">1029</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">n_4way_closures_gas</span><span class="p">,</span>
</span><span id="Closures.create_closures-1030"><a href="#-1030"><span class="linenos">1030</span></a>            <span class="p">)</span>
</span><span id="Closures.create_closures-1031"><a href="#-1031"><span class="linenos">1031</span></a>
</span><span id="Closures.create_closures-1032"><a href="#-1032"><span class="linenos">1032</span></a>            <span class="c1"># Add simple closures to closure code cube</span>
</span><span id="Closures.create_closures-1033"><a href="#-1033"><span class="linenos">1033</span></a>            <span class="n">hc_closures</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="Closures.create_closures-1034"><a href="#-1034"><span class="linenos">1034</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">simple_closures_oil</span><span class="p">[:]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">simple_closures_gas</span><span class="p">[:]</span>
</span><span id="Closures.create_closures-1035"><a href="#-1035"><span class="linenos">1035</span></a>            <span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;float32&quot;</span><span class="p">)</span>
</span><span id="Closures.create_closures-1036"><a href="#-1036"><span class="linenos">1036</span></a>            <span class="n">labels</span><span class="p">,</span> <span class="n">num</span> <span class="o">=</span> <span class="n">measure</span><span class="o">.</span><span class="n">label</span><span class="p">(</span>
</span><span id="Closures.create_closures-1037"><a href="#-1037"><span class="linenos">1037</span></a>                <span class="n">hc_closures</span><span class="p">,</span> <span class="n">connectivity</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">background</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">return_num</span><span class="o">=</span><span class="kc">True</span>
</span><span id="Closures.create_closures-1038"><a href="#-1038"><span class="linenos">1038</span></a>            <span class="p">)</span>
</span><span id="Closures.create_closures-1039"><a href="#-1039"><span class="linenos">1039</span></a>            <span class="n">hc_closure_codes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_closure_codes</span><span class="p">(</span>
</span><span id="Closures.create_closures-1040"><a href="#-1040"><span class="linenos">1040</span></a>                <span class="n">hc_closure_codes</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">num</span><span class="p">,</span> <span class="n">code</span><span class="o">=</span><span class="mf">0.1</span>
</span><span id="Closures.create_closures-1041"><a href="#-1041"><span class="linenos">1041</span></a>            <span class="p">)</span>
</span><span id="Closures.create_closures-1042"><a href="#-1042"><span class="linenos">1042</span></a>        <span class="k">else</span><span class="p">:</span>  <span class="c1"># if closure type not in config, set HC closures to 0</span>
</span><span id="Closures.create_closures-1043"><a href="#-1043"><span class="linenos">1043</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">simple_closures_oil</span><span class="p">[:]</span> <span class="o">*=</span> <span class="mi">0</span>
</span><span id="Closures.create_closures-1044"><a href="#-1044"><span class="linenos">1044</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">simple_closures_gas</span><span class="p">[:]</span> <span class="o">*=</span> <span class="mi">0</span>
</span><span id="Closures.create_closures-1045"><a href="#-1045"><span class="linenos">1045</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">simple_all_closures</span><span class="p">[:]</span> <span class="o">*=</span> <span class="mi">0</span>
</span><span id="Closures.create_closures-1046"><a href="#-1046"><span class="linenos">1046</span></a>
</span><span id="Closures.create_closures-1047"><a href="#-1047"><span class="linenos">1047</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">oil_closures</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">simple_closures_oil</span><span class="p">[:]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="Closures.create_closures-1048"><a href="#-1048"><span class="linenos">1048</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">oil_closures</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">simple_closures_oil</span><span class="p">[:]</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="Closures.create_closures-1049"><a href="#-1049"><span class="linenos">1049</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gas_closures</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">simple_closures_gas</span><span class="p">[:]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="Closures.create_closures-1050"><a href="#-1050"><span class="linenos">1050</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gas_closures</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">simple_closures_gas</span><span class="p">[:]</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="Closures.create_closures-1051"><a href="#-1051"><span class="linenos">1051</span></a>
</span><span id="Closures.create_closures-1052"><a href="#-1052"><span class="linenos">1052</span></a>        <span class="n">all_closures_final</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">simple_all_closures</span><span class="p">[:]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="Closures.create_closures-1053"><a href="#-1053"><span class="linenos">1053</span></a>        <span class="n">all_closures_final</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">simple_all_closures</span><span class="p">[:]</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="Closures.create_closures-1054"><a href="#-1054"><span class="linenos">1054</span></a>
</span><span id="Closures.create_closures-1055"><a href="#-1055"><span class="linenos">1055</span></a>        <span class="k">if</span> <span class="s2">&quot;faulted&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">closure_types</span><span class="p">:</span>
</span><span id="Closures.create_closures-1056"><a href="#-1056"><span class="linenos">1056</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Filtering 4 Way Closures&quot;</span><span class="p">)</span>
</span><span id="Closures.create_closures-1057"><a href="#-1057"><span class="linenos">1057</span></a>            <span class="c1"># Grow the faulted closures to the fault planes</span>
</span><span id="Closures.create_closures-1058"><a href="#-1058"><span class="linenos">1058</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">faulted_closures_oil</span><span class="p">[:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grow_to_fault2</span><span class="p">(</span>
</span><span id="Closures.create_closures-1059"><a href="#-1059"><span class="linenos">1059</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">faulted_closures_oil</span><span class="p">[:]</span>
</span><span id="Closures.create_closures-1060"><a href="#-1060"><span class="linenos">1060</span></a>            <span class="p">)</span>
</span><span id="Closures.create_closures-1061"><a href="#-1061"><span class="linenos">1061</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">faulted_closures_gas</span><span class="p">[:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grow_to_fault2</span><span class="p">(</span>
</span><span id="Closures.create_closures-1062"><a href="#-1062"><span class="linenos">1062</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">faulted_closures_gas</span><span class="p">[:]</span>
</span><span id="Closures.create_closures-1063"><a href="#-1063"><span class="linenos">1063</span></a>            <span class="p">)</span>
</span><span id="Closures.create_closures-1064"><a href="#-1064"><span class="linenos">1064</span></a>
</span><span id="Closures.create_closures-1065"><a href="#-1065"><span class="linenos">1065</span></a>            <span class="p">(</span>
</span><span id="Closures.create_closures-1066"><a href="#-1066"><span class="linenos">1066</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">faulted_closures_oil</span><span class="p">[:],</span>
</span><span id="Closures.create_closures-1067"><a href="#-1067"><span class="linenos">1067</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">n_fault_closures_oil</span><span class="p">,</span>
</span><span id="Closures.create_closures-1068"><a href="#-1068"><span class="linenos">1068</span></a>            <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">closure_size_filter</span><span class="p">(</span>
</span><span id="Closures.create_closures-1069"><a href="#-1069"><span class="linenos">1069</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">faulted_closures_oil</span><span class="p">[:],</span>
</span><span id="Closures.create_closures-1070"><a href="#-1070"><span class="linenos">1070</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">closure_min_voxels_faulted</span><span class="p">,</span>
</span><span id="Closures.create_closures-1071"><a href="#-1071"><span class="linenos">1071</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">n_fault_closures_oil</span><span class="p">,</span>
</span><span id="Closures.create_closures-1072"><a href="#-1072"><span class="linenos">1072</span></a>            <span class="p">)</span>
</span><span id="Closures.create_closures-1073"><a href="#-1073"><span class="linenos">1073</span></a>            <span class="p">(</span>
</span><span id="Closures.create_closures-1074"><a href="#-1074"><span class="linenos">1074</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">faulted_closures_gas</span><span class="p">[:],</span>
</span><span id="Closures.create_closures-1075"><a href="#-1075"><span class="linenos">1075</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">n_fault_closures_gas</span><span class="p">,</span>
</span><span id="Closures.create_closures-1076"><a href="#-1076"><span class="linenos">1076</span></a>            <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">closure_size_filter</span><span class="p">(</span>
</span><span id="Closures.create_closures-1077"><a href="#-1077"><span class="linenos">1077</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">faulted_closures_gas</span><span class="p">[:],</span>
</span><span id="Closures.create_closures-1078"><a href="#-1078"><span class="linenos">1078</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">closure_min_voxels_faulted</span><span class="p">,</span>
</span><span id="Closures.create_closures-1079"><a href="#-1079"><span class="linenos">1079</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">n_fault_closures_gas</span><span class="p">,</span>
</span><span id="Closures.create_closures-1080"><a href="#-1080"><span class="linenos">1080</span></a>            <span class="p">)</span>
</span><span id="Closures.create_closures-1081"><a href="#-1081"><span class="linenos">1081</span></a>
</span><span id="Closures.create_closures-1082"><a href="#-1082"><span class="linenos">1082</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">faulted_all_closures</span><span class="p">[:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grow_to_fault2</span><span class="p">(</span>
</span><span id="Closures.create_closures-1083"><a href="#-1083"><span class="linenos">1083</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">faulted_all_closures</span><span class="p">[:],</span>
</span><span id="Closures.create_closures-1084"><a href="#-1084"><span class="linenos">1084</span></a>                <span class="n">grow_only_sand_closures</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="Closures.create_closures-1085"><a href="#-1085"><span class="linenos">1085</span></a>                <span class="n">remove_small_closures</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="Closures.create_closures-1086"><a href="#-1086"><span class="linenos">1086</span></a>            <span class="p">)</span>
</span><span id="Closures.create_closures-1087"><a href="#-1087"><span class="linenos">1087</span></a>
</span><span id="Closures.create_closures-1088"><a href="#-1088"><span class="linenos">1088</span></a>            <span class="c1"># Add faulted closures to closure code cube</span>
</span><span id="Closures.create_closures-1089"><a href="#-1089"><span class="linenos">1089</span></a>            <span class="n">hc_closures</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">faulted_closures_oil</span><span class="p">[:]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">faulted_closures_gas</span><span class="p">[:]</span>
</span><span id="Closures.create_closures-1090"><a href="#-1090"><span class="linenos">1090</span></a>            <span class="n">labels</span><span class="p">,</span> <span class="n">num</span> <span class="o">=</span> <span class="n">measure</span><span class="o">.</span><span class="n">label</span><span class="p">(</span>
</span><span id="Closures.create_closures-1091"><a href="#-1091"><span class="linenos">1091</span></a>                <span class="n">hc_closures</span><span class="p">,</span> <span class="n">connectivity</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">background</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">return_num</span><span class="o">=</span><span class="kc">True</span>
</span><span id="Closures.create_closures-1092"><a href="#-1092"><span class="linenos">1092</span></a>            <span class="p">)</span>
</span><span id="Closures.create_closures-1093"><a href="#-1093"><span class="linenos">1093</span></a>            <span class="n">hc_closure_codes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_closure_codes</span><span class="p">(</span>
</span><span id="Closures.create_closures-1094"><a href="#-1094"><span class="linenos">1094</span></a>                <span class="n">hc_closure_codes</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">num</span><span class="p">,</span> <span class="n">code</span><span class="o">=</span><span class="mf">0.2</span>
</span><span id="Closures.create_closures-1095"><a href="#-1095"><span class="linenos">1095</span></a>            <span class="p">)</span>
</span><span id="Closures.create_closures-1096"><a href="#-1096"><span class="linenos">1096</span></a>        <span class="k">else</span><span class="p">:</span>  <span class="c1"># if closure type not in config, set HC closures to 0</span>
</span><span id="Closures.create_closures-1097"><a href="#-1097"><span class="linenos">1097</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">faulted_closures_oil</span><span class="p">[:]</span> <span class="o">*=</span> <span class="mi">0</span>
</span><span id="Closures.create_closures-1098"><a href="#-1098"><span class="linenos">1098</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">faulted_closures_gas</span><span class="p">[:]</span> <span class="o">*=</span> <span class="mi">0</span>
</span><span id="Closures.create_closures-1099"><a href="#-1099"><span class="linenos">1099</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">faulted_all_closures</span><span class="p">[:]</span> <span class="o">*=</span> <span class="mi">0</span>
</span><span id="Closures.create_closures-1100"><a href="#-1100"><span class="linenos">1100</span></a>
</span><span id="Closures.create_closures-1101"><a href="#-1101"><span class="linenos">1101</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">oil_closures</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">faulted_closures_oil</span><span class="p">[:]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="Closures.create_closures-1102"><a href="#-1102"><span class="linenos">1102</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">oil_closures</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">faulted_closures_oil</span><span class="p">[:]</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="Closures.create_closures-1103"><a href="#-1103"><span class="linenos">1103</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gas_closures</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">faulted_closures_gas</span><span class="p">[:]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="Closures.create_closures-1104"><a href="#-1104"><span class="linenos">1104</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gas_closures</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">faulted_closures_gas</span><span class="p">[:]</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="Closures.create_closures-1105"><a href="#-1105"><span class="linenos">1105</span></a>
</span><span id="Closures.create_closures-1106"><a href="#-1106"><span class="linenos">1106</span></a>        <span class="n">all_closures_final</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">faulted_all_closures</span><span class="p">[:]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="Closures.create_closures-1107"><a href="#-1107"><span class="linenos">1107</span></a>        <span class="n">all_closures_final</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">faulted_all_closures</span><span class="p">[:]</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="Closures.create_closures-1108"><a href="#-1108"><span class="linenos">1108</span></a>
</span><span id="Closures.create_closures-1109"><a href="#-1109"><span class="linenos">1109</span></a>        <span class="k">if</span> <span class="s2">&quot;onlap&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">closure_types</span><span class="p">:</span>
</span><span id="Closures.create_closures-1110"><a href="#-1110"><span class="linenos">1110</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Filtering Onlap Closures&quot;</span><span class="p">)</span>
</span><span id="Closures.create_closures-1111"><a href="#-1111"><span class="linenos">1111</span></a>            <span class="p">(</span>
</span><span id="Closures.create_closures-1112"><a href="#-1112"><span class="linenos">1112</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">onlap_closures_oil</span><span class="p">[:],</span>
</span><span id="Closures.create_closures-1113"><a href="#-1113"><span class="linenos">1113</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">n_onlap_closures_oil</span><span class="p">,</span>
</span><span id="Closures.create_closures-1114"><a href="#-1114"><span class="linenos">1114</span></a>            <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">closure_size_filter</span><span class="p">(</span>
</span><span id="Closures.create_closures-1115"><a href="#-1115"><span class="linenos">1115</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">onlap_closures_oil</span><span class="p">[:],</span>
</span><span id="Closures.create_closures-1116"><a href="#-1116"><span class="linenos">1116</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">closure_min_voxels_onlap</span><span class="p">,</span>
</span><span id="Closures.create_closures-1117"><a href="#-1117"><span class="linenos">1117</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">n_onlap_closures_oil</span><span class="p">,</span>
</span><span id="Closures.create_closures-1118"><a href="#-1118"><span class="linenos">1118</span></a>            <span class="p">)</span>
</span><span id="Closures.create_closures-1119"><a href="#-1119"><span class="linenos">1119</span></a>            <span class="p">(</span>
</span><span id="Closures.create_closures-1120"><a href="#-1120"><span class="linenos">1120</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">onlap_closures_gas</span><span class="p">[:],</span>
</span><span id="Closures.create_closures-1121"><a href="#-1121"><span class="linenos">1121</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">n_onlap_closures_gas</span><span class="p">,</span>
</span><span id="Closures.create_closures-1122"><a href="#-1122"><span class="linenos">1122</span></a>            <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">closure_size_filter</span><span class="p">(</span>
</span><span id="Closures.create_closures-1123"><a href="#-1123"><span class="linenos">1123</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">onlap_closures_gas</span><span class="p">[:],</span>
</span><span id="Closures.create_closures-1124"><a href="#-1124"><span class="linenos">1124</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">closure_min_voxels_onlap</span><span class="p">,</span>
</span><span id="Closures.create_closures-1125"><a href="#-1125"><span class="linenos">1125</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">n_onlap_closures_gas</span><span class="p">,</span>
</span><span id="Closures.create_closures-1126"><a href="#-1126"><span class="linenos">1126</span></a>            <span class="p">)</span>
</span><span id="Closures.create_closures-1127"><a href="#-1127"><span class="linenos">1127</span></a>
</span><span id="Closures.create_closures-1128"><a href="#-1128"><span class="linenos">1128</span></a>            <span class="c1"># Add faulted closures to closure code cube</span>
</span><span id="Closures.create_closures-1129"><a href="#-1129"><span class="linenos">1129</span></a>            <span class="n">hc_closures</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">onlap_closures_oil</span><span class="p">[:]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">onlap_closures_gas</span><span class="p">[:]</span>
</span><span id="Closures.create_closures-1130"><a href="#-1130"><span class="linenos">1130</span></a>            <span class="n">labels</span><span class="p">,</span> <span class="n">num</span> <span class="o">=</span> <span class="n">measure</span><span class="o">.</span><span class="n">label</span><span class="p">(</span>
</span><span id="Closures.create_closures-1131"><a href="#-1131"><span class="linenos">1131</span></a>                <span class="n">hc_closures</span><span class="p">,</span> <span class="n">connectivity</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">background</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">return_num</span><span class="o">=</span><span class="kc">True</span>
</span><span id="Closures.create_closures-1132"><a href="#-1132"><span class="linenos">1132</span></a>            <span class="p">)</span>
</span><span id="Closures.create_closures-1133"><a href="#-1133"><span class="linenos">1133</span></a>            <span class="n">hc_closure_codes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_closure_codes</span><span class="p">(</span>
</span><span id="Closures.create_closures-1134"><a href="#-1134"><span class="linenos">1134</span></a>                <span class="n">hc_closure_codes</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">num</span><span class="p">,</span> <span class="n">code</span><span class="o">=</span><span class="mf">0.3</span>
</span><span id="Closures.create_closures-1135"><a href="#-1135"><span class="linenos">1135</span></a>            <span class="p">)</span>
</span><span id="Closures.create_closures-1136"><a href="#-1136"><span class="linenos">1136</span></a>            <span class="c1"># labels = labels.astype(&#39;float32&#39;)</span>
</span><span id="Closures.create_closures-1137"><a href="#-1137"><span class="linenos">1137</span></a>            <span class="c1"># if num &gt; 0:</span>
</span><span id="Closures.create_closures-1138"><a href="#-1138"><span class="linenos">1138</span></a>            <span class="c1">#     for x in range(1, num + 1):</span>
</span><span id="Closures.create_closures-1139"><a href="#-1139"><span class="linenos">1139</span></a>            <span class="c1">#         y = 0.3 + labels[labels == x].size</span>
</span><span id="Closures.create_closures-1140"><a href="#-1140"><span class="linenos">1140</span></a>            <span class="c1">#         labels[labels == x] = y</span>
</span><span id="Closures.create_closures-1141"><a href="#-1141"><span class="linenos">1141</span></a>            <span class="c1">#     hc_closure_codes += labels</span>
</span><span id="Closures.create_closures-1142"><a href="#-1142"><span class="linenos">1142</span></a>        <span class="k">else</span><span class="p">:</span>  <span class="c1"># if closure type not in config, set HC closures to 0</span>
</span><span id="Closures.create_closures-1143"><a href="#-1143"><span class="linenos">1143</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">onlap_closures_oil</span><span class="p">[:]</span> <span class="o">*=</span> <span class="mi">0</span>
</span><span id="Closures.create_closures-1144"><a href="#-1144"><span class="linenos">1144</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">onlap_closures_gas</span><span class="p">[:]</span> <span class="o">*=</span> <span class="mi">0</span>
</span><span id="Closures.create_closures-1145"><a href="#-1145"><span class="linenos">1145</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">onlap_all_closures</span><span class="p">[:]</span> <span class="o">*=</span> <span class="mi">0</span>
</span><span id="Closures.create_closures-1146"><a href="#-1146"><span class="linenos">1146</span></a>
</span><span id="Closures.create_closures-1147"><a href="#-1147"><span class="linenos">1147</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">oil_closures</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">onlap_closures_oil</span><span class="p">[:]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="Closures.create_closures-1148"><a href="#-1148"><span class="linenos">1148</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">oil_closures</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">onlap_closures_oil</span><span class="p">[:]</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="Closures.create_closures-1149"><a href="#-1149"><span class="linenos">1149</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gas_closures</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">onlap_closures_gas</span><span class="p">[:]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="Closures.create_closures-1150"><a href="#-1150"><span class="linenos">1150</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gas_closures</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">onlap_closures_gas</span><span class="p">[:]</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="Closures.create_closures-1151"><a href="#-1151"><span class="linenos">1151</span></a>        <span class="n">all_closures_final</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">onlap_all_closures</span><span class="p">[:]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="Closures.create_closures-1152"><a href="#-1152"><span class="linenos">1152</span></a>        <span class="n">all_closures_final</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">onlap_all_closures</span><span class="p">[:]</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="Closures.create_closures-1153"><a href="#-1153"><span class="linenos">1153</span></a>
</span><span id="Closures.create_closures-1154"><a href="#-1154"><span class="linenos">1154</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">include_salt</span><span class="p">:</span>
</span><span id="Closures.create_closures-1155"><a href="#-1155"><span class="linenos">1155</span></a>            <span class="c1"># Grow the salt-bounded closures to the salt body</span>
</span><span id="Closures.create_closures-1156"><a href="#-1156"><span class="linenos">1156</span></a>            <span class="n">salt_closures_oil_grown</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">salt_closures_oil</span><span class="p">[:])</span>
</span><span id="Closures.create_closures-1157"><a href="#-1157"><span class="linenos">1157</span></a>            <span class="n">salt_closures_gas_grown</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">salt_closures_gas</span><span class="p">[:])</span>
</span><span id="Closures.create_closures-1158"><a href="#-1158"><span class="linenos">1158</span></a>
</span><span id="Closures.create_closures-1159"><a href="#-1159"><span class="linenos">1159</span></a>            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">salt_closures_oil</span><span class="p">[:])</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
</span><span id="Closures.create_closures-1160"><a href="#-1160"><span class="linenos">1160</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">write_cube_to_disk</span><span class="p">(</span>
</span><span id="Closures.create_closures-1161"><a href="#-1161"><span class="linenos">1161</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">salt_closures_oil</span><span class="p">[:],</span> <span class="s2">&quot;salt_closures_oil_initial&quot;</span>
</span><span id="Closures.create_closures-1162"><a href="#-1162"><span class="linenos">1162</span></a>                <span class="p">)</span>
</span><span id="Closures.create_closures-1163"><a href="#-1163"><span class="linenos">1163</span></a>                <span class="nb">print</span><span class="p">(</span>
</span><span id="Closures.create_closures-1164"><a href="#-1164"><span class="linenos">1164</span></a>                    <span class="sa">f</span><span class="s2">&quot;Salt-bounded Oil Closure voxel count: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">salt_closures_oil</span><span class="p">[:][</span><span class="bp">self</span><span class="o">.</span><span class="n">salt_closures_oil</span><span class="p">[:]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Closures.create_closures-1165"><a href="#-1165"><span class="linenos">1165</span></a>                <span class="p">)</span>
</span><span id="Closures.create_closures-1166"><a href="#-1166"><span class="linenos">1166</span></a>                <span class="n">salt_closures_oil_grown</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grow_to_salt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">salt_closures_oil</span><span class="p">[:])</span>
</span><span id="Closures.create_closures-1167"><a href="#-1167"><span class="linenos">1167</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">salt_closures_oil</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">salt_closures_oil_grown</span>
</span><span id="Closures.create_closures-1168"><a href="#-1168"><span class="linenos">1168</span></a>                <span class="nb">print</span><span class="p">(</span>
</span><span id="Closures.create_closures-1169"><a href="#-1169"><span class="linenos">1169</span></a>                    <span class="sa">f</span><span class="s2">&quot;Salt-bounded Oil Closure voxel count: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">salt_closures_oil</span><span class="p">[:][</span><span class="bp">self</span><span class="o">.</span><span class="n">salt_closures_oil</span><span class="p">[:]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Closures.create_closures-1170"><a href="#-1170"><span class="linenos">1170</span></a>                <span class="p">)</span>
</span><span id="Closures.create_closures-1171"><a href="#-1171"><span class="linenos">1171</span></a>            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">salt_closures_gas</span><span class="p">[:])</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
</span><span id="Closures.create_closures-1172"><a href="#-1172"><span class="linenos">1172</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">write_cube_to_disk</span><span class="p">(</span>
</span><span id="Closures.create_closures-1173"><a href="#-1173"><span class="linenos">1173</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">salt_closures_gas</span><span class="p">[:],</span> <span class="s2">&quot;salt_closures_gas_initial&quot;</span>
</span><span id="Closures.create_closures-1174"><a href="#-1174"><span class="linenos">1174</span></a>                <span class="p">)</span>
</span><span id="Closures.create_closures-1175"><a href="#-1175"><span class="linenos">1175</span></a>                <span class="nb">print</span><span class="p">(</span>
</span><span id="Closures.create_closures-1176"><a href="#-1176"><span class="linenos">1176</span></a>                    <span class="sa">f</span><span class="s2">&quot;Salt-bounded Gas Closure voxel count: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">salt_closures_gas</span><span class="p">[:][</span><span class="bp">self</span><span class="o">.</span><span class="n">salt_closures_gas</span><span class="p">[:]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Closures.create_closures-1177"><a href="#-1177"><span class="linenos">1177</span></a>                <span class="p">)</span>
</span><span id="Closures.create_closures-1178"><a href="#-1178"><span class="linenos">1178</span></a>                <span class="n">salt_closures_gas_grown</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grow_to_salt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">salt_closures_gas</span><span class="p">[:])</span>
</span><span id="Closures.create_closures-1179"><a href="#-1179"><span class="linenos">1179</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">salt_closures_gas</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">salt_closures_gas_grown</span>
</span><span id="Closures.create_closures-1180"><a href="#-1180"><span class="linenos">1180</span></a>                <span class="nb">print</span><span class="p">(</span>
</span><span id="Closures.create_closures-1181"><a href="#-1181"><span class="linenos">1181</span></a>                    <span class="sa">f</span><span class="s2">&quot;Salt-bounded Gas Closure voxel count: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">salt_closures_gas</span><span class="p">[:][</span><span class="bp">self</span><span class="o">.</span><span class="n">salt_closures_gas</span><span class="p">[:]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Closures.create_closures-1182"><a href="#-1182"><span class="linenos">1182</span></a>                <span class="p">)</span>
</span><span id="Closures.create_closures-1183"><a href="#-1183"><span class="linenos">1183</span></a>            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">salt_all_closures</span><span class="p">[:])</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
</span><span id="Closures.create_closures-1184"><a href="#-1184"><span class="linenos">1184</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">write_cube_to_disk</span><span class="p">(</span>
</span><span id="Closures.create_closures-1185"><a href="#-1185"><span class="linenos">1185</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">salt_all_closures</span><span class="p">[:],</span> <span class="s2">&quot;salt_all_closures_initial&quot;</span>
</span><span id="Closures.create_closures-1186"><a href="#-1186"><span class="linenos">1186</span></a>                <span class="p">)</span>  <span class="c1"># maybe remove later</span>
</span><span id="Closures.create_closures-1187"><a href="#-1187"><span class="linenos">1187</span></a>                <span class="nb">print</span><span class="p">(</span>
</span><span id="Closures.create_closures-1188"><a href="#-1188"><span class="linenos">1188</span></a>                    <span class="sa">f</span><span class="s2">&quot;Salt-bounded All Closure voxel count: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">salt_all_closures</span><span class="p">[:][</span><span class="bp">self</span><span class="o">.</span><span class="n">salt_all_closures</span><span class="p">[:]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Closures.create_closures-1189"><a href="#-1189"><span class="linenos">1189</span></a>                <span class="p">)</span>
</span><span id="Closures.create_closures-1190"><a href="#-1190"><span class="linenos">1190</span></a>                <span class="n">salt_all_closures_grown</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grow_to_salt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">salt_all_closures</span><span class="p">[:])</span>
</span><span id="Closures.create_closures-1191"><a href="#-1191"><span class="linenos">1191</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">salt_all_closures</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">salt_all_closures_grown</span>
</span><span id="Closures.create_closures-1192"><a href="#-1192"><span class="linenos">1192</span></a>                <span class="nb">print</span><span class="p">(</span>
</span><span id="Closures.create_closures-1193"><a href="#-1193"><span class="linenos">1193</span></a>                    <span class="sa">f</span><span class="s2">&quot;Salt-bounded All Closure voxel count: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">salt_all_closures</span><span class="p">[:][</span><span class="bp">self</span><span class="o">.</span><span class="n">salt_all_closures</span><span class="p">[:]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Closures.create_closures-1194"><a href="#-1194"><span class="linenos">1194</span></a>                <span class="p">)</span>
</span><span id="Closures.create_closures-1195"><a href="#-1195"><span class="linenos">1195</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Closures.create_closures-1196"><a href="#-1196"><span class="linenos">1196</span></a>                <span class="n">salt_all_closures_grown</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">salt_all_closures</span><span class="p">)</span>
</span><span id="Closures.create_closures-1197"><a href="#-1197"><span class="linenos">1197</span></a>
</span><span id="Closures.create_closures-1198"><a href="#-1198"><span class="linenos">1198</span></a>            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">salt_closures_oil</span><span class="p">[:])</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
</span><span id="Closures.create_closures-1199"><a href="#-1199"><span class="linenos">1199</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">write_cube_to_disk</span><span class="p">(</span>
</span><span id="Closures.create_closures-1200"><a href="#-1200"><span class="linenos">1200</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">salt_closures_oil</span><span class="p">[:],</span> <span class="s2">&quot;salt_closures_oil_grown&quot;</span>
</span><span id="Closures.create_closures-1201"><a href="#-1201"><span class="linenos">1201</span></a>                <span class="p">)</span>
</span><span id="Closures.create_closures-1202"><a href="#-1202"><span class="linenos">1202</span></a>            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">salt_closures_gas</span><span class="p">[:])</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
</span><span id="Closures.create_closures-1203"><a href="#-1203"><span class="linenos">1203</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">write_cube_to_disk</span><span class="p">(</span>
</span><span id="Closures.create_closures-1204"><a href="#-1204"><span class="linenos">1204</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">salt_closures_gas</span><span class="p">[:],</span> <span class="s2">&quot;salt_closures_gas_grown&quot;</span>
</span><span id="Closures.create_closures-1205"><a href="#-1205"><span class="linenos">1205</span></a>                <span class="p">)</span>
</span><span id="Closures.create_closures-1206"><a href="#-1206"><span class="linenos">1206</span></a>            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">salt_all_closures</span><span class="p">[:])</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
</span><span id="Closures.create_closures-1207"><a href="#-1207"><span class="linenos">1207</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">write_cube_to_disk</span><span class="p">(</span>
</span><span id="Closures.create_closures-1208"><a href="#-1208"><span class="linenos">1208</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">salt_all_closures</span><span class="p">[:],</span> <span class="s2">&quot;salt_all_closures_grown&quot;</span>
</span><span id="Closures.create_closures-1209"><a href="#-1209"><span class="linenos">1209</span></a>                <span class="p">)</span>  <span class="c1"># maybe remove later</span>
</span><span id="Closures.create_closures-1210"><a href="#-1210"><span class="linenos">1210</span></a>
</span><span id="Closures.create_closures-1211"><a href="#-1211"><span class="linenos">1211</span></a>            <span class="p">(</span>
</span><span id="Closures.create_closures-1212"><a href="#-1212"><span class="linenos">1212</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">salt_closures_oil</span><span class="p">[:],</span>
</span><span id="Closures.create_closures-1213"><a href="#-1213"><span class="linenos">1213</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">n_salt_closures_oil</span><span class="p">,</span>
</span><span id="Closures.create_closures-1214"><a href="#-1214"><span class="linenos">1214</span></a>            <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">closure_size_filter</span><span class="p">(</span>
</span><span id="Closures.create_closures-1215"><a href="#-1215"><span class="linenos">1215</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">salt_closures_oil</span><span class="p">[:],</span>
</span><span id="Closures.create_closures-1216"><a href="#-1216"><span class="linenos">1216</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">closure_min_voxels</span><span class="p">,</span>
</span><span id="Closures.create_closures-1217"><a href="#-1217"><span class="linenos">1217</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">n_salt_closures_oil</span><span class="p">,</span>
</span><span id="Closures.create_closures-1218"><a href="#-1218"><span class="linenos">1218</span></a>            <span class="p">)</span>
</span><span id="Closures.create_closures-1219"><a href="#-1219"><span class="linenos">1219</span></a>            <span class="p">(</span>
</span><span id="Closures.create_closures-1220"><a href="#-1220"><span class="linenos">1220</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">salt_closures_gas</span><span class="p">[:],</span>
</span><span id="Closures.create_closures-1221"><a href="#-1221"><span class="linenos">1221</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">n_salt_closures_gas</span><span class="p">,</span>
</span><span id="Closures.create_closures-1222"><a href="#-1222"><span class="linenos">1222</span></a>            <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">closure_size_filter</span><span class="p">(</span>
</span><span id="Closures.create_closures-1223"><a href="#-1223"><span class="linenos">1223</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">salt_closures_gas</span><span class="p">[:],</span>
</span><span id="Closures.create_closures-1224"><a href="#-1224"><span class="linenos">1224</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">closure_min_voxels</span><span class="p">,</span>
</span><span id="Closures.create_closures-1225"><a href="#-1225"><span class="linenos">1225</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">n_salt_closures_gas</span><span class="p">,</span>
</span><span id="Closures.create_closures-1226"><a href="#-1226"><span class="linenos">1226</span></a>            <span class="p">)</span>
</span><span id="Closures.create_closures-1227"><a href="#-1227"><span class="linenos">1227</span></a>
</span><span id="Closures.create_closures-1228"><a href="#-1228"><span class="linenos">1228</span></a>            <span class="c1"># Append salt-bounded closures to main closure cubes for oil and gas</span>
</span><span id="Closures.create_closures-1229"><a href="#-1229"><span class="linenos">1229</span></a>            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">salt_closures_oil_grown</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
</span><span id="Closures.create_closures-1230"><a href="#-1230"><span class="linenos">1230</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">oil_closures</span><span class="p">[</span><span class="n">salt_closures_oil_grown</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="Closures.create_closures-1231"><a href="#-1231"><span class="linenos">1231</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">oil_closures</span><span class="p">[</span><span class="n">salt_closures_oil_grown</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="Closures.create_closures-1232"><a href="#-1232"><span class="linenos">1232</span></a>            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">salt_closures_gas_grown</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
</span><span id="Closures.create_closures-1233"><a href="#-1233"><span class="linenos">1233</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">gas_closures</span><span class="p">[</span><span class="n">salt_closures_gas_grown</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="Closures.create_closures-1234"><a href="#-1234"><span class="linenos">1234</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">gas_closures</span><span class="p">[</span><span class="n">salt_closures_gas_grown</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="Closures.create_closures-1235"><a href="#-1235"><span class="linenos">1235</span></a>            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">salt_all_closures_grown</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
</span><span id="Closures.create_closures-1236"><a href="#-1236"><span class="linenos">1236</span></a>                <span class="n">all_closures_final</span><span class="p">[</span><span class="n">salt_all_closures_grown</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="Closures.create_closures-1237"><a href="#-1237"><span class="linenos">1237</span></a>                <span class="n">all_closures_final</span><span class="p">[</span><span class="n">salt_all_closures_grown</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="Closures.create_closures-1238"><a href="#-1238"><span class="linenos">1238</span></a>
</span><span id="Closures.create_closures-1239"><a href="#-1239"><span class="linenos">1239</span></a>            <span class="c1"># Add faulted closures to closure code cube</span>
</span><span id="Closures.create_closures-1240"><a href="#-1240"><span class="linenos">1240</span></a>            <span class="n">hc_closures</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">salt_closures_oil</span><span class="p">[:]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">salt_closures_gas</span><span class="p">[:]</span>
</span><span id="Closures.create_closures-1241"><a href="#-1241"><span class="linenos">1241</span></a>            <span class="n">labels</span><span class="p">,</span> <span class="n">num</span> <span class="o">=</span> <span class="n">measure</span><span class="o">.</span><span class="n">label</span><span class="p">(</span>
</span><span id="Closures.create_closures-1242"><a href="#-1242"><span class="linenos">1242</span></a>                <span class="n">hc_closures</span><span class="p">,</span> <span class="n">connectivity</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">background</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">return_num</span><span class="o">=</span><span class="kc">True</span>
</span><span id="Closures.create_closures-1243"><a href="#-1243"><span class="linenos">1243</span></a>            <span class="p">)</span>
</span><span id="Closures.create_closures-1244"><a href="#-1244"><span class="linenos">1244</span></a>            <span class="n">hc_closure_codes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_closure_codes</span><span class="p">(</span>
</span><span id="Closures.create_closures-1245"><a href="#-1245"><span class="linenos">1245</span></a>                <span class="n">hc_closure_codes</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">num</span><span class="p">,</span> <span class="n">code</span><span class="o">=</span><span class="mf">0.4</span>
</span><span id="Closures.create_closures-1246"><a href="#-1246"><span class="linenos">1246</span></a>            <span class="p">)</span>
</span><span id="Closures.create_closures-1247"><a href="#-1247"><span class="linenos">1247</span></a>
</span><span id="Closures.create_closures-1248"><a href="#-1248"><span class="linenos">1248</span></a>        <span class="c1"># Write hc_closure_codes to disk</span>
</span><span id="Closures.create_closures-1249"><a href="#-1249"><span class="linenos">1249</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">write_cube_to_disk</span><span class="p">(</span><span class="n">hc_closure_codes</span><span class="p">,</span> <span class="s2">&quot;closure_segments_hc_voxelcount&quot;</span><span class="p">)</span>
</span><span id="Closures.create_closures-1250"><a href="#-1250"><span class="linenos">1250</span></a>
</span><span id="Closures.create_closures-1251"><a href="#-1251"><span class="linenos">1251</span></a>        <span class="c1"># Create closure volumes by type</span>
</span><span id="Closures.create_closures-1252"><a href="#-1252"><span class="linenos">1252</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">simple_closures</span><span class="p">[:]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Closures.create_closures-1253"><a href="#-1253"><span class="linenos">1253</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">simple_closures</span><span class="p">[:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">simple_closures_oil</span><span class="p">[:]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;uint8&quot;</span><span class="p">)</span>
</span><span id="Closures.create_closures-1254"><a href="#-1254"><span class="linenos">1254</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Closures.create_closures-1255"><a href="#-1255"><span class="linenos">1255</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">simple_closures</span><span class="p">[:]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">simple_closures_oil</span><span class="p">[:]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;uint8&quot;</span><span class="p">)</span>
</span><span id="Closures.create_closures-1256"><a href="#-1256"><span class="linenos">1256</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">simple_closures</span><span class="p">[:]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">simple_closures_gas</span><span class="p">[:]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;uint8&quot;</span><span class="p">)</span>
</span><span id="Closures.create_closures-1257"><a href="#-1257"><span class="linenos">1257</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">simple_closures</span><span class="p">[:]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">simple_closures_brine</span><span class="p">[:]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;uint8&quot;</span><span class="p">)</span>
</span><span id="Closures.create_closures-1258"><a href="#-1258"><span class="linenos">1258</span></a>        <span class="c1"># Onlap closures</span>
</span><span id="Closures.create_closures-1259"><a href="#-1259"><span class="linenos">1259</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">strat_closures</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Closures.create_closures-1260"><a href="#-1260"><span class="linenos">1260</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">strat_closures</span><span class="p">[:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">onlap_closures_oil</span><span class="p">[:]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;uint8&quot;</span><span class="p">)</span>
</span><span id="Closures.create_closures-1261"><a href="#-1261"><span class="linenos">1261</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Closures.create_closures-1262"><a href="#-1262"><span class="linenos">1262</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">strat_closures</span><span class="p">[:]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">onlap_closures_oil</span><span class="p">[:]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;uint8&quot;</span><span class="p">)</span>
</span><span id="Closures.create_closures-1263"><a href="#-1263"><span class="linenos">1263</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">strat_closures</span><span class="p">[:]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">onlap_closures_gas</span><span class="p">[:]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;uint8&quot;</span><span class="p">)</span>
</span><span id="Closures.create_closures-1264"><a href="#-1264"><span class="linenos">1264</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">strat_closures</span><span class="p">[:]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">onlap_closures_brine</span><span class="p">[:]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;uint8&quot;</span><span class="p">)</span>
</span><span id="Closures.create_closures-1265"><a href="#-1265"><span class="linenos">1265</span></a>        <span class="c1"># Fault closures</span>
</span><span id="Closures.create_closures-1266"><a href="#-1266"><span class="linenos">1266</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fault_closures</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Closures.create_closures-1267"><a href="#-1267"><span class="linenos">1267</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">fault_closures</span><span class="p">[:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">faulted_closures_oil</span><span class="p">[:]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;uint8&quot;</span><span class="p">)</span>
</span><span id="Closures.create_closures-1268"><a href="#-1268"><span class="linenos">1268</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Closures.create_closures-1269"><a href="#-1269"><span class="linenos">1269</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">fault_closures</span><span class="p">[:]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">faulted_closures_oil</span><span class="p">[:]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;uint8&quot;</span><span class="p">)</span>
</span><span id="Closures.create_closures-1270"><a href="#-1270"><span class="linenos">1270</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fault_closures</span><span class="p">[:]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">faulted_closures_gas</span><span class="p">[:]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;uint8&quot;</span><span class="p">)</span>
</span><span id="Closures.create_closures-1271"><a href="#-1271"><span class="linenos">1271</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fault_closures</span><span class="p">[:]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">faulted_closures_brine</span><span class="p">[:]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;uint8&quot;</span><span class="p">)</span>
</span><span id="Closures.create_closures-1272"><a href="#-1272"><span class="linenos">1272</span></a>
</span><span id="Closures.create_closures-1273"><a href="#-1273"><span class="linenos">1273</span></a>        <span class="c1"># Salt-bounded closures</span>
</span><span id="Closures.create_closures-1274"><a href="#-1274"><span class="linenos">1274</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">include_salt</span><span class="p">:</span>
</span><span id="Closures.create_closures-1275"><a href="#-1275"><span class="linenos">1275</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">salt_closures</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Closures.create_closures-1276"><a href="#-1276"><span class="linenos">1276</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">salt_closures</span><span class="p">[:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">salt_closures_oil</span><span class="p">[:]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;uint8&quot;</span><span class="p">)</span>
</span><span id="Closures.create_closures-1277"><a href="#-1277"><span class="linenos">1277</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Closures.create_closures-1278"><a href="#-1278"><span class="linenos">1278</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">salt_closures</span><span class="p">[:]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">salt_closures_oil</span><span class="p">[:]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;uint8&quot;</span><span class="p">)</span>
</span><span id="Closures.create_closures-1279"><a href="#-1279"><span class="linenos">1279</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">salt_closures</span><span class="p">[:]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">salt_closures_gas</span><span class="p">[:]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;uint8&quot;</span><span class="p">)</span>
</span><span id="Closures.create_closures-1280"><a href="#-1280"><span class="linenos">1280</span></a>
</span><span id="Closures.create_closures-1281"><a href="#-1281"><span class="linenos">1281</span></a>        <span class="c1"># Convert closure cubes from int16 to uint8 for writing to disk</span>
</span><span id="Closures.create_closures-1282"><a href="#-1282"><span class="linenos">1282</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">closure_segments</span><span class="p">[:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">closure_segments</span><span class="p">[:]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;uint8&quot;</span><span class="p">)</span>
</span><span id="Closures.create_closures-1283"><a href="#-1283"><span class="linenos">1283</span></a>
</span><span id="Closures.create_closures-1284"><a href="#-1284"><span class="linenos">1284</span></a>        <span class="c1"># add any oil/gas/brine closures into all_closures_final in case missed</span>
</span><span id="Closures.create_closures-1285"><a href="#-1285"><span class="linenos">1285</span></a>        <span class="n">all_closures_final</span><span class="p">[:][</span><span class="bp">self</span><span class="o">.</span><span class="n">oil_closures</span><span class="p">[:]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="Closures.create_closures-1286"><a href="#-1286"><span class="linenos">1286</span></a>        <span class="n">all_closures_final</span><span class="p">[:][</span><span class="bp">self</span><span class="o">.</span><span class="n">gas_closures</span><span class="p">[:]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="Closures.create_closures-1287"><a href="#-1287"><span class="linenos">1287</span></a>        <span class="n">all_closures_final</span><span class="p">[:][</span><span class="bp">self</span><span class="o">.</span><span class="n">gas_closures</span><span class="p">[:]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="Closures.create_closures-1288"><a href="#-1288"><span class="linenos">1288</span></a>        <span class="c1"># Write all_closures_final to disk</span>
</span><span id="Closures.create_closures-1289"><a href="#-1289"><span class="linenos">1289</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">write_cube_to_disk</span><span class="p">(</span><span class="n">all_closures_final</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;uint8&quot;</span><span class="p">),</span> <span class="s2">&quot;trap_label&quot;</span><span class="p">)</span>
</span><span id="Closures.create_closures-1290"><a href="#-1290"><span class="linenos">1290</span></a>
</span><span id="Closures.create_closures-1291"><a href="#-1291"><span class="linenos">1291</span></a>        <span class="c1"># add any oil/gas/brine closures into reservoir in case missed</span>
</span><span id="Closures.create_closures-1292"><a href="#-1292"><span class="linenos">1292</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">reservoir</span><span class="p">[:][</span><span class="bp">self</span><span class="o">.</span><span class="n">oil_closures</span><span class="p">[:]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="Closures.create_closures-1293"><a href="#-1293"><span class="linenos">1293</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">reservoir</span><span class="p">[:][</span><span class="bp">self</span><span class="o">.</span><span class="n">gas_closures</span><span class="p">[:]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="Closures.create_closures-1294"><a href="#-1294"><span class="linenos">1294</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">reservoir</span><span class="p">[:][</span><span class="bp">self</span><span class="o">.</span><span class="n">brine_closures</span><span class="p">[:]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="Closures.create_closures-1295"><a href="#-1295"><span class="linenos">1295</span></a>        <span class="c1"># write reservoir_label to disk</span>
</span><span id="Closures.create_closures-1296"><a href="#-1296"><span class="linenos">1296</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">write_cube_to_disk</span><span class="p">(</span>
</span><span id="Closures.create_closures-1297"><a href="#-1297"><span class="linenos">1297</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">reservoir</span><span class="p">[:]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;uint8&quot;</span><span class="p">),</span> <span class="s2">&quot;reservoir_label&quot;</span>
</span><span id="Closures.create_closures-1298"><a href="#-1298"><span class="linenos">1298</span></a>        <span class="p">)</span>
</span><span id="Closures.create_closures-1299"><a href="#-1299"><span class="linenos">1299</span></a>
</span><span id="Closures.create_closures-1300"><a href="#-1300"><span class="linenos">1300</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">qc_plots</span><span class="p">:</span>
</span><span id="Closures.create_closures-1301"><a href="#-1301"><span class="linenos">1301</span></a>            <span class="kn">from</span> <span class="nn">datagenerator.util</span> <span class="kn">import</span> <span class="n">plot_xsection</span>
</span><span id="Closures.create_closures-1302"><a href="#-1302"><span class="linenos">1302</span></a>            <span class="kn">from</span> <span class="nn">datagenerator.util</span> <span class="kn">import</span> <span class="n">find_line_with_most_voxels</span>
</span><span id="Closures.create_closures-1303"><a href="#-1303"><span class="linenos">1303</span></a>
</span><span id="Closures.create_closures-1304"><a href="#-1304"><span class="linenos">1304</span></a>            <span class="c1"># visualize closures QC</span>
</span><span id="Closures.create_closures-1305"><a href="#-1305"><span class="linenos">1305</span></a>            <span class="n">inline_index_cl</span> <span class="o">=</span> <span class="n">find_line_with_most_voxels</span><span class="p">(</span>
</span><span id="Closures.create_closures-1306"><a href="#-1306"><span class="linenos">1306</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">closure_segments</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span>
</span><span id="Closures.create_closures-1307"><a href="#-1307"><span class="linenos">1307</span></a>            <span class="p">)</span>
</span><span id="Closures.create_closures-1308"><a href="#-1308"><span class="linenos">1308</span></a>            <span class="n">plot_xsection</span><span class="p">(</span>
</span><span id="Closures.create_closures-1309"><a href="#-1309"><span class="linenos">1309</span></a>                <span class="n">volume</span><span class="o">=</span><span class="n">labels_clean</span><span class="p">,</span>
</span><span id="Closures.create_closures-1310"><a href="#-1310"><span class="linenos">1310</span></a>                <span class="n">maps</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">faulted_depth_maps_gaps</span><span class="p">,</span>
</span><span id="Closures.create_closures-1311"><a href="#-1311"><span class="linenos">1311</span></a>                <span class="n">line_num</span><span class="o">=</span><span class="n">inline_index_cl</span><span class="p">,</span>
</span><span id="Closures.create_closures-1312"><a href="#-1312"><span class="linenos">1312</span></a>                <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Example Trav through 3D model</span><span class="se">\n</span><span class="s2">closures after faulting&quot;</span><span class="p">,</span>
</span><span id="Closures.create_closures-1313"><a href="#-1313"><span class="linenos">1313</span></a>                <span class="n">png_name</span><span class="o">=</span><span class="s2">&quot;QC_plot__AfterFaulting_closure_segments.png&quot;</span><span class="p">,</span>
</span><span id="Closures.create_closures-1314"><a href="#-1314"><span class="linenos">1314</span></a>                <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;gist_ncar_r&quot;</span><span class="p">,</span>
</span><span id="Closures.create_closures-1315"><a href="#-1315"><span class="linenos">1315</span></a>                <span class="n">cfg</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="p">,</span>
</span><span id="Closures.create_closures-1316"><a href="#-1316"><span class="linenos">1316</span></a>            <span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="Closures.closure_size_filter" class="classattr">
                                        <input id="Closures.closure_size_filter-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">closure_size_filter</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">closure_type</span>, </span><span class="param"><span class="n">threshold</span>, </span><span class="param"><span class="n">count</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Closures.closure_size_filter-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Closures.closure_size_filter"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Closures.closure_size_filter-1318"><a href="#-1318"><span class="linenos">1318</span></a>    <span class="k">def</span> <span class="nf">closure_size_filter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">closure_type</span><span class="p">,</span> <span class="n">threshold</span><span class="p">,</span> <span class="n">count</span><span class="p">):</span>
</span><span id="Closures.closure_size_filter-1319"><a href="#-1319"><span class="linenos">1319</span></a>        <span class="n">labels</span><span class="p">,</span> <span class="n">num</span> <span class="o">=</span> <span class="n">measure</span><span class="o">.</span><span class="n">label</span><span class="p">(</span>
</span><span id="Closures.closure_size_filter-1320"><a href="#-1320"><span class="linenos">1320</span></a>            <span class="n">closure_type</span><span class="p">,</span> <span class="n">connectivity</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">background</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">return_num</span><span class="o">=</span><span class="kc">True</span>
</span><span id="Closures.closure_size_filter-1321"><a href="#-1321"><span class="linenos">1321</span></a>        <span class="p">)</span>
</span><span id="Closures.closure_size_filter-1322"><a href="#-1322"><span class="linenos">1322</span></a>        <span class="k">if</span> <span class="p">(</span>
</span><span id="Closures.closure_size_filter-1323"><a href="#-1323"><span class="linenos">1323</span></a>            <span class="n">num</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Closures.closure_size_filter-1324"><a href="#-1324"><span class="linenos">1324</span></a>        <span class="p">):</span>  <span class="c1"># TODO add whether smallest closure is below threshold constraint too</span>
</span><span id="Closures.closure_size_filter-1325"><a href="#-1325"><span class="linenos">1325</span></a>            <span class="n">s</span> <span class="o">=</span> <span class="p">[</span><span class="n">labels</span><span class="p">[</span><span class="n">labels</span> <span class="o">==</span> <span class="n">x</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">labels</span><span class="p">))]</span>
</span><span id="Closures.closure_size_filter-1326"><a href="#-1326"><span class="linenos">1326</span></a>            <span class="n">labels</span> <span class="o">=</span> <span class="n">morphology</span><span class="o">.</span><span class="n">remove_small_objects</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">threshold</span><span class="p">,</span> <span class="n">connectivity</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span><span id="Closures.closure_size_filter-1327"><a href="#-1327"><span class="linenos">1327</span></a>            <span class="n">t</span> <span class="o">=</span> <span class="p">[</span><span class="n">labels</span><span class="p">[</span><span class="n">labels</span> <span class="o">==</span> <span class="n">x</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">labels</span><span class="p">))]</span>
</span><span id="Closures.closure_size_filter-1328"><a href="#-1328"><span class="linenos">1328</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="Closures.closure_size_filter-1329"><a href="#-1329"><span class="linenos">1329</span></a>                <span class="sa">f</span><span class="s2">&quot;Closure sizes before filter: </span><span class="si">{</span><span class="n">s</span><span class="si">}</span><span class="se">\n</span><span class="s2">Threshold: </span><span class="si">{</span><span class="n">threshold</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="Closures.closure_size_filter-1330"><a href="#-1330"><span class="linenos">1330</span></a>                <span class="sa">f</span><span class="s2">&quot;Closure sizes after filter: </span><span class="si">{</span><span class="n">t</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Closures.closure_size_filter-1331"><a href="#-1331"><span class="linenos">1331</span></a>            <span class="p">)</span>
</span><span id="Closures.closure_size_filter-1332"><a href="#-1332"><span class="linenos">1332</span></a>            <span class="n">count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
</span><span id="Closures.closure_size_filter-1333"><a href="#-1333"><span class="linenos">1333</span></a>        <span class="k">return</span> <span class="n">labels</span><span class="p">,</span> <span class="n">count</span>
</span></pre></div>


    

                            </div>
                            <div id="Closures.closure_type_info_for_log" class="classattr">
                                        <input id="Closures.closure_type_info_for_log-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">closure_type_info_for_log</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Closures.closure_type_info_for_log-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Closures.closure_type_info_for_log"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Closures.closure_type_info_for_log-1335"><a href="#-1335"><span class="linenos">1335</span></a>    <span class="k">def</span> <span class="nf">closure_type_info_for_log</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Closures.closure_type_info_for_log-1336"><a href="#-1336"><span class="linenos">1336</span></a>        <span class="n">fluid_types</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;oil&quot;</span><span class="p">,</span> <span class="s2">&quot;gas&quot;</span><span class="p">,</span> <span class="s2">&quot;brine&quot;</span><span class="p">]</span>
</span><span id="Closures.closure_type_info_for_log-1337"><a href="#-1337"><span class="linenos">1337</span></a>        <span class="k">if</span> <span class="s2">&quot;faulted&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">closure_types</span><span class="p">:</span>
</span><span id="Closures.closure_type_info_for_log-1338"><a href="#-1338"><span class="linenos">1338</span></a>            <span class="c1"># Faulted closures</span>
</span><span id="Closures.closure_type_info_for_log-1339"><a href="#-1339"><span class="linenos">1339</span></a>            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">fluid</span><span class="p">,</span> <span class="n">num</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
</span><span id="Closures.closure_type_info_for_log-1340"><a href="#-1340"><span class="linenos">1340</span></a>                <span class="n">fluid_types</span><span class="p">,</span>
</span><span id="Closures.closure_type_info_for_log-1341"><a href="#-1341"><span class="linenos">1341</span></a>                <span class="p">[</span>
</span><span id="Closures.closure_type_info_for_log-1342"><a href="#-1342"><span class="linenos">1342</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">faulted_closures_oil</span><span class="p">[:],</span>
</span><span id="Closures.closure_type_info_for_log-1343"><a href="#-1343"><span class="linenos">1343</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">faulted_closures_gas</span><span class="p">[:],</span>
</span><span id="Closures.closure_type_info_for_log-1344"><a href="#-1344"><span class="linenos">1344</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">faulted_closures_brine</span><span class="p">[:],</span>
</span><span id="Closures.closure_type_info_for_log-1345"><a href="#-1345"><span class="linenos">1345</span></a>                <span class="p">],</span>
</span><span id="Closures.closure_type_info_for_log-1346"><a href="#-1346"><span class="linenos">1346</span></a>                <span class="p">[</span>
</span><span id="Closures.closure_type_info_for_log-1347"><a href="#-1347"><span class="linenos">1347</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">n_fault_closures_oil</span><span class="p">,</span>
</span><span id="Closures.closure_type_info_for_log-1348"><a href="#-1348"><span class="linenos">1348</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">n_fault_closures_gas</span><span class="p">,</span>
</span><span id="Closures.closure_type_info_for_log-1349"><a href="#-1349"><span class="linenos">1349</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">n_fault_closures_brine</span><span class="p">,</span>
</span><span id="Closures.closure_type_info_for_log-1350"><a href="#-1350"><span class="linenos">1350</span></a>                <span class="p">],</span>
</span><span id="Closures.closure_type_info_for_log-1351"><a href="#-1351"><span class="linenos">1351</span></a>            <span class="p">):</span>
</span><span id="Closures.closure_type_info_for_log-1352"><a href="#-1352"><span class="linenos">1352</span></a>                <span class="n">n_voxels</span> <span class="o">=</span> <span class="n">fluid</span><span class="p">[</span><span class="n">fluid</span><span class="p">[:]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="Closures.closure_type_info_for_log-1353"><a href="#-1353"><span class="linenos">1353</span></a>                <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;n_fault_closures_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">num</span><span class="si">:</span><span class="s2">03d</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="Closures.closure_type_info_for_log-1354"><a href="#-1354"><span class="linenos">1354</span></a>                <span class="n">msg</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;n_voxels_fault_closures_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">n_voxels</span><span class="si">:</span><span class="s2">08d</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="Closures.closure_type_info_for_log-1355"><a href="#-1355"><span class="linenos">1355</span></a>                <span class="nb">print</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="Closures.closure_type_info_for_log-1356"><a href="#-1356"><span class="linenos">1356</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="Closures.closure_type_info_for_log-1357"><a href="#-1357"><span class="linenos">1357</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="Closures.closure_type_info_for_log-1358"><a href="#-1358"><span class="linenos">1358</span></a>                    <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="Closures.closure_type_info_for_log-1359"><a href="#-1359"><span class="linenos">1359</span></a>                    <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span>
</span><span id="Closures.closure_type_info_for_log-1360"><a href="#-1360"><span class="linenos">1360</span></a>                    <span class="n">subkey</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;n_fault_closures_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="Closures.closure_type_info_for_log-1361"><a href="#-1361"><span class="linenos">1361</span></a>                    <span class="n">val</span><span class="o">=</span><span class="n">num</span><span class="p">,</span>
</span><span id="Closures.closure_type_info_for_log-1362"><a href="#-1362"><span class="linenos">1362</span></a>                <span class="p">)</span>
</span><span id="Closures.closure_type_info_for_log-1363"><a href="#-1363"><span class="linenos">1363</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="Closures.closure_type_info_for_log-1364"><a href="#-1364"><span class="linenos">1364</span></a>                    <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="Closures.closure_type_info_for_log-1365"><a href="#-1365"><span class="linenos">1365</span></a>                    <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span>
</span><span id="Closures.closure_type_info_for_log-1366"><a href="#-1366"><span class="linenos">1366</span></a>                    <span class="n">subkey</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;n_voxels_fault_closures_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="Closures.closure_type_info_for_log-1367"><a href="#-1367"><span class="linenos">1367</span></a>                    <span class="n">val</span><span class="o">=</span><span class="n">n_voxels</span><span class="p">,</span>
</span><span id="Closures.closure_type_info_for_log-1368"><a href="#-1368"><span class="linenos">1368</span></a>                <span class="p">)</span>
</span><span id="Closures.closure_type_info_for_log-1369"><a href="#-1369"><span class="linenos">1369</span></a>                <span class="n">closure_statistics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_closure_statistics</span><span class="p">(</span>
</span><span id="Closures.closure_type_info_for_log-1370"><a href="#-1370"><span class="linenos">1370</span></a>                    <span class="n">fluid</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Faulted </span><span class="si">{</span><span class="n">name</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Closures.closure_type_info_for_log-1371"><a href="#-1371"><span class="linenos">1371</span></a>                <span class="p">)</span>
</span><span id="Closures.closure_type_info_for_log-1372"><a href="#-1372"><span class="linenos">1372</span></a>                <span class="k">if</span> <span class="n">closure_statistics</span><span class="p">:</span>
</span><span id="Closures.closure_type_info_for_log-1373"><a href="#-1373"><span class="linenos">1373</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="n">closure_statistics</span><span class="p">)</span>
</span><span id="Closures.closure_type_info_for_log-1374"><a href="#-1374"><span class="linenos">1374</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span><span class="n">closure_statistics</span><span class="p">)</span>
</span><span id="Closures.closure_type_info_for_log-1375"><a href="#-1375"><span class="linenos">1375</span></a>
</span><span id="Closures.closure_type_info_for_log-1376"><a href="#-1376"><span class="linenos">1376</span></a>        <span class="k">if</span> <span class="s2">&quot;onlap&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">closure_types</span><span class="p">:</span>
</span><span id="Closures.closure_type_info_for_log-1377"><a href="#-1377"><span class="linenos">1377</span></a>            <span class="c1"># Onlap Closures</span>
</span><span id="Closures.closure_type_info_for_log-1378"><a href="#-1378"><span class="linenos">1378</span></a>            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">fluid</span><span class="p">,</span> <span class="n">num</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
</span><span id="Closures.closure_type_info_for_log-1379"><a href="#-1379"><span class="linenos">1379</span></a>                <span class="n">fluid_types</span><span class="p">,</span>
</span><span id="Closures.closure_type_info_for_log-1380"><a href="#-1380"><span class="linenos">1380</span></a>                <span class="p">[</span>
</span><span id="Closures.closure_type_info_for_log-1381"><a href="#-1381"><span class="linenos">1381</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">onlap_closures_oil</span><span class="p">[:],</span>
</span><span id="Closures.closure_type_info_for_log-1382"><a href="#-1382"><span class="linenos">1382</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">onlap_closures_gas</span><span class="p">[:],</span>
</span><span id="Closures.closure_type_info_for_log-1383"><a href="#-1383"><span class="linenos">1383</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">onlap_closures_brine</span><span class="p">[:],</span>
</span><span id="Closures.closure_type_info_for_log-1384"><a href="#-1384"><span class="linenos">1384</span></a>                <span class="p">],</span>
</span><span id="Closures.closure_type_info_for_log-1385"><a href="#-1385"><span class="linenos">1385</span></a>                <span class="p">[</span>
</span><span id="Closures.closure_type_info_for_log-1386"><a href="#-1386"><span class="linenos">1386</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">n_onlap_closures_oil</span><span class="p">,</span>
</span><span id="Closures.closure_type_info_for_log-1387"><a href="#-1387"><span class="linenos">1387</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">n_onlap_closures_gas</span><span class="p">,</span>
</span><span id="Closures.closure_type_info_for_log-1388"><a href="#-1388"><span class="linenos">1388</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">n_onlap_closures_brine</span><span class="p">,</span>
</span><span id="Closures.closure_type_info_for_log-1389"><a href="#-1389"><span class="linenos">1389</span></a>                <span class="p">],</span>
</span><span id="Closures.closure_type_info_for_log-1390"><a href="#-1390"><span class="linenos">1390</span></a>            <span class="p">):</span>
</span><span id="Closures.closure_type_info_for_log-1391"><a href="#-1391"><span class="linenos">1391</span></a>                <span class="n">n_voxels</span> <span class="o">=</span> <span class="n">fluid</span><span class="p">[</span><span class="n">fluid</span><span class="p">[:]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="Closures.closure_type_info_for_log-1392"><a href="#-1392"><span class="linenos">1392</span></a>                <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;n_onlap_closures_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">num</span><span class="si">:</span><span class="s2">03d</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="Closures.closure_type_info_for_log-1393"><a href="#-1393"><span class="linenos">1393</span></a>                <span class="n">msg</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;n_voxels_onlap_closures_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">n_voxels</span><span class="si">:</span><span class="s2">08d</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="Closures.closure_type_info_for_log-1394"><a href="#-1394"><span class="linenos">1394</span></a>                <span class="nb">print</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="Closures.closure_type_info_for_log-1395"><a href="#-1395"><span class="linenos">1395</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="Closures.closure_type_info_for_log-1396"><a href="#-1396"><span class="linenos">1396</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="Closures.closure_type_info_for_log-1397"><a href="#-1397"><span class="linenos">1397</span></a>                    <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="Closures.closure_type_info_for_log-1398"><a href="#-1398"><span class="linenos">1398</span></a>                    <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span>
</span><span id="Closures.closure_type_info_for_log-1399"><a href="#-1399"><span class="linenos">1399</span></a>                    <span class="n">subkey</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;n_onlap_closures_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="Closures.closure_type_info_for_log-1400"><a href="#-1400"><span class="linenos">1400</span></a>                    <span class="n">val</span><span class="o">=</span><span class="n">num</span><span class="p">,</span>
</span><span id="Closures.closure_type_info_for_log-1401"><a href="#-1401"><span class="linenos">1401</span></a>                <span class="p">)</span>
</span><span id="Closures.closure_type_info_for_log-1402"><a href="#-1402"><span class="linenos">1402</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="Closures.closure_type_info_for_log-1403"><a href="#-1403"><span class="linenos">1403</span></a>                    <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="Closures.closure_type_info_for_log-1404"><a href="#-1404"><span class="linenos">1404</span></a>                    <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span>
</span><span id="Closures.closure_type_info_for_log-1405"><a href="#-1405"><span class="linenos">1405</span></a>                    <span class="n">subkey</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;n_voxels_onlap_closures_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="Closures.closure_type_info_for_log-1406"><a href="#-1406"><span class="linenos">1406</span></a>                    <span class="n">val</span><span class="o">=</span><span class="n">n_voxels</span><span class="p">,</span>
</span><span id="Closures.closure_type_info_for_log-1407"><a href="#-1407"><span class="linenos">1407</span></a>                <span class="p">)</span>
</span><span id="Closures.closure_type_info_for_log-1408"><a href="#-1408"><span class="linenos">1408</span></a>                <span class="n">closure_statistics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_closure_statistics</span><span class="p">(</span>
</span><span id="Closures.closure_type_info_for_log-1409"><a href="#-1409"><span class="linenos">1409</span></a>                    <span class="n">fluid</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Onlap </span><span class="si">{</span><span class="n">name</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Closures.closure_type_info_for_log-1410"><a href="#-1410"><span class="linenos">1410</span></a>                <span class="p">)</span>
</span><span id="Closures.closure_type_info_for_log-1411"><a href="#-1411"><span class="linenos">1411</span></a>                <span class="k">if</span> <span class="n">closure_statistics</span><span class="p">:</span>
</span><span id="Closures.closure_type_info_for_log-1412"><a href="#-1412"><span class="linenos">1412</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="n">closure_statistics</span><span class="p">)</span>
</span><span id="Closures.closure_type_info_for_log-1413"><a href="#-1413"><span class="linenos">1413</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span><span class="n">closure_statistics</span><span class="p">)</span>
</span><span id="Closures.closure_type_info_for_log-1414"><a href="#-1414"><span class="linenos">1414</span></a>
</span><span id="Closures.closure_type_info_for_log-1415"><a href="#-1415"><span class="linenos">1415</span></a>        <span class="k">if</span> <span class="s2">&quot;simple&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">closure_types</span><span class="p">:</span>
</span><span id="Closures.closure_type_info_for_log-1416"><a href="#-1416"><span class="linenos">1416</span></a>            <span class="c1"># Simple Closures</span>
</span><span id="Closures.closure_type_info_for_log-1417"><a href="#-1417"><span class="linenos">1417</span></a>            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">fluid</span><span class="p">,</span> <span class="n">num</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
</span><span id="Closures.closure_type_info_for_log-1418"><a href="#-1418"><span class="linenos">1418</span></a>                <span class="n">fluid_types</span><span class="p">,</span>
</span><span id="Closures.closure_type_info_for_log-1419"><a href="#-1419"><span class="linenos">1419</span></a>                <span class="p">[</span>
</span><span id="Closures.closure_type_info_for_log-1420"><a href="#-1420"><span class="linenos">1420</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">simple_closures_oil</span><span class="p">[:],</span>
</span><span id="Closures.closure_type_info_for_log-1421"><a href="#-1421"><span class="linenos">1421</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">simple_closures_gas</span><span class="p">[:],</span>
</span><span id="Closures.closure_type_info_for_log-1422"><a href="#-1422"><span class="linenos">1422</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">simple_closures_brine</span><span class="p">[:],</span>
</span><span id="Closures.closure_type_info_for_log-1423"><a href="#-1423"><span class="linenos">1423</span></a>                <span class="p">],</span>
</span><span id="Closures.closure_type_info_for_log-1424"><a href="#-1424"><span class="linenos">1424</span></a>                <span class="p">[</span>
</span><span id="Closures.closure_type_info_for_log-1425"><a href="#-1425"><span class="linenos">1425</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">n_4way_closures_oil</span><span class="p">,</span>
</span><span id="Closures.closure_type_info_for_log-1426"><a href="#-1426"><span class="linenos">1426</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">n_4way_closures_gas</span><span class="p">,</span>
</span><span id="Closures.closure_type_info_for_log-1427"><a href="#-1427"><span class="linenos">1427</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">n_4way_closures_brine</span><span class="p">,</span>
</span><span id="Closures.closure_type_info_for_log-1428"><a href="#-1428"><span class="linenos">1428</span></a>                <span class="p">],</span>
</span><span id="Closures.closure_type_info_for_log-1429"><a href="#-1429"><span class="linenos">1429</span></a>            <span class="p">):</span>
</span><span id="Closures.closure_type_info_for_log-1430"><a href="#-1430"><span class="linenos">1430</span></a>                <span class="n">n_voxels</span> <span class="o">=</span> <span class="n">fluid</span><span class="p">[</span><span class="n">fluid</span><span class="p">[:]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="Closures.closure_type_info_for_log-1431"><a href="#-1431"><span class="linenos">1431</span></a>                <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;n_4way_closures_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">num</span><span class="si">:</span><span class="s2">03d</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="Closures.closure_type_info_for_log-1432"><a href="#-1432"><span class="linenos">1432</span></a>                <span class="n">msg</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;n_voxels_4way_closures_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">n_voxels</span><span class="si">:</span><span class="s2">08d</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="Closures.closure_type_info_for_log-1433"><a href="#-1433"><span class="linenos">1433</span></a>                <span class="nb">print</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="Closures.closure_type_info_for_log-1434"><a href="#-1434"><span class="linenos">1434</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="Closures.closure_type_info_for_log-1435"><a href="#-1435"><span class="linenos">1435</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="Closures.closure_type_info_for_log-1436"><a href="#-1436"><span class="linenos">1436</span></a>                    <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="Closures.closure_type_info_for_log-1437"><a href="#-1437"><span class="linenos">1437</span></a>                    <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span>
</span><span id="Closures.closure_type_info_for_log-1438"><a href="#-1438"><span class="linenos">1438</span></a>                    <span class="n">subkey</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;n_4way_closures_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="Closures.closure_type_info_for_log-1439"><a href="#-1439"><span class="linenos">1439</span></a>                    <span class="n">val</span><span class="o">=</span><span class="n">num</span><span class="p">,</span>
</span><span id="Closures.closure_type_info_for_log-1440"><a href="#-1440"><span class="linenos">1440</span></a>                <span class="p">)</span>
</span><span id="Closures.closure_type_info_for_log-1441"><a href="#-1441"><span class="linenos">1441</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="Closures.closure_type_info_for_log-1442"><a href="#-1442"><span class="linenos">1442</span></a>                    <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="Closures.closure_type_info_for_log-1443"><a href="#-1443"><span class="linenos">1443</span></a>                    <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span>
</span><span id="Closures.closure_type_info_for_log-1444"><a href="#-1444"><span class="linenos">1444</span></a>                    <span class="n">subkey</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;n_voxels_4way_closures_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="Closures.closure_type_info_for_log-1445"><a href="#-1445"><span class="linenos">1445</span></a>                    <span class="n">val</span><span class="o">=</span><span class="n">n_voxels</span><span class="p">,</span>
</span><span id="Closures.closure_type_info_for_log-1446"><a href="#-1446"><span class="linenos">1446</span></a>                <span class="p">)</span>
</span><span id="Closures.closure_type_info_for_log-1447"><a href="#-1447"><span class="linenos">1447</span></a>                <span class="n">closure_statistics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_closure_statistics</span><span class="p">(</span>
</span><span id="Closures.closure_type_info_for_log-1448"><a href="#-1448"><span class="linenos">1448</span></a>                    <span class="n">fluid</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;4-Way </span><span class="si">{</span><span class="n">name</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Closures.closure_type_info_for_log-1449"><a href="#-1449"><span class="linenos">1449</span></a>                <span class="p">)</span>
</span><span id="Closures.closure_type_info_for_log-1450"><a href="#-1450"><span class="linenos">1450</span></a>                <span class="k">if</span> <span class="n">closure_statistics</span><span class="p">:</span>
</span><span id="Closures.closure_type_info_for_log-1451"><a href="#-1451"><span class="linenos">1451</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="n">closure_statistics</span><span class="p">)</span>
</span><span id="Closures.closure_type_info_for_log-1452"><a href="#-1452"><span class="linenos">1452</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span><span class="n">closure_statistics</span><span class="p">)</span>
</span><span id="Closures.closure_type_info_for_log-1453"><a href="#-1453"><span class="linenos">1453</span></a>
</span><span id="Closures.closure_type_info_for_log-1454"><a href="#-1454"><span class="linenos">1454</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">include_salt</span><span class="p">:</span>
</span><span id="Closures.closure_type_info_for_log-1455"><a href="#-1455"><span class="linenos">1455</span></a>            <span class="c1"># Salt-Bounded Closures</span>
</span><span id="Closures.closure_type_info_for_log-1456"><a href="#-1456"><span class="linenos">1456</span></a>            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">fluid</span><span class="p">,</span> <span class="n">num</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
</span><span id="Closures.closure_type_info_for_log-1457"><a href="#-1457"><span class="linenos">1457</span></a>                <span class="n">fluid_types</span><span class="p">,</span>
</span><span id="Closures.closure_type_info_for_log-1458"><a href="#-1458"><span class="linenos">1458</span></a>                <span class="p">[</span>
</span><span id="Closures.closure_type_info_for_log-1459"><a href="#-1459"><span class="linenos">1459</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">salt_closures_oil</span><span class="p">[:],</span>
</span><span id="Closures.closure_type_info_for_log-1460"><a href="#-1460"><span class="linenos">1460</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">salt_closures_gas</span><span class="p">[:],</span>
</span><span id="Closures.closure_type_info_for_log-1461"><a href="#-1461"><span class="linenos">1461</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">salt_closures_brine</span><span class="p">[:],</span>
</span><span id="Closures.closure_type_info_for_log-1462"><a href="#-1462"><span class="linenos">1462</span></a>                <span class="p">],</span>
</span><span id="Closures.closure_type_info_for_log-1463"><a href="#-1463"><span class="linenos">1463</span></a>                <span class="p">[</span>
</span><span id="Closures.closure_type_info_for_log-1464"><a href="#-1464"><span class="linenos">1464</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">n_salt_closures_oil</span><span class="p">,</span>
</span><span id="Closures.closure_type_info_for_log-1465"><a href="#-1465"><span class="linenos">1465</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">n_salt_closures_gas</span><span class="p">,</span>
</span><span id="Closures.closure_type_info_for_log-1466"><a href="#-1466"><span class="linenos">1466</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">n_salt_closures_brine</span><span class="p">,</span>
</span><span id="Closures.closure_type_info_for_log-1467"><a href="#-1467"><span class="linenos">1467</span></a>                <span class="p">],</span>
</span><span id="Closures.closure_type_info_for_log-1468"><a href="#-1468"><span class="linenos">1468</span></a>            <span class="p">):</span>
</span><span id="Closures.closure_type_info_for_log-1469"><a href="#-1469"><span class="linenos">1469</span></a>                <span class="n">n_voxels</span> <span class="o">=</span> <span class="n">fluid</span><span class="p">[</span><span class="n">fluid</span><span class="p">[:]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="Closures.closure_type_info_for_log-1470"><a href="#-1470"><span class="linenos">1470</span></a>                <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;n_salt_closures_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">num</span><span class="si">:</span><span class="s2">03d</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="Closures.closure_type_info_for_log-1471"><a href="#-1471"><span class="linenos">1471</span></a>                <span class="n">msg</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;n_voxels_salt_closures_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">n_voxels</span><span class="si">:</span><span class="s2">08d</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="Closures.closure_type_info_for_log-1472"><a href="#-1472"><span class="linenos">1472</span></a>                <span class="nb">print</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="Closures.closure_type_info_for_log-1473"><a href="#-1473"><span class="linenos">1473</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="Closures.closure_type_info_for_log-1474"><a href="#-1474"><span class="linenos">1474</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="Closures.closure_type_info_for_log-1475"><a href="#-1475"><span class="linenos">1475</span></a>                    <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="Closures.closure_type_info_for_log-1476"><a href="#-1476"><span class="linenos">1476</span></a>                    <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span>
</span><span id="Closures.closure_type_info_for_log-1477"><a href="#-1477"><span class="linenos">1477</span></a>                    <span class="n">subkey</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;n_salt_closures_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="Closures.closure_type_info_for_log-1478"><a href="#-1478"><span class="linenos">1478</span></a>                    <span class="n">val</span><span class="o">=</span><span class="n">num</span><span class="p">,</span>
</span><span id="Closures.closure_type_info_for_log-1479"><a href="#-1479"><span class="linenos">1479</span></a>                <span class="p">)</span>
</span><span id="Closures.closure_type_info_for_log-1480"><a href="#-1480"><span class="linenos">1480</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="Closures.closure_type_info_for_log-1481"><a href="#-1481"><span class="linenos">1481</span></a>                    <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="Closures.closure_type_info_for_log-1482"><a href="#-1482"><span class="linenos">1482</span></a>                    <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span>
</span><span id="Closures.closure_type_info_for_log-1483"><a href="#-1483"><span class="linenos">1483</span></a>                    <span class="n">subkey</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;n_voxels_salt_closures_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="Closures.closure_type_info_for_log-1484"><a href="#-1484"><span class="linenos">1484</span></a>                    <span class="n">val</span><span class="o">=</span><span class="n">n_voxels</span><span class="p">,</span>
</span><span id="Closures.closure_type_info_for_log-1485"><a href="#-1485"><span class="linenos">1485</span></a>                <span class="p">)</span>
</span><span id="Closures.closure_type_info_for_log-1486"><a href="#-1486"><span class="linenos">1486</span></a>                <span class="n">closure_statistics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_closure_statistics</span><span class="p">(</span>
</span><span id="Closures.closure_type_info_for_log-1487"><a href="#-1487"><span class="linenos">1487</span></a>                    <span class="n">fluid</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Salt </span><span class="si">{</span><span class="n">name</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Closures.closure_type_info_for_log-1488"><a href="#-1488"><span class="linenos">1488</span></a>                <span class="p">)</span>
</span><span id="Closures.closure_type_info_for_log-1489"><a href="#-1489"><span class="linenos">1489</span></a>                <span class="k">if</span> <span class="n">closure_statistics</span><span class="p">:</span>
</span><span id="Closures.closure_type_info_for_log-1490"><a href="#-1490"><span class="linenos">1490</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="n">closure_statistics</span><span class="p">)</span>
</span><span id="Closures.closure_type_info_for_log-1491"><a href="#-1491"><span class="linenos">1491</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span><span class="n">closure_statistics</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="Closures.get_voxel_counts" class="classattr">
                                        <input id="Closures.get_voxel_counts-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_voxel_counts</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">closures</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Closures.get_voxel_counts-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Closures.get_voxel_counts"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Closures.get_voxel_counts-1493"><a href="#-1493"><span class="linenos">1493</span></a>    <span class="k">def</span> <span class="nf">get_voxel_counts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">closures</span><span class="p">):</span>
</span><span id="Closures.get_voxel_counts-1494"><a href="#-1494"><span class="linenos">1494</span></a>        <span class="n">next_label</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Closures.get_voxel_counts-1495"><a href="#-1495"><span class="linenos">1495</span></a>        <span class="n">label_values</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Closures.get_voxel_counts-1496"><a href="#-1496"><span class="linenos">1496</span></a>        <span class="n">label_counts</span> <span class="o">=</span> <span class="p">[</span><span class="n">closures</span><span class="p">[</span><span class="n">closures</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">]</span>
</span><span id="Closures.get_voxel_counts-1497"><a href="#-1497"><span class="linenos">1497</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">closures</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="Closures.get_voxel_counts-1498"><a href="#-1498"><span class="linenos">1498</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="Closures.get_voxel_counts-1499"><a href="#-1499"><span class="linenos">1499</span></a>                <span class="n">next_label</span> <span class="o">=</span> <span class="n">closures</span><span class="p">[</span><span class="n">closures</span> <span class="o">&gt;</span> <span class="n">next_label</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
</span><span id="Closures.get_voxel_counts-1500"><a href="#-1500"><span class="linenos">1500</span></a>            <span class="k">except</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
</span><span id="Closures.get_voxel_counts-1501"><a href="#-1501"><span class="linenos">1501</span></a>                <span class="k">break</span>
</span><span id="Closures.get_voxel_counts-1502"><a href="#-1502"><span class="linenos">1502</span></a>            <span class="n">label_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">next_label</span><span class="p">)</span>
</span><span id="Closures.get_voxel_counts-1503"><a href="#-1503"><span class="linenos">1503</span></a>            <span class="n">label_counts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">closures</span><span class="p">[</span><span class="n">closures</span> <span class="o">==</span> <span class="n">next_label</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
</span><span id="Closures.get_voxel_counts-1504"><a href="#-1504"><span class="linenos">1504</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="Closures.get_voxel_counts-1505"><a href="#-1505"><span class="linenos">1505</span></a>                <span class="sa">f</span><span class="s2">&quot;Label: </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">, label_values: </span><span class="si">{</span><span class="n">label_values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">, label_counts: </span><span class="si">{</span><span class="n">label_counts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Closures.get_voxel_counts-1506"><a href="#-1506"><span class="linenos">1506</span></a>            <span class="p">)</span>
</span><span id="Closures.get_voxel_counts-1507"><a href="#-1507"><span class="linenos">1507</span></a>
</span><span id="Closures.get_voxel_counts-1508"><a href="#-1508"><span class="linenos">1508</span></a>        <span class="nb">print</span><span class="p">(</span>
</span><span id="Closures.get_voxel_counts-1509"><a href="#-1509"><span class="linenos">1509</span></a>            <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="mi">72</span> <span class="o">*</span> <span class="s2">&quot;*&quot;</span><span class="si">}</span><span class="se">\n\t</span><span class="s1">Num Closures: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">label_counts</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="si">}</span><span class="se">\n\t</span><span class="s1">Voxel counts</span><span class="se">\n</span><span class="si">{</span><span class="n">label_counts</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="si">}</span><span class="se">\n</span><span class="si">{</span><span class="mi">72</span> <span class="o">*</span> <span class="s2">&quot;*&quot;</span><span class="si">}</span><span class="s1">&#39;</span>
</span><span id="Closures.get_voxel_counts-1510"><a href="#-1510"><span class="linenos">1510</span></a>        <span class="p">)</span>
</span><span id="Closures.get_voxel_counts-1511"><a href="#-1511"><span class="linenos">1511</span></a>        <span class="k">for</span> <span class="n">vox_count</span> <span class="ow">in</span> <span class="n">label_counts</span><span class="p">:</span>
</span><span id="Closures.get_voxel_counts-1512"><a href="#-1512"><span class="linenos">1512</span></a>            <span class="k">if</span> <span class="n">vox_count</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">closure_min_voxels</span><span class="p">:</span>
</span><span id="Closures.get_voxel_counts-1513"><a href="#-1513"><span class="linenos">1513</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;voxel_count: </span><span class="si">{</span><span class="n">vox_count</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="Closures.populate_closure_dict" class="classattr">
                                        <input id="Closures.populate_closure_dict-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">populate_closure_dict</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">labels</span>, </span><span class="param"><span class="n">fluid</span>, </span><span class="param"><span class="n">seismic_nmf</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Closures.populate_closure_dict-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Closures.populate_closure_dict"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Closures.populate_closure_dict-1515"><a href="#-1515"><span class="linenos">1515</span></a>    <span class="k">def</span> <span class="nf">populate_closure_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">fluid</span><span class="p">,</span> <span class="n">seismic_nmf</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="Closures.populate_closure_dict-1516"><a href="#-1516"><span class="linenos">1516</span></a>        <span class="n">clist</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Closures.populate_closure_dict-1517"><a href="#-1517"><span class="linenos">1517</span></a>        <span class="n">max_num</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>
</span><span id="Closures.populate_closure_dict-1518"><a href="#-1518"><span class="linenos">1518</span></a>        <span class="k">if</span> <span class="n">seismic_nmf</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Closures.populate_closure_dict-1519"><a href="#-1519"><span class="linenos">1519</span></a>            <span class="c1"># calculate ai_gi</span>
</span><span id="Closures.populate_closure_dict-1520"><a href="#-1520"><span class="linenos">1520</span></a>            <span class="n">ai</span><span class="p">,</span> <span class="n">gi</span> <span class="o">=</span> <span class="n">compute_ai_gi</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="p">,</span> <span class="n">seismic_nmf</span><span class="p">)</span>
</span><span id="Closures.populate_closure_dict-1521"><a href="#-1521"><span class="linenos">1521</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_num</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="Closures.populate_closure_dict-1522"><a href="#-1522"><span class="linenos">1522</span></a>            <span class="n">_c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">labels</span> <span class="o">==</span> <span class="n">i</span><span class="p">)</span>
</span><span id="Closures.populate_closure_dict-1523"><a href="#-1523"><span class="linenos">1523</span></a>            <span class="n">cl</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
</span><span id="Closures.populate_closure_dict-1524"><a href="#-1524"><span class="linenos">1524</span></a>            <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;model_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">work_subfolder</span><span class="p">)</span>
</span><span id="Closures.populate_closure_dict-1525"><a href="#-1525"><span class="linenos">1525</span></a>            <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;fluid&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fluid</span>
</span><span id="Closures.populate_closure_dict-1526"><a href="#-1526"><span class="linenos">1526</span></a>            <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;n_voxels&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">_c</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="Closures.populate_closure_dict-1527"><a href="#-1527"><span class="linenos">1527</span></a>            <span class="c1"># np.min() or x.min() returns type numpy.int64 which SQLITE cannot handle. Convert to int</span>
</span><span id="Closures.populate_closure_dict-1528"><a href="#-1528"><span class="linenos">1528</span></a>            <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;x_min&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">_c</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</span><span id="Closures.populate_closure_dict-1529"><a href="#-1529"><span class="linenos">1529</span></a>            <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;x_max&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">_c</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</span><span id="Closures.populate_closure_dict-1530"><a href="#-1530"><span class="linenos">1530</span></a>            <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;y_min&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">_c</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
</span><span id="Closures.populate_closure_dict-1531"><a href="#-1531"><span class="linenos">1531</span></a>            <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;y_max&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">_c</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
</span><span id="Closures.populate_closure_dict-1532"><a href="#-1532"><span class="linenos">1532</span></a>            <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;z_min&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">_c</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
</span><span id="Closures.populate_closure_dict-1533"><a href="#-1533"><span class="linenos">1533</span></a>            <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;z_max&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">_c</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
</span><span id="Closures.populate_closure_dict-1534"><a href="#-1534"><span class="linenos">1534</span></a>            <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;zbml_min&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">faulted_depth</span><span class="p">[</span><span class="n">_c</span><span class="p">])</span>
</span><span id="Closures.populate_closure_dict-1535"><a href="#-1535"><span class="linenos">1535</span></a>            <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;zbml_max&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">faulted_depth</span><span class="p">[</span><span class="n">_c</span><span class="p">])</span>
</span><span id="Closures.populate_closure_dict-1536"><a href="#-1536"><span class="linenos">1536</span></a>            <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;zbml_avg&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">faulted_depth</span><span class="p">[</span><span class="n">_c</span><span class="p">])</span>
</span><span id="Closures.populate_closure_dict-1537"><a href="#-1537"><span class="linenos">1537</span></a>            <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;zbml_std&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">faulted_depth</span><span class="p">[</span><span class="n">_c</span><span class="p">])</span>
</span><span id="Closures.populate_closure_dict-1538"><a href="#-1538"><span class="linenos">1538</span></a>            <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;zbml_25pct&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">faulted_depth</span><span class="p">[</span><span class="n">_c</span><span class="p">],</span> <span class="mi">25</span><span class="p">)</span>
</span><span id="Closures.populate_closure_dict-1539"><a href="#-1539"><span class="linenos">1539</span></a>            <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;zbml_median&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">faulted_depth</span><span class="p">[</span><span class="n">_c</span><span class="p">],</span> <span class="mi">50</span><span class="p">)</span>
</span><span id="Closures.populate_closure_dict-1540"><a href="#-1540"><span class="linenos">1540</span></a>            <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;zbml_75pct&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">faulted_depth</span><span class="p">[</span><span class="n">_c</span><span class="p">],</span> <span class="mi">75</span><span class="p">)</span>
</span><span id="Closures.populate_closure_dict-1541"><a href="#-1541"><span class="linenos">1541</span></a>            <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;ng_min&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">faulted_net_to_gross</span><span class="p">[</span><span class="n">_c</span><span class="p">])</span>
</span><span id="Closures.populate_closure_dict-1542"><a href="#-1542"><span class="linenos">1542</span></a>            <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;ng_max&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">faulted_net_to_gross</span><span class="p">[</span><span class="n">_c</span><span class="p">])</span>
</span><span id="Closures.populate_closure_dict-1543"><a href="#-1543"><span class="linenos">1543</span></a>            <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;ng_avg&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">faulted_net_to_gross</span><span class="p">[</span><span class="n">_c</span><span class="p">])</span>
</span><span id="Closures.populate_closure_dict-1544"><a href="#-1544"><span class="linenos">1544</span></a>            <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;ng_std&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">faulted_net_to_gross</span><span class="p">[</span><span class="n">_c</span><span class="p">])</span>
</span><span id="Closures.populate_closure_dict-1545"><a href="#-1545"><span class="linenos">1545</span></a>            <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;ng_25pct&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">faulted_net_to_gross</span><span class="p">[</span><span class="n">_c</span><span class="p">],</span> <span class="mi">25</span><span class="p">)</span>
</span><span id="Closures.populate_closure_dict-1546"><a href="#-1546"><span class="linenos">1546</span></a>            <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;ng_median&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">faulted_net_to_gross</span><span class="p">[</span><span class="n">_c</span><span class="p">])</span>
</span><span id="Closures.populate_closure_dict-1547"><a href="#-1547"><span class="linenos">1547</span></a>            <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;ng_75pct&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">faulted_net_to_gross</span><span class="p">[</span><span class="n">_c</span><span class="p">],</span> <span class="mi">75</span><span class="p">)</span>
</span><span id="Closures.populate_closure_dict-1548"><a href="#-1548"><span class="linenos">1548</span></a>            <span class="c1"># Check for intersections with faults, salt and onlaps for closure type</span>
</span><span id="Closures.populate_closure_dict-1549"><a href="#-1549"><span class="linenos">1549</span></a>            <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;intersects_fault&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Closures.populate_closure_dict-1550"><a href="#-1550"><span class="linenos">1550</span></a>            <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;intersects_onlap&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Closures.populate_closure_dict-1551"><a href="#-1551"><span class="linenos">1551</span></a>            <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;intersects_salt&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Closures.populate_closure_dict-1552"><a href="#-1552"><span class="linenos">1552</span></a>            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wide_faults</span><span class="p">[</span><span class="n">_c</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
</span><span id="Closures.populate_closure_dict-1553"><a href="#-1553"><span class="linenos">1553</span></a>                <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;intersects_fault&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Closures.populate_closure_dict-1554"><a href="#-1554"><span class="linenos">1554</span></a>            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">onlaps_upward</span><span class="p">[</span><span class="n">_c</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
</span><span id="Closures.populate_closure_dict-1555"><a href="#-1555"><span class="linenos">1555</span></a>                <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;intersects_onlap&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Closures.populate_closure_dict-1556"><a href="#-1556"><span class="linenos">1556</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">include_salt</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wide_salt</span><span class="p">[</span><span class="n">_c</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
</span><span id="Closures.populate_closure_dict-1557"><a href="#-1557"><span class="linenos">1557</span></a>                <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;intersects_salt&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Closures.populate_closure_dict-1558"><a href="#-1558"><span class="linenos">1558</span></a>
</span><span id="Closures.populate_closure_dict-1559"><a href="#-1559"><span class="linenos">1559</span></a>            <span class="k">if</span> <span class="n">seismic_nmf</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Closures.populate_closure_dict-1560"><a href="#-1560"><span class="linenos">1560</span></a>                <span class="c1"># Using only the top of the closure, calculate seismic properties</span>
</span><span id="Closures.populate_closure_dict-1561"><a href="#-1561"><span class="linenos">1561</span></a>                <span class="n">labels_copy</span> <span class="o">=</span> <span class="n">labels</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Closures.populate_closure_dict-1562"><a href="#-1562"><span class="linenos">1562</span></a>                <span class="n">labels_copy</span><span class="p">[</span><span class="n">labels_copy</span> <span class="o">!=</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Closures.populate_closure_dict-1563"><a href="#-1563"><span class="linenos">1563</span></a>                <span class="n">top_closure</span> <span class="o">=</span> <span class="n">get_top_of_closure</span><span class="p">(</span><span class="n">labels_copy</span><span class="p">)</span>
</span><span id="Closures.populate_closure_dict-1564"><a href="#-1564"><span class="linenos">1564</span></a>                <span class="n">near</span> <span class="o">=</span> <span class="n">seismic_nmf</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">...</span><span class="p">][</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">top_closure</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)]</span>
</span><span id="Closures.populate_closure_dict-1565"><a href="#-1565"><span class="linenos">1565</span></a>                <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;near_min&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">near</span><span class="p">)</span>
</span><span id="Closures.populate_closure_dict-1566"><a href="#-1566"><span class="linenos">1566</span></a>                <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;near_max&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">near</span><span class="p">)</span>
</span><span id="Closures.populate_closure_dict-1567"><a href="#-1567"><span class="linenos">1567</span></a>                <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;near_avg&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">near</span><span class="p">)</span>
</span><span id="Closures.populate_closure_dict-1568"><a href="#-1568"><span class="linenos">1568</span></a>                <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;near_std&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">near</span><span class="p">)</span>
</span><span id="Closures.populate_closure_dict-1569"><a href="#-1569"><span class="linenos">1569</span></a>                <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;near_25pct&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">near</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span>
</span><span id="Closures.populate_closure_dict-1570"><a href="#-1570"><span class="linenos">1570</span></a>                <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;near_median&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">near</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
</span><span id="Closures.populate_closure_dict-1571"><a href="#-1571"><span class="linenos">1571</span></a>                <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;near_75pct&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">near</span><span class="p">,</span> <span class="mi">75</span><span class="p">)</span>
</span><span id="Closures.populate_closure_dict-1572"><a href="#-1572"><span class="linenos">1572</span></a>                <span class="n">mid</span> <span class="o">=</span> <span class="n">seismic_nmf</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="o">...</span><span class="p">][</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">top_closure</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)]</span>
</span><span id="Closures.populate_closure_dict-1573"><a href="#-1573"><span class="linenos">1573</span></a>                <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;mid_min&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">mid</span><span class="p">)</span>
</span><span id="Closures.populate_closure_dict-1574"><a href="#-1574"><span class="linenos">1574</span></a>                <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;mid_max&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">mid</span><span class="p">)</span>
</span><span id="Closures.populate_closure_dict-1575"><a href="#-1575"><span class="linenos">1575</span></a>                <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;mid_avg&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">mid</span><span class="p">)</span>
</span><span id="Closures.populate_closure_dict-1576"><a href="#-1576"><span class="linenos">1576</span></a>                <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;mid_std&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">mid</span><span class="p">)</span>
</span><span id="Closures.populate_closure_dict-1577"><a href="#-1577"><span class="linenos">1577</span></a>                <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;mid_25pct&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">mid</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span>
</span><span id="Closures.populate_closure_dict-1578"><a href="#-1578"><span class="linenos">1578</span></a>                <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;mid_median&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">mid</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
</span><span id="Closures.populate_closure_dict-1579"><a href="#-1579"><span class="linenos">1579</span></a>                <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;mid_75pct&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">mid</span><span class="p">,</span> <span class="mi">75</span><span class="p">)</span>
</span><span id="Closures.populate_closure_dict-1580"><a href="#-1580"><span class="linenos">1580</span></a>                <span class="n">far</span> <span class="o">=</span> <span class="n">seismic_nmf</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="o">...</span><span class="p">][</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">top_closure</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)]</span>
</span><span id="Closures.populate_closure_dict-1581"><a href="#-1581"><span class="linenos">1581</span></a>                <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;far_min&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">far</span><span class="p">)</span>
</span><span id="Closures.populate_closure_dict-1582"><a href="#-1582"><span class="linenos">1582</span></a>                <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;far_max&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">far</span><span class="p">)</span>
</span><span id="Closures.populate_closure_dict-1583"><a href="#-1583"><span class="linenos">1583</span></a>                <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;far_avg&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">far</span><span class="p">)</span>
</span><span id="Closures.populate_closure_dict-1584"><a href="#-1584"><span class="linenos">1584</span></a>                <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;far_std&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">far</span><span class="p">)</span>
</span><span id="Closures.populate_closure_dict-1585"><a href="#-1585"><span class="linenos">1585</span></a>                <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;far_25pct&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">far</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span>
</span><span id="Closures.populate_closure_dict-1586"><a href="#-1586"><span class="linenos">1586</span></a>                <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;far_median&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">far</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
</span><span id="Closures.populate_closure_dict-1587"><a href="#-1587"><span class="linenos">1587</span></a>                <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;far_75pct&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">far</span><span class="p">,</span> <span class="mi">75</span><span class="p">)</span>
</span><span id="Closures.populate_closure_dict-1588"><a href="#-1588"><span class="linenos">1588</span></a>                <span class="n">intercept</span> <span class="o">=</span> <span class="n">ai</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">top_closure</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)]</span>
</span><span id="Closures.populate_closure_dict-1589"><a href="#-1589"><span class="linenos">1589</span></a>                <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;intercept_min&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">intercept</span><span class="p">)</span>
</span><span id="Closures.populate_closure_dict-1590"><a href="#-1590"><span class="linenos">1590</span></a>                <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;intercept_max&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">intercept</span><span class="p">)</span>
</span><span id="Closures.populate_closure_dict-1591"><a href="#-1591"><span class="linenos">1591</span></a>                <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;intercept_avg&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">intercept</span><span class="p">)</span>
</span><span id="Closures.populate_closure_dict-1592"><a href="#-1592"><span class="linenos">1592</span></a>                <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;intercept_std&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">intercept</span><span class="p">)</span>
</span><span id="Closures.populate_closure_dict-1593"><a href="#-1593"><span class="linenos">1593</span></a>                <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;intercept_25pct&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">intercept</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span>
</span><span id="Closures.populate_closure_dict-1594"><a href="#-1594"><span class="linenos">1594</span></a>                <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;intercept_median&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">intercept</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
</span><span id="Closures.populate_closure_dict-1595"><a href="#-1595"><span class="linenos">1595</span></a>                <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;intercept_75pct&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">intercept</span><span class="p">,</span> <span class="mi">75</span><span class="p">)</span>
</span><span id="Closures.populate_closure_dict-1596"><a href="#-1596"><span class="linenos">1596</span></a>                <span class="n">gradient</span> <span class="o">=</span> <span class="n">gi</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">top_closure</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)]</span>
</span><span id="Closures.populate_closure_dict-1597"><a href="#-1597"><span class="linenos">1597</span></a>                <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;gradient_min&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">gradient</span><span class="p">)</span>
</span><span id="Closures.populate_closure_dict-1598"><a href="#-1598"><span class="linenos">1598</span></a>                <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;gradient_max&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">gradient</span><span class="p">)</span>
</span><span id="Closures.populate_closure_dict-1599"><a href="#-1599"><span class="linenos">1599</span></a>                <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;gradient_avg&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">gradient</span><span class="p">)</span>
</span><span id="Closures.populate_closure_dict-1600"><a href="#-1600"><span class="linenos">1600</span></a>                <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;gradient_std&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">gradient</span><span class="p">)</span>
</span><span id="Closures.populate_closure_dict-1601"><a href="#-1601"><span class="linenos">1601</span></a>                <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;gradient_25pct&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">gradient</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span>
</span><span id="Closures.populate_closure_dict-1602"><a href="#-1602"><span class="linenos">1602</span></a>                <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;gradient_median&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">gradient</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
</span><span id="Closures.populate_closure_dict-1603"><a href="#-1603"><span class="linenos">1603</span></a>                <span class="n">cl</span><span class="p">[</span><span class="s2">&quot;gradient_75pct&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">gradient</span><span class="p">,</span> <span class="mi">75</span><span class="p">)</span>
</span><span id="Closures.populate_closure_dict-1604"><a href="#-1604"><span class="linenos">1604</span></a>
</span><span id="Closures.populate_closure_dict-1605"><a href="#-1605"><span class="linenos">1605</span></a>            <span class="n">clist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cl</span><span class="p">)</span>
</span><span id="Closures.populate_closure_dict-1606"><a href="#-1606"><span class="linenos">1606</span></a>
</span><span id="Closures.populate_closure_dict-1607"><a href="#-1607"><span class="linenos">1607</span></a>        <span class="k">return</span> <span class="n">clist</span>
</span></pre></div>


    

                            </div>
                            <div id="Closures.write_closure_info_to_log" class="classattr">
                                        <input id="Closures.write_closure_info_to_log-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">write_closure_info_to_log</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">seismic_nmf</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Closures.write_closure_info_to_log-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Closures.write_closure_info_to_log"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Closures.write_closure_info_to_log-1609"><a href="#-1609"><span class="linenos">1609</span></a>    <span class="k">def</span> <span class="nf">write_closure_info_to_log</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seismic_nmf</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="Closures.write_closure_info_to_log-1610"><a href="#-1610"><span class="linenos">1610</span></a>        <span class="sd">&quot;&quot;&quot;store info about closure in log file&quot;&quot;&quot;</span>
</span><span id="Closures.write_closure_info_to_log-1611"><a href="#-1611"><span class="linenos">1611</span></a>        <span class="n">top_sand_layers</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">top_lith_indices</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">facies</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">==</span> <span class="mf">1.0</span><span class="p">]</span>
</span><span id="Closures.write_closure_info_to_log-1612"><a href="#-1612"><span class="linenos">1612</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="Closures.write_closure_info_to_log-1613"><a href="#-1613"><span class="linenos">1613</span></a>            <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="Closures.write_closure_info_to_log-1614"><a href="#-1614"><span class="linenos">1614</span></a>            <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span>
</span><span id="Closures.write_closure_info_to_log-1615"><a href="#-1615"><span class="linenos">1615</span></a>            <span class="n">subkey</span><span class="o">=</span><span class="s2">&quot;top_sand_layers&quot;</span><span class="p">,</span>
</span><span id="Closures.write_closure_info_to_log-1616"><a href="#-1616"><span class="linenos">1616</span></a>            <span class="n">val</span><span class="o">=</span><span class="n">top_sand_layers</span><span class="p">,</span>
</span><span id="Closures.write_closure_info_to_log-1617"><a href="#-1617"><span class="linenos">1617</span></a>        <span class="p">)</span>
</span><span id="Closures.write_closure_info_to_log-1618"><a href="#-1618"><span class="linenos">1618</span></a>        <span class="n">o</span> <span class="o">=</span> <span class="n">measure</span><span class="o">.</span><span class="n">label</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">oil_closures</span><span class="p">[:],</span> <span class="n">connectivity</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">background</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="Closures.write_closure_info_to_log-1619"><a href="#-1619"><span class="linenos">1619</span></a>        <span class="n">g</span> <span class="o">=</span> <span class="n">measure</span><span class="o">.</span><span class="n">label</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gas_closures</span><span class="p">[:],</span> <span class="n">connectivity</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">background</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="Closures.write_closure_info_to_log-1620"><a href="#-1620"><span class="linenos">1620</span></a>        <span class="n">b</span> <span class="o">=</span> <span class="n">measure</span><span class="o">.</span><span class="n">label</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">brine_closures</span><span class="p">[:],</span> <span class="n">connectivity</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">background</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="Closures.write_closure_info_to_log-1621"><a href="#-1621"><span class="linenos">1621</span></a>        <span class="n">oil_closures</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">populate_closure_dict</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="s2">&quot;oil&quot;</span><span class="p">,</span> <span class="n">seismic_nmf</span><span class="p">)</span>
</span><span id="Closures.write_closure_info_to_log-1622"><a href="#-1622"><span class="linenos">1622</span></a>        <span class="n">gas_closures</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">populate_closure_dict</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="s2">&quot;gas&quot;</span><span class="p">,</span> <span class="n">seismic_nmf</span><span class="p">)</span>
</span><span id="Closures.write_closure_info_to_log-1623"><a href="#-1623"><span class="linenos">1623</span></a>        <span class="n">brine_closures</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">populate_closure_dict</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="s2">&quot;brine&quot;</span><span class="p">,</span> <span class="n">seismic_nmf</span><span class="p">)</span>
</span><span id="Closures.write_closure_info_to_log-1624"><a href="#-1624"><span class="linenos">1624</span></a>        <span class="n">all_closures</span> <span class="o">=</span> <span class="n">oil_closures</span> <span class="o">+</span> <span class="n">gas_closures</span> <span class="o">+</span> <span class="n">brine_closures</span>
</span><span id="Closures.write_closure_info_to_log-1625"><a href="#-1625"><span class="linenos">1625</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">all_closures</span><span class="p">):</span>
</span><span id="Closures.write_closure_info_to_log-1626"><a href="#-1626"><span class="linenos">1626</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">sqldict</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;closure_</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">c</span>
</span><span id="Closures.write_closure_info_to_log-1627"><a href="#-1627"><span class="linenos">1627</span></a>        <span class="n">num_labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">o</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
</span><span id="Closures.write_closure_info_to_log-1628"><a href="#-1628"><span class="linenos">1628</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="Closures.write_closure_info_to_log-1629"><a href="#-1629"><span class="linenos">1629</span></a>            <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="Closures.write_closure_info_to_log-1630"><a href="#-1630"><span class="linenos">1630</span></a>            <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span>
</span><span id="Closures.write_closure_info_to_log-1631"><a href="#-1631"><span class="linenos">1631</span></a>            <span class="n">subkey</span><span class="o">=</span><span class="s2">&quot;number_hc_closures&quot;</span><span class="p">,</span>
</span><span id="Closures.write_closure_info_to_log-1632"><a href="#-1632"><span class="linenos">1632</span></a>            <span class="n">val</span><span class="o">=</span><span class="n">num_labels</span><span class="p">,</span>
</span><span id="Closures.write_closure_info_to_log-1633"><a href="#-1633"><span class="linenos">1633</span></a>        <span class="p">)</span>
</span><span id="Closures.write_closure_info_to_log-1634"><a href="#-1634"><span class="linenos">1634</span></a>        <span class="c1"># Add total number of closure voxels, with ratio of closure voxels given as a percentage</span>
</span><span id="Closures.write_closure_info_to_log-1635"><a href="#-1635"><span class="linenos">1635</span></a>        <span class="n">closure_voxel_count</span> <span class="o">=</span> <span class="n">o</span><span class="p">[</span><span class="n">o</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="o">+</span> <span class="n">g</span><span class="p">[</span><span class="n">g</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="Closures.write_closure_info_to_log-1636"><a href="#-1636"><span class="linenos">1636</span></a>        <span class="n">closure_voxel_pct</span> <span class="o">=</span> <span class="n">closure_voxel_count</span> <span class="o">/</span> <span class="n">o</span><span class="o">.</span><span class="n">size</span>
</span><span id="Closures.write_closure_info_to_log-1637"><a href="#-1637"><span class="linenos">1637</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="Closures.write_closure_info_to_log-1638"><a href="#-1638"><span class="linenos">1638</span></a>            <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="Closures.write_closure_info_to_log-1639"><a href="#-1639"><span class="linenos">1639</span></a>            <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span>
</span><span id="Closures.write_closure_info_to_log-1640"><a href="#-1640"><span class="linenos">1640</span></a>            <span class="n">subkey</span><span class="o">=</span><span class="s2">&quot;closure_voxel_count&quot;</span><span class="p">,</span>
</span><span id="Closures.write_closure_info_to_log-1641"><a href="#-1641"><span class="linenos">1641</span></a>            <span class="n">val</span><span class="o">=</span><span class="n">closure_voxel_count</span><span class="p">,</span>
</span><span id="Closures.write_closure_info_to_log-1642"><a href="#-1642"><span class="linenos">1642</span></a>        <span class="p">)</span>
</span><span id="Closures.write_closure_info_to_log-1643"><a href="#-1643"><span class="linenos">1643</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="Closures.write_closure_info_to_log-1644"><a href="#-1644"><span class="linenos">1644</span></a>            <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="Closures.write_closure_info_to_log-1645"><a href="#-1645"><span class="linenos">1645</span></a>            <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span>
</span><span id="Closures.write_closure_info_to_log-1646"><a href="#-1646"><span class="linenos">1646</span></a>            <span class="n">subkey</span><span class="o">=</span><span class="s2">&quot;closure_voxel_pct&quot;</span><span class="p">,</span>
</span><span id="Closures.write_closure_info_to_log-1647"><a href="#-1647"><span class="linenos">1647</span></a>            <span class="n">val</span><span class="o">=</span><span class="n">closure_voxel_pct</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span>
</span><span id="Closures.write_closure_info_to_log-1648"><a href="#-1648"><span class="linenos">1648</span></a>        <span class="p">)</span>
</span><span id="Closures.write_closure_info_to_log-1649"><a href="#-1649"><span class="linenos">1649</span></a>        <span class="c1"># Same for Brine</span>
</span><span id="Closures.write_closure_info_to_log-1650"><a href="#-1650"><span class="linenos">1650</span></a>        <span class="n">_brine_voxels</span> <span class="o">=</span> <span class="n">b</span><span class="p">[</span><span class="n">b</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="Closures.write_closure_info_to_log-1651"><a href="#-1651"><span class="linenos">1651</span></a>        <span class="n">_brine_voxels_pct</span> <span class="o">=</span> <span class="n">_brine_voxels</span> <span class="o">/</span> <span class="n">b</span><span class="o">.</span><span class="n">size</span>
</span><span id="Closures.write_closure_info_to_log-1652"><a href="#-1652"><span class="linenos">1652</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="Closures.write_closure_info_to_log-1653"><a href="#-1653"><span class="linenos">1653</span></a>            <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="Closures.write_closure_info_to_log-1654"><a href="#-1654"><span class="linenos">1654</span></a>            <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span>
</span><span id="Closures.write_closure_info_to_log-1655"><a href="#-1655"><span class="linenos">1655</span></a>            <span class="n">subkey</span><span class="o">=</span><span class="s2">&quot;closure_voxel_count_brine&quot;</span><span class="p">,</span>
</span><span id="Closures.write_closure_info_to_log-1656"><a href="#-1656"><span class="linenos">1656</span></a>            <span class="n">val</span><span class="o">=</span><span class="n">_brine_voxels</span><span class="p">,</span>
</span><span id="Closures.write_closure_info_to_log-1657"><a href="#-1657"><span class="linenos">1657</span></a>        <span class="p">)</span>
</span><span id="Closures.write_closure_info_to_log-1658"><a href="#-1658"><span class="linenos">1658</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="Closures.write_closure_info_to_log-1659"><a href="#-1659"><span class="linenos">1659</span></a>            <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="Closures.write_closure_info_to_log-1660"><a href="#-1660"><span class="linenos">1660</span></a>            <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span>
</span><span id="Closures.write_closure_info_to_log-1661"><a href="#-1661"><span class="linenos">1661</span></a>            <span class="n">subkey</span><span class="o">=</span><span class="s2">&quot;closure_voxel_pct_brine&quot;</span><span class="p">,</span>
</span><span id="Closures.write_closure_info_to_log-1662"><a href="#-1662"><span class="linenos">1662</span></a>            <span class="n">val</span><span class="o">=</span><span class="n">_brine_voxels_pct</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span>
</span><span id="Closures.write_closure_info_to_log-1663"><a href="#-1663"><span class="linenos">1663</span></a>        <span class="p">)</span>
</span><span id="Closures.write_closure_info_to_log-1664"><a href="#-1664"><span class="linenos">1664</span></a>        <span class="c1"># Same for Oil</span>
</span><span id="Closures.write_closure_info_to_log-1665"><a href="#-1665"><span class="linenos">1665</span></a>        <span class="n">_oil_voxels</span> <span class="o">=</span> <span class="n">o</span><span class="p">[</span><span class="n">o</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="Closures.write_closure_info_to_log-1666"><a href="#-1666"><span class="linenos">1666</span></a>        <span class="n">_oil_voxels_pct</span> <span class="o">=</span> <span class="n">_oil_voxels</span> <span class="o">/</span> <span class="n">o</span><span class="o">.</span><span class="n">size</span>
</span><span id="Closures.write_closure_info_to_log-1667"><a href="#-1667"><span class="linenos">1667</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="Closures.write_closure_info_to_log-1668"><a href="#-1668"><span class="linenos">1668</span></a>            <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="Closures.write_closure_info_to_log-1669"><a href="#-1669"><span class="linenos">1669</span></a>            <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span>
</span><span id="Closures.write_closure_info_to_log-1670"><a href="#-1670"><span class="linenos">1670</span></a>            <span class="n">subkey</span><span class="o">=</span><span class="s2">&quot;closure_voxel_count_oil&quot;</span><span class="p">,</span>
</span><span id="Closures.write_closure_info_to_log-1671"><a href="#-1671"><span class="linenos">1671</span></a>            <span class="n">val</span><span class="o">=</span><span class="n">_oil_voxels</span><span class="p">,</span>
</span><span id="Closures.write_closure_info_to_log-1672"><a href="#-1672"><span class="linenos">1672</span></a>        <span class="p">)</span>
</span><span id="Closures.write_closure_info_to_log-1673"><a href="#-1673"><span class="linenos">1673</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="Closures.write_closure_info_to_log-1674"><a href="#-1674"><span class="linenos">1674</span></a>            <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="Closures.write_closure_info_to_log-1675"><a href="#-1675"><span class="linenos">1675</span></a>            <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span>
</span><span id="Closures.write_closure_info_to_log-1676"><a href="#-1676"><span class="linenos">1676</span></a>            <span class="n">subkey</span><span class="o">=</span><span class="s2">&quot;closure_voxel_pct_oil&quot;</span><span class="p">,</span>
</span><span id="Closures.write_closure_info_to_log-1677"><a href="#-1677"><span class="linenos">1677</span></a>            <span class="n">val</span><span class="o">=</span><span class="n">_oil_voxels_pct</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span>
</span><span id="Closures.write_closure_info_to_log-1678"><a href="#-1678"><span class="linenos">1678</span></a>        <span class="p">)</span>
</span><span id="Closures.write_closure_info_to_log-1679"><a href="#-1679"><span class="linenos">1679</span></a>        <span class="c1"># Same for Gas</span>
</span><span id="Closures.write_closure_info_to_log-1680"><a href="#-1680"><span class="linenos">1680</span></a>        <span class="n">_gas_voxels</span> <span class="o">=</span> <span class="n">g</span><span class="p">[</span><span class="n">g</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="Closures.write_closure_info_to_log-1681"><a href="#-1681"><span class="linenos">1681</span></a>        <span class="n">_gas_voxels_pct</span> <span class="o">=</span> <span class="n">_gas_voxels</span> <span class="o">/</span> <span class="n">g</span><span class="o">.</span><span class="n">size</span>
</span><span id="Closures.write_closure_info_to_log-1682"><a href="#-1682"><span class="linenos">1682</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="Closures.write_closure_info_to_log-1683"><a href="#-1683"><span class="linenos">1683</span></a>            <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="Closures.write_closure_info_to_log-1684"><a href="#-1684"><span class="linenos">1684</span></a>            <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span>
</span><span id="Closures.write_closure_info_to_log-1685"><a href="#-1685"><span class="linenos">1685</span></a>            <span class="n">subkey</span><span class="o">=</span><span class="s2">&quot;closure_voxel_count_gas&quot;</span><span class="p">,</span>
</span><span id="Closures.write_closure_info_to_log-1686"><a href="#-1686"><span class="linenos">1686</span></a>            <span class="n">val</span><span class="o">=</span><span class="n">_gas_voxels</span><span class="p">,</span>
</span><span id="Closures.write_closure_info_to_log-1687"><a href="#-1687"><span class="linenos">1687</span></a>        <span class="p">)</span>
</span><span id="Closures.write_closure_info_to_log-1688"><a href="#-1688"><span class="linenos">1688</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span>
</span><span id="Closures.write_closure_info_to_log-1689"><a href="#-1689"><span class="linenos">1689</span></a>            <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="Closures.write_closure_info_to_log-1690"><a href="#-1690"><span class="linenos">1690</span></a>            <span class="n">mainkey</span><span class="o">=</span><span class="s2">&quot;model_parameters&quot;</span><span class="p">,</span>
</span><span id="Closures.write_closure_info_to_log-1691"><a href="#-1691"><span class="linenos">1691</span></a>            <span class="n">subkey</span><span class="o">=</span><span class="s2">&quot;closure_voxel_pct_gas&quot;</span><span class="p">,</span>
</span><span id="Closures.write_closure_info_to_log-1692"><a href="#-1692"><span class="linenos">1692</span></a>            <span class="n">val</span><span class="o">=</span><span class="n">_gas_voxels_pct</span><span class="p">,</span>
</span><span id="Closures.write_closure_info_to_log-1693"><a href="#-1693"><span class="linenos">1693</span></a>        <span class="p">)</span>
</span><span id="Closures.write_closure_info_to_log-1694"><a href="#-1694"><span class="linenos">1694</span></a>        <span class="c1"># Write old logfile as well as the sql dict</span>
</span><span id="Closures.write_closure_info_to_log-1695"><a href="#-1695"><span class="linenos">1695</span></a>        <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;layers for closure computation: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">top_lith_indices</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="Closures.write_closure_info_to_log-1696"><a href="#-1696"><span class="linenos">1696</span></a>        <span class="n">msg</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;Number of HC Closures : </span><span class="si">{</span><span class="n">num_labels</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="Closures.write_closure_info_to_log-1697"><a href="#-1697"><span class="linenos">1697</span></a>        <span class="n">msg</span> <span class="o">+=</span> <span class="p">(</span>
</span><span id="Closures.write_closure_info_to_log-1698"><a href="#-1698"><span class="linenos">1698</span></a>            <span class="sa">f</span><span class="s2">&quot;Closure voxel count: </span><span class="si">{</span><span class="n">closure_voxel_count</span><span class="si">}</span><span class="s2"> - &quot;</span>
</span><span id="Closures.write_closure_info_to_log-1699"><a href="#-1699"><span class="linenos">1699</span></a>            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">closure_voxel_pct</span><span class="si">:</span><span class="s2">5.2%</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="Closures.write_closure_info_to_log-1700"><a href="#-1700"><span class="linenos">1700</span></a>        <span class="p">)</span>
</span><span id="Closures.write_closure_info_to_log-1701"><a href="#-1701"><span class="linenos">1701</span></a>        <span class="n">msg</span> <span class="o">+=</span> <span class="p">(</span>
</span><span id="Closures.write_closure_info_to_log-1702"><a href="#-1702"><span class="linenos">1702</span></a>            <span class="sa">f</span><span class="s2">&quot;Closure voxel count: (brine) </span><span class="si">{</span><span class="n">_brine_voxels</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">_brine_voxels_pct</span><span class="si">:</span><span class="s2">5.2%</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="Closures.write_closure_info_to_log-1703"><a href="#-1703"><span class="linenos">1703</span></a>        <span class="p">)</span>
</span><span id="Closures.write_closure_info_to_log-1704"><a href="#-1704"><span class="linenos">1704</span></a>        <span class="n">msg</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;Closure voxel count: (oil) </span><span class="si">{</span><span class="n">_oil_voxels</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">_oil_voxels_pct</span><span class="si">:</span><span class="s2">5.2%</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="Closures.write_closure_info_to_log-1705"><a href="#-1705"><span class="linenos">1705</span></a>        <span class="n">msg</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;Closure voxel count: (gas) </span><span class="si">{</span><span class="n">_gas_voxels</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">_gas_voxels_pct</span><span class="si">:</span><span class="s2">5.2%</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="Closures.write_closure_info_to_log-1706"><a href="#-1706"><span class="linenos">1706</span></a>        <span class="nb">print</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="Closures.write_closure_info_to_log-1707"><a href="#-1707"><span class="linenos">1707</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">facies</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="Closures.write_closure_info_to_log-1708"><a href="#-1708"><span class="linenos">1708</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">facies</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Closures.write_closure_info_to_log-1709"><a href="#-1709"><span class="linenos">1709</span></a>                <span class="n">msg</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;  layers for closure computation:   </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">, sand</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="Closures.write_closure_info_to_log-1710"><a href="#-1710"><span class="linenos">1710</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Closures.write_closure_info_to_log-1711"><a href="#-1711"><span class="linenos">1711</span></a>                <span class="n">msg</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;  layers for closure computation:   </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">, shale</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="Closures.write_closure_info_to_log-1712"><a href="#-1712"><span class="linenos">1712</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>store info about closure in log file</p>
</div>


                            </div>
                            <div id="Closures.parse_label_values_and_counts" class="classattr">
                                        <input id="Closures.parse_label_values_and_counts-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">parse_label_values_and_counts</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">labels_clean</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Closures.parse_label_values_and_counts-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Closures.parse_label_values_and_counts"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Closures.parse_label_values_and_counts-1714"><a href="#-1714"><span class="linenos">1714</span></a>    <span class="k">def</span> <span class="nf">parse_label_values_and_counts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">labels_clean</span><span class="p">):</span>
</span><span id="Closures.parse_label_values_and_counts-1715"><a href="#-1715"><span class="linenos">1715</span></a>        <span class="sd">&quot;&quot;&quot;parse label values and counts&quot;&quot;&quot;</span>
</span><span id="Closures.parse_label_values_and_counts-1716"><a href="#-1716"><span class="linenos">1716</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Closures.parse_label_values_and_counts-1717"><a href="#-1717"><span class="linenos">1717</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; Inside parse_label_values_and_counts&quot;</span><span class="p">)</span>
</span><span id="Closures.parse_label_values_and_counts-1718"><a href="#-1718"><span class="linenos">1718</span></a>        <span class="n">next_label</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Closures.parse_label_values_and_counts-1719"><a href="#-1719"><span class="linenos">1719</span></a>        <span class="n">label_values</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Closures.parse_label_values_and_counts-1720"><a href="#-1720"><span class="linenos">1720</span></a>        <span class="n">label_counts</span> <span class="o">=</span> <span class="p">[</span><span class="n">labels_clean</span><span class="p">[</span><span class="n">labels_clean</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">]</span>
</span><span id="Closures.parse_label_values_and_counts-1721"><a href="#-1721"><span class="linenos">1721</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">labels_clean</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="Closures.parse_label_values_and_counts-1722"><a href="#-1722"><span class="linenos">1722</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="Closures.parse_label_values_and_counts-1723"><a href="#-1723"><span class="linenos">1723</span></a>                <span class="n">next_label</span> <span class="o">=</span> <span class="n">labels_clean</span><span class="p">[</span><span class="n">labels_clean</span> <span class="o">&gt;</span> <span class="n">next_label</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
</span><span id="Closures.parse_label_values_and_counts-1724"><a href="#-1724"><span class="linenos">1724</span></a>            <span class="k">except</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
</span><span id="Closures.parse_label_values_and_counts-1725"><a href="#-1725"><span class="linenos">1725</span></a>                <span class="k">break</span>
</span><span id="Closures.parse_label_values_and_counts-1726"><a href="#-1726"><span class="linenos">1726</span></a>            <span class="n">label_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">next_label</span><span class="p">)</span>
</span><span id="Closures.parse_label_values_and_counts-1727"><a href="#-1727"><span class="linenos">1727</span></a>            <span class="n">label_counts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">labels_clean</span><span class="p">[</span><span class="n">labels_clean</span> <span class="o">==</span> <span class="n">next_label</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
</span><span id="Closures.parse_label_values_and_counts-1728"><a href="#-1728"><span class="linenos">1728</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="Closures.parse_label_values_and_counts-1729"><a href="#-1729"><span class="linenos">1729</span></a>                <span class="sa">f</span><span class="s2">&quot;Label: </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">, label_values: </span><span class="si">{</span><span class="n">label_values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">, label_counts: </span><span class="si">{</span><span class="n">label_counts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Closures.parse_label_values_and_counts-1730"><a href="#-1730"><span class="linenos">1730</span></a>            <span class="p">)</span>
</span><span id="Closures.parse_label_values_and_counts-1731"><a href="#-1731"><span class="linenos">1731</span></a>        <span class="c1"># force labels to use consecutive integer values</span>
</span><span id="Closures.parse_label_values_and_counts-1732"><a href="#-1732"><span class="linenos">1732</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ilabel</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">label_values</span><span class="p">):</span>
</span><span id="Closures.parse_label_values_and_counts-1733"><a href="#-1733"><span class="linenos">1733</span></a>            <span class="n">labels_clean</span><span class="p">[</span><span class="n">labels_clean</span> <span class="o">==</span> <span class="n">ilabel</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
</span><span id="Closures.parse_label_values_and_counts-1734"><a href="#-1734"><span class="linenos">1734</span></a>            <span class="n">label_values</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
</span><span id="Closures.parse_label_values_and_counts-1735"><a href="#-1735"><span class="linenos">1735</span></a>        <span class="c1"># labels_clean = self.remove_small_objects(labels_clean)  # already applied to labels_clean</span>
</span><span id="Closures.parse_label_values_and_counts-1736"><a href="#-1736"><span class="linenos">1736</span></a>        <span class="c1"># Remove label_value 0</span>
</span><span id="Closures.parse_label_values_and_counts-1737"><a href="#-1737"><span class="linenos">1737</span></a>        <span class="n">label_values</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="Closures.parse_label_values_and_counts-1738"><a href="#-1738"><span class="linenos">1738</span></a>        <span class="k">return</span> <span class="n">label_values</span><span class="p">,</span> <span class="n">labels_clean</span>
</span></pre></div>


            <div class="docstring"><p>parse label values and counts</p>
</div>


                            </div>
                            <div id="Closures.assign_fluid_types" class="classattr">
                                        <input id="Closures.assign_fluid_types-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">assign_fluid_types</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">label_values</span>, </span><span class="param"><span class="n">labels_clean</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Closures.assign_fluid_types-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Closures.assign_fluid_types"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Closures.assign_fluid_types-1740"><a href="#-1740"><span class="linenos">1740</span></a>    <span class="k">def</span> <span class="nf">assign_fluid_types</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">label_values</span><span class="p">,</span> <span class="n">labels_clean</span><span class="p">):</span>
</span><span id="Closures.assign_fluid_types-1741"><a href="#-1741"><span class="linenos">1741</span></a>        <span class="sd">&quot;&quot;&quot;randomly assign oil or gas to closure&quot;&quot;&quot;</span>
</span><span id="Closures.assign_fluid_types-1742"><a href="#-1742"><span class="linenos">1742</span></a>        <span class="nb">print</span><span class="p">(</span>
</span><span id="Closures.assign_fluid_types-1743"><a href="#-1743"><span class="linenos">1743</span></a>            <span class="s2">&quot; labels_clean.min(), labels_clean.max() = &quot;</span><span class="p">,</span>
</span><span id="Closures.assign_fluid_types-1744"><a href="#-1744"><span class="linenos">1744</span></a>            <span class="n">labels_clean</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
</span><span id="Closures.assign_fluid_types-1745"><a href="#-1745"><span class="linenos">1745</span></a>            <span class="n">labels_clean</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span>
</span><span id="Closures.assign_fluid_types-1746"><a href="#-1746"><span class="linenos">1746</span></a>        <span class="p">)</span>
</span><span id="Closures.assign_fluid_types-1747"><a href="#-1747"><span class="linenos">1747</span></a>        <span class="n">_brine_closures</span> <span class="o">=</span> <span class="p">(</span><span class="n">labels_clean</span> <span class="o">*</span> <span class="mf">0.0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;uint8&quot;</span><span class="p">)</span>
</span><span id="Closures.assign_fluid_types-1748"><a href="#-1748"><span class="linenos">1748</span></a>        <span class="n">_oil_closures</span> <span class="o">=</span> <span class="p">(</span><span class="n">labels_clean</span> <span class="o">*</span> <span class="mf">0.0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;uint8&quot;</span><span class="p">)</span>
</span><span id="Closures.assign_fluid_types-1749"><a href="#-1749"><span class="linenos">1749</span></a>        <span class="n">_gas_closures</span> <span class="o">=</span> <span class="p">(</span><span class="n">labels_clean</span> <span class="o">*</span> <span class="mf">0.0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;uint8&quot;</span><span class="p">)</span>
</span><span id="Closures.assign_fluid_types-1750"><a href="#-1750"><span class="linenos">1750</span></a>
</span><span id="Closures.assign_fluid_types-1751"><a href="#-1751"><span class="linenos">1751</span></a>        <span class="n">fluid_type_code</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">labels_clean</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="Closures.assign_fluid_types-1752"><a href="#-1752"><span class="linenos">1752</span></a>
</span><span id="Closures.assign_fluid_types-1753"><a href="#-1753"><span class="linenos">1753</span></a>        <span class="n">_closure_segments</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">closure_segments</span><span class="p">[:]</span>
</span><span id="Closures.assign_fluid_types-1754"><a href="#-1754"><span class="linenos">1754</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">labels_clean</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="Closures.assign_fluid_types-1755"><a href="#-1755"><span class="linenos">1755</span></a>            <span class="n">voxel_count</span> <span class="o">=</span> <span class="n">labels_clean</span><span class="p">[</span><span class="n">labels_clean</span> <span class="o">==</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="Closures.assign_fluid_types-1756"><a href="#-1756"><span class="linenos">1756</span></a>            <span class="k">if</span> <span class="n">voxel_count</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Closures.assign_fluid_types-1757"><a href="#-1757"><span class="linenos">1757</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Voxel Count: </span><span class="si">{</span><span class="n">voxel_count</span><span class="si">}</span><span class="se">\t</span><span class="s2">Fluid type: </span><span class="si">{</span><span class="n">fluid_type_code</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Closures.assign_fluid_types-1758"><a href="#-1758"><span class="linenos">1758</span></a>            <span class="c1"># not in closure = 0</span>
</span><span id="Closures.assign_fluid_types-1759"><a href="#-1759"><span class="linenos">1759</span></a>            <span class="c1"># closure with brine filled reservoir fluid_type_code = 1</span>
</span><span id="Closures.assign_fluid_types-1760"><a href="#-1760"><span class="linenos">1760</span></a>            <span class="c1"># closure with oil filled reservoir fluid_type_code = 2</span>
</span><span id="Closures.assign_fluid_types-1761"><a href="#-1761"><span class="linenos">1761</span></a>            <span class="c1"># closure with gas filled reservoir fluid_type_code = 3</span>
</span><span id="Closures.assign_fluid_types-1762"><a href="#-1762"><span class="linenos">1762</span></a>            <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">label_values</span><span class="p">:</span>
</span><span id="Closures.assign_fluid_types-1763"><a href="#-1763"><span class="linenos">1763</span></a>                <span class="k">if</span> <span class="n">fluid_type_code</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Closures.assign_fluid_types-1764"><a href="#-1764"><span class="linenos">1764</span></a>                    <span class="c1"># brine: change labels_clean contents to fluid_type_code = 1 (same as background)</span>
</span><span id="Closures.assign_fluid_types-1765"><a href="#-1765"><span class="linenos">1765</span></a>                    <span class="n">_brine_closures</span><span class="p">[</span>
</span><span id="Closures.assign_fluid_types-1766"><a href="#-1766"><span class="linenos">1766</span></a>                        <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">labels_clean</span> <span class="o">==</span> <span class="n">i</span><span class="p">,</span> <span class="n">_closure_segments</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="Closures.assign_fluid_types-1767"><a href="#-1767"><span class="linenos">1767</span></a>                    <span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="Closures.assign_fluid_types-1768"><a href="#-1768"><span class="linenos">1768</span></a>                <span class="k">elif</span> <span class="n">fluid_type_code</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Closures.assign_fluid_types-1769"><a href="#-1769"><span class="linenos">1769</span></a>                    <span class="c1"># oil: change labels_clean contents to fluid_type_code = 2</span>
</span><span id="Closures.assign_fluid_types-1770"><a href="#-1770"><span class="linenos">1770</span></a>                    <span class="n">_oil_closures</span><span class="p">[</span><span class="n">labels_clean</span> <span class="o">==</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="Closures.assign_fluid_types-1771"><a href="#-1771"><span class="linenos">1771</span></a>                <span class="k">elif</span> <span class="n">fluid_type_code</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="Closures.assign_fluid_types-1772"><a href="#-1772"><span class="linenos">1772</span></a>                    <span class="c1"># gas: change labels_clean contents to fluid_type_code = 3</span>
</span><span id="Closures.assign_fluid_types-1773"><a href="#-1773"><span class="linenos">1773</span></a>                    <span class="n">_gas_closures</span><span class="p">[</span><span class="n">labels_clean</span> <span class="o">==</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="Closures.assign_fluid_types-1774"><a href="#-1774"><span class="linenos">1774</span></a>        <span class="k">return</span> <span class="n">_oil_closures</span><span class="p">,</span> <span class="n">_gas_closures</span><span class="p">,</span> <span class="n">_brine_closures</span>
</span></pre></div>


            <div class="docstring"><p>randomly assign oil or gas to closure</p>
</div>


                            </div>
                            <div id="Closures.remove_small_objects" class="classattr">
                                        <input id="Closures.remove_small_objects-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">remove_small_objects</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">labels</span>, </span><span class="param"><span class="n">min_filter</span><span class="o">=</span><span class="kc">True</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Closures.remove_small_objects-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Closures.remove_small_objects"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Closures.remove_small_objects-1776"><a href="#-1776"><span class="linenos">1776</span></a>    <span class="k">def</span> <span class="nf">remove_small_objects</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">min_filter</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="Closures.remove_small_objects-1777"><a href="#-1777"><span class="linenos">1777</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="Closures.remove_small_objects-1778"><a href="#-1778"><span class="linenos">1778</span></a>            <span class="c1"># Use the global minimum voxel size initially, before closure types are identified</span>
</span><span id="Closures.remove_small_objects-1779"><a href="#-1779"><span class="linenos">1779</span></a>            <span class="n">labels_clean</span> <span class="o">=</span> <span class="n">morphology</span><span class="o">.</span><span class="n">remove_small_objects</span><span class="p">(</span>
</span><span id="Closures.remove_small_objects-1780"><a href="#-1780"><span class="linenos">1780</span></a>                <span class="n">labels</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">closure_min_voxels</span>
</span><span id="Closures.remove_small_objects-1781"><a href="#-1781"><span class="linenos">1781</span></a>            <span class="p">)</span>
</span><span id="Closures.remove_small_objects-1782"><a href="#-1782"><span class="linenos">1782</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Closures.remove_small_objects-1783"><a href="#-1783"><span class="linenos">1783</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;labels_clean succeeded.&quot;</span><span class="p">)</span>
</span><span id="Closures.remove_small_objects-1784"><a href="#-1784"><span class="linenos">1784</span></a>                <span class="nb">print</span><span class="p">(</span>
</span><span id="Closures.remove_small_objects-1785"><a href="#-1785"><span class="linenos">1785</span></a>                    <span class="s2">&quot; labels.min:</span><span class="si">{}</span><span class="s2">, labels.max: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">labels</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">labels</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
</span><span id="Closures.remove_small_objects-1786"><a href="#-1786"><span class="linenos">1786</span></a>                <span class="p">)</span>
</span><span id="Closures.remove_small_objects-1787"><a href="#-1787"><span class="linenos">1787</span></a>                <span class="nb">print</span><span class="p">(</span>
</span><span id="Closures.remove_small_objects-1788"><a href="#-1788"><span class="linenos">1788</span></a>                    <span class="s2">&quot; labels_clean min:</span><span class="si">{}</span><span class="s2">, labels_clean max: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="Closures.remove_small_objects-1789"><a href="#-1789"><span class="linenos">1789</span></a>                        <span class="n">labels_clean</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">labels_clean</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</span><span id="Closures.remove_small_objects-1790"><a href="#-1790"><span class="linenos">1790</span></a>                    <span class="p">)</span>
</span><span id="Closures.remove_small_objects-1791"><a href="#-1791"><span class="linenos">1791</span></a>                <span class="p">)</span>
</span><span id="Closures.remove_small_objects-1792"><a href="#-1792"><span class="linenos">1792</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="Closures.remove_small_objects-1793"><a href="#-1793"><span class="linenos">1793</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="Closures.remove_small_objects-1794"><a href="#-1794"><span class="linenos">1794</span></a>                <span class="sa">f</span><span class="s2">&quot;Closures/create_closures: labels_clean (remove_small_objects) did not succeed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Closures.remove_small_objects-1795"><a href="#-1795"><span class="linenos">1795</span></a>            <span class="p">)</span>
</span><span id="Closures.remove_small_objects-1796"><a href="#-1796"><span class="linenos">1796</span></a>            <span class="k">if</span> <span class="n">min_filter</span><span class="p">:</span>
</span><span id="Closures.remove_small_objects-1797"><a href="#-1797"><span class="linenos">1797</span></a>                <span class="n">labels_clean</span> <span class="o">=</span> <span class="n">minimum_filter</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
</span><span id="Closures.remove_small_objects-1798"><a href="#-1798"><span class="linenos">1798</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Closures.remove_small_objects-1799"><a href="#-1799"><span class="linenos">1799</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="Closures.remove_small_objects-1800"><a href="#-1800"><span class="linenos">1800</span></a>                        <span class="s2">&quot; labels.min:</span><span class="si">{}</span><span class="s2">, labels.max: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="Closures.remove_small_objects-1801"><a href="#-1801"><span class="linenos">1801</span></a>                            <span class="n">labels</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">labels</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</span><span id="Closures.remove_small_objects-1802"><a href="#-1802"><span class="linenos">1802</span></a>                        <span class="p">)</span>
</span><span id="Closures.remove_small_objects-1803"><a href="#-1803"><span class="linenos">1803</span></a>                    <span class="p">)</span>
</span><span id="Closures.remove_small_objects-1804"><a href="#-1804"><span class="linenos">1804</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="Closures.remove_small_objects-1805"><a href="#-1805"><span class="linenos">1805</span></a>                        <span class="s2">&quot; labels_clean min:</span><span class="si">{}</span><span class="s2">, labels_clean max: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="Closures.remove_small_objects-1806"><a href="#-1806"><span class="linenos">1806</span></a>                            <span class="n">labels_clean</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">labels_clean</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</span><span id="Closures.remove_small_objects-1807"><a href="#-1807"><span class="linenos">1807</span></a>                        <span class="p">)</span>
</span><span id="Closures.remove_small_objects-1808"><a href="#-1808"><span class="linenos">1808</span></a>                    <span class="p">)</span>
</span><span id="Closures.remove_small_objects-1809"><a href="#-1809"><span class="linenos">1809</span></a>        <span class="k">return</span> <span class="n">labels_clean</span>
</span></pre></div>


    

                            </div>
                            <div id="Closures.segment_closures" class="classattr">
                                        <input id="Closures.segment_closures-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">segment_closures</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">_closure_segments</span>, </span><span class="param"><span class="n">remove_shale</span><span class="o">=</span><span class="kc">True</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Closures.segment_closures-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Closures.segment_closures"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Closures.segment_closures-1811"><a href="#-1811"><span class="linenos">1811</span></a>    <span class="k">def</span> <span class="nf">segment_closures</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_closure_segments</span><span class="p">,</span> <span class="n">remove_shale</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="Closures.segment_closures-1812"><a href="#-1812"><span class="linenos">1812</span></a>        <span class="sd">&quot;&quot;&quot;Segment the closures so that they can be randomly filled with hydrocarbons&quot;&quot;&quot;</span>
</span><span id="Closures.segment_closures-1813"><a href="#-1813"><span class="linenos">1813</span></a>
</span><span id="Closures.segment_closures-1814"><a href="#-1814"><span class="linenos">1814</span></a>        <span class="n">_closure_segments</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">_closure_segments</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
</span><span id="Closures.segment_closures-1815"><a href="#-1815"><span class="linenos">1815</span></a>        <span class="c1"># remove tiny clusters</span>
</span><span id="Closures.segment_closures-1816"><a href="#-1816"><span class="linenos">1816</span></a>        <span class="n">_closure_segments</span> <span class="o">=</span> <span class="n">minimum_filter</span><span class="p">(</span>
</span><span id="Closures.segment_closures-1817"><a href="#-1817"><span class="linenos">1817</span></a>            <span class="n">_closure_segments</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;int16&quot;</span><span class="p">),</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="Closures.segment_closures-1818"><a href="#-1818"><span class="linenos">1818</span></a>        <span class="p">)</span>
</span><span id="Closures.segment_closures-1819"><a href="#-1819"><span class="linenos">1819</span></a>        <span class="n">_closure_segments</span> <span class="o">=</span> <span class="n">maximum_filter</span><span class="p">(</span><span class="n">_closure_segments</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</span><span id="Closures.segment_closures-1820"><a href="#-1820"><span class="linenos">1820</span></a>
</span><span id="Closures.segment_closures-1821"><a href="#-1821"><span class="linenos">1821</span></a>        <span class="k">if</span> <span class="n">remove_shale</span><span class="p">:</span>
</span><span id="Closures.segment_closures-1822"><a href="#-1822"><span class="linenos">1822</span></a>            <span class="c1"># restrict closures to sand (non-shale) voxels</span>
</span><span id="Closures.segment_closures-1823"><a href="#-1823"><span class="linenos">1823</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">faulted_lithology</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="n">_closure_segments</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
</span><span id="Closures.segment_closures-1824"><a href="#-1824"><span class="linenos">1824</span></a>                <span class="n">sand_shale</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">faulted_lithology</span><span class="p">[:]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Closures.segment_closures-1825"><a href="#-1825"><span class="linenos">1825</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Closures.segment_closures-1826"><a href="#-1826"><span class="linenos">1826</span></a>                <span class="n">sand_shale</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">faulted_lithology</span><span class="p">[</span>
</span><span id="Closures.segment_closures-1827"><a href="#-1827"><span class="linenos">1827</span></a>                    <span class="p">:,</span> <span class="p">:,</span> <span class="p">::</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">infill_factor</span>
</span><span id="Closures.segment_closures-1828"><a href="#-1828"><span class="linenos">1828</span></a>                <span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Closures.segment_closures-1829"><a href="#-1829"><span class="linenos">1829</span></a>            <span class="n">_closure_segments</span><span class="p">[</span><span class="n">sand_shale</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Closures.segment_closures-1830"><a href="#-1830"><span class="linenos">1830</span></a>            <span class="k">del</span> <span class="n">sand_shale</span>
</span><span id="Closures.segment_closures-1831"><a href="#-1831"><span class="linenos">1831</span></a>        <span class="n">labels</span> <span class="o">=</span> <span class="n">measure</span><span class="o">.</span><span class="n">label</span><span class="p">(</span><span class="n">_closure_segments</span><span class="p">,</span> <span class="n">connectivity</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">background</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="Closures.segment_closures-1832"><a href="#-1832"><span class="linenos">1832</span></a>
</span><span id="Closures.segment_closures-1833"><a href="#-1833"><span class="linenos">1833</span></a>        <span class="n">labels_clean</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">remove_small_objects</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>
</span><span id="Closures.segment_closures-1834"><a href="#-1834"><span class="linenos">1834</span></a>        <span class="k">return</span> <span class="n">labels_clean</span><span class="p">,</span> <span class="n">_closure_segments</span>
</span></pre></div>


            <div class="docstring"><p>Segment the closures so that they can be randomly filled with hydrocarbons</p>
</div>


                            </div>
                            <div id="Closures.write_closure_volumes_to_disk" class="classattr">
                                        <input id="Closures.write_closure_volumes_to_disk-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">write_closure_volumes_to_disk</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Closures.write_closure_volumes_to_disk-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Closures.write_closure_volumes_to_disk"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Closures.write_closure_volumes_to_disk-1836"><a href="#-1836"><span class="linenos">1836</span></a>    <span class="k">def</span> <span class="nf">write_closure_volumes_to_disk</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Closures.write_closure_volumes_to_disk-1837"><a href="#-1837"><span class="linenos">1837</span></a>        <span class="c1"># Create files for closure volumes</span>
</span><span id="Closures.write_closure_volumes_to_disk-1838"><a href="#-1838"><span class="linenos">1838</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">write_cube_to_disk</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">brine_closures</span><span class="p">[:],</span> <span class="s2">&quot;closure_segments_brine&quot;</span><span class="p">)</span>
</span><span id="Closures.write_closure_volumes_to_disk-1839"><a href="#-1839"><span class="linenos">1839</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">write_cube_to_disk</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">oil_closures</span><span class="p">[:],</span> <span class="s2">&quot;closure_segments_oil&quot;</span><span class="p">)</span>
</span><span id="Closures.write_closure_volumes_to_disk-1840"><a href="#-1840"><span class="linenos">1840</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">write_cube_to_disk</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gas_closures</span><span class="p">[:],</span> <span class="s2">&quot;closure_segments_gas&quot;</span><span class="p">)</span>
</span><span id="Closures.write_closure_volumes_to_disk-1841"><a href="#-1841"><span class="linenos">1841</span></a>        <span class="c1"># Create combined HC cube by adding oil and gas closures</span>
</span><span id="Closures.write_closure_volumes_to_disk-1842"><a href="#-1842"><span class="linenos">1842</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">hc_labels</span><span class="p">[:]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">oil_closures</span><span class="p">[:]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">gas_closures</span><span class="p">[:])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span>
</span><span id="Closures.write_closure_volumes_to_disk-1843"><a href="#-1843"><span class="linenos">1843</span></a>            <span class="s2">&quot;uint8&quot;</span>
</span><span id="Closures.write_closure_volumes_to_disk-1844"><a href="#-1844"><span class="linenos">1844</span></a>        <span class="p">)</span>
</span><span id="Closures.write_closure_volumes_to_disk-1845"><a href="#-1845"><span class="linenos">1845</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">write_cube_to_disk</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hc_labels</span><span class="p">[:],</span> <span class="s2">&quot;closure_segments_hc&quot;</span><span class="p">)</span>
</span><span id="Closures.write_closure_volumes_to_disk-1846"><a href="#-1846"><span class="linenos">1846</span></a>
</span><span id="Closures.write_closure_volumes_to_disk-1847"><a href="#-1847"><span class="linenos">1847</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">model_qc_volumes</span><span class="p">:</span>
</span><span id="Closures.write_closure_volumes_to_disk-1848"><a href="#-1848"><span class="linenos">1848</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">write_cube_to_disk</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">closure_segments</span><span class="p">,</span> <span class="s2">&quot;closure_segments_raw_all&quot;</span><span class="p">)</span>
</span><span id="Closures.write_closure_volumes_to_disk-1849"><a href="#-1849"><span class="linenos">1849</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">write_cube_to_disk</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">simple_closures</span><span class="p">,</span> <span class="s2">&quot;closure_segments_simple&quot;</span><span class="p">)</span>
</span><span id="Closures.write_closure_volumes_to_disk-1850"><a href="#-1850"><span class="linenos">1850</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">write_cube_to_disk</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">strat_closures</span><span class="p">,</span> <span class="s2">&quot;closure_segments_strat&quot;</span><span class="p">)</span>
</span><span id="Closures.write_closure_volumes_to_disk-1851"><a href="#-1851"><span class="linenos">1851</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">write_cube_to_disk</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fault_closures</span><span class="p">,</span> <span class="s2">&quot;closure_segments_fault&quot;</span><span class="p">)</span>
</span><span id="Closures.write_closure_volumes_to_disk-1852"><a href="#-1852"><span class="linenos">1852</span></a>
</span><span id="Closures.write_closure_volumes_to_disk-1853"><a href="#-1853"><span class="linenos">1853</span></a>        <span class="c1"># Triple check that no small closures exist in the final closure files</span>
</span><span id="Closures.write_closure_volumes_to_disk-1854"><a href="#-1854"><span class="linenos">1854</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span>
</span><span id="Closures.write_closure_volumes_to_disk-1855"><a href="#-1855"><span class="linenos">1855</span></a>            <span class="p">[</span>
</span><span id="Closures.write_closure_volumes_to_disk-1856"><a href="#-1856"><span class="linenos">1856</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">oil_closures</span><span class="p">,</span>
</span><span id="Closures.write_closure_volumes_to_disk-1857"><a href="#-1857"><span class="linenos">1857</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">gas_closures</span><span class="p">,</span>
</span><span id="Closures.write_closure_volumes_to_disk-1858"><a href="#-1858"><span class="linenos">1858</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">simple_closures</span><span class="p">,</span>
</span><span id="Closures.write_closure_volumes_to_disk-1859"><a href="#-1859"><span class="linenos">1859</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">strat_closures</span><span class="p">,</span>
</span><span id="Closures.write_closure_volumes_to_disk-1860"><a href="#-1860"><span class="linenos">1860</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">fault_closures</span><span class="p">,</span>
</span><span id="Closures.write_closure_volumes_to_disk-1861"><a href="#-1861"><span class="linenos">1861</span></a>            <span class="p">]</span>
</span><span id="Closures.write_closure_volumes_to_disk-1862"><a href="#-1862"><span class="linenos">1862</span></a>        <span class="p">):</span>
</span><span id="Closures.write_closure_volumes_to_disk-1863"><a href="#-1863"><span class="linenos">1863</span></a>            <span class="n">_t</span> <span class="o">=</span> <span class="n">measure</span><span class="o">.</span><span class="n">label</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">connectivity</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">background</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="Closures.write_closure_volumes_to_disk-1864"><a href="#-1864"><span class="linenos">1864</span></a>            <span class="n">counts</span> <span class="o">=</span> <span class="p">[</span><span class="n">_t</span><span class="p">[</span><span class="n">_t</span> <span class="o">==</span> <span class="n">x</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">_t</span><span class="p">))]</span>
</span><span id="Closures.write_closure_volumes_to_disk-1865"><a href="#-1865"><span class="linenos">1865</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Final closure volume voxels sizes: </span><span class="si">{</span><span class="n">counts</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Closures.write_closure_volumes_to_disk-1866"><a href="#-1866"><span class="linenos">1866</span></a>            <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">counts</span><span class="p">):</span>
</span><span id="Closures.write_closure_volumes_to_disk-1867"><a href="#-1867"><span class="linenos">1867</span></a>                <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">closure_min_voxels</span><span class="p">:</span>
</span><span id="Closures.write_closure_volumes_to_disk-1868"><a href="#-1868"><span class="linenos">1868</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Voxel count: </span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="se">\t</span><span class="s2"> Count:</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">, index: </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Closures.write_closure_volumes_to_disk-1869"><a href="#-1869"><span class="linenos">1869</span></a>
</span><span id="Closures.write_closure_volumes_to_disk-1870"><a href="#-1870"><span class="linenos">1870</span></a>        <span class="c1"># Return the hydrocarbon closure labels so that augmentation can be applied to the data &amp; labels</span>
</span><span id="Closures.write_closure_volumes_to_disk-1871"><a href="#-1871"><span class="linenos">1871</span></a>        <span class="c1"># return self.oil_closures + self.gas_closures</span>
</span></pre></div>


    

                            </div>
                            <div id="Closures.calculate_closure_statistics" class="classattr">
                                        <input id="Closures.calculate_closure_statistics-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">calculate_closure_statistics</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">in_array</span>, </span><span class="param"><span class="n">closure_type</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Closures.calculate_closure_statistics-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Closures.calculate_closure_statistics"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Closures.calculate_closure_statistics-1873"><a href="#-1873"><span class="linenos">1873</span></a>    <span class="k">def</span> <span class="nf">calculate_closure_statistics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">in_array</span><span class="p">,</span> <span class="n">closure_type</span><span class="p">):</span>
</span><span id="Closures.calculate_closure_statistics-1874"><a href="#-1874"><span class="linenos">1874</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="Closures.calculate_closure_statistics-1875"><a href="#-1875"><span class="linenos">1875</span></a><span class="sd">        Calculate the size and location of isolated features in an array</span>
</span><span id="Closures.calculate_closure_statistics-1876"><a href="#-1876"><span class="linenos">1876</span></a>
</span><span id="Closures.calculate_closure_statistics-1877"><a href="#-1877"><span class="linenos">1877</span></a><span class="sd">        :param in_array: ndarray. Input array to be labelled, where non-zero values are counted as features</span>
</span><span id="Closures.calculate_closure_statistics-1878"><a href="#-1878"><span class="linenos">1878</span></a><span class="sd">        :param closure_type: string. Closure type label</span>
</span><span id="Closures.calculate_closure_statistics-1879"><a href="#-1879"><span class="linenos">1879</span></a><span class="sd">        :param digi: int or float. To convert depth values from samples to units</span>
</span><span id="Closures.calculate_closure_statistics-1880"><a href="#-1880"><span class="linenos">1880</span></a><span class="sd">        :return: string. Concatenated string of closure statistics to be written to log</span>
</span><span id="Closures.calculate_closure_statistics-1881"><a href="#-1881"><span class="linenos">1881</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Closures.calculate_closure_statistics-1882"><a href="#-1882"><span class="linenos">1882</span></a>        <span class="n">labelled_array</span><span class="p">,</span> <span class="n">max_labels</span> <span class="o">=</span> <span class="n">measure</span><span class="o">.</span><span class="n">label</span><span class="p">(</span>
</span><span id="Closures.calculate_closure_statistics-1883"><a href="#-1883"><span class="linenos">1883</span></a>            <span class="n">in_array</span><span class="p">,</span> <span class="n">connectivity</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">return_num</span><span class="o">=</span><span class="kc">True</span>
</span><span id="Closures.calculate_closure_statistics-1884"><a href="#-1884"><span class="linenos">1884</span></a>        <span class="p">)</span>
</span><span id="Closures.calculate_closure_statistics-1885"><a href="#-1885"><span class="linenos">1885</span></a>        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="Closures.calculate_closure_statistics-1886"><a href="#-1886"><span class="linenos">1886</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_labels</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>  <span class="c1"># start at 1 to avoid counting 0&#39;s</span>
</span><span id="Closures.calculate_closure_statistics-1887"><a href="#-1887"><span class="linenos">1887</span></a>            <span class="n">trap</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">labelled_array</span> <span class="o">==</span> <span class="n">i</span><span class="p">)</span>
</span><span id="Closures.calculate_closure_statistics-1888"><a href="#-1888"><span class="linenos">1888</span></a>            <span class="n">ranges</span> <span class="o">=</span> <span class="p">[([</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">trap</span><span class="p">[</span><span class="n">x</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">trap</span><span class="p">[</span><span class="n">x</span><span class="p">])])</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">trap</span><span class="p">)]</span>
</span><span id="Closures.calculate_closure_statistics-1889"><a href="#-1889"><span class="linenos">1889</span></a>            <span class="n">sizes</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">ranges</span><span class="p">]</span>
</span><span id="Closures.calculate_closure_statistics-1890"><a href="#-1890"><span class="linenos">1890</span></a>            <span class="n">n_voxels</span> <span class="o">=</span> <span class="n">labelled_array</span><span class="p">[</span><span class="n">labelled_array</span> <span class="o">==</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="Closures.calculate_closure_statistics-1891"><a href="#-1891"><span class="linenos">1891</span></a>            <span class="k">if</span> <span class="nb">sum</span><span class="p">(</span><span class="n">sizes</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Closures.calculate_closure_statistics-1892"><a href="#-1892"><span class="linenos">1892</span></a>                <span class="n">msg</span> <span class="o">+=</span> <span class="p">(</span>
</span><span id="Closures.calculate_closure_statistics-1893"><a href="#-1893"><span class="linenos">1893</span></a>                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">closure_type</span><span class="si">}</span><span class="se">\t</span><span class="s2">&quot;</span>
</span><span id="Closures.calculate_closure_statistics-1894"><a href="#-1894"><span class="linenos">1894</span></a>                    <span class="sa">f</span><span class="s2">&quot;Num X,Y,Z Samples: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">sizes</span><span class="p">)</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span><span class="si">}</span><span class="se">\t</span><span class="s2">&quot;</span>
</span><span id="Closures.calculate_closure_statistics-1895"><a href="#-1895"><span class="linenos">1895</span></a>                    <span class="sa">f</span><span class="s2">&quot;Num Voxels: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">n_voxels</span><span class="p">)</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="si">}</span><span class="se">\t</span><span class="s2">&quot;</span>
</span><span id="Closures.calculate_closure_statistics-1896"><a href="#-1896"><span class="linenos">1896</span></a>                    <span class="sa">f</span><span class="s2">&quot;Track: </span><span class="si">{</span><span class="mi">2000</span> <span class="o">+</span> <span class="n">ranges</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="mi">2000</span> <span class="o">+</span> <span class="n">ranges</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="se">\t</span><span class="s2">&quot;</span>
</span><span id="Closures.calculate_closure_statistics-1897"><a href="#-1897"><span class="linenos">1897</span></a>                    <span class="sa">f</span><span class="s2">&quot;Bin: </span><span class="si">{</span><span class="mi">1000</span> <span class="o">+</span> <span class="n">ranges</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="mi">1000</span> <span class="o">+</span> <span class="n">ranges</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="se">\t</span><span class="s2">&quot;</span>
</span><span id="Closures.calculate_closure_statistics-1898"><a href="#-1898"><span class="linenos">1898</span></a>                    <span class="sa">f</span><span class="s2">&quot;Depth: </span><span class="si">{</span><span class="n">ranges</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">digi</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">ranges</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">digi</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">digi</span> <span class="o">/</span> <span class="mi">2</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="Closures.calculate_closure_statistics-1899"><a href="#-1899"><span class="linenos">1899</span></a>                <span class="p">)</span>
</span><span id="Closures.calculate_closure_statistics-1900"><a href="#-1900"><span class="linenos">1900</span></a>        <span class="k">return</span> <span class="n">msg</span>
</span></pre></div>


            <div class="docstring"><p>Calculate the size and location of isolated features in an array</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>in_array</strong>:  ndarray. Input array to be labelled, where non-zero values are counted as features</li>
<li><strong>closure_type</strong>:  string. Closure type label</li>
<li><strong>digi</strong>:  int or float. To convert depth values from samples to units</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>string. Concatenated string of closure statistics to be written to log</p>
</blockquote>
</div>


                            </div>
                            <div id="Closures.find_faulted_closures" class="classattr">
                                        <input id="Closures.find_faulted_closures-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">find_faulted_closures</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">closure_segment_list</span>, </span><span class="param"><span class="n">closure_segments</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Closures.find_faulted_closures-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Closures.find_faulted_closures"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Closures.find_faulted_closures-1902"><a href="#-1902"><span class="linenos">1902</span></a>    <span class="k">def</span> <span class="nf">find_faulted_closures</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">closure_segment_list</span><span class="p">,</span> <span class="n">closure_segments</span><span class="p">):</span>
</span><span id="Closures.find_faulted_closures-1903"><a href="#-1903"><span class="linenos">1903</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dilate_faults</span><span class="p">()</span>
</span><span id="Closures.find_faulted_closures-1904"><a href="#-1904"><span class="linenos">1904</span></a>        <span class="k">for</span> <span class="n">iclosure</span> <span class="ow">in</span> <span class="n">closure_segment_list</span><span class="p">:</span>
</span><span id="Closures.find_faulted_closures-1905"><a href="#-1905"><span class="linenos">1905</span></a>            <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">closure_segments</span> <span class="o">==</span> <span class="n">iclosure</span><span class="p">)</span>
</span><span id="Closures.find_faulted_closures-1906"><a href="#-1906"><span class="linenos">1906</span></a>            <span class="n">faults_within_closure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wide_faults</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span>
</span><span id="Closures.find_faulted_closures-1907"><a href="#-1907"><span class="linenos">1907</span></a>            <span class="k">if</span> <span class="n">faults_within_closure</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Closures.find_faulted_closures-1908"><a href="#-1908"><span class="linenos">1908</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">oil_closures</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Closures.find_faulted_closures-1909"><a href="#-1909"><span class="linenos">1909</span></a>                    <span class="c1"># Faulted oil closure</span>
</span><span id="Closures.find_faulted_closures-1910"><a href="#-1910"><span class="linenos">1910</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">faulted_closures_oil</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="Closures.find_faulted_closures-1911"><a href="#-1911"><span class="linenos">1911</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">n_fault_closures_oil</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="Closures.find_faulted_closures-1912"><a href="#-1912"><span class="linenos">1912</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">fault_closures_oil_segment_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">iclosure</span><span class="p">)</span>
</span><span id="Closures.find_faulted_closures-1913"><a href="#-1913"><span class="linenos">1913</span></a>                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">gas_closures</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Closures.find_faulted_closures-1914"><a href="#-1914"><span class="linenos">1914</span></a>                    <span class="c1"># Faulted gas closure</span>
</span><span id="Closures.find_faulted_closures-1915"><a href="#-1915"><span class="linenos">1915</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">faulted_closures_gas</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="Closures.find_faulted_closures-1916"><a href="#-1916"><span class="linenos">1916</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">n_fault_closures_gas</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="Closures.find_faulted_closures-1917"><a href="#-1917"><span class="linenos">1917</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">fault_closures_gas_segment_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">iclosure</span><span class="p">)</span>
</span><span id="Closures.find_faulted_closures-1918"><a href="#-1918"><span class="linenos">1918</span></a>                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">brine_closures</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Closures.find_faulted_closures-1919"><a href="#-1919"><span class="linenos">1919</span></a>                    <span class="c1"># Faulted brine closure</span>
</span><span id="Closures.find_faulted_closures-1920"><a href="#-1920"><span class="linenos">1920</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">faulted_closures_brine</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="Closures.find_faulted_closures-1921"><a href="#-1921"><span class="linenos">1921</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">n_fault_closures_brine</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="Closures.find_faulted_closures-1922"><a href="#-1922"><span class="linenos">1922</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">fault_closures_brine_segment_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">iclosure</span><span class="p">)</span>
</span><span id="Closures.find_faulted_closures-1923"><a href="#-1923"><span class="linenos">1923</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Closures.find_faulted_closures-1924"><a href="#-1924"><span class="linenos">1924</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="Closures.find_faulted_closures-1925"><a href="#-1925"><span class="linenos">1925</span></a>                        <span class="s2">&quot;Closure is faulted but does not have oil, gas or brine assigned&quot;</span>
</span><span id="Closures.find_faulted_closures-1926"><a href="#-1926"><span class="linenos">1926</span></a>                    <span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="Closures.find_onlap_closures" class="classattr">
                                        <input id="Closures.find_onlap_closures-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">find_onlap_closures</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">closure_segment_list</span>, </span><span class="param"><span class="n">closure_segments</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Closures.find_onlap_closures-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Closures.find_onlap_closures"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Closures.find_onlap_closures-1928"><a href="#-1928"><span class="linenos">1928</span></a>    <span class="k">def</span> <span class="nf">find_onlap_closures</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">closure_segment_list</span><span class="p">,</span> <span class="n">closure_segments</span><span class="p">):</span>
</span><span id="Closures.find_onlap_closures-1929"><a href="#-1929"><span class="linenos">1929</span></a>        <span class="k">for</span> <span class="n">iclosure</span> <span class="ow">in</span> <span class="n">closure_segment_list</span><span class="p">:</span>
</span><span id="Closures.find_onlap_closures-1930"><a href="#-1930"><span class="linenos">1930</span></a>            <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">closure_segments</span> <span class="o">==</span> <span class="n">iclosure</span><span class="p">)</span>
</span><span id="Closures.find_onlap_closures-1931"><a href="#-1931"><span class="linenos">1931</span></a>            <span class="n">onlaps_within_closure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">onlaps_upward</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span>
</span><span id="Closures.find_onlap_closures-1932"><a href="#-1932"><span class="linenos">1932</span></a>            <span class="k">if</span> <span class="n">onlaps_within_closure</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Closures.find_onlap_closures-1933"><a href="#-1933"><span class="linenos">1933</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">oil_closures</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Closures.find_onlap_closures-1934"><a href="#-1934"><span class="linenos">1934</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">onlap_closures_oil</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="Closures.find_onlap_closures-1935"><a href="#-1935"><span class="linenos">1935</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">n_onlap_closures_oil</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="Closures.find_onlap_closures-1936"><a href="#-1936"><span class="linenos">1936</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">onlap_closures_oil_segment_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">iclosure</span><span class="p">)</span>
</span><span id="Closures.find_onlap_closures-1937"><a href="#-1937"><span class="linenos">1937</span></a>                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">gas_closures</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Closures.find_onlap_closures-1938"><a href="#-1938"><span class="linenos">1938</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">onlap_closures_gas</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="Closures.find_onlap_closures-1939"><a href="#-1939"><span class="linenos">1939</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">n_onlap_closures_gas</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="Closures.find_onlap_closures-1940"><a href="#-1940"><span class="linenos">1940</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">onlap_closures_gas_segment_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">iclosure</span><span class="p">)</span>
</span><span id="Closures.find_onlap_closures-1941"><a href="#-1941"><span class="linenos">1941</span></a>                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">brine_closures</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Closures.find_onlap_closures-1942"><a href="#-1942"><span class="linenos">1942</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">onlap_closures_brine</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="Closures.find_onlap_closures-1943"><a href="#-1943"><span class="linenos">1943</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">n_onlap_closures_brine</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="Closures.find_onlap_closures-1944"><a href="#-1944"><span class="linenos">1944</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">onlap_closures_brine_segment_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">iclosure</span><span class="p">)</span>
</span><span id="Closures.find_onlap_closures-1945"><a href="#-1945"><span class="linenos">1945</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Closures.find_onlap_closures-1946"><a href="#-1946"><span class="linenos">1946</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="Closures.find_onlap_closures-1947"><a href="#-1947"><span class="linenos">1947</span></a>                        <span class="s2">&quot;Closure is onlap but does not have oil, gas or brine assigned&quot;</span>
</span><span id="Closures.find_onlap_closures-1948"><a href="#-1948"><span class="linenos">1948</span></a>                    <span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="Closures.find_simple_closures" class="classattr">
                                        <input id="Closures.find_simple_closures-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">find_simple_closures</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">closure_segment_list</span>, </span><span class="param"><span class="n">closure_segments</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Closures.find_simple_closures-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Closures.find_simple_closures"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Closures.find_simple_closures-1950"><a href="#-1950"><span class="linenos">1950</span></a>    <span class="k">def</span> <span class="nf">find_simple_closures</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">closure_segment_list</span><span class="p">,</span> <span class="n">closure_segments</span><span class="p">):</span>
</span><span id="Closures.find_simple_closures-1951"><a href="#-1951"><span class="linenos">1951</span></a>        <span class="k">for</span> <span class="n">iclosure</span> <span class="ow">in</span> <span class="n">closure_segment_list</span><span class="p">:</span>
</span><span id="Closures.find_simple_closures-1952"><a href="#-1952"><span class="linenos">1952</span></a>            <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">closure_segments</span> <span class="o">==</span> <span class="n">iclosure</span><span class="p">)</span>
</span><span id="Closures.find_simple_closures-1953"><a href="#-1953"><span class="linenos">1953</span></a>            <span class="n">faults_within_closure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wide_faults</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span>
</span><span id="Closures.find_simple_closures-1954"><a href="#-1954"><span class="linenos">1954</span></a>            <span class="n">onlaps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_threshold_volumes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">faulted_onlap_segments</span><span class="p">[:])</span>
</span><span id="Closures.find_simple_closures-1955"><a href="#-1955"><span class="linenos">1955</span></a>            <span class="n">onlaps_within_closure</span> <span class="o">=</span> <span class="n">onlaps</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span>
</span><span id="Closures.find_simple_closures-1956"><a href="#-1956"><span class="linenos">1956</span></a>            <span class="n">oil_within_closure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">oil_closures</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span>
</span><span id="Closures.find_simple_closures-1957"><a href="#-1957"><span class="linenos">1957</span></a>            <span class="n">gas_within_closure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gas_closures</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span>
</span><span id="Closures.find_simple_closures-1958"><a href="#-1958"><span class="linenos">1958</span></a>            <span class="n">brine_within_closure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">brine_closures</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span>
</span><span id="Closures.find_simple_closures-1959"><a href="#-1959"><span class="linenos">1959</span></a>            <span class="k">if</span> <span class="n">faults_within_closure</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">onlaps_within_closure</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Closures.find_simple_closures-1960"><a href="#-1960"><span class="linenos">1960</span></a>                <span class="k">if</span> <span class="n">oil_within_closure</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Closures.find_simple_closures-1961"><a href="#-1961"><span class="linenos">1961</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">simple_closures_oil</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="Closures.find_simple_closures-1962"><a href="#-1962"><span class="linenos">1962</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">n_4way_closures_oil</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="Closures.find_simple_closures-1963"><a href="#-1963"><span class="linenos">1963</span></a>                <span class="k">elif</span> <span class="n">gas_within_closure</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Closures.find_simple_closures-1964"><a href="#-1964"><span class="linenos">1964</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">simple_closures_gas</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="Closures.find_simple_closures-1965"><a href="#-1965"><span class="linenos">1965</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">n_4way_closures_gas</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="Closures.find_simple_closures-1966"><a href="#-1966"><span class="linenos">1966</span></a>                <span class="k">elif</span> <span class="n">brine_within_closure</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Closures.find_simple_closures-1967"><a href="#-1967"><span class="linenos">1967</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">simple_closures_brine</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="Closures.find_simple_closures-1968"><a href="#-1968"><span class="linenos">1968</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">n_4way_closures_brine</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="Closures.find_simple_closures-1969"><a href="#-1969"><span class="linenos">1969</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Closures.find_simple_closures-1970"><a href="#-1970"><span class="linenos">1970</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="Closures.find_simple_closures-1971"><a href="#-1971"><span class="linenos">1971</span></a>                        <span class="s2">&quot;Closure is not faulted or onlap but does not have oil, gas or brine assigned&quot;</span>
</span><span id="Closures.find_simple_closures-1972"><a href="#-1972"><span class="linenos">1972</span></a>                    <span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="Closures.find_false_closures" class="classattr">
                                        <input id="Closures.find_false_closures-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">find_false_closures</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">closure_segment_list</span>, </span><span class="param"><span class="n">closure_segments</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Closures.find_false_closures-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Closures.find_false_closures"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Closures.find_false_closures-1974"><a href="#-1974"><span class="linenos">1974</span></a>    <span class="k">def</span> <span class="nf">find_false_closures</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">closure_segment_list</span><span class="p">,</span> <span class="n">closure_segments</span><span class="p">):</span>
</span><span id="Closures.find_false_closures-1975"><a href="#-1975"><span class="linenos">1975</span></a>        <span class="k">for</span> <span class="n">iclosure</span> <span class="ow">in</span> <span class="n">closure_segment_list</span><span class="p">:</span>
</span><span id="Closures.find_false_closures-1976"><a href="#-1976"><span class="linenos">1976</span></a>            <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">closure_segments</span> <span class="o">==</span> <span class="n">iclosure</span><span class="p">)</span>
</span><span id="Closures.find_false_closures-1977"><a href="#-1977"><span class="linenos">1977</span></a>            <span class="n">faults_within_closure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fat_faults</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span>
</span><span id="Closures.find_false_closures-1978"><a href="#-1978"><span class="linenos">1978</span></a>            <span class="n">onlaps_within_closure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">onlaps_downward</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span>
</span><span id="Closures.find_false_closures-1979"><a href="#-1979"><span class="linenos">1979</span></a>            <span class="k">for</span> <span class="n">fluid</span><span class="p">,</span> <span class="n">false</span><span class="p">,</span> <span class="n">num</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
</span><span id="Closures.find_false_closures-1980"><a href="#-1980"><span class="linenos">1980</span></a>                <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">oil_closures</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gas_closures</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">brine_closures</span><span class="p">],</span>
</span><span id="Closures.find_false_closures-1981"><a href="#-1981"><span class="linenos">1981</span></a>                <span class="p">[</span>
</span><span id="Closures.find_false_closures-1982"><a href="#-1982"><span class="linenos">1982</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">false_closures_oil</span><span class="p">,</span>
</span><span id="Closures.find_false_closures-1983"><a href="#-1983"><span class="linenos">1983</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">false_closures_gas</span><span class="p">,</span>
</span><span id="Closures.find_false_closures-1984"><a href="#-1984"><span class="linenos">1984</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">false_closures_brine</span><span class="p">,</span>
</span><span id="Closures.find_false_closures-1985"><a href="#-1985"><span class="linenos">1985</span></a>                <span class="p">],</span>
</span><span id="Closures.find_false_closures-1986"><a href="#-1986"><span class="linenos">1986</span></a>                <span class="p">[</span>
</span><span id="Closures.find_false_closures-1987"><a href="#-1987"><span class="linenos">1987</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">n_false_closures_oil</span><span class="p">,</span>
</span><span id="Closures.find_false_closures-1988"><a href="#-1988"><span class="linenos">1988</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">n_false_closures_gas</span><span class="p">,</span>
</span><span id="Closures.find_false_closures-1989"><a href="#-1989"><span class="linenos">1989</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">n_false_closures_brine</span><span class="p">,</span>
</span><span id="Closures.find_false_closures-1990"><a href="#-1990"><span class="linenos">1990</span></a>                <span class="p">],</span>
</span><span id="Closures.find_false_closures-1991"><a href="#-1991"><span class="linenos">1991</span></a>            <span class="p">):</span>
</span><span id="Closures.find_false_closures-1992"><a href="#-1992"><span class="linenos">1992</span></a>                <span class="n">fluid_within_closure</span> <span class="o">=</span> <span class="n">fluid</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span>
</span><span id="Closures.find_false_closures-1993"><a href="#-1993"><span class="linenos">1993</span></a>                <span class="k">if</span> <span class="n">fluid_within_closure</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Closures.find_false_closures-1994"><a href="#-1994"><span class="linenos">1994</span></a>                    <span class="k">if</span> <span class="n">onlaps_within_closure</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Closures.find_false_closures-1995"><a href="#-1995"><span class="linenos">1995</span></a>                        <span class="n">_faulted_closure_threshold</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span>
</span><span id="Closures.find_false_closures-1996"><a href="#-1996"><span class="linenos">1996</span></a>                            <span class="n">faults_within_closure</span><span class="p">[</span><span class="n">faults_within_closure</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="Closures.find_false_closures-1997"><a href="#-1997"><span class="linenos">1997</span></a>                            <span class="o">/</span> <span class="n">fluid_within_closure</span><span class="p">[</span><span class="n">fluid_within_closure</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="Closures.find_false_closures-1998"><a href="#-1998"><span class="linenos">1998</span></a>                        <span class="p">)</span>
</span><span id="Closures.find_false_closures-1999"><a href="#-1999"><span class="linenos">1999</span></a>                        <span class="n">_onlap_closure_threshold</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span>
</span><span id="Closures.find_false_closures-2000"><a href="#-2000"><span class="linenos">2000</span></a>                            <span class="n">onlaps_within_closure</span><span class="p">[</span><span class="n">onlaps_within_closure</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="Closures.find_false_closures-2001"><a href="#-2001"><span class="linenos">2001</span></a>                            <span class="o">/</span> <span class="n">fluid_within_closure</span><span class="p">[</span><span class="n">fluid_within_closure</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="Closures.find_false_closures-2002"><a href="#-2002"><span class="linenos">2002</span></a>                        <span class="p">)</span>
</span><span id="Closures.find_false_closures-2003"><a href="#-2003"><span class="linenos">2003</span></a>                        <span class="k">if</span> <span class="p">(</span>
</span><span id="Closures.find_false_closures-2004"><a href="#-2004"><span class="linenos">2004</span></a>                            <span class="n">_faulted_closure_threshold</span> <span class="o">&gt;</span> <span class="mf">0.65</span>
</span><span id="Closures.find_false_closures-2005"><a href="#-2005"><span class="linenos">2005</span></a>                            <span class="ow">and</span> <span class="n">_onlap_closure_threshold</span> <span class="o">&gt;</span> <span class="mf">0.65</span>
</span><span id="Closures.find_false_closures-2006"><a href="#-2006"><span class="linenos">2006</span></a>                        <span class="p">):</span>
</span><span id="Closures.find_false_closures-2007"><a href="#-2007"><span class="linenos">2007</span></a>                            <span class="n">false</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="Closures.find_false_closures-2008"><a href="#-2008"><span class="linenos">2008</span></a>                            <span class="n">num</span> <span class="o">+=</span> <span class="mi">1</span>
</span></pre></div>


    

                            </div>
                            <div id="Closures.find_salt_bounded_closures" class="classattr">
                                        <input id="Closures.find_salt_bounded_closures-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">find_salt_bounded_closures</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">closure_segment_list</span>, </span><span class="param"><span class="n">closure_segments</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Closures.find_salt_bounded_closures-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Closures.find_salt_bounded_closures"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Closures.find_salt_bounded_closures-2010"><a href="#-2010"><span class="linenos">2010</span></a>    <span class="k">def</span> <span class="nf">find_salt_bounded_closures</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">closure_segment_list</span><span class="p">,</span> <span class="n">closure_segments</span><span class="p">):</span>
</span><span id="Closures.find_salt_bounded_closures-2011"><a href="#-2011"><span class="linenos">2011</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dilate_salt</span><span class="p">()</span>
</span><span id="Closures.find_salt_bounded_closures-2012"><a href="#-2012"><span class="linenos">2012</span></a>        <span class="k">for</span> <span class="n">iclosure</span> <span class="ow">in</span> <span class="n">closure_segment_list</span><span class="p">:</span>
</span><span id="Closures.find_salt_bounded_closures-2013"><a href="#-2013"><span class="linenos">2013</span></a>            <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">closure_segments</span> <span class="o">==</span> <span class="n">iclosure</span><span class="p">)</span>
</span><span id="Closures.find_salt_bounded_closures-2014"><a href="#-2014"><span class="linenos">2014</span></a>            <span class="n">salt_within_closure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wide_salt</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span>
</span><span id="Closures.find_salt_bounded_closures-2015"><a href="#-2015"><span class="linenos">2015</span></a>            <span class="k">if</span> <span class="n">salt_within_closure</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Closures.find_salt_bounded_closures-2016"><a href="#-2016"><span class="linenos">2016</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">oil_closures</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Closures.find_salt_bounded_closures-2017"><a href="#-2017"><span class="linenos">2017</span></a>                    <span class="c1"># salt bounded oil closure</span>
</span><span id="Closures.find_salt_bounded_closures-2018"><a href="#-2018"><span class="linenos">2018</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">salt_closures_oil</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="Closures.find_salt_bounded_closures-2019"><a href="#-2019"><span class="linenos">2019</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">n_salt_closures_oil</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="Closures.find_salt_bounded_closures-2020"><a href="#-2020"><span class="linenos">2020</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">salt_closures_oil_segment_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">iclosure</span><span class="p">)</span>
</span><span id="Closures.find_salt_bounded_closures-2021"><a href="#-2021"><span class="linenos">2021</span></a>                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">gas_closures</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Closures.find_salt_bounded_closures-2022"><a href="#-2022"><span class="linenos">2022</span></a>                    <span class="c1"># salt bounded gas closure</span>
</span><span id="Closures.find_salt_bounded_closures-2023"><a href="#-2023"><span class="linenos">2023</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">salt_closures_gas</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="Closures.find_salt_bounded_closures-2024"><a href="#-2024"><span class="linenos">2024</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">n_salt_closures_gas</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="Closures.find_salt_bounded_closures-2025"><a href="#-2025"><span class="linenos">2025</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">salt_closures_gas_segment_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">iclosure</span><span class="p">)</span>
</span><span id="Closures.find_salt_bounded_closures-2026"><a href="#-2026"><span class="linenos">2026</span></a>                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">brine_closures</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Closures.find_salt_bounded_closures-2027"><a href="#-2027"><span class="linenos">2027</span></a>                    <span class="c1"># salt bounded brine closure</span>
</span><span id="Closures.find_salt_bounded_closures-2028"><a href="#-2028"><span class="linenos">2028</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">salt_closures_brine</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="Closures.find_salt_bounded_closures-2029"><a href="#-2029"><span class="linenos">2029</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">n_salt_closures_brine</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="Closures.find_salt_bounded_closures-2030"><a href="#-2030"><span class="linenos">2030</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">salt_closures_brine_segment_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">iclosure</span><span class="p">)</span>
</span><span id="Closures.find_salt_bounded_closures-2031"><a href="#-2031"><span class="linenos">2031</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Closures.find_salt_bounded_closures-2032"><a href="#-2032"><span class="linenos">2032</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="Closures.find_salt_bounded_closures-2033"><a href="#-2033"><span class="linenos">2033</span></a>                        <span class="s2">&quot;Closure is salt bounded but does not have oil, gas or brine assigned&quot;</span>
</span><span id="Closures.find_salt_bounded_closures-2034"><a href="#-2034"><span class="linenos">2034</span></a>                    <span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="Closures.find_faulted_all_closures" class="classattr">
                                        <input id="Closures.find_faulted_all_closures-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">find_faulted_all_closures</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">closure_segment_list</span>, </span><span class="param"><span class="n">closure_segments</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Closures.find_faulted_all_closures-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Closures.find_faulted_all_closures"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Closures.find_faulted_all_closures-2036"><a href="#-2036"><span class="linenos">2036</span></a>    <span class="k">def</span> <span class="nf">find_faulted_all_closures</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">closure_segment_list</span><span class="p">,</span> <span class="n">closure_segments</span><span class="p">):</span>
</span><span id="Closures.find_faulted_all_closures-2037"><a href="#-2037"><span class="linenos">2037</span></a>        <span class="k">for</span> <span class="n">iclosure</span> <span class="ow">in</span> <span class="n">closure_segment_list</span><span class="p">:</span>
</span><span id="Closures.find_faulted_all_closures-2038"><a href="#-2038"><span class="linenos">2038</span></a>            <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">closure_segments</span> <span class="o">==</span> <span class="n">iclosure</span><span class="p">)</span>
</span><span id="Closures.find_faulted_all_closures-2039"><a href="#-2039"><span class="linenos">2039</span></a>            <span class="n">faults_within_closure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wide_faults</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span>
</span><span id="Closures.find_faulted_all_closures-2040"><a href="#-2040"><span class="linenos">2040</span></a>            <span class="k">if</span> <span class="n">faults_within_closure</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Closures.find_faulted_all_closures-2041"><a href="#-2041"><span class="linenos">2041</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">faulted_all_closures</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="Closures.find_faulted_all_closures-2042"><a href="#-2042"><span class="linenos">2042</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">n_fault_all_closures</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="Closures.find_faulted_all_closures-2043"><a href="#-2043"><span class="linenos">2043</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">fault_all_closures_segment_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">iclosure</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="Closures.find_onlap_all_closures" class="classattr">
                                        <input id="Closures.find_onlap_all_closures-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">find_onlap_all_closures</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">closure_segment_list</span>, </span><span class="param"><span class="n">closure_segments</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Closures.find_onlap_all_closures-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Closures.find_onlap_all_closures"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Closures.find_onlap_all_closures-2045"><a href="#-2045"><span class="linenos">2045</span></a>    <span class="k">def</span> <span class="nf">find_onlap_all_closures</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">closure_segment_list</span><span class="p">,</span> <span class="n">closure_segments</span><span class="p">):</span>
</span><span id="Closures.find_onlap_all_closures-2046"><a href="#-2046"><span class="linenos">2046</span></a>        <span class="k">for</span> <span class="n">iclosure</span> <span class="ow">in</span> <span class="n">closure_segment_list</span><span class="p">:</span>
</span><span id="Closures.find_onlap_all_closures-2047"><a href="#-2047"><span class="linenos">2047</span></a>            <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">closure_segments</span> <span class="o">==</span> <span class="n">iclosure</span><span class="p">)</span>
</span><span id="Closures.find_onlap_all_closures-2048"><a href="#-2048"><span class="linenos">2048</span></a>            <span class="n">onlaps_within_closure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">onlaps_upward</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span>
</span><span id="Closures.find_onlap_all_closures-2049"><a href="#-2049"><span class="linenos">2049</span></a>            <span class="k">if</span> <span class="n">onlaps_within_closure</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Closures.find_onlap_all_closures-2050"><a href="#-2050"><span class="linenos">2050</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">onlap_all_closures</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="Closures.find_onlap_all_closures-2051"><a href="#-2051"><span class="linenos">2051</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">n_onlap_all_closures</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="Closures.find_onlap_all_closures-2052"><a href="#-2052"><span class="linenos">2052</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">onlap_all_closures_segment_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">iclosure</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="Closures.find_simple_all_closures" class="classattr">
                                        <input id="Closures.find_simple_all_closures-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">find_simple_all_closures</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">closure_segment_list</span>, </span><span class="param"><span class="n">closure_segments</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Closures.find_simple_all_closures-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Closures.find_simple_all_closures"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Closures.find_simple_all_closures-2054"><a href="#-2054"><span class="linenos">2054</span></a>    <span class="k">def</span> <span class="nf">find_simple_all_closures</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">closure_segment_list</span><span class="p">,</span> <span class="n">closure_segments</span><span class="p">):</span>
</span><span id="Closures.find_simple_all_closures-2055"><a href="#-2055"><span class="linenos">2055</span></a>        <span class="k">for</span> <span class="n">iclosure</span> <span class="ow">in</span> <span class="n">closure_segment_list</span><span class="p">:</span>
</span><span id="Closures.find_simple_all_closures-2056"><a href="#-2056"><span class="linenos">2056</span></a>            <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">closure_segments</span> <span class="o">==</span> <span class="n">iclosure</span><span class="p">)</span>
</span><span id="Closures.find_simple_all_closures-2057"><a href="#-2057"><span class="linenos">2057</span></a>            <span class="n">faults_within_closure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wide_faults</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span>
</span><span id="Closures.find_simple_all_closures-2058"><a href="#-2058"><span class="linenos">2058</span></a>            <span class="n">onlaps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_threshold_volumes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">faulted_onlap_segments</span><span class="p">[:])</span>
</span><span id="Closures.find_simple_all_closures-2059"><a href="#-2059"><span class="linenos">2059</span></a>            <span class="n">onlaps_within_closure</span> <span class="o">=</span> <span class="n">onlaps</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span>
</span><span id="Closures.find_simple_all_closures-2060"><a href="#-2060"><span class="linenos">2060</span></a>            <span class="k">if</span> <span class="n">faults_within_closure</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">onlaps_within_closure</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Closures.find_simple_all_closures-2061"><a href="#-2061"><span class="linenos">2061</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">simple_all_closures</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="Closures.find_simple_all_closures-2062"><a href="#-2062"><span class="linenos">2062</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">n_4way_all_closures</span> <span class="o">+=</span> <span class="mi">1</span>
</span></pre></div>


    

                            </div>
                            <div id="Closures.find_false_all_closures" class="classattr">
                                        <input id="Closures.find_false_all_closures-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">find_false_all_closures</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">closure_segment_list</span>, </span><span class="param"><span class="n">closure_segments</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Closures.find_false_all_closures-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Closures.find_false_all_closures"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Closures.find_false_all_closures-2064"><a href="#-2064"><span class="linenos">2064</span></a>    <span class="k">def</span> <span class="nf">find_false_all_closures</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">closure_segment_list</span><span class="p">,</span> <span class="n">closure_segments</span><span class="p">):</span>
</span><span id="Closures.find_false_all_closures-2065"><a href="#-2065"><span class="linenos">2065</span></a>        <span class="k">for</span> <span class="n">iclosure</span> <span class="ow">in</span> <span class="n">closure_segment_list</span><span class="p">:</span>
</span><span id="Closures.find_false_all_closures-2066"><a href="#-2066"><span class="linenos">2066</span></a>            <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">closure_segments</span> <span class="o">==</span> <span class="n">iclosure</span><span class="p">)</span>
</span><span id="Closures.find_false_all_closures-2067"><a href="#-2067"><span class="linenos">2067</span></a>            <span class="n">faults_within_closure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fat_faults</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span>
</span><span id="Closures.find_false_all_closures-2068"><a href="#-2068"><span class="linenos">2068</span></a>            <span class="n">onlaps_within_closure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">onlaps_downward</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span>
</span><span id="Closures.find_false_all_closures-2069"><a href="#-2069"><span class="linenos">2069</span></a>            <span class="k">if</span> <span class="n">onlaps_within_closure</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Closures.find_false_all_closures-2070"><a href="#-2070"><span class="linenos">2070</span></a>                <span class="n">_faulted_closure_threshold</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span>
</span><span id="Closures.find_false_all_closures-2071"><a href="#-2071"><span class="linenos">2071</span></a>                    <span class="n">faults_within_closure</span><span class="p">[</span><span class="n">faults_within_closure</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="o">/</span> <span class="n">i</span><span class="o">.</span><span class="n">size</span>
</span><span id="Closures.find_false_all_closures-2072"><a href="#-2072"><span class="linenos">2072</span></a>                <span class="p">)</span>
</span><span id="Closures.find_false_all_closures-2073"><a href="#-2073"><span class="linenos">2073</span></a>                <span class="n">_onlap_closure_threshold</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span>
</span><span id="Closures.find_false_all_closures-2074"><a href="#-2074"><span class="linenos">2074</span></a>                    <span class="n">onlaps_within_closure</span><span class="p">[</span><span class="n">onlaps_within_closure</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="o">/</span> <span class="n">i</span><span class="o">.</span><span class="n">size</span>
</span><span id="Closures.find_false_all_closures-2075"><a href="#-2075"><span class="linenos">2075</span></a>                <span class="p">)</span>
</span><span id="Closures.find_false_all_closures-2076"><a href="#-2076"><span class="linenos">2076</span></a>                <span class="k">if</span> <span class="p">(</span>
</span><span id="Closures.find_false_all_closures-2077"><a href="#-2077"><span class="linenos">2077</span></a>                    <span class="n">_faulted_closure_threshold</span> <span class="o">&gt;</span> <span class="mf">0.65</span>
</span><span id="Closures.find_false_all_closures-2078"><a href="#-2078"><span class="linenos">2078</span></a>                    <span class="ow">and</span> <span class="n">_onlap_closure_threshold</span> <span class="o">&gt;</span> <span class="mf">0.65</span>
</span><span id="Closures.find_false_all_closures-2079"><a href="#-2079"><span class="linenos">2079</span></a>                <span class="p">):</span>
</span><span id="Closures.find_false_all_closures-2080"><a href="#-2080"><span class="linenos">2080</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">false_all_closures</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="Closures.find_false_all_closures-2081"><a href="#-2081"><span class="linenos">2081</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">n_false_all_closures</span> <span class="o">+=</span> <span class="mi">1</span>
</span></pre></div>


    

                            </div>
                            <div id="Closures.find_salt_bounded_all_closures" class="classattr">
                                        <input id="Closures.find_salt_bounded_all_closures-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">find_salt_bounded_all_closures</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">closure_segment_list</span>, </span><span class="param"><span class="n">closure_segments</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Closures.find_salt_bounded_all_closures-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Closures.find_salt_bounded_all_closures"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Closures.find_salt_bounded_all_closures-2083"><a href="#-2083"><span class="linenos">2083</span></a>    <span class="k">def</span> <span class="nf">find_salt_bounded_all_closures</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">closure_segment_list</span><span class="p">,</span> <span class="n">closure_segments</span><span class="p">):</span>
</span><span id="Closures.find_salt_bounded_all_closures-2084"><a href="#-2084"><span class="linenos">2084</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dilate_salt</span><span class="p">()</span>
</span><span id="Closures.find_salt_bounded_all_closures-2085"><a href="#-2085"><span class="linenos">2085</span></a>        <span class="k">for</span> <span class="n">iclosure</span> <span class="ow">in</span> <span class="n">closure_segment_list</span><span class="p">:</span>
</span><span id="Closures.find_salt_bounded_all_closures-2086"><a href="#-2086"><span class="linenos">2086</span></a>            <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">closure_segments</span> <span class="o">==</span> <span class="n">iclosure</span><span class="p">)</span>
</span><span id="Closures.find_salt_bounded_all_closures-2087"><a href="#-2087"><span class="linenos">2087</span></a>            <span class="n">salt_within_closure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wide_salt</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span>
</span><span id="Closures.find_salt_bounded_all_closures-2088"><a href="#-2088"><span class="linenos">2088</span></a>            <span class="k">if</span> <span class="n">salt_within_closure</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Closures.find_salt_bounded_all_closures-2089"><a href="#-2089"><span class="linenos">2089</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">salt_all_closures</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="Closures.find_salt_bounded_all_closures-2090"><a href="#-2090"><span class="linenos">2090</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">n_salt_all_closures</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="Closures.find_salt_bounded_all_closures-2091"><a href="#-2091"><span class="linenos">2091</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">salt_all_closures_segment_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">iclosure</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="Closures.grow_to_fault2" class="classattr">
                                        <input id="Closures.grow_to_fault2-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">grow_to_fault2</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">closures</span>,</span><span class="param">	<span class="n">grow_only_sand_closures</span><span class="o">=</span><span class="kc">True</span>,</span><span class="param">	<span class="n">remove_small_closures</span><span class="o">=</span><span class="kc">True</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Closures.grow_to_fault2-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Closures.grow_to_fault2"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Closures.grow_to_fault2-2134"><a href="#-2134"><span class="linenos">2134</span></a>    <span class="k">def</span> <span class="nf">grow_to_fault2</span><span class="p">(</span>
</span><span id="Closures.grow_to_fault2-2135"><a href="#-2135"><span class="linenos">2135</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">closures</span><span class="p">,</span> <span class="n">grow_only_sand_closures</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">remove_small_closures</span><span class="o">=</span><span class="kc">True</span>
</span><span id="Closures.grow_to_fault2-2136"><a href="#-2136"><span class="linenos">2136</span></a>    <span class="p">):</span>
</span><span id="Closures.grow_to_fault2-2137"><a href="#-2137"><span class="linenos">2137</span></a>        <span class="c1"># - grow closures laterally and up within layer and within fault block</span>
</span><span id="Closures.grow_to_fault2-2138"><a href="#-2138"><span class="linenos">2138</span></a>        <span class="nb">print</span><span class="p">(</span>
</span><span id="Closures.grow_to_fault2-2139"><a href="#-2139"><span class="linenos">2139</span></a>            <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2"> ... grow_to_fault2: grow closures laterally and up within layer and within fault block ...&quot;</span>
</span><span id="Closures.grow_to_fault2-2140"><a href="#-2140"><span class="linenos">2140</span></a>        <span class="p">)</span>
</span><span id="Closures.grow_to_fault2-2141"><a href="#-2141"><span class="linenos">2141</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span><span class="s2">&quot;growing closures to fault plane: grow_to_fault2&quot;</span><span class="p">)</span>
</span><span id="Closures.grow_to_fault2-2142"><a href="#-2142"><span class="linenos">2142</span></a>
</span><span id="Closures.grow_to_fault2-2143"><a href="#-2143"><span class="linenos">2143</span></a>        <span class="c1"># dilated_fault_closures = closures.copy()</span>
</span><span id="Closures.grow_to_fault2-2144"><a href="#-2144"><span class="linenos">2144</span></a>        <span class="c1"># n_faulted_closures = dilated_fault_closures.max()</span>
</span><span id="Closures.grow_to_fault2-2145"><a href="#-2145"><span class="linenos">2145</span></a>        <span class="n">labels_clean</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">closure_segments</span><span class="p">[:]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Closures.grow_to_fault2-2146"><a href="#-2146"><span class="linenos">2146</span></a>        <span class="n">labels_clean</span><span class="p">[</span><span class="n">closures</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Closures.grow_to_fault2-2147"><a href="#-2147"><span class="linenos">2147</span></a>        <span class="n">labels_clean_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">labels_clean</span><span class="o">.</span><span class="n">flatten</span><span class="p">()))</span>
</span><span id="Closures.grow_to_fault2-2148"><a href="#-2148"><span class="linenos">2148</span></a>        <span class="n">labels_clean_list</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="Closures.grow_to_fault2-2149"><a href="#-2149"><span class="linenos">2149</span></a>        <span class="n">initial_closures</span> <span class="o">=</span> <span class="n">labels_clean</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Closures.grow_to_fault2-2150"><a href="#-2150"><span class="linenos">2150</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">    ... grow_to_fault2: n_faulted_closures = &quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">labels_clean_list</span><span class="p">))</span>
</span><span id="Closures.grow_to_fault2-2151"><a href="#-2151"><span class="linenos">2151</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    ... grow_to_fault2: faulted_closures = &quot;</span><span class="p">,</span> <span class="n">labels_clean_list</span><span class="p">)</span>
</span><span id="Closures.grow_to_fault2-2152"><a href="#-2152"><span class="linenos">2152</span></a>
</span><span id="Closures.grow_to_fault2-2153"><a href="#-2153"><span class="linenos">2153</span></a>        <span class="c1"># TODO remove this once small closures are found and fixed</span>
</span><span id="Closures.grow_to_fault2-2154"><a href="#-2154"><span class="linenos">2154</span></a>        <span class="n">voxel_sizes</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="Closures.grow_to_fault2-2155"><a href="#-2155"><span class="linenos">2155</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">closure_segments</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">closure_segments</span><span class="p">[:]</span> <span class="o">==</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="Closures.grow_to_fault2-2156"><a href="#-2156"><span class="linenos">2156</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">labels_clean_list</span>
</span><span id="Closures.grow_to_fault2-2157"><a href="#-2157"><span class="linenos">2157</span></a>        <span class="p">]</span>
</span><span id="Closures.grow_to_fault2-2158"><a href="#-2158"><span class="linenos">2158</span></a>        <span class="k">for</span> <span class="n">_v</span> <span class="ow">in</span> <span class="n">voxel_sizes</span><span class="p">:</span>
</span><span id="Closures.grow_to_fault2-2159"><a href="#-2159"><span class="linenos">2159</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Voxel_Sizes: </span><span class="si">{</span><span class="n">_v</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Closures.grow_to_fault2-2160"><a href="#-2160"><span class="linenos">2160</span></a>            <span class="k">if</span> <span class="n">_v</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">closure_min_voxels</span><span class="p">:</span>
</span><span id="Closures.grow_to_fault2-2161"><a href="#-2161"><span class="linenos">2161</span></a>                <span class="nb">print</span><span class="p">(</span><span class="n">_v</span><span class="p">)</span>
</span><span id="Closures.grow_to_fault2-2162"><a href="#-2162"><span class="linenos">2162</span></a>
</span><span id="Closures.grow_to_fault2-2163"><a href="#-2163"><span class="linenos">2163</span></a>        <span class="n">depth_cube</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">faulted_age_volume</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span>
</span><span id="Closures.grow_to_fault2-2164"><a href="#-2164"><span class="linenos">2164</span></a>        <span class="n">_depths</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">faulted_age_volume</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</span><span id="Closures.grow_to_fault2-2165"><a href="#-2165"><span class="linenos">2165</span></a>        <span class="n">depth_cube</span> <span class="o">+=</span> <span class="n">_depths</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">faulted_age_volume</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</span><span id="Closures.grow_to_fault2-2166"><a href="#-2166"><span class="linenos">2166</span></a>        <span class="n">_ng</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">faulted_net_to_gross</span><span class="p">[:]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Closures.grow_to_fault2-2167"><a href="#-2167"><span class="linenos">2167</span></a>        <span class="c1"># Cannot solely use NG anymore since shales may have variable net to gross</span>
</span><span id="Closures.grow_to_fault2-2168"><a href="#-2168"><span class="linenos">2168</span></a>        <span class="n">_lith</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">faulted_lithology</span><span class="p">[:]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Closures.grow_to_fault2-2169"><a href="#-2169"><span class="linenos">2169</span></a>        <span class="n">_age</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">faulted_age_volume</span><span class="p">[:]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Closures.grow_to_fault2-2170"><a href="#-2170"><span class="linenos">2170</span></a>        <span class="n">fault_throw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">max_fault_throw</span><span class="p">[:]</span>
</span><span id="Closures.grow_to_fault2-2171"><a href="#-2171"><span class="linenos">2171</span></a>
</span><span id="Closures.grow_to_fault2-2172"><a href="#-2172"><span class="linenos">2172</span></a>        <span class="k">for</span> <span class="n">il</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">labels_clean_list</span><span class="p">):</span>
</span><span id="Closures.grow_to_fault2-2173"><a href="#-2173"><span class="linenos">2173</span></a>            <span class="n">fault_blocks_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">fault_throw</span><span class="p">[</span><span class="n">labels_clean</span> <span class="o">==</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()))</span>
</span><span id="Closures.grow_to_fault2-2174"><a href="#-2174"><span class="linenos">2174</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    ... grow_to_fault2: fault_blocks_list = &quot;</span><span class="p">,</span> <span class="n">fault_blocks_list</span><span class="p">)</span>
</span><span id="Closures.grow_to_fault2-2175"><a href="#-2175"><span class="linenos">2175</span></a>            <span class="k">for</span> <span class="n">jl</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">fault_blocks_list</span><span class="p">):</span>
</span><span id="Closures.grow_to_fault2-2176"><a href="#-2176"><span class="linenos">2176</span></a>                <span class="nb">print</span><span class="p">(</span>
</span><span id="Closures.grow_to_fault2-2177"><a href="#-2177"><span class="linenos">2177</span></a>                    <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">    ... label, throw = &quot;</span><span class="p">,</span>
</span><span id="Closures.grow_to_fault2-2178"><a href="#-2178"><span class="linenos">2178</span></a>                    <span class="n">i</span><span class="p">,</span>
</span><span id="Closures.grow_to_fault2-2179"><a href="#-2179"><span class="linenos">2179</span></a>                    <span class="n">j</span><span class="p">,</span>
</span><span id="Closures.grow_to_fault2-2180"><a href="#-2180"><span class="linenos">2180</span></a>                    <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">fault_throw</span><span class="p">[</span><span class="n">labels_clean</span> <span class="o">==</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">())),</span>
</span><span id="Closures.grow_to_fault2-2181"><a href="#-2181"><span class="linenos">2181</span></a>                    <span class="n">labels_clean</span><span class="p">[</span><span class="n">labels_clean</span> <span class="o">==</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">,</span>
</span><span id="Closures.grow_to_fault2-2182"><a href="#-2182"><span class="linenos">2182</span></a>                    <span class="n">fault_throw</span><span class="p">[</span><span class="n">fault_throw</span> <span class="o">==</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">,</span>
</span><span id="Closures.grow_to_fault2-2183"><a href="#-2183"><span class="linenos">2183</span></a>                    <span class="n">fault_throw</span><span class="p">[</span>
</span><span id="Closures.grow_to_fault2-2184"><a href="#-2184"><span class="linenos">2184</span></a>                        <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">labels_clean</span> <span class="o">==</span> <span class="n">i</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">fault_throw</span><span class="p">[:]</span> <span class="o">==</span> <span class="n">j</span><span class="p">))</span>
</span><span id="Closures.grow_to_fault2-2185"><a href="#-2185"><span class="linenos">2185</span></a>                    <span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">,</span>
</span><span id="Closures.grow_to_fault2-2186"><a href="#-2186"><span class="linenos">2186</span></a>                <span class="p">)</span>
</span><span id="Closures.grow_to_fault2-2187"><a href="#-2187"><span class="linenos">2187</span></a>                <span class="n">single_closure</span> <span class="o">=</span> <span class="n">labels_clean</span> <span class="o">*</span> <span class="mf">0.0</span>
</span><span id="Closures.grow_to_fault2-2188"><a href="#-2188"><span class="linenos">2188</span></a>                <span class="n">size</span> <span class="o">=</span> <span class="n">single_closure</span><span class="p">[</span>
</span><span id="Closures.grow_to_fault2-2189"><a href="#-2189"><span class="linenos">2189</span></a>                    <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">labels_clean</span> <span class="o">==</span> <span class="n">i</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">fault_throw</span> <span class="o">-</span> <span class="n">j</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.25</span><span class="p">))</span>
</span><span id="Closures.grow_to_fault2-2190"><a href="#-2190"><span class="linenos">2190</span></a>                <span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="Closures.grow_to_fault2-2191"><a href="#-2191"><span class="linenos">2191</span></a>                <span class="k">if</span> <span class="n">size</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">closure_min_voxels</span><span class="p">:</span>
</span><span id="Closures.grow_to_fault2-2192"><a href="#-2192"><span class="linenos">2192</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Label: </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">, fault_block: </span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s2">, Voxel_Count: </span><span class="si">{</span><span class="n">size</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Closures.grow_to_fault2-2193"><a href="#-2193"><span class="linenos">2193</span></a>                    <span class="n">single_closure</span><span class="p">[</span>
</span><span id="Closures.grow_to_fault2-2194"><a href="#-2194"><span class="linenos">2194</span></a>                        <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">labels_clean</span> <span class="o">==</span> <span class="n">i</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">fault_throw</span> <span class="o">-</span> <span class="n">j</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.25</span><span class="p">))</span>
</span><span id="Closures.grow_to_fault2-2195"><a href="#-2195"><span class="linenos">2195</span></a>                    <span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="Closures.grow_to_fault2-2196"><a href="#-2196"><span class="linenos">2196</span></a>                <span class="k">if</span> <span class="n">single_closure</span><span class="p">[</span><span class="n">single_closure</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Closures.grow_to_fault2-2197"><a href="#-2197"><span class="linenos">2197</span></a>                    <span class="c1"># labels_clean[np.where((labels_clean == i) &amp; (np.abs(self.fault_throw - j) &lt; .25))] = 0</span>
</span><span id="Closures.grow_to_fault2-2198"><a href="#-2198"><span class="linenos">2198</span></a>                    <span class="n">labels_clean</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">labels_clean</span> <span class="o">==</span> <span class="n">i</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Closures.grow_to_fault2-2199"><a href="#-2199"><span class="linenos">2199</span></a>                    <span class="k">continue</span>
</span><span id="Closures.grow_to_fault2-2200"><a href="#-2200"><span class="linenos">2200</span></a>                <span class="n">avg_ng</span> <span class="o">=</span> <span class="n">_ng</span><span class="p">[</span><span class="n">single_closure</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</span><span id="Closures.grow_to_fault2-2201"><a href="#-2201"><span class="linenos">2201</span></a>                <span class="n">_geo_age_voxels</span> <span class="o">=</span> <span class="p">(</span><span class="n">_age</span><span class="p">[</span><span class="n">single_closure</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;int&quot;</span><span class="p">)</span>
</span><span id="Closures.grow_to_fault2-2202"><a href="#-2202"><span class="linenos">2202</span></a>                <span class="n">_ng_voxels</span> <span class="o">=</span> <span class="n">_ng</span><span class="p">[</span><span class="n">single_closure</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="Closures.grow_to_fault2-2203"><a href="#-2203"><span class="linenos">2203</span></a>                <span class="n">_geo_age_voxels</span> <span class="o">=</span> <span class="n">_geo_age_voxels</span><span class="p">[</span><span class="n">_ng_voxels</span> <span class="o">&gt;=</span> <span class="n">avg_ng</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">]</span>
</span><span id="Closures.grow_to_fault2-2204"><a href="#-2204"><span class="linenos">2204</span></a>                <span class="n">min_geo_age</span> <span class="o">=</span> <span class="n">_geo_age_voxels</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">-</span> <span class="mf">0.5</span>
</span><span id="Closures.grow_to_fault2-2205"><a href="#-2205"><span class="linenos">2205</span></a>                <span class="n">avg_geo_age</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">_geo_age_voxels</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
</span><span id="Closures.grow_to_fault2-2206"><a href="#-2206"><span class="linenos">2206</span></a>                <span class="n">max_geo_age</span> <span class="o">=</span> <span class="n">_geo_age_voxels</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="mf">0.5</span>
</span><span id="Closures.grow_to_fault2-2207"><a href="#-2207"><span class="linenos">2207</span></a>                <span class="n">_depth_geobody_voxels</span> <span class="o">=</span> <span class="n">depth_cube</span><span class="p">[</span><span class="n">single_closure</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="Closures.grow_to_fault2-2208"><a href="#-2208"><span class="linenos">2208</span></a>                <span class="n">min_depth</span> <span class="o">=</span> <span class="n">_depth_geobody_voxels</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
</span><span id="Closures.grow_to_fault2-2209"><a href="#-2209"><span class="linenos">2209</span></a>                <span class="n">max_depth</span> <span class="o">=</span> <span class="n">_depth_geobody_voxels</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</span><span id="Closures.grow_to_fault2-2210"><a href="#-2210"><span class="linenos">2210</span></a>                <span class="n">avg_throw</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">fault_throw</span><span class="p">[</span><span class="n">single_closure</span> <span class="o">==</span> <span class="mi">1</span><span class="p">])</span>
</span><span id="Closures.grow_to_fault2-2211"><a href="#-2211"><span class="linenos">2211</span></a>
</span><span id="Closures.grow_to_fault2-2212"><a href="#-2212"><span class="linenos">2212</span></a>                <span class="n">closure_boundary_cube</span> <span class="o">=</span> <span class="n">closures</span> <span class="o">*</span> <span class="mf">0.0</span>
</span><span id="Closures.grow_to_fault2-2213"><a href="#-2213"><span class="linenos">2213</span></a>                <span class="k">if</span> <span class="n">grow_only_sand_closures</span><span class="p">:</span>
</span><span id="Closures.grow_to_fault2-2214"><a href="#-2214"><span class="linenos">2214</span></a>                    <span class="n">lith_flag</span> <span class="o">=</span> <span class="n">_lith</span> <span class="o">&gt;</span> <span class="mf">0.0</span>
</span><span id="Closures.grow_to_fault2-2215"><a href="#-2215"><span class="linenos">2215</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Closures.grow_to_fault2-2216"><a href="#-2216"><span class="linenos">2216</span></a>                    <span class="n">lith_flag</span> <span class="o">=</span> <span class="n">_lith</span> <span class="o">&gt;=</span> <span class="mf">0.0</span>
</span><span id="Closures.grow_to_fault2-2217"><a href="#-2217"><span class="linenos">2217</span></a>                <span class="n">closure_boundary_cube</span><span class="p">[</span>
</span><span id="Closures.grow_to_fault2-2218"><a href="#-2218"><span class="linenos">2218</span></a>                    <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
</span><span id="Closures.grow_to_fault2-2219"><a href="#-2219"><span class="linenos">2219</span></a>                        <span class="n">lith_flag</span>
</span><span id="Closures.grow_to_fault2-2220"><a href="#-2220"><span class="linenos">2220</span></a>                        <span class="o">&amp;</span> <span class="p">(</span><span class="n">_age</span> <span class="o">&gt;</span> <span class="n">min_geo_age</span><span class="p">)</span>
</span><span id="Closures.grow_to_fault2-2221"><a href="#-2221"><span class="linenos">2221</span></a>                        <span class="o">&amp;</span> <span class="p">(</span><span class="n">_age</span> <span class="o">&lt;</span> <span class="n">max_geo_age</span><span class="p">)</span>
</span><span id="Closures.grow_to_fault2-2222"><a href="#-2222"><span class="linenos">2222</span></a>                        <span class="o">&amp;</span> <span class="p">(</span><span class="n">fault_throw</span> <span class="o">==</span> <span class="n">avg_throw</span><span class="p">)</span>
</span><span id="Closures.grow_to_fault2-2223"><a href="#-2223"><span class="linenos">2223</span></a>                        <span class="o">&amp;</span> <span class="p">(</span><span class="n">depth_cube</span> <span class="o">&lt;=</span> <span class="n">max_depth</span><span class="p">)</span>
</span><span id="Closures.grow_to_fault2-2224"><a href="#-2224"><span class="linenos">2224</span></a>                    <span class="p">)</span>
</span><span id="Closures.grow_to_fault2-2225"><a href="#-2225"><span class="linenos">2225</span></a>                <span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="Closures.grow_to_fault2-2226"><a href="#-2226"><span class="linenos">2226</span></a>                <span class="nb">print</span><span class="p">(</span>
</span><span id="Closures.grow_to_fault2-2227"><a href="#-2227"><span class="linenos">2227</span></a>                    <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">    ... grow_to_fault2: closure_boundary_cube voxels = &quot;</span><span class="p">,</span>
</span><span id="Closures.grow_to_fault2-2228"><a href="#-2228"><span class="linenos">2228</span></a>                    <span class="n">closure_boundary_cube</span><span class="p">[</span><span class="n">closure_boundary_cube</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">,</span>
</span><span id="Closures.grow_to_fault2-2229"><a href="#-2229"><span class="linenos">2229</span></a>                <span class="p">)</span>
</span><span id="Closures.grow_to_fault2-2230"><a href="#-2230"><span class="linenos">2230</span></a>
</span><span id="Closures.grow_to_fault2-2231"><a href="#-2231"><span class="linenos">2231</span></a>                <span class="n">n_voxel</span> <span class="o">=</span> <span class="n">single_closure</span><span class="p">[</span><span class="n">single_closure</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="Closures.grow_to_fault2-2232"><a href="#-2232"><span class="linenos">2232</span></a>
</span><span id="Closures.grow_to_fault2-2233"><a href="#-2233"><span class="linenos">2233</span></a>                <span class="n">original_voxels</span> <span class="o">=</span> <span class="n">n_voxel</span> <span class="o">+</span> <span class="mi">0</span>
</span><span id="Closures.grow_to_fault2-2234"><a href="#-2234"><span class="linenos">2234</span></a>                <span class="nb">print</span><span class="p">(</span>
</span><span id="Closures.grow_to_fault2-2235"><a href="#-2235"><span class="linenos">2235</span></a>                    <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">    ... closure label number, avg_throw, geobody shape, geo_age min/mean/max, depth min/max, avg_ng = &quot;</span><span class="p">,</span>
</span><span id="Closures.grow_to_fault2-2236"><a href="#-2236"><span class="linenos">2236</span></a>                    <span class="n">i</span><span class="p">,</span>
</span><span id="Closures.grow_to_fault2-2237"><a href="#-2237"><span class="linenos">2237</span></a>                    <span class="n">j</span><span class="p">,</span>
</span><span id="Closures.grow_to_fault2-2238"><a href="#-2238"><span class="linenos">2238</span></a>                    <span class="n">n_voxel</span><span class="p">,</span>
</span><span id="Closures.grow_to_fault2-2239"><a href="#-2239"><span class="linenos">2239</span></a>                    <span class="p">(</span><span class="n">min_geo_age</span><span class="p">,</span> <span class="n">avg_geo_age</span><span class="p">,</span> <span class="n">max_geo_age</span><span class="p">),</span>
</span><span id="Closures.grow_to_fault2-2240"><a href="#-2240"><span class="linenos">2240</span></a>                    <span class="p">(</span><span class="n">min_depth</span><span class="p">,</span> <span class="n">max_depth</span><span class="p">),</span>
</span><span id="Closures.grow_to_fault2-2241"><a href="#-2241"><span class="linenos">2241</span></a>                    <span class="n">avg_ng</span><span class="p">,</span>
</span><span id="Closures.grow_to_fault2-2242"><a href="#-2242"><span class="linenos">2242</span></a>                    <span class="n">il</span><span class="p">,</span>
</span><span id="Closures.grow_to_fault2-2243"><a href="#-2243"><span class="linenos">2243</span></a>                    <span class="s2">&quot; / &quot;</span><span class="p">,</span>
</span><span id="Closures.grow_to_fault2-2244"><a href="#-2244"><span class="linenos">2244</span></a>                    <span class="nb">len</span><span class="p">(</span><span class="n">labels_clean_list</span><span class="p">),</span>
</span><span id="Closures.grow_to_fault2-2245"><a href="#-2245"><span class="linenos">2245</span></a>                <span class="p">)</span>
</span><span id="Closures.grow_to_fault2-2246"><a href="#-2246"><span class="linenos">2246</span></a>
</span><span id="Closures.grow_to_fault2-2247"><a href="#-2247"><span class="linenos">2247</span></a>                <span class="n">grown_closure</span> <span class="o">=</span> <span class="n">single_closure</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Closures.grow_to_fault2-2248"><a href="#-2248"><span class="linenos">2248</span></a>                <span class="n">grown_closure</span><span class="p">[</span><span class="n">depth_cube</span> <span class="o">&gt;=</span> <span class="n">max_depth</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Closures.grow_to_fault2-2249"><a href="#-2249"><span class="linenos">2249</span></a>                <span class="n">delta_voxel</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Closures.grow_to_fault2-2250"><a href="#-2250"><span class="linenos">2250</span></a>                <span class="n">previous_delta_voxel</span> <span class="o">=</span> <span class="mf">1e9</span>
</span><span id="Closures.grow_to_fault2-2251"><a href="#-2251"><span class="linenos">2251</span></a>                <span class="n">converged</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Closures.grow_to_fault2-2252"><a href="#-2252"><span class="linenos">2252</span></a>                <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">15</span><span class="p">):</span>
</span><span id="Closures.grow_to_fault2-2253"><a href="#-2253"><span class="linenos">2253</span></a>                    <span class="n">grown_closure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grow_lateral</span><span class="p">(</span><span class="n">grown_closure</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span><span id="Closures.grow_to_fault2-2254"><a href="#-2254"><span class="linenos">2254</span></a>                    <span class="n">grown_closure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grow_upward</span><span class="p">(</span><span class="n">grown_closure</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="Closures.grow_to_fault2-2255"><a href="#-2255"><span class="linenos">2255</span></a>                    <span class="c1"># stay within layer, within age, within fault block, above HCWC</span>
</span><span id="Closures.grow_to_fault2-2256"><a href="#-2256"><span class="linenos">2256</span></a>                    <span class="n">grown_closure</span><span class="p">[</span><span class="n">closure_boundary_cube</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="Closures.grow_to_fault2-2257"><a href="#-2257"><span class="linenos">2257</span></a>                    <span class="n">single_closure</span> <span class="o">=</span> <span class="n">single_closure</span> <span class="o">+</span> <span class="n">grown_closure</span>
</span><span id="Closures.grow_to_fault2-2258"><a href="#-2258"><span class="linenos">2258</span></a>                    <span class="n">single_closure</span><span class="p">[</span><span class="n">single_closure</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
</span><span id="Closures.grow_to_fault2-2259"><a href="#-2259"><span class="linenos">2259</span></a>                    <span class="n">new_n_voxel</span> <span class="o">=</span> <span class="n">single_closure</span><span class="p">[</span><span class="n">single_closure</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="Closures.grow_to_fault2-2260"><a href="#-2260"><span class="linenos">2260</span></a>                    <span class="n">previous_delta_voxel</span> <span class="o">=</span> <span class="n">delta_voxel</span> <span class="o">+</span> <span class="mi">0</span>
</span><span id="Closures.grow_to_fault2-2261"><a href="#-2261"><span class="linenos">2261</span></a>                    <span class="n">delta_voxel</span> <span class="o">=</span> <span class="n">new_n_voxel</span> <span class="o">-</span> <span class="n">n_voxel</span>
</span><span id="Closures.grow_to_fault2-2262"><a href="#-2262"><span class="linenos">2262</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="Closures.grow_to_fault2-2263"><a href="#-2263"><span class="linenos">2263</span></a>                        <span class="s2">&quot;    ... i, ii, closure label number, geobody shape, delta_voxel, previous_delta_voxel,&quot;</span>
</span><span id="Closures.grow_to_fault2-2264"><a href="#-2264"><span class="linenos">2264</span></a>                        <span class="s2">&quot; delta_voxel&gt;previous_delta_voxel = &quot;</span><span class="p">,</span>
</span><span id="Closures.grow_to_fault2-2265"><a href="#-2265"><span class="linenos">2265</span></a>                        <span class="n">i</span><span class="p">,</span>
</span><span id="Closures.grow_to_fault2-2266"><a href="#-2266"><span class="linenos">2266</span></a>                        <span class="n">ii</span><span class="p">,</span>
</span><span id="Closures.grow_to_fault2-2267"><a href="#-2267"><span class="linenos">2267</span></a>                        <span class="n">new_n_voxel</span><span class="p">,</span>
</span><span id="Closures.grow_to_fault2-2268"><a href="#-2268"><span class="linenos">2268</span></a>                        <span class="n">delta_voxel</span><span class="p">,</span>
</span><span id="Closures.grow_to_fault2-2269"><a href="#-2269"><span class="linenos">2269</span></a>                        <span class="n">previous_delta_voxel</span><span class="p">,</span>
</span><span id="Closures.grow_to_fault2-2270"><a href="#-2270"><span class="linenos">2270</span></a>                        <span class="n">delta_voxel</span> <span class="o">&gt;</span> <span class="n">previous_delta_voxel</span><span class="p">,</span>
</span><span id="Closures.grow_to_fault2-2271"><a href="#-2271"><span class="linenos">2271</span></a>                    <span class="p">)</span>
</span><span id="Closures.grow_to_fault2-2272"><a href="#-2272"><span class="linenos">2272</span></a>                    <span class="k">if</span> <span class="n">n_voxel</span> <span class="o">==</span> <span class="n">new_n_voxel</span><span class="p">:</span>
</span><span id="Closures.grow_to_fault2-2273"><a href="#-2273"><span class="linenos">2273</span></a>                        <span class="c1"># finish bottom voxel layer near &quot;HCWC&quot;</span>
</span><span id="Closures.grow_to_fault2-2274"><a href="#-2274"><span class="linenos">2274</span></a>                        <span class="n">grown_closure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grow_downward</span><span class="p">(</span>
</span><span id="Closures.grow_to_fault2-2275"><a href="#-2275"><span class="linenos">2275</span></a>                            <span class="n">grown_closure</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span>
</span><span id="Closures.grow_to_fault2-2276"><a href="#-2276"><span class="linenos">2276</span></a>                        <span class="p">)</span>
</span><span id="Closures.grow_to_fault2-2277"><a href="#-2277"><span class="linenos">2277</span></a>                        <span class="c1"># stay within layer, within age, within fault block, above HCWC</span>
</span><span id="Closures.grow_to_fault2-2278"><a href="#-2278"><span class="linenos">2278</span></a>                        <span class="n">grown_closure</span><span class="p">[</span><span class="n">closure_boundary_cube</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="Closures.grow_to_fault2-2279"><a href="#-2279"><span class="linenos">2279</span></a>                        <span class="n">single_closure</span> <span class="o">=</span> <span class="n">single_closure</span> <span class="o">+</span> <span class="n">grown_closure</span>
</span><span id="Closures.grow_to_fault2-2280"><a href="#-2280"><span class="linenos">2280</span></a>                        <span class="n">single_closure</span><span class="p">[</span><span class="n">single_closure</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
</span><span id="Closures.grow_to_fault2-2281"><a href="#-2281"><span class="linenos">2281</span></a>                        <span class="n">converged</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Closures.grow_to_fault2-2282"><a href="#-2282"><span class="linenos">2282</span></a>                        <span class="k">break</span>
</span><span id="Closures.grow_to_fault2-2283"><a href="#-2283"><span class="linenos">2283</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="Closures.grow_to_fault2-2284"><a href="#-2284"><span class="linenos">2284</span></a>                        <span class="n">n_voxel</span> <span class="o">=</span> <span class="n">new_n_voxel</span>
</span><span id="Closures.grow_to_fault2-2285"><a href="#-2285"><span class="linenos">2285</span></a>                    <span class="n">previous_delta_voxel</span> <span class="o">=</span> <span class="n">delta_voxel</span> <span class="o">+</span> <span class="mi">0</span>
</span><span id="Closures.grow_to_fault2-2286"><a href="#-2286"><span class="linenos">2286</span></a>                <span class="k">if</span> <span class="n">converged</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="Closures.grow_to_fault2-2287"><a href="#-2287"><span class="linenos">2287</span></a>                    <span class="n">labels_clean</span><span class="p">[</span><span class="n">single_closure</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
</span><span id="Closures.grow_to_fault2-2288"><a href="#-2288"><span class="linenos">2288</span></a>                    <span class="n">msg_postscript</span> <span class="o">=</span> <span class="s2">&quot; converged&quot;</span>
</span><span id="Closures.grow_to_fault2-2289"><a href="#-2289"><span class="linenos">2289</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Closures.grow_to_fault2-2290"><a href="#-2290"><span class="linenos">2290</span></a>                    <span class="n">labels_clean</span><span class="p">[</span><span class="n">labels_clean</span> <span class="o">==</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">i</span>
</span><span id="Closures.grow_to_fault2-2291"><a href="#-2291"><span class="linenos">2291</span></a>                    <span class="n">msg_postscript</span> <span class="o">=</span> <span class="s2">&quot; NOT converged&quot;</span>
</span><span id="Closures.grow_to_fault2-2292"><a href="#-2292"><span class="linenos">2292</span></a>                <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="Closures.grow_to_fault2-2293"><a href="#-2293"><span class="linenos">2293</span></a>                    <span class="sa">f</span><span class="s2">&quot;closure_id: </span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="si">:</span><span class="s2">04d</span><span class="si">}</span><span class="s2">, fault_id: </span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">j</span> <span class="o">+</span> <span class="mf">.5</span><span class="p">)</span><span class="si">:</span><span class="s2">04d</span><span class="si">}</span><span class="s2">, &quot;</span>
</span><span id="Closures.grow_to_fault2-2294"><a href="#-2294"><span class="linenos">2294</span></a>                    <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;original_voxels: </span><span class="si">{</span><span class="n">original_voxels</span><span class="si">:</span><span class="s2">11.0f</span><span class="si">}</span><span class="s2">, new_n_voxel: </span><span class="si">{</span><span class="n">new_n_voxel</span><span class="si">:</span><span class="s2">11.0f</span><span class="si">}</span><span class="s2">, &quot;</span>
</span><span id="Closures.grow_to_fault2-2295"><a href="#-2295"><span class="linenos">2295</span></a>                    <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;percent_growth: </span><span class="si">{</span><span class="nb">float</span><span class="p">(</span><span class="n">new_n_voxel</span> <span class="o">/</span> <span class="n">original_voxels</span><span class="p">)</span><span class="si">:</span><span class="s2">6.2f</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Closures.grow_to_fault2-2296"><a href="#-2296"><span class="linenos">2296</span></a>                <span class="p">)</span>
</span><span id="Closures.grow_to_fault2-2297"><a href="#-2297"><span class="linenos">2297</span></a>                <span class="nb">print</span><span class="p">(</span><span class="n">msg</span> <span class="o">+</span> <span class="n">msg_postscript</span><span class="p">)</span>
</span><span id="Closures.grow_to_fault2-2298"><a href="#-2298"><span class="linenos">2298</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span><span class="n">msg</span> <span class="o">+</span> <span class="n">msg_postscript</span><span class="p">)</span>
</span><span id="Closures.grow_to_fault2-2299"><a href="#-2299"><span class="linenos">2299</span></a>
</span><span id="Closures.grow_to_fault2-2300"><a href="#-2300"><span class="linenos">2300</span></a>        <span class="c1"># Set small closures to 0 after growth</span>
</span><span id="Closures.grow_to_fault2-2301"><a href="#-2301"><span class="linenos">2301</span></a>        <span class="c1"># _grown_labels = measure.label(labels_clean, connectivity=2, background=0)</span>
</span><span id="Closures.grow_to_fault2-2302"><a href="#-2302"><span class="linenos">2302</span></a>        <span class="c1"># for x in np.unique(_grown_labels):</span>
</span><span id="Closures.grow_to_fault2-2303"><a href="#-2303"><span class="linenos">2303</span></a>        <span class="c1">#     size = _grown_labels[_grown_labels == x].size</span>
</span><span id="Closures.grow_to_fault2-2304"><a href="#-2304"><span class="linenos">2304</span></a>        <span class="c1">#     print(f&#39;Size before editing: {size}&#39;)</span>
</span><span id="Closures.grow_to_fault2-2305"><a href="#-2305"><span class="linenos">2305</span></a>        <span class="c1">#     if size &lt; self.cfg.closure_min_voxels:</span>
</span><span id="Closures.grow_to_fault2-2306"><a href="#-2306"><span class="linenos">2306</span></a>        <span class="c1">#         labels_clean[_grown_labels == x] = 0.</span>
</span><span id="Closures.grow_to_fault2-2307"><a href="#-2307"><span class="linenos">2307</span></a>        <span class="c1"># for x in np.unique(labels_clean):</span>
</span><span id="Closures.grow_to_fault2-2308"><a href="#-2308"><span class="linenos">2308</span></a>        <span class="c1">#     size = labels_clean[labels_clean == x].size</span>
</span><span id="Closures.grow_to_fault2-2309"><a href="#-2309"><span class="linenos">2309</span></a>        <span class="c1">#     print(f&#39;Size after editing: {size}&#39;)</span>
</span><span id="Closures.grow_to_fault2-2310"><a href="#-2310"><span class="linenos">2310</span></a>
</span><span id="Closures.grow_to_fault2-2311"><a href="#-2311"><span class="linenos">2311</span></a>        <span class="k">if</span> <span class="n">remove_small_closures</span><span class="p">:</span>
</span><span id="Closures.grow_to_fault2-2312"><a href="#-2312"><span class="linenos">2312</span></a>            <span class="n">_initial_labels</span> <span class="o">=</span> <span class="n">measure</span><span class="o">.</span><span class="n">label</span><span class="p">(</span>
</span><span id="Closures.grow_to_fault2-2313"><a href="#-2313"><span class="linenos">2313</span></a>                <span class="n">initial_closures</span><span class="p">,</span> <span class="n">connectivity</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">background</span><span class="o">=</span><span class="mi">0</span>
</span><span id="Closures.grow_to_fault2-2314"><a href="#-2314"><span class="linenos">2314</span></a>            <span class="p">)</span>
</span><span id="Closures.grow_to_fault2-2315"><a href="#-2315"><span class="linenos">2315</span></a>            <span class="n">_grown_labels</span> <span class="o">=</span> <span class="n">measure</span><span class="o">.</span><span class="n">label</span><span class="p">(</span><span class="n">labels_clean</span><span class="p">,</span> <span class="n">connectivity</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">background</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="Closures.grow_to_fault2-2316"><a href="#-2316"><span class="linenos">2316</span></a>            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">_grown_labels</span><span class="p">):</span>
</span><span id="Closures.grow_to_fault2-2317"><a href="#-2317"><span class="linenos">2317</span></a>                <span class="n">size_initial</span> <span class="o">=</span> <span class="n">_initial_labels</span><span class="p">[</span><span class="n">_initial_labels</span> <span class="o">==</span> <span class="n">x</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="Closures.grow_to_fault2-2318"><a href="#-2318"><span class="linenos">2318</span></a>                <span class="n">size_grown</span> <span class="o">=</span> <span class="n">_grown_labels</span><span class="p">[</span><span class="n">_grown_labels</span> <span class="o">==</span> <span class="n">x</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="Closures.grow_to_fault2-2319"><a href="#-2319"><span class="linenos">2319</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Size before editing: </span><span class="si">{</span><span class="n">size_initial</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Closures.grow_to_fault2-2320"><a href="#-2320"><span class="linenos">2320</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Size after editing: </span><span class="si">{</span><span class="n">size_grown</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Closures.grow_to_fault2-2321"><a href="#-2321"><span class="linenos">2321</span></a>                <span class="k">if</span> <span class="n">size_grown</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">closure_min_voxels</span><span class="p">:</span>
</span><span id="Closures.grow_to_fault2-2322"><a href="#-2322"><span class="linenos">2322</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="Closures.grow_to_fault2-2323"><a href="#-2323"><span class="linenos">2323</span></a>                        <span class="sa">f</span><span class="s2">&quot;Closure below threshold of </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">closure_min_voxels</span><span class="si">}</span><span class="s2"> and will be removed&quot;</span>
</span><span id="Closures.grow_to_fault2-2324"><a href="#-2324"><span class="linenos">2324</span></a>                    <span class="p">)</span>
</span><span id="Closures.grow_to_fault2-2325"><a href="#-2325"><span class="linenos">2325</span></a>                    <span class="n">labels_clean</span><span class="p">[</span><span class="n">_grown_labels</span> <span class="o">==</span> <span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="Closures.grow_to_fault2-2326"><a href="#-2326"><span class="linenos">2326</span></a>        <span class="k">return</span> <span class="n">labels_clean</span>
</span></pre></div>


    

                            </div>
                            <div id="Closures.grow_to_salt" class="classattr">
                                        <input id="Closures.grow_to_salt-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">grow_to_salt</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">closures</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Closures.grow_to_salt-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Closures.grow_to_salt"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Closures.grow_to_salt-2328"><a href="#-2328"><span class="linenos">2328</span></a>    <span class="k">def</span> <span class="nf">grow_to_salt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">closures</span><span class="p">):</span>
</span><span id="Closures.grow_to_salt-2329"><a href="#-2329"><span class="linenos">2329</span></a>        <span class="c1"># - grow closures laterally and up within layer up to salt body</span>
</span><span id="Closures.grow_to_salt-2330"><a href="#-2330"><span class="linenos">2330</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2"> ... grow_to_salt: grow closures laterally and up within layer ...&quot;</span><span class="p">)</span>
</span><span id="Closures.grow_to_salt-2331"><a href="#-2331"><span class="linenos">2331</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span><span class="s2">&quot;growing closures to salt body: grow_to_salt&quot;</span><span class="p">)</span>
</span><span id="Closures.grow_to_salt-2332"><a href="#-2332"><span class="linenos">2332</span></a>
</span><span id="Closures.grow_to_salt-2333"><a href="#-2333"><span class="linenos">2333</span></a>        <span class="n">labels_clean</span> <span class="o">=</span> <span class="n">measure</span><span class="o">.</span><span class="n">label</span><span class="p">(</span>
</span><span id="Closures.grow_to_salt-2334"><a href="#-2334"><span class="linenos">2334</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">closure_segments</span><span class="p">[:],</span> <span class="n">connectivity</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">background</span><span class="o">=</span><span class="mi">0</span>
</span><span id="Closures.grow_to_salt-2335"><a href="#-2335"><span class="linenos">2335</span></a>        <span class="p">)</span>
</span><span id="Closures.grow_to_salt-2336"><a href="#-2336"><span class="linenos">2336</span></a>        <span class="n">labels_clean</span><span class="p">[</span><span class="n">closures</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Closures.grow_to_salt-2337"><a href="#-2337"><span class="linenos">2337</span></a>        <span class="c1"># labels_clean = self.closure_segments[:].copy()</span>
</span><span id="Closures.grow_to_salt-2338"><a href="#-2338"><span class="linenos">2338</span></a>        <span class="c1"># labels_clean[closures == 0] = 0</span>
</span><span id="Closures.grow_to_salt-2339"><a href="#-2339"><span class="linenos">2339</span></a>        <span class="n">labels_clean_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">labels_clean</span><span class="o">.</span><span class="n">flatten</span><span class="p">()))</span>
</span><span id="Closures.grow_to_salt-2340"><a href="#-2340"><span class="linenos">2340</span></a>        <span class="n">labels_clean_list</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="Closures.grow_to_salt-2341"><a href="#-2341"><span class="linenos">2341</span></a>        <span class="n">initial_closures</span> <span class="o">=</span> <span class="n">labels_clean</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Closures.grow_to_salt-2342"><a href="#-2342"><span class="linenos">2342</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">    ... grow_to_salt: n_salt_closures = &quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">labels_clean_list</span><span class="p">))</span>
</span><span id="Closures.grow_to_salt-2343"><a href="#-2343"><span class="linenos">2343</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    ... grow_to_salt: salt_closures = &quot;</span><span class="p">,</span> <span class="n">labels_clean_list</span><span class="p">)</span>
</span><span id="Closures.grow_to_salt-2344"><a href="#-2344"><span class="linenos">2344</span></a>
</span><span id="Closures.grow_to_salt-2345"><a href="#-2345"><span class="linenos">2345</span></a>        <span class="n">depth_cube</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">faulted_age_volume</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span>
</span><span id="Closures.grow_to_salt-2346"><a href="#-2346"><span class="linenos">2346</span></a>        <span class="n">_depths</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">faulted_age_volume</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</span><span id="Closures.grow_to_salt-2347"><a href="#-2347"><span class="linenos">2347</span></a>        <span class="n">depth_cube</span> <span class="o">+=</span> <span class="n">_depths</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">faulted_age_volume</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</span><span id="Closures.grow_to_salt-2348"><a href="#-2348"><span class="linenos">2348</span></a>        <span class="n">_ng</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">faulted_net_to_gross</span><span class="p">[:]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Closures.grow_to_salt-2349"><a href="#-2349"><span class="linenos">2349</span></a>        <span class="n">_age</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">faulted_age_volume</span><span class="p">[:]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Closures.grow_to_salt-2350"><a href="#-2350"><span class="linenos">2350</span></a>        <span class="n">salt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">salt_model</span><span class="o">.</span><span class="n">salt_segments</span><span class="p">[:]</span>
</span><span id="Closures.grow_to_salt-2351"><a href="#-2351"><span class="linenos">2351</span></a>
</span><span id="Closures.grow_to_salt-2352"><a href="#-2352"><span class="linenos">2352</span></a>        <span class="k">for</span> <span class="n">il</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">labels_clean_list</span><span class="p">):</span>
</span><span id="Closures.grow_to_salt-2353"><a href="#-2353"><span class="linenos">2353</span></a>            <span class="n">salt_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">salt</span><span class="p">[</span><span class="n">labels_clean</span> <span class="o">==</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()))</span>
</span><span id="Closures.grow_to_salt-2354"><a href="#-2354"><span class="linenos">2354</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    ... grow_to_fault2: salt_list = &quot;</span><span class="p">,</span> <span class="n">salt_list</span><span class="p">)</span>
</span><span id="Closures.grow_to_salt-2355"><a href="#-2355"><span class="linenos">2355</span></a>            <span class="n">single_closure</span> <span class="o">=</span> <span class="n">labels_clean</span> <span class="o">*</span> <span class="mf">0.0</span>
</span><span id="Closures.grow_to_salt-2356"><a href="#-2356"><span class="linenos">2356</span></a>            <span class="n">size</span> <span class="o">=</span> <span class="n">single_closure</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">labels_clean</span> <span class="o">==</span> <span class="n">i</span><span class="p">)]</span><span class="o">.</span><span class="n">size</span>
</span><span id="Closures.grow_to_salt-2357"><a href="#-2357"><span class="linenos">2357</span></a>            <span class="k">if</span> <span class="n">size</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">closure_min_voxels</span><span class="p">:</span>
</span><span id="Closures.grow_to_salt-2358"><a href="#-2358"><span class="linenos">2358</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Label: </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">, Voxel_Count: </span><span class="si">{</span><span class="n">size</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Closures.grow_to_salt-2359"><a href="#-2359"><span class="linenos">2359</span></a>                <span class="n">single_closure</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">labels_clean</span> <span class="o">==</span> <span class="n">i</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="Closures.grow_to_salt-2360"><a href="#-2360"><span class="linenos">2360</span></a>            <span class="k">if</span> <span class="n">single_closure</span><span class="p">[</span><span class="n">single_closure</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Closures.grow_to_salt-2361"><a href="#-2361"><span class="linenos">2361</span></a>                <span class="n">labels_clean</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">labels_clean</span> <span class="o">==</span> <span class="n">i</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Closures.grow_to_salt-2362"><a href="#-2362"><span class="linenos">2362</span></a>                <span class="k">continue</span>
</span><span id="Closures.grow_to_salt-2363"><a href="#-2363"><span class="linenos">2363</span></a>            <span class="n">avg_ng</span> <span class="o">=</span> <span class="n">_ng</span><span class="p">[</span><span class="n">single_closure</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</span><span id="Closures.grow_to_salt-2364"><a href="#-2364"><span class="linenos">2364</span></a>            <span class="n">_geo_age_voxels</span> <span class="o">=</span> <span class="p">(</span><span class="n">_age</span><span class="p">[</span><span class="n">single_closure</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;int&quot;</span><span class="p">)</span>
</span><span id="Closures.grow_to_salt-2365"><a href="#-2365"><span class="linenos">2365</span></a>            <span class="n">_ng_voxels</span> <span class="o">=</span> <span class="n">_ng</span><span class="p">[</span><span class="n">single_closure</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="Closures.grow_to_salt-2366"><a href="#-2366"><span class="linenos">2366</span></a>            <span class="n">_geo_age_voxels</span> <span class="o">=</span> <span class="n">_geo_age_voxels</span><span class="p">[</span><span class="n">_ng_voxels</span> <span class="o">&gt;=</span> <span class="n">avg_ng</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">]</span>
</span><span id="Closures.grow_to_salt-2367"><a href="#-2367"><span class="linenos">2367</span></a>            <span class="n">min_geo_age</span> <span class="o">=</span> <span class="n">_geo_age_voxels</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">-</span> <span class="mf">0.5</span>
</span><span id="Closures.grow_to_salt-2368"><a href="#-2368"><span class="linenos">2368</span></a>            <span class="n">avg_geo_age</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">_geo_age_voxels</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
</span><span id="Closures.grow_to_salt-2369"><a href="#-2369"><span class="linenos">2369</span></a>            <span class="n">max_geo_age</span> <span class="o">=</span> <span class="n">_geo_age_voxels</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="mf">0.5</span>
</span><span id="Closures.grow_to_salt-2370"><a href="#-2370"><span class="linenos">2370</span></a>            <span class="n">_depth_geobody_voxels</span> <span class="o">=</span> <span class="n">depth_cube</span><span class="p">[</span><span class="n">single_closure</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="Closures.grow_to_salt-2371"><a href="#-2371"><span class="linenos">2371</span></a>            <span class="n">min_depth</span> <span class="o">=</span> <span class="n">_depth_geobody_voxels</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
</span><span id="Closures.grow_to_salt-2372"><a href="#-2372"><span class="linenos">2372</span></a>            <span class="n">max_depth</span> <span class="o">=</span> <span class="n">_depth_geobody_voxels</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</span><span id="Closures.grow_to_salt-2373"><a href="#-2373"><span class="linenos">2373</span></a>            <span class="c1"># Define AOI where salt has been dilated</span>
</span><span id="Closures.grow_to_salt-2374"><a href="#-2374"><span class="linenos">2374</span></a>            <span class="c1"># close_to_salt = np.zeros_like(salt)</span>
</span><span id="Closures.grow_to_salt-2375"><a href="#-2375"><span class="linenos">2375</span></a>            <span class="c1"># close_to_salt[self.wide_salt[:] == 1] = 1.0</span>
</span><span id="Closures.grow_to_salt-2376"><a href="#-2376"><span class="linenos">2376</span></a>            <span class="c1"># close_to_salt[salt == 1] = 0.0</span>
</span><span id="Closures.grow_to_salt-2377"><a href="#-2377"><span class="linenos">2377</span></a>
</span><span id="Closures.grow_to_salt-2378"><a href="#-2378"><span class="linenos">2378</span></a>            <span class="n">closure_boundary_cube</span> <span class="o">=</span> <span class="n">closures</span> <span class="o">*</span> <span class="mf">0.0</span>
</span><span id="Closures.grow_to_salt-2379"><a href="#-2379"><span class="linenos">2379</span></a>            <span class="n">closure_boundary_cube</span><span class="p">[</span>
</span><span id="Closures.grow_to_salt-2380"><a href="#-2380"><span class="linenos">2380</span></a>                <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
</span><span id="Closures.grow_to_salt-2381"><a href="#-2381"><span class="linenos">2381</span></a>                    <span class="p">(</span><span class="n">_ng</span> <span class="o">&gt;</span> <span class="mf">0.3</span><span class="p">)</span>
</span><span id="Closures.grow_to_salt-2382"><a href="#-2382"><span class="linenos">2382</span></a>                    <span class="o">&amp;</span> <span class="p">(</span><span class="n">_age</span> <span class="o">&gt;</span> <span class="n">min_geo_age</span><span class="p">)</span>  <span class="c1"># account for partial voxels</span>
</span><span id="Closures.grow_to_salt-2383"><a href="#-2383"><span class="linenos">2383</span></a>                    <span class="o">&amp;</span> <span class="p">(</span><span class="n">_age</span> <span class="o">&lt;</span> <span class="n">max_geo_age</span><span class="p">)</span>
</span><span id="Closures.grow_to_salt-2384"><a href="#-2384"><span class="linenos">2384</span></a>                    <span class="o">&amp;</span> <span class="p">(</span><span class="n">salt</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">)</span>
</span><span id="Closures.grow_to_salt-2385"><a href="#-2385"><span class="linenos">2385</span></a>                    <span class="o">&amp;</span> <span class="p">(</span><span class="n">depth_cube</span> <span class="o">&lt;=</span> <span class="n">max_depth</span><span class="p">)</span>
</span><span id="Closures.grow_to_salt-2386"><a href="#-2386"><span class="linenos">2386</span></a>                <span class="p">)</span>
</span><span id="Closures.grow_to_salt-2387"><a href="#-2387"><span class="linenos">2387</span></a>            <span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="Closures.grow_to_salt-2388"><a href="#-2388"><span class="linenos">2388</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="Closures.grow_to_salt-2389"><a href="#-2389"><span class="linenos">2389</span></a>                <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">    ... grow_to_fault2: closure_boundary_cube voxels = &quot;</span><span class="p">,</span>
</span><span id="Closures.grow_to_salt-2390"><a href="#-2390"><span class="linenos">2390</span></a>                <span class="n">closure_boundary_cube</span><span class="p">[</span><span class="n">closure_boundary_cube</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">,</span>
</span><span id="Closures.grow_to_salt-2391"><a href="#-2391"><span class="linenos">2391</span></a>            <span class="p">)</span>
</span><span id="Closures.grow_to_salt-2392"><a href="#-2392"><span class="linenos">2392</span></a>
</span><span id="Closures.grow_to_salt-2393"><a href="#-2393"><span class="linenos">2393</span></a>            <span class="n">n_voxel</span> <span class="o">=</span> <span class="n">single_closure</span><span class="p">[</span><span class="n">single_closure</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="Closures.grow_to_salt-2394"><a href="#-2394"><span class="linenos">2394</span></a>
</span><span id="Closures.grow_to_salt-2395"><a href="#-2395"><span class="linenos">2395</span></a>            <span class="n">original_voxels</span> <span class="o">=</span> <span class="n">n_voxel</span> <span class="o">+</span> <span class="mi">0</span>
</span><span id="Closures.grow_to_salt-2396"><a href="#-2396"><span class="linenos">2396</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="Closures.grow_to_salt-2397"><a href="#-2397"><span class="linenos">2397</span></a>                <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">    ... closure label number, avg_throw, geobody shape, geo_age min/mean/max, depth min/max, avg_ng = &quot;</span><span class="p">,</span>
</span><span id="Closures.grow_to_salt-2398"><a href="#-2398"><span class="linenos">2398</span></a>                <span class="n">i</span><span class="p">,</span>
</span><span id="Closures.grow_to_salt-2399"><a href="#-2399"><span class="linenos">2399</span></a>                <span class="n">n_voxel</span><span class="p">,</span>
</span><span id="Closures.grow_to_salt-2400"><a href="#-2400"><span class="linenos">2400</span></a>                <span class="p">(</span><span class="n">min_geo_age</span><span class="p">,</span> <span class="n">avg_geo_age</span><span class="p">,</span> <span class="n">max_geo_age</span><span class="p">),</span>
</span><span id="Closures.grow_to_salt-2401"><a href="#-2401"><span class="linenos">2401</span></a>                <span class="p">(</span><span class="n">min_depth</span><span class="p">,</span> <span class="n">max_depth</span><span class="p">),</span>
</span><span id="Closures.grow_to_salt-2402"><a href="#-2402"><span class="linenos">2402</span></a>                <span class="n">avg_ng</span><span class="p">,</span>
</span><span id="Closures.grow_to_salt-2403"><a href="#-2403"><span class="linenos">2403</span></a>                <span class="n">il</span><span class="p">,</span>
</span><span id="Closures.grow_to_salt-2404"><a href="#-2404"><span class="linenos">2404</span></a>                <span class="s2">&quot; / &quot;</span><span class="p">,</span>
</span><span id="Closures.grow_to_salt-2405"><a href="#-2405"><span class="linenos">2405</span></a>                <span class="nb">len</span><span class="p">(</span><span class="n">labels_clean_list</span><span class="p">),</span>
</span><span id="Closures.grow_to_salt-2406"><a href="#-2406"><span class="linenos">2406</span></a>            <span class="p">)</span>
</span><span id="Closures.grow_to_salt-2407"><a href="#-2407"><span class="linenos">2407</span></a>
</span><span id="Closures.grow_to_salt-2408"><a href="#-2408"><span class="linenos">2408</span></a>            <span class="n">grown_closure</span> <span class="o">=</span> <span class="n">single_closure</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Closures.grow_to_salt-2409"><a href="#-2409"><span class="linenos">2409</span></a>            <span class="n">grown_closure</span><span class="p">[</span><span class="n">depth_cube</span> <span class="o">&gt;=</span> <span class="n">max_depth</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Closures.grow_to_salt-2410"><a href="#-2410"><span class="linenos">2410</span></a>            <span class="n">delta_voxel</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Closures.grow_to_salt-2411"><a href="#-2411"><span class="linenos">2411</span></a>            <span class="n">previous_delta_voxel</span> <span class="o">=</span> <span class="mf">1e9</span>
</span><span id="Closures.grow_to_salt-2412"><a href="#-2412"><span class="linenos">2412</span></a>            <span class="n">converged</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Closures.grow_to_salt-2413"><a href="#-2413"><span class="linenos">2413</span></a>            <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">99</span><span class="p">):</span>
</span><span id="Closures.grow_to_salt-2414"><a href="#-2414"><span class="linenos">2414</span></a>                <span class="n">grown_closure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grow_lateral</span><span class="p">(</span><span class="n">grown_closure</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span><span id="Closures.grow_to_salt-2415"><a href="#-2415"><span class="linenos">2415</span></a>                <span class="n">grown_closure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grow_upward</span><span class="p">(</span><span class="n">grown_closure</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="Closures.grow_to_salt-2416"><a href="#-2416"><span class="linenos">2416</span></a>                <span class="c1"># stay within layer, within age, close to salt and above HCWC</span>
</span><span id="Closures.grow_to_salt-2417"><a href="#-2417"><span class="linenos">2417</span></a>                <span class="n">grown_closure</span><span class="p">[</span><span class="n">closure_boundary_cube</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="Closures.grow_to_salt-2418"><a href="#-2418"><span class="linenos">2418</span></a>                <span class="n">single_closure</span> <span class="o">=</span> <span class="n">single_closure</span> <span class="o">+</span> <span class="n">grown_closure</span>
</span><span id="Closures.grow_to_salt-2419"><a href="#-2419"><span class="linenos">2419</span></a>                <span class="n">single_closure</span><span class="p">[</span><span class="n">single_closure</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
</span><span id="Closures.grow_to_salt-2420"><a href="#-2420"><span class="linenos">2420</span></a>                <span class="n">new_n_voxel</span> <span class="o">=</span> <span class="n">single_closure</span><span class="p">[</span><span class="n">single_closure</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="Closures.grow_to_salt-2421"><a href="#-2421"><span class="linenos">2421</span></a>                <span class="n">previous_delta_voxel</span> <span class="o">=</span> <span class="n">delta_voxel</span> <span class="o">+</span> <span class="mi">0</span>
</span><span id="Closures.grow_to_salt-2422"><a href="#-2422"><span class="linenos">2422</span></a>                <span class="n">delta_voxel</span> <span class="o">=</span> <span class="n">new_n_voxel</span> <span class="o">-</span> <span class="n">n_voxel</span>
</span><span id="Closures.grow_to_salt-2423"><a href="#-2423"><span class="linenos">2423</span></a>                <span class="nb">print</span><span class="p">(</span>
</span><span id="Closures.grow_to_salt-2424"><a href="#-2424"><span class="linenos">2424</span></a>                    <span class="s2">&quot;    ... i, ii, closure label number, geobody shape, delta_voxel, previous_delta_voxel,&quot;</span>
</span><span id="Closures.grow_to_salt-2425"><a href="#-2425"><span class="linenos">2425</span></a>                    <span class="s2">&quot; delta_voxel&gt;previous_delta_voxel = &quot;</span><span class="p">,</span>
</span><span id="Closures.grow_to_salt-2426"><a href="#-2426"><span class="linenos">2426</span></a>                    <span class="n">i</span><span class="p">,</span>
</span><span id="Closures.grow_to_salt-2427"><a href="#-2427"><span class="linenos">2427</span></a>                    <span class="n">ii</span><span class="p">,</span>
</span><span id="Closures.grow_to_salt-2428"><a href="#-2428"><span class="linenos">2428</span></a>                    <span class="n">new_n_voxel</span><span class="p">,</span>
</span><span id="Closures.grow_to_salt-2429"><a href="#-2429"><span class="linenos">2429</span></a>                    <span class="n">delta_voxel</span><span class="p">,</span>
</span><span id="Closures.grow_to_salt-2430"><a href="#-2430"><span class="linenos">2430</span></a>                    <span class="n">previous_delta_voxel</span><span class="p">,</span>
</span><span id="Closures.grow_to_salt-2431"><a href="#-2431"><span class="linenos">2431</span></a>                    <span class="n">delta_voxel</span> <span class="o">&gt;</span> <span class="n">previous_delta_voxel</span><span class="p">,</span>
</span><span id="Closures.grow_to_salt-2432"><a href="#-2432"><span class="linenos">2432</span></a>                <span class="p">)</span>
</span><span id="Closures.grow_to_salt-2433"><a href="#-2433"><span class="linenos">2433</span></a>
</span><span id="Closures.grow_to_salt-2434"><a href="#-2434"><span class="linenos">2434</span></a>                <span class="c1"># If grown voxel is touching the egde of survey, stop and remove closure</span>
</span><span id="Closures.grow_to_salt-2435"><a href="#-2435"><span class="linenos">2435</span></a>                <span class="n">_a</span><span class="p">,</span> <span class="n">_b</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">single_closure</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="Closures.grow_to_salt-2436"><a href="#-2436"><span class="linenos">2436</span></a>                <span class="n">max_boundary_i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>
</span><span id="Closures.grow_to_salt-2437"><a href="#-2437"><span class="linenos">2437</span></a>                <span class="n">max_boundary_j</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>
</span><span id="Closures.grow_to_salt-2438"><a href="#-2438"><span class="linenos">2438</span></a>                <span class="k">if</span> <span class="p">(</span>
</span><span id="Closures.grow_to_salt-2439"><a href="#-2439"><span class="linenos">2439</span></a>                    <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">_a</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>
</span><span id="Closures.grow_to_salt-2440"><a href="#-2440"><span class="linenos">2440</span></a>                    <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">_a</span><span class="p">)</span> <span class="o">==</span> <span class="n">max_boundary_i</span>
</span><span id="Closures.grow_to_salt-2441"><a href="#-2441"><span class="linenos">2441</span></a>                    <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">_b</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>
</span><span id="Closures.grow_to_salt-2442"><a href="#-2442"><span class="linenos">2442</span></a>                    <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">_b</span><span class="p">)</span> <span class="o">==</span> <span class="n">max_boundary_j</span>
</span><span id="Closures.grow_to_salt-2443"><a href="#-2443"><span class="linenos">2443</span></a>                <span class="p">):</span>
</span><span id="Closures.grow_to_salt-2444"><a href="#-2444"><span class="linenos">2444</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Boundary reached, removing closure&quot;</span><span class="p">)</span>
</span><span id="Closures.grow_to_salt-2445"><a href="#-2445"><span class="linenos">2445</span></a>                    <span class="n">converged</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Closures.grow_to_salt-2446"><a href="#-2446"><span class="linenos">2446</span></a>                    <span class="k">break</span>
</span><span id="Closures.grow_to_salt-2447"><a href="#-2447"><span class="linenos">2447</span></a>
</span><span id="Closures.grow_to_salt-2448"><a href="#-2448"><span class="linenos">2448</span></a>                <span class="k">if</span> <span class="n">n_voxel</span> <span class="o">==</span> <span class="n">new_n_voxel</span><span class="p">:</span>
</span><span id="Closures.grow_to_salt-2449"><a href="#-2449"><span class="linenos">2449</span></a>                    <span class="c1"># finish bottom voxel layer near HCWC</span>
</span><span id="Closures.grow_to_salt-2450"><a href="#-2450"><span class="linenos">2450</span></a>                    <span class="n">grown_closure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grow_downward</span><span class="p">(</span>
</span><span id="Closures.grow_to_salt-2451"><a href="#-2451"><span class="linenos">2451</span></a>                        <span class="n">grown_closure</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span>
</span><span id="Closures.grow_to_salt-2452"><a href="#-2452"><span class="linenos">2452</span></a>                    <span class="p">)</span>
</span><span id="Closures.grow_to_salt-2453"><a href="#-2453"><span class="linenos">2453</span></a>                    <span class="c1"># stay within layer, within age, within fault block, above HCWC</span>
</span><span id="Closures.grow_to_salt-2454"><a href="#-2454"><span class="linenos">2454</span></a>                    <span class="n">grown_closure</span><span class="p">[</span><span class="n">closure_boundary_cube</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="Closures.grow_to_salt-2455"><a href="#-2455"><span class="linenos">2455</span></a>                    <span class="n">single_closure</span> <span class="o">=</span> <span class="n">single_closure</span> <span class="o">+</span> <span class="n">grown_closure</span>
</span><span id="Closures.grow_to_salt-2456"><a href="#-2456"><span class="linenos">2456</span></a>                    <span class="n">single_closure</span><span class="p">[</span><span class="n">single_closure</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
</span><span id="Closures.grow_to_salt-2457"><a href="#-2457"><span class="linenos">2457</span></a>                    <span class="n">converged</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Closures.grow_to_salt-2458"><a href="#-2458"><span class="linenos">2458</span></a>                    <span class="k">break</span>
</span><span id="Closures.grow_to_salt-2459"><a href="#-2459"><span class="linenos">2459</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Closures.grow_to_salt-2460"><a href="#-2460"><span class="linenos">2460</span></a>                    <span class="n">n_voxel</span> <span class="o">=</span> <span class="n">new_n_voxel</span>
</span><span id="Closures.grow_to_salt-2461"><a href="#-2461"><span class="linenos">2461</span></a>                <span class="n">previous_delta_voxel</span> <span class="o">=</span> <span class="n">delta_voxel</span> <span class="o">+</span> <span class="mi">0</span>
</span><span id="Closures.grow_to_salt-2462"><a href="#-2462"><span class="linenos">2462</span></a>            <span class="k">if</span> <span class="n">converged</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="Closures.grow_to_salt-2463"><a href="#-2463"><span class="linenos">2463</span></a>                <span class="n">labels_clean</span><span class="p">[</span><span class="n">single_closure</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
</span><span id="Closures.grow_to_salt-2464"><a href="#-2464"><span class="linenos">2464</span></a>                <span class="n">msg_postscript</span> <span class="o">=</span> <span class="s2">&quot; converged&quot;</span>
</span><span id="Closures.grow_to_salt-2465"><a href="#-2465"><span class="linenos">2465</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Closures.grow_to_salt-2466"><a href="#-2466"><span class="linenos">2466</span></a>                <span class="n">labels_clean</span><span class="p">[</span><span class="n">labels_clean</span> <span class="o">==</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">i</span>
</span><span id="Closures.grow_to_salt-2467"><a href="#-2467"><span class="linenos">2467</span></a>                <span class="n">msg_postscript</span> <span class="o">=</span> <span class="s2">&quot; NOT converged&quot;</span>
</span><span id="Closures.grow_to_salt-2468"><a href="#-2468"><span class="linenos">2468</span></a>            <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="Closures.grow_to_salt-2469"><a href="#-2469"><span class="linenos">2469</span></a>                <span class="sa">f</span><span class="s2">&quot;closure_id: </span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="si">:</span><span class="s2">04d</span><span class="si">}</span><span class="s2">, &quot;</span>
</span><span id="Closures.grow_to_salt-2470"><a href="#-2470"><span class="linenos">2470</span></a>                <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;original_voxels: </span><span class="si">{</span><span class="n">original_voxels</span><span class="si">:</span><span class="s2">11.0f</span><span class="si">}</span><span class="s2">, new_n_voxel: </span><span class="si">{</span><span class="n">new_n_voxel</span><span class="si">:</span><span class="s2">11.0f</span><span class="si">}</span><span class="s2">, &quot;</span>
</span><span id="Closures.grow_to_salt-2471"><a href="#-2471"><span class="linenos">2471</span></a>                <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;percent_growth: </span><span class="si">{</span><span class="nb">float</span><span class="p">(</span><span class="n">new_n_voxel</span> <span class="o">/</span> <span class="n">original_voxels</span><span class="p">)</span><span class="si">:</span><span class="s2">6.2f</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Closures.grow_to_salt-2472"><a href="#-2472"><span class="linenos">2472</span></a>            <span class="p">)</span>
</span><span id="Closures.grow_to_salt-2473"><a href="#-2473"><span class="linenos">2473</span></a>            <span class="nb">print</span><span class="p">(</span><span class="n">msg</span> <span class="o">+</span> <span class="n">msg_postscript</span><span class="p">)</span>
</span><span id="Closures.grow_to_salt-2474"><a href="#-2474"><span class="linenos">2474</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span><span class="n">msg</span> <span class="o">+</span> <span class="n">msg_postscript</span><span class="p">)</span>
</span><span id="Closures.grow_to_salt-2475"><a href="#-2475"><span class="linenos">2475</span></a>
</span><span id="Closures.grow_to_salt-2476"><a href="#-2476"><span class="linenos">2476</span></a>        <span class="c1"># Set small closures to 0 after growth</span>
</span><span id="Closures.grow_to_salt-2477"><a href="#-2477"><span class="linenos">2477</span></a>        <span class="n">_initial_labels</span> <span class="o">=</span> <span class="n">measure</span><span class="o">.</span><span class="n">label</span><span class="p">(</span><span class="n">initial_closures</span><span class="p">,</span> <span class="n">connectivity</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">background</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="Closures.grow_to_salt-2478"><a href="#-2478"><span class="linenos">2478</span></a>        <span class="n">_grown_labels</span> <span class="o">=</span> <span class="n">measure</span><span class="o">.</span><span class="n">label</span><span class="p">(</span><span class="n">labels_clean</span><span class="p">,</span> <span class="n">connectivity</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">background</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="Closures.grow_to_salt-2479"><a href="#-2479"><span class="linenos">2479</span></a>        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">_grown_labels</span><span class="p">)[</span>
</span><span id="Closures.grow_to_salt-2480"><a href="#-2480"><span class="linenos">2480</span></a>            <span class="mi">1</span><span class="p">:</span>
</span><span id="Closures.grow_to_salt-2481"><a href="#-2481"><span class="linenos">2481</span></a>        <span class="p">]:</span>  <span class="c1"># ignore the first label of 0 (closures only)</span>
</span><span id="Closures.grow_to_salt-2482"><a href="#-2482"><span class="linenos">2482</span></a>            <span class="n">size_initial</span> <span class="o">=</span> <span class="n">_initial_labels</span><span class="p">[</span><span class="n">_initial_labels</span> <span class="o">==</span> <span class="n">x</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="Closures.grow_to_salt-2483"><a href="#-2483"><span class="linenos">2483</span></a>            <span class="n">size_grown</span> <span class="o">=</span> <span class="n">_grown_labels</span><span class="p">[</span><span class="n">_grown_labels</span> <span class="o">==</span> <span class="n">x</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="Closures.grow_to_salt-2484"><a href="#-2484"><span class="linenos">2484</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Size before editing: </span><span class="si">{</span><span class="n">size_initial</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Closures.grow_to_salt-2485"><a href="#-2485"><span class="linenos">2485</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Size after editing: </span><span class="si">{</span><span class="n">size_grown</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Closures.grow_to_salt-2486"><a href="#-2486"><span class="linenos">2486</span></a>            <span class="k">if</span> <span class="n">size_grown</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">closure_min_voxels</span><span class="p">:</span>
</span><span id="Closures.grow_to_salt-2487"><a href="#-2487"><span class="linenos">2487</span></a>                <span class="nb">print</span><span class="p">(</span>
</span><span id="Closures.grow_to_salt-2488"><a href="#-2488"><span class="linenos">2488</span></a>                    <span class="sa">f</span><span class="s2">&quot;Closure below threshold of </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">closure_min_voxels</span><span class="si">}</span><span class="s2"> and will be removed&quot;</span>
</span><span id="Closures.grow_to_salt-2489"><a href="#-2489"><span class="linenos">2489</span></a>                <span class="p">)</span>
</span><span id="Closures.grow_to_salt-2490"><a href="#-2490"><span class="linenos">2490</span></a>                <span class="n">labels_clean</span><span class="p">[</span><span class="n">_grown_labels</span> <span class="o">==</span> <span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="Closures.grow_to_salt-2491"><a href="#-2491"><span class="linenos">2491</span></a>
</span><span id="Closures.grow_to_salt-2492"><a href="#-2492"><span class="linenos">2492</span></a>        <span class="k">return</span> <span class="n">labels_clean</span>
</span></pre></div>


    

                            </div>
                            <div id="Closures.grow_lateral" class="classattr">
                                        <input id="Closures.grow_lateral-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">grow_lateral</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">geobody</span>, </span><span class="param"><span class="n">iterations</span>, </span><span class="param"><span class="n">dist</span><span class="o">=</span><span class="mi">1</span>, </span><span class="param"><span class="n">verbose</span><span class="o">=</span><span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Closures.grow_lateral-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Closures.grow_lateral"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Closures.grow_lateral-2494"><a href="#-2494"><span class="linenos">2494</span></a>    <span class="nd">@staticmethod</span>
</span><span id="Closures.grow_lateral-2495"><a href="#-2495"><span class="linenos">2495</span></a>    <span class="k">def</span> <span class="nf">grow_lateral</span><span class="p">(</span><span class="n">geobody</span><span class="p">,</span> <span class="n">iterations</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="Closures.grow_lateral-2496"><a href="#-2496"><span class="linenos">2496</span></a>        <span class="kn">from</span> <span class="nn">scipy.ndimage.morphology</span> <span class="kn">import</span> <span class="n">grey_dilation</span>
</span><span id="Closures.grow_lateral-2497"><a href="#-2497"><span class="linenos">2497</span></a>
</span><span id="Closures.grow_lateral-2498"><a href="#-2498"><span class="linenos">2498</span></a>        <span class="n">dist_size</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">dist</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="Closures.grow_lateral-2499"><a href="#-2499"><span class="linenos">2499</span></a>        <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">dist_size</span><span class="p">,</span> <span class="n">dist_size</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</span><span id="Closures.grow_lateral-2500"><a href="#-2500"><span class="linenos">2500</span></a>        <span class="n">mask</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="Closures.grow_lateral-2501"><a href="#-2501"><span class="linenos">2501</span></a>        <span class="n">_geobody</span> <span class="o">=</span> <span class="n">geobody</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Closures.grow_lateral-2502"><a href="#-2502"><span class="linenos">2502</span></a>        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="Closures.grow_lateral-2503"><a href="#-2503"><span class="linenos">2503</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; ...grow_lateral: _geobody.shape = &quot;</span><span class="p">,</span> <span class="n">_geobody</span><span class="p">[</span><span class="n">_geobody</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span><span id="Closures.grow_lateral-2504"><a href="#-2504"><span class="linenos">2504</span></a>        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">iterations</span><span class="p">):</span>
</span><span id="Closures.grow_lateral-2505"><a href="#-2505"><span class="linenos">2505</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="Closures.grow_lateral-2506"><a href="#-2506"><span class="linenos">2506</span></a>                <span class="n">_geobody</span> <span class="o">=</span> <span class="n">grey_dilation</span><span class="p">(</span><span class="n">_geobody</span><span class="p">,</span> <span class="n">footprint</span><span class="o">=</span><span class="n">mask</span><span class="p">)</span>
</span><span id="Closures.grow_lateral-2507"><a href="#-2507"><span class="linenos">2507</span></a>                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="Closures.grow_lateral-2508"><a href="#-2508"><span class="linenos">2508</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="Closures.grow_lateral-2509"><a href="#-2509"><span class="linenos">2509</span></a>                        <span class="s2">&quot; ...grow_lateral: k, _geobody.shape = &quot;</span><span class="p">,</span>
</span><span id="Closures.grow_lateral-2510"><a href="#-2510"><span class="linenos">2510</span></a>                        <span class="n">k</span><span class="p">,</span>
</span><span id="Closures.grow_lateral-2511"><a href="#-2511"><span class="linenos">2511</span></a>                        <span class="n">_geobody</span><span class="p">[</span><span class="n">_geobody</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
</span><span id="Closures.grow_lateral-2512"><a href="#-2512"><span class="linenos">2512</span></a>                    <span class="p">)</span>
</span><span id="Closures.grow_lateral-2513"><a href="#-2513"><span class="linenos">2513</span></a>            <span class="k">except</span><span class="p">:</span>
</span><span id="Closures.grow_lateral-2514"><a href="#-2514"><span class="linenos">2514</span></a>                <span class="k">break</span>
</span><span id="Closures.grow_lateral-2515"><a href="#-2515"><span class="linenos">2515</span></a>        <span class="k">return</span> <span class="n">_geobody</span>
</span></pre></div>


    

                            </div>
                            <div id="Closures.grow_upward" class="classattr">
                                        <input id="Closures.grow_upward-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">grow_upward</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">geobody</span>, </span><span class="param"><span class="n">iterations</span>, </span><span class="param"><span class="n">dist</span><span class="o">=</span><span class="mi">1</span>, </span><span class="param"><span class="n">verbose</span><span class="o">=</span><span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Closures.grow_upward-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Closures.grow_upward"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Closures.grow_upward-2517"><a href="#-2517"><span class="linenos">2517</span></a>    <span class="nd">@staticmethod</span>
</span><span id="Closures.grow_upward-2518"><a href="#-2518"><span class="linenos">2518</span></a>    <span class="k">def</span> <span class="nf">grow_upward</span><span class="p">(</span><span class="n">geobody</span><span class="p">,</span> <span class="n">iterations</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="Closures.grow_upward-2519"><a href="#-2519"><span class="linenos">2519</span></a>        <span class="kn">from</span> <span class="nn">scipy.ndimage.morphology</span> <span class="kn">import</span> <span class="n">grey_dilation</span>
</span><span id="Closures.grow_upward-2520"><a href="#-2520"><span class="linenos">2520</span></a>
</span><span id="Closures.grow_upward-2521"><a href="#-2521"><span class="linenos">2521</span></a>        <span class="n">dist_size</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">dist</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="Closures.grow_upward-2522"><a href="#-2522"><span class="linenos">2522</span></a>        <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dist_size</span><span class="p">))</span>
</span><span id="Closures.grow_upward-2523"><a href="#-2523"><span class="linenos">2523</span></a>        <span class="n">mask</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:</span> <span class="n">dist</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="Closures.grow_upward-2524"><a href="#-2524"><span class="linenos">2524</span></a>        <span class="n">_geobody</span> <span class="o">=</span> <span class="n">geobody</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Closures.grow_upward-2525"><a href="#-2525"><span class="linenos">2525</span></a>        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="Closures.grow_upward-2526"><a href="#-2526"><span class="linenos">2526</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; ...grow_upward: _geobody.shape = &quot;</span><span class="p">,</span> <span class="n">_geobody</span><span class="p">[</span><span class="n">_geobody</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span><span id="Closures.grow_upward-2527"><a href="#-2527"><span class="linenos">2527</span></a>        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">iterations</span><span class="p">):</span>
</span><span id="Closures.grow_upward-2528"><a href="#-2528"><span class="linenos">2528</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="Closures.grow_upward-2529"><a href="#-2529"><span class="linenos">2529</span></a>                <span class="n">_geobody</span> <span class="o">=</span> <span class="n">grey_dilation</span><span class="p">(</span><span class="n">_geobody</span><span class="p">,</span> <span class="n">footprint</span><span class="o">=</span><span class="n">mask</span><span class="p">)</span>
</span><span id="Closures.grow_upward-2530"><a href="#-2530"><span class="linenos">2530</span></a>                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="Closures.grow_upward-2531"><a href="#-2531"><span class="linenos">2531</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="Closures.grow_upward-2532"><a href="#-2532"><span class="linenos">2532</span></a>                        <span class="s2">&quot; ...grow_upward: k, _geobody.shape = &quot;</span><span class="p">,</span>
</span><span id="Closures.grow_upward-2533"><a href="#-2533"><span class="linenos">2533</span></a>                        <span class="n">k</span><span class="p">,</span>
</span><span id="Closures.grow_upward-2534"><a href="#-2534"><span class="linenos">2534</span></a>                        <span class="n">_geobody</span><span class="p">[</span><span class="n">_geobody</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
</span><span id="Closures.grow_upward-2535"><a href="#-2535"><span class="linenos">2535</span></a>                    <span class="p">)</span>
</span><span id="Closures.grow_upward-2536"><a href="#-2536"><span class="linenos">2536</span></a>            <span class="k">except</span><span class="p">:</span>
</span><span id="Closures.grow_upward-2537"><a href="#-2537"><span class="linenos">2537</span></a>                <span class="k">break</span>
</span><span id="Closures.grow_upward-2538"><a href="#-2538"><span class="linenos">2538</span></a>        <span class="k">return</span> <span class="n">_geobody</span>
</span></pre></div>


    

                            </div>
                            <div id="Closures.grow_downward" class="classattr">
                                        <input id="Closures.grow_downward-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">grow_downward</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">geobody</span>, </span><span class="param"><span class="n">iterations</span>, </span><span class="param"><span class="n">dist</span><span class="o">=</span><span class="mi">1</span>, </span><span class="param"><span class="n">verbose</span><span class="o">=</span><span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Closures.grow_downward-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Closures.grow_downward"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Closures.grow_downward-2540"><a href="#-2540"><span class="linenos">2540</span></a>    <span class="nd">@staticmethod</span>
</span><span id="Closures.grow_downward-2541"><a href="#-2541"><span class="linenos">2541</span></a>    <span class="k">def</span> <span class="nf">grow_downward</span><span class="p">(</span><span class="n">geobody</span><span class="p">,</span> <span class="n">iterations</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="Closures.grow_downward-2542"><a href="#-2542"><span class="linenos">2542</span></a>        <span class="kn">from</span> <span class="nn">scipy.ndimage.morphology</span> <span class="kn">import</span> <span class="n">grey_dilation</span>
</span><span id="Closures.grow_downward-2543"><a href="#-2543"><span class="linenos">2543</span></a>
</span><span id="Closures.grow_downward-2544"><a href="#-2544"><span class="linenos">2544</span></a>        <span class="n">dist_size</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">dist</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="Closures.grow_downward-2545"><a href="#-2545"><span class="linenos">2545</span></a>        <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dist_size</span><span class="p">))</span>
</span><span id="Closures.grow_downward-2546"><a href="#-2546"><span class="linenos">2546</span></a>        <span class="n">mask</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">dist</span><span class="p">:]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="Closures.grow_downward-2547"><a href="#-2547"><span class="linenos">2547</span></a>        <span class="n">_geobody</span> <span class="o">=</span> <span class="n">geobody</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Closures.grow_downward-2548"><a href="#-2548"><span class="linenos">2548</span></a>        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="Closures.grow_downward-2549"><a href="#-2549"><span class="linenos">2549</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; ...grow_downward: _geobody.shape = &quot;</span><span class="p">,</span> <span class="n">_geobody</span><span class="p">[</span><span class="n">_geobody</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span><span id="Closures.grow_downward-2550"><a href="#-2550"><span class="linenos">2550</span></a>        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">iterations</span><span class="p">):</span>
</span><span id="Closures.grow_downward-2551"><a href="#-2551"><span class="linenos">2551</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="Closures.grow_downward-2552"><a href="#-2552"><span class="linenos">2552</span></a>                <span class="n">_geobody</span> <span class="o">=</span> <span class="n">grey_dilation</span><span class="p">(</span><span class="n">_geobody</span><span class="p">,</span> <span class="n">footprint</span><span class="o">=</span><span class="n">mask</span><span class="p">)</span>
</span><span id="Closures.grow_downward-2553"><a href="#-2553"><span class="linenos">2553</span></a>                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="Closures.grow_downward-2554"><a href="#-2554"><span class="linenos">2554</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="Closures.grow_downward-2555"><a href="#-2555"><span class="linenos">2555</span></a>                        <span class="s2">&quot; ...grow_downward: k, _geobody.shape = &quot;</span><span class="p">,</span>
</span><span id="Closures.grow_downward-2556"><a href="#-2556"><span class="linenos">2556</span></a>                        <span class="n">k</span><span class="p">,</span>
</span><span id="Closures.grow_downward-2557"><a href="#-2557"><span class="linenos">2557</span></a>                        <span class="n">_geobody</span><span class="p">[</span><span class="n">_geobody</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
</span><span id="Closures.grow_downward-2558"><a href="#-2558"><span class="linenos">2558</span></a>                    <span class="p">)</span>
</span><span id="Closures.grow_downward-2559"><a href="#-2559"><span class="linenos">2559</span></a>            <span class="k">except</span><span class="p">:</span>
</span><span id="Closures.grow_downward-2560"><a href="#-2560"><span class="linenos">2560</span></a>                <span class="k">break</span>
</span><span id="Closures.grow_downward-2561"><a href="#-2561"><span class="linenos">2561</span></a>        <span class="k">return</span> <span class="n">_geobody</span>
</span></pre></div>


    

                            </div>
                            <div id="Closures.parse_closure_codes" class="classattr">
                                        <input id="Closures.parse_closure_codes-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">parse_closure_codes</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">hc_closure_codes</span>, </span><span class="param"><span class="n">labels</span>, </span><span class="param"><span class="n">num</span>, </span><span class="param"><span class="n">code</span><span class="o">=</span><span class="mf">0.1</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Closures.parse_closure_codes-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Closures.parse_closure_codes"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Closures.parse_closure_codes-2569"><a href="#-2569"><span class="linenos">2569</span></a>    <span class="k">def</span> <span class="nf">parse_closure_codes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hc_closure_codes</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">num</span><span class="p">,</span> <span class="n">code</span><span class="o">=</span><span class="mf">0.1</span><span class="p">):</span>
</span><span id="Closures.parse_closure_codes-2570"><a href="#-2570"><span class="linenos">2570</span></a>        <span class="n">labels</span> <span class="o">=</span> <span class="n">labels</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;float32&quot;</span><span class="p">)</span>
</span><span id="Closures.parse_closure_codes-2571"><a href="#-2571"><span class="linenos">2571</span></a>        <span class="k">if</span> <span class="n">num</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Closures.parse_closure_codes-2572"><a href="#-2572"><span class="linenos">2572</span></a>            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">num</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="Closures.parse_closure_codes-2573"><a href="#-2573"><span class="linenos">2573</span></a>                <span class="n">y</span> <span class="o">=</span> <span class="n">code</span> <span class="o">+</span> <span class="n">labels</span><span class="p">[</span><span class="n">labels</span> <span class="o">==</span> <span class="n">x</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="Closures.parse_closure_codes-2574"><a href="#-2574"><span class="linenos">2574</span></a>                <span class="n">labels</span><span class="p">[</span><span class="n">labels</span> <span class="o">==</span> <span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span>
</span><span id="Closures.parse_closure_codes-2575"><a href="#-2575"><span class="linenos">2575</span></a>            <span class="n">hc_closure_codes</span> <span class="o">+=</span> <span class="n">labels</span>
</span><span id="Closures.parse_closure_codes-2576"><a href="#-2576"><span class="linenos">2576</span></a>        <span class="k">return</span> <span class="n">hc_closure_codes</span>
</span></pre></div>


    

                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="Horizons.html#Horizons">datagenerator.Horizons.Horizons</a></dt>
                                <dd id="Closures.insert_feature_into_horizon_stack" class="function"><a href="Horizons.html#Horizons.insert_feature_into_horizon_stack">insert_feature_into_horizon_stack</a></dd>
                <dd id="Closures.insert_seafloor" class="function"><a href="Horizons.html#Horizons.insert_seafloor">insert_seafloor</a></dd>
                <dd id="Closures.create_random_net_over_gross_map" class="function"><a href="Horizons.html#Horizons.create_random_net_over_gross_map">create_random_net_over_gross_map</a></dd>
                <dd id="Closures.fit_plane_lsq" class="function"><a href="Horizons.html#Horizons.fit_plane_lsq">fit_plane_lsq</a></dd>
                <dd id="Closures.eval_plane" class="function"><a href="Horizons.html#Horizons.eval_plane">eval_plane</a></dd>
                <dd id="Closures.halton" class="function"><a href="Horizons.html#Horizons.halton">halton</a></dd>
                <dd id="Closures.rotate_point" class="function"><a href="Horizons.html#Horizons.rotate_point">rotate_point</a></dd>
                <dd id="Closures.convert_map_from_samples_to_units" class="function"><a href="Horizons.html#Horizons.convert_map_from_samples_to_units">convert_map_from_samples_to_units</a></dd>
                <dd id="Closures.write_maps_to_disk" class="function"><a href="Horizons.html#Horizons.write_maps_to_disk">write_maps_to_disk</a></dd>
                <dd id="Closures.write_onlap_episodes" class="function"><a href="Horizons.html#Horizons.write_onlap_episodes">write_onlap_episodes</a></dd>
                <dd id="Closures.write_fan_horizons" class="function"><a href="Horizons.html#Horizons.write_fan_horizons">write_fan_horizons</a></dd>

            </div>
            <div><dt><a href="Geomodels.html#Geomodel">datagenerator.Geomodels.Geomodel</a></dt>
                                <dd id="Closures.build_unfaulted_geomodels" class="function"><a href="Geomodels.html#Geomodel.build_unfaulted_geomodels">build_unfaulted_geomodels</a></dd>
                <dd id="Closures.infilled_cube_shape" class="function"><a href="Geomodels.html#Geomodel.infilled_cube_shape">infilled_cube_shape</a></dd>
                <dd id="Closures.build_meshgrid" class="function"><a href="Geomodels.html#Geomodel.build_meshgrid">build_meshgrid</a></dd>
                <dd id="Closures.create_geologic_age_3d_from_infilled_horizons" class="function"><a href="Geomodels.html#Geomodel.create_geologic_age_3d_from_infilled_horizons">create_geologic_age_3d_from_infilled_horizons</a></dd>
                <dd id="Closures.vertical_anti_alias_filter_simple" class="function"><a href="Geomodels.html#Geomodel.vertical_anti_alias_filter_simple">vertical_anti_alias_filter_simple</a></dd>
                <dd id="Closures.vertical_anti_alias_filter" class="function"><a href="Geomodels.html#Geomodel.vertical_anti_alias_filter">vertical_anti_alias_filter</a></dd>
                <dd id="Closures.plot_channels" class="function"><a href="Geomodels.html#Geomodel.plot_channels">plot_channels</a></dd>
                <dd id="Closures.insert_onlap_surfaces" class="function"><a href="Geomodels.html#Geomodel.insert_onlap_surfaces">insert_onlap_surfaces</a></dd>
                <dd id="Closures.write_cube_to_disk" class="function"><a href="Geomodels.html#Geomodel.write_cube_to_disk">write_cube_to_disk</a></dd>

            </div>
            <div><dt><a href="Parameters.html#Parameters">datagenerator.Parameters.Parameters</a></dt>
                                <dd id="Closures.setup_model" class="function"><a href="Parameters.html#Parameters.setup_model">setup_model</a></dd>
                <dd id="Closures.make_directories" class="function"><a href="Parameters.html#Parameters.make_directories">make_directories</a></dd>
                <dd id="Closures.write_key_file" class="function"><a href="Parameters.html#Parameters.write_key_file">write_key_file</a></dd>
                <dd id="Closures.write_to_logfile" class="function"><a href="Parameters.html#Parameters.write_to_logfile">write_to_logfile</a></dd>
                <dd id="Closures.write_sqldict_to_logfile" class="function"><a href="Parameters.html#Parameters.write_sqldict_to_logfile">write_sqldict_to_logfile</a></dd>
                <dd id="Closures.write_sqldict_to_db" class="function"><a href="Parameters.html#Parameters.write_sqldict_to_db">write_sqldict_to_db</a></dd>
                <dd id="Closures.year_plus_fraction" class="function"><a href="Parameters.html#Parameters.year_plus_fraction">year_plus_fraction</a></dd>
                <dd id="Closures.hdf_setup" class="function"><a href="Parameters.html#Parameters.hdf_setup">hdf_setup</a></dd>
                <dd id="Closures.hdf_init" class="function"><a href="Parameters.html#Parameters.hdf_init">hdf_init</a></dd>
                <dd id="Closures.hdf_node_list" class="function"><a href="Parameters.html#Parameters.hdf_node_list">hdf_node_list</a></dd>
                <dd id="Closures.hdf_remove_node_list" class="function"><a href="Parameters.html#Parameters.hdf_remove_node_list">hdf_remove_node_list</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="Intersect3D">
                            <input id="Intersect3D-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">Intersect3D</span><wbr>(<span class="base"><a href="#Closures">Closures</a></span>):

                <label class="view-source-button" for="Intersect3D-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Intersect3D"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Intersect3D-2579"><a href="#-2579"><span class="linenos">2579</span></a><span class="k">class</span> <span class="nc">Intersect3D</span><span class="p">(</span><span class="n">Closures</span><span class="p">):</span>
</span><span id="Intersect3D-2580"><a href="#-2580"><span class="linenos">2580</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="Intersect3D-2581"><a href="#-2581"><span class="linenos">2581</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Intersect3D-2582"><a href="#-2582"><span class="linenos">2582</span></a>        <span class="n">faults</span><span class="p">,</span>
</span><span id="Intersect3D-2583"><a href="#-2583"><span class="linenos">2583</span></a>        <span class="n">onlaps</span><span class="p">,</span>
</span><span id="Intersect3D-2584"><a href="#-2584"><span class="linenos">2584</span></a>        <span class="n">oil_closures</span><span class="p">,</span>
</span><span id="Intersect3D-2585"><a href="#-2585"><span class="linenos">2585</span></a>        <span class="n">gas_closures</span><span class="p">,</span>
</span><span id="Intersect3D-2586"><a href="#-2586"><span class="linenos">2586</span></a>        <span class="n">brine_closures</span><span class="p">,</span>
</span><span id="Intersect3D-2587"><a href="#-2587"><span class="linenos">2587</span></a>        <span class="n">closure_segment_list</span><span class="p">,</span>
</span><span id="Intersect3D-2588"><a href="#-2588"><span class="linenos">2588</span></a>        <span class="n">closure_segments</span><span class="p">,</span>
</span><span id="Intersect3D-2589"><a href="#-2589"><span class="linenos">2589</span></a>        <span class="n">parameters</span><span class="p">,</span>
</span><span id="Intersect3D-2590"><a href="#-2590"><span class="linenos">2590</span></a>    <span class="p">):</span>
</span><span id="Intersect3D-2591"><a href="#-2591"><span class="linenos">2591</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">closure_segment_list</span> <span class="o">=</span> <span class="n">closure_segment_list</span>
</span><span id="Intersect3D-2592"><a href="#-2592"><span class="linenos">2592</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">closure_segments</span> <span class="o">=</span> <span class="n">closure_segments</span>
</span><span id="Intersect3D-2593"><a href="#-2593"><span class="linenos">2593</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span> <span class="o">=</span> <span class="n">parameters</span>
</span><span id="Intersect3D-2594"><a href="#-2594"><span class="linenos">2594</span></a>
</span><span id="Intersect3D-2595"><a href="#-2595"><span class="linenos">2595</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fault_throw</span> <span class="o">=</span> <span class="n">faults</span><span class="o">.</span><span class="n">max_fault_throw</span>
</span><span id="Intersect3D-2596"><a href="#-2596"><span class="linenos">2596</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">geologic_age</span> <span class="o">=</span> <span class="n">faults</span><span class="o">.</span><span class="n">faulted_age_volume</span>
</span><span id="Intersect3D-2597"><a href="#-2597"><span class="linenos">2597</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">geomodel_ng</span> <span class="o">=</span> <span class="n">faults</span><span class="o">.</span><span class="n">faulted_net_to_gross</span>
</span><span id="Intersect3D-2598"><a href="#-2598"><span class="linenos">2598</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">faults</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_threshold_volumes</span><span class="p">(</span><span class="n">faults</span><span class="o">.</span><span class="n">fault_planes</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
</span><span id="Intersect3D-2599"><a href="#-2599"><span class="linenos">2599</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">onlaps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_threshold_volumes</span><span class="p">(</span><span class="n">onlaps</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
</span><span id="Intersect3D-2600"><a href="#-2600"><span class="linenos">2600</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">oil_closures</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_threshold_volumes</span><span class="p">(</span><span class="n">oil_closures</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
</span><span id="Intersect3D-2601"><a href="#-2601"><span class="linenos">2601</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gas_closures</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_threshold_volumes</span><span class="p">(</span><span class="n">gas_closures</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
</span><span id="Intersect3D-2602"><a href="#-2602"><span class="linenos">2602</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">brine_closures</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_threshold_volumes</span><span class="p">(</span><span class="n">brine_closures</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
</span><span id="Intersect3D-2603"><a href="#-2603"><span class="linenos">2603</span></a>
</span><span id="Intersect3D-2604"><a href="#-2604"><span class="linenos">2604</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">wide_faults</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Intersect3D-2605"><a href="#-2605"><span class="linenos">2605</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fat_faults</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Intersect3D-2606"><a href="#-2606"><span class="linenos">2606</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">onlaps_upward</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Intersect3D-2607"><a href="#-2607"><span class="linenos">2607</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">onlaps_downward</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Intersect3D-2608"><a href="#-2608"><span class="linenos">2608</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dilate_faults_and_onlaps</span><span class="p">()</span>
</span><span id="Intersect3D-2609"><a href="#-2609"><span class="linenos">2609</span></a>
</span><span id="Intersect3D-2610"><a href="#-2610"><span class="linenos">2610</span></a>        <span class="c1"># Outputs</span>
</span><span id="Intersect3D-2611"><a href="#-2611"><span class="linenos">2611</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">faulted_closures_oil</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">oil_closures</span><span class="p">)</span>
</span><span id="Intersect3D-2612"><a href="#-2612"><span class="linenos">2612</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">faulted_closures_gas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gas_closures</span><span class="p">)</span>
</span><span id="Intersect3D-2613"><a href="#-2613"><span class="linenos">2613</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">faulted_closures_brine</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">brine_closures</span><span class="p">)</span>
</span><span id="Intersect3D-2614"><a href="#-2614"><span class="linenos">2614</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fault_closures_oil_segment_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
</span><span id="Intersect3D-2615"><a href="#-2615"><span class="linenos">2615</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fault_closures_gas_segment_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
</span><span id="Intersect3D-2616"><a href="#-2616"><span class="linenos">2616</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fault_closures_brine_segment_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
</span><span id="Intersect3D-2617"><a href="#-2617"><span class="linenos">2617</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_fault_closures_oil</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Intersect3D-2618"><a href="#-2618"><span class="linenos">2618</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_fault_closures_gas</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Intersect3D-2619"><a href="#-2619"><span class="linenos">2619</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_fault_closures_brine</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Intersect3D-2620"><a href="#-2620"><span class="linenos">2620</span></a>
</span><span id="Intersect3D-2621"><a href="#-2621"><span class="linenos">2621</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">onlap_closures_oil</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">oil_closures</span><span class="p">)</span>
</span><span id="Intersect3D-2622"><a href="#-2622"><span class="linenos">2622</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">onlap_closures_gas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gas_closures</span><span class="p">)</span>
</span><span id="Intersect3D-2623"><a href="#-2623"><span class="linenos">2623</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">onlap_closures_brine</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">brine_closures</span><span class="p">)</span>
</span><span id="Intersect3D-2624"><a href="#-2624"><span class="linenos">2624</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">onlap_closures_oil_segment_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
</span><span id="Intersect3D-2625"><a href="#-2625"><span class="linenos">2625</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">onlap_closures_gas_segment_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
</span><span id="Intersect3D-2626"><a href="#-2626"><span class="linenos">2626</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">onlap_closures_brine_segment_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
</span><span id="Intersect3D-2627"><a href="#-2627"><span class="linenos">2627</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_onlap_closures_oil</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Intersect3D-2628"><a href="#-2628"><span class="linenos">2628</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_onlap_closures_gas</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Intersect3D-2629"><a href="#-2629"><span class="linenos">2629</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_onlap_closures_brine</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Intersect3D-2630"><a href="#-2630"><span class="linenos">2630</span></a>
</span><span id="Intersect3D-2631"><a href="#-2631"><span class="linenos">2631</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">simple_closures_oil</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">oil_closures</span><span class="p">)</span>
</span><span id="Intersect3D-2632"><a href="#-2632"><span class="linenos">2632</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">simple_closures_gas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gas_closures</span><span class="p">)</span>
</span><span id="Intersect3D-2633"><a href="#-2633"><span class="linenos">2633</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">simple_closures_brine</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">brine_closures</span><span class="p">)</span>
</span><span id="Intersect3D-2634"><a href="#-2634"><span class="linenos">2634</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_4way_closures_oil</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Intersect3D-2635"><a href="#-2635"><span class="linenos">2635</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_4way_closures_gas</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Intersect3D-2636"><a href="#-2636"><span class="linenos">2636</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_4way_closures_brine</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Intersect3D-2637"><a href="#-2637"><span class="linenos">2637</span></a>
</span><span id="Intersect3D-2638"><a href="#-2638"><span class="linenos">2638</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">false_closures_oil</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">oil_closures</span><span class="p">)</span>
</span><span id="Intersect3D-2639"><a href="#-2639"><span class="linenos">2639</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">false_closures_gas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gas_closures</span><span class="p">)</span>
</span><span id="Intersect3D-2640"><a href="#-2640"><span class="linenos">2640</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">false_closures_brine</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">brine_closures</span><span class="p">)</span>
</span><span id="Intersect3D-2641"><a href="#-2641"><span class="linenos">2641</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_false_closures_oil</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Intersect3D-2642"><a href="#-2642"><span class="linenos">2642</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_false_closures_gas</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Intersect3D-2643"><a href="#-2643"><span class="linenos">2643</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_false_closures_brine</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Intersect3D-2644"><a href="#-2644"><span class="linenos">2644</span></a>
</span><span id="Intersect3D-2645"><a href="#-2645"><span class="linenos">2645</span></a>    <span class="k">def</span> <span class="nf">find_faulted_closures</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Intersect3D-2646"><a href="#-2646"><span class="linenos">2646</span></a>        <span class="k">for</span> <span class="n">iclosure</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">closure_segment_list</span><span class="p">:</span>
</span><span id="Intersect3D-2647"><a href="#-2647"><span class="linenos">2647</span></a>            <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">closure_segments</span> <span class="o">==</span> <span class="n">iclosure</span><span class="p">)</span>
</span><span id="Intersect3D-2648"><a href="#-2648"><span class="linenos">2648</span></a>            <span class="n">faults_within_closure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wide_faults</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span>
</span><span id="Intersect3D-2649"><a href="#-2649"><span class="linenos">2649</span></a>            <span class="k">if</span> <span class="n">faults_within_closure</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Intersect3D-2650"><a href="#-2650"><span class="linenos">2650</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">oil_closures</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Intersect3D-2651"><a href="#-2651"><span class="linenos">2651</span></a>                    <span class="c1"># Faulted oil closure</span>
</span><span id="Intersect3D-2652"><a href="#-2652"><span class="linenos">2652</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">faulted_closures_oil</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="Intersect3D-2653"><a href="#-2653"><span class="linenos">2653</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">n_fault_closures_oil</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="Intersect3D-2654"><a href="#-2654"><span class="linenos">2654</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">fault_closures_oil_segment_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">iclosure</span><span class="p">)</span>
</span><span id="Intersect3D-2655"><a href="#-2655"><span class="linenos">2655</span></a>                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">gas_closures</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Intersect3D-2656"><a href="#-2656"><span class="linenos">2656</span></a>                    <span class="c1"># Faulted gas closure</span>
</span><span id="Intersect3D-2657"><a href="#-2657"><span class="linenos">2657</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">faulted_closures_gas</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="Intersect3D-2658"><a href="#-2658"><span class="linenos">2658</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">n_fault_closures_gas</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="Intersect3D-2659"><a href="#-2659"><span class="linenos">2659</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">fault_closures_gas_segment_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">iclosure</span><span class="p">)</span>
</span><span id="Intersect3D-2660"><a href="#-2660"><span class="linenos">2660</span></a>                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">brine_closures</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Intersect3D-2661"><a href="#-2661"><span class="linenos">2661</span></a>                    <span class="c1"># Faulted brine closure</span>
</span><span id="Intersect3D-2662"><a href="#-2662"><span class="linenos">2662</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">faulted_closures_brine</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="Intersect3D-2663"><a href="#-2663"><span class="linenos">2663</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">n_fault_closures_brine</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="Intersect3D-2664"><a href="#-2664"><span class="linenos">2664</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">fault_closures_brine_segment_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">iclosure</span><span class="p">)</span>
</span><span id="Intersect3D-2665"><a href="#-2665"><span class="linenos">2665</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Intersect3D-2666"><a href="#-2666"><span class="linenos">2666</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="Intersect3D-2667"><a href="#-2667"><span class="linenos">2667</span></a>                        <span class="s2">&quot;Closure is faulted but does not have oil, gas or brine assigned&quot;</span>
</span><span id="Intersect3D-2668"><a href="#-2668"><span class="linenos">2668</span></a>                    <span class="p">)</span>
</span><span id="Intersect3D-2669"><a href="#-2669"><span class="linenos">2669</span></a>
</span><span id="Intersect3D-2670"><a href="#-2670"><span class="linenos">2670</span></a>    <span class="k">def</span> <span class="nf">find_onlap_closures</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Intersect3D-2671"><a href="#-2671"><span class="linenos">2671</span></a>        <span class="k">for</span> <span class="n">iclosure</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">closure_segment_list</span><span class="p">:</span>
</span><span id="Intersect3D-2672"><a href="#-2672"><span class="linenos">2672</span></a>            <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">closure_segments</span> <span class="o">==</span> <span class="n">iclosure</span><span class="p">)</span>
</span><span id="Intersect3D-2673"><a href="#-2673"><span class="linenos">2673</span></a>            <span class="n">onlaps_within_closure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">onlaps_upward</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span>
</span><span id="Intersect3D-2674"><a href="#-2674"><span class="linenos">2674</span></a>            <span class="k">if</span> <span class="n">onlaps_within_closure</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Intersect3D-2675"><a href="#-2675"><span class="linenos">2675</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">oil_closures</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Intersect3D-2676"><a href="#-2676"><span class="linenos">2676</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">onlap_closures_oil</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="Intersect3D-2677"><a href="#-2677"><span class="linenos">2677</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">n_onlap_closures_oil</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="Intersect3D-2678"><a href="#-2678"><span class="linenos">2678</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">onlap_closures_oil_segment_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">iclosure</span><span class="p">)</span>
</span><span id="Intersect3D-2679"><a href="#-2679"><span class="linenos">2679</span></a>                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">gas_closures</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Intersect3D-2680"><a href="#-2680"><span class="linenos">2680</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">onlap_closures_gas</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="Intersect3D-2681"><a href="#-2681"><span class="linenos">2681</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">n_onlap_closures_gas</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="Intersect3D-2682"><a href="#-2682"><span class="linenos">2682</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">onlap_closures_gas_segment_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">iclosure</span><span class="p">)</span>
</span><span id="Intersect3D-2683"><a href="#-2683"><span class="linenos">2683</span></a>                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">brine_closures</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Intersect3D-2684"><a href="#-2684"><span class="linenos">2684</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">onlap_closures_brine</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="Intersect3D-2685"><a href="#-2685"><span class="linenos">2685</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">n_onlap_closures_brine</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="Intersect3D-2686"><a href="#-2686"><span class="linenos">2686</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">onlap_closures_brine_segment_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">iclosure</span><span class="p">)</span>
</span><span id="Intersect3D-2687"><a href="#-2687"><span class="linenos">2687</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Intersect3D-2688"><a href="#-2688"><span class="linenos">2688</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="Intersect3D-2689"><a href="#-2689"><span class="linenos">2689</span></a>                        <span class="s2">&quot;Closure is onlap but does not have oil, gas or brine assigned&quot;</span>
</span><span id="Intersect3D-2690"><a href="#-2690"><span class="linenos">2690</span></a>                    <span class="p">)</span>
</span><span id="Intersect3D-2691"><a href="#-2691"><span class="linenos">2691</span></a>
</span><span id="Intersect3D-2692"><a href="#-2692"><span class="linenos">2692</span></a>    <span class="k">def</span> <span class="nf">find_simple_closures</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Intersect3D-2693"><a href="#-2693"><span class="linenos">2693</span></a>        <span class="k">for</span> <span class="n">iclosure</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">closure_segment_list</span><span class="p">:</span>
</span><span id="Intersect3D-2694"><a href="#-2694"><span class="linenos">2694</span></a>            <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">closure_segments</span> <span class="o">==</span> <span class="n">iclosure</span><span class="p">)</span>
</span><span id="Intersect3D-2695"><a href="#-2695"><span class="linenos">2695</span></a>            <span class="n">faults_within_closure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wide_faults</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span>
</span><span id="Intersect3D-2696"><a href="#-2696"><span class="linenos">2696</span></a>            <span class="n">onlaps_within_closure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">onlaps</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span>
</span><span id="Intersect3D-2697"><a href="#-2697"><span class="linenos">2697</span></a>            <span class="n">oil_within_closure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">oil_closures</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span>
</span><span id="Intersect3D-2698"><a href="#-2698"><span class="linenos">2698</span></a>            <span class="n">gas_within_closure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gas_closures</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span>
</span><span id="Intersect3D-2699"><a href="#-2699"><span class="linenos">2699</span></a>            <span class="n">brine_within_closure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">brine_closures</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span>
</span><span id="Intersect3D-2700"><a href="#-2700"><span class="linenos">2700</span></a>            <span class="k">if</span> <span class="n">faults_within_closure</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">onlaps_within_closure</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Intersect3D-2701"><a href="#-2701"><span class="linenos">2701</span></a>                <span class="k">if</span> <span class="n">oil_within_closure</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Intersect3D-2702"><a href="#-2702"><span class="linenos">2702</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">simple_closures_oil</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="Intersect3D-2703"><a href="#-2703"><span class="linenos">2703</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">n_4way_closures_oil</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="Intersect3D-2704"><a href="#-2704"><span class="linenos">2704</span></a>                <span class="k">elif</span> <span class="n">gas_within_closure</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Intersect3D-2705"><a href="#-2705"><span class="linenos">2705</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">simple_closures_gas</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="Intersect3D-2706"><a href="#-2706"><span class="linenos">2706</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">n_4way_closures_gas</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="Intersect3D-2707"><a href="#-2707"><span class="linenos">2707</span></a>                <span class="k">elif</span> <span class="n">brine_within_closure</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Intersect3D-2708"><a href="#-2708"><span class="linenos">2708</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">simple_closures_brine</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="Intersect3D-2709"><a href="#-2709"><span class="linenos">2709</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">n_4way_closures_brine</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="Intersect3D-2710"><a href="#-2710"><span class="linenos">2710</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Intersect3D-2711"><a href="#-2711"><span class="linenos">2711</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="Intersect3D-2712"><a href="#-2712"><span class="linenos">2712</span></a>                        <span class="s2">&quot;Closure is not faulted or onlap but does not have oil, gas or brine assigned&quot;</span>
</span><span id="Intersect3D-2713"><a href="#-2713"><span class="linenos">2713</span></a>                    <span class="p">)</span>
</span><span id="Intersect3D-2714"><a href="#-2714"><span class="linenos">2714</span></a>
</span><span id="Intersect3D-2715"><a href="#-2715"><span class="linenos">2715</span></a>    <span class="k">def</span> <span class="nf">find_false_closures</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Intersect3D-2716"><a href="#-2716"><span class="linenos">2716</span></a>        <span class="k">for</span> <span class="n">iclosure</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">closure_segment_list</span><span class="p">:</span>
</span><span id="Intersect3D-2717"><a href="#-2717"><span class="linenos">2717</span></a>            <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">closure_segments</span> <span class="o">==</span> <span class="n">iclosure</span><span class="p">)</span>
</span><span id="Intersect3D-2718"><a href="#-2718"><span class="linenos">2718</span></a>            <span class="n">faults_within_closure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fat_faults</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span>
</span><span id="Intersect3D-2719"><a href="#-2719"><span class="linenos">2719</span></a>            <span class="n">onlaps_within_closure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">onlaps_downward</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span>
</span><span id="Intersect3D-2720"><a href="#-2720"><span class="linenos">2720</span></a>            <span class="k">for</span> <span class="n">fluid</span><span class="p">,</span> <span class="n">false</span><span class="p">,</span> <span class="n">num</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
</span><span id="Intersect3D-2721"><a href="#-2721"><span class="linenos">2721</span></a>                <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">oil_closures</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gas_closures</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">brine_closures</span><span class="p">],</span>
</span><span id="Intersect3D-2722"><a href="#-2722"><span class="linenos">2722</span></a>                <span class="p">[</span>
</span><span id="Intersect3D-2723"><a href="#-2723"><span class="linenos">2723</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">false_closures_oil</span><span class="p">,</span>
</span><span id="Intersect3D-2724"><a href="#-2724"><span class="linenos">2724</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">false_closures_gas</span><span class="p">,</span>
</span><span id="Intersect3D-2725"><a href="#-2725"><span class="linenos">2725</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">false_closures_brine</span><span class="p">,</span>
</span><span id="Intersect3D-2726"><a href="#-2726"><span class="linenos">2726</span></a>                <span class="p">],</span>
</span><span id="Intersect3D-2727"><a href="#-2727"><span class="linenos">2727</span></a>                <span class="p">[</span>
</span><span id="Intersect3D-2728"><a href="#-2728"><span class="linenos">2728</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">n_false_closures_oil</span><span class="p">,</span>
</span><span id="Intersect3D-2729"><a href="#-2729"><span class="linenos">2729</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">n_false_closures_gas</span><span class="p">,</span>
</span><span id="Intersect3D-2730"><a href="#-2730"><span class="linenos">2730</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">n_false_closures_brine</span><span class="p">,</span>
</span><span id="Intersect3D-2731"><a href="#-2731"><span class="linenos">2731</span></a>                <span class="p">],</span>
</span><span id="Intersect3D-2732"><a href="#-2732"><span class="linenos">2732</span></a>            <span class="p">):</span>
</span><span id="Intersect3D-2733"><a href="#-2733"><span class="linenos">2733</span></a>                <span class="n">fluid_within_closure</span> <span class="o">=</span> <span class="n">fluid</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span>
</span><span id="Intersect3D-2734"><a href="#-2734"><span class="linenos">2734</span></a>                <span class="k">if</span> <span class="n">fluid_within_closure</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Intersect3D-2735"><a href="#-2735"><span class="linenos">2735</span></a>                    <span class="k">if</span> <span class="n">onlaps_within_closure</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Intersect3D-2736"><a href="#-2736"><span class="linenos">2736</span></a>                        <span class="n">_faulted_closure_threshold</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span>
</span><span id="Intersect3D-2737"><a href="#-2737"><span class="linenos">2737</span></a>                            <span class="n">faults_within_closure</span><span class="p">[</span><span class="n">faults_within_closure</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="Intersect3D-2738"><a href="#-2738"><span class="linenos">2738</span></a>                            <span class="o">/</span> <span class="n">fluid_within_closure</span><span class="p">[</span><span class="n">fluid_within_closure</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="Intersect3D-2739"><a href="#-2739"><span class="linenos">2739</span></a>                        <span class="p">)</span>
</span><span id="Intersect3D-2740"><a href="#-2740"><span class="linenos">2740</span></a>                        <span class="n">_onlap_closure_threshold</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span>
</span><span id="Intersect3D-2741"><a href="#-2741"><span class="linenos">2741</span></a>                            <span class="n">onlaps_within_closure</span><span class="p">[</span><span class="n">onlaps_within_closure</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="Intersect3D-2742"><a href="#-2742"><span class="linenos">2742</span></a>                            <span class="o">/</span> <span class="n">fluid_within_closure</span><span class="p">[</span><span class="n">fluid_within_closure</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="Intersect3D-2743"><a href="#-2743"><span class="linenos">2743</span></a>                        <span class="p">)</span>
</span><span id="Intersect3D-2744"><a href="#-2744"><span class="linenos">2744</span></a>                        <span class="k">if</span> <span class="p">(</span>
</span><span id="Intersect3D-2745"><a href="#-2745"><span class="linenos">2745</span></a>                            <span class="n">_faulted_closure_threshold</span> <span class="o">&gt;</span> <span class="mf">0.65</span>
</span><span id="Intersect3D-2746"><a href="#-2746"><span class="linenos">2746</span></a>                            <span class="ow">and</span> <span class="n">_onlap_closure_threshold</span> <span class="o">&gt;</span> <span class="mf">0.65</span>
</span><span id="Intersect3D-2747"><a href="#-2747"><span class="linenos">2747</span></a>                        <span class="p">):</span>
</span><span id="Intersect3D-2748"><a href="#-2748"><span class="linenos">2748</span></a>                            <span class="n">false</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="Intersect3D-2749"><a href="#-2749"><span class="linenos">2749</span></a>                            <span class="n">num</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="Intersect3D-2750"><a href="#-2750"><span class="linenos">2750</span></a>
</span><span id="Intersect3D-2751"><a href="#-2751"><span class="linenos">2751</span></a>    <span class="k">def</span> <span class="nf">grow_to_fault2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">closures</span><span class="p">):</span>
</span><span id="Intersect3D-2752"><a href="#-2752"><span class="linenos">2752</span></a>        <span class="c1"># - grow closures laterally and up within layer and within fault block</span>
</span><span id="Intersect3D-2753"><a href="#-2753"><span class="linenos">2753</span></a>        <span class="nb">print</span><span class="p">(</span>
</span><span id="Intersect3D-2754"><a href="#-2754"><span class="linenos">2754</span></a>            <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2"> ... grow_to_fault2: grow closures laterally and up within layer and within fault block ...&quot;</span>
</span><span id="Intersect3D-2755"><a href="#-2755"><span class="linenos">2755</span></a>        <span class="p">)</span>
</span><span id="Intersect3D-2756"><a href="#-2756"><span class="linenos">2756</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span><span class="s2">&quot;growing closures to fault plane: grow_to_fault2&quot;</span><span class="p">)</span>
</span><span id="Intersect3D-2757"><a href="#-2757"><span class="linenos">2757</span></a>
</span><span id="Intersect3D-2758"><a href="#-2758"><span class="linenos">2758</span></a>        <span class="n">dilated_fault_closures</span> <span class="o">=</span> <span class="n">closures</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Intersect3D-2759"><a href="#-2759"><span class="linenos">2759</span></a>        <span class="n">n_faulted_closures</span> <span class="o">=</span> <span class="n">dilated_fault_closures</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</span><span id="Intersect3D-2760"><a href="#-2760"><span class="linenos">2760</span></a>        <span class="n">labels_clean</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">closure_segments</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Intersect3D-2761"><a href="#-2761"><span class="linenos">2761</span></a>        <span class="n">labels_clean</span><span class="p">[</span><span class="n">closures</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Intersect3D-2762"><a href="#-2762"><span class="linenos">2762</span></a>        <span class="n">labels_clean_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">labels_clean</span><span class="o">.</span><span class="n">flatten</span><span class="p">()))</span>
</span><span id="Intersect3D-2763"><a href="#-2763"><span class="linenos">2763</span></a>        <span class="n">labels_clean_list</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="Intersect3D-2764"><a href="#-2764"><span class="linenos">2764</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">    ... grow_to_fault2: n_faulted_closures = &quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">labels_clean_list</span><span class="p">))</span>
</span><span id="Intersect3D-2765"><a href="#-2765"><span class="linenos">2765</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    ... grow_to_fault2: faulted_closures = &quot;</span><span class="p">,</span> <span class="n">labels_clean_list</span><span class="p">)</span>
</span><span id="Intersect3D-2766"><a href="#-2766"><span class="linenos">2766</span></a>
</span><span id="Intersect3D-2767"><a href="#-2767"><span class="linenos">2767</span></a>        <span class="c1"># fixme remove this once small closures are found and fixed</span>
</span><span id="Intersect3D-2768"><a href="#-2768"><span class="linenos">2768</span></a>        <span class="n">voxel_sizes</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="Intersect3D-2769"><a href="#-2769"><span class="linenos">2769</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">closure_segments</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">closure_segments</span> <span class="o">==</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="Intersect3D-2770"><a href="#-2770"><span class="linenos">2770</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">labels_clean_list</span>
</span><span id="Intersect3D-2771"><a href="#-2771"><span class="linenos">2771</span></a>        <span class="p">]</span>
</span><span id="Intersect3D-2772"><a href="#-2772"><span class="linenos">2772</span></a>        <span class="k">for</span> <span class="n">_v</span> <span class="ow">in</span> <span class="n">voxel_sizes</span><span class="p">:</span>
</span><span id="Intersect3D-2773"><a href="#-2773"><span class="linenos">2773</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Voxel_Sizes: </span><span class="si">{</span><span class="n">_v</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Intersect3D-2774"><a href="#-2774"><span class="linenos">2774</span></a>            <span class="k">if</span> <span class="n">_v</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">closure_min_voxels</span><span class="p">:</span>
</span><span id="Intersect3D-2775"><a href="#-2775"><span class="linenos">2775</span></a>                <span class="nb">print</span><span class="p">(</span><span class="n">_v</span><span class="p">)</span>
</span><span id="Intersect3D-2776"><a href="#-2776"><span class="linenos">2776</span></a>
</span><span id="Intersect3D-2777"><a href="#-2777"><span class="linenos">2777</span></a>        <span class="n">depth_cube</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">geologic_age</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span>
</span><span id="Intersect3D-2778"><a href="#-2778"><span class="linenos">2778</span></a>        <span class="n">_depths</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">geologic_age</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</span><span id="Intersect3D-2779"><a href="#-2779"><span class="linenos">2779</span></a>        <span class="n">depth_cube</span> <span class="o">+=</span> <span class="n">_depths</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">geologic_age</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</span><span id="Intersect3D-2780"><a href="#-2780"><span class="linenos">2780</span></a>        <span class="n">_ng</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">geomodel_ng</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Intersect3D-2781"><a href="#-2781"><span class="linenos">2781</span></a>        <span class="n">_age</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">geologic_age</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Intersect3D-2782"><a href="#-2782"><span class="linenos">2782</span></a>
</span><span id="Intersect3D-2783"><a href="#-2783"><span class="linenos">2783</span></a>        <span class="k">for</span> <span class="n">il</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">labels_clean_list</span><span class="p">):</span>
</span><span id="Intersect3D-2784"><a href="#-2784"><span class="linenos">2784</span></a>            <span class="n">fault_blocks_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fault_throw</span><span class="p">[</span><span class="n">labels_clean</span> <span class="o">==</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()))</span>
</span><span id="Intersect3D-2785"><a href="#-2785"><span class="linenos">2785</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    ... grow_to_fault2: fault_blocks_list = &quot;</span><span class="p">,</span> <span class="n">fault_blocks_list</span><span class="p">)</span>
</span><span id="Intersect3D-2786"><a href="#-2786"><span class="linenos">2786</span></a>            <span class="k">for</span> <span class="n">jl</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">fault_blocks_list</span><span class="p">):</span>
</span><span id="Intersect3D-2787"><a href="#-2787"><span class="linenos">2787</span></a>                <span class="nb">print</span><span class="p">(</span>
</span><span id="Intersect3D-2788"><a href="#-2788"><span class="linenos">2788</span></a>                    <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">    ... label, throw = &quot;</span><span class="p">,</span>
</span><span id="Intersect3D-2789"><a href="#-2789"><span class="linenos">2789</span></a>                    <span class="n">i</span><span class="p">,</span>
</span><span id="Intersect3D-2790"><a href="#-2790"><span class="linenos">2790</span></a>                    <span class="n">j</span><span class="p">,</span>
</span><span id="Intersect3D-2791"><a href="#-2791"><span class="linenos">2791</span></a>                    <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fault_throw</span><span class="p">[</span><span class="n">labels_clean</span> <span class="o">==</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">())),</span>
</span><span id="Intersect3D-2792"><a href="#-2792"><span class="linenos">2792</span></a>                    <span class="n">labels_clean</span><span class="p">[</span><span class="n">labels_clean</span> <span class="o">==</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">,</span>
</span><span id="Intersect3D-2793"><a href="#-2793"><span class="linenos">2793</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">fault_throw</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fault_throw</span> <span class="o">==</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">,</span>
</span><span id="Intersect3D-2794"><a href="#-2794"><span class="linenos">2794</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">fault_throw</span><span class="p">[</span>
</span><span id="Intersect3D-2795"><a href="#-2795"><span class="linenos">2795</span></a>                        <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">labels_clean</span> <span class="o">==</span> <span class="n">i</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fault_throw</span> <span class="o">==</span> <span class="n">j</span><span class="p">))</span>
</span><span id="Intersect3D-2796"><a href="#-2796"><span class="linenos">2796</span></a>                    <span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">,</span>
</span><span id="Intersect3D-2797"><a href="#-2797"><span class="linenos">2797</span></a>                <span class="p">)</span>
</span><span id="Intersect3D-2798"><a href="#-2798"><span class="linenos">2798</span></a>                <span class="n">single_closure</span> <span class="o">=</span> <span class="n">labels_clean</span> <span class="o">*</span> <span class="mf">0.0</span>
</span><span id="Intersect3D-2799"><a href="#-2799"><span class="linenos">2799</span></a>                <span class="n">size</span> <span class="o">=</span> <span class="n">single_closure</span><span class="p">[</span>
</span><span id="Intersect3D-2800"><a href="#-2800"><span class="linenos">2800</span></a>                    <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
</span><span id="Intersect3D-2801"><a href="#-2801"><span class="linenos">2801</span></a>                        <span class="p">(</span><span class="n">labels_clean</span> <span class="o">==</span> <span class="n">i</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fault_throw</span> <span class="o">-</span> <span class="n">j</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.25</span><span class="p">)</span>
</span><span id="Intersect3D-2802"><a href="#-2802"><span class="linenos">2802</span></a>                    <span class="p">)</span>
</span><span id="Intersect3D-2803"><a href="#-2803"><span class="linenos">2803</span></a>                <span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="Intersect3D-2804"><a href="#-2804"><span class="linenos">2804</span></a>                <span class="k">if</span> <span class="n">size</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">closure_min_voxels</span><span class="p">:</span>
</span><span id="Intersect3D-2805"><a href="#-2805"><span class="linenos">2805</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Label: </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">, fault_block: </span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s2">, Voxel_Count: </span><span class="si">{</span><span class="n">size</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Intersect3D-2806"><a href="#-2806"><span class="linenos">2806</span></a>                    <span class="n">single_closure</span><span class="p">[</span>
</span><span id="Intersect3D-2807"><a href="#-2807"><span class="linenos">2807</span></a>                        <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
</span><span id="Intersect3D-2808"><a href="#-2808"><span class="linenos">2808</span></a>                            <span class="p">(</span><span class="n">labels_clean</span> <span class="o">==</span> <span class="n">i</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fault_throw</span> <span class="o">-</span> <span class="n">j</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.25</span><span class="p">)</span>
</span><span id="Intersect3D-2809"><a href="#-2809"><span class="linenos">2809</span></a>                        <span class="p">)</span>
</span><span id="Intersect3D-2810"><a href="#-2810"><span class="linenos">2810</span></a>                    <span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="Intersect3D-2811"><a href="#-2811"><span class="linenos">2811</span></a>                <span class="k">if</span> <span class="n">single_closure</span><span class="p">[</span><span class="n">single_closure</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Intersect3D-2812"><a href="#-2812"><span class="linenos">2812</span></a>                    <span class="c1"># labels_clean[np.where((labels_clean == i) &amp; (np.abs(self.fault_throw - j) &lt; .25))] = 0</span>
</span><span id="Intersect3D-2813"><a href="#-2813"><span class="linenos">2813</span></a>                    <span class="n">labels_clean</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">labels_clean</span> <span class="o">==</span> <span class="n">i</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Intersect3D-2814"><a href="#-2814"><span class="linenos">2814</span></a>                    <span class="k">continue</span>
</span><span id="Intersect3D-2815"><a href="#-2815"><span class="linenos">2815</span></a>                <span class="n">avg_ng</span> <span class="o">=</span> <span class="n">_ng</span><span class="p">[</span><span class="n">single_closure</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</span><span id="Intersect3D-2816"><a href="#-2816"><span class="linenos">2816</span></a>                <span class="n">_geo_age_voxels</span> <span class="o">=</span> <span class="p">(</span><span class="n">_age</span><span class="p">[</span><span class="n">single_closure</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;int&quot;</span><span class="p">)</span>
</span><span id="Intersect3D-2817"><a href="#-2817"><span class="linenos">2817</span></a>                <span class="n">_ng_voxels</span> <span class="o">=</span> <span class="n">_ng</span><span class="p">[</span><span class="n">single_closure</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="Intersect3D-2818"><a href="#-2818"><span class="linenos">2818</span></a>                <span class="n">_geo_age_voxels</span> <span class="o">=</span> <span class="n">_geo_age_voxels</span><span class="p">[</span><span class="n">_ng_voxels</span> <span class="o">&gt;=</span> <span class="n">avg_ng</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">]</span>
</span><span id="Intersect3D-2819"><a href="#-2819"><span class="linenos">2819</span></a>                <span class="n">min_geo_age</span> <span class="o">=</span> <span class="n">_geo_age_voxels</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">-</span> <span class="mf">0.5</span>
</span><span id="Intersect3D-2820"><a href="#-2820"><span class="linenos">2820</span></a>                <span class="n">avg_geo_age</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">_geo_age_voxels</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
</span><span id="Intersect3D-2821"><a href="#-2821"><span class="linenos">2821</span></a>                <span class="n">max_geo_age</span> <span class="o">=</span> <span class="n">_geo_age_voxels</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="mf">0.5</span>
</span><span id="Intersect3D-2822"><a href="#-2822"><span class="linenos">2822</span></a>                <span class="n">_depth_geobody_voxels</span> <span class="o">=</span> <span class="n">depth_cube</span><span class="p">[</span><span class="n">single_closure</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="Intersect3D-2823"><a href="#-2823"><span class="linenos">2823</span></a>                <span class="n">min_depth</span> <span class="o">=</span> <span class="n">_depth_geobody_voxels</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
</span><span id="Intersect3D-2824"><a href="#-2824"><span class="linenos">2824</span></a>                <span class="n">max_depth</span> <span class="o">=</span> <span class="n">_depth_geobody_voxels</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</span><span id="Intersect3D-2825"><a href="#-2825"><span class="linenos">2825</span></a>                <span class="n">avg_throw</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fault_throw</span><span class="p">[</span><span class="n">single_closure</span> <span class="o">==</span> <span class="mi">1</span><span class="p">])</span>
</span><span id="Intersect3D-2826"><a href="#-2826"><span class="linenos">2826</span></a>
</span><span id="Intersect3D-2827"><a href="#-2827"><span class="linenos">2827</span></a>                <span class="n">closure_boundary_cube</span> <span class="o">=</span> <span class="n">closures</span> <span class="o">*</span> <span class="mf">0.0</span>
</span><span id="Intersect3D-2828"><a href="#-2828"><span class="linenos">2828</span></a>                <span class="n">closure_boundary_cube</span><span class="p">[</span>
</span><span id="Intersect3D-2829"><a href="#-2829"><span class="linenos">2829</span></a>                    <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
</span><span id="Intersect3D-2830"><a href="#-2830"><span class="linenos">2830</span></a>                        <span class="p">(</span><span class="n">_ng</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">)</span>
</span><span id="Intersect3D-2831"><a href="#-2831"><span class="linenos">2831</span></a>                        <span class="o">&amp;</span> <span class="p">(</span><span class="n">_age</span> <span class="o">&gt;</span> <span class="n">min_geo_age</span><span class="p">)</span>
</span><span id="Intersect3D-2832"><a href="#-2832"><span class="linenos">2832</span></a>                        <span class="o">&amp;</span> <span class="p">(</span><span class="n">_age</span> <span class="o">&lt;</span> <span class="n">max_geo_age</span><span class="p">)</span>
</span><span id="Intersect3D-2833"><a href="#-2833"><span class="linenos">2833</span></a>                        <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fault_throw</span> <span class="o">==</span> <span class="n">avg_throw</span><span class="p">)</span>
</span><span id="Intersect3D-2834"><a href="#-2834"><span class="linenos">2834</span></a>                        <span class="o">&amp;</span> <span class="p">(</span><span class="n">depth_cube</span> <span class="o">&lt;=</span> <span class="n">max_depth</span><span class="p">)</span>
</span><span id="Intersect3D-2835"><a href="#-2835"><span class="linenos">2835</span></a>                    <span class="p">)</span>
</span><span id="Intersect3D-2836"><a href="#-2836"><span class="linenos">2836</span></a>                <span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="Intersect3D-2837"><a href="#-2837"><span class="linenos">2837</span></a>                <span class="nb">print</span><span class="p">(</span>
</span><span id="Intersect3D-2838"><a href="#-2838"><span class="linenos">2838</span></a>                    <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">    ... grow_to_fault2: closure_boundary_cube voxels = &quot;</span><span class="p">,</span>
</span><span id="Intersect3D-2839"><a href="#-2839"><span class="linenos">2839</span></a>                    <span class="n">closure_boundary_cube</span><span class="p">[</span><span class="n">closure_boundary_cube</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">,</span>
</span><span id="Intersect3D-2840"><a href="#-2840"><span class="linenos">2840</span></a>                <span class="p">)</span>
</span><span id="Intersect3D-2841"><a href="#-2841"><span class="linenos">2841</span></a>
</span><span id="Intersect3D-2842"><a href="#-2842"><span class="linenos">2842</span></a>                <span class="n">n_voxel</span> <span class="o">=</span> <span class="n">single_closure</span><span class="p">[</span><span class="n">single_closure</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="Intersect3D-2843"><a href="#-2843"><span class="linenos">2843</span></a>
</span><span id="Intersect3D-2844"><a href="#-2844"><span class="linenos">2844</span></a>                <span class="n">original_voxels</span> <span class="o">=</span> <span class="n">n_voxel</span> <span class="o">+</span> <span class="mi">0</span>
</span><span id="Intersect3D-2845"><a href="#-2845"><span class="linenos">2845</span></a>                <span class="nb">print</span><span class="p">(</span>
</span><span id="Intersect3D-2846"><a href="#-2846"><span class="linenos">2846</span></a>                    <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">    ... closure label number, avg_throw, geobody shape, geo_age min/mean/max, depth min/max, avg_ng = &quot;</span><span class="p">,</span>
</span><span id="Intersect3D-2847"><a href="#-2847"><span class="linenos">2847</span></a>                    <span class="n">i</span><span class="p">,</span>
</span><span id="Intersect3D-2848"><a href="#-2848"><span class="linenos">2848</span></a>                    <span class="n">j</span><span class="p">,</span>
</span><span id="Intersect3D-2849"><a href="#-2849"><span class="linenos">2849</span></a>                    <span class="n">n_voxel</span><span class="p">,</span>
</span><span id="Intersect3D-2850"><a href="#-2850"><span class="linenos">2850</span></a>                    <span class="p">(</span><span class="n">min_geo_age</span><span class="p">,</span> <span class="n">avg_geo_age</span><span class="p">,</span> <span class="n">max_geo_age</span><span class="p">),</span>
</span><span id="Intersect3D-2851"><a href="#-2851"><span class="linenos">2851</span></a>                    <span class="p">(</span><span class="n">min_depth</span><span class="p">,</span> <span class="n">max_depth</span><span class="p">),</span>
</span><span id="Intersect3D-2852"><a href="#-2852"><span class="linenos">2852</span></a>                    <span class="n">avg_ng</span><span class="p">,</span>
</span><span id="Intersect3D-2853"><a href="#-2853"><span class="linenos">2853</span></a>                    <span class="n">il</span><span class="p">,</span>
</span><span id="Intersect3D-2854"><a href="#-2854"><span class="linenos">2854</span></a>                    <span class="s2">&quot; / &quot;</span><span class="p">,</span>
</span><span id="Intersect3D-2855"><a href="#-2855"><span class="linenos">2855</span></a>                    <span class="nb">len</span><span class="p">(</span><span class="n">labels_clean_list</span><span class="p">),</span>
</span><span id="Intersect3D-2856"><a href="#-2856"><span class="linenos">2856</span></a>                <span class="p">)</span>
</span><span id="Intersect3D-2857"><a href="#-2857"><span class="linenos">2857</span></a>
</span><span id="Intersect3D-2858"><a href="#-2858"><span class="linenos">2858</span></a>                <span class="n">grown_closure</span> <span class="o">=</span> <span class="n">single_closure</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Intersect3D-2859"><a href="#-2859"><span class="linenos">2859</span></a>                <span class="n">grown_closure</span><span class="p">[</span><span class="n">depth_cube</span> <span class="o">&gt;=</span> <span class="n">max_depth</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Intersect3D-2860"><a href="#-2860"><span class="linenos">2860</span></a>                <span class="n">delta_voxel</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Intersect3D-2861"><a href="#-2861"><span class="linenos">2861</span></a>                <span class="n">previous_delta_voxel</span> <span class="o">=</span> <span class="mf">1e9</span>
</span><span id="Intersect3D-2862"><a href="#-2862"><span class="linenos">2862</span></a>                <span class="n">converged</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Intersect3D-2863"><a href="#-2863"><span class="linenos">2863</span></a>                <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">15</span><span class="p">):</span>
</span><span id="Intersect3D-2864"><a href="#-2864"><span class="linenos">2864</span></a>                    <span class="n">grown_closure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grow_lateral</span><span class="p">(</span><span class="n">grown_closure</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span><span id="Intersect3D-2865"><a href="#-2865"><span class="linenos">2865</span></a>                    <span class="n">grown_closure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grow_upward</span><span class="p">(</span><span class="n">grown_closure</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="Intersect3D-2866"><a href="#-2866"><span class="linenos">2866</span></a>                    <span class="c1"># stay within layer, within age, within fault block, above HCWC</span>
</span><span id="Intersect3D-2867"><a href="#-2867"><span class="linenos">2867</span></a>                    <span class="n">grown_closure</span><span class="p">[</span><span class="n">closure_boundary_cube</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="Intersect3D-2868"><a href="#-2868"><span class="linenos">2868</span></a>                    <span class="n">single_closure</span> <span class="o">=</span> <span class="n">single_closure</span> <span class="o">+</span> <span class="n">grown_closure</span>
</span><span id="Intersect3D-2869"><a href="#-2869"><span class="linenos">2869</span></a>                    <span class="n">single_closure</span><span class="p">[</span><span class="n">single_closure</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
</span><span id="Intersect3D-2870"><a href="#-2870"><span class="linenos">2870</span></a>                    <span class="n">new_n_voxel</span> <span class="o">=</span> <span class="n">single_closure</span><span class="p">[</span><span class="n">single_closure</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="Intersect3D-2871"><a href="#-2871"><span class="linenos">2871</span></a>                    <span class="n">previous_delta_voxel</span> <span class="o">=</span> <span class="n">delta_voxel</span> <span class="o">+</span> <span class="mi">0</span>
</span><span id="Intersect3D-2872"><a href="#-2872"><span class="linenos">2872</span></a>                    <span class="n">delta_voxel</span> <span class="o">=</span> <span class="n">new_n_voxel</span> <span class="o">-</span> <span class="n">n_voxel</span>
</span><span id="Intersect3D-2873"><a href="#-2873"><span class="linenos">2873</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="Intersect3D-2874"><a href="#-2874"><span class="linenos">2874</span></a>                        <span class="s2">&quot;    ... i, ii, closure label number, geobody shape, delta_voxel, previous_delta_voxel,&quot;</span>
</span><span id="Intersect3D-2875"><a href="#-2875"><span class="linenos">2875</span></a>                        <span class="s2">&quot; delta_voxel&gt;previous_delta_voxel = &quot;</span><span class="p">,</span>
</span><span id="Intersect3D-2876"><a href="#-2876"><span class="linenos">2876</span></a>                        <span class="n">i</span><span class="p">,</span>
</span><span id="Intersect3D-2877"><a href="#-2877"><span class="linenos">2877</span></a>                        <span class="n">ii</span><span class="p">,</span>
</span><span id="Intersect3D-2878"><a href="#-2878"><span class="linenos">2878</span></a>                        <span class="n">new_n_voxel</span><span class="p">,</span>
</span><span id="Intersect3D-2879"><a href="#-2879"><span class="linenos">2879</span></a>                        <span class="n">delta_voxel</span><span class="p">,</span>
</span><span id="Intersect3D-2880"><a href="#-2880"><span class="linenos">2880</span></a>                        <span class="n">previous_delta_voxel</span><span class="p">,</span>
</span><span id="Intersect3D-2881"><a href="#-2881"><span class="linenos">2881</span></a>                        <span class="n">delta_voxel</span> <span class="o">&gt;</span> <span class="n">previous_delta_voxel</span><span class="p">,</span>
</span><span id="Intersect3D-2882"><a href="#-2882"><span class="linenos">2882</span></a>                    <span class="p">)</span>
</span><span id="Intersect3D-2883"><a href="#-2883"><span class="linenos">2883</span></a>                    <span class="k">if</span> <span class="n">n_voxel</span> <span class="o">==</span> <span class="n">new_n_voxel</span><span class="p">:</span>
</span><span id="Intersect3D-2884"><a href="#-2884"><span class="linenos">2884</span></a>                        <span class="c1"># finish bottom voxel layer near &quot;HCWC&quot;</span>
</span><span id="Intersect3D-2885"><a href="#-2885"><span class="linenos">2885</span></a>                        <span class="n">grown_closure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grow_downward</span><span class="p">(</span>
</span><span id="Intersect3D-2886"><a href="#-2886"><span class="linenos">2886</span></a>                            <span class="n">grown_closure</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span>
</span><span id="Intersect3D-2887"><a href="#-2887"><span class="linenos">2887</span></a>                        <span class="p">)</span>
</span><span id="Intersect3D-2888"><a href="#-2888"><span class="linenos">2888</span></a>                        <span class="c1"># stay within layer, within age, within fault block, above HCWC</span>
</span><span id="Intersect3D-2889"><a href="#-2889"><span class="linenos">2889</span></a>                        <span class="n">grown_closure</span><span class="p">[</span><span class="n">closure_boundary_cube</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="Intersect3D-2890"><a href="#-2890"><span class="linenos">2890</span></a>                        <span class="n">single_closure</span> <span class="o">=</span> <span class="n">single_closure</span> <span class="o">+</span> <span class="n">grown_closure</span>
</span><span id="Intersect3D-2891"><a href="#-2891"><span class="linenos">2891</span></a>                        <span class="n">single_closure</span><span class="p">[</span><span class="n">single_closure</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
</span><span id="Intersect3D-2892"><a href="#-2892"><span class="linenos">2892</span></a>                        <span class="n">converged</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Intersect3D-2893"><a href="#-2893"><span class="linenos">2893</span></a>                        <span class="k">break</span>
</span><span id="Intersect3D-2894"><a href="#-2894"><span class="linenos">2894</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="Intersect3D-2895"><a href="#-2895"><span class="linenos">2895</span></a>                        <span class="n">n_voxel</span> <span class="o">=</span> <span class="n">new_n_voxel</span>
</span><span id="Intersect3D-2896"><a href="#-2896"><span class="linenos">2896</span></a>                    <span class="n">previous_delta_voxel</span> <span class="o">=</span> <span class="n">delta_voxel</span> <span class="o">+</span> <span class="mi">0</span>
</span><span id="Intersect3D-2897"><a href="#-2897"><span class="linenos">2897</span></a>                <span class="k">if</span> <span class="n">converged</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="Intersect3D-2898"><a href="#-2898"><span class="linenos">2898</span></a>                    <span class="n">labels_clean</span><span class="p">[</span><span class="n">single_closure</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
</span><span id="Intersect3D-2899"><a href="#-2899"><span class="linenos">2899</span></a>                    <span class="n">msg_postscript</span> <span class="o">=</span> <span class="s2">&quot; converged&quot;</span>
</span><span id="Intersect3D-2900"><a href="#-2900"><span class="linenos">2900</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Intersect3D-2901"><a href="#-2901"><span class="linenos">2901</span></a>                    <span class="n">labels_clean</span><span class="p">[</span><span class="n">labels_clean</span> <span class="o">==</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">i</span>
</span><span id="Intersect3D-2902"><a href="#-2902"><span class="linenos">2902</span></a>                    <span class="n">msg_postscript</span> <span class="o">=</span> <span class="s2">&quot; NOT converged&quot;</span>
</span><span id="Intersect3D-2903"><a href="#-2903"><span class="linenos">2903</span></a>                <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="Intersect3D-2904"><a href="#-2904"><span class="linenos">2904</span></a>                    <span class="s2">&quot;closure_id: &quot;</span>
</span><span id="Intersect3D-2905"><a href="#-2905"><span class="linenos">2905</span></a>                    <span class="o">+</span> <span class="nb">format</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="s2">&quot;4d&quot;</span><span class="p">)</span>
</span><span id="Intersect3D-2906"><a href="#-2906"><span class="linenos">2906</span></a>                    <span class="o">+</span> <span class="s2">&quot;, fault_id: &quot;</span>
</span><span id="Intersect3D-2907"><a href="#-2907"><span class="linenos">2907</span></a>                    <span class="o">+</span> <span class="nb">format</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">j</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">),</span> <span class="s2">&quot;4d&quot;</span><span class="p">)</span>
</span><span id="Intersect3D-2908"><a href="#-2908"><span class="linenos">2908</span></a>                    <span class="o">+</span> <span class="s2">&quot;, original_voxels: &quot;</span>
</span><span id="Intersect3D-2909"><a href="#-2909"><span class="linenos">2909</span></a>                    <span class="o">+</span> <span class="nb">format</span><span class="p">(</span><span class="n">original_voxels</span><span class="p">,</span> <span class="s2">&quot;11,.0f&quot;</span><span class="p">)</span>
</span><span id="Intersect3D-2910"><a href="#-2910"><span class="linenos">2910</span></a>                    <span class="o">+</span> <span class="s2">&quot;, new_n_voxel: &quot;</span>
</span><span id="Intersect3D-2911"><a href="#-2911"><span class="linenos">2911</span></a>                    <span class="o">+</span> <span class="nb">format</span><span class="p">(</span><span class="n">new_n_voxel</span><span class="p">,</span> <span class="s2">&quot;11,.0f&quot;</span><span class="p">)</span>
</span><span id="Intersect3D-2912"><a href="#-2912"><span class="linenos">2912</span></a>                    <span class="o">+</span> <span class="s2">&quot;, percent_growth: &quot;</span>
</span><span id="Intersect3D-2913"><a href="#-2913"><span class="linenos">2913</span></a>                    <span class="o">+</span> <span class="nb">format</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">new_n_voxel</span><span class="p">)</span> <span class="o">/</span> <span class="n">original_voxels</span><span class="p">,</span> <span class="s2">&quot;6.2f&quot;</span><span class="p">)</span>
</span><span id="Intersect3D-2914"><a href="#-2914"><span class="linenos">2914</span></a>                <span class="p">)</span>
</span><span id="Intersect3D-2915"><a href="#-2915"><span class="linenos">2915</span></a>                <span class="nb">print</span><span class="p">(</span><span class="n">msg</span> <span class="o">+</span> <span class="n">msg_postscript</span><span class="p">)</span>
</span><span id="Intersect3D-2916"><a href="#-2916"><span class="linenos">2916</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span><span class="n">msg</span> <span class="o">+</span> <span class="n">msg_postscript</span><span class="p">)</span>
</span><span id="Intersect3D-2917"><a href="#-2917"><span class="linenos">2917</span></a>
</span><span id="Intersect3D-2918"><a href="#-2918"><span class="linenos">2918</span></a>        <span class="c1"># Set small closures to 0 after growth</span>
</span><span id="Intersect3D-2919"><a href="#-2919"><span class="linenos">2919</span></a>        <span class="n">_grown_labels</span> <span class="o">=</span> <span class="n">measure</span><span class="o">.</span><span class="n">label</span><span class="p">(</span><span class="n">labels_clean</span><span class="p">,</span> <span class="n">connectivity</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">background</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="Intersect3D-2920"><a href="#-2920"><span class="linenos">2920</span></a>        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">_grown_labels</span><span class="p">):</span>
</span><span id="Intersect3D-2921"><a href="#-2921"><span class="linenos">2921</span></a>            <span class="n">size</span> <span class="o">=</span> <span class="n">_grown_labels</span><span class="p">[</span><span class="n">_grown_labels</span> <span class="o">==</span> <span class="n">x</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="Intersect3D-2922"><a href="#-2922"><span class="linenos">2922</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Size before editing: </span><span class="si">{</span><span class="n">size</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Intersect3D-2923"><a href="#-2923"><span class="linenos">2923</span></a>            <span class="k">if</span> <span class="n">size</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">closure_min_voxels</span><span class="p">:</span>
</span><span id="Intersect3D-2924"><a href="#-2924"><span class="linenos">2924</span></a>                <span class="n">labels_clean</span><span class="p">[</span><span class="n">_grown_labels</span> <span class="o">==</span> <span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="Intersect3D-2925"><a href="#-2925"><span class="linenos">2925</span></a>        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">labels_clean</span><span class="p">):</span>
</span><span id="Intersect3D-2926"><a href="#-2926"><span class="linenos">2926</span></a>            <span class="n">size</span> <span class="o">=</span> <span class="n">labels_clean</span><span class="p">[</span><span class="n">labels_clean</span> <span class="o">==</span> <span class="n">x</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="Intersect3D-2927"><a href="#-2927"><span class="linenos">2927</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Size after editing: </span><span class="si">{</span><span class="n">size</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Intersect3D-2928"><a href="#-2928"><span class="linenos">2928</span></a>
</span><span id="Intersect3D-2929"><a href="#-2929"><span class="linenos">2929</span></a>        <span class="k">return</span> <span class="n">labels_clean</span>
</span><span id="Intersect3D-2930"><a href="#-2930"><span class="linenos">2930</span></a>
</span><span id="Intersect3D-2931"><a href="#-2931"><span class="linenos">2931</span></a>    <span class="k">def</span> <span class="nf">_dilate_faults_and_onlaps</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Intersect3D-2932"><a href="#-2932"><span class="linenos">2932</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">wide_faults</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grow_lateral</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="Intersect3D-2933"><a href="#-2933"><span class="linenos">2933</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fat_faults</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grow_lateral</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="Intersect3D-2934"><a href="#-2934"><span class="linenos">2934</span></a>        <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
</span><span id="Intersect3D-2935"><a href="#-2935"><span class="linenos">2935</span></a>        <span class="n">mask</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="Intersect3D-2936"><a href="#-2936"><span class="linenos">2936</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">onlaps_upward</span> <span class="o">=</span> <span class="n">morphology</span><span class="o">.</span><span class="n">binary_dilation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">onlaps</span><span class="p">,</span> <span class="n">mask</span><span class="p">)</span>
</span><span id="Intersect3D-2937"><a href="#-2937"><span class="linenos">2937</span></a>        <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
</span><span id="Intersect3D-2938"><a href="#-2938"><span class="linenos">2938</span></a>        <span class="n">mask</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">:]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="Intersect3D-2939"><a href="#-2939"><span class="linenos">2939</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">onlaps_downward</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">onlaps</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Intersect3D-2940"><a href="#-2940"><span class="linenos">2940</span></a>        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">30</span><span class="p">):</span>
</span><span id="Intersect3D-2941"><a href="#-2941"><span class="linenos">2941</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="Intersect3D-2942"><a href="#-2942"><span class="linenos">2942</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">onlaps_downward</span> <span class="o">=</span> <span class="n">morphology</span><span class="o">.</span><span class="n">binary_dilation</span><span class="p">(</span>
</span><span id="Intersect3D-2943"><a href="#-2943"><span class="linenos">2943</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">onlaps_downward</span><span class="p">,</span> <span class="n">mask</span>
</span><span id="Intersect3D-2944"><a href="#-2944"><span class="linenos">2944</span></a>                <span class="p">)</span>
</span><span id="Intersect3D-2945"><a href="#-2945"><span class="linenos">2945</span></a>            <span class="k">except</span><span class="p">:</span>
</span><span id="Intersect3D-2946"><a href="#-2946"><span class="linenos">2946</span></a>                <span class="k">break</span>
</span><span id="Intersect3D-2947"><a href="#-2947"><span class="linenos">2947</span></a>
</span><span id="Intersect3D-2948"><a href="#-2948"><span class="linenos">2948</span></a>    <span class="nd">@staticmethod</span>
</span><span id="Intersect3D-2949"><a href="#-2949"><span class="linenos">2949</span></a>    <span class="k">def</span> <span class="nf">_threshold_volumes</span><span class="p">(</span><span class="n">volume</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
</span><span id="Intersect3D-2950"><a href="#-2950"><span class="linenos">2950</span></a>        <span class="n">volume</span><span class="p">[</span><span class="n">volume</span> <span class="o">&gt;=</span> <span class="n">threshold</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="Intersect3D-2951"><a href="#-2951"><span class="linenos">2951</span></a>        <span class="n">volume</span><span class="p">[</span><span class="n">volume</span> <span class="o">&lt;</span> <span class="n">threshold</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="Intersect3D-2952"><a href="#-2952"><span class="linenos">2952</span></a>        <span class="k">return</span> <span class="n">volume</span>
</span><span id="Intersect3D-2953"><a href="#-2953"><span class="linenos">2953</span></a>
</span><span id="Intersect3D-2954"><a href="#-2954"><span class="linenos">2954</span></a>    <span class="nd">@staticmethod</span>
</span><span id="Intersect3D-2955"><a href="#-2955"><span class="linenos">2955</span></a>    <span class="k">def</span> <span class="nf">grow_up_and_lateral</span><span class="p">(</span><span class="n">geobody</span><span class="p">,</span> <span class="n">iterations</span><span class="p">,</span> <span class="n">vdist</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">hdist</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="Intersect3D-2956"><a href="#-2956"><span class="linenos">2956</span></a>        <span class="kn">from</span> <span class="nn">scipy.ndimage</span> <span class="kn">import</span> <span class="n">maximum_filter</span>
</span><span id="Intersect3D-2957"><a href="#-2957"><span class="linenos">2957</span></a>
</span><span id="Intersect3D-2958"><a href="#-2958"><span class="linenos">2958</span></a>        <span class="n">hdist_size</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">hdist</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="Intersect3D-2959"><a href="#-2959"><span class="linenos">2959</span></a>        <span class="n">vdist_size</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">vdist</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="Intersect3D-2960"><a href="#-2960"><span class="linenos">2960</span></a>        <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">hdist_size</span><span class="p">,</span> <span class="n">hdist_size</span><span class="p">,</span> <span class="n">vdist_size</span><span class="p">))</span>
</span><span id="Intersect3D-2961"><a href="#-2961"><span class="linenos">2961</span></a>        <span class="n">mask</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:</span> <span class="n">vdist</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="Intersect3D-2962"><a href="#-2962"><span class="linenos">2962</span></a>        <span class="n">_geobody</span> <span class="o">=</span> <span class="n">geobody</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Intersect3D-2963"><a href="#-2963"><span class="linenos">2963</span></a>        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="Intersect3D-2964"><a href="#-2964"><span class="linenos">2964</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="Intersect3D-2965"><a href="#-2965"><span class="linenos">2965</span></a>                <span class="s2">&quot; ...grow_up_and_lateral: _geobody.shape = &quot;</span><span class="p">,</span>
</span><span id="Intersect3D-2966"><a href="#-2966"><span class="linenos">2966</span></a>                <span class="n">_geobody</span><span class="p">[</span><span class="n">_geobody</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
</span><span id="Intersect3D-2967"><a href="#-2967"><span class="linenos">2967</span></a>            <span class="p">)</span>
</span><span id="Intersect3D-2968"><a href="#-2968"><span class="linenos">2968</span></a>        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">iterations</span><span class="p">):</span>
</span><span id="Intersect3D-2969"><a href="#-2969"><span class="linenos">2969</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="Intersect3D-2970"><a href="#-2970"><span class="linenos">2970</span></a>                <span class="n">_geobody</span> <span class="o">=</span> <span class="n">maximum_filter</span><span class="p">(</span><span class="n">_geobody</span><span class="p">,</span> <span class="n">footprint</span><span class="o">=</span><span class="n">mask</span><span class="p">)</span>
</span><span id="Intersect3D-2971"><a href="#-2971"><span class="linenos">2971</span></a>                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="Intersect3D-2972"><a href="#-2972"><span class="linenos">2972</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="Intersect3D-2973"><a href="#-2973"><span class="linenos">2973</span></a>                        <span class="s2">&quot; ...grow_up_and_lateral: k, _geobody.shape = &quot;</span><span class="p">,</span>
</span><span id="Intersect3D-2974"><a href="#-2974"><span class="linenos">2974</span></a>                        <span class="n">k</span><span class="p">,</span>
</span><span id="Intersect3D-2975"><a href="#-2975"><span class="linenos">2975</span></a>                        <span class="n">_geobody</span><span class="p">[</span><span class="n">_geobody</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
</span><span id="Intersect3D-2976"><a href="#-2976"><span class="linenos">2976</span></a>                    <span class="p">)</span>
</span><span id="Intersect3D-2977"><a href="#-2977"><span class="linenos">2977</span></a>            <span class="k">except</span><span class="p">:</span>
</span><span id="Intersect3D-2978"><a href="#-2978"><span class="linenos">2978</span></a>                <span class="k">break</span>
</span><span id="Intersect3D-2979"><a href="#-2979"><span class="linenos">2979</span></a>        <span class="k">return</span> <span class="n">_geobody</span>
</span><span id="Intersect3D-2980"><a href="#-2980"><span class="linenos">2980</span></a>
</span><span id="Intersect3D-2981"><a href="#-2981"><span class="linenos">2981</span></a>    <span class="nd">@staticmethod</span>
</span><span id="Intersect3D-2982"><a href="#-2982"><span class="linenos">2982</span></a>    <span class="k">def</span> <span class="nf">grow_lateral</span><span class="p">(</span><span class="n">geobody</span><span class="p">,</span> <span class="n">iterations</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="Intersect3D-2983"><a href="#-2983"><span class="linenos">2983</span></a>        <span class="kn">from</span> <span class="nn">scipy.ndimage.morphology</span> <span class="kn">import</span> <span class="n">grey_dilation</span>
</span><span id="Intersect3D-2984"><a href="#-2984"><span class="linenos">2984</span></a>
</span><span id="Intersect3D-2985"><a href="#-2985"><span class="linenos">2985</span></a>        <span class="n">dist_size</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">dist</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="Intersect3D-2986"><a href="#-2986"><span class="linenos">2986</span></a>        <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">dist_size</span><span class="p">,</span> <span class="n">dist_size</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</span><span id="Intersect3D-2987"><a href="#-2987"><span class="linenos">2987</span></a>        <span class="n">mask</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="Intersect3D-2988"><a href="#-2988"><span class="linenos">2988</span></a>        <span class="n">_geobody</span> <span class="o">=</span> <span class="n">geobody</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Intersect3D-2989"><a href="#-2989"><span class="linenos">2989</span></a>        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="Intersect3D-2990"><a href="#-2990"><span class="linenos">2990</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; ...grow_lateral: _geobody.shape = &quot;</span><span class="p">,</span> <span class="n">_geobody</span><span class="p">[</span><span class="n">_geobody</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span><span id="Intersect3D-2991"><a href="#-2991"><span class="linenos">2991</span></a>        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">iterations</span><span class="p">):</span>
</span><span id="Intersect3D-2992"><a href="#-2992"><span class="linenos">2992</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="Intersect3D-2993"><a href="#-2993"><span class="linenos">2993</span></a>                <span class="n">_geobody</span> <span class="o">=</span> <span class="n">grey_dilation</span><span class="p">(</span><span class="n">_geobody</span><span class="p">,</span> <span class="n">footprint</span><span class="o">=</span><span class="n">mask</span><span class="p">)</span>
</span><span id="Intersect3D-2994"><a href="#-2994"><span class="linenos">2994</span></a>                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="Intersect3D-2995"><a href="#-2995"><span class="linenos">2995</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="Intersect3D-2996"><a href="#-2996"><span class="linenos">2996</span></a>                        <span class="s2">&quot; ...grow_lateral: k, _geobody.shape = &quot;</span><span class="p">,</span>
</span><span id="Intersect3D-2997"><a href="#-2997"><span class="linenos">2997</span></a>                        <span class="n">k</span><span class="p">,</span>
</span><span id="Intersect3D-2998"><a href="#-2998"><span class="linenos">2998</span></a>                        <span class="n">_geobody</span><span class="p">[</span><span class="n">_geobody</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
</span><span id="Intersect3D-2999"><a href="#-2999"><span class="linenos">2999</span></a>                    <span class="p">)</span>
</span><span id="Intersect3D-3000"><a href="#-3000"><span class="linenos">3000</span></a>            <span class="k">except</span><span class="p">:</span>
</span><span id="Intersect3D-3001"><a href="#-3001"><span class="linenos">3001</span></a>                <span class="k">break</span>
</span><span id="Intersect3D-3002"><a href="#-3002"><span class="linenos">3002</span></a>        <span class="k">return</span> <span class="n">_geobody</span>
</span><span id="Intersect3D-3003"><a href="#-3003"><span class="linenos">3003</span></a>
</span><span id="Intersect3D-3004"><a href="#-3004"><span class="linenos">3004</span></a>    <span class="nd">@staticmethod</span>
</span><span id="Intersect3D-3005"><a href="#-3005"><span class="linenos">3005</span></a>    <span class="k">def</span> <span class="nf">grow_upward</span><span class="p">(</span><span class="n">geobody</span><span class="p">,</span> <span class="n">iterations</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="Intersect3D-3006"><a href="#-3006"><span class="linenos">3006</span></a>        <span class="kn">from</span> <span class="nn">scipy.ndimage.morphology</span> <span class="kn">import</span> <span class="n">grey_dilation</span>
</span><span id="Intersect3D-3007"><a href="#-3007"><span class="linenos">3007</span></a>
</span><span id="Intersect3D-3008"><a href="#-3008"><span class="linenos">3008</span></a>        <span class="n">dist_size</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">dist</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="Intersect3D-3009"><a href="#-3009"><span class="linenos">3009</span></a>        <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dist_size</span><span class="p">))</span>
</span><span id="Intersect3D-3010"><a href="#-3010"><span class="linenos">3010</span></a>        <span class="n">mask</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:</span> <span class="n">dist</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="Intersect3D-3011"><a href="#-3011"><span class="linenos">3011</span></a>        <span class="n">_geobody</span> <span class="o">=</span> <span class="n">geobody</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Intersect3D-3012"><a href="#-3012"><span class="linenos">3012</span></a>        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="Intersect3D-3013"><a href="#-3013"><span class="linenos">3013</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; ...grow_upward: _geobody.shape = &quot;</span><span class="p">,</span> <span class="n">_geobody</span><span class="p">[</span><span class="n">_geobody</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span><span id="Intersect3D-3014"><a href="#-3014"><span class="linenos">3014</span></a>        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">iterations</span><span class="p">):</span>
</span><span id="Intersect3D-3015"><a href="#-3015"><span class="linenos">3015</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="Intersect3D-3016"><a href="#-3016"><span class="linenos">3016</span></a>                <span class="n">_geobody</span> <span class="o">=</span> <span class="n">grey_dilation</span><span class="p">(</span><span class="n">_geobody</span><span class="p">,</span> <span class="n">footprint</span><span class="o">=</span><span class="n">mask</span><span class="p">)</span>
</span><span id="Intersect3D-3017"><a href="#-3017"><span class="linenos">3017</span></a>                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="Intersect3D-3018"><a href="#-3018"><span class="linenos">3018</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="Intersect3D-3019"><a href="#-3019"><span class="linenos">3019</span></a>                        <span class="s2">&quot; ...grow_upward: k, _geobody.shape = &quot;</span><span class="p">,</span>
</span><span id="Intersect3D-3020"><a href="#-3020"><span class="linenos">3020</span></a>                        <span class="n">k</span><span class="p">,</span>
</span><span id="Intersect3D-3021"><a href="#-3021"><span class="linenos">3021</span></a>                        <span class="n">_geobody</span><span class="p">[</span><span class="n">_geobody</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
</span><span id="Intersect3D-3022"><a href="#-3022"><span class="linenos">3022</span></a>                    <span class="p">)</span>
</span><span id="Intersect3D-3023"><a href="#-3023"><span class="linenos">3023</span></a>            <span class="k">except</span><span class="p">:</span>
</span><span id="Intersect3D-3024"><a href="#-3024"><span class="linenos">3024</span></a>                <span class="k">break</span>
</span><span id="Intersect3D-3025"><a href="#-3025"><span class="linenos">3025</span></a>        <span class="k">return</span> <span class="n">_geobody</span>
</span><span id="Intersect3D-3026"><a href="#-3026"><span class="linenos">3026</span></a>
</span><span id="Intersect3D-3027"><a href="#-3027"><span class="linenos">3027</span></a>    <span class="nd">@staticmethod</span>
</span><span id="Intersect3D-3028"><a href="#-3028"><span class="linenos">3028</span></a>    <span class="k">def</span> <span class="nf">grow_downward</span><span class="p">(</span><span class="n">geobody</span><span class="p">,</span> <span class="n">iterations</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="Intersect3D-3029"><a href="#-3029"><span class="linenos">3029</span></a>        <span class="kn">from</span> <span class="nn">scipy.ndimage.morphology</span> <span class="kn">import</span> <span class="n">grey_dilation</span>
</span><span id="Intersect3D-3030"><a href="#-3030"><span class="linenos">3030</span></a>
</span><span id="Intersect3D-3031"><a href="#-3031"><span class="linenos">3031</span></a>        <span class="n">dist_size</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">dist</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="Intersect3D-3032"><a href="#-3032"><span class="linenos">3032</span></a>        <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dist_size</span><span class="p">))</span>
</span><span id="Intersect3D-3033"><a href="#-3033"><span class="linenos">3033</span></a>        <span class="n">mask</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">dist</span><span class="p">:]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="Intersect3D-3034"><a href="#-3034"><span class="linenos">3034</span></a>        <span class="n">_geobody</span> <span class="o">=</span> <span class="n">geobody</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Intersect3D-3035"><a href="#-3035"><span class="linenos">3035</span></a>        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="Intersect3D-3036"><a href="#-3036"><span class="linenos">3036</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; ...grow_downward: _geobody.shape = &quot;</span><span class="p">,</span> <span class="n">_geobody</span><span class="p">[</span><span class="n">_geobody</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span><span id="Intersect3D-3037"><a href="#-3037"><span class="linenos">3037</span></a>        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">iterations</span><span class="p">):</span>
</span><span id="Intersect3D-3038"><a href="#-3038"><span class="linenos">3038</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="Intersect3D-3039"><a href="#-3039"><span class="linenos">3039</span></a>                <span class="n">_geobody</span> <span class="o">=</span> <span class="n">grey_dilation</span><span class="p">(</span><span class="n">_geobody</span><span class="p">,</span> <span class="n">footprint</span><span class="o">=</span><span class="n">mask</span><span class="p">)</span>
</span><span id="Intersect3D-3040"><a href="#-3040"><span class="linenos">3040</span></a>                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="Intersect3D-3041"><a href="#-3041"><span class="linenos">3041</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="Intersect3D-3042"><a href="#-3042"><span class="linenos">3042</span></a>                        <span class="s2">&quot; ...grow_downward: k, _geobody.shape = &quot;</span><span class="p">,</span>
</span><span id="Intersect3D-3043"><a href="#-3043"><span class="linenos">3043</span></a>                        <span class="n">k</span><span class="p">,</span>
</span><span id="Intersect3D-3044"><a href="#-3044"><span class="linenos">3044</span></a>                        <span class="n">_geobody</span><span class="p">[</span><span class="n">_geobody</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
</span><span id="Intersect3D-3045"><a href="#-3045"><span class="linenos">3045</span></a>                    <span class="p">)</span>
</span><span id="Intersect3D-3046"><a href="#-3046"><span class="linenos">3046</span></a>            <span class="k">except</span><span class="p">:</span>
</span><span id="Intersect3D-3047"><a href="#-3047"><span class="linenos">3047</span></a>                <span class="k">break</span>
</span><span id="Intersect3D-3048"><a href="#-3048"><span class="linenos">3048</span></a>        <span class="k">return</span> <span class="n">_geobody</span>
</span></pre></div>


            <div class="docstring"><h6 id="geomodel">Geomodel</h6>

<p>The class of the Geomodel object.</p>

<p>This class contains all the items that make up the Geologic model.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>parameters</strong> (<a href="Parameters.html">datagenerator.Parameters</a>):
Parameter object storing all model parameters.</li>
<li><strong>depth_maps</strong> (np.ndarray):
A numpy array containing the depth maps.</li>
<li><strong>onlap_horizon_list</strong> (list):
A list of the onlap horizons.</li>
<li><strong>facies</strong> (np.ndarray):
The generated facies.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>None</strong></li>
</ul>
</div>


                            <div id="Intersect3D.__init__" class="classattr">
                                        <input id="Intersect3D.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">Intersect3D</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">faults</span>,</span><span class="param">	<span class="n">onlaps</span>,</span><span class="param">	<span class="n">oil_closures</span>,</span><span class="param">	<span class="n">gas_closures</span>,</span><span class="param">	<span class="n">brine_closures</span>,</span><span class="param">	<span class="n">closure_segment_list</span>,</span><span class="param">	<span class="n">closure_segments</span>,</span><span class="param">	<span class="n">parameters</span></span>)</span>

                <label class="view-source-button" for="Intersect3D.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Intersect3D.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Intersect3D.__init__-2580"><a href="#-2580"><span class="linenos">2580</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="Intersect3D.__init__-2581"><a href="#-2581"><span class="linenos">2581</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Intersect3D.__init__-2582"><a href="#-2582"><span class="linenos">2582</span></a>        <span class="n">faults</span><span class="p">,</span>
</span><span id="Intersect3D.__init__-2583"><a href="#-2583"><span class="linenos">2583</span></a>        <span class="n">onlaps</span><span class="p">,</span>
</span><span id="Intersect3D.__init__-2584"><a href="#-2584"><span class="linenos">2584</span></a>        <span class="n">oil_closures</span><span class="p">,</span>
</span><span id="Intersect3D.__init__-2585"><a href="#-2585"><span class="linenos">2585</span></a>        <span class="n">gas_closures</span><span class="p">,</span>
</span><span id="Intersect3D.__init__-2586"><a href="#-2586"><span class="linenos">2586</span></a>        <span class="n">brine_closures</span><span class="p">,</span>
</span><span id="Intersect3D.__init__-2587"><a href="#-2587"><span class="linenos">2587</span></a>        <span class="n">closure_segment_list</span><span class="p">,</span>
</span><span id="Intersect3D.__init__-2588"><a href="#-2588"><span class="linenos">2588</span></a>        <span class="n">closure_segments</span><span class="p">,</span>
</span><span id="Intersect3D.__init__-2589"><a href="#-2589"><span class="linenos">2589</span></a>        <span class="n">parameters</span><span class="p">,</span>
</span><span id="Intersect3D.__init__-2590"><a href="#-2590"><span class="linenos">2590</span></a>    <span class="p">):</span>
</span><span id="Intersect3D.__init__-2591"><a href="#-2591"><span class="linenos">2591</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">closure_segment_list</span> <span class="o">=</span> <span class="n">closure_segment_list</span>
</span><span id="Intersect3D.__init__-2592"><a href="#-2592"><span class="linenos">2592</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">closure_segments</span> <span class="o">=</span> <span class="n">closure_segments</span>
</span><span id="Intersect3D.__init__-2593"><a href="#-2593"><span class="linenos">2593</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span> <span class="o">=</span> <span class="n">parameters</span>
</span><span id="Intersect3D.__init__-2594"><a href="#-2594"><span class="linenos">2594</span></a>
</span><span id="Intersect3D.__init__-2595"><a href="#-2595"><span class="linenos">2595</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fault_throw</span> <span class="o">=</span> <span class="n">faults</span><span class="o">.</span><span class="n">max_fault_throw</span>
</span><span id="Intersect3D.__init__-2596"><a href="#-2596"><span class="linenos">2596</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">geologic_age</span> <span class="o">=</span> <span class="n">faults</span><span class="o">.</span><span class="n">faulted_age_volume</span>
</span><span id="Intersect3D.__init__-2597"><a href="#-2597"><span class="linenos">2597</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">geomodel_ng</span> <span class="o">=</span> <span class="n">faults</span><span class="o">.</span><span class="n">faulted_net_to_gross</span>
</span><span id="Intersect3D.__init__-2598"><a href="#-2598"><span class="linenos">2598</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">faults</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_threshold_volumes</span><span class="p">(</span><span class="n">faults</span><span class="o">.</span><span class="n">fault_planes</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
</span><span id="Intersect3D.__init__-2599"><a href="#-2599"><span class="linenos">2599</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">onlaps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_threshold_volumes</span><span class="p">(</span><span class="n">onlaps</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
</span><span id="Intersect3D.__init__-2600"><a href="#-2600"><span class="linenos">2600</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">oil_closures</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_threshold_volumes</span><span class="p">(</span><span class="n">oil_closures</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
</span><span id="Intersect3D.__init__-2601"><a href="#-2601"><span class="linenos">2601</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gas_closures</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_threshold_volumes</span><span class="p">(</span><span class="n">gas_closures</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
</span><span id="Intersect3D.__init__-2602"><a href="#-2602"><span class="linenos">2602</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">brine_closures</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_threshold_volumes</span><span class="p">(</span><span class="n">brine_closures</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
</span><span id="Intersect3D.__init__-2603"><a href="#-2603"><span class="linenos">2603</span></a>
</span><span id="Intersect3D.__init__-2604"><a href="#-2604"><span class="linenos">2604</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">wide_faults</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Intersect3D.__init__-2605"><a href="#-2605"><span class="linenos">2605</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fat_faults</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Intersect3D.__init__-2606"><a href="#-2606"><span class="linenos">2606</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">onlaps_upward</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Intersect3D.__init__-2607"><a href="#-2607"><span class="linenos">2607</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">onlaps_downward</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Intersect3D.__init__-2608"><a href="#-2608"><span class="linenos">2608</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dilate_faults_and_onlaps</span><span class="p">()</span>
</span><span id="Intersect3D.__init__-2609"><a href="#-2609"><span class="linenos">2609</span></a>
</span><span id="Intersect3D.__init__-2610"><a href="#-2610"><span class="linenos">2610</span></a>        <span class="c1"># Outputs</span>
</span><span id="Intersect3D.__init__-2611"><a href="#-2611"><span class="linenos">2611</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">faulted_closures_oil</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">oil_closures</span><span class="p">)</span>
</span><span id="Intersect3D.__init__-2612"><a href="#-2612"><span class="linenos">2612</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">faulted_closures_gas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gas_closures</span><span class="p">)</span>
</span><span id="Intersect3D.__init__-2613"><a href="#-2613"><span class="linenos">2613</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">faulted_closures_brine</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">brine_closures</span><span class="p">)</span>
</span><span id="Intersect3D.__init__-2614"><a href="#-2614"><span class="linenos">2614</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fault_closures_oil_segment_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
</span><span id="Intersect3D.__init__-2615"><a href="#-2615"><span class="linenos">2615</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fault_closures_gas_segment_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
</span><span id="Intersect3D.__init__-2616"><a href="#-2616"><span class="linenos">2616</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fault_closures_brine_segment_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
</span><span id="Intersect3D.__init__-2617"><a href="#-2617"><span class="linenos">2617</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_fault_closures_oil</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Intersect3D.__init__-2618"><a href="#-2618"><span class="linenos">2618</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_fault_closures_gas</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Intersect3D.__init__-2619"><a href="#-2619"><span class="linenos">2619</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_fault_closures_brine</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Intersect3D.__init__-2620"><a href="#-2620"><span class="linenos">2620</span></a>
</span><span id="Intersect3D.__init__-2621"><a href="#-2621"><span class="linenos">2621</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">onlap_closures_oil</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">oil_closures</span><span class="p">)</span>
</span><span id="Intersect3D.__init__-2622"><a href="#-2622"><span class="linenos">2622</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">onlap_closures_gas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gas_closures</span><span class="p">)</span>
</span><span id="Intersect3D.__init__-2623"><a href="#-2623"><span class="linenos">2623</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">onlap_closures_brine</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">brine_closures</span><span class="p">)</span>
</span><span id="Intersect3D.__init__-2624"><a href="#-2624"><span class="linenos">2624</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">onlap_closures_oil_segment_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
</span><span id="Intersect3D.__init__-2625"><a href="#-2625"><span class="linenos">2625</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">onlap_closures_gas_segment_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
</span><span id="Intersect3D.__init__-2626"><a href="#-2626"><span class="linenos">2626</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">onlap_closures_brine_segment_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
</span><span id="Intersect3D.__init__-2627"><a href="#-2627"><span class="linenos">2627</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_onlap_closures_oil</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Intersect3D.__init__-2628"><a href="#-2628"><span class="linenos">2628</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_onlap_closures_gas</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Intersect3D.__init__-2629"><a href="#-2629"><span class="linenos">2629</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_onlap_closures_brine</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Intersect3D.__init__-2630"><a href="#-2630"><span class="linenos">2630</span></a>
</span><span id="Intersect3D.__init__-2631"><a href="#-2631"><span class="linenos">2631</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">simple_closures_oil</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">oil_closures</span><span class="p">)</span>
</span><span id="Intersect3D.__init__-2632"><a href="#-2632"><span class="linenos">2632</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">simple_closures_gas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gas_closures</span><span class="p">)</span>
</span><span id="Intersect3D.__init__-2633"><a href="#-2633"><span class="linenos">2633</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">simple_closures_brine</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">brine_closures</span><span class="p">)</span>
</span><span id="Intersect3D.__init__-2634"><a href="#-2634"><span class="linenos">2634</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_4way_closures_oil</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Intersect3D.__init__-2635"><a href="#-2635"><span class="linenos">2635</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_4way_closures_gas</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Intersect3D.__init__-2636"><a href="#-2636"><span class="linenos">2636</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_4way_closures_brine</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Intersect3D.__init__-2637"><a href="#-2637"><span class="linenos">2637</span></a>
</span><span id="Intersect3D.__init__-2638"><a href="#-2638"><span class="linenos">2638</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">false_closures_oil</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">oil_closures</span><span class="p">)</span>
</span><span id="Intersect3D.__init__-2639"><a href="#-2639"><span class="linenos">2639</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">false_closures_gas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gas_closures</span><span class="p">)</span>
</span><span id="Intersect3D.__init__-2640"><a href="#-2640"><span class="linenos">2640</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">false_closures_brine</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">brine_closures</span><span class="p">)</span>
</span><span id="Intersect3D.__init__-2641"><a href="#-2641"><span class="linenos">2641</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_false_closures_oil</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Intersect3D.__init__-2642"><a href="#-2642"><span class="linenos">2642</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_false_closures_gas</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Intersect3D.__init__-2643"><a href="#-2643"><span class="linenos">2643</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_false_closures_brine</span> <span class="o">=</span> <span class="mi">0</span>
</span></pre></div>


            <div class="docstring"><p>__init__</p>

<p>Initializer for the Geomodel class.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>parameters</strong> (<a href="Parameters.html">datagenerator.Parameters</a>):
Parameter object storing all model parameters.</li>
<li><strong>depth_maps</strong> (np.ndarray):
A numpy array containing the depth maps.</li>
<li><strong>onlap_horizon_list</strong> (list):
A list of the onlap horizons.</li>
<li><strong>facies</strong> (np.ndarray):
The generated facies.</li>
</ul>
</div>


                            </div>
                            <div id="Intersect3D.find_faulted_closures" class="classattr">
                                        <input id="Intersect3D.find_faulted_closures-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">find_faulted_closures</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Intersect3D.find_faulted_closures-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Intersect3D.find_faulted_closures"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Intersect3D.find_faulted_closures-2645"><a href="#-2645"><span class="linenos">2645</span></a>    <span class="k">def</span> <span class="nf">find_faulted_closures</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Intersect3D.find_faulted_closures-2646"><a href="#-2646"><span class="linenos">2646</span></a>        <span class="k">for</span> <span class="n">iclosure</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">closure_segment_list</span><span class="p">:</span>
</span><span id="Intersect3D.find_faulted_closures-2647"><a href="#-2647"><span class="linenos">2647</span></a>            <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">closure_segments</span> <span class="o">==</span> <span class="n">iclosure</span><span class="p">)</span>
</span><span id="Intersect3D.find_faulted_closures-2648"><a href="#-2648"><span class="linenos">2648</span></a>            <span class="n">faults_within_closure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wide_faults</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span>
</span><span id="Intersect3D.find_faulted_closures-2649"><a href="#-2649"><span class="linenos">2649</span></a>            <span class="k">if</span> <span class="n">faults_within_closure</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Intersect3D.find_faulted_closures-2650"><a href="#-2650"><span class="linenos">2650</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">oil_closures</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Intersect3D.find_faulted_closures-2651"><a href="#-2651"><span class="linenos">2651</span></a>                    <span class="c1"># Faulted oil closure</span>
</span><span id="Intersect3D.find_faulted_closures-2652"><a href="#-2652"><span class="linenos">2652</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">faulted_closures_oil</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="Intersect3D.find_faulted_closures-2653"><a href="#-2653"><span class="linenos">2653</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">n_fault_closures_oil</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="Intersect3D.find_faulted_closures-2654"><a href="#-2654"><span class="linenos">2654</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">fault_closures_oil_segment_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">iclosure</span><span class="p">)</span>
</span><span id="Intersect3D.find_faulted_closures-2655"><a href="#-2655"><span class="linenos">2655</span></a>                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">gas_closures</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Intersect3D.find_faulted_closures-2656"><a href="#-2656"><span class="linenos">2656</span></a>                    <span class="c1"># Faulted gas closure</span>
</span><span id="Intersect3D.find_faulted_closures-2657"><a href="#-2657"><span class="linenos">2657</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">faulted_closures_gas</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="Intersect3D.find_faulted_closures-2658"><a href="#-2658"><span class="linenos">2658</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">n_fault_closures_gas</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="Intersect3D.find_faulted_closures-2659"><a href="#-2659"><span class="linenos">2659</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">fault_closures_gas_segment_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">iclosure</span><span class="p">)</span>
</span><span id="Intersect3D.find_faulted_closures-2660"><a href="#-2660"><span class="linenos">2660</span></a>                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">brine_closures</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Intersect3D.find_faulted_closures-2661"><a href="#-2661"><span class="linenos">2661</span></a>                    <span class="c1"># Faulted brine closure</span>
</span><span id="Intersect3D.find_faulted_closures-2662"><a href="#-2662"><span class="linenos">2662</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">faulted_closures_brine</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="Intersect3D.find_faulted_closures-2663"><a href="#-2663"><span class="linenos">2663</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">n_fault_closures_brine</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="Intersect3D.find_faulted_closures-2664"><a href="#-2664"><span class="linenos">2664</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">fault_closures_brine_segment_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">iclosure</span><span class="p">)</span>
</span><span id="Intersect3D.find_faulted_closures-2665"><a href="#-2665"><span class="linenos">2665</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Intersect3D.find_faulted_closures-2666"><a href="#-2666"><span class="linenos">2666</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="Intersect3D.find_faulted_closures-2667"><a href="#-2667"><span class="linenos">2667</span></a>                        <span class="s2">&quot;Closure is faulted but does not have oil, gas or brine assigned&quot;</span>
</span><span id="Intersect3D.find_faulted_closures-2668"><a href="#-2668"><span class="linenos">2668</span></a>                    <span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="Intersect3D.find_onlap_closures" class="classattr">
                                        <input id="Intersect3D.find_onlap_closures-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">find_onlap_closures</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Intersect3D.find_onlap_closures-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Intersect3D.find_onlap_closures"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Intersect3D.find_onlap_closures-2670"><a href="#-2670"><span class="linenos">2670</span></a>    <span class="k">def</span> <span class="nf">find_onlap_closures</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Intersect3D.find_onlap_closures-2671"><a href="#-2671"><span class="linenos">2671</span></a>        <span class="k">for</span> <span class="n">iclosure</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">closure_segment_list</span><span class="p">:</span>
</span><span id="Intersect3D.find_onlap_closures-2672"><a href="#-2672"><span class="linenos">2672</span></a>            <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">closure_segments</span> <span class="o">==</span> <span class="n">iclosure</span><span class="p">)</span>
</span><span id="Intersect3D.find_onlap_closures-2673"><a href="#-2673"><span class="linenos">2673</span></a>            <span class="n">onlaps_within_closure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">onlaps_upward</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span>
</span><span id="Intersect3D.find_onlap_closures-2674"><a href="#-2674"><span class="linenos">2674</span></a>            <span class="k">if</span> <span class="n">onlaps_within_closure</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Intersect3D.find_onlap_closures-2675"><a href="#-2675"><span class="linenos">2675</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">oil_closures</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Intersect3D.find_onlap_closures-2676"><a href="#-2676"><span class="linenos">2676</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">onlap_closures_oil</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="Intersect3D.find_onlap_closures-2677"><a href="#-2677"><span class="linenos">2677</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">n_onlap_closures_oil</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="Intersect3D.find_onlap_closures-2678"><a href="#-2678"><span class="linenos">2678</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">onlap_closures_oil_segment_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">iclosure</span><span class="p">)</span>
</span><span id="Intersect3D.find_onlap_closures-2679"><a href="#-2679"><span class="linenos">2679</span></a>                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">gas_closures</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Intersect3D.find_onlap_closures-2680"><a href="#-2680"><span class="linenos">2680</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">onlap_closures_gas</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="Intersect3D.find_onlap_closures-2681"><a href="#-2681"><span class="linenos">2681</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">n_onlap_closures_gas</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="Intersect3D.find_onlap_closures-2682"><a href="#-2682"><span class="linenos">2682</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">onlap_closures_gas_segment_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">iclosure</span><span class="p">)</span>
</span><span id="Intersect3D.find_onlap_closures-2683"><a href="#-2683"><span class="linenos">2683</span></a>                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">brine_closures</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Intersect3D.find_onlap_closures-2684"><a href="#-2684"><span class="linenos">2684</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">onlap_closures_brine</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="Intersect3D.find_onlap_closures-2685"><a href="#-2685"><span class="linenos">2685</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">n_onlap_closures_brine</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="Intersect3D.find_onlap_closures-2686"><a href="#-2686"><span class="linenos">2686</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">onlap_closures_brine_segment_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">iclosure</span><span class="p">)</span>
</span><span id="Intersect3D.find_onlap_closures-2687"><a href="#-2687"><span class="linenos">2687</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Intersect3D.find_onlap_closures-2688"><a href="#-2688"><span class="linenos">2688</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="Intersect3D.find_onlap_closures-2689"><a href="#-2689"><span class="linenos">2689</span></a>                        <span class="s2">&quot;Closure is onlap but does not have oil, gas or brine assigned&quot;</span>
</span><span id="Intersect3D.find_onlap_closures-2690"><a href="#-2690"><span class="linenos">2690</span></a>                    <span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="Intersect3D.find_simple_closures" class="classattr">
                                        <input id="Intersect3D.find_simple_closures-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">find_simple_closures</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Intersect3D.find_simple_closures-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Intersect3D.find_simple_closures"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Intersect3D.find_simple_closures-2692"><a href="#-2692"><span class="linenos">2692</span></a>    <span class="k">def</span> <span class="nf">find_simple_closures</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Intersect3D.find_simple_closures-2693"><a href="#-2693"><span class="linenos">2693</span></a>        <span class="k">for</span> <span class="n">iclosure</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">closure_segment_list</span><span class="p">:</span>
</span><span id="Intersect3D.find_simple_closures-2694"><a href="#-2694"><span class="linenos">2694</span></a>            <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">closure_segments</span> <span class="o">==</span> <span class="n">iclosure</span><span class="p">)</span>
</span><span id="Intersect3D.find_simple_closures-2695"><a href="#-2695"><span class="linenos">2695</span></a>            <span class="n">faults_within_closure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wide_faults</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span>
</span><span id="Intersect3D.find_simple_closures-2696"><a href="#-2696"><span class="linenos">2696</span></a>            <span class="n">onlaps_within_closure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">onlaps</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span>
</span><span id="Intersect3D.find_simple_closures-2697"><a href="#-2697"><span class="linenos">2697</span></a>            <span class="n">oil_within_closure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">oil_closures</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span>
</span><span id="Intersect3D.find_simple_closures-2698"><a href="#-2698"><span class="linenos">2698</span></a>            <span class="n">gas_within_closure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gas_closures</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span>
</span><span id="Intersect3D.find_simple_closures-2699"><a href="#-2699"><span class="linenos">2699</span></a>            <span class="n">brine_within_closure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">brine_closures</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span>
</span><span id="Intersect3D.find_simple_closures-2700"><a href="#-2700"><span class="linenos">2700</span></a>            <span class="k">if</span> <span class="n">faults_within_closure</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">onlaps_within_closure</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Intersect3D.find_simple_closures-2701"><a href="#-2701"><span class="linenos">2701</span></a>                <span class="k">if</span> <span class="n">oil_within_closure</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Intersect3D.find_simple_closures-2702"><a href="#-2702"><span class="linenos">2702</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">simple_closures_oil</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="Intersect3D.find_simple_closures-2703"><a href="#-2703"><span class="linenos">2703</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">n_4way_closures_oil</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="Intersect3D.find_simple_closures-2704"><a href="#-2704"><span class="linenos">2704</span></a>                <span class="k">elif</span> <span class="n">gas_within_closure</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Intersect3D.find_simple_closures-2705"><a href="#-2705"><span class="linenos">2705</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">simple_closures_gas</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="Intersect3D.find_simple_closures-2706"><a href="#-2706"><span class="linenos">2706</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">n_4way_closures_gas</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="Intersect3D.find_simple_closures-2707"><a href="#-2707"><span class="linenos">2707</span></a>                <span class="k">elif</span> <span class="n">brine_within_closure</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Intersect3D.find_simple_closures-2708"><a href="#-2708"><span class="linenos">2708</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">simple_closures_brine</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="Intersect3D.find_simple_closures-2709"><a href="#-2709"><span class="linenos">2709</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">n_4way_closures_brine</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="Intersect3D.find_simple_closures-2710"><a href="#-2710"><span class="linenos">2710</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Intersect3D.find_simple_closures-2711"><a href="#-2711"><span class="linenos">2711</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="Intersect3D.find_simple_closures-2712"><a href="#-2712"><span class="linenos">2712</span></a>                        <span class="s2">&quot;Closure is not faulted or onlap but does not have oil, gas or brine assigned&quot;</span>
</span><span id="Intersect3D.find_simple_closures-2713"><a href="#-2713"><span class="linenos">2713</span></a>                    <span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="Intersect3D.find_false_closures" class="classattr">
                                        <input id="Intersect3D.find_false_closures-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">find_false_closures</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Intersect3D.find_false_closures-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Intersect3D.find_false_closures"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Intersect3D.find_false_closures-2715"><a href="#-2715"><span class="linenos">2715</span></a>    <span class="k">def</span> <span class="nf">find_false_closures</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Intersect3D.find_false_closures-2716"><a href="#-2716"><span class="linenos">2716</span></a>        <span class="k">for</span> <span class="n">iclosure</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">closure_segment_list</span><span class="p">:</span>
</span><span id="Intersect3D.find_false_closures-2717"><a href="#-2717"><span class="linenos">2717</span></a>            <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">closure_segments</span> <span class="o">==</span> <span class="n">iclosure</span><span class="p">)</span>
</span><span id="Intersect3D.find_false_closures-2718"><a href="#-2718"><span class="linenos">2718</span></a>            <span class="n">faults_within_closure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fat_faults</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span>
</span><span id="Intersect3D.find_false_closures-2719"><a href="#-2719"><span class="linenos">2719</span></a>            <span class="n">onlaps_within_closure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">onlaps_downward</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span>
</span><span id="Intersect3D.find_false_closures-2720"><a href="#-2720"><span class="linenos">2720</span></a>            <span class="k">for</span> <span class="n">fluid</span><span class="p">,</span> <span class="n">false</span><span class="p">,</span> <span class="n">num</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
</span><span id="Intersect3D.find_false_closures-2721"><a href="#-2721"><span class="linenos">2721</span></a>                <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">oil_closures</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gas_closures</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">brine_closures</span><span class="p">],</span>
</span><span id="Intersect3D.find_false_closures-2722"><a href="#-2722"><span class="linenos">2722</span></a>                <span class="p">[</span>
</span><span id="Intersect3D.find_false_closures-2723"><a href="#-2723"><span class="linenos">2723</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">false_closures_oil</span><span class="p">,</span>
</span><span id="Intersect3D.find_false_closures-2724"><a href="#-2724"><span class="linenos">2724</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">false_closures_gas</span><span class="p">,</span>
</span><span id="Intersect3D.find_false_closures-2725"><a href="#-2725"><span class="linenos">2725</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">false_closures_brine</span><span class="p">,</span>
</span><span id="Intersect3D.find_false_closures-2726"><a href="#-2726"><span class="linenos">2726</span></a>                <span class="p">],</span>
</span><span id="Intersect3D.find_false_closures-2727"><a href="#-2727"><span class="linenos">2727</span></a>                <span class="p">[</span>
</span><span id="Intersect3D.find_false_closures-2728"><a href="#-2728"><span class="linenos">2728</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">n_false_closures_oil</span><span class="p">,</span>
</span><span id="Intersect3D.find_false_closures-2729"><a href="#-2729"><span class="linenos">2729</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">n_false_closures_gas</span><span class="p">,</span>
</span><span id="Intersect3D.find_false_closures-2730"><a href="#-2730"><span class="linenos">2730</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">n_false_closures_brine</span><span class="p">,</span>
</span><span id="Intersect3D.find_false_closures-2731"><a href="#-2731"><span class="linenos">2731</span></a>                <span class="p">],</span>
</span><span id="Intersect3D.find_false_closures-2732"><a href="#-2732"><span class="linenos">2732</span></a>            <span class="p">):</span>
</span><span id="Intersect3D.find_false_closures-2733"><a href="#-2733"><span class="linenos">2733</span></a>                <span class="n">fluid_within_closure</span> <span class="o">=</span> <span class="n">fluid</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span>
</span><span id="Intersect3D.find_false_closures-2734"><a href="#-2734"><span class="linenos">2734</span></a>                <span class="k">if</span> <span class="n">fluid_within_closure</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Intersect3D.find_false_closures-2735"><a href="#-2735"><span class="linenos">2735</span></a>                    <span class="k">if</span> <span class="n">onlaps_within_closure</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Intersect3D.find_false_closures-2736"><a href="#-2736"><span class="linenos">2736</span></a>                        <span class="n">_faulted_closure_threshold</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span>
</span><span id="Intersect3D.find_false_closures-2737"><a href="#-2737"><span class="linenos">2737</span></a>                            <span class="n">faults_within_closure</span><span class="p">[</span><span class="n">faults_within_closure</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="Intersect3D.find_false_closures-2738"><a href="#-2738"><span class="linenos">2738</span></a>                            <span class="o">/</span> <span class="n">fluid_within_closure</span><span class="p">[</span><span class="n">fluid_within_closure</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="Intersect3D.find_false_closures-2739"><a href="#-2739"><span class="linenos">2739</span></a>                        <span class="p">)</span>
</span><span id="Intersect3D.find_false_closures-2740"><a href="#-2740"><span class="linenos">2740</span></a>                        <span class="n">_onlap_closure_threshold</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span>
</span><span id="Intersect3D.find_false_closures-2741"><a href="#-2741"><span class="linenos">2741</span></a>                            <span class="n">onlaps_within_closure</span><span class="p">[</span><span class="n">onlaps_within_closure</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="Intersect3D.find_false_closures-2742"><a href="#-2742"><span class="linenos">2742</span></a>                            <span class="o">/</span> <span class="n">fluid_within_closure</span><span class="p">[</span><span class="n">fluid_within_closure</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="Intersect3D.find_false_closures-2743"><a href="#-2743"><span class="linenos">2743</span></a>                        <span class="p">)</span>
</span><span id="Intersect3D.find_false_closures-2744"><a href="#-2744"><span class="linenos">2744</span></a>                        <span class="k">if</span> <span class="p">(</span>
</span><span id="Intersect3D.find_false_closures-2745"><a href="#-2745"><span class="linenos">2745</span></a>                            <span class="n">_faulted_closure_threshold</span> <span class="o">&gt;</span> <span class="mf">0.65</span>
</span><span id="Intersect3D.find_false_closures-2746"><a href="#-2746"><span class="linenos">2746</span></a>                            <span class="ow">and</span> <span class="n">_onlap_closure_threshold</span> <span class="o">&gt;</span> <span class="mf">0.65</span>
</span><span id="Intersect3D.find_false_closures-2747"><a href="#-2747"><span class="linenos">2747</span></a>                        <span class="p">):</span>
</span><span id="Intersect3D.find_false_closures-2748"><a href="#-2748"><span class="linenos">2748</span></a>                            <span class="n">false</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="Intersect3D.find_false_closures-2749"><a href="#-2749"><span class="linenos">2749</span></a>                            <span class="n">num</span> <span class="o">+=</span> <span class="mi">1</span>
</span></pre></div>


    

                            </div>
                            <div id="Intersect3D.grow_to_fault2" class="classattr">
                                        <input id="Intersect3D.grow_to_fault2-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">grow_to_fault2</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">closures</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Intersect3D.grow_to_fault2-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Intersect3D.grow_to_fault2"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Intersect3D.grow_to_fault2-2751"><a href="#-2751"><span class="linenos">2751</span></a>    <span class="k">def</span> <span class="nf">grow_to_fault2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">closures</span><span class="p">):</span>
</span><span id="Intersect3D.grow_to_fault2-2752"><a href="#-2752"><span class="linenos">2752</span></a>        <span class="c1"># - grow closures laterally and up within layer and within fault block</span>
</span><span id="Intersect3D.grow_to_fault2-2753"><a href="#-2753"><span class="linenos">2753</span></a>        <span class="nb">print</span><span class="p">(</span>
</span><span id="Intersect3D.grow_to_fault2-2754"><a href="#-2754"><span class="linenos">2754</span></a>            <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2"> ... grow_to_fault2: grow closures laterally and up within layer and within fault block ...&quot;</span>
</span><span id="Intersect3D.grow_to_fault2-2755"><a href="#-2755"><span class="linenos">2755</span></a>        <span class="p">)</span>
</span><span id="Intersect3D.grow_to_fault2-2756"><a href="#-2756"><span class="linenos">2756</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span><span class="s2">&quot;growing closures to fault plane: grow_to_fault2&quot;</span><span class="p">)</span>
</span><span id="Intersect3D.grow_to_fault2-2757"><a href="#-2757"><span class="linenos">2757</span></a>
</span><span id="Intersect3D.grow_to_fault2-2758"><a href="#-2758"><span class="linenos">2758</span></a>        <span class="n">dilated_fault_closures</span> <span class="o">=</span> <span class="n">closures</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Intersect3D.grow_to_fault2-2759"><a href="#-2759"><span class="linenos">2759</span></a>        <span class="n">n_faulted_closures</span> <span class="o">=</span> <span class="n">dilated_fault_closures</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</span><span id="Intersect3D.grow_to_fault2-2760"><a href="#-2760"><span class="linenos">2760</span></a>        <span class="n">labels_clean</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">closure_segments</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Intersect3D.grow_to_fault2-2761"><a href="#-2761"><span class="linenos">2761</span></a>        <span class="n">labels_clean</span><span class="p">[</span><span class="n">closures</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Intersect3D.grow_to_fault2-2762"><a href="#-2762"><span class="linenos">2762</span></a>        <span class="n">labels_clean_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">labels_clean</span><span class="o">.</span><span class="n">flatten</span><span class="p">()))</span>
</span><span id="Intersect3D.grow_to_fault2-2763"><a href="#-2763"><span class="linenos">2763</span></a>        <span class="n">labels_clean_list</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="Intersect3D.grow_to_fault2-2764"><a href="#-2764"><span class="linenos">2764</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">    ... grow_to_fault2: n_faulted_closures = &quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">labels_clean_list</span><span class="p">))</span>
</span><span id="Intersect3D.grow_to_fault2-2765"><a href="#-2765"><span class="linenos">2765</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    ... grow_to_fault2: faulted_closures = &quot;</span><span class="p">,</span> <span class="n">labels_clean_list</span><span class="p">)</span>
</span><span id="Intersect3D.grow_to_fault2-2766"><a href="#-2766"><span class="linenos">2766</span></a>
</span><span id="Intersect3D.grow_to_fault2-2767"><a href="#-2767"><span class="linenos">2767</span></a>        <span class="c1"># fixme remove this once small closures are found and fixed</span>
</span><span id="Intersect3D.grow_to_fault2-2768"><a href="#-2768"><span class="linenos">2768</span></a>        <span class="n">voxel_sizes</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="Intersect3D.grow_to_fault2-2769"><a href="#-2769"><span class="linenos">2769</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">closure_segments</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">closure_segments</span> <span class="o">==</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="Intersect3D.grow_to_fault2-2770"><a href="#-2770"><span class="linenos">2770</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">labels_clean_list</span>
</span><span id="Intersect3D.grow_to_fault2-2771"><a href="#-2771"><span class="linenos">2771</span></a>        <span class="p">]</span>
</span><span id="Intersect3D.grow_to_fault2-2772"><a href="#-2772"><span class="linenos">2772</span></a>        <span class="k">for</span> <span class="n">_v</span> <span class="ow">in</span> <span class="n">voxel_sizes</span><span class="p">:</span>
</span><span id="Intersect3D.grow_to_fault2-2773"><a href="#-2773"><span class="linenos">2773</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Voxel_Sizes: </span><span class="si">{</span><span class="n">_v</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Intersect3D.grow_to_fault2-2774"><a href="#-2774"><span class="linenos">2774</span></a>            <span class="k">if</span> <span class="n">_v</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">closure_min_voxels</span><span class="p">:</span>
</span><span id="Intersect3D.grow_to_fault2-2775"><a href="#-2775"><span class="linenos">2775</span></a>                <span class="nb">print</span><span class="p">(</span><span class="n">_v</span><span class="p">)</span>
</span><span id="Intersect3D.grow_to_fault2-2776"><a href="#-2776"><span class="linenos">2776</span></a>
</span><span id="Intersect3D.grow_to_fault2-2777"><a href="#-2777"><span class="linenos">2777</span></a>        <span class="n">depth_cube</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">geologic_age</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span>
</span><span id="Intersect3D.grow_to_fault2-2778"><a href="#-2778"><span class="linenos">2778</span></a>        <span class="n">_depths</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">geologic_age</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</span><span id="Intersect3D.grow_to_fault2-2779"><a href="#-2779"><span class="linenos">2779</span></a>        <span class="n">depth_cube</span> <span class="o">+=</span> <span class="n">_depths</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">geologic_age</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</span><span id="Intersect3D.grow_to_fault2-2780"><a href="#-2780"><span class="linenos">2780</span></a>        <span class="n">_ng</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">geomodel_ng</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Intersect3D.grow_to_fault2-2781"><a href="#-2781"><span class="linenos">2781</span></a>        <span class="n">_age</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">geologic_age</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Intersect3D.grow_to_fault2-2782"><a href="#-2782"><span class="linenos">2782</span></a>
</span><span id="Intersect3D.grow_to_fault2-2783"><a href="#-2783"><span class="linenos">2783</span></a>        <span class="k">for</span> <span class="n">il</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">labels_clean_list</span><span class="p">):</span>
</span><span id="Intersect3D.grow_to_fault2-2784"><a href="#-2784"><span class="linenos">2784</span></a>            <span class="n">fault_blocks_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fault_throw</span><span class="p">[</span><span class="n">labels_clean</span> <span class="o">==</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()))</span>
</span><span id="Intersect3D.grow_to_fault2-2785"><a href="#-2785"><span class="linenos">2785</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    ... grow_to_fault2: fault_blocks_list = &quot;</span><span class="p">,</span> <span class="n">fault_blocks_list</span><span class="p">)</span>
</span><span id="Intersect3D.grow_to_fault2-2786"><a href="#-2786"><span class="linenos">2786</span></a>            <span class="k">for</span> <span class="n">jl</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">fault_blocks_list</span><span class="p">):</span>
</span><span id="Intersect3D.grow_to_fault2-2787"><a href="#-2787"><span class="linenos">2787</span></a>                <span class="nb">print</span><span class="p">(</span>
</span><span id="Intersect3D.grow_to_fault2-2788"><a href="#-2788"><span class="linenos">2788</span></a>                    <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">    ... label, throw = &quot;</span><span class="p">,</span>
</span><span id="Intersect3D.grow_to_fault2-2789"><a href="#-2789"><span class="linenos">2789</span></a>                    <span class="n">i</span><span class="p">,</span>
</span><span id="Intersect3D.grow_to_fault2-2790"><a href="#-2790"><span class="linenos">2790</span></a>                    <span class="n">j</span><span class="p">,</span>
</span><span id="Intersect3D.grow_to_fault2-2791"><a href="#-2791"><span class="linenos">2791</span></a>                    <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fault_throw</span><span class="p">[</span><span class="n">labels_clean</span> <span class="o">==</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">())),</span>
</span><span id="Intersect3D.grow_to_fault2-2792"><a href="#-2792"><span class="linenos">2792</span></a>                    <span class="n">labels_clean</span><span class="p">[</span><span class="n">labels_clean</span> <span class="o">==</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">,</span>
</span><span id="Intersect3D.grow_to_fault2-2793"><a href="#-2793"><span class="linenos">2793</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">fault_throw</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fault_throw</span> <span class="o">==</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">,</span>
</span><span id="Intersect3D.grow_to_fault2-2794"><a href="#-2794"><span class="linenos">2794</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">fault_throw</span><span class="p">[</span>
</span><span id="Intersect3D.grow_to_fault2-2795"><a href="#-2795"><span class="linenos">2795</span></a>                        <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">labels_clean</span> <span class="o">==</span> <span class="n">i</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fault_throw</span> <span class="o">==</span> <span class="n">j</span><span class="p">))</span>
</span><span id="Intersect3D.grow_to_fault2-2796"><a href="#-2796"><span class="linenos">2796</span></a>                    <span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">,</span>
</span><span id="Intersect3D.grow_to_fault2-2797"><a href="#-2797"><span class="linenos">2797</span></a>                <span class="p">)</span>
</span><span id="Intersect3D.grow_to_fault2-2798"><a href="#-2798"><span class="linenos">2798</span></a>                <span class="n">single_closure</span> <span class="o">=</span> <span class="n">labels_clean</span> <span class="o">*</span> <span class="mf">0.0</span>
</span><span id="Intersect3D.grow_to_fault2-2799"><a href="#-2799"><span class="linenos">2799</span></a>                <span class="n">size</span> <span class="o">=</span> <span class="n">single_closure</span><span class="p">[</span>
</span><span id="Intersect3D.grow_to_fault2-2800"><a href="#-2800"><span class="linenos">2800</span></a>                    <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
</span><span id="Intersect3D.grow_to_fault2-2801"><a href="#-2801"><span class="linenos">2801</span></a>                        <span class="p">(</span><span class="n">labels_clean</span> <span class="o">==</span> <span class="n">i</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fault_throw</span> <span class="o">-</span> <span class="n">j</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.25</span><span class="p">)</span>
</span><span id="Intersect3D.grow_to_fault2-2802"><a href="#-2802"><span class="linenos">2802</span></a>                    <span class="p">)</span>
</span><span id="Intersect3D.grow_to_fault2-2803"><a href="#-2803"><span class="linenos">2803</span></a>                <span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="Intersect3D.grow_to_fault2-2804"><a href="#-2804"><span class="linenos">2804</span></a>                <span class="k">if</span> <span class="n">size</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">closure_min_voxels</span><span class="p">:</span>
</span><span id="Intersect3D.grow_to_fault2-2805"><a href="#-2805"><span class="linenos">2805</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Label: </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">, fault_block: </span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s2">, Voxel_Count: </span><span class="si">{</span><span class="n">size</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Intersect3D.grow_to_fault2-2806"><a href="#-2806"><span class="linenos">2806</span></a>                    <span class="n">single_closure</span><span class="p">[</span>
</span><span id="Intersect3D.grow_to_fault2-2807"><a href="#-2807"><span class="linenos">2807</span></a>                        <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
</span><span id="Intersect3D.grow_to_fault2-2808"><a href="#-2808"><span class="linenos">2808</span></a>                            <span class="p">(</span><span class="n">labels_clean</span> <span class="o">==</span> <span class="n">i</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fault_throw</span> <span class="o">-</span> <span class="n">j</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.25</span><span class="p">)</span>
</span><span id="Intersect3D.grow_to_fault2-2809"><a href="#-2809"><span class="linenos">2809</span></a>                        <span class="p">)</span>
</span><span id="Intersect3D.grow_to_fault2-2810"><a href="#-2810"><span class="linenos">2810</span></a>                    <span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="Intersect3D.grow_to_fault2-2811"><a href="#-2811"><span class="linenos">2811</span></a>                <span class="k">if</span> <span class="n">single_closure</span><span class="p">[</span><span class="n">single_closure</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Intersect3D.grow_to_fault2-2812"><a href="#-2812"><span class="linenos">2812</span></a>                    <span class="c1"># labels_clean[np.where((labels_clean == i) &amp; (np.abs(self.fault_throw - j) &lt; .25))] = 0</span>
</span><span id="Intersect3D.grow_to_fault2-2813"><a href="#-2813"><span class="linenos">2813</span></a>                    <span class="n">labels_clean</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">labels_clean</span> <span class="o">==</span> <span class="n">i</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Intersect3D.grow_to_fault2-2814"><a href="#-2814"><span class="linenos">2814</span></a>                    <span class="k">continue</span>
</span><span id="Intersect3D.grow_to_fault2-2815"><a href="#-2815"><span class="linenos">2815</span></a>                <span class="n">avg_ng</span> <span class="o">=</span> <span class="n">_ng</span><span class="p">[</span><span class="n">single_closure</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</span><span id="Intersect3D.grow_to_fault2-2816"><a href="#-2816"><span class="linenos">2816</span></a>                <span class="n">_geo_age_voxels</span> <span class="o">=</span> <span class="p">(</span><span class="n">_age</span><span class="p">[</span><span class="n">single_closure</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;int&quot;</span><span class="p">)</span>
</span><span id="Intersect3D.grow_to_fault2-2817"><a href="#-2817"><span class="linenos">2817</span></a>                <span class="n">_ng_voxels</span> <span class="o">=</span> <span class="n">_ng</span><span class="p">[</span><span class="n">single_closure</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="Intersect3D.grow_to_fault2-2818"><a href="#-2818"><span class="linenos">2818</span></a>                <span class="n">_geo_age_voxels</span> <span class="o">=</span> <span class="n">_geo_age_voxels</span><span class="p">[</span><span class="n">_ng_voxels</span> <span class="o">&gt;=</span> <span class="n">avg_ng</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">]</span>
</span><span id="Intersect3D.grow_to_fault2-2819"><a href="#-2819"><span class="linenos">2819</span></a>                <span class="n">min_geo_age</span> <span class="o">=</span> <span class="n">_geo_age_voxels</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">-</span> <span class="mf">0.5</span>
</span><span id="Intersect3D.grow_to_fault2-2820"><a href="#-2820"><span class="linenos">2820</span></a>                <span class="n">avg_geo_age</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">_geo_age_voxels</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
</span><span id="Intersect3D.grow_to_fault2-2821"><a href="#-2821"><span class="linenos">2821</span></a>                <span class="n">max_geo_age</span> <span class="o">=</span> <span class="n">_geo_age_voxels</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="mf">0.5</span>
</span><span id="Intersect3D.grow_to_fault2-2822"><a href="#-2822"><span class="linenos">2822</span></a>                <span class="n">_depth_geobody_voxels</span> <span class="o">=</span> <span class="n">depth_cube</span><span class="p">[</span><span class="n">single_closure</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="Intersect3D.grow_to_fault2-2823"><a href="#-2823"><span class="linenos">2823</span></a>                <span class="n">min_depth</span> <span class="o">=</span> <span class="n">_depth_geobody_voxels</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
</span><span id="Intersect3D.grow_to_fault2-2824"><a href="#-2824"><span class="linenos">2824</span></a>                <span class="n">max_depth</span> <span class="o">=</span> <span class="n">_depth_geobody_voxels</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</span><span id="Intersect3D.grow_to_fault2-2825"><a href="#-2825"><span class="linenos">2825</span></a>                <span class="n">avg_throw</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fault_throw</span><span class="p">[</span><span class="n">single_closure</span> <span class="o">==</span> <span class="mi">1</span><span class="p">])</span>
</span><span id="Intersect3D.grow_to_fault2-2826"><a href="#-2826"><span class="linenos">2826</span></a>
</span><span id="Intersect3D.grow_to_fault2-2827"><a href="#-2827"><span class="linenos">2827</span></a>                <span class="n">closure_boundary_cube</span> <span class="o">=</span> <span class="n">closures</span> <span class="o">*</span> <span class="mf">0.0</span>
</span><span id="Intersect3D.grow_to_fault2-2828"><a href="#-2828"><span class="linenos">2828</span></a>                <span class="n">closure_boundary_cube</span><span class="p">[</span>
</span><span id="Intersect3D.grow_to_fault2-2829"><a href="#-2829"><span class="linenos">2829</span></a>                    <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
</span><span id="Intersect3D.grow_to_fault2-2830"><a href="#-2830"><span class="linenos">2830</span></a>                        <span class="p">(</span><span class="n">_ng</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">)</span>
</span><span id="Intersect3D.grow_to_fault2-2831"><a href="#-2831"><span class="linenos">2831</span></a>                        <span class="o">&amp;</span> <span class="p">(</span><span class="n">_age</span> <span class="o">&gt;</span> <span class="n">min_geo_age</span><span class="p">)</span>
</span><span id="Intersect3D.grow_to_fault2-2832"><a href="#-2832"><span class="linenos">2832</span></a>                        <span class="o">&amp;</span> <span class="p">(</span><span class="n">_age</span> <span class="o">&lt;</span> <span class="n">max_geo_age</span><span class="p">)</span>
</span><span id="Intersect3D.grow_to_fault2-2833"><a href="#-2833"><span class="linenos">2833</span></a>                        <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fault_throw</span> <span class="o">==</span> <span class="n">avg_throw</span><span class="p">)</span>
</span><span id="Intersect3D.grow_to_fault2-2834"><a href="#-2834"><span class="linenos">2834</span></a>                        <span class="o">&amp;</span> <span class="p">(</span><span class="n">depth_cube</span> <span class="o">&lt;=</span> <span class="n">max_depth</span><span class="p">)</span>
</span><span id="Intersect3D.grow_to_fault2-2835"><a href="#-2835"><span class="linenos">2835</span></a>                    <span class="p">)</span>
</span><span id="Intersect3D.grow_to_fault2-2836"><a href="#-2836"><span class="linenos">2836</span></a>                <span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="Intersect3D.grow_to_fault2-2837"><a href="#-2837"><span class="linenos">2837</span></a>                <span class="nb">print</span><span class="p">(</span>
</span><span id="Intersect3D.grow_to_fault2-2838"><a href="#-2838"><span class="linenos">2838</span></a>                    <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">    ... grow_to_fault2: closure_boundary_cube voxels = &quot;</span><span class="p">,</span>
</span><span id="Intersect3D.grow_to_fault2-2839"><a href="#-2839"><span class="linenos">2839</span></a>                    <span class="n">closure_boundary_cube</span><span class="p">[</span><span class="n">closure_boundary_cube</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">,</span>
</span><span id="Intersect3D.grow_to_fault2-2840"><a href="#-2840"><span class="linenos">2840</span></a>                <span class="p">)</span>
</span><span id="Intersect3D.grow_to_fault2-2841"><a href="#-2841"><span class="linenos">2841</span></a>
</span><span id="Intersect3D.grow_to_fault2-2842"><a href="#-2842"><span class="linenos">2842</span></a>                <span class="n">n_voxel</span> <span class="o">=</span> <span class="n">single_closure</span><span class="p">[</span><span class="n">single_closure</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="Intersect3D.grow_to_fault2-2843"><a href="#-2843"><span class="linenos">2843</span></a>
</span><span id="Intersect3D.grow_to_fault2-2844"><a href="#-2844"><span class="linenos">2844</span></a>                <span class="n">original_voxels</span> <span class="o">=</span> <span class="n">n_voxel</span> <span class="o">+</span> <span class="mi">0</span>
</span><span id="Intersect3D.grow_to_fault2-2845"><a href="#-2845"><span class="linenos">2845</span></a>                <span class="nb">print</span><span class="p">(</span>
</span><span id="Intersect3D.grow_to_fault2-2846"><a href="#-2846"><span class="linenos">2846</span></a>                    <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">    ... closure label number, avg_throw, geobody shape, geo_age min/mean/max, depth min/max, avg_ng = &quot;</span><span class="p">,</span>
</span><span id="Intersect3D.grow_to_fault2-2847"><a href="#-2847"><span class="linenos">2847</span></a>                    <span class="n">i</span><span class="p">,</span>
</span><span id="Intersect3D.grow_to_fault2-2848"><a href="#-2848"><span class="linenos">2848</span></a>                    <span class="n">j</span><span class="p">,</span>
</span><span id="Intersect3D.grow_to_fault2-2849"><a href="#-2849"><span class="linenos">2849</span></a>                    <span class="n">n_voxel</span><span class="p">,</span>
</span><span id="Intersect3D.grow_to_fault2-2850"><a href="#-2850"><span class="linenos">2850</span></a>                    <span class="p">(</span><span class="n">min_geo_age</span><span class="p">,</span> <span class="n">avg_geo_age</span><span class="p">,</span> <span class="n">max_geo_age</span><span class="p">),</span>
</span><span id="Intersect3D.grow_to_fault2-2851"><a href="#-2851"><span class="linenos">2851</span></a>                    <span class="p">(</span><span class="n">min_depth</span><span class="p">,</span> <span class="n">max_depth</span><span class="p">),</span>
</span><span id="Intersect3D.grow_to_fault2-2852"><a href="#-2852"><span class="linenos">2852</span></a>                    <span class="n">avg_ng</span><span class="p">,</span>
</span><span id="Intersect3D.grow_to_fault2-2853"><a href="#-2853"><span class="linenos">2853</span></a>                    <span class="n">il</span><span class="p">,</span>
</span><span id="Intersect3D.grow_to_fault2-2854"><a href="#-2854"><span class="linenos">2854</span></a>                    <span class="s2">&quot; / &quot;</span><span class="p">,</span>
</span><span id="Intersect3D.grow_to_fault2-2855"><a href="#-2855"><span class="linenos">2855</span></a>                    <span class="nb">len</span><span class="p">(</span><span class="n">labels_clean_list</span><span class="p">),</span>
</span><span id="Intersect3D.grow_to_fault2-2856"><a href="#-2856"><span class="linenos">2856</span></a>                <span class="p">)</span>
</span><span id="Intersect3D.grow_to_fault2-2857"><a href="#-2857"><span class="linenos">2857</span></a>
</span><span id="Intersect3D.grow_to_fault2-2858"><a href="#-2858"><span class="linenos">2858</span></a>                <span class="n">grown_closure</span> <span class="o">=</span> <span class="n">single_closure</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Intersect3D.grow_to_fault2-2859"><a href="#-2859"><span class="linenos">2859</span></a>                <span class="n">grown_closure</span><span class="p">[</span><span class="n">depth_cube</span> <span class="o">&gt;=</span> <span class="n">max_depth</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Intersect3D.grow_to_fault2-2860"><a href="#-2860"><span class="linenos">2860</span></a>                <span class="n">delta_voxel</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Intersect3D.grow_to_fault2-2861"><a href="#-2861"><span class="linenos">2861</span></a>                <span class="n">previous_delta_voxel</span> <span class="o">=</span> <span class="mf">1e9</span>
</span><span id="Intersect3D.grow_to_fault2-2862"><a href="#-2862"><span class="linenos">2862</span></a>                <span class="n">converged</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Intersect3D.grow_to_fault2-2863"><a href="#-2863"><span class="linenos">2863</span></a>                <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">15</span><span class="p">):</span>
</span><span id="Intersect3D.grow_to_fault2-2864"><a href="#-2864"><span class="linenos">2864</span></a>                    <span class="n">grown_closure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grow_lateral</span><span class="p">(</span><span class="n">grown_closure</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span><span id="Intersect3D.grow_to_fault2-2865"><a href="#-2865"><span class="linenos">2865</span></a>                    <span class="n">grown_closure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grow_upward</span><span class="p">(</span><span class="n">grown_closure</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="Intersect3D.grow_to_fault2-2866"><a href="#-2866"><span class="linenos">2866</span></a>                    <span class="c1"># stay within layer, within age, within fault block, above HCWC</span>
</span><span id="Intersect3D.grow_to_fault2-2867"><a href="#-2867"><span class="linenos">2867</span></a>                    <span class="n">grown_closure</span><span class="p">[</span><span class="n">closure_boundary_cube</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="Intersect3D.grow_to_fault2-2868"><a href="#-2868"><span class="linenos">2868</span></a>                    <span class="n">single_closure</span> <span class="o">=</span> <span class="n">single_closure</span> <span class="o">+</span> <span class="n">grown_closure</span>
</span><span id="Intersect3D.grow_to_fault2-2869"><a href="#-2869"><span class="linenos">2869</span></a>                    <span class="n">single_closure</span><span class="p">[</span><span class="n">single_closure</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
</span><span id="Intersect3D.grow_to_fault2-2870"><a href="#-2870"><span class="linenos">2870</span></a>                    <span class="n">new_n_voxel</span> <span class="o">=</span> <span class="n">single_closure</span><span class="p">[</span><span class="n">single_closure</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="Intersect3D.grow_to_fault2-2871"><a href="#-2871"><span class="linenos">2871</span></a>                    <span class="n">previous_delta_voxel</span> <span class="o">=</span> <span class="n">delta_voxel</span> <span class="o">+</span> <span class="mi">0</span>
</span><span id="Intersect3D.grow_to_fault2-2872"><a href="#-2872"><span class="linenos">2872</span></a>                    <span class="n">delta_voxel</span> <span class="o">=</span> <span class="n">new_n_voxel</span> <span class="o">-</span> <span class="n">n_voxel</span>
</span><span id="Intersect3D.grow_to_fault2-2873"><a href="#-2873"><span class="linenos">2873</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="Intersect3D.grow_to_fault2-2874"><a href="#-2874"><span class="linenos">2874</span></a>                        <span class="s2">&quot;    ... i, ii, closure label number, geobody shape, delta_voxel, previous_delta_voxel,&quot;</span>
</span><span id="Intersect3D.grow_to_fault2-2875"><a href="#-2875"><span class="linenos">2875</span></a>                        <span class="s2">&quot; delta_voxel&gt;previous_delta_voxel = &quot;</span><span class="p">,</span>
</span><span id="Intersect3D.grow_to_fault2-2876"><a href="#-2876"><span class="linenos">2876</span></a>                        <span class="n">i</span><span class="p">,</span>
</span><span id="Intersect3D.grow_to_fault2-2877"><a href="#-2877"><span class="linenos">2877</span></a>                        <span class="n">ii</span><span class="p">,</span>
</span><span id="Intersect3D.grow_to_fault2-2878"><a href="#-2878"><span class="linenos">2878</span></a>                        <span class="n">new_n_voxel</span><span class="p">,</span>
</span><span id="Intersect3D.grow_to_fault2-2879"><a href="#-2879"><span class="linenos">2879</span></a>                        <span class="n">delta_voxel</span><span class="p">,</span>
</span><span id="Intersect3D.grow_to_fault2-2880"><a href="#-2880"><span class="linenos">2880</span></a>                        <span class="n">previous_delta_voxel</span><span class="p">,</span>
</span><span id="Intersect3D.grow_to_fault2-2881"><a href="#-2881"><span class="linenos">2881</span></a>                        <span class="n">delta_voxel</span> <span class="o">&gt;</span> <span class="n">previous_delta_voxel</span><span class="p">,</span>
</span><span id="Intersect3D.grow_to_fault2-2882"><a href="#-2882"><span class="linenos">2882</span></a>                    <span class="p">)</span>
</span><span id="Intersect3D.grow_to_fault2-2883"><a href="#-2883"><span class="linenos">2883</span></a>                    <span class="k">if</span> <span class="n">n_voxel</span> <span class="o">==</span> <span class="n">new_n_voxel</span><span class="p">:</span>
</span><span id="Intersect3D.grow_to_fault2-2884"><a href="#-2884"><span class="linenos">2884</span></a>                        <span class="c1"># finish bottom voxel layer near &quot;HCWC&quot;</span>
</span><span id="Intersect3D.grow_to_fault2-2885"><a href="#-2885"><span class="linenos">2885</span></a>                        <span class="n">grown_closure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grow_downward</span><span class="p">(</span>
</span><span id="Intersect3D.grow_to_fault2-2886"><a href="#-2886"><span class="linenos">2886</span></a>                            <span class="n">grown_closure</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span>
</span><span id="Intersect3D.grow_to_fault2-2887"><a href="#-2887"><span class="linenos">2887</span></a>                        <span class="p">)</span>
</span><span id="Intersect3D.grow_to_fault2-2888"><a href="#-2888"><span class="linenos">2888</span></a>                        <span class="c1"># stay within layer, within age, within fault block, above HCWC</span>
</span><span id="Intersect3D.grow_to_fault2-2889"><a href="#-2889"><span class="linenos">2889</span></a>                        <span class="n">grown_closure</span><span class="p">[</span><span class="n">closure_boundary_cube</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="Intersect3D.grow_to_fault2-2890"><a href="#-2890"><span class="linenos">2890</span></a>                        <span class="n">single_closure</span> <span class="o">=</span> <span class="n">single_closure</span> <span class="o">+</span> <span class="n">grown_closure</span>
</span><span id="Intersect3D.grow_to_fault2-2891"><a href="#-2891"><span class="linenos">2891</span></a>                        <span class="n">single_closure</span><span class="p">[</span><span class="n">single_closure</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
</span><span id="Intersect3D.grow_to_fault2-2892"><a href="#-2892"><span class="linenos">2892</span></a>                        <span class="n">converged</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Intersect3D.grow_to_fault2-2893"><a href="#-2893"><span class="linenos">2893</span></a>                        <span class="k">break</span>
</span><span id="Intersect3D.grow_to_fault2-2894"><a href="#-2894"><span class="linenos">2894</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="Intersect3D.grow_to_fault2-2895"><a href="#-2895"><span class="linenos">2895</span></a>                        <span class="n">n_voxel</span> <span class="o">=</span> <span class="n">new_n_voxel</span>
</span><span id="Intersect3D.grow_to_fault2-2896"><a href="#-2896"><span class="linenos">2896</span></a>                    <span class="n">previous_delta_voxel</span> <span class="o">=</span> <span class="n">delta_voxel</span> <span class="o">+</span> <span class="mi">0</span>
</span><span id="Intersect3D.grow_to_fault2-2897"><a href="#-2897"><span class="linenos">2897</span></a>                <span class="k">if</span> <span class="n">converged</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="Intersect3D.grow_to_fault2-2898"><a href="#-2898"><span class="linenos">2898</span></a>                    <span class="n">labels_clean</span><span class="p">[</span><span class="n">single_closure</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
</span><span id="Intersect3D.grow_to_fault2-2899"><a href="#-2899"><span class="linenos">2899</span></a>                    <span class="n">msg_postscript</span> <span class="o">=</span> <span class="s2">&quot; converged&quot;</span>
</span><span id="Intersect3D.grow_to_fault2-2900"><a href="#-2900"><span class="linenos">2900</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Intersect3D.grow_to_fault2-2901"><a href="#-2901"><span class="linenos">2901</span></a>                    <span class="n">labels_clean</span><span class="p">[</span><span class="n">labels_clean</span> <span class="o">==</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">i</span>
</span><span id="Intersect3D.grow_to_fault2-2902"><a href="#-2902"><span class="linenos">2902</span></a>                    <span class="n">msg_postscript</span> <span class="o">=</span> <span class="s2">&quot; NOT converged&quot;</span>
</span><span id="Intersect3D.grow_to_fault2-2903"><a href="#-2903"><span class="linenos">2903</span></a>                <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="Intersect3D.grow_to_fault2-2904"><a href="#-2904"><span class="linenos">2904</span></a>                    <span class="s2">&quot;closure_id: &quot;</span>
</span><span id="Intersect3D.grow_to_fault2-2905"><a href="#-2905"><span class="linenos">2905</span></a>                    <span class="o">+</span> <span class="nb">format</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="s2">&quot;4d&quot;</span><span class="p">)</span>
</span><span id="Intersect3D.grow_to_fault2-2906"><a href="#-2906"><span class="linenos">2906</span></a>                    <span class="o">+</span> <span class="s2">&quot;, fault_id: &quot;</span>
</span><span id="Intersect3D.grow_to_fault2-2907"><a href="#-2907"><span class="linenos">2907</span></a>                    <span class="o">+</span> <span class="nb">format</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">j</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">),</span> <span class="s2">&quot;4d&quot;</span><span class="p">)</span>
</span><span id="Intersect3D.grow_to_fault2-2908"><a href="#-2908"><span class="linenos">2908</span></a>                    <span class="o">+</span> <span class="s2">&quot;, original_voxels: &quot;</span>
</span><span id="Intersect3D.grow_to_fault2-2909"><a href="#-2909"><span class="linenos">2909</span></a>                    <span class="o">+</span> <span class="nb">format</span><span class="p">(</span><span class="n">original_voxels</span><span class="p">,</span> <span class="s2">&quot;11,.0f&quot;</span><span class="p">)</span>
</span><span id="Intersect3D.grow_to_fault2-2910"><a href="#-2910"><span class="linenos">2910</span></a>                    <span class="o">+</span> <span class="s2">&quot;, new_n_voxel: &quot;</span>
</span><span id="Intersect3D.grow_to_fault2-2911"><a href="#-2911"><span class="linenos">2911</span></a>                    <span class="o">+</span> <span class="nb">format</span><span class="p">(</span><span class="n">new_n_voxel</span><span class="p">,</span> <span class="s2">&quot;11,.0f&quot;</span><span class="p">)</span>
</span><span id="Intersect3D.grow_to_fault2-2912"><a href="#-2912"><span class="linenos">2912</span></a>                    <span class="o">+</span> <span class="s2">&quot;, percent_growth: &quot;</span>
</span><span id="Intersect3D.grow_to_fault2-2913"><a href="#-2913"><span class="linenos">2913</span></a>                    <span class="o">+</span> <span class="nb">format</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">new_n_voxel</span><span class="p">)</span> <span class="o">/</span> <span class="n">original_voxels</span><span class="p">,</span> <span class="s2">&quot;6.2f&quot;</span><span class="p">)</span>
</span><span id="Intersect3D.grow_to_fault2-2914"><a href="#-2914"><span class="linenos">2914</span></a>                <span class="p">)</span>
</span><span id="Intersect3D.grow_to_fault2-2915"><a href="#-2915"><span class="linenos">2915</span></a>                <span class="nb">print</span><span class="p">(</span><span class="n">msg</span> <span class="o">+</span> <span class="n">msg_postscript</span><span class="p">)</span>
</span><span id="Intersect3D.grow_to_fault2-2916"><a href="#-2916"><span class="linenos">2916</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">write_to_logfile</span><span class="p">(</span><span class="n">msg</span> <span class="o">+</span> <span class="n">msg_postscript</span><span class="p">)</span>
</span><span id="Intersect3D.grow_to_fault2-2917"><a href="#-2917"><span class="linenos">2917</span></a>
</span><span id="Intersect3D.grow_to_fault2-2918"><a href="#-2918"><span class="linenos">2918</span></a>        <span class="c1"># Set small closures to 0 after growth</span>
</span><span id="Intersect3D.grow_to_fault2-2919"><a href="#-2919"><span class="linenos">2919</span></a>        <span class="n">_grown_labels</span> <span class="o">=</span> <span class="n">measure</span><span class="o">.</span><span class="n">label</span><span class="p">(</span><span class="n">labels_clean</span><span class="p">,</span> <span class="n">connectivity</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">background</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="Intersect3D.grow_to_fault2-2920"><a href="#-2920"><span class="linenos">2920</span></a>        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">_grown_labels</span><span class="p">):</span>
</span><span id="Intersect3D.grow_to_fault2-2921"><a href="#-2921"><span class="linenos">2921</span></a>            <span class="n">size</span> <span class="o">=</span> <span class="n">_grown_labels</span><span class="p">[</span><span class="n">_grown_labels</span> <span class="o">==</span> <span class="n">x</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="Intersect3D.grow_to_fault2-2922"><a href="#-2922"><span class="linenos">2922</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Size before editing: </span><span class="si">{</span><span class="n">size</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Intersect3D.grow_to_fault2-2923"><a href="#-2923"><span class="linenos">2923</span></a>            <span class="k">if</span> <span class="n">size</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">closure_min_voxels</span><span class="p">:</span>
</span><span id="Intersect3D.grow_to_fault2-2924"><a href="#-2924"><span class="linenos">2924</span></a>                <span class="n">labels_clean</span><span class="p">[</span><span class="n">_grown_labels</span> <span class="o">==</span> <span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="Intersect3D.grow_to_fault2-2925"><a href="#-2925"><span class="linenos">2925</span></a>        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">labels_clean</span><span class="p">):</span>
</span><span id="Intersect3D.grow_to_fault2-2926"><a href="#-2926"><span class="linenos">2926</span></a>            <span class="n">size</span> <span class="o">=</span> <span class="n">labels_clean</span><span class="p">[</span><span class="n">labels_clean</span> <span class="o">==</span> <span class="n">x</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="Intersect3D.grow_to_fault2-2927"><a href="#-2927"><span class="linenos">2927</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Size after editing: </span><span class="si">{</span><span class="n">size</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Intersect3D.grow_to_fault2-2928"><a href="#-2928"><span class="linenos">2928</span></a>
</span><span id="Intersect3D.grow_to_fault2-2929"><a href="#-2929"><span class="linenos">2929</span></a>        <span class="k">return</span> <span class="n">labels_clean</span>
</span></pre></div>


    

                            </div>
                            <div id="Intersect3D.grow_up_and_lateral" class="classattr">
                                        <input id="Intersect3D.grow_up_and_lateral-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">grow_up_and_lateral</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">geobody</span>, </span><span class="param"><span class="n">iterations</span>, </span><span class="param"><span class="n">vdist</span><span class="o">=</span><span class="mi">1</span>, </span><span class="param"><span class="n">hdist</span><span class="o">=</span><span class="mi">1</span>, </span><span class="param"><span class="n">verbose</span><span class="o">=</span><span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Intersect3D.grow_up_and_lateral-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Intersect3D.grow_up_and_lateral"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Intersect3D.grow_up_and_lateral-2954"><a href="#-2954"><span class="linenos">2954</span></a>    <span class="nd">@staticmethod</span>
</span><span id="Intersect3D.grow_up_and_lateral-2955"><a href="#-2955"><span class="linenos">2955</span></a>    <span class="k">def</span> <span class="nf">grow_up_and_lateral</span><span class="p">(</span><span class="n">geobody</span><span class="p">,</span> <span class="n">iterations</span><span class="p">,</span> <span class="n">vdist</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">hdist</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="Intersect3D.grow_up_and_lateral-2956"><a href="#-2956"><span class="linenos">2956</span></a>        <span class="kn">from</span> <span class="nn">scipy.ndimage</span> <span class="kn">import</span> <span class="n">maximum_filter</span>
</span><span id="Intersect3D.grow_up_and_lateral-2957"><a href="#-2957"><span class="linenos">2957</span></a>
</span><span id="Intersect3D.grow_up_and_lateral-2958"><a href="#-2958"><span class="linenos">2958</span></a>        <span class="n">hdist_size</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">hdist</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="Intersect3D.grow_up_and_lateral-2959"><a href="#-2959"><span class="linenos">2959</span></a>        <span class="n">vdist_size</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">vdist</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="Intersect3D.grow_up_and_lateral-2960"><a href="#-2960"><span class="linenos">2960</span></a>        <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">hdist_size</span><span class="p">,</span> <span class="n">hdist_size</span><span class="p">,</span> <span class="n">vdist_size</span><span class="p">))</span>
</span><span id="Intersect3D.grow_up_and_lateral-2961"><a href="#-2961"><span class="linenos">2961</span></a>        <span class="n">mask</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:</span> <span class="n">vdist</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="Intersect3D.grow_up_and_lateral-2962"><a href="#-2962"><span class="linenos">2962</span></a>        <span class="n">_geobody</span> <span class="o">=</span> <span class="n">geobody</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Intersect3D.grow_up_and_lateral-2963"><a href="#-2963"><span class="linenos">2963</span></a>        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="Intersect3D.grow_up_and_lateral-2964"><a href="#-2964"><span class="linenos">2964</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="Intersect3D.grow_up_and_lateral-2965"><a href="#-2965"><span class="linenos">2965</span></a>                <span class="s2">&quot; ...grow_up_and_lateral: _geobody.shape = &quot;</span><span class="p">,</span>
</span><span id="Intersect3D.grow_up_and_lateral-2966"><a href="#-2966"><span class="linenos">2966</span></a>                <span class="n">_geobody</span><span class="p">[</span><span class="n">_geobody</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
</span><span id="Intersect3D.grow_up_and_lateral-2967"><a href="#-2967"><span class="linenos">2967</span></a>            <span class="p">)</span>
</span><span id="Intersect3D.grow_up_and_lateral-2968"><a href="#-2968"><span class="linenos">2968</span></a>        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">iterations</span><span class="p">):</span>
</span><span id="Intersect3D.grow_up_and_lateral-2969"><a href="#-2969"><span class="linenos">2969</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="Intersect3D.grow_up_and_lateral-2970"><a href="#-2970"><span class="linenos">2970</span></a>                <span class="n">_geobody</span> <span class="o">=</span> <span class="n">maximum_filter</span><span class="p">(</span><span class="n">_geobody</span><span class="p">,</span> <span class="n">footprint</span><span class="o">=</span><span class="n">mask</span><span class="p">)</span>
</span><span id="Intersect3D.grow_up_and_lateral-2971"><a href="#-2971"><span class="linenos">2971</span></a>                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="Intersect3D.grow_up_and_lateral-2972"><a href="#-2972"><span class="linenos">2972</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="Intersect3D.grow_up_and_lateral-2973"><a href="#-2973"><span class="linenos">2973</span></a>                        <span class="s2">&quot; ...grow_up_and_lateral: k, _geobody.shape = &quot;</span><span class="p">,</span>
</span><span id="Intersect3D.grow_up_and_lateral-2974"><a href="#-2974"><span class="linenos">2974</span></a>                        <span class="n">k</span><span class="p">,</span>
</span><span id="Intersect3D.grow_up_and_lateral-2975"><a href="#-2975"><span class="linenos">2975</span></a>                        <span class="n">_geobody</span><span class="p">[</span><span class="n">_geobody</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
</span><span id="Intersect3D.grow_up_and_lateral-2976"><a href="#-2976"><span class="linenos">2976</span></a>                    <span class="p">)</span>
</span><span id="Intersect3D.grow_up_and_lateral-2977"><a href="#-2977"><span class="linenos">2977</span></a>            <span class="k">except</span><span class="p">:</span>
</span><span id="Intersect3D.grow_up_and_lateral-2978"><a href="#-2978"><span class="linenos">2978</span></a>                <span class="k">break</span>
</span><span id="Intersect3D.grow_up_and_lateral-2979"><a href="#-2979"><span class="linenos">2979</span></a>        <span class="k">return</span> <span class="n">_geobody</span>
</span></pre></div>


    

                            </div>
                            <div id="Intersect3D.grow_lateral" class="classattr">
                                        <input id="Intersect3D.grow_lateral-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">grow_lateral</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">geobody</span>, </span><span class="param"><span class="n">iterations</span>, </span><span class="param"><span class="n">dist</span><span class="o">=</span><span class="mi">1</span>, </span><span class="param"><span class="n">verbose</span><span class="o">=</span><span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Intersect3D.grow_lateral-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Intersect3D.grow_lateral"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Intersect3D.grow_lateral-2981"><a href="#-2981"><span class="linenos">2981</span></a>    <span class="nd">@staticmethod</span>
</span><span id="Intersect3D.grow_lateral-2982"><a href="#-2982"><span class="linenos">2982</span></a>    <span class="k">def</span> <span class="nf">grow_lateral</span><span class="p">(</span><span class="n">geobody</span><span class="p">,</span> <span class="n">iterations</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="Intersect3D.grow_lateral-2983"><a href="#-2983"><span class="linenos">2983</span></a>        <span class="kn">from</span> <span class="nn">scipy.ndimage.morphology</span> <span class="kn">import</span> <span class="n">grey_dilation</span>
</span><span id="Intersect3D.grow_lateral-2984"><a href="#-2984"><span class="linenos">2984</span></a>
</span><span id="Intersect3D.grow_lateral-2985"><a href="#-2985"><span class="linenos">2985</span></a>        <span class="n">dist_size</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">dist</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="Intersect3D.grow_lateral-2986"><a href="#-2986"><span class="linenos">2986</span></a>        <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">dist_size</span><span class="p">,</span> <span class="n">dist_size</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</span><span id="Intersect3D.grow_lateral-2987"><a href="#-2987"><span class="linenos">2987</span></a>        <span class="n">mask</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="Intersect3D.grow_lateral-2988"><a href="#-2988"><span class="linenos">2988</span></a>        <span class="n">_geobody</span> <span class="o">=</span> <span class="n">geobody</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Intersect3D.grow_lateral-2989"><a href="#-2989"><span class="linenos">2989</span></a>        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="Intersect3D.grow_lateral-2990"><a href="#-2990"><span class="linenos">2990</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; ...grow_lateral: _geobody.shape = &quot;</span><span class="p">,</span> <span class="n">_geobody</span><span class="p">[</span><span class="n">_geobody</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span><span id="Intersect3D.grow_lateral-2991"><a href="#-2991"><span class="linenos">2991</span></a>        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">iterations</span><span class="p">):</span>
</span><span id="Intersect3D.grow_lateral-2992"><a href="#-2992"><span class="linenos">2992</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="Intersect3D.grow_lateral-2993"><a href="#-2993"><span class="linenos">2993</span></a>                <span class="n">_geobody</span> <span class="o">=</span> <span class="n">grey_dilation</span><span class="p">(</span><span class="n">_geobody</span><span class="p">,</span> <span class="n">footprint</span><span class="o">=</span><span class="n">mask</span><span class="p">)</span>
</span><span id="Intersect3D.grow_lateral-2994"><a href="#-2994"><span class="linenos">2994</span></a>                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="Intersect3D.grow_lateral-2995"><a href="#-2995"><span class="linenos">2995</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="Intersect3D.grow_lateral-2996"><a href="#-2996"><span class="linenos">2996</span></a>                        <span class="s2">&quot; ...grow_lateral: k, _geobody.shape = &quot;</span><span class="p">,</span>
</span><span id="Intersect3D.grow_lateral-2997"><a href="#-2997"><span class="linenos">2997</span></a>                        <span class="n">k</span><span class="p">,</span>
</span><span id="Intersect3D.grow_lateral-2998"><a href="#-2998"><span class="linenos">2998</span></a>                        <span class="n">_geobody</span><span class="p">[</span><span class="n">_geobody</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
</span><span id="Intersect3D.grow_lateral-2999"><a href="#-2999"><span class="linenos">2999</span></a>                    <span class="p">)</span>
</span><span id="Intersect3D.grow_lateral-3000"><a href="#-3000"><span class="linenos">3000</span></a>            <span class="k">except</span><span class="p">:</span>
</span><span id="Intersect3D.grow_lateral-3001"><a href="#-3001"><span class="linenos">3001</span></a>                <span class="k">break</span>
</span><span id="Intersect3D.grow_lateral-3002"><a href="#-3002"><span class="linenos">3002</span></a>        <span class="k">return</span> <span class="n">_geobody</span>
</span></pre></div>


    

                            </div>
                            <div id="Intersect3D.grow_upward" class="classattr">
                                        <input id="Intersect3D.grow_upward-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">grow_upward</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">geobody</span>, </span><span class="param"><span class="n">iterations</span>, </span><span class="param"><span class="n">dist</span><span class="o">=</span><span class="mi">1</span>, </span><span class="param"><span class="n">verbose</span><span class="o">=</span><span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Intersect3D.grow_upward-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Intersect3D.grow_upward"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Intersect3D.grow_upward-3004"><a href="#-3004"><span class="linenos">3004</span></a>    <span class="nd">@staticmethod</span>
</span><span id="Intersect3D.grow_upward-3005"><a href="#-3005"><span class="linenos">3005</span></a>    <span class="k">def</span> <span class="nf">grow_upward</span><span class="p">(</span><span class="n">geobody</span><span class="p">,</span> <span class="n">iterations</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="Intersect3D.grow_upward-3006"><a href="#-3006"><span class="linenos">3006</span></a>        <span class="kn">from</span> <span class="nn">scipy.ndimage.morphology</span> <span class="kn">import</span> <span class="n">grey_dilation</span>
</span><span id="Intersect3D.grow_upward-3007"><a href="#-3007"><span class="linenos">3007</span></a>
</span><span id="Intersect3D.grow_upward-3008"><a href="#-3008"><span class="linenos">3008</span></a>        <span class="n">dist_size</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">dist</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="Intersect3D.grow_upward-3009"><a href="#-3009"><span class="linenos">3009</span></a>        <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dist_size</span><span class="p">))</span>
</span><span id="Intersect3D.grow_upward-3010"><a href="#-3010"><span class="linenos">3010</span></a>        <span class="n">mask</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:</span> <span class="n">dist</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="Intersect3D.grow_upward-3011"><a href="#-3011"><span class="linenos">3011</span></a>        <span class="n">_geobody</span> <span class="o">=</span> <span class="n">geobody</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Intersect3D.grow_upward-3012"><a href="#-3012"><span class="linenos">3012</span></a>        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="Intersect3D.grow_upward-3013"><a href="#-3013"><span class="linenos">3013</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; ...grow_upward: _geobody.shape = &quot;</span><span class="p">,</span> <span class="n">_geobody</span><span class="p">[</span><span class="n">_geobody</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span><span id="Intersect3D.grow_upward-3014"><a href="#-3014"><span class="linenos">3014</span></a>        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">iterations</span><span class="p">):</span>
</span><span id="Intersect3D.grow_upward-3015"><a href="#-3015"><span class="linenos">3015</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="Intersect3D.grow_upward-3016"><a href="#-3016"><span class="linenos">3016</span></a>                <span class="n">_geobody</span> <span class="o">=</span> <span class="n">grey_dilation</span><span class="p">(</span><span class="n">_geobody</span><span class="p">,</span> <span class="n">footprint</span><span class="o">=</span><span class="n">mask</span><span class="p">)</span>
</span><span id="Intersect3D.grow_upward-3017"><a href="#-3017"><span class="linenos">3017</span></a>                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="Intersect3D.grow_upward-3018"><a href="#-3018"><span class="linenos">3018</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="Intersect3D.grow_upward-3019"><a href="#-3019"><span class="linenos">3019</span></a>                        <span class="s2">&quot; ...grow_upward: k, _geobody.shape = &quot;</span><span class="p">,</span>
</span><span id="Intersect3D.grow_upward-3020"><a href="#-3020"><span class="linenos">3020</span></a>                        <span class="n">k</span><span class="p">,</span>
</span><span id="Intersect3D.grow_upward-3021"><a href="#-3021"><span class="linenos">3021</span></a>                        <span class="n">_geobody</span><span class="p">[</span><span class="n">_geobody</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
</span><span id="Intersect3D.grow_upward-3022"><a href="#-3022"><span class="linenos">3022</span></a>                    <span class="p">)</span>
</span><span id="Intersect3D.grow_upward-3023"><a href="#-3023"><span class="linenos">3023</span></a>            <span class="k">except</span><span class="p">:</span>
</span><span id="Intersect3D.grow_upward-3024"><a href="#-3024"><span class="linenos">3024</span></a>                <span class="k">break</span>
</span><span id="Intersect3D.grow_upward-3025"><a href="#-3025"><span class="linenos">3025</span></a>        <span class="k">return</span> <span class="n">_geobody</span>
</span></pre></div>


    

                            </div>
                            <div id="Intersect3D.grow_downward" class="classattr">
                                        <input id="Intersect3D.grow_downward-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">grow_downward</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">geobody</span>, </span><span class="param"><span class="n">iterations</span>, </span><span class="param"><span class="n">dist</span><span class="o">=</span><span class="mi">1</span>, </span><span class="param"><span class="n">verbose</span><span class="o">=</span><span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Intersect3D.grow_downward-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Intersect3D.grow_downward"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Intersect3D.grow_downward-3027"><a href="#-3027"><span class="linenos">3027</span></a>    <span class="nd">@staticmethod</span>
</span><span id="Intersect3D.grow_downward-3028"><a href="#-3028"><span class="linenos">3028</span></a>    <span class="k">def</span> <span class="nf">grow_downward</span><span class="p">(</span><span class="n">geobody</span><span class="p">,</span> <span class="n">iterations</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="Intersect3D.grow_downward-3029"><a href="#-3029"><span class="linenos">3029</span></a>        <span class="kn">from</span> <span class="nn">scipy.ndimage.morphology</span> <span class="kn">import</span> <span class="n">grey_dilation</span>
</span><span id="Intersect3D.grow_downward-3030"><a href="#-3030"><span class="linenos">3030</span></a>
</span><span id="Intersect3D.grow_downward-3031"><a href="#-3031"><span class="linenos">3031</span></a>        <span class="n">dist_size</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">dist</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="Intersect3D.grow_downward-3032"><a href="#-3032"><span class="linenos">3032</span></a>        <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dist_size</span><span class="p">))</span>
</span><span id="Intersect3D.grow_downward-3033"><a href="#-3033"><span class="linenos">3033</span></a>        <span class="n">mask</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">dist</span><span class="p">:]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="Intersect3D.grow_downward-3034"><a href="#-3034"><span class="linenos">3034</span></a>        <span class="n">_geobody</span> <span class="o">=</span> <span class="n">geobody</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Intersect3D.grow_downward-3035"><a href="#-3035"><span class="linenos">3035</span></a>        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="Intersect3D.grow_downward-3036"><a href="#-3036"><span class="linenos">3036</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; ...grow_downward: _geobody.shape = &quot;</span><span class="p">,</span> <span class="n">_geobody</span><span class="p">[</span><span class="n">_geobody</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span><span id="Intersect3D.grow_downward-3037"><a href="#-3037"><span class="linenos">3037</span></a>        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">iterations</span><span class="p">):</span>
</span><span id="Intersect3D.grow_downward-3038"><a href="#-3038"><span class="linenos">3038</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="Intersect3D.grow_downward-3039"><a href="#-3039"><span class="linenos">3039</span></a>                <span class="n">_geobody</span> <span class="o">=</span> <span class="n">grey_dilation</span><span class="p">(</span><span class="n">_geobody</span><span class="p">,</span> <span class="n">footprint</span><span class="o">=</span><span class="n">mask</span><span class="p">)</span>
</span><span id="Intersect3D.grow_downward-3040"><a href="#-3040"><span class="linenos">3040</span></a>                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="Intersect3D.grow_downward-3041"><a href="#-3041"><span class="linenos">3041</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="Intersect3D.grow_downward-3042"><a href="#-3042"><span class="linenos">3042</span></a>                        <span class="s2">&quot; ...grow_downward: k, _geobody.shape = &quot;</span><span class="p">,</span>
</span><span id="Intersect3D.grow_downward-3043"><a href="#-3043"><span class="linenos">3043</span></a>                        <span class="n">k</span><span class="p">,</span>
</span><span id="Intersect3D.grow_downward-3044"><a href="#-3044"><span class="linenos">3044</span></a>                        <span class="n">_geobody</span><span class="p">[</span><span class="n">_geobody</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
</span><span id="Intersect3D.grow_downward-3045"><a href="#-3045"><span class="linenos">3045</span></a>                    <span class="p">)</span>
</span><span id="Intersect3D.grow_downward-3046"><a href="#-3046"><span class="linenos">3046</span></a>            <span class="k">except</span><span class="p">:</span>
</span><span id="Intersect3D.grow_downward-3047"><a href="#-3047"><span class="linenos">3047</span></a>                <span class="k">break</span>
</span><span id="Intersect3D.grow_downward-3048"><a href="#-3048"><span class="linenos">3048</span></a>        <span class="k">return</span> <span class="n">_geobody</span>
</span></pre></div>


    

                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#Closures">Closures</a></dt>
                                <dd id="Intersect3D.create_closure_labels_from_depth_maps" class="function"><a href="#Closures.create_closure_labels_from_depth_maps">create_closure_labels_from_depth_maps</a></dd>
                <dd id="Intersect3D.create_closure_labels_from_all_depth_maps" class="function"><a href="#Closures.create_closure_labels_from_all_depth_maps">create_closure_labels_from_all_depth_maps</a></dd>
                <dd id="Intersect3D.find_top_lith_horizons" class="function"><a href="#Closures.find_top_lith_horizons">find_top_lith_horizons</a></dd>
                <dd id="Intersect3D.create_closures" class="function"><a href="#Closures.create_closures">create_closures</a></dd>
                <dd id="Intersect3D.closure_size_filter" class="function"><a href="#Closures.closure_size_filter">closure_size_filter</a></dd>
                <dd id="Intersect3D.closure_type_info_for_log" class="function"><a href="#Closures.closure_type_info_for_log">closure_type_info_for_log</a></dd>
                <dd id="Intersect3D.get_voxel_counts" class="function"><a href="#Closures.get_voxel_counts">get_voxel_counts</a></dd>
                <dd id="Intersect3D.populate_closure_dict" class="function"><a href="#Closures.populate_closure_dict">populate_closure_dict</a></dd>
                <dd id="Intersect3D.write_closure_info_to_log" class="function"><a href="#Closures.write_closure_info_to_log">write_closure_info_to_log</a></dd>
                <dd id="Intersect3D.parse_label_values_and_counts" class="function"><a href="#Closures.parse_label_values_and_counts">parse_label_values_and_counts</a></dd>
                <dd id="Intersect3D.assign_fluid_types" class="function"><a href="#Closures.assign_fluid_types">assign_fluid_types</a></dd>
                <dd id="Intersect3D.remove_small_objects" class="function"><a href="#Closures.remove_small_objects">remove_small_objects</a></dd>
                <dd id="Intersect3D.segment_closures" class="function"><a href="#Closures.segment_closures">segment_closures</a></dd>
                <dd id="Intersect3D.write_closure_volumes_to_disk" class="function"><a href="#Closures.write_closure_volumes_to_disk">write_closure_volumes_to_disk</a></dd>
                <dd id="Intersect3D.calculate_closure_statistics" class="function"><a href="#Closures.calculate_closure_statistics">calculate_closure_statistics</a></dd>
                <dd id="Intersect3D.find_salt_bounded_closures" class="function"><a href="#Closures.find_salt_bounded_closures">find_salt_bounded_closures</a></dd>
                <dd id="Intersect3D.find_faulted_all_closures" class="function"><a href="#Closures.find_faulted_all_closures">find_faulted_all_closures</a></dd>
                <dd id="Intersect3D.find_onlap_all_closures" class="function"><a href="#Closures.find_onlap_all_closures">find_onlap_all_closures</a></dd>
                <dd id="Intersect3D.find_simple_all_closures" class="function"><a href="#Closures.find_simple_all_closures">find_simple_all_closures</a></dd>
                <dd id="Intersect3D.find_false_all_closures" class="function"><a href="#Closures.find_false_all_closures">find_false_all_closures</a></dd>
                <dd id="Intersect3D.find_salt_bounded_all_closures" class="function"><a href="#Closures.find_salt_bounded_all_closures">find_salt_bounded_all_closures</a></dd>
                <dd id="Intersect3D.grow_to_salt" class="function"><a href="#Closures.grow_to_salt">grow_to_salt</a></dd>
                <dd id="Intersect3D.parse_closure_codes" class="function"><a href="#Closures.parse_closure_codes">parse_closure_codes</a></dd>

            </div>
            <div><dt><a href="Horizons.html#Horizons">datagenerator.Horizons.Horizons</a></dt>
                                <dd id="Intersect3D.insert_feature_into_horizon_stack" class="function"><a href="Horizons.html#Horizons.insert_feature_into_horizon_stack">insert_feature_into_horizon_stack</a></dd>
                <dd id="Intersect3D.insert_seafloor" class="function"><a href="Horizons.html#Horizons.insert_seafloor">insert_seafloor</a></dd>
                <dd id="Intersect3D.create_random_net_over_gross_map" class="function"><a href="Horizons.html#Horizons.create_random_net_over_gross_map">create_random_net_over_gross_map</a></dd>
                <dd id="Intersect3D.fit_plane_lsq" class="function"><a href="Horizons.html#Horizons.fit_plane_lsq">fit_plane_lsq</a></dd>
                <dd id="Intersect3D.eval_plane" class="function"><a href="Horizons.html#Horizons.eval_plane">eval_plane</a></dd>
                <dd id="Intersect3D.halton" class="function"><a href="Horizons.html#Horizons.halton">halton</a></dd>
                <dd id="Intersect3D.rotate_point" class="function"><a href="Horizons.html#Horizons.rotate_point">rotate_point</a></dd>
                <dd id="Intersect3D.convert_map_from_samples_to_units" class="function"><a href="Horizons.html#Horizons.convert_map_from_samples_to_units">convert_map_from_samples_to_units</a></dd>
                <dd id="Intersect3D.write_maps_to_disk" class="function"><a href="Horizons.html#Horizons.write_maps_to_disk">write_maps_to_disk</a></dd>
                <dd id="Intersect3D.write_onlap_episodes" class="function"><a href="Horizons.html#Horizons.write_onlap_episodes">write_onlap_episodes</a></dd>
                <dd id="Intersect3D.write_fan_horizons" class="function"><a href="Horizons.html#Horizons.write_fan_horizons">write_fan_horizons</a></dd>

            </div>
            <div><dt><a href="Geomodels.html#Geomodel">datagenerator.Geomodels.Geomodel</a></dt>
                                <dd id="Intersect3D.build_unfaulted_geomodels" class="function"><a href="Geomodels.html#Geomodel.build_unfaulted_geomodels">build_unfaulted_geomodels</a></dd>
                <dd id="Intersect3D.infilled_cube_shape" class="function"><a href="Geomodels.html#Geomodel.infilled_cube_shape">infilled_cube_shape</a></dd>
                <dd id="Intersect3D.build_meshgrid" class="function"><a href="Geomodels.html#Geomodel.build_meshgrid">build_meshgrid</a></dd>
                <dd id="Intersect3D.create_geologic_age_3d_from_infilled_horizons" class="function"><a href="Geomodels.html#Geomodel.create_geologic_age_3d_from_infilled_horizons">create_geologic_age_3d_from_infilled_horizons</a></dd>
                <dd id="Intersect3D.vertical_anti_alias_filter_simple" class="function"><a href="Geomodels.html#Geomodel.vertical_anti_alias_filter_simple">vertical_anti_alias_filter_simple</a></dd>
                <dd id="Intersect3D.vertical_anti_alias_filter" class="function"><a href="Geomodels.html#Geomodel.vertical_anti_alias_filter">vertical_anti_alias_filter</a></dd>
                <dd id="Intersect3D.plot_channels" class="function"><a href="Geomodels.html#Geomodel.plot_channels">plot_channels</a></dd>
                <dd id="Intersect3D.insert_onlap_surfaces" class="function"><a href="Geomodels.html#Geomodel.insert_onlap_surfaces">insert_onlap_surfaces</a></dd>
                <dd id="Intersect3D.write_cube_to_disk" class="function"><a href="Geomodels.html#Geomodel.write_cube_to_disk">write_cube_to_disk</a></dd>

            </div>
            <div><dt><a href="Parameters.html#Parameters">datagenerator.Parameters.Parameters</a></dt>
                                <dd id="Intersect3D.setup_model" class="function"><a href="Parameters.html#Parameters.setup_model">setup_model</a></dd>
                <dd id="Intersect3D.make_directories" class="function"><a href="Parameters.html#Parameters.make_directories">make_directories</a></dd>
                <dd id="Intersect3D.write_key_file" class="function"><a href="Parameters.html#Parameters.write_key_file">write_key_file</a></dd>
                <dd id="Intersect3D.write_to_logfile" class="function"><a href="Parameters.html#Parameters.write_to_logfile">write_to_logfile</a></dd>
                <dd id="Intersect3D.write_sqldict_to_logfile" class="function"><a href="Parameters.html#Parameters.write_sqldict_to_logfile">write_sqldict_to_logfile</a></dd>
                <dd id="Intersect3D.write_sqldict_to_db" class="function"><a href="Parameters.html#Parameters.write_sqldict_to_db">write_sqldict_to_db</a></dd>
                <dd id="Intersect3D.year_plus_fraction" class="function"><a href="Parameters.html#Parameters.year_plus_fraction">year_plus_fraction</a></dd>
                <dd id="Intersect3D.hdf_setup" class="function"><a href="Parameters.html#Parameters.hdf_setup">hdf_setup</a></dd>
                <dd id="Intersect3D.hdf_init" class="function"><a href="Parameters.html#Parameters.hdf_init">hdf_init</a></dd>
                <dd id="Intersect3D.hdf_node_list" class="function"><a href="Parameters.html#Parameters.hdf_node_list">hdf_node_list</a></dd>
                <dd id="Intersect3D.hdf_remove_node_list" class="function"><a href="Parameters.html#Parameters.hdf_remove_node_list">hdf_remove_node_list</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="variable_max_column_height">
                            <input id="variable_max_column_height-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">variable_max_column_height</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">top_lith_idx</span>, </span><span class="param"><span class="n">num_horizons</span>, </span><span class="param"><span class="n">hmin</span><span class="o">=</span><span class="mi">25</span>, </span><span class="param"><span class="n">hmax</span><span class="o">=</span><span class="mi">200</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="variable_max_column_height-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#variable_max_column_height"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="variable_max_column_height-3051"><a href="#-3051"><span class="linenos">3051</span></a><span class="k">def</span> <span class="nf">variable_max_column_height</span><span class="p">(</span><span class="n">top_lith_idx</span><span class="p">,</span> <span class="n">num_horizons</span><span class="p">,</span> <span class="n">hmin</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">hmax</span><span class="o">=</span><span class="mi">200</span><span class="p">):</span>
</span><span id="variable_max_column_height-3052"><a href="#-3052"><span class="linenos">3052</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="variable_max_column_height-3053"><a href="#-3053"><span class="linenos">3053</span></a><span class="sd">    Create a 1-D array of maximum column heights using linear function in layer numbers</span>
</span><span id="variable_max_column_height-3054"><a href="#-3054"><span class="linenos">3054</span></a><span class="sd">    Shallow closures will have small vertical closure heights</span>
</span><span id="variable_max_column_height-3055"><a href="#-3055"><span class="linenos">3055</span></a><span class="sd">    Deep closures will have larger vertical closure heights</span>
</span><span id="variable_max_column_height-3056"><a href="#-3056"><span class="linenos">3056</span></a>
</span><span id="variable_max_column_height-3057"><a href="#-3057"><span class="linenos">3057</span></a><span class="sd">    Would be better to use a pressure profile to determine maximum column heights at given depths</span>
</span><span id="variable_max_column_height-3058"><a href="#-3058"><span class="linenos">3058</span></a>
</span><span id="variable_max_column_height-3059"><a href="#-3059"><span class="linenos">3059</span></a><span class="sd">    :param top_lith_idx: 1-D array of horizon numbers corresponding to top of layers where lithology changes</span>
</span><span id="variable_max_column_height-3060"><a href="#-3060"><span class="linenos">3060</span></a><span class="sd">    :param num_horizons: Total number of horizons in model</span>
</span><span id="variable_max_column_height-3061"><a href="#-3061"><span class="linenos">3061</span></a><span class="sd">    :param hmin: Minimum column height to use in linear function</span>
</span><span id="variable_max_column_height-3062"><a href="#-3062"><span class="linenos">3062</span></a><span class="sd">    :param hmax: Maximum column height to use in linear function</span>
</span><span id="variable_max_column_height-3063"><a href="#-3063"><span class="linenos">3063</span></a><span class="sd">    :return: 1-D array of column heights of closures</span>
</span><span id="variable_max_column_height-3064"><a href="#-3064"><span class="linenos">3064</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="variable_max_column_height-3065"><a href="#-3065"><span class="linenos">3065</span></a>    <span class="c1"># Use a linear function to determine max column height based on layer number</span>
</span><span id="variable_max_column_height-3066"><a href="#-3066"><span class="linenos">3066</span></a>    <span class="n">column_heights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">hmin</span><span class="p">,</span> <span class="n">hmax</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="n">num_horizons</span><span class="p">)</span>
</span><span id="variable_max_column_height-3067"><a href="#-3067"><span class="linenos">3067</span></a>    <span class="n">max_col_heights</span> <span class="o">=</span> <span class="n">column_heights</span><span class="p">[</span><span class="n">top_lith_idx</span><span class="p">]</span>
</span><span id="variable_max_column_height-3068"><a href="#-3068"><span class="linenos">3068</span></a>    <span class="k">return</span> <span class="n">max_col_heights</span>
</span></pre></div>


            <div class="docstring"><p>Create a 1-D array of maximum column heights using linear function in layer numbers
Shallow closures will have small vertical closure heights
Deep closures will have larger vertical closure heights</p>

<p>Would be better to use a pressure profile to determine maximum column heights at given depths</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>top_lith_idx</strong>:  1-D array of horizon numbers corresponding to top of layers where lithology changes</li>
<li><strong>num_horizons</strong>:  Total number of horizons in model</li>
<li><strong>hmin</strong>:  Minimum column height to use in linear function</li>
<li><strong>hmax</strong>:  Maximum column height to use in linear function</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>1-D array of column heights of closures</p>
</blockquote>
</div>


                </section>
                <section id="fill_to_spill">
                            <input id="fill_to_spill-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">fill_to_spill</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">test_array</span>, </span><span class="param"><span class="n">array_flags</span>, </span><span class="param"><span class="n">empty_value</span><span class="o">=</span><span class="mf">1e+22</span>, </span><span class="param"><span class="n">quiet</span><span class="o">=</span><span class="kc">True</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="fill_to_spill-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#fill_to_spill"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="fill_to_spill-3072"><a href="#-3072"><span class="linenos">3072</span></a><span class="k">def</span> <span class="nf">fill_to_spill</span><span class="p">(</span><span class="n">test_array</span><span class="p">,</span> <span class="n">array_flags</span><span class="p">,</span> <span class="n">empty_value</span><span class="o">=</span><span class="mf">1.0e22</span><span class="p">,</span> <span class="n">quiet</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="fill_to_spill-3073"><a href="#-3073"><span class="linenos">3073</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">quiet</span><span class="p">:</span>
</span><span id="fill_to_spill-3074"><a href="#-3074"><span class="linenos">3074</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   ... start fillToSpill ......&quot;</span><span class="p">)</span>
</span><span id="fill_to_spill-3075"><a href="#-3075"><span class="linenos">3075</span></a>    <span class="n">temp_array</span> <span class="o">=</span> <span class="n">test_array</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="fill_to_spill-3076"><a href="#-3076"><span class="linenos">3076</span></a>    <span class="n">flags</span> <span class="o">=</span> <span class="n">array_flags</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="fill_to_spill-3077"><a href="#-3077"><span class="linenos">3077</span></a>    <span class="n">test_array_max</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="p">(</span><span class="n">temp_array</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">temp_array</span><span class="p">)])</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</span><span id="fill_to_spill-3078"><a href="#-3078"><span class="linenos">3078</span></a>    <span class="n">temp_array</span><span class="p">[</span><span class="n">array_flags</span> <span class="o">==</span> <span class="mi">255</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">empty_value</span>
</span><span id="fill_to_spill-3079"><a href="#-3079"><span class="linenos">3079</span></a>    <span class="n">flood_filled</span> <span class="o">=</span> <span class="n">test_array_max</span> <span class="o">-</span> <span class="n">flood_fill_heap</span><span class="p">(</span>
</span><span id="fill_to_spill-3080"><a href="#-3080"><span class="linenos">3080</span></a>        <span class="n">test_array_max</span> <span class="o">-</span> <span class="n">temp_array</span><span class="p">,</span> <span class="n">empty_value</span><span class="o">=</span><span class="n">empty_value</span>
</span><span id="fill_to_spill-3081"><a href="#-3081"><span class="linenos">3081</span></a>    <span class="p">)</span>
</span><span id="fill_to_spill-3082"><a href="#-3082"><span class="linenos">3082</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">quiet</span><span class="p">:</span>
</span><span id="fill_to_spill-3083"><a href="#-3083"><span class="linenos">3083</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   ... finish fillToSpill ......&quot;</span><span class="p">)</span>
</span><span id="fill_to_spill-3084"><a href="#-3084"><span class="linenos">3084</span></a>
</span><span id="fill_to_spill-3085"><a href="#-3085"><span class="linenos">3085</span></a>    <span class="n">flood_filled</span><span class="p">[</span><span class="n">array_flags</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="fill_to_spill-3086"><a href="#-3086"><span class="linenos">3086</span></a>    <span class="n">flood_filled</span><span class="p">[</span><span class="n">flood_filled</span> <span class="o">==</span> <span class="mf">1.0e5</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="fill_to_spill-3087"><a href="#-3087"><span class="linenos">3087</span></a>    <span class="n">flags</span><span class="p">[</span><span class="n">flood_filled</span> <span class="o">==</span> <span class="n">empty_value</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="fill_to_spill-3088"><a href="#-3088"><span class="linenos">3088</span></a>
</span><span id="fill_to_spill-3089"><a href="#-3089"><span class="linenos">3089</span></a>    <span class="k">return</span> <span class="n">flood_filled</span>
</span></pre></div>


    

                </section>
                <section id="flood_fill_heap">
                            <input id="flood_fill_heap-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">flood_fill_heap</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">test_array</span>, </span><span class="param"><span class="n">empty_value</span><span class="o">=</span><span class="mf">1e+22</span>, </span><span class="param"><span class="n">quiet</span><span class="o">=</span><span class="kc">True</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="flood_fill_heap-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#flood_fill_heap"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="flood_fill_heap-3092"><a href="#-3092"><span class="linenos">3092</span></a><span class="k">def</span> <span class="nf">flood_fill_heap</span><span class="p">(</span><span class="n">test_array</span><span class="p">,</span> <span class="n">empty_value</span><span class="o">=</span><span class="mf">1.0e22</span><span class="p">,</span> <span class="n">quiet</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="flood_fill_heap-3093"><a href="#-3093"><span class="linenos">3093</span></a>    <span class="c1"># from internet: http://arcgisandpython.blogspot.co.uk/2012/01/python-flood-fill-algorithm.html</span>
</span><span id="flood_fill_heap-3094"><a href="#-3094"><span class="linenos">3094</span></a>
</span><span id="flood_fill_heap-3095"><a href="#-3095"><span class="linenos">3095</span></a>    <span class="kn">import</span> <span class="nn">heapq</span>
</span><span id="flood_fill_heap-3096"><a href="#-3096"><span class="linenos">3096</span></a>    <span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">ndimage</span>
</span><span id="flood_fill_heap-3097"><a href="#-3097"><span class="linenos">3097</span></a>
</span><span id="flood_fill_heap-3098"><a href="#-3098"><span class="linenos">3098</span></a>    <span class="n">input_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">test_array</span><span class="p">)</span>
</span><span id="flood_fill_heap-3099"><a href="#-3099"><span class="linenos">3099</span></a>    <span class="n">num_validPoints</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="flood_fill_heap-3100"><a href="#-3100"><span class="linenos">3100</span></a>        <span class="n">test_array</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="flood_fill_heap-3101"><a href="#-3101"><span class="linenos">3101</span></a>        <span class="o">-</span> <span class="n">input_array</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">input_array</span><span class="p">)]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="flood_fill_heap-3102"><a href="#-3102"><span class="linenos">3102</span></a>        <span class="o">-</span> <span class="n">input_array</span><span class="p">[</span><span class="n">input_array</span> <span class="o">&gt;</span> <span class="n">empty_value</span> <span class="o">/</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="flood_fill_heap-3103"><a href="#-3103"><span class="linenos">3103</span></a>    <span class="p">)</span>
</span><span id="flood_fill_heap-3104"><a href="#-3104"><span class="linenos">3104</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">quiet</span><span class="p">:</span>
</span><span id="flood_fill_heap-3105"><a href="#-3105"><span class="linenos">3105</span></a>        <span class="nb">print</span><span class="p">(</span>
</span><span id="flood_fill_heap-3106"><a href="#-3106"><span class="linenos">3106</span></a>            <span class="s2">&quot;     ... flood_fill_heap ... number of valid input horizon picks = &quot;</span><span class="p">,</span>
</span><span id="flood_fill_heap-3107"><a href="#-3107"><span class="linenos">3107</span></a>            <span class="n">num_validPoints</span><span class="p">,</span>
</span><span id="flood_fill_heap-3108"><a href="#-3108"><span class="linenos">3108</span></a>        <span class="p">)</span>
</span><span id="flood_fill_heap-3109"><a href="#-3109"><span class="linenos">3109</span></a>
</span><span id="flood_fill_heap-3110"><a href="#-3110"><span class="linenos">3110</span></a>    <span class="n">validPoints</span> <span class="o">=</span> <span class="n">input_array</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">input_array</span><span class="p">)]</span>
</span><span id="flood_fill_heap-3111"><a href="#-3111"><span class="linenos">3111</span></a>    <span class="n">validPoints</span> <span class="o">=</span> <span class="n">validPoints</span><span class="p">[</span><span class="n">validPoints</span> <span class="o">&lt;</span> <span class="n">empty_value</span> <span class="o">/</span> <span class="mi">2</span><span class="p">]</span>
</span><span id="flood_fill_heap-3112"><a href="#-3112"><span class="linenos">3112</span></a>    <span class="n">validPoints</span> <span class="o">=</span> <span class="n">validPoints</span><span class="p">[</span><span class="n">validPoints</span> <span class="o">&lt;</span> <span class="mf">1.0e5</span><span class="p">]</span>
</span><span id="flood_fill_heap-3113"><a href="#-3113"><span class="linenos">3113</span></a>    <span class="n">validPoints</span> <span class="o">=</span> <span class="n">validPoints</span><span class="p">[</span><span class="n">validPoints</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">validPoints</span><span class="p">,</span> <span class="mi">2</span><span class="p">)]</span>
</span><span id="flood_fill_heap-3114"><a href="#-3114"><span class="linenos">3114</span></a>
</span><span id="flood_fill_heap-3115"><a href="#-3115"><span class="linenos">3115</span></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">validPoints</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="flood_fill_heap-3116"><a href="#-3116"><span class="linenos">3116</span></a>        <span class="n">amin</span> <span class="o">=</span> <span class="n">validPoints</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
</span><span id="flood_fill_heap-3117"><a href="#-3117"><span class="linenos">3117</span></a>        <span class="n">amax</span> <span class="o">=</span> <span class="n">validPoints</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</span><span id="flood_fill_heap-3118"><a href="#-3118"><span class="linenos">3118</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="flood_fill_heap-3119"><a href="#-3119"><span class="linenos">3119</span></a>        <span class="k">return</span> <span class="n">test_array</span>
</span><span id="flood_fill_heap-3120"><a href="#-3120"><span class="linenos">3120</span></a>
</span><span id="flood_fill_heap-3121"><a href="#-3121"><span class="linenos">3121</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">quiet</span><span class="p">:</span>
</span><span id="flood_fill_heap-3122"><a href="#-3122"><span class="linenos">3122</span></a>        <span class="nb">print</span><span class="p">(</span>
</span><span id="flood_fill_heap-3123"><a href="#-3123"><span class="linenos">3123</span></a>            <span class="s2">&quot;    ... validPoints stats = &quot;</span><span class="p">,</span>
</span><span id="flood_fill_heap-3124"><a href="#-3124"><span class="linenos">3124</span></a>            <span class="n">validPoints</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
</span><span id="flood_fill_heap-3125"><a href="#-3125"><span class="linenos">3125</span></a>            <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">validPoints</span><span class="p">),</span>
</span><span id="flood_fill_heap-3126"><a href="#-3126"><span class="linenos">3126</span></a>            <span class="n">validPoints</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span>
</span><span id="flood_fill_heap-3127"><a href="#-3127"><span class="linenos">3127</span></a>            <span class="n">validPoints</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span>
</span><span id="flood_fill_heap-3128"><a href="#-3128"><span class="linenos">3128</span></a>        <span class="p">)</span>
</span><span id="flood_fill_heap-3129"><a href="#-3129"><span class="linenos">3129</span></a>        <span class="nb">print</span><span class="p">(</span>
</span><span id="flood_fill_heap-3130"><a href="#-3130"><span class="linenos">3130</span></a>            <span class="s2">&quot;    ... validPoints %tiles = &quot;</span><span class="p">,</span>
</span><span id="flood_fill_heap-3131"><a href="#-3131"><span class="linenos">3131</span></a>            <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">validPoints</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
</span><span id="flood_fill_heap-3132"><a href="#-3132"><span class="linenos">3132</span></a>            <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">validPoints</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
</span><span id="flood_fill_heap-3133"><a href="#-3133"><span class="linenos">3133</span></a>            <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">validPoints</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
</span><span id="flood_fill_heap-3134"><a href="#-3134"><span class="linenos">3134</span></a>            <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">validPoints</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span>
</span><span id="flood_fill_heap-3135"><a href="#-3135"><span class="linenos">3135</span></a>            <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">validPoints</span><span class="p">,</span> <span class="mi">25</span><span class="p">),</span>
</span><span id="flood_fill_heap-3136"><a href="#-3136"><span class="linenos">3136</span></a>            <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">validPoints</span><span class="p">,</span> <span class="mi">50</span><span class="p">),</span>
</span><span id="flood_fill_heap-3137"><a href="#-3137"><span class="linenos">3137</span></a>            <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">validPoints</span><span class="p">,</span> <span class="mi">75</span><span class="p">),</span>
</span><span id="flood_fill_heap-3138"><a href="#-3138"><span class="linenos">3138</span></a>            <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">validPoints</span><span class="p">,</span> <span class="mi">90</span><span class="p">),</span>
</span><span id="flood_fill_heap-3139"><a href="#-3139"><span class="linenos">3139</span></a>            <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">validPoints</span><span class="p">,</span> <span class="mi">95</span><span class="p">),</span>
</span><span id="flood_fill_heap-3140"><a href="#-3140"><span class="linenos">3140</span></a>            <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">validPoints</span><span class="p">,</span> <span class="mi">99</span><span class="p">),</span>
</span><span id="flood_fill_heap-3141"><a href="#-3141"><span class="linenos">3141</span></a>            <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">validPoints</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span>
</span><span id="flood_fill_heap-3142"><a href="#-3142"><span class="linenos">3142</span></a>        <span class="p">)</span>
</span><span id="flood_fill_heap-3143"><a href="#-3143"><span class="linenos">3143</span></a>        <span class="kn">from</span> <span class="nn">datagenerator.util</span> <span class="kn">import</span> <span class="n">import_matplotlib</span>
</span><span id="flood_fill_heap-3144"><a href="#-3144"><span class="linenos">3144</span></a>
</span><span id="flood_fill_heap-3145"><a href="#-3145"><span class="linenos">3145</span></a>        <span class="n">plt</span> <span class="o">=</span> <span class="n">import_matplotlib</span><span class="p">()</span>
</span><span id="flood_fill_heap-3146"><a href="#-3146"><span class="linenos">3146</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</span><span id="flood_fill_heap-3147"><a href="#-3147"><span class="linenos">3147</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
</span><span id="flood_fill_heap-3148"><a href="#-3148"><span class="linenos">3148</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">input_array</span><span class="p">),</span> <span class="n">vmin</span><span class="o">=</span><span class="n">amin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">amax</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;jet_r&quot;</span><span class="p">)</span>
</span><span id="flood_fill_heap-3149"><a href="#-3149"><span class="linenos">3149</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
</span><span id="flood_fill_heap-3150"><a href="#-3150"><span class="linenos">3150</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span id="flood_fill_heap-3151"><a href="#-3151"><span class="linenos">3151</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;flood_fill.png&quot;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;png&quot;</span><span class="p">)</span>
</span><span id="flood_fill_heap-3152"><a href="#-3152"><span class="linenos">3152</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="flood_fill_heap-3153"><a href="#-3153"><span class="linenos">3153</span></a>
</span><span id="flood_fill_heap-3154"><a href="#-3154"><span class="linenos">3154</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;     ... min &amp; max for surface = &quot;</span><span class="p">,</span> <span class="n">amin</span><span class="p">,</span> <span class="n">amax</span><span class="p">)</span>
</span><span id="flood_fill_heap-3155"><a href="#-3155"><span class="linenos">3155</span></a>
</span><span id="flood_fill_heap-3156"><a href="#-3156"><span class="linenos">3156</span></a>    <span class="c1"># set empty values and nan&#39;s to huge</span>
</span><span id="flood_fill_heap-3157"><a href="#-3157"><span class="linenos">3157</span></a>    <span class="n">input_array</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">input_array</span><span class="p">)]</span> <span class="o">=</span> <span class="n">empty_value</span>
</span><span id="flood_fill_heap-3158"><a href="#-3158"><span class="linenos">3158</span></a>
</span><span id="flood_fill_heap-3159"><a href="#-3159"><span class="linenos">3159</span></a>    <span class="c1"># Set h_max to a value larger than the array maximum to ensure that the while loop will terminate</span>
</span><span id="flood_fill_heap-3160"><a href="#-3160"><span class="linenos">3160</span></a>    <span class="n">h_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">input_array</span> <span class="o">*</span> <span class="mf">2.0</span><span class="p">)</span>
</span><span id="flood_fill_heap-3161"><a href="#-3161"><span class="linenos">3161</span></a>
</span><span id="flood_fill_heap-3162"><a href="#-3162"><span class="linenos">3162</span></a>    <span class="c1"># Build mask of cells with data not on the edge of the image</span>
</span><span id="flood_fill_heap-3163"><a href="#-3163"><span class="linenos">3163</span></a>    <span class="c1"># Use 3x3 square structuring element</span>
</span><span id="flood_fill_heap-3164"><a href="#-3164"><span class="linenos">3164</span></a>    <span class="n">el</span> <span class="o">=</span> <span class="n">ndimage</span><span class="o">.</span><span class="n">generate_binary_structure</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">)</span>
</span><span id="flood_fill_heap-3165"><a href="#-3165"><span class="linenos">3165</span></a>    <span class="n">inside_mask</span> <span class="o">=</span> <span class="n">ndimage</span><span class="o">.</span><span class="n">binary_erosion</span><span class="p">(</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">input_array</span><span class="p">),</span> <span class="n">structure</span><span class="o">=</span><span class="n">el</span><span class="p">)</span>
</span><span id="flood_fill_heap-3166"><a href="#-3166"><span class="linenos">3166</span></a>    <span class="n">inside_mask</span><span class="p">[</span><span class="n">input_array</span> <span class="o">==</span> <span class="n">empty_value</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="flood_fill_heap-3167"><a href="#-3167"><span class="linenos">3167</span></a>    <span class="n">edge_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">invert</span><span class="p">(</span><span class="n">inside_mask</span><span class="p">)</span>
</span><span id="flood_fill_heap-3168"><a href="#-3168"><span class="linenos">3168</span></a>    <span class="c1"># Initialize output array as max value test_array except edges</span>
</span><span id="flood_fill_heap-3169"><a href="#-3169"><span class="linenos">3169</span></a>    <span class="n">output_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">input_array</span><span class="p">)</span>
</span><span id="flood_fill_heap-3170"><a href="#-3170"><span class="linenos">3170</span></a>    <span class="n">output_array</span><span class="p">[</span><span class="n">inside_mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">h_max</span>
</span><span id="flood_fill_heap-3171"><a href="#-3171"><span class="linenos">3171</span></a>
</span><span id="flood_fill_heap-3172"><a href="#-3172"><span class="linenos">3172</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">quiet</span><span class="p">:</span>
</span><span id="flood_fill_heap-3173"><a href="#-3173"><span class="linenos">3173</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
</span><span id="flood_fill_heap-3174"><a href="#-3174"><span class="linenos">3174</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
</span><span id="flood_fill_heap-3175"><a href="#-3175"><span class="linenos">3175</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">input_array</span><span class="p">),</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;jet_r&quot;</span><span class="p">)</span>
</span><span id="flood_fill_heap-3176"><a href="#-3176"><span class="linenos">3176</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
</span><span id="flood_fill_heap-3177"><a href="#-3177"><span class="linenos">3177</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span id="flood_fill_heap-3178"><a href="#-3178"><span class="linenos">3178</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;flood_fill2.png&quot;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;png&quot;</span><span class="p">)</span>
</span><span id="flood_fill_heap-3179"><a href="#-3179"><span class="linenos">3179</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="flood_fill_heap-3180"><a href="#-3180"><span class="linenos">3180</span></a>
</span><span id="flood_fill_heap-3181"><a href="#-3181"><span class="linenos">3181</span></a>    <span class="c1"># Build priority queue and place edge pixels into priority queue</span>
</span><span id="flood_fill_heap-3182"><a href="#-3182"><span class="linenos">3182</span></a>    <span class="c1"># Last value is flag to indicate if cell is an edge cell</span>
</span><span id="flood_fill_heap-3183"><a href="#-3183"><span class="linenos">3183</span></a>    <span class="n">put</span> <span class="o">=</span> <span class="n">heapq</span><span class="o">.</span><span class="n">heappush</span>
</span><span id="flood_fill_heap-3184"><a href="#-3184"><span class="linenos">3184</span></a>    <span class="n">get</span> <span class="o">=</span> <span class="n">heapq</span><span class="o">.</span><span class="n">heappop</span>
</span><span id="flood_fill_heap-3185"><a href="#-3185"><span class="linenos">3185</span></a>    <span class="n">fill_heap</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="flood_fill_heap-3186"><a href="#-3186"><span class="linenos">3186</span></a>        <span class="p">(</span><span class="n">output_array</span><span class="p">[</span><span class="n">t_row</span><span class="p">,</span> <span class="n">t_col</span><span class="p">],</span> <span class="nb">int</span><span class="p">(</span><span class="n">t_row</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">t_col</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="flood_fill_heap-3187"><a href="#-3187"><span class="linenos">3187</span></a>        <span class="k">for</span> <span class="n">t_row</span><span class="p">,</span> <span class="n">t_col</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">edge_mask</span><span class="p">))</span>
</span><span id="flood_fill_heap-3188"><a href="#-3188"><span class="linenos">3188</span></a>    <span class="p">]</span>
</span><span id="flood_fill_heap-3189"><a href="#-3189"><span class="linenos">3189</span></a>    <span class="n">heapq</span><span class="o">.</span><span class="n">heapify</span><span class="p">(</span><span class="n">fill_heap</span><span class="p">)</span>
</span><span id="flood_fill_heap-3190"><a href="#-3190"><span class="linenos">3190</span></a>
</span><span id="flood_fill_heap-3191"><a href="#-3191"><span class="linenos">3191</span></a>    <span class="c1"># Iterate until priority queue is empty</span>
</span><span id="flood_fill_heap-3192"><a href="#-3192"><span class="linenos">3192</span></a>    <span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="flood_fill_heap-3193"><a href="#-3193"><span class="linenos">3193</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="flood_fill_heap-3194"><a href="#-3194"><span class="linenos">3194</span></a>            <span class="n">h_crt</span><span class="p">,</span> <span class="n">t_row</span><span class="p">,</span> <span class="n">t_col</span><span class="p">,</span> <span class="n">edge_flag</span> <span class="o">=</span> <span class="n">get</span><span class="p">(</span><span class="n">fill_heap</span><span class="p">)</span>
</span><span id="flood_fill_heap-3195"><a href="#-3195"><span class="linenos">3195</span></a>        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
</span><span id="flood_fill_heap-3196"><a href="#-3196"><span class="linenos">3196</span></a>            <span class="k">break</span>
</span><span id="flood_fill_heap-3197"><a href="#-3197"><span class="linenos">3197</span></a>        <span class="k">for</span> <span class="n">n_row</span><span class="p">,</span> <span class="n">n_col</span> <span class="ow">in</span> <span class="p">[</span>
</span><span id="flood_fill_heap-3198"><a href="#-3198"><span class="linenos">3198</span></a>            <span class="p">((</span><span class="n">t_row</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span> <span class="n">t_col</span><span class="p">),</span>
</span><span id="flood_fill_heap-3199"><a href="#-3199"><span class="linenos">3199</span></a>            <span class="p">((</span><span class="n">t_row</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">t_col</span><span class="p">),</span>
</span><span id="flood_fill_heap-3200"><a href="#-3200"><span class="linenos">3200</span></a>            <span class="p">(</span><span class="n">t_row</span><span class="p">,</span> <span class="p">(</span><span class="n">t_col</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)),</span>
</span><span id="flood_fill_heap-3201"><a href="#-3201"><span class="linenos">3201</span></a>            <span class="p">(</span><span class="n">t_row</span><span class="p">,</span> <span class="p">(</span><span class="n">t_col</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)),</span>
</span><span id="flood_fill_heap-3202"><a href="#-3202"><span class="linenos">3202</span></a>        <span class="p">]:</span>
</span><span id="flood_fill_heap-3203"><a href="#-3203"><span class="linenos">3203</span></a>            <span class="c1"># Skip cell if outside array edges</span>
</span><span id="flood_fill_heap-3204"><a href="#-3204"><span class="linenos">3204</span></a>            <span class="k">if</span> <span class="n">edge_flag</span><span class="p">:</span>
</span><span id="flood_fill_heap-3205"><a href="#-3205"><span class="linenos">3205</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="flood_fill_heap-3206"><a href="#-3206"><span class="linenos">3206</span></a>                    <span class="k">if</span> <span class="ow">not</span> <span class="n">inside_mask</span><span class="p">[</span><span class="n">n_row</span><span class="p">,</span> <span class="n">n_col</span><span class="p">]:</span>
</span><span id="flood_fill_heap-3207"><a href="#-3207"><span class="linenos">3207</span></a>                        <span class="k">continue</span>
</span><span id="flood_fill_heap-3208"><a href="#-3208"><span class="linenos">3208</span></a>                <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
</span><span id="flood_fill_heap-3209"><a href="#-3209"><span class="linenos">3209</span></a>                    <span class="k">continue</span>
</span><span id="flood_fill_heap-3210"><a href="#-3210"><span class="linenos">3210</span></a>            <span class="k">if</span> <span class="n">output_array</span><span class="p">[</span><span class="n">n_row</span><span class="p">,</span> <span class="n">n_col</span><span class="p">]</span> <span class="o">==</span> <span class="n">h_max</span><span class="p">:</span>
</span><span id="flood_fill_heap-3211"><a href="#-3211"><span class="linenos">3211</span></a>                <span class="n">output_array</span><span class="p">[</span><span class="n">n_row</span><span class="p">,</span> <span class="n">n_col</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">h_crt</span><span class="p">,</span> <span class="n">input_array</span><span class="p">[</span><span class="n">n_row</span><span class="p">,</span> <span class="n">n_col</span><span class="p">])</span>
</span><span id="flood_fill_heap-3212"><a href="#-3212"><span class="linenos">3212</span></a>                <span class="n">put</span><span class="p">(</span><span class="n">fill_heap</span><span class="p">,</span> <span class="p">(</span><span class="n">output_array</span><span class="p">[</span><span class="n">n_row</span><span class="p">,</span> <span class="n">n_col</span><span class="p">],</span> <span class="n">n_row</span><span class="p">,</span> <span class="n">n_col</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
</span><span id="flood_fill_heap-3213"><a href="#-3213"><span class="linenos">3213</span></a>    <span class="n">output_array</span><span class="p">[</span><span class="n">output_array</span> <span class="o">==</span> <span class="n">empty_value</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
</span><span id="flood_fill_heap-3214"><a href="#-3214"><span class="linenos">3214</span></a>    <span class="k">return</span> <span class="n">output_array</span>
</span></pre></div>


    

                </section>
                <section id="get_top_of_closure">
                            <input id="get_top_of_closure-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_top_of_closure</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">inarray</span>, </span><span class="param"><span class="n">pad_up</span><span class="o">=</span><span class="mi">0</span>, </span><span class="param"><span class="n">pad_down</span><span class="o">=</span><span class="mi">0</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="get_top_of_closure-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#get_top_of_closure"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="get_top_of_closure-3319"><a href="#-3319"><span class="linenos">3319</span></a><span class="k">def</span> <span class="nf">get_top_of_closure</span><span class="p">(</span><span class="n">inarray</span><span class="p">,</span> <span class="n">pad_up</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">pad_down</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
</span><span id="get_top_of_closure-3320"><a href="#-3320"><span class="linenos">3320</span></a>    <span class="sd">&quot;&quot;&quot;Create a mask leaving only the top of a closure.&quot;&quot;&quot;</span>
</span><span id="get_top_of_closure-3321"><a href="#-3321"><span class="linenos">3321</span></a>    <span class="n">mask</span> <span class="o">=</span> <span class="n">inarray</span> <span class="o">!=</span> <span class="mi">0</span>
</span><span id="get_top_of_closure-3322"><a href="#-3322"><span class="linenos">3322</span></a>    <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">),</span> <span class="n">mask</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">),</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="get_top_of_closure-3323"><a href="#-3323"><span class="linenos">3323</span></a>    <span class="n">xy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="n">t</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="get_top_of_closure-3324"><a href="#-3324"><span class="linenos">3324</span></a>    <span class="n">z</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="n">t</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
</span><span id="get_top_of_closure-3325"><a href="#-3325"><span class="linenos">3325</span></a>    <span class="n">outarray</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">inarray</span><span class="p">)</span>
</span><span id="get_top_of_closure-3326"><a href="#-3326"><span class="linenos">3326</span></a>    <span class="k">for</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="n">z</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">xy</span><span class="p">,</span> <span class="n">z</span><span class="p">):</span>
</span><span id="get_top_of_closure-3327"><a href="#-3327"><span class="linenos">3327</span></a>        <span class="n">zmin</span> <span class="o">=</span> <span class="n">z</span> <span class="o">-</span> <span class="n">pad_up</span>
</span><span id="get_top_of_closure-3328"><a href="#-3328"><span class="linenos">3328</span></a>        <span class="n">zmax</span> <span class="o">=</span> <span class="n">z</span> <span class="o">+</span> <span class="n">pad_down</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="get_top_of_closure-3329"><a href="#-3329"><span class="linenos">3329</span></a>        <span class="n">outarray</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">zmin</span><span class="p">:</span><span class="n">zmax</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="get_top_of_closure-3330"><a href="#-3330"><span class="linenos">3330</span></a>    <span class="k">return</span> <span class="n">outarray</span>
</span></pre></div>


            <div class="docstring"><p>Create a mask leaving only the top of a closure.</p>
</div>


                </section>
                <section id="lsq">
                            <input id="lsq-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">lsq</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">x</span>, </span><span class="param"><span class="n">y</span>, </span><span class="param"><span class="n">axis</span><span class="o">=-</span><span class="mi">1</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="lsq-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#lsq"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="lsq-3333"><a href="#-3333"><span class="linenos">3333</span></a><span class="k">def</span> <span class="nf">lsq</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">):</span>
</span><span id="lsq-3334"><a href="#-3334"><span class="linenos">3334</span></a>    <span class="c1">###</span>
</span><span id="lsq-3335"><a href="#-3335"><span class="linenos">3335</span></a>    <span class="c1">### compute the slope and intercept for an array with points to be fit</span>
</span><span id="lsq-3336"><a href="#-3336"><span class="linenos">3336</span></a>    <span class="c1">### in the last dimension. can be in other axis using the &#39;axis&#39; parmameter.</span>
</span><span id="lsq-3337"><a href="#-3337"><span class="linenos">3337</span></a>    <span class="c1">###</span>
</span><span id="lsq-3338"><a href="#-3338"><span class="linenos">3338</span></a>    <span class="c1">### returns:</span>
</span><span id="lsq-3339"><a href="#-3339"><span class="linenos">3339</span></a>    <span class="c1">### - intercept</span>
</span><span id="lsq-3340"><a href="#-3340"><span class="linenos">3340</span></a>    <span class="c1">### - slope</span>
</span><span id="lsq-3341"><a href="#-3341"><span class="linenos">3341</span></a>    <span class="c1">### - pearson r (normalized cross-correlation coefficient)</span>
</span><span id="lsq-3342"><a href="#-3342"><span class="linenos">3342</span></a>    <span class="c1">###</span>
</span><span id="lsq-3343"><a href="#-3343"><span class="linenos">3343</span></a>    <span class="c1">### output will have dimensions of input with one less axis</span>
</span><span id="lsq-3344"><a href="#-3344"><span class="linenos">3344</span></a>    <span class="c1">### - (specified by axis parameter)</span>
</span><span id="lsq-3345"><a href="#-3345"><span class="linenos">3345</span></a>    <span class="c1">###</span>
</span><span id="lsq-3346"><a href="#-3346"><span class="linenos">3346</span></a>
</span><span id="lsq-3347"><a href="#-3347"><span class="linenos">3347</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="lsq-3348"><a href="#-3348"><span class="linenos">3348</span></a><span class="sd">    # compute x and y with mean removed</span>
</span><span id="lsq-3349"><a href="#-3349"><span class="linenos">3349</span></a><span class="sd">    x_zeromean = x * 1.</span>
</span><span id="lsq-3350"><a href="#-3350"><span class="linenos">3350</span></a><span class="sd">    x_zeromean -= x.mean(axis=axis).reshape(x.shape[0],x.shape[1],1)</span>
</span><span id="lsq-3351"><a href="#-3351"><span class="linenos">3351</span></a><span class="sd">    y_zeromean = y * 1.</span>
</span><span id="lsq-3352"><a href="#-3352"><span class="linenos">3352</span></a><span class="sd">    y_zeromean -= y.mean(axis=axis).reshape(y.shape[0],y.shape[1],1)</span>
</span><span id="lsq-3353"><a href="#-3353"><span class="linenos">3353</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="lsq-3354"><a href="#-3354"><span class="linenos">3354</span></a>
</span><span id="lsq-3355"><a href="#-3355"><span class="linenos">3355</span></a>    <span class="c1"># compute pearsonr</span>
</span><span id="lsq-3356"><a href="#-3356"><span class="linenos">3356</span></a>    <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="n">y</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">)</span> <span class="o">/</span> <span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">axis</span><span class="p">]</span>
</span><span id="lsq-3357"><a href="#-3357"><span class="linenos">3357</span></a>    <span class="n">r</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span>
</span><span id="lsq-3358"><a href="#-3358"><span class="linenos">3358</span></a>        <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">x</span> <span class="o">**</span> <span class="mi">2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">axis</span><span class="p">])</span>
</span><span id="lsq-3359"><a href="#-3359"><span class="linenos">3359</span></a>        <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">y</span> <span class="o">**</span> <span class="mi">2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">axis</span><span class="p">])</span>
</span><span id="lsq-3360"><a href="#-3360"><span class="linenos">3360</span></a>    <span class="p">)</span>
</span><span id="lsq-3361"><a href="#-3361"><span class="linenos">3361</span></a>
</span><span id="lsq-3362"><a href="#-3362"><span class="linenos">3362</span></a>    <span class="c1"># compute slope</span>
</span><span id="lsq-3363"><a href="#-3363"><span class="linenos">3363</span></a>    <span class="n">slope</span> <span class="o">=</span> <span class="n">r</span> <span class="o">*</span> <span class="n">y</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">)</span> <span class="o">/</span> <span class="n">x</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">)</span>
</span><span id="lsq-3364"><a href="#-3364"><span class="linenos">3364</span></a>
</span><span id="lsq-3365"><a href="#-3365"><span class="linenos">3365</span></a>    <span class="c1"># compute intercept</span>
</span><span id="lsq-3366"><a href="#-3366"><span class="linenos">3366</span></a>    <span class="n">intercept</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">)</span> <span class="o">-</span> <span class="n">slope</span> <span class="o">*</span> <span class="n">x</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">)</span>
</span><span id="lsq-3367"><a href="#-3367"><span class="linenos">3367</span></a>
</span><span id="lsq-3368"><a href="#-3368"><span class="linenos">3368</span></a>    <span class="k">return</span> <span class="n">intercept</span><span class="p">,</span> <span class="n">slope</span><span class="p">,</span> <span class="n">r</span>
</span></pre></div>


            <div class="docstring"><h1 id="compute-x-and-y-with-mean-removed">compute x and y with mean removed</h1>

<p>x_zeromean = x * 1.
x_zeromean -= x.mean(axis=axis).reshape(x.shape[0],x.shape[1],1)
y_zeromean = y * 1.
y_zeromean -= y.mean(axis=axis).reshape(y.shape[0],y.shape[1],1)</p>
</div>


                </section>
                <section id="compute_ai_gi">
                            <input id="compute_ai_gi-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">compute_ai_gi</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">parameters</span>, </span><span class="param"><span class="n">seismic_data</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="compute_ai_gi-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#compute_ai_gi"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="compute_ai_gi-3371"><a href="#-3371"><span class="linenos">3371</span></a><span class="k">def</span> <span class="nf">compute_ai_gi</span><span class="p">(</span><span class="n">parameters</span><span class="p">,</span> <span class="n">seismic_data</span><span class="p">):</span>
</span><span id="compute_ai_gi-3372"><a href="#-3372"><span class="linenos">3372</span></a>    <span class="sd">&quot;&quot;&quot;[summary]</span>
</span><span id="compute_ai_gi-3373"><a href="#-3373"><span class="linenos">3373</span></a>
</span><span id="compute_ai_gi-3374"><a href="#-3374"><span class="linenos">3374</span></a><span class="sd">    Args:</span>
</span><span id="compute_ai_gi-3375"><a href="#-3375"><span class="linenos">3375</span></a><span class="sd">        cfg (Parameter class object): Model Parameters</span>
</span><span id="compute_ai_gi-3376"><a href="#-3376"><span class="linenos">3376</span></a><span class="sd">        seismic_data (np.array): Seismic data with shape n * x * y * z,</span>
</span><span id="compute_ai_gi-3377"><a href="#-3377"><span class="linenos">3377</span></a><span class="sd">                                 where n is number of angle stacks</span>
</span><span id="compute_ai_gi-3378"><a href="#-3378"><span class="linenos">3378</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="compute_ai_gi-3379"><a href="#-3379"><span class="linenos">3379</span></a>    <span class="n">inc_angles</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">parameters</span><span class="o">.</span><span class="n">incident_angles</span><span class="p">)</span>
</span><span id="compute_ai_gi-3380"><a href="#-3380"><span class="linenos">3380</span></a>    <span class="n">inc_angles</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">inc_angles</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">180.0</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
</span><span id="compute_ai_gi-3381"><a href="#-3381"><span class="linenos">3381</span></a>    <span class="n">inc_angles</span> <span class="o">=</span> <span class="n">inc_angles</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">inc_angles</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="compute_ai_gi-3382"><a href="#-3382"><span class="linenos">3382</span></a>
</span><span id="compute_ai_gi-3383"><a href="#-3383"><span class="linenos">3383</span></a>    <span class="n">intercept</span><span class="p">,</span> <span class="n">slope</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">lsq</span><span class="p">(</span><span class="n">inc_angles</span><span class="p">,</span> <span class="n">seismic_data</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="compute_ai_gi-3384"><a href="#-3384"><span class="linenos">3384</span></a>
</span><span id="compute_ai_gi-3385"><a href="#-3385"><span class="linenos">3385</span></a>    <span class="n">intercept</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">intercept</span><span class="p">)]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="compute_ai_gi-3386"><a href="#-3386"><span class="linenos">3386</span></a>    <span class="n">slope</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">slope</span><span class="p">)]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="compute_ai_gi-3387"><a href="#-3387"><span class="linenos">3387</span></a>    <span class="n">intercept</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="n">intercept</span><span class="p">)]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="compute_ai_gi-3388"><a href="#-3388"><span class="linenos">3388</span></a>    <span class="n">slope</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="n">slope</span><span class="p">)]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="compute_ai_gi-3389"><a href="#-3389"><span class="linenos">3389</span></a>    <span class="k">return</span> <span class="n">intercept</span><span class="p">,</span> <span class="n">slope</span>
</span></pre></div>


            <div class="docstring"><p>[summary]</p>

<p>Args:
    cfg (Parameter class object): Model Parameters
    seismic_data (np.array): Seismic data with shape n * x * y * z,
                             where n is number of angle stacks</p>
</div>


                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "../search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `../${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.kind) {
                    case "function":
                        if (doc.fullname.endsWith(".__init__")) {
                            heading = `<span class="name">${doc.fullname.replace(/\.__init__$/, "")}</span>${doc.signature}`;
                        } else {
                            heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span>${doc.signature}`;
                        }
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value">${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.kind}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>