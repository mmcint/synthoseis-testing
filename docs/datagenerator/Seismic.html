<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 12.3.0"/>
    <title>datagenerator.Seismic API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent }nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .pdoc-alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:1rem center;margin-bottom:1rem;}.pdoc .pdoc-alert > *:last-child{margin-bottom:0;}.pdoc .pdoc-alert-note {color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--code);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="../datagenerator.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                &nbsp;datagenerator</a>


            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>



        <h2>API Documentation</h2>
            <ul class="memberlist">
            <li>
                    <a class="class" href="#SeismicVolume">SeismicVolume</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#SeismicVolume.__init__">SeismicVolume</a>
                        </li>
                        <li>
                                <a class="function" href="#SeismicVolume.build_elastic_properties">build_elastic_properties</a>
                        </li>
                        <li>
                                <a class="function" href="#SeismicVolume.bandlimit_volumes_wavelets">bandlimit_volumes_wavelets</a>
                        </li>
                        <li>
                                <a class="function" href="#SeismicVolume.postprocess_rfc_cubes">postprocess_rfc_cubes</a>
                        </li>
                        <li>
                                <a class="function" href="#SeismicVolume.apply_augmentations">apply_augmentations</a>
                        </li>
                        <li>
                                <a class="function" href="#SeismicVolume.apply_rmo">apply_rmo</a>
                        </li>
                        <li>
                                <a class="function" href="#SeismicVolume.build_seismic_volumes">build_seismic_volumes</a>
                        </li>
                        <li>
                                <a class="function" href="#SeismicVolume.write_final_cubes_to_disk">write_final_cubes_to_disk</a>
                        </li>
                        <li>
                                <a class="function" href="#SeismicVolume.random_z_rho_vp_vs">random_z_rho_vp_vs</a>
                        </li>
                        <li>
                                <a class="function" href="#SeismicVolume.create_rfc_volumes">create_rfc_volumes</a>
                        </li>
                        <li>
                                <a class="function" href="#SeismicVolume.noise_3d">noise_3d</a>
                        </li>
                        <li>
                                <a class="function" href="#SeismicVolume.add_weighted_noise">add_weighted_noise</a>
                        </li>
                        <li>
                                <a class="function" href="#SeismicVolume.apply_bandlimits">apply_bandlimits</a>
                        </li>
                        <li>
                                <a class="function" href="#SeismicVolume.apply_lateral_filter">apply_lateral_filter</a>
                        </li>
                        <li>
                                <a class="function" href="#SeismicVolume.apply_cumsum">apply_cumsum</a>
                        </li>
                        <li>
                                <a class="function" href="#SeismicVolume.stack_substacks">stack_substacks</a>
                        </li>
                        <li>
                                <a class="function" href="#SeismicVolume.augment_data_and_labels">augment_data_and_labels</a>
                        </li>
                        <li>
                                <a class="function" href="#SeismicVolume.compute_randomRMO_1D">compute_randomRMO_1D</a>
                        </li>
                        <li>
                                <a class="function" href="#SeismicVolume.apply_rmo_augmentation">apply_rmo_augmentation</a>
                        </li>
                        <li>
                                <a class="function" href="#SeismicVolume.build_property_models_randomised_depth">build_property_models_randomised_depth</a>
                        </li>
                        <li>
                                <a class="function" href="#SeismicVolume.water_properties">water_properties</a>
                        </li>
                        <li>
                                <a class="function" href="#SeismicVolume.get_delta_z_layer">get_delta_z_layer</a>
                        </li>
                        <li>
                                <a class="function" href="#SeismicVolume.get_delta_z_properties">get_delta_z_properties</a>
                        </li>
                        <li>
                                <a class="function" href="#SeismicVolume.calculate_shales">calculate_shales</a>
                        </li>
                        <li>
                                <a class="function" href="#SeismicVolume.calculate_sands">calculate_sands</a>
                        </li>
                        <li>
                                <a class="function" href="#SeismicVolume.fix_zero_values_at_base">fix_zero_values_at_base</a>
                        </li>
                        <li>
                                <a class="function" href="#SeismicVolume.apply_scaling_factors">apply_scaling_factors</a>
                        </li>
                        <li>
                                <a class="function" href="#SeismicVolume.write_property_volumes_to_disk">write_property_volumes_to_disk</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#ElasticProperties3D">ElasticProperties3D</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#ElasticProperties3D.__init__">ElasticProperties3D</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#RFC">RFC</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#RFC.__init__">RFC</a>
                        </li>
                        <li>
                                <a class="function" href="#RFC.normal_incidence_rfc">normal_incidence_rfc</a>
                        </li>
                        <li>
                                <a class="function" href="#RFC.shuey">shuey</a>
                        </li>
                        <li>
                                <a class="function" href="#RFC.zoeppritz_reflectivity">zoeppritz_reflectivity</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="function" href="#derive_butterworth_bandpass">derive_butterworth_bandpass</a>
            </li>
            <li>
                    <a class="function" href="#apply_butterworth_bandpass">apply_butterworth_bandpass</a>
            </li>
            <li>
                    <a class="function" href="#trim_triangular">trim_triangular</a>
            </li>
            <li>
                    <a class="function" href="#apply_wavelet">apply_wavelet</a>
            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
<a href="./../datagenerator.html">datagenerator</a><wbr>.Seismic    </h1>

                
                        <input id="mod-Seismic-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-Seismic-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#-1"><span class="linenos">   1</span></a><span class="kn">import</span> <span class="nn">os</span>
</span><span id="L-2"><a href="#-2"><span class="linenos">   2</span></a><span class="kn">import</span> <span class="nn">itertools</span>
</span><span id="L-3"><a href="#-3"><span class="linenos">   3</span></a><span class="kn">from</span> <span class="nn">multiprocessing</span> <span class="kn">import</span> <span class="n">Pool</span>
</span><span id="L-4"><a href="#-4"><span class="linenos">   4</span></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span><span id="L-5"><a href="#-5"><span class="linenos">   5</span></a>
</span><span id="L-6"><a href="#-6"><span class="linenos">   6</span></a><span class="kn">from</span> <span class="nn">tqdm</span> <span class="kn">import</span> <span class="n">trange</span>
</span><span id="L-7"><a href="#-7"><span class="linenos">   7</span></a><span class="kn">from</span> <span class="nn">datagenerator.histogram_equalizer</span> <span class="kn">import</span> <span class="n">normalize_seismic</span>
</span><span id="L-8"><a href="#-8"><span class="linenos">   8</span></a><span class="kn">from</span> <span class="nn">datagenerator.Geomodels</span> <span class="kn">import</span> <span class="n">Geomodel</span>
</span><span id="L-9"><a href="#-9"><span class="linenos">   9</span></a><span class="kn">from</span> <span class="nn">datagenerator.util</span> <span class="kn">import</span> <span class="n">write_data_to_hdf</span>
</span><span id="L-10"><a href="#-10"><span class="linenos">  10</span></a><span class="kn">from</span> <span class="nn">datagenerator.wavelets</span> <span class="kn">import</span> <span class="n">generate_wavelet</span><span class="p">,</span> <span class="n">plot_wavelets</span>
</span><span id="L-11"><a href="#-11"><span class="linenos">  11</span></a><span class="kn">from</span> <span class="nn">rockphysics.RockPropertyModels</span> <span class="kn">import</span> <span class="n">select_rpm</span><span class="p">,</span> <span class="n">RockProperties</span><span class="p">,</span> <span class="n">EndMemberMixing</span>
</span><span id="L-12"><a href="#-12"><span class="linenos">  12</span></a>
</span><span id="L-13"><a href="#-13"><span class="linenos">  13</span></a>
</span><span id="L-14"><a href="#-14"><span class="linenos">  14</span></a><span class="k">class</span> <span class="nc">SeismicVolume</span><span class="p">(</span><span class="n">Geomodel</span><span class="p">):</span>
</span><span id="L-15"><a href="#-15"><span class="linenos">  15</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-16"><a href="#-16"><span class="linenos">  16</span></a><span class="sd">    SeismicVolume Class</span>
</span><span id="L-17"><a href="#-17"><span class="linenos">  17</span></a><span class="sd">    -------------------</span>
</span><span id="L-18"><a href="#-18"><span class="linenos">  18</span></a>
</span><span id="L-19"><a href="#-19"><span class="linenos">  19</span></a><span class="sd">    This class initializes the seismic volume that contains everything.</span>
</span><span id="L-20"><a href="#-20"><span class="linenos">  20</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-21"><a href="#-21"><span class="linenos">  21</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parameters</span><span class="p">,</span> <span class="n">faults</span><span class="p">,</span> <span class="n">closures</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-22"><a href="#-22"><span class="linenos">  22</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-23"><a href="#-23"><span class="linenos">  23</span></a><span class="sd">        __init__</span>
</span><span id="L-24"><a href="#-24"><span class="linenos">  24</span></a><span class="sd">        --------</span>
</span><span id="L-25"><a href="#-25"><span class="linenos">  25</span></a>
</span><span id="L-26"><a href="#-26"><span class="linenos">  26</span></a><span class="sd">        The initialization function.</span>
</span><span id="L-27"><a href="#-27"><span class="linenos">  27</span></a>
</span><span id="L-28"><a href="#-28"><span class="linenos">  28</span></a><span class="sd">        Parameters</span>
</span><span id="L-29"><a href="#-29"><span class="linenos">  29</span></a><span class="sd">        ----------</span>
</span><span id="L-30"><a href="#-30"><span class="linenos">  30</span></a><span class="sd">        parameters : datagenerator.Parameters</span>
</span><span id="L-31"><a href="#-31"><span class="linenos">  31</span></a><span class="sd">            The parameters object of the project.</span>
</span><span id="L-32"><a href="#-32"><span class="linenos">  32</span></a><span class="sd">        faults : np.ndarray</span>
</span><span id="L-33"><a href="#-33"><span class="linenos">  33</span></a><span class="sd">            The faults array.</span>
</span><span id="L-34"><a href="#-34"><span class="linenos">  34</span></a><span class="sd">        closures : np.ndarray</span>
</span><span id="L-35"><a href="#-35"><span class="linenos">  35</span></a><span class="sd">            The closures array.</span>
</span><span id="L-36"><a href="#-36"><span class="linenos">  36</span></a><span class="sd">        </span>
</span><span id="L-37"><a href="#-37"><span class="linenos">  37</span></a><span class="sd">        Returns</span>
</span><span id="L-38"><a href="#-38"><span class="linenos">  38</span></a><span class="sd">        -------</span>
</span><span id="L-39"><a href="#-39"><span class="linenos">  39</span></a><span class="sd">        None</span>
</span><span id="L-40"><a href="#-40"><span class="linenos">  40</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-41"><a href="#-41"><span class="linenos">  41</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span> <span class="o">=</span> <span class="n">parameters</span>
</span><span id="L-42"><a href="#-42"><span class="linenos">  42</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">faults</span> <span class="o">=</span> <span class="n">faults</span>
</span><span id="L-43"><a href="#-43"><span class="linenos">  43</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">traps</span> <span class="o">=</span> <span class="n">closures</span>
</span><span id="L-44"><a href="#-44"><span class="linenos">  44</span></a>
</span><span id="L-45"><a href="#-45"><span class="linenos">  45</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">model_qc_volumes</span><span class="p">:</span>
</span><span id="L-46"><a href="#-46"><span class="linenos">  46</span></a>            <span class="c1"># Add 0 and 45 degree angles to the list of user-input angles</span>
</span><span id="L-47"><a href="#-47"><span class="linenos">  47</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">angles</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">((</span><span class="mi">0</span><span class="p">,)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">incident_angles</span> <span class="o">+</span> <span class="p">(</span><span class="mi">45</span><span class="p">,))))</span>
</span><span id="L-48"><a href="#-48"><span class="linenos">  48</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-49"><a href="#-49"><span class="linenos">  49</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">angles</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">incident_angles</span>
</span><span id="L-50"><a href="#-50"><span class="linenos">  50</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="L-51"><a href="#-51"><span class="linenos">  51</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Angles: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">angles</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-52"><a href="#-52"><span class="linenos">  52</span></a>
</span><span id="L-53"><a href="#-53"><span class="linenos">  53</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">first_random_lyr</span> <span class="o">=</span> <span class="mi">20</span>  <span class="c1"># do not randomise shallow layers</span>
</span><span id="L-54"><a href="#-54"><span class="linenos">  54</span></a>
</span><span id="L-55"><a href="#-55"><span class="linenos">  55</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">rho</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="L-56"><a href="#-56"><span class="linenos">  56</span></a>            <span class="s2">&quot;rho&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">h5file</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ModelData</span><span class="o">.</span><span class="n">faulted_depth</span><span class="o">.</span><span class="n">shape</span>
</span><span id="L-57"><a href="#-57"><span class="linenos">  57</span></a>        <span class="p">)</span>
</span><span id="L-58"><a href="#-58"><span class="linenos">  58</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="L-59"><a href="#-59"><span class="linenos">  59</span></a>            <span class="s2">&quot;vp&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">h5file</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ModelData</span><span class="o">.</span><span class="n">faulted_depth</span><span class="o">.</span><span class="n">shape</span>
</span><span id="L-60"><a href="#-60"><span class="linenos">  60</span></a>        <span class="p">)</span>
</span><span id="L-61"><a href="#-61"><span class="linenos">  61</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="L-62"><a href="#-62"><span class="linenos">  62</span></a>            <span class="s2">&quot;vs&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">h5file</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ModelData</span><span class="o">.</span><span class="n">faulted_depth</span><span class="o">.</span><span class="n">shape</span>
</span><span id="L-63"><a href="#-63"><span class="linenos">  63</span></a>        <span class="p">)</span>
</span><span id="L-64"><a href="#-64"><span class="linenos">  64</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">rho_ff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="L-65"><a href="#-65"><span class="linenos">  65</span></a>            <span class="s2">&quot;rho_ff&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">h5file</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ModelData</span><span class="o">.</span><span class="n">faulted_depth</span><span class="o">.</span><span class="n">shape</span>
</span><span id="L-66"><a href="#-66"><span class="linenos">  66</span></a>        <span class="p">)</span>
</span><span id="L-67"><a href="#-67"><span class="linenos">  67</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vp_ff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="L-68"><a href="#-68"><span class="linenos">  68</span></a>            <span class="s2">&quot;vp_ff&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">h5file</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ModelData</span><span class="o">.</span><span class="n">faulted_depth</span><span class="o">.</span><span class="n">shape</span>
</span><span id="L-69"><a href="#-69"><span class="linenos">  69</span></a>        <span class="p">)</span>
</span><span id="L-70"><a href="#-70"><span class="linenos">  70</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vs_ff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="L-71"><a href="#-71"><span class="linenos">  71</span></a>            <span class="s2">&quot;vs_ff&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">h5file</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ModelData</span><span class="o">.</span><span class="n">faulted_depth</span><span class="o">.</span><span class="n">shape</span>
</span><span id="L-72"><a href="#-72"><span class="linenos">  72</span></a>        <span class="p">)</span>
</span><span id="L-73"><a href="#-73"><span class="linenos">  73</span></a>
</span><span id="L-74"><a href="#-74"><span class="linenos">  74</span></a>        <span class="n">seis_shape</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-75"><a href="#-75"><span class="linenos">  75</span></a>            <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">angles</span><span class="p">),</span>
</span><span id="L-76"><a href="#-76"><span class="linenos">  76</span></a>            <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">h5file</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ModelData</span><span class="o">.</span><span class="n">faulted_depth</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
</span><span id="L-77"><a href="#-77"><span class="linenos">  77</span></a>        <span class="p">)</span>
</span><span id="L-78"><a href="#-78"><span class="linenos">  78</span></a>        <span class="n">rfc_shape</span> <span class="o">=</span> <span class="p">(</span><span class="n">seis_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">seis_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">seis_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">seis_shape</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-79"><a href="#-79"><span class="linenos">  79</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">rfc_raw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span><span class="s2">&quot;rfc_raw&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">rfc_shape</span><span class="p">)</span>
</span><span id="L-80"><a href="#-80"><span class="linenos">  80</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">rfc_noise_added</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span><span class="s2">&quot;rfc_noise_added&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">rfc_shape</span><span class="p">)</span>
</span><span id="L-81"><a href="#-81"><span class="linenos">  81</span></a>
</span><span id="L-82"><a href="#-82"><span class="linenos">  82</span></a>    <span class="k">def</span> <span class="nf">build_elastic_properties</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mixing_method</span><span class="o">=</span><span class="s2">&quot;inv_vel&quot;</span><span class="p">):</span>
</span><span id="L-83"><a href="#-83"><span class="linenos">  83</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-84"><a href="#-84"><span class="linenos">  84</span></a><span class="sd">        Build Elastic Properties</span>
</span><span id="L-85"><a href="#-85"><span class="linenos">  85</span></a><span class="sd">        ------------------------</span>
</span><span id="L-86"><a href="#-86"><span class="linenos">  86</span></a>
</span><span id="L-87"><a href="#-87"><span class="linenos">  87</span></a><span class="sd">        Creates Rho, Vp, Vs volumes using depth trends.</span>
</span><span id="L-88"><a href="#-88"><span class="linenos">  88</span></a>
</span><span id="L-89"><a href="#-89"><span class="linenos">  89</span></a><span class="sd">        Parameters</span>
</span><span id="L-90"><a href="#-90"><span class="linenos">  90</span></a><span class="sd">        ----------</span>
</span><span id="L-91"><a href="#-91"><span class="linenos">  91</span></a><span class="sd">        mixing_method : str, optional</span>
</span><span id="L-92"><a href="#-92"><span class="linenos">  92</span></a><span class="sd">            Method for mixing Velocities. Defaults to &quot;inv_vel&quot;.</span>
</span><span id="L-93"><a href="#-93"><span class="linenos">  93</span></a>
</span><span id="L-94"><a href="#-94"><span class="linenos">  94</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-95"><a href="#-95"><span class="linenos">  95</span></a>        <span class="n">rpm</span> <span class="o">=</span> <span class="n">select_rpm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="p">)</span>
</span><span id="L-96"><a href="#-96"><span class="linenos">  96</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">build_property_models_randomised_depth</span><span class="p">(</span>
</span><span id="L-97"><a href="#-97"><span class="linenos">  97</span></a>            <span class="n">rpm</span><span class="p">,</span>
</span><span id="L-98"><a href="#-98"><span class="linenos">  98</span></a>            <span class="n">mixing_method</span><span class="o">=</span><span class="n">mixing_method</span>
</span><span id="L-99"><a href="#-99"><span class="linenos">  99</span></a>        <span class="p">)</span>
</span><span id="L-100"><a href="#-100"><span class="linenos"> 100</span></a>
</span><span id="L-101"><a href="#-101"><span class="linenos"> 101</span></a>    <span class="k">def</span> <span class="nf">bandlimit_volumes_wavelets</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_wavelets</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
</span><span id="L-102"><a href="#-102"><span class="linenos"> 102</span></a>        <span class="c1"># Pre-prepared n, m, f filter_specs from npy file</span>
</span><span id="L-103"><a href="#-103"><span class="linenos"> 103</span></a>        <span class="n">fs_nr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">wavelets</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-104"><a href="#-104"><span class="linenos"> 104</span></a>        <span class="n">fs_md</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">wavelets</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="L-105"><a href="#-105"><span class="linenos"> 105</span></a>        <span class="n">fs_fr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">wavelets</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</span><span id="L-106"><a href="#-106"><span class="linenos"> 106</span></a>
</span><span id="L-107"><a href="#-107"><span class="linenos"> 107</span></a>        <span class="k">for</span> <span class="n">wavelet_count</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_wavelets</span><span class="p">):</span>
</span><span id="L-108"><a href="#-108"><span class="linenos"> 108</span></a>            <span class="n">low_freq_pctile</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
</span><span id="L-109"><a href="#-109"><span class="linenos"> 109</span></a>            <span class="n">mid_freq_pctile</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
</span><span id="L-110"><a href="#-110"><span class="linenos"> 110</span></a>            <span class="n">high_freq_pctile</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
</span><span id="L-111"><a href="#-111"><span class="linenos"> 111</span></a>            <span class="n">low_med_high_percentiles</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-112"><a href="#-112"><span class="linenos"> 112</span></a>                <span class="n">low_freq_pctile</span><span class="p">,</span>
</span><span id="L-113"><a href="#-113"><span class="linenos"> 113</span></a>                <span class="n">mid_freq_pctile</span><span class="p">,</span>
</span><span id="L-114"><a href="#-114"><span class="linenos"> 114</span></a>                <span class="n">high_freq_pctile</span><span class="p">,</span>
</span><span id="L-115"><a href="#-115"><span class="linenos"> 115</span></a>            <span class="p">)</span>
</span><span id="L-116"><a href="#-116"><span class="linenos"> 116</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;low_med_high_percentiles: </span><span class="si">{</span><span class="n">low_med_high_percentiles</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-117"><a href="#-117"><span class="linenos"> 117</span></a>            <span class="n">f_nr</span><span class="p">,</span> <span class="n">a_nr</span><span class="p">,</span> <span class="n">w_nr</span> <span class="o">=</span> <span class="n">generate_wavelet</span><span class="p">(</span><span class="n">fs_nr</span><span class="p">,</span> <span class="n">low_med_high_percentiles</span><span class="p">)</span>
</span><span id="L-118"><a href="#-118"><span class="linenos"> 118</span></a>            <span class="n">f_md</span><span class="p">,</span> <span class="n">a_md</span><span class="p">,</span> <span class="n">w_md</span> <span class="o">=</span> <span class="n">generate_wavelet</span><span class="p">(</span><span class="n">fs_md</span><span class="p">,</span> <span class="n">low_med_high_percentiles</span><span class="p">)</span>
</span><span id="L-119"><a href="#-119"><span class="linenos"> 119</span></a>            <span class="n">f_fr</span><span class="p">,</span> <span class="n">a_fr</span><span class="p">,</span> <span class="n">w_fr</span> <span class="o">=</span> <span class="n">generate_wavelet</span><span class="p">(</span><span class="n">fs_fr</span><span class="p">,</span> <span class="n">low_med_high_percentiles</span><span class="p">)</span>
</span><span id="L-120"><a href="#-120"><span class="linenos"> 120</span></a>            <span class="n">_f</span> <span class="o">=</span> <span class="p">(</span><span class="n">f_nr</span><span class="p">,</span> <span class="n">f_md</span><span class="p">,</span> <span class="n">f_fr</span><span class="p">)</span>
</span><span id="L-121"><a href="#-121"><span class="linenos"> 121</span></a>            <span class="n">_a</span> <span class="o">=</span> <span class="p">(</span><span class="n">a_nr</span><span class="p">,</span> <span class="n">a_md</span><span class="p">,</span> <span class="n">a_fr</span><span class="p">)</span>
</span><span id="L-122"><a href="#-122"><span class="linenos"> 122</span></a>            <span class="n">_w</span> <span class="o">=</span> <span class="p">(</span><span class="n">w_nr</span><span class="p">,</span> <span class="n">w_md</span><span class="p">,</span> <span class="n">w_fr</span><span class="p">)</span>
</span><span id="L-123"><a href="#-123"><span class="linenos"> 123</span></a>            <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Near&quot;</span><span class="p">,</span> <span class="s2">&quot;Mid&quot;</span><span class="p">,</span> <span class="s2">&quot;Far&quot;</span><span class="p">]</span>
</span><span id="L-124"><a href="#-124"><span class="linenos"> 124</span></a>            <span class="n">pngname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="L-125"><a href="#-125"><span class="linenos"> 125</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">work_subfolder</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;random_wavelets_</span><span class="si">{</span><span class="n">wavelet_count</span><span class="si">}</span><span class="s2">.png&quot;</span>
</span><span id="L-126"><a href="#-126"><span class="linenos"> 126</span></a>            <span class="p">)</span>
</span><span id="L-127"><a href="#-127"><span class="linenos"> 127</span></a>            <span class="n">plot_wavelets</span><span class="p">(</span><span class="n">_f</span><span class="p">,</span> <span class="n">_a</span><span class="p">,</span> <span class="n">_w</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">pngname</span><span class="p">)</span>
</span><span id="L-128"><a href="#-128"><span class="linenos"> 128</span></a>
</span><span id="L-129"><a href="#-129"><span class="linenos"> 129</span></a>            <span class="n">rfc_bandlimited_wavelet</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rfc_noise_added</span><span class="p">)</span>
</span><span id="L-130"><a href="#-130"><span class="linenos"> 130</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">model_qc_volumes</span><span class="p">:</span>
</span><span id="L-131"><a href="#-131"><span class="linenos"> 131</span></a>                <span class="n">wavelets</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-132"><a href="#-132"><span class="linenos"> 132</span></a>                    <span class="n">w_nr</span><span class="p">,</span>
</span><span id="L-133"><a href="#-133"><span class="linenos"> 133</span></a>                    <span class="n">w_nr</span><span class="p">,</span>
</span><span id="L-134"><a href="#-134"><span class="linenos"> 134</span></a>                    <span class="n">w_md</span><span class="p">,</span>
</span><span id="L-135"><a href="#-135"><span class="linenos"> 135</span></a>                    <span class="n">w_fr</span><span class="p">,</span>
</span><span id="L-136"><a href="#-136"><span class="linenos"> 136</span></a>                    <span class="n">w_fr</span><span class="p">,</span>
</span><span id="L-137"><a href="#-137"><span class="linenos"> 137</span></a>                <span class="p">]</span>  <span class="c1"># use near for 0 and far for 45 deg cubes</span>
</span><span id="L-138"><a href="#-138"><span class="linenos"> 138</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-139"><a href="#-139"><span class="linenos"> 139</span></a>                <span class="n">wavelets</span> <span class="o">=</span> <span class="p">[</span><span class="n">w_nr</span><span class="p">,</span> <span class="n">w_md</span><span class="p">,</span> <span class="n">w_fr</span><span class="p">]</span>
</span><span id="L-140"><a href="#-140"><span class="linenos"> 140</span></a>
</span><span id="L-141"><a href="#-141"><span class="linenos"> 141</span></a>            <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">rfc_bandlimited_wavelet</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="L-142"><a href="#-142"><span class="linenos"> 142</span></a>                <span class="n">rfc_bandlimited_wavelet</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">apply_wavelet</span><span class="p">(</span>
</span><span id="L-143"><a href="#-143"><span class="linenos"> 143</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">rfc_noise_added</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span> <span class="n">wavelets</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
</span><span id="L-144"><a href="#-144"><span class="linenos"> 144</span></a>                <span class="p">)</span>
</span><span id="L-145"><a href="#-145"><span class="linenos"> 145</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">lateral_filter_size</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-146"><a href="#-146"><span class="linenos"> 146</span></a>                <span class="c1"># Apply lateral smoothing filter</span>
</span><span id="L-147"><a href="#-147"><span class="linenos"> 147</span></a>                <span class="n">rfc_bandlimited_wavelet</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_lateral_filter</span><span class="p">(</span>
</span><span id="L-148"><a href="#-148"><span class="linenos"> 148</span></a>                    <span class="n">rfc_bandlimited_wavelet</span>
</span><span id="L-149"><a href="#-149"><span class="linenos"> 149</span></a>                <span class="p">)</span>
</span><span id="L-150"><a href="#-150"><span class="linenos"> 150</span></a>            <span class="n">cumsum_wavelet_noise_added</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_cumsum</span><span class="p">(</span><span class="n">rfc_bandlimited_wavelet</span><span class="p">)</span>
</span><span id="L-151"><a href="#-151"><span class="linenos"> 151</span></a>            <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">write_final_cubes_to_disk</span><span class="p">(</span>
</span><span id="L-152"><a href="#-152"><span class="linenos"> 152</span></a>                <span class="n">rfc_bandlimited_wavelet</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;seismicCubes_RFC_Wavelet_</span><span class="si">{</span><span class="n">wavelet_count</span><span class="si">}</span><span class="s2">_&quot;</span>
</span><span id="L-153"><a href="#-153"><span class="linenos"> 153</span></a>            <span class="p">)</span>
</span><span id="L-154"><a href="#-154"><span class="linenos"> 154</span></a>            <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">write_final_cubes_to_disk</span><span class="p">(</span>
</span><span id="L-155"><a href="#-155"><span class="linenos"> 155</span></a>                <span class="n">cumsum_wavelet_noise_added</span><span class="p">,</span>
</span><span id="L-156"><a href="#-156"><span class="linenos"> 156</span></a>                <span class="sa">f</span><span class="s2">&quot;seismicCubes_cumsum_Wavelet_</span><span class="si">{</span><span class="n">wavelet_count</span><span class="si">}</span><span class="s2">_&quot;</span><span class="p">,</span>
</span><span id="L-157"><a href="#-157"><span class="linenos"> 157</span></a>            <span class="p">)</span>
</span><span id="L-158"><a href="#-158"><span class="linenos"> 158</span></a>
</span><span id="L-159"><a href="#-159"><span class="linenos"> 159</span></a>    <span class="k">def</span> <span class="nf">postprocess_rfc_cubes</span><span class="p">(</span>
</span><span id="L-160"><a href="#-160"><span class="linenos"> 160</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">rfc_data</span><span class="p">,</span> <span class="n">filename_suffix</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">bb</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">stack</span><span class="o">=</span><span class="kc">False</span>
</span><span id="L-161"><a href="#-161"><span class="linenos"> 161</span></a>    <span class="p">):</span>
</span><span id="L-162"><a href="#-162"><span class="linenos"> 162</span></a>        <span class="sd">&quot;&quot;&quot;Postprocess the RFC cubes.&quot;&quot;&quot;</span>
</span><span id="L-163"><a href="#-163"><span class="linenos"> 163</span></a>        <span class="k">if</span> <span class="n">bb</span><span class="p">:</span>
</span><span id="L-164"><a href="#-164"><span class="linenos"> 164</span></a>            <span class="n">bandlimited</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_bandlimits</span><span class="p">(</span><span class="n">rfc_data</span><span class="p">,</span> <span class="p">(</span><span class="mf">4.0</span><span class="p">,</span> <span class="mf">90.0</span><span class="p">))</span>
</span><span id="L-165"><a href="#-165"><span class="linenos"> 165</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-166"><a href="#-166"><span class="linenos"> 166</span></a>            <span class="n">bandlimited</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_bandlimits</span><span class="p">(</span><span class="n">rfc_data</span><span class="p">)</span>
</span><span id="L-167"><a href="#-167"><span class="linenos"> 167</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">lateral_filter_size</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-168"><a href="#-168"><span class="linenos"> 168</span></a>            <span class="n">bandlimited</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_lateral_filter</span><span class="p">(</span><span class="n">bandlimited</span><span class="p">)</span>
</span><span id="L-169"><a href="#-169"><span class="linenos"> 169</span></a>        <span class="k">if</span> <span class="n">filename_suffix</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
</span><span id="L-170"><a href="#-170"><span class="linenos"> 170</span></a>            <span class="n">fname</span> <span class="o">=</span> <span class="s2">&quot;seismicCubes_RFC_&quot;</span>
</span><span id="L-171"><a href="#-171"><span class="linenos"> 171</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-172"><a href="#-172"><span class="linenos"> 172</span></a>            <span class="n">fname</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;seismicCubes_RFC_</span><span class="si">{</span><span class="n">filename_suffix</span><span class="si">}</span><span class="s2">_&quot;</span>
</span><span id="L-173"><a href="#-173"><span class="linenos"> 173</span></a>        <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">write_final_cubes_to_disk</span><span class="p">(</span><span class="n">bandlimited</span><span class="p">,</span> <span class="n">fname</span><span class="p">)</span>
</span><span id="L-174"><a href="#-174"><span class="linenos"> 174</span></a>        <span class="k">if</span> <span class="n">stack</span><span class="p">:</span>
</span><span id="L-175"><a href="#-175"><span class="linenos"> 175</span></a>            <span class="n">rfc_fullstack</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stack_substacks</span><span class="p">(</span>
</span><span id="L-176"><a href="#-176"><span class="linenos"> 176</span></a>                <span class="p">[</span><span class="n">bandlimited</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">angles</span><span class="p">)]</span>
</span><span id="L-177"><a href="#-177"><span class="linenos"> 177</span></a>            <span class="p">)</span>
</span><span id="L-178"><a href="#-178"><span class="linenos"> 178</span></a>            <span class="n">rfc_fullstack_scaled</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scale_seismic</span><span class="p">(</span><span class="n">rfc_fullstack</span><span class="p">)</span>
</span><span id="L-179"><a href="#-179"><span class="linenos"> 179</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">write_cube_to_disk</span><span class="p">(</span>
</span><span id="L-180"><a href="#-180"><span class="linenos"> 180</span></a>                <span class="n">rfc_fullstack_scaled</span><span class="p">,</span>
</span><span id="L-181"><a href="#-181"><span class="linenos"> 181</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">fname</span><span class="si">}</span><span class="s2">fullstack&quot;</span><span class="p">,</span>
</span><span id="L-182"><a href="#-182"><span class="linenos"> 182</span></a>            <span class="p">)</span>
</span><span id="L-183"><a href="#-183"><span class="linenos"> 183</span></a>
</span><span id="L-184"><a href="#-184"><span class="linenos"> 184</span></a>        <span class="n">cumsum</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_cumsum</span><span class="p">(</span><span class="n">bandlimited</span><span class="p">)</span>
</span><span id="L-185"><a href="#-185"><span class="linenos"> 185</span></a>        <span class="k">if</span> <span class="n">filename_suffix</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
</span><span id="L-186"><a href="#-186"><span class="linenos"> 186</span></a>            <span class="n">fname</span> <span class="o">=</span> <span class="s2">&quot;seismicCubes_cumsum_&quot;</span>
</span><span id="L-187"><a href="#-187"><span class="linenos"> 187</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-188"><a href="#-188"><span class="linenos"> 188</span></a>            <span class="n">fname</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;seismicCubes_cumsum_</span><span class="si">{</span><span class="n">filename_suffix</span><span class="si">}</span><span class="s2">_&quot;</span>
</span><span id="L-189"><a href="#-189"><span class="linenos"> 189</span></a>        <span class="n">normalised_cumsum</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">write_final_cubes_to_disk</span><span class="p">(</span><span class="n">cumsum</span><span class="p">,</span> <span class="n">fname</span><span class="p">)</span>
</span><span id="L-190"><a href="#-190"><span class="linenos"> 190</span></a>        <span class="k">if</span> <span class="n">stack</span><span class="p">:</span>
</span><span id="L-191"><a href="#-191"><span class="linenos"> 191</span></a>            <span class="n">rai_fullstack</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stack_substacks</span><span class="p">(</span>
</span><span id="L-192"><a href="#-192"><span class="linenos"> 192</span></a>                <span class="p">[</span><span class="n">cumsum</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">angles</span><span class="p">)]</span>
</span><span id="L-193"><a href="#-193"><span class="linenos"> 193</span></a>            <span class="p">)</span>
</span><span id="L-194"><a href="#-194"><span class="linenos"> 194</span></a>            <span class="n">rai_fullstack_scaled</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scale_seismic</span><span class="p">(</span><span class="n">rai_fullstack</span><span class="p">)</span>
</span><span id="L-195"><a href="#-195"><span class="linenos"> 195</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">write_cube_to_disk</span><span class="p">(</span>
</span><span id="L-196"><a href="#-196"><span class="linenos"> 196</span></a>                <span class="n">rai_fullstack_scaled</span><span class="p">,</span>
</span><span id="L-197"><a href="#-197"><span class="linenos"> 197</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">fname</span><span class="si">}</span><span class="s2">fullstack&quot;</span><span class="p">,</span>
</span><span id="L-198"><a href="#-198"><span class="linenos"> 198</span></a>            <span class="p">)</span>
</span><span id="L-199"><a href="#-199"><span class="linenos"> 199</span></a>        <span class="k">return</span> <span class="n">normalised_cumsum</span>
</span><span id="L-200"><a href="#-200"><span class="linenos"> 200</span></a>
</span><span id="L-201"><a href="#-201"><span class="linenos"> 201</span></a>    <span class="k">def</span> <span class="nf">apply_augmentations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;cumsum&quot;</span><span class="p">):</span>
</span><span id="L-202"><a href="#-202"><span class="linenos"> 202</span></a>        <span class="n">seabed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">faulted_depth_maps</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">digi</span>
</span><span id="L-203"><a href="#-203"><span class="linenos"> 203</span></a>        <span class="n">augmented_data</span><span class="p">,</span> <span class="n">augmented_labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">augment_data_and_labels</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">seabed</span><span class="p">)</span>
</span><span id="L-204"><a href="#-204"><span class="linenos"> 204</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ang</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">incident_angles</span><span class="p">):</span>
</span><span id="L-205"><a href="#-205"><span class="linenos"> 205</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="n">augmented_data</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
</span><span id="L-206"><a href="#-206"><span class="linenos"> 206</span></a>            <span class="n">fname</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;seismicCubes_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">ang</span><span class="si">}</span><span class="s2">_degrees_normalized_augmented&quot;</span>
</span><span id="L-207"><a href="#-207"><span class="linenos"> 207</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">write_cube_to_disk</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">fname</span><span class="p">)</span>
</span><span id="L-208"><a href="#-208"><span class="linenos"> 208</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">write_cube_to_disk</span><span class="p">(</span><span class="n">augmented_labels</span><span class="p">,</span> <span class="s2">&quot;hc_closures_augmented&quot;</span><span class="p">)</span>
</span><span id="L-209"><a href="#-209"><span class="linenos"> 209</span></a>
</span><span id="L-210"><a href="#-210"><span class="linenos"> 210</span></a>    <span class="k">def</span> <span class="nf">apply_rmo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;cumsum_RMO&quot;</span><span class="p">):</span>
</span><span id="L-211"><a href="#-211"><span class="linenos"> 211</span></a>        <span class="sd">&quot;&quot;&quot;Apply RMO to the cumsum with noise. Note rmo application expects angle in last dimension&quot;&quot;&quot;</span>
</span><span id="L-212"><a href="#-212"><span class="linenos"> 212</span></a>        <span class="n">rmo_indices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_randomRMO_1D</span><span class="p">(</span>
</span><span id="L-213"><a href="#-213"><span class="linenos"> 213</span></a>            <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">incident_angles</span><span class="p">,</span> <span class="n">velocity_fraction</span><span class="o">=</span><span class="mf">0.015</span>
</span><span id="L-214"><a href="#-214"><span class="linenos"> 214</span></a>        <span class="p">)</span>
</span><span id="L-215"><a href="#-215"><span class="linenos"> 215</span></a>        <span class="n">rmo_applied_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">moveaxis</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
</span><span id="L-216"><a href="#-216"><span class="linenos"> 216</span></a>        <span class="k">for</span> <span class="n">iline</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="L-217"><a href="#-217"><span class="linenos"> 217</span></a>            <span class="k">for</span> <span class="n">xline</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
</span><span id="L-218"><a href="#-218"><span class="linenos"> 218</span></a>                <span class="n">rmo_applied_data</span><span class="p">[</span><span class="n">iline</span><span class="p">,</span> <span class="n">xline</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_rmo_augmentation</span><span class="p">(</span>
</span><span id="L-219"><a href="#-219"><span class="linenos"> 219</span></a>                    <span class="n">np</span><span class="o">.</span><span class="n">moveaxis</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)[</span><span class="n">iline</span><span class="p">,</span> <span class="n">xline</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span>
</span><span id="L-220"><a href="#-220"><span class="linenos"> 220</span></a>                    <span class="n">rmo_indices</span><span class="p">,</span>
</span><span id="L-221"><a href="#-221"><span class="linenos"> 221</span></a>                    <span class="n">remove_mean_rmo</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-222"><a href="#-222"><span class="linenos"> 222</span></a>                <span class="p">)</span>
</span><span id="L-223"><a href="#-223"><span class="linenos"> 223</span></a>        <span class="n">rmo_applied_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">moveaxis</span><span class="p">(</span>
</span><span id="L-224"><a href="#-224"><span class="linenos"> 224</span></a>            <span class="n">rmo_applied_data</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span>
</span><span id="L-225"><a href="#-225"><span class="linenos"> 225</span></a>        <span class="p">)</span>  <span class="c1"># Put the angles back into 1st dimension</span>
</span><span id="L-226"><a href="#-226"><span class="linenos"> 226</span></a>        <span class="n">normalised_rmo_applied_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">write_final_cubes_to_disk</span><span class="p">(</span>
</span><span id="L-227"><a href="#-227"><span class="linenos"> 227</span></a>            <span class="n">rmo_applied_data</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;seismicCubes_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">_&quot;</span>
</span><span id="L-228"><a href="#-228"><span class="linenos"> 228</span></a>        <span class="p">)</span>
</span><span id="L-229"><a href="#-229"><span class="linenos"> 229</span></a>        <span class="k">return</span> <span class="n">normalised_rmo_applied_data</span>
</span><span id="L-230"><a href="#-230"><span class="linenos"> 230</span></a>
</span><span id="L-231"><a href="#-231"><span class="linenos"> 231</span></a>    <span class="k">def</span> <span class="nf">build_seismic_volumes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-232"><a href="#-232"><span class="linenos"> 232</span></a>        <span class="sd">&quot;&quot;&quot;Build Seismic volumes.</span>
</span><span id="L-233"><a href="#-233"><span class="linenos"> 233</span></a>
</span><span id="L-234"><a href="#-234"><span class="linenos"> 234</span></a><span class="sd">        * Use Zoeppritz to create RFC volumes for each required angle, add 0 &amp; 45 degree stacks for QC</span>
</span><span id="L-235"><a href="#-235"><span class="linenos"> 235</span></a><span class="sd">        * Add exponential weighted noise to the angle stacks</span>
</span><span id="L-236"><a href="#-236"><span class="linenos"> 236</span></a><span class="sd">        * Apply bandpass filter</span>
</span><span id="L-237"><a href="#-237"><span class="linenos"> 237</span></a><span class="sd">        * Apply lateral filter</span>
</span><span id="L-238"><a href="#-238"><span class="linenos"> 238</span></a><span class="sd">        * Calculate cumsum</span>
</span><span id="L-239"><a href="#-239"><span class="linenos"> 239</span></a><span class="sd">        * Create full stacks by stacking the user-input angles (i.e. not including 0, 45 degree stacks)</span>
</span><span id="L-240"><a href="#-240"><span class="linenos"> 240</span></a><span class="sd">        * Write seismic volumes to disk</span>
</span><span id="L-241"><a href="#-241"><span class="linenos"> 241</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-242"><a href="#-242"><span class="linenos"> 242</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="L-243"><a href="#-243"><span class="linenos"> 243</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="L-244"><a href="#-244"><span class="linenos"> 244</span></a>                <span class="sa">f</span><span class="s2">&quot;Generating 3D Rock Properties Rho, Vp and Vs using depth trends for project </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">project</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-245"><a href="#-245"><span class="linenos"> 245</span></a>            <span class="p">)</span>
</span><span id="L-246"><a href="#-246"><span class="linenos"> 246</span></a>        <span class="c1"># Calculate Raw RFC from rho, vp, vs using Zoeppritz &amp; write to HdF</span>
</span><span id="L-247"><a href="#-247"><span class="linenos"> 247</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">create_rfc_volumes</span><span class="p">()</span>
</span><span id="L-248"><a href="#-248"><span class="linenos"> 248</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">add_weighted_noise</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">faulted_depth_maps</span><span class="p">)</span>
</span><span id="L-249"><a href="#-249"><span class="linenos"> 249</span></a>        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="p">,</span> <span class="s2">&quot;wavelets&quot;</span><span class="p">):</span>
</span><span id="L-250"><a href="#-250"><span class="linenos"> 250</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">bandlimit_volumes_wavelets</span><span class="p">(</span><span class="n">n_wavelets</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-251"><a href="#-251"><span class="linenos"> 251</span></a>        <span class="n">normalised_cumsum</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">postprocess_rfc_cubes</span><span class="p">(</span>
</span><span id="L-252"><a href="#-252"><span class="linenos"> 252</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">rfc_noise_added</span><span class="p">[:],</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">stack</span><span class="o">=</span><span class="kc">True</span>
</span><span id="L-253"><a href="#-253"><span class="linenos"> 253</span></a>        <span class="p">)</span>
</span><span id="L-254"><a href="#-254"><span class="linenos"> 254</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">apply_augmentations</span><span class="p">(</span><span class="n">normalised_cumsum</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;cumsum&quot;</span><span class="p">)</span>
</span><span id="L-255"><a href="#-255"><span class="linenos"> 255</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">model_qc_volumes</span><span class="p">:</span>
</span><span id="L-256"><a href="#-256"><span class="linenos"> 256</span></a>            <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">postprocess_rfc_cubes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rfc_raw</span><span class="p">[:],</span> <span class="s2">&quot;noise_free&quot;</span><span class="p">,</span> <span class="n">bb</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="L-257"><a href="#-257"><span class="linenos"> 257</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">broadband_qc_volume</span><span class="p">:</span>
</span><span id="L-258"><a href="#-258"><span class="linenos"> 258</span></a>                <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">postprocess_rfc_cubes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rfc_raw</span><span class="p">[:],</span> <span class="s2">&quot;noise_free_bb&quot;</span><span class="p">,</span> <span class="n">bb</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-259"><a href="#-259"><span class="linenos"> 259</span></a>            <span class="n">normalised_cumsum_rmo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_rmo</span><span class="p">(</span><span class="n">normalised_cumsum</span><span class="p">)</span>
</span><span id="L-260"><a href="#-260"><span class="linenos"> 260</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">apply_augmentations</span><span class="p">(</span><span class="n">normalised_cumsum_rmo</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;cumsum_RMO&quot;</span><span class="p">)</span>
</span><span id="L-261"><a href="#-261"><span class="linenos"> 261</span></a>
</span><span id="L-262"><a href="#-262"><span class="linenos"> 262</span></a>    <span class="k">def</span> <span class="nf">_scale_seismic</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
</span><span id="L-263"><a href="#-263"><span class="linenos"> 263</span></a>        <span class="sd">&quot;&quot;&quot;Apply scaling factor to final seismic data volumes&quot;&quot;&quot;</span>
</span><span id="L-264"><a href="#-264"><span class="linenos"> 264</span></a>        <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
</span><span id="L-265"><a href="#-265"><span class="linenos"> 265</span></a>            <span class="n">avg_stdev</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">([</span><span class="n">data</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])])</span>
</span><span id="L-266"><a href="#-266"><span class="linenos"> 266</span></a>        <span class="k">elif</span> <span class="n">data</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="L-267"><a href="#-267"><span class="linenos"> 267</span></a>            <span class="n">avg_stdev</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
</span><span id="L-268"><a href="#-268"><span class="linenos"> 268</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-269"><a href="#-269"><span class="linenos"> 269</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="L-270"><a href="#-270"><span class="linenos"> 270</span></a>                <span class="sa">f</span><span class="s2">&quot;Input Data has </span><span class="si">{</span><span class="n">data</span><span class="o">.</span><span class="n">ndim</span><span class="si">}</span><span class="s2"> dimensions, should have 3 or 4 dimensions&quot;</span>
</span><span id="L-271"><a href="#-271"><span class="linenos"> 271</span></a>            <span class="p">)</span>
</span><span id="L-272"><a href="#-272"><span class="linenos"> 272</span></a>        <span class="n">scaled_data</span> <span class="o">=</span> <span class="n">data</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">/</span> <span class="n">avg_stdev</span>
</span><span id="L-273"><a href="#-273"><span class="linenos"> 273</span></a>        <span class="k">return</span> <span class="n">scaled_data</span>
</span><span id="L-274"><a href="#-274"><span class="linenos"> 274</span></a>
</span><span id="L-275"><a href="#-275"><span class="linenos"> 275</span></a>    <span class="k">def</span> <span class="nf">write_final_cubes_to_disk</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dat</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
</span><span id="L-276"><a href="#-276"><span class="linenos"> 276</span></a>        <span class="n">scaled_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scale_seismic</span><span class="p">(</span><span class="n">dat</span><span class="p">)</span>
</span><span id="L-277"><a href="#-277"><span class="linenos"> 277</span></a>
</span><span id="L-278"><a href="#-278"><span class="linenos"> 278</span></a>        <span class="c1"># Apply scaling factors to N, M, F cubes from csv file before determining clip limits</span>
</span><span id="L-279"><a href="#-279"><span class="linenos"> 279</span></a>        <span class="n">factor_near</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">rpm_scaling_factors</span><span class="p">[</span><span class="s2">&quot;nearfactor&quot;</span><span class="p">]</span>
</span><span id="L-280"><a href="#-280"><span class="linenos"> 280</span></a>        <span class="n">factor_mid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">rpm_scaling_factors</span><span class="p">[</span><span class="s2">&quot;midfactor&quot;</span><span class="p">]</span>
</span><span id="L-281"><a href="#-281"><span class="linenos"> 281</span></a>        <span class="n">factor_far</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">rpm_scaling_factors</span><span class="p">[</span><span class="s2">&quot;farfactor&quot;</span><span class="p">]</span>
</span><span id="L-282"><a href="#-282"><span class="linenos"> 282</span></a>        <span class="n">cube_incr</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-283"><a href="#-283"><span class="linenos"> 283</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">model_qc_volumes</span> <span class="ow">and</span> <span class="n">dat</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="L-284"><a href="#-284"><span class="linenos"> 284</span></a>            <span class="c1"># 0 degrees has been added at start, and 45 at end</span>
</span><span id="L-285"><a href="#-285"><span class="linenos"> 285</span></a>            <span class="n">cube_incr</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-286"><a href="#-286"><span class="linenos"> 286</span></a>        <span class="n">scaled_data</span><span class="p">[</span><span class="mi">0</span> <span class="o">+</span> <span class="n">cube_incr</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">*=</span> <span class="n">factor_near</span>
</span><span id="L-287"><a href="#-287"><span class="linenos"> 287</span></a>        <span class="n">scaled_data</span><span class="p">[</span><span class="mi">1</span> <span class="o">+</span> <span class="n">cube_incr</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">*=</span> <span class="n">factor_mid</span>
</span><span id="L-288"><a href="#-288"><span class="linenos"> 288</span></a>        <span class="n">scaled_data</span><span class="p">[</span><span class="mi">2</span> <span class="o">+</span> <span class="n">cube_incr</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">*=</span> <span class="n">factor_far</span>
</span><span id="L-289"><a href="#-289"><span class="linenos"> 289</span></a>
</span><span id="L-290"><a href="#-290"><span class="linenos"> 290</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ang</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">incident_angles</span><span class="p">):</span>
</span><span id="L-291"><a href="#-291"><span class="linenos"> 291</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="n">scaled_data</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
</span><span id="L-292"><a href="#-292"><span class="linenos"> 292</span></a>            <span class="n">fname</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">ang</span><span class="si">}</span><span class="s2">_degrees&quot;</span>
</span><span id="L-293"><a href="#-293"><span class="linenos"> 293</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">write_cube_to_disk</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">fname</span><span class="p">)</span>
</span><span id="L-294"><a href="#-294"><span class="linenos"> 294</span></a>        <span class="n">normed_data</span> <span class="o">=</span> <span class="n">normalize_seismic</span><span class="p">(</span><span class="n">scaled_data</span><span class="p">)</span>
</span><span id="L-295"><a href="#-295"><span class="linenos"> 295</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ang</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">incident_angles</span><span class="p">):</span>
</span><span id="L-296"><a href="#-296"><span class="linenos"> 296</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="n">normed_data</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
</span><span id="L-297"><a href="#-297"><span class="linenos"> 297</span></a>            <span class="n">fname</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">ang</span><span class="si">}</span><span class="s2">_degrees_normalized&quot;</span>
</span><span id="L-298"><a href="#-298"><span class="linenos"> 298</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">write_cube_to_disk</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">fname</span><span class="p">)</span>
</span><span id="L-299"><a href="#-299"><span class="linenos"> 299</span></a>        <span class="k">return</span> <span class="n">normed_data</span>
</span><span id="L-300"><a href="#-300"><span class="linenos"> 300</span></a>
</span><span id="L-301"><a href="#-301"><span class="linenos"> 301</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-302"><a href="#-302"><span class="linenos"> 302</span></a>    <span class="k">def</span> <span class="nf">random_z_rho_vp_vs</span><span class="p">(</span><span class="n">dmin</span><span class="o">=-</span><span class="mi">7</span><span class="p">,</span> <span class="n">dmax</span><span class="o">=</span><span class="mi">7</span><span class="p">):</span>
</span><span id="L-303"><a href="#-303"><span class="linenos"> 303</span></a>        <span class="n">delta_z_rho</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">dmin</span><span class="p">,</span> <span class="n">dmax</span><span class="p">))</span>
</span><span id="L-304"><a href="#-304"><span class="linenos"> 304</span></a>        <span class="n">delta_z_vp</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">dmin</span><span class="p">,</span> <span class="n">dmax</span><span class="p">))</span>
</span><span id="L-305"><a href="#-305"><span class="linenos"> 305</span></a>        <span class="n">delta_z_vs</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">dmin</span><span class="p">,</span> <span class="n">dmax</span><span class="p">))</span>
</span><span id="L-306"><a href="#-306"><span class="linenos"> 306</span></a>        <span class="k">return</span> <span class="n">delta_z_rho</span><span class="p">,</span> <span class="n">delta_z_vp</span><span class="p">,</span> <span class="n">delta_z_vs</span>
</span><span id="L-307"><a href="#-307"><span class="linenos"> 307</span></a>
</span><span id="L-308"><a href="#-308"><span class="linenos"> 308</span></a>    <span class="k">def</span> <span class="nf">create_rfc_volumes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-309"><a href="#-309"><span class="linenos"> 309</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-310"><a href="#-310"><span class="linenos"> 310</span></a><span class="sd">        Build a 3D array of PP-Reflectivity using Zoeppritz for each incident angle given.</span>
</span><span id="L-311"><a href="#-311"><span class="linenos"> 311</span></a>
</span><span id="L-312"><a href="#-312"><span class="linenos"> 312</span></a><span class="sd">        :return: 4D array of PP-Reflectivity. 4th dimension holds reflectivities of each incident angle provided</span>
</span><span id="L-313"><a href="#-313"><span class="linenos"> 313</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-314"><a href="#-314"><span class="linenos"> 314</span></a>        <span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asanyarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">angles</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span>
</span><span id="L-315"><a href="#-315"><span class="linenos"> 315</span></a>            <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-316"><a href="#-316"><span class="linenos"> 316</span></a>        <span class="p">)</span>  <span class="c1"># Convert angles into a column vector</span>
</span><span id="L-317"><a href="#-317"><span class="linenos"> 317</span></a>
</span><span id="L-318"><a href="#-318"><span class="linenos"> 318</span></a>        <span class="c1"># Make empty array to store RPP via zoeppritz</span>
</span><span id="L-319"><a href="#-319"><span class="linenos"> 319</span></a>        <span class="n">zoep</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span>
</span><span id="L-320"><a href="#-320"><span class="linenos"> 320</span></a>            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">rho</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">rho</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">theta</span><span class="o">.</span><span class="n">size</span><span class="p">),</span>
</span><span id="L-321"><a href="#-321"><span class="linenos"> 321</span></a>            <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;complex64&quot;</span><span class="p">,</span>
</span><span id="L-322"><a href="#-322"><span class="linenos"> 322</span></a>        <span class="p">)</span>
</span><span id="L-323"><a href="#-323"><span class="linenos"> 323</span></a>
</span><span id="L-324"><a href="#-324"><span class="linenos"> 324</span></a>        <span class="n">_rho</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rho</span><span class="p">[:]</span>
</span><span id="L-325"><a href="#-325"><span class="linenos"> 325</span></a>        <span class="n">_vp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vp</span><span class="p">[:]</span>
</span><span id="L-326"><a href="#-326"><span class="linenos"> 326</span></a>        <span class="n">_vs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vs</span><span class="p">[:]</span>
</span><span id="L-327"><a href="#-327"><span class="linenos"> 327</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="L-328"><a href="#-328"><span class="linenos"> 328</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Checking for null values inside create_rfc_volumes:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-329"><a href="#-329"><span class="linenos"> 329</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Rho: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">_rho</span><span class="p">)</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">_rho</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-330"><a href="#-330"><span class="linenos"> 330</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Vp: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">_vp</span><span class="p">)</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">_vp</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-331"><a href="#-331"><span class="linenos"> 331</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Vs: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">_vs</span><span class="p">)</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">_vs</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-332"><a href="#-332"><span class="linenos"> 332</span></a>        <span class="c1"># Doing this for each trace &amp; all (5) angles is actually quicker than doing entire cubes for each angle</span>
</span><span id="L-333"><a href="#-333"><span class="linenos"> 333</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">trange</span><span class="p">(</span>
</span><span id="L-334"><a href="#-334"><span class="linenos"> 334</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">rho</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
</span><span id="L-335"><a href="#-335"><span class="linenos"> 335</span></a>            <span class="n">desc</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Calculating Zoeppritz for </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">angles</span><span class="p">)</span><span class="si">}</span><span class="s2"> angles&quot;</span><span class="p">,</span>
</span><span id="L-336"><a href="#-336"><span class="linenos"> 336</span></a>        <span class="p">):</span>
</span><span id="L-337"><a href="#-337"><span class="linenos"> 337</span></a>            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
</span><span id="L-338"><a href="#-338"><span class="linenos"> 338</span></a>                <span class="n">rho1</span><span class="p">,</span> <span class="n">rho2</span> <span class="o">=</span> <span class="n">_rho</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">_rho</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="mi">1</span><span class="p">:]</span>
</span><span id="L-339"><a href="#-339"><span class="linenos"> 339</span></a>                <span class="n">vp1</span><span class="p">,</span> <span class="n">vp2</span> <span class="o">=</span> <span class="n">_vp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">_vp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="mi">1</span><span class="p">:]</span>
</span><span id="L-340"><a href="#-340"><span class="linenos"> 340</span></a>                <span class="n">vs1</span><span class="p">,</span> <span class="n">vs2</span> <span class="o">=</span> <span class="n">_vs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">_vs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="mi">1</span><span class="p">:]</span>
</span><span id="L-341"><a href="#-341"><span class="linenos"> 341</span></a>                <span class="n">rfc</span> <span class="o">=</span> <span class="n">RFC</span><span class="p">(</span><span class="n">vp1</span><span class="p">,</span> <span class="n">vs1</span><span class="p">,</span> <span class="n">rho1</span><span class="p">,</span> <span class="n">vp2</span><span class="p">,</span> <span class="n">vs2</span><span class="p">,</span> <span class="n">rho2</span><span class="p">,</span> <span class="n">theta</span><span class="p">)</span>
</span><span id="L-342"><a href="#-342"><span class="linenos"> 342</span></a>                <span class="n">zoep</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">rfc</span><span class="o">.</span><span class="n">zoeppritz_reflectivity</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
</span><span id="L-343"><a href="#-343"><span class="linenos"> 343</span></a>        <span class="c1"># Set any voxels with imaginary parts to 0, since all transmitted energy travels along the reflector</span>
</span><span id="L-344"><a href="#-344"><span class="linenos"> 344</span></a>        <span class="c1"># zoep[np.where(np.imag(zoep) != 0)] = 0</span>
</span><span id="L-345"><a href="#-345"><span class="linenos"> 345</span></a>        <span class="c1"># discard complex values and set dtype to float64</span>
</span><span id="L-346"><a href="#-346"><span class="linenos"> 346</span></a>        <span class="n">zoep</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">zoep</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;float64&quot;</span><span class="p">)</span>
</span><span id="L-347"><a href="#-347"><span class="linenos"> 347</span></a>        <span class="k">del</span> <span class="n">_rho</span><span class="p">,</span> <span class="n">_vp</span><span class="p">,</span> <span class="n">_vs</span>
</span><span id="L-348"><a href="#-348"><span class="linenos"> 348</span></a>
</span><span id="L-349"><a href="#-349"><span class="linenos"> 349</span></a>        <span class="c1"># Move the angle from last dimension to first</span>
</span><span id="L-350"><a href="#-350"><span class="linenos"> 350</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">rfc_raw</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">moveaxis</span><span class="p">(</span><span class="n">zoep</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="L-351"><a href="#-351"><span class="linenos"> 351</span></a>
</span><span id="L-352"><a href="#-352"><span class="linenos"> 352</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_store</span><span class="p">:</span>
</span><span id="L-353"><a href="#-353"><span class="linenos"> 353</span></a>            <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
</span><span id="L-354"><a href="#-354"><span class="linenos"> 354</span></a>                <span class="p">[</span>
</span><span id="L-355"><a href="#-355"><span class="linenos"> 355</span></a>                    <span class="s2">&quot;qc_volume_rfc_raw_</span><span class="si">{}</span><span class="s2">_degrees&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="L-356"><a href="#-356"><span class="linenos"> 356</span></a>                        <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">angles</span><span class="p">[</span><span class="n">x</span><span class="p">])</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span>
</span><span id="L-357"><a href="#-357"><span class="linenos"> 357</span></a>                    <span class="p">)</span>
</span><span id="L-358"><a href="#-358"><span class="linenos"> 358</span></a>                    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rfc_raw</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-359"><a href="#-359"><span class="linenos"> 359</span></a>                <span class="p">],</span>
</span><span id="L-360"><a href="#-360"><span class="linenos"> 360</span></a>                <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">rfc_raw</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rfc_raw</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])],</span>
</span><span id="L-361"><a href="#-361"><span class="linenos"> 361</span></a>            <span class="p">):</span>
</span><span id="L-362"><a href="#-362"><span class="linenos"> 362</span></a>                <span class="n">write_data_to_hdf</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_master</span><span class="p">)</span>
</span><span id="L-363"><a href="#-363"><span class="linenos"> 363</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">model_qc_volumes</span><span class="p">:</span>
</span><span id="L-364"><a href="#-364"><span class="linenos"> 364</span></a>            <span class="c1"># Write raw RFC values to disk</span>
</span><span id="L-365"><a href="#-365"><span class="linenos"> 365</span></a>            <span class="n">_</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-366"><a href="#-366"><span class="linenos"> 366</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">write_cube_to_disk</span><span class="p">(</span>
</span><span id="L-367"><a href="#-367"><span class="linenos"> 367</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">rfc_raw</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span>
</span><span id="L-368"><a href="#-368"><span class="linenos"> 368</span></a>                    <span class="sa">f</span><span class="s2">&quot;qc_volume_rfc_raw_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">angles</span><span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="si">}</span><span class="s2">_degrees&quot;</span><span class="p">,</span>
</span><span id="L-369"><a href="#-369"><span class="linenos"> 369</span></a>                <span class="p">)</span>
</span><span id="L-370"><a href="#-370"><span class="linenos"> 370</span></a>                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rfc_raw</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-371"><a href="#-371"><span class="linenos"> 371</span></a>            <span class="p">]</span>
</span><span id="L-372"><a href="#-372"><span class="linenos"> 372</span></a>            <span class="n">max_amp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rfc_raw</span><span class="p">[:]))</span>
</span><span id="L-373"><a href="#-373"><span class="linenos"> 373</span></a>            <span class="n">_</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-374"><a href="#-374"><span class="linenos"> 374</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">write_cube_to_disk</span><span class="p">(</span>
</span><span id="L-375"><a href="#-375"><span class="linenos"> 375</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">rfc_raw</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span>
</span><span id="L-376"><a href="#-376"><span class="linenos"> 376</span></a>                    <span class="sa">f</span><span class="s2">&quot;qc_volume_rfc_raw_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">angles</span><span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="si">}</span><span class="s2">_degrees&quot;</span><span class="p">,</span>
</span><span id="L-377"><a href="#-377"><span class="linenos"> 377</span></a>                <span class="p">)</span>
</span><span id="L-378"><a href="#-378"><span class="linenos"> 378</span></a>                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rfc_raw</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-379"><a href="#-379"><span class="linenos"> 379</span></a>            <span class="p">]</span>
</span><span id="L-380"><a href="#-380"><span class="linenos"> 380</span></a>
</span><span id="L-381"><a href="#-381"><span class="linenos"> 381</span></a>    <span class="k">def</span> <span class="nf">noise_3d</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cube_shape</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="L-382"><a href="#-382"><span class="linenos"> 382</span></a>        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="L-383"><a href="#-383"><span class="linenos"> 383</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   ... inside noise3D&quot;</span><span class="p">)</span>
</span><span id="L-384"><a href="#-384"><span class="linenos"> 384</span></a>
</span><span id="L-385"><a href="#-385"><span class="linenos"> 385</span></a>        <span class="n">noise_seed</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="mi">2</span> <span class="o">**</span> <span class="mi">32</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-386"><a href="#-386"><span class="linenos"> 386</span></a>        <span class="n">sign_seed</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="mi">2</span> <span class="o">**</span> <span class="mi">32</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-387"><a href="#-387"><span class="linenos"> 387</span></a>
</span><span id="L-388"><a href="#-388"><span class="linenos"> 388</span></a>        <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">noise_seed</span><span class="p">)</span>
</span><span id="L-389"><a href="#-389"><span class="linenos"> 389</span></a>        <span class="n">noise3d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">exponential</span><span class="p">(</span>
</span><span id="L-390"><a href="#-390"><span class="linenos"> 390</span></a>            <span class="mf">1.0</span> <span class="o">/</span> <span class="mf">100.0</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">cube_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">cube_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
</span><span id="L-391"><a href="#-391"><span class="linenos"> 391</span></a>        <span class="p">)</span>
</span><span id="L-392"><a href="#-392"><span class="linenos"> 392</span></a>        <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">sign_seed</span><span class="p">)</span>
</span><span id="L-393"><a href="#-393"><span class="linenos"> 393</span></a>        <span class="n">sign</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">binomial</span><span class="p">(</span>
</span><span id="L-394"><a href="#-394"><span class="linenos"> 394</span></a>            <span class="mi">1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">cube_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">cube_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
</span><span id="L-395"><a href="#-395"><span class="linenos"> 395</span></a>        <span class="p">)</span>
</span><span id="L-396"><a href="#-396"><span class="linenos"> 396</span></a>
</span><span id="L-397"><a href="#-397"><span class="linenos"> 397</span></a>        <span class="n">sign</span><span class="p">[</span><span class="n">sign</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
</span><span id="L-398"><a href="#-398"><span class="linenos"> 398</span></a>        <span class="n">noise3d</span> <span class="o">*=</span> <span class="n">sign</span>
</span><span id="L-399"><a href="#-399"><span class="linenos"> 399</span></a>        <span class="n">noise3d</span> <span class="o">=</span> <span class="n">noise3d</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cube_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">cube_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
</span><span id="L-400"><a href="#-400"><span class="linenos"> 400</span></a>        <span class="k">return</span> <span class="n">noise3d</span>
</span><span id="L-401"><a href="#-401"><span class="linenos"> 401</span></a>
</span><span id="L-402"><a href="#-402"><span class="linenos"> 402</span></a>    <span class="k">def</span> <span class="nf">add_weighted_noise</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">depth_maps</span><span class="p">):</span>
</span><span id="L-403"><a href="#-403"><span class="linenos"> 403</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-404"><a href="#-404"><span class="linenos"> 404</span></a><span class="sd">        Apply 3D weighted random noise to ndarray.</span>
</span><span id="L-405"><a href="#-405"><span class="linenos"> 405</span></a>
</span><span id="L-406"><a href="#-406"><span class="linenos"> 406</span></a><span class="sd">        :return: Sum of rfc_volumes and 3D noise model, weighted by angle</span>
</span><span id="L-407"><a href="#-407"><span class="linenos"> 407</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-408"><a href="#-408"><span class="linenos"> 408</span></a>
</span><span id="L-409"><a href="#-409"><span class="linenos"> 409</span></a>        <span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">sin</span><span class="p">,</span> <span class="n">cos</span>
</span><span id="L-410"><a href="#-410"><span class="linenos"> 410</span></a>        <span class="kn">from</span> <span class="nn">datagenerator.util</span> <span class="kn">import</span> <span class="n">mute_above_seafloor</span>
</span><span id="L-411"><a href="#-411"><span class="linenos"> 411</span></a>        <span class="kn">from</span> <span class="nn">datagenerator.util</span> <span class="kn">import</span> <span class="n">infill_surface</span>
</span><span id="L-412"><a href="#-412"><span class="linenos"> 412</span></a>
</span><span id="L-413"><a href="#-413"><span class="linenos"> 413</span></a>        <span class="c1"># Calculate standard deviation ratio to use based on user-input sn_db parameter</span>
</span><span id="L-414"><a href="#-414"><span class="linenos"> 414</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="L-415"><a href="#-415"><span class="linenos"> 415</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">...adding random noise to </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">rfc_raw</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> cubes...&quot;</span><span class="p">)</span>
</span><span id="L-416"><a href="#-416"><span class="linenos"> 416</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;S/N ratio = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">sn_db</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-417"><a href="#-417"><span class="linenos"> 417</span></a>        <span class="n">std_ratio</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">10</span> <span class="o">**</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">sn_db</span> <span class="o">/</span> <span class="mf">10.0</span><span class="p">))</span>
</span><span id="L-418"><a href="#-418"><span class="linenos"> 418</span></a>
</span><span id="L-419"><a href="#-419"><span class="linenos"> 419</span></a>        <span class="c1"># Compute standard deviation in bottom half of cube, and use this to scale the noise</span>
</span><span id="L-420"><a href="#-420"><span class="linenos"> 420</span></a>        <span class="c1"># if wb has holes (i.e. Nan or 0 values), fill holes using replacement with interpolated (NN) values</span>
</span><span id="L-421"><a href="#-421"><span class="linenos"> 421</span></a>        <span class="n">wb_map</span> <span class="o">=</span> <span class="n">depth_maps</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
</span><span id="L-422"><a href="#-422"><span class="linenos"> 422</span></a>        <span class="c1"># Add test for all 0&#39;s in wb_map in case z_shift has been applied</span>
</span><span id="L-423"><a href="#-423"><span class="linenos"> 423</span></a>        <span class="k">if</span> <span class="p">(</span>
</span><span id="L-424"><a href="#-424"><span class="linenos"> 424</span></a>            <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">wb_map</span><span class="p">))</span> <span class="ow">or</span> <span class="mi">0</span> <span class="ow">in</span> <span class="n">wb_map</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">wb_map</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="L-425"><a href="#-425"><span class="linenos"> 425</span></a>        <span class="p">):</span>  <span class="c1"># If wb contains nan&#39;s or at least one 0, this will return True</span>
</span><span id="L-426"><a href="#-426"><span class="linenos"> 426</span></a>            <span class="n">wb_map</span> <span class="o">=</span> <span class="n">infill_surface</span><span class="p">(</span><span class="n">wb_map</span><span class="p">)</span>
</span><span id="L-427"><a href="#-427"><span class="linenos"> 427</span></a>        <span class="n">wb_plus_15samples</span> <span class="o">=</span> <span class="n">wb_map</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">digi</span> <span class="o">+</span> <span class="mi">15</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">digi</span>
</span><span id="L-428"><a href="#-428"><span class="linenos"> 428</span></a>
</span><span id="L-429"><a href="#-429"><span class="linenos"> 429</span></a>        <span class="c1"># Use the Middle angle cube for normalisation</span>
</span><span id="L-430"><a href="#-430"><span class="linenos"> 430</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">model_qc_volumes</span><span class="p">:</span>
</span><span id="L-431"><a href="#-431"><span class="linenos"> 431</span></a>            <span class="c1"># 0 and 45 degree cubes have been added</span>
</span><span id="L-432"><a href="#-432"><span class="linenos"> 432</span></a>            <span class="n">norm_cube</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rfc_raw</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
</span><span id="L-433"><a href="#-433"><span class="linenos"> 433</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-434"><a href="#-434"><span class="linenos"> 434</span></a>            <span class="n">norm_cube</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rfc_raw</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
</span><span id="L-435"><a href="#-435"><span class="linenos"> 435</span></a>        <span class="n">data_below_seafloor</span> <span class="o">=</span> <span class="n">norm_cube</span><span class="p">[</span>
</span><span id="L-436"><a href="#-436"><span class="linenos"> 436</span></a>            <span class="n">mute_above_seafloor</span><span class="p">(</span><span class="n">wb_plus_15samples</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">norm_cube</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="s2">&quot;float&quot;</span><span class="p">))</span>
</span><span id="L-437"><a href="#-437"><span class="linenos"> 437</span></a>            <span class="o">!=</span> <span class="mf">0.0</span>
</span><span id="L-438"><a href="#-438"><span class="linenos"> 438</span></a>        <span class="p">]</span>
</span><span id="L-439"><a href="#-439"><span class="linenos"> 439</span></a>        <span class="n">data_std</span> <span class="o">=</span> <span class="n">data_below_seafloor</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
</span><span id="L-440"><a href="#-440"><span class="linenos"> 440</span></a>
</span><span id="L-441"><a href="#-441"><span class="linenos"> 441</span></a>        <span class="c1"># Create array to store the 3D noise model for each angle</span>
</span><span id="L-442"><a href="#-442"><span class="linenos"> 442</span></a>        <span class="n">noise3d_cubes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rfc_raw</span><span class="p">[:])</span>
</span><span id="L-443"><a href="#-443"><span class="linenos"> 443</span></a>
</span><span id="L-444"><a href="#-444"><span class="linenos"> 444</span></a>        <span class="c1"># Add weighted stack of noise using Hilterman equation to each angle substack</span>
</span><span id="L-445"><a href="#-445"><span class="linenos"> 445</span></a>        <span class="n">noise_0deg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">noise_3d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rfc_raw</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="L-446"><a href="#-446"><span class="linenos"> 446</span></a>        <span class="n">noise_45deg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">noise_3d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rfc_raw</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="L-447"><a href="#-447"><span class="linenos"> 447</span></a>        <span class="c1"># Store the noise models</span>
</span><span id="L-448"><a href="#-448"><span class="linenos"> 448</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">noise_0deg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span><span class="s2">&quot;noise_0deg&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">noise_0deg</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span><span id="L-449"><a href="#-449"><span class="linenos"> 449</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">noise_45deg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span><span class="s2">&quot;noise_45deg&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">noise_45deg</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span><span id="L-450"><a href="#-450"><span class="linenos"> 450</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">noise_0deg</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">noise_0deg</span>
</span><span id="L-451"><a href="#-451"><span class="linenos"> 451</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">noise_45deg</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">noise_45deg</span>
</span><span id="L-452"><a href="#-452"><span class="linenos"> 452</span></a>
</span><span id="L-453"><a href="#-453"><span class="linenos"> 453</span></a>        <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">ang</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">angles</span><span class="p">):</span>
</span><span id="L-454"><a href="#-454"><span class="linenos"> 454</span></a>            <span class="n">weighted_noise</span> <span class="o">=</span> <span class="n">noise_0deg</span> <span class="o">*</span> <span class="p">(</span><span class="n">cos</span><span class="p">(</span><span class="n">ang</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">noise_45deg</span> <span class="o">*</span> <span class="p">(</span>
</span><span id="L-455"><a href="#-455"><span class="linenos"> 455</span></a>                <span class="n">sin</span><span class="p">(</span><span class="n">ang</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
</span><span id="L-456"><a href="#-456"><span class="linenos"> 456</span></a>            <span class="p">)</span>
</span><span id="L-457"><a href="#-457"><span class="linenos"> 457</span></a>            <span class="n">noise_std</span> <span class="o">=</span> <span class="n">weighted_noise</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
</span><span id="L-458"><a href="#-458"><span class="linenos"> 458</span></a>            <span class="n">noise3d_cubes</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">weighted_noise</span> <span class="o">*</span> <span class="p">(</span><span class="n">data_std</span> <span class="o">/</span> <span class="n">noise_std</span><span class="p">)</span> <span class="o">/</span> <span class="n">std_ratio</span>
</span><span id="L-459"><a href="#-459"><span class="linenos"> 459</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="L-460"><a href="#-460"><span class="linenos"> 460</span></a>                <span class="nb">print</span><span class="p">(</span>
</span><span id="L-461"><a href="#-461"><span class="linenos"> 461</span></a>                    <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">...Normalised noise3d for angle </span><span class="si">{</span><span class="n">ang</span><span class="si">}</span><span class="s2">:</span><span class="se">\t</span><span class="s2">Min: </span><span class="si">{</span><span class="n">noise3d_cubes</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">,&quot;</span>
</span><span id="L-462"><a href="#-462"><span class="linenos"> 462</span></a>                    <span class="sa">f</span><span class="s2">&quot; mean: </span><span class="si">{</span><span class="n">noise3d_cubes</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">, max: </span><span class="si">{</span><span class="n">noise3d_cubes</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">,&quot;</span>
</span><span id="L-463"><a href="#-463"><span class="linenos"> 463</span></a>                    <span class="sa">f</span><span class="s2">&quot; std: </span><span class="si">{</span><span class="n">noise3d_cubes</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-464"><a href="#-464"><span class="linenos"> 464</span></a>                <span class="p">)</span>
</span><span id="L-465"><a href="#-465"><span class="linenos"> 465</span></a>                <span class="nb">print</span><span class="p">(</span>
</span><span id="L-466"><a href="#-466"><span class="linenos"> 466</span></a>                    <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">S/N ratio = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">sn_db</span><span class="si">:</span><span class="s2">3.1f</span><span class="si">}</span><span class="s2"> dB.</span><span class="se">\n\t</span><span class="s2">std_ratio = </span><span class="si">{</span><span class="n">std_ratio</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-467"><a href="#-467"><span class="linenos"> 467</span></a>                    <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n\t</span><span class="s2">data_std = </span><span class="si">{</span><span class="n">data_std</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="se">\n\t</span><span class="s2">noise_std = </span><span class="si">{</span><span class="n">noise_std</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-468"><a href="#-468"><span class="linenos"> 468</span></a>                <span class="p">)</span>
</span><span id="L-469"><a href="#-469"><span class="linenos"> 469</span></a>
</span><span id="L-470"><a href="#-470"><span class="linenos"> 470</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">rfc_noise_added</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">noise3d_cubes</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">rfc_raw</span><span class="p">[:]</span>
</span><span id="L-471"><a href="#-471"><span class="linenos"> 471</span></a>
</span><span id="L-472"><a href="#-472"><span class="linenos"> 472</span></a>    <span class="k">def</span> <span class="nf">apply_bandlimits</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">frequencies</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-473"><a href="#-473"><span class="linenos"> 473</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-474"><a href="#-474"><span class="linenos"> 474</span></a><span class="sd">        Apply Butterworth Bandpass Filter to data</span>
</span><span id="L-475"><a href="#-475"><span class="linenos"> 475</span></a><span class="sd">        :param data: 4D array of RFC values</span>
</span><span id="L-476"><a href="#-476"><span class="linenos"> 476</span></a><span class="sd">        :param frequencies: Explicit frequency bounds (lower, upper)</span>
</span><span id="L-477"><a href="#-477"><span class="linenos"> 477</span></a><span class="sd">        :return: 4D array of band-limited RFC</span>
</span><span id="L-478"><a href="#-478"><span class="linenos"> 478</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-479"><a href="#-479"><span class="linenos"> 479</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="L-480"><a href="#-480"><span class="linenos"> 480</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Data Min: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, Data Max: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-481"><a href="#-481"><span class="linenos"> 481</span></a>        <span class="n">dt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">digi</span> <span class="o">/</span> <span class="mf">1000.0</span>
</span><span id="L-482"><a href="#-482"><span class="linenos"> 482</span></a>        <span class="k">if</span> <span class="p">(</span>
</span><span id="L-483"><a href="#-483"><span class="linenos"> 483</span></a>            <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">infill_factor</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">pad_samples</span>
</span><span id="L-484"><a href="#-484"><span class="linenos"> 484</span></a>            <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-485"><a href="#-485"><span class="linenos"> 485</span></a>        <span class="p">):</span>
</span><span id="L-486"><a href="#-486"><span class="linenos"> 486</span></a>            <span class="c1"># Input data is infilled</span>
</span><span id="L-487"><a href="#-487"><span class="linenos"> 487</span></a>            <span class="n">dt</span> <span class="o">/=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">infill_factor</span>
</span><span id="L-488"><a href="#-488"><span class="linenos"> 488</span></a>        <span class="k">if</span> <span class="n">frequencies</span><span class="p">:</span>  <span class="c1"># if frequencies explicitly defined</span>
</span><span id="L-489"><a href="#-489"><span class="linenos"> 489</span></a>            <span class="n">low</span> <span class="o">=</span> <span class="n">frequencies</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-490"><a href="#-490"><span class="linenos"> 490</span></a>            <span class="n">high</span> <span class="o">=</span> <span class="n">frequencies</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-491"><a href="#-491"><span class="linenos"> 491</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-492"><a href="#-492"><span class="linenos"> 492</span></a>            <span class="n">low</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">lowfreq</span>
</span><span id="L-493"><a href="#-493"><span class="linenos"> 493</span></a>            <span class="n">high</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">highfreq</span>
</span><span id="L-494"><a href="#-494"><span class="linenos"> 494</span></a>        <span class="n">b</span><span class="p">,</span> <span class="n">a</span> <span class="o">=</span> <span class="n">derive_butterworth_bandpass</span><span class="p">(</span>
</span><span id="L-495"><a href="#-495"><span class="linenos"> 495</span></a>            <span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="p">,</span> <span class="p">(</span><span class="n">dt</span> <span class="o">*</span> <span class="mf">1000.0</span><span class="p">),</span> <span class="n">order</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">order</span>
</span><span id="L-496"><a href="#-496"><span class="linenos"> 496</span></a>        <span class="p">)</span>
</span><span id="L-497"><a href="#-497"><span class="linenos"> 497</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="L-498"><a href="#-498"><span class="linenos"> 498</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">... Low Frequency; </span><span class="si">{</span><span class="n">low</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> Hz, High Frequency: </span><span class="si">{</span><span class="n">high</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> Hz&quot;</span><span class="p">)</span>
</span><span id="L-499"><a href="#-499"><span class="linenos"> 499</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="L-500"><a href="#-500"><span class="linenos"> 500</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">... start_width: </span><span class="si">{</span><span class="mf">1.</span> <span class="o">/</span> <span class="p">(</span><span class="n">dt</span> <span class="o">*</span> <span class="n">low</span><span class="p">)</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">, end_width: </span><span class="si">{</span><span class="mf">1.</span> <span class="o">/</span> <span class="p">(</span><span class="n">dt</span> <span class="o">*</span> <span class="n">high</span><span class="p">)</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-501"><a href="#-501"><span class="linenos"> 501</span></a>            <span class="p">)</span>
</span><span id="L-502"><a href="#-502"><span class="linenos"> 502</span></a>
</span><span id="L-503"><a href="#-503"><span class="linenos"> 503</span></a>        <span class="c1"># Loop over 3D angle stack arrays</span>
</span><span id="L-504"><a href="#-504"><span class="linenos"> 504</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="L-505"><a href="#-505"><span class="linenos"> 505</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; ... shape of data being bandlimited = &quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-506"><a href="#-506"><span class="linenos"> 506</span></a>        <span class="n">num</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-507"><a href="#-507"><span class="linenos"> 507</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="L-508"><a href="#-508"><span class="linenos"> 508</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Applying Bandpass to </span><span class="si">{</span><span class="n">num</span><span class="si">}</span><span class="s2"> cubes&quot;</span><span class="p">)</span>
</span><span id="L-509"><a href="#-509"><span class="linenos"> 509</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">multiprocess_bp</span><span class="p">:</span>
</span><span id="L-510"><a href="#-510"><span class="linenos"> 510</span></a>            <span class="c1"># Much faster to use multiprocessing and apply band-limitation to entire cube at once</span>
</span><span id="L-511"><a href="#-511"><span class="linenos"> 511</span></a>            <span class="k">with</span> <span class="n">Pool</span><span class="p">(</span><span class="n">processes</span><span class="o">=</span><span class="nb">min</span><span class="p">(</span><span class="n">num</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">cpu_count</span><span class="p">()</span> <span class="o">-</span> <span class="mi">2</span><span class="p">))</span> <span class="k">as</span> <span class="n">p</span><span class="p">:</span>
</span><span id="L-512"><a href="#-512"><span class="linenos"> 512</span></a>                <span class="n">iterator</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span>
</span><span id="L-513"><a href="#-513"><span class="linenos"> 513</span></a>                    <span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num</span><span class="p">)],</span>
</span><span id="L-514"><a href="#-514"><span class="linenos"> 514</span></a>                    <span class="n">itertools</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">b</span><span class="p">),</span>
</span><span id="L-515"><a href="#-515"><span class="linenos"> 515</span></a>                    <span class="n">itertools</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">a</span><span class="p">),</span>
</span><span id="L-516"><a href="#-516"><span class="linenos"> 516</span></a>                <span class="p">)</span>
</span><span id="L-517"><a href="#-517"><span class="linenos"> 517</span></a>                <span class="n">out_cubes_mp</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">starmap</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_run_bandpass_on_cubes</span><span class="p">,</span> <span class="n">iterator</span><span class="p">)</span>
</span><span id="L-518"><a href="#-518"><span class="linenos"> 518</span></a>            <span class="n">out_cubes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">out_cubes_mp</span><span class="p">)</span>
</span><span id="L-519"><a href="#-519"><span class="linenos"> 519</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-520"><a href="#-520"><span class="linenos"> 520</span></a>            <span class="c1"># multiprocessing can fail using Python version 3.6 and very large arrays</span>
</span><span id="L-521"><a href="#-521"><span class="linenos"> 521</span></a>            <span class="n">out_cubes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="L-522"><a href="#-522"><span class="linenos"> 522</span></a>            <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num</span><span class="p">):</span>
</span><span id="L-523"><a href="#-523"><span class="linenos"> 523</span></a>                <span class="n">out_cubes</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_run_bandpass_on_cubes</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span> <span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
</span><span id="L-524"><a href="#-524"><span class="linenos"> 524</span></a>
</span><span id="L-525"><a href="#-525"><span class="linenos"> 525</span></a>        <span class="k">return</span> <span class="n">out_cubes</span>
</span><span id="L-526"><a href="#-526"><span class="linenos"> 526</span></a>
</span><span id="L-527"><a href="#-527"><span class="linenos"> 527</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-528"><a href="#-528"><span class="linenos"> 528</span></a>    <span class="k">def</span> <span class="nf">_run_bandpass_on_cubes</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
</span><span id="L-529"><a href="#-529"><span class="linenos"> 529</span></a>        <span class="n">out_cube</span> <span class="o">=</span> <span class="n">apply_butterworth_bandpass</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
</span><span id="L-530"><a href="#-530"><span class="linenos"> 530</span></a>        <span class="k">return</span> <span class="n">out_cube</span>
</span><span id="L-531"><a href="#-531"><span class="linenos"> 531</span></a>
</span><span id="L-532"><a href="#-532"><span class="linenos"> 532</span></a>    <span class="k">def</span> <span class="nf">apply_lateral_filter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
</span><span id="L-533"><a href="#-533"><span class="linenos"> 533</span></a>        <span class="kn">from</span> <span class="nn">scipy.ndimage</span> <span class="kn">import</span> <span class="n">uniform_filter</span>
</span><span id="L-534"><a href="#-534"><span class="linenos"> 534</span></a>
</span><span id="L-535"><a href="#-535"><span class="linenos"> 535</span></a>        <span class="n">n_filt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">lateral_filter_size</span>
</span><span id="L-536"><a href="#-536"><span class="linenos"> 536</span></a>        <span class="k">return</span> <span class="n">uniform_filter</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n_filt</span><span class="p">,</span> <span class="n">n_filt</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
</span><span id="L-537"><a href="#-537"><span class="linenos"> 537</span></a>
</span><span id="L-538"><a href="#-538"><span class="linenos"> 538</span></a>    <span class="k">def</span> <span class="nf">apply_cumsum</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
</span><span id="L-539"><a href="#-539"><span class="linenos"> 539</span></a>        <span class="sd">&quot;&quot;&quot;Calculate cumulative sum on the Z-axis of input data</span>
</span><span id="L-540"><a href="#-540"><span class="linenos"> 540</span></a><span class="sd">        Sipmap&#39;s cumsum also applies an Ormsby filter to the cumulatively summed data</span>
</span><span id="L-541"><a href="#-541"><span class="linenos"> 541</span></a><span class="sd">        To replicate this, apply a butterworth filter to the data using 2, 100Hz frequency limits</span>
</span><span id="L-542"><a href="#-542"><span class="linenos"> 542</span></a><span class="sd">        todo: make an ormsby function&quot;&quot;&quot;</span>
</span><span id="L-543"><a href="#-543"><span class="linenos"> 543</span></a>        <span class="n">cumsum</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-544"><a href="#-544"><span class="linenos"> 544</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_bandlimits</span><span class="p">(</span><span class="n">cumsum</span><span class="p">,</span> <span class="p">(</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">100.0</span><span class="p">))</span>
</span><span id="L-545"><a href="#-545"><span class="linenos"> 545</span></a>
</span><span id="L-546"><a href="#-546"><span class="linenos"> 546</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-547"><a href="#-547"><span class="linenos"> 547</span></a>    <span class="k">def</span> <span class="nf">stack_substacks</span><span class="p">(</span><span class="n">cube_list</span><span class="p">):</span>
</span><span id="L-548"><a href="#-548"><span class="linenos"> 548</span></a>        <span class="sd">&quot;&quot;&quot;Stack cubes by taking mean&quot;&quot;&quot;</span>
</span><span id="L-549"><a href="#-549"><span class="linenos"> 549</span></a>        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">cube_list</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-550"><a href="#-550"><span class="linenos"> 550</span></a>
</span><span id="L-551"><a href="#-551"><span class="linenos"> 551</span></a>    <span class="k">def</span> <span class="nf">augment_data_and_labels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">normalised_seismic</span><span class="p">,</span> <span class="n">seabed</span><span class="p">):</span>
</span><span id="L-552"><a href="#-552"><span class="linenos"> 552</span></a>        <span class="kn">from</span> <span class="nn">datagenerator.Augmentation</span> <span class="kn">import</span> <span class="n">tz_stretch</span><span class="p">,</span> <span class="n">uniform_stretch</span>
</span><span id="L-553"><a href="#-553"><span class="linenos"> 553</span></a>
</span><span id="L-554"><a href="#-554"><span class="linenos"> 554</span></a>        <span class="n">hc_labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">h5file</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ModelData</span><span class="o">.</span><span class="n">hc_labels</span><span class="p">[:]</span>
</span><span id="L-555"><a href="#-555"><span class="linenos"> 555</span></a>        <span class="n">data</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">tz_stretch</span><span class="p">(</span>
</span><span id="L-556"><a href="#-556"><span class="linenos"> 556</span></a>            <span class="n">normalised_seismic</span><span class="p">,</span>
</span><span id="L-557"><a href="#-557"><span class="linenos"> 557</span></a>            <span class="n">hc_labels</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">pad_samples</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span>
</span><span id="L-558"><a href="#-558"><span class="linenos"> 558</span></a>            <span class="n">seabed</span><span class="p">,</span>
</span><span id="L-559"><a href="#-559"><span class="linenos"> 559</span></a>        <span class="p">)</span>
</span><span id="L-560"><a href="#-560"><span class="linenos"> 560</span></a>        <span class="n">seismic</span><span class="p">,</span> <span class="n">hc</span> <span class="o">=</span> <span class="n">uniform_stretch</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">labels</span><span class="p">)</span>
</span><span id="L-561"><a href="#-561"><span class="linenos"> 561</span></a>        <span class="k">return</span> <span class="n">seismic</span><span class="p">,</span> <span class="n">hc</span>
</span><span id="L-562"><a href="#-562"><span class="linenos"> 562</span></a>
</span><span id="L-563"><a href="#-563"><span class="linenos"> 563</span></a>    <span class="k">def</span> <span class="nf">compute_randomRMO_1D</span><span class="p">(</span>
</span><span id="L-564"><a href="#-564"><span class="linenos"> 564</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">nsamples</span><span class="p">,</span> <span class="n">inc_angle_list</span><span class="p">,</span> <span class="n">velocity_fraction</span><span class="o">=</span><span class="mf">0.015</span><span class="p">,</span> <span class="n">return_plot</span><span class="o">=</span><span class="kc">False</span>
</span><span id="L-565"><a href="#-565"><span class="linenos"> 565</span></a>    <span class="p">):</span>
</span><span id="L-566"><a href="#-566"><span class="linenos"> 566</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-567"><a href="#-567"><span class="linenos"> 567</span></a><span class="sd">        compute 1D indices for to apply residual moveout via interpolation</span>
</span><span id="L-568"><a href="#-568"><span class="linenos"> 568</span></a><span class="sd">        - nsamples is the array length in depth</span>
</span><span id="L-569"><a href="#-569"><span class="linenos"> 569</span></a><span class="sd">        - inc_angle_list is a list of angle in degrees for angle stacks to which</span>
</span><span id="L-570"><a href="#-570"><span class="linenos"> 570</span></a><span class="sd">        results will be applied</span>
</span><span id="L-571"><a href="#-571"><span class="linenos"> 571</span></a><span class="sd">        - velocity_fraction is the maximum percent error in absolute value.</span>
</span><span id="L-572"><a href="#-572"><span class="linenos"> 572</span></a><span class="sd">        for example, .03 would generate RMO based on velocity from .97 to 1.03 times correct velocity</span>
</span><span id="L-573"><a href="#-573"><span class="linenos"> 573</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-574"><a href="#-574"><span class="linenos"> 574</span></a>        <span class="kn">from</span> <span class="nn">scipy.interpolate</span> <span class="kn">import</span> <span class="n">UnivariateSpline</span>
</span><span id="L-575"><a href="#-575"><span class="linenos"> 575</span></a>
</span><span id="L-576"><a href="#-576"><span class="linenos"> 576</span></a>        <span class="n">input_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nsamples</span><span class="p">)</span>
</span><span id="L-577"><a href="#-577"><span class="linenos"> 577</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">qc_plots</span><span class="p">:</span>
</span><span id="L-578"><a href="#-578"><span class="linenos"> 578</span></a>            <span class="kn">from</span> <span class="nn">datagenerator.util</span> <span class="kn">import</span> <span class="n">import_matplotlib</span>
</span><span id="L-579"><a href="#-579"><span class="linenos"> 579</span></a>
</span><span id="L-580"><a href="#-580"><span class="linenos"> 580</span></a>            <span class="n">plt</span> <span class="o">=</span> <span class="n">import_matplotlib</span><span class="p">()</span>
</span><span id="L-581"><a href="#-581"><span class="linenos"> 581</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-582"><a href="#-582"><span class="linenos"> 582</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mf">4.75</span><span class="p">,</span> <span class="mf">6.0</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
</span><span id="L-583"><a href="#-583"><span class="linenos"> 583</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
</span><span id="L-584"><a href="#-584"><span class="linenos"> 584</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
</span><span id="L-585"><a href="#-585"><span class="linenos"> 585</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">((</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
</span><span id="L-586"><a href="#-586"><span class="linenos"> 586</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">((</span><span class="n">nsamples</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
</span><span id="L-587"><a href="#-587"><span class="linenos"> 587</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;depth (samples)&quot;</span><span class="p">)</span>
</span><span id="L-588"><a href="#-588"><span class="linenos"> 588</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;RMO (samples)&quot;</span><span class="p">)</span>
</span><span id="L-589"><a href="#-589"><span class="linenos"> 589</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span>
</span><span id="L-590"><a href="#-590"><span class="linenos"> 590</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">work_subfolder</span><span class="p">,</span> <span class="s2">&quot;rmo_1d.png&quot;</span><span class="p">),</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;png&quot;</span>
</span><span id="L-591"><a href="#-591"><span class="linenos"> 591</span></a>            <span class="p">)</span>
</span><span id="L-592"><a href="#-592"><span class="linenos"> 592</span></a>        <span class="c1"># generate 1 to 3 randomly located velocity fractions at random depth indices</span>
</span><span id="L-593"><a href="#-593"><span class="linenos"> 593</span></a>        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">250</span><span class="p">):</span>
</span><span id="L-594"><a href="#-594"><span class="linenos"> 594</span></a>            <span class="n">num_tie_points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
</span><span id="L-595"><a href="#-595"><span class="linenos"> 595</span></a>            <span class="n">tie_fractions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span>
</span><span id="L-596"><a href="#-596"><span class="linenos"> 596</span></a>                <span class="n">low</span><span class="o">=-</span><span class="n">velocity_fraction</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="n">velocity_fraction</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">num_tie_points</span>
</span><span id="L-597"><a href="#-597"><span class="linenos"> 597</span></a>            <span class="p">)</span>
</span><span id="L-598"><a href="#-598"><span class="linenos"> 598</span></a>            <span class="k">if</span> <span class="n">num_tie_points</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-599"><a href="#-599"><span class="linenos"> 599</span></a>                <span class="n">tie_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span>
</span><span id="L-600"><a href="#-600"><span class="linenos"> 600</span></a>                    <span class="n">low</span><span class="o">=</span><span class="mf">0.25</span> <span class="o">*</span> <span class="n">nsamples</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="mf">0.75</span> <span class="o">*</span> <span class="n">nsamples</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">num_tie_points</span>
</span><span id="L-601"><a href="#-601"><span class="linenos"> 601</span></a>                <span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;int&quot;</span><span class="p">)</span>
</span><span id="L-602"><a href="#-602"><span class="linenos"> 602</span></a>
</span><span id="L-603"><a href="#-603"><span class="linenos"> 603</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-604"><a href="#-604"><span class="linenos"> 604</span></a>                <span class="n">tie_indices</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span>
</span><span id="L-605"><a href="#-605"><span class="linenos"> 605</span></a>                    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="mf">0.25</span> <span class="o">*</span> <span class="n">nsamples</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="mf">0.75</span> <span class="o">*</span> <span class="n">nsamples</span><span class="p">)</span>
</span><span id="L-606"><a href="#-606"><span class="linenos"> 606</span></a>                <span class="p">)</span>
</span><span id="L-607"><a href="#-607"><span class="linenos"> 607</span></a>            <span class="n">tie_fractions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span> <span class="n">tie_fractions</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]))</span>
</span><span id="L-608"><a href="#-608"><span class="linenos"> 608</span></a>            <span class="n">tie_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">tie_indices</span><span class="p">,</span> <span class="p">[</span><span class="n">nsamples</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span> <span class="n">nsamples</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]))</span>
</span><span id="L-609"><a href="#-609"><span class="linenos"> 609</span></a>            <span class="n">tie_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">tie_indices</span><span class="p">)</span>
</span><span id="L-610"><a href="#-610"><span class="linenos"> 610</span></a>            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">tie_indices</span><span class="p">)</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">:</span>
</span><span id="L-611"><a href="#-611"><span class="linenos"> 611</span></a>                <span class="k">continue</span>
</span><span id="L-612"><a href="#-612"><span class="linenos"> 612</span></a>            <span class="n">s</span> <span class="o">=</span> <span class="n">UnivariateSpline</span><span class="p">(</span><span class="n">tie_indices</span><span class="p">,</span> <span class="n">tie_fractions</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
</span><span id="L-613"><a href="#-613"><span class="linenos"> 613</span></a>            <span class="n">tie_fraction_array</span> <span class="o">=</span> <span class="n">s</span><span class="p">(</span><span class="n">input_indices</span><span class="p">)</span>
</span><span id="L-614"><a href="#-614"><span class="linenos"> 614</span></a>            <span class="n">output_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nsamples</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">inc_angle_list</span><span class="p">)))</span>
</span><span id="L-615"><a href="#-615"><span class="linenos"> 615</span></a>            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">iangle</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">inc_angle_list</span><span class="p">):</span>
</span><span id="L-616"><a href="#-616"><span class="linenos"> 616</span></a>                <span class="n">output_indices</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">input_indices</span> <span class="o">*</span> <span class="p">(</span>
</span><span id="L-617"><a href="#-617"><span class="linenos"> 617</span></a>                    <span class="mf">1.0</span>
</span><span id="L-618"><a href="#-618"><span class="linenos"> 618</span></a>                    <span class="o">+</span> <span class="n">tie_fraction_array</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">iangle</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">180.0</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
</span><span id="L-619"><a href="#-619"><span class="linenos"> 619</span></a>                <span class="p">)</span>
</span><span id="L-620"><a href="#-620"><span class="linenos"> 620</span></a>            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">output_indices</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">input_indices</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mf">10.0</span><span class="p">:</span>
</span><span id="L-621"><a href="#-621"><span class="linenos"> 621</span></a>                <span class="k">break</span>
</span><span id="L-622"><a href="#-622"><span class="linenos"> 622</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">iangle</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">inc_angle_list</span><span class="p">):</span>
</span><span id="L-623"><a href="#-623"><span class="linenos"> 623</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">qc_plots</span><span class="p">:</span>
</span><span id="L-624"><a href="#-624"><span class="linenos"> 624</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
</span><span id="L-625"><a href="#-625"><span class="linenos"> 625</span></a>                    <span class="n">output_indices</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">input_indices</span><span class="p">,</span>
</span><span id="L-626"><a href="#-626"><span class="linenos"> 626</span></a>                    <span class="n">input_indices</span><span class="p">,</span>
</span><span id="L-627"><a href="#-627"><span class="linenos"> 627</span></a>                    <span class="n">label</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">inc_angle_list</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span>
</span><span id="L-628"><a href="#-628"><span class="linenos"> 628</span></a>                <span class="p">)</span>
</span><span id="L-629"><a href="#-629"><span class="linenos"> 629</span></a>
</span><span id="L-630"><a href="#-630"><span class="linenos"> 630</span></a>                <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">inc_angle_list</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-631"><a href="#-631"><span class="linenos"> 631</span></a>                    <span class="n">output_tie_indices</span> <span class="o">=</span> <span class="n">tie_indices</span> <span class="o">*</span> <span class="p">(</span>
</span><span id="L-632"><a href="#-632"><span class="linenos"> 632</span></a>                        <span class="mf">1.0</span>
</span><span id="L-633"><a href="#-633"><span class="linenos"> 633</span></a>                        <span class="o">+</span> <span class="n">tie_fraction_array</span><span class="p">[</span><span class="n">tie_indices</span><span class="p">]</span>
</span><span id="L-634"><a href="#-634"><span class="linenos"> 634</span></a>                        <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">iangle</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">180.0</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
</span><span id="L-635"><a href="#-635"><span class="linenos"> 635</span></a>                    <span class="p">)</span>
</span><span id="L-636"><a href="#-636"><span class="linenos"> 636</span></a>                    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">output_tie_indices</span> <span class="o">-</span> <span class="n">tie_indices</span><span class="p">,</span> <span class="n">tie_indices</span><span class="p">,</span> <span class="s2">&quot;ko&quot;</span><span class="p">)</span>
</span><span id="L-637"><a href="#-637"><span class="linenos"> 637</span></a>                    <span class="n">rmo_min</span> <span class="o">=</span> <span class="p">(</span><span class="n">output_indices</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">input_indices</span><span class="p">)</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
</span><span id="L-638"><a href="#-638"><span class="linenos"> 638</span></a>                    <span class="n">rmo_max</span> <span class="o">=</span> <span class="p">(</span><span class="n">output_indices</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">input_indices</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</span><span id="L-639"><a href="#-639"><span class="linenos"> 639</span></a>                    <span class="n">rmo_range</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">rmo_min</span><span class="p">,</span> <span class="n">rmo_max</span><span class="p">))</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-640"><a href="#-640"><span class="linenos"> 640</span></a>                    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span>
</span><span id="L-641"><a href="#-641"><span class="linenos"> 641</span></a>                        <span class="s2">&quot;simultated RMO arrival time offsets</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="L-642"><a href="#-642"><span class="linenos"> 642</span></a>                        <span class="o">+</span> <span class="s2">&quot;rmo range = &quot;</span>
</span><span id="L-643"><a href="#-643"><span class="linenos"> 643</span></a>                        <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">rmo_range</span><span class="p">),</span>
</span><span id="L-644"><a href="#-644"><span class="linenos"> 644</span></a>                        <span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span>
</span><span id="L-645"><a href="#-645"><span class="linenos"> 645</span></a>                    <span class="p">)</span>
</span><span id="L-646"><a href="#-646"><span class="linenos"> 646</span></a>                    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</span><span id="L-647"><a href="#-647"><span class="linenos"> 647</span></a>                    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</span><span id="L-648"><a href="#-648"><span class="linenos"> 648</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span>
</span><span id="L-649"><a href="#-649"><span class="linenos"> 649</span></a>                    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">work_subfolder</span><span class="p">,</span> <span class="s2">&quot;rmo_arrival_time.png&quot;</span><span class="p">),</span>
</span><span id="L-650"><a href="#-650"><span class="linenos"> 650</span></a>                    <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;png&quot;</span><span class="p">,</span>
</span><span id="L-651"><a href="#-651"><span class="linenos"> 651</span></a>                <span class="p">)</span>
</span><span id="L-652"><a href="#-652"><span class="linenos"> 652</span></a>
</span><span id="L-653"><a href="#-653"><span class="linenos"> 653</span></a>        <span class="k">if</span> <span class="n">return_plot</span><span class="p">:</span>
</span><span id="L-654"><a href="#-654"><span class="linenos"> 654</span></a>            <span class="k">return</span> <span class="n">output_indices</span><span class="p">,</span> <span class="n">plt</span>
</span><span id="L-655"><a href="#-655"><span class="linenos"> 655</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-656"><a href="#-656"><span class="linenos"> 656</span></a>            <span class="k">return</span> <span class="n">output_indices</span>
</span><span id="L-657"><a href="#-657"><span class="linenos"> 657</span></a>
</span><span id="L-658"><a href="#-658"><span class="linenos"> 658</span></a>    <span class="k">def</span> <span class="nf">apply_rmo_augmentation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">angle_gather</span><span class="p">,</span> <span class="n">rmo_indices</span><span class="p">,</span> <span class="n">remove_mean_rmo</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="L-659"><a href="#-659"><span class="linenos"> 659</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-660"><a href="#-660"><span class="linenos"> 660</span></a><span class="sd">        apply residual moveout via interpolation</span>
</span><span id="L-661"><a href="#-661"><span class="linenos"> 661</span></a><span class="sd">        applied to &#39;angle_gather&#39; with results from compute_randomRMO_1D in rmo_indices</span>
</span><span id="L-662"><a href="#-662"><span class="linenos"> 662</span></a><span class="sd">        angle_gather and rmo_indices need to be 2D arrays with the same shape (n_samples x n_angles)</span>
</span><span id="L-663"><a href="#-663"><span class="linenos"> 663</span></a><span class="sd">        - angle_gather is the array to which RMO is applied</span>
</span><span id="L-664"><a href="#-664"><span class="linenos"> 664</span></a><span class="sd">        - rmo_indices is the array used to modify the two-way-times of angle_gather</span>
</span><span id="L-665"><a href="#-665"><span class="linenos"> 665</span></a><span class="sd">        - remove_mean_rmo can be used to (when True) to apply relative RMO that keeps</span>
</span><span id="L-666"><a href="#-666"><span class="linenos"> 666</span></a><span class="sd">        event energy at roughly the same TWT. for example to avoid applying RMO</span>
</span><span id="L-667"><a href="#-667"><span class="linenos"> 667</span></a><span class="sd">        to both data and labels</span>
</span><span id="L-668"><a href="#-668"><span class="linenos"> 668</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-669"><a href="#-669"><span class="linenos"> 669</span></a>        <span class="k">if</span> <span class="n">remove_mean_rmo</span><span class="p">:</span>
</span><span id="L-670"><a href="#-670"><span class="linenos"> 670</span></a>            <span class="c1"># apply de-trending to ensure that rmo does not change TWT</span>
</span><span id="L-671"><a href="#-671"><span class="linenos"> 671</span></a>            <span class="c1"># after rmo compared to before rmo &#39;augmentation&#39;</span>
</span><span id="L-672"><a href="#-672"><span class="linenos"> 672</span></a>            <span class="n">residual_times</span> <span class="o">=</span> <span class="n">rmo_indices</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span>
</span><span id="L-673"><a href="#-673"><span class="linenos"> 673</span></a>                <span class="n">angle_gather</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-674"><a href="#-674"><span class="linenos"> 674</span></a>            <span class="p">)</span>
</span><span id="L-675"><a href="#-675"><span class="linenos"> 675</span></a>            <span class="n">residual_rmo_indices</span> <span class="o">=</span> <span class="n">rmo_indices</span> <span class="o">*</span> <span class="mf">1.0</span>
</span><span id="L-676"><a href="#-676"><span class="linenos"> 676</span></a>            <span class="n">residual_rmo_indices</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-=</span> <span class="n">residual_times</span>
</span><span id="L-677"><a href="#-677"><span class="linenos"> 677</span></a>            <span class="n">residual_rmo_indices</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-=</span> <span class="n">residual_times</span>
</span><span id="L-678"><a href="#-678"><span class="linenos"> 678</span></a>            <span class="n">residual_rmo_indices</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">-=</span> <span class="n">residual_times</span>
</span><span id="L-679"><a href="#-679"><span class="linenos"> 679</span></a>            <span class="n">_rmo_indices</span> <span class="o">=</span> <span class="n">residual_rmo_indices</span>
</span><span id="L-680"><a href="#-680"><span class="linenos"> 680</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-681"><a href="#-681"><span class="linenos"> 681</span></a>            <span class="n">_rmo_indices</span> <span class="o">=</span> <span class="n">rmo_indices</span>
</span><span id="L-682"><a href="#-682"><span class="linenos"> 682</span></a>
</span><span id="L-683"><a href="#-683"><span class="linenos"> 683</span></a>        <span class="n">rmo_angle_gather</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">angle_gather</span><span class="p">)</span>
</span><span id="L-684"><a href="#-684"><span class="linenos"> 684</span></a>        <span class="k">for</span> <span class="n">iangle</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rmo_indices</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])):</span>
</span><span id="L-685"><a href="#-685"><span class="linenos"> 685</span></a>            <span class="n">rmo_angle_gather</span><span class="p">[:,</span> <span class="n">iangle</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span>
</span><span id="L-686"><a href="#-686"><span class="linenos"> 686</span></a>                <span class="nb">range</span><span class="p">(</span><span class="n">angle_gather</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
</span><span id="L-687"><a href="#-687"><span class="linenos"> 687</span></a>                <span class="n">_rmo_indices</span><span class="p">[:,</span> <span class="n">iangle</span><span class="p">],</span>
</span><span id="L-688"><a href="#-688"><span class="linenos"> 688</span></a>                <span class="n">angle_gather</span><span class="p">[:,</span> <span class="n">iangle</span><span class="p">],</span>
</span><span id="L-689"><a href="#-689"><span class="linenos"> 689</span></a>            <span class="p">)</span>
</span><span id="L-690"><a href="#-690"><span class="linenos"> 690</span></a>
</span><span id="L-691"><a href="#-691"><span class="linenos"> 691</span></a>        <span class="k">return</span> <span class="n">rmo_angle_gather</span>
</span><span id="L-692"><a href="#-692"><span class="linenos"> 692</span></a>
</span><span id="L-693"><a href="#-693"><span class="linenos"> 693</span></a>    <span class="k">def</span> <span class="nf">build_property_models_randomised_depth</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rpm</span><span class="p">,</span> <span class="n">mixing_method</span><span class="o">=</span><span class="s2">&quot;inv_vel&quot;</span><span class="p">):</span>
</span><span id="L-694"><a href="#-694"><span class="linenos"> 694</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-695"><a href="#-695"><span class="linenos"> 695</span></a><span class="sd">        Build property models with randomised depth</span>
</span><span id="L-696"><a href="#-696"><span class="linenos"> 696</span></a><span class="sd">        -------------------------------------------</span>
</span><span id="L-697"><a href="#-697"><span class="linenos"> 697</span></a><span class="sd">        Builds property models with randomised depth.</span>
</span><span id="L-698"><a href="#-698"><span class="linenos"> 698</span></a>
</span><span id="L-699"><a href="#-699"><span class="linenos"> 699</span></a><span class="sd">        v2 but with Backus moduli mixing instead of inverse velocity mixing</span>
</span><span id="L-700"><a href="#-700"><span class="linenos"> 700</span></a><span class="sd">        mixing_method one of [&quot;InverseVelocity&quot;, &quot;BackusModuli&quot;]</span>
</span><span id="L-701"><a href="#-701"><span class="linenos"> 701</span></a>
</span><span id="L-702"><a href="#-702"><span class="linenos"> 702</span></a><span class="sd">        Parameters</span>
</span><span id="L-703"><a href="#-703"><span class="linenos"> 703</span></a><span class="sd">        ----------</span>
</span><span id="L-704"><a href="#-704"><span class="linenos"> 704</span></a><span class="sd">        rpm : str</span>
</span><span id="L-705"><a href="#-705"><span class="linenos"> 705</span></a><span class="sd">            Rock properties model.</span>
</span><span id="L-706"><a href="#-706"><span class="linenos"> 706</span></a><span class="sd">        mixing_method : str</span>
</span><span id="L-707"><a href="#-707"><span class="linenos"> 707</span></a><span class="sd">            Mixing method for randomised depth.</span>
</span><span id="L-708"><a href="#-708"><span class="linenos"> 708</span></a><span class="sd">        </span>
</span><span id="L-709"><a href="#-709"><span class="linenos"> 709</span></a><span class="sd">        Returns</span>
</span><span id="L-710"><a href="#-710"><span class="linenos"> 710</span></a><span class="sd">        -------</span>
</span><span id="L-711"><a href="#-711"><span class="linenos"> 711</span></a><span class="sd">        None</span>
</span><span id="L-712"><a href="#-712"><span class="linenos"> 712</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-713"><a href="#-713"><span class="linenos"> 713</span></a>        <span class="n">layer_half_range</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">rpm_scaling_factors</span><span class="p">[</span><span class="s2">&quot;layershiftsamples&quot;</span><span class="p">]</span>
</span><span id="L-714"><a href="#-714"><span class="linenos"> 714</span></a>        <span class="n">property_half_range</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">rpm_scaling_factors</span><span class="p">[</span><span class="s2">&quot;RPshiftsamples&quot;</span><span class="p">]</span>
</span><span id="L-715"><a href="#-715"><span class="linenos"> 715</span></a>
</span><span id="L-716"><a href="#-716"><span class="linenos"> 716</span></a>        <span class="n">depth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">h5file</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ModelData</span><span class="o">.</span><span class="n">faulted_depth</span><span class="p">[:]</span>
</span><span id="L-717"><a href="#-717"><span class="linenos"> 717</span></a>        <span class="n">lith</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">faulted_lithology</span><span class="p">[:]</span>
</span><span id="L-718"><a href="#-718"><span class="linenos"> 718</span></a>        <span class="n">net_to_gross</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">faulted_net_to_gross</span><span class="p">[:]</span>
</span><span id="L-719"><a href="#-719"><span class="linenos"> 719</span></a>
</span><span id="L-720"><a href="#-720"><span class="linenos"> 720</span></a>        <span class="n">oil_closures</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">h5file</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ModelData</span><span class="o">.</span><span class="n">oil_closures</span><span class="p">[:]</span>
</span><span id="L-721"><a href="#-721"><span class="linenos"> 721</span></a>        <span class="n">gas_closures</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">h5file</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ModelData</span><span class="o">.</span><span class="n">gas_closures</span><span class="p">[:]</span>
</span><span id="L-722"><a href="#-722"><span class="linenos"> 722</span></a>
</span><span id="L-723"><a href="#-723"><span class="linenos"> 723</span></a>        <span class="n">integer_faulted_age</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-724"><a href="#-724"><span class="linenos"> 724</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">h5file</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ModelData</span><span class="o">.</span><span class="n">faulted_age_volume</span><span class="p">[:]</span> <span class="o">+</span> <span class="mf">0.00001</span>
</span><span id="L-725"><a href="#-725"><span class="linenos"> 725</span></a>        <span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</span><span id="L-726"><a href="#-726"><span class="linenos"> 726</span></a>
</span><span id="L-727"><a href="#-727"><span class="linenos"> 727</span></a>        <span class="c1"># Use empty class object to store all Rho, Vp, Vs volumes (randomised, fluid factor and non randomised)</span>
</span><span id="L-728"><a href="#-728"><span class="linenos"> 728</span></a>        <span class="n">mixed_properties</span> <span class="o">=</span> <span class="n">ElasticProperties3D</span><span class="p">()</span>
</span><span id="L-729"><a href="#-729"><span class="linenos"> 729</span></a>        <span class="n">mixed_properties</span><span class="o">.</span><span class="n">rho</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">lith</span><span class="p">)</span>
</span><span id="L-730"><a href="#-730"><span class="linenos"> 730</span></a>        <span class="n">mixed_properties</span><span class="o">.</span><span class="n">vp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">lith</span><span class="p">)</span>
</span><span id="L-731"><a href="#-731"><span class="linenos"> 731</span></a>        <span class="n">mixed_properties</span><span class="o">.</span><span class="n">vs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">lith</span><span class="p">)</span>
</span><span id="L-732"><a href="#-732"><span class="linenos"> 732</span></a>        <span class="n">mixed_properties</span><span class="o">.</span><span class="n">sum_net</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">lith</span><span class="p">)</span>
</span><span id="L-733"><a href="#-733"><span class="linenos"> 733</span></a>        <span class="n">cube_shape</span> <span class="o">=</span> <span class="n">lith</span><span class="o">.</span><span class="n">shape</span>
</span><span id="L-734"><a href="#-734"><span class="linenos"> 734</span></a>
</span><span id="L-735"><a href="#-735"><span class="linenos"> 735</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="L-736"><a href="#-736"><span class="linenos"> 736</span></a>            <span class="n">mixed_properties</span><span class="o">.</span><span class="n">rho_not_random</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">lith</span><span class="p">)</span>
</span><span id="L-737"><a href="#-737"><span class="linenos"> 737</span></a>            <span class="n">mixed_properties</span><span class="o">.</span><span class="n">vp_not_random</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">lith</span><span class="p">)</span>
</span><span id="L-738"><a href="#-738"><span class="linenos"> 738</span></a>            <span class="n">mixed_properties</span><span class="o">.</span><span class="n">vs_not_random</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">lith</span><span class="p">)</span>
</span><span id="L-739"><a href="#-739"><span class="linenos"> 739</span></a>
</span><span id="L-740"><a href="#-740"><span class="linenos"> 740</span></a>        <span class="c1"># water layer</span>
</span><span id="L-741"><a href="#-741"><span class="linenos"> 741</span></a>        <span class="n">mixed_properties</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">water_properties</span><span class="p">(</span><span class="n">lith</span><span class="p">,</span> <span class="n">mixed_properties</span><span class="p">)</span>
</span><span id="L-742"><a href="#-742"><span class="linenos"> 742</span></a>
</span><span id="L-743"><a href="#-743"><span class="linenos"> 743</span></a>        <span class="n">mixed_properties</span><span class="o">.</span><span class="n">rho_ff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">mixed_properties</span><span class="o">.</span><span class="n">rho</span><span class="p">)</span>
</span><span id="L-744"><a href="#-744"><span class="linenos"> 744</span></a>        <span class="n">mixed_properties</span><span class="o">.</span><span class="n">vp_ff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">mixed_properties</span><span class="o">.</span><span class="n">vp</span><span class="p">)</span>
</span><span id="L-745"><a href="#-745"><span class="linenos"> 745</span></a>        <span class="n">mixed_properties</span><span class="o">.</span><span class="n">vs_ff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">mixed_properties</span><span class="o">.</span><span class="n">vs</span><span class="p">)</span>
</span><span id="L-746"><a href="#-746"><span class="linenos"> 746</span></a>
</span><span id="L-747"><a href="#-747"><span class="linenos"> 747</span></a>        <span class="n">delta_z_lyrs</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-748"><a href="#-748"><span class="linenos"> 748</span></a>        <span class="n">delta_z_shales</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-749"><a href="#-749"><span class="linenos"> 749</span></a>        <span class="n">delta_z_brine_sands</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-750"><a href="#-750"><span class="linenos"> 750</span></a>        <span class="n">delta_z_oil_sands</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-751"><a href="#-751"><span class="linenos"> 751</span></a>        <span class="n">delta_z_gas_sands</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-752"><a href="#-752"><span class="linenos"> 752</span></a>
</span><span id="L-753"><a href="#-753"><span class="linenos"> 753</span></a>        <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">integer_faulted_age</span><span class="o">.</span><span class="n">max</span><span class="p">()):</span>
</span><span id="L-754"><a href="#-754"><span class="linenos"> 754</span></a>            <span class="n">__i</span><span class="p">,</span> <span class="n">__j</span><span class="p">,</span> <span class="n">__k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">integer_faulted_age</span> <span class="o">==</span> <span class="n">z</span><span class="p">)</span>
</span><span id="L-755"><a href="#-755"><span class="linenos"> 755</span></a>
</span><span id="L-756"><a href="#-756"><span class="linenos"> 756</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">__k</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-757"><a href="#-757"><span class="linenos"> 757</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="L-758"><a href="#-758"><span class="linenos"> 758</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="L-759"><a href="#-759"><span class="linenos"> 759</span></a>                        <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">*********************</span><span class="se">\n</span><span class="s2"> ... layer number = </span><span class="si">{</span><span class="n">z</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-760"><a href="#-760"><span class="linenos"> 760</span></a>                        <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> ... n2g (min,mean,max) = &quot;</span>
</span><span id="L-761"><a href="#-761"><span class="linenos"> 761</span></a>                        <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">net_to_gross</span><span class="p">[</span><span class="n">__i</span><span class="p">,</span> <span class="n">__j</span><span class="p">,</span> <span class="n">__k</span><span class="p">])</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="si">}</span><span class="s2">,&quot;</span>
</span><span id="L-762"><a href="#-762"><span class="linenos"> 762</span></a>                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">net_to_gross</span><span class="p">[</span><span class="n">__i</span><span class="p">,</span> <span class="n">__j</span><span class="p">,</span> <span class="n">__k</span><span class="p">])</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="si">}</span><span class="s2">,&quot;</span>
</span><span id="L-763"><a href="#-763"><span class="linenos"> 763</span></a>                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">net_to_gross</span><span class="p">[</span><span class="n">__i</span><span class="p">,</span> <span class="n">__j</span><span class="p">,</span> <span class="n">__k</span><span class="p">])</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="si">}</span><span class="s2">,)&quot;</span>
</span><span id="L-764"><a href="#-764"><span class="linenos"> 764</span></a>                    <span class="p">)</span>
</span><span id="L-765"><a href="#-765"><span class="linenos"> 765</span></a>
</span><span id="L-766"><a href="#-766"><span class="linenos"> 766</span></a>                <span class="n">delta_z_layer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_delta_z_layer</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">layer_half_range</span><span class="p">,</span> <span class="n">__k</span><span class="p">)</span>
</span><span id="L-767"><a href="#-767"><span class="linenos"> 767</span></a>                <span class="n">delta_z_lyrs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">delta_z_layer</span><span class="p">)</span>
</span><span id="L-768"><a href="#-768"><span class="linenos"> 768</span></a>
</span><span id="L-769"><a href="#-769"><span class="linenos"> 769</span></a>            <span class="c1"># shale required for all voxels</span>
</span><span id="L-770"><a href="#-770"><span class="linenos"> 770</span></a>            <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">net_to_gross</span> <span class="o">&gt;=</span> <span class="mf">0.0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">integer_faulted_age</span> <span class="o">==</span> <span class="n">z</span><span class="p">))</span>
</span><span id="L-771"><a href="#-771"><span class="linenos"> 771</span></a>
</span><span id="L-772"><a href="#-772"><span class="linenos"> 772</span></a>            <span class="n">shale_voxel_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
</span><span id="L-773"><a href="#-773"><span class="linenos"> 773</span></a>            <span class="n">delta_z_rho</span><span class="p">,</span> <span class="n">delta_z_vp</span><span class="p">,</span> <span class="n">delta_z_vs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_delta_z_properties</span><span class="p">(</span>
</span><span id="L-774"><a href="#-774"><span class="linenos"> 774</span></a>                <span class="n">z</span><span class="p">,</span> <span class="n">property_half_range</span>
</span><span id="L-775"><a href="#-775"><span class="linenos"> 775</span></a>            <span class="p">)</span>
</span><span id="L-776"><a href="#-776"><span class="linenos"> 776</span></a>            <span class="n">delta_z_shales</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">delta_z_rho</span><span class="p">,</span> <span class="n">delta_z_vp</span><span class="p">,</span> <span class="n">delta_z_vs</span><span class="p">))</span>
</span><span id="L-777"><a href="#-777"><span class="linenos"> 777</span></a>
</span><span id="L-778"><a href="#-778"><span class="linenos"> 778</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-779"><a href="#-779"><span class="linenos"> 779</span></a>                <span class="n">_k_rho</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
</span><span id="L-780"><a href="#-780"><span class="linenos"> 780</span></a>                    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="n">delta_z_layer</span> <span class="o">+</span> <span class="n">delta_z_rho</span><span class="p">)</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span>
</span><span id="L-781"><a href="#-781"><span class="linenos"> 781</span></a>                        <span class="mi">0</span><span class="p">,</span> <span class="n">cube_shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">10</span>
</span><span id="L-782"><a href="#-782"><span class="linenos"> 782</span></a>                    <span class="p">)</span>
</span><span id="L-783"><a href="#-783"><span class="linenos"> 783</span></a>                <span class="p">)</span>
</span><span id="L-784"><a href="#-784"><span class="linenos"> 784</span></a>                <span class="n">_k_vp</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
</span><span id="L-785"><a href="#-785"><span class="linenos"> 785</span></a>                    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="n">delta_z_layer</span> <span class="o">+</span> <span class="n">delta_z_vp</span><span class="p">)</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span>
</span><span id="L-786"><a href="#-786"><span class="linenos"> 786</span></a>                        <span class="mi">0</span><span class="p">,</span> <span class="n">cube_shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">10</span>
</span><span id="L-787"><a href="#-787"><span class="linenos"> 787</span></a>                    <span class="p">)</span>
</span><span id="L-788"><a href="#-788"><span class="linenos"> 788</span></a>                <span class="p">)</span>
</span><span id="L-789"><a href="#-789"><span class="linenos"> 789</span></a>                <span class="n">_k_vs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
</span><span id="L-790"><a href="#-790"><span class="linenos"> 790</span></a>                    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="n">delta_z_layer</span> <span class="o">+</span> <span class="n">delta_z_vs</span><span class="p">)</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span>
</span><span id="L-791"><a href="#-791"><span class="linenos"> 791</span></a>                        <span class="mi">0</span><span class="p">,</span> <span class="n">cube_shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">10</span>
</span><span id="L-792"><a href="#-792"><span class="linenos"> 792</span></a>                    <span class="p">)</span>
</span><span id="L-793"><a href="#-793"><span class="linenos"> 793</span></a>                <span class="p">)</span>
</span><span id="L-794"><a href="#-794"><span class="linenos"> 794</span></a>
</span><span id="L-795"><a href="#-795"><span class="linenos"> 795</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="L-796"><a href="#-796"><span class="linenos"> 796</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="L-797"><a href="#-797"><span class="linenos"> 797</span></a>                        <span class="sa">f</span><span class="s2">&quot; ... shale: (delta_z_rho, delta_z_vp, delta_z_vs) = </span><span class="si">{</span><span class="n">delta_z_rho</span><span class="p">,</span> <span class="n">delta_z_vp</span><span class="p">,</span> <span class="n">delta_z_vs</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-798"><a href="#-798"><span class="linenos"> 798</span></a>                    <span class="p">)</span>
</span><span id="L-799"><a href="#-799"><span class="linenos"> 799</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; ... shale: i = </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-800"><a href="#-800"><span class="linenos"> 800</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; ... shale: k = </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-801"><a href="#-801"><span class="linenos"> 801</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; ... shale: _k = </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">_k_rho</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-802"><a href="#-802"><span class="linenos"> 802</span></a>
</span><span id="L-803"><a href="#-803"><span class="linenos"> 803</span></a>                <span class="n">mixed_properties</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_shales</span><span class="p">(</span>
</span><span id="L-804"><a href="#-804"><span class="linenos"> 804</span></a>                    <span class="n">xyz</span><span class="o">=</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span>
</span><span id="L-805"><a href="#-805"><span class="linenos"> 805</span></a>                    <span class="n">shifts</span><span class="o">=</span><span class="p">(</span><span class="n">_k_rho</span><span class="p">,</span> <span class="n">_k_vp</span><span class="p">,</span> <span class="n">_k_vs</span><span class="p">),</span>
</span><span id="L-806"><a href="#-806"><span class="linenos"> 806</span></a>                    <span class="n">props</span><span class="o">=</span><span class="n">mixed_properties</span><span class="p">,</span>
</span><span id="L-807"><a href="#-807"><span class="linenos"> 807</span></a>                    <span class="n">rpm</span><span class="o">=</span><span class="n">rpm</span><span class="p">,</span>
</span><span id="L-808"><a href="#-808"><span class="linenos"> 808</span></a>                    <span class="n">depth</span><span class="o">=</span><span class="n">depth</span><span class="p">,</span>
</span><span id="L-809"><a href="#-809"><span class="linenos"> 809</span></a>                    <span class="n">z</span><span class="o">=</span><span class="n">z</span><span class="p">,</span>
</span><span id="L-810"><a href="#-810"><span class="linenos"> 810</span></a>                <span class="p">)</span>
</span><span id="L-811"><a href="#-811"><span class="linenos"> 811</span></a>
</span><span id="L-812"><a href="#-812"><span class="linenos"> 812</span></a>            <span class="c1"># brine sand or mixture of brine sand and shale in same voxel</span>
</span><span id="L-813"><a href="#-813"><span class="linenos"> 813</span></a>            <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
</span><span id="L-814"><a href="#-814"><span class="linenos"> 814</span></a>                <span class="p">(</span><span class="n">net_to_gross</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">)</span>
</span><span id="L-815"><a href="#-815"><span class="linenos"> 815</span></a>                <span class="o">&amp;</span> <span class="p">(</span><span class="n">oil_closures</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">)</span>
</span><span id="L-816"><a href="#-816"><span class="linenos"> 816</span></a>                <span class="o">&amp;</span> <span class="p">(</span><span class="n">gas_closures</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">)</span>
</span><span id="L-817"><a href="#-817"><span class="linenos"> 817</span></a>                <span class="o">&amp;</span> <span class="p">(</span><span class="n">integer_faulted_age</span> <span class="o">==</span> <span class="n">z</span><span class="p">)</span>
</span><span id="L-818"><a href="#-818"><span class="linenos"> 818</span></a>            <span class="p">)</span>
</span><span id="L-819"><a href="#-819"><span class="linenos"> 819</span></a>            <span class="n">brine_voxel_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
</span><span id="L-820"><a href="#-820"><span class="linenos"> 820</span></a>            <span class="n">delta_z_rho</span><span class="p">,</span> <span class="n">delta_z_vp</span><span class="p">,</span> <span class="n">delta_z_vs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_delta_z_properties</span><span class="p">(</span>
</span><span id="L-821"><a href="#-821"><span class="linenos"> 821</span></a>                <span class="n">z</span><span class="p">,</span> <span class="n">property_half_range</span>
</span><span id="L-822"><a href="#-822"><span class="linenos"> 822</span></a>            <span class="p">)</span>
</span><span id="L-823"><a href="#-823"><span class="linenos"> 823</span></a>            <span class="n">delta_z_brine_sands</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">delta_z_rho</span><span class="p">,</span> <span class="n">delta_z_vp</span><span class="p">,</span> <span class="n">delta_z_vs</span><span class="p">))</span>
</span><span id="L-824"><a href="#-824"><span class="linenos"> 824</span></a>
</span><span id="L-825"><a href="#-825"><span class="linenos"> 825</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-826"><a href="#-826"><span class="linenos"> 826</span></a>                <span class="n">_k_rho</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
</span><span id="L-827"><a href="#-827"><span class="linenos"> 827</span></a>                    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="n">delta_z_layer</span> <span class="o">+</span> <span class="n">delta_z_rho</span><span class="p">)</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span>
</span><span id="L-828"><a href="#-828"><span class="linenos"> 828</span></a>                        <span class="mi">0</span><span class="p">,</span> <span class="n">cube_shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">10</span>
</span><span id="L-829"><a href="#-829"><span class="linenos"> 829</span></a>                    <span class="p">)</span>
</span><span id="L-830"><a href="#-830"><span class="linenos"> 830</span></a>                <span class="p">)</span>
</span><span id="L-831"><a href="#-831"><span class="linenos"> 831</span></a>                <span class="n">_k_vp</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
</span><span id="L-832"><a href="#-832"><span class="linenos"> 832</span></a>                    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="n">delta_z_layer</span> <span class="o">+</span> <span class="n">delta_z_vp</span><span class="p">)</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span>
</span><span id="L-833"><a href="#-833"><span class="linenos"> 833</span></a>                        <span class="mi">0</span><span class="p">,</span> <span class="n">cube_shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">10</span>
</span><span id="L-834"><a href="#-834"><span class="linenos"> 834</span></a>                    <span class="p">)</span>
</span><span id="L-835"><a href="#-835"><span class="linenos"> 835</span></a>                <span class="p">)</span>
</span><span id="L-836"><a href="#-836"><span class="linenos"> 836</span></a>                <span class="n">_k_vs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
</span><span id="L-837"><a href="#-837"><span class="linenos"> 837</span></a>                    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="n">delta_z_layer</span> <span class="o">+</span> <span class="n">delta_z_vs</span><span class="p">)</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span>
</span><span id="L-838"><a href="#-838"><span class="linenos"> 838</span></a>                        <span class="mi">0</span><span class="p">,</span> <span class="n">cube_shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">10</span>
</span><span id="L-839"><a href="#-839"><span class="linenos"> 839</span></a>                    <span class="p">)</span>
</span><span id="L-840"><a href="#-840"><span class="linenos"> 840</span></a>                <span class="p">)</span>
</span><span id="L-841"><a href="#-841"><span class="linenos"> 841</span></a>
</span><span id="L-842"><a href="#-842"><span class="linenos"> 842</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="L-843"><a href="#-843"><span class="linenos"> 843</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="L-844"><a href="#-844"><span class="linenos"> 844</span></a>                        <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> ... brine: (delta_z_rho, delta_z_vp, delta_z_vs) = </span><span class="si">{</span><span class="n">delta_z_rho</span><span class="p">,</span> <span class="n">delta_z_vp</span><span class="p">,</span> <span class="n">delta_z_vs</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-845"><a href="#-845"><span class="linenos"> 845</span></a>                    <span class="p">)</span>
</span><span id="L-846"><a href="#-846"><span class="linenos"> 846</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; ... brine: i = </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-847"><a href="#-847"><span class="linenos"> 847</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; ... brine: k = </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-848"><a href="#-848"><span class="linenos"> 848</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; ... brine: _k = </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">_k_rho</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-849"><a href="#-849"><span class="linenos"> 849</span></a>
</span><span id="L-850"><a href="#-850"><span class="linenos"> 850</span></a>                <span class="n">mixed_properties</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_sands</span><span class="p">(</span>
</span><span id="L-851"><a href="#-851"><span class="linenos"> 851</span></a>                    <span class="n">xyz</span><span class="o">=</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span>
</span><span id="L-852"><a href="#-852"><span class="linenos"> 852</span></a>                    <span class="n">shifts</span><span class="o">=</span><span class="p">(</span><span class="n">_k_rho</span><span class="p">,</span> <span class="n">_k_vp</span><span class="p">,</span> <span class="n">_k_vs</span><span class="p">),</span>
</span><span id="L-853"><a href="#-853"><span class="linenos"> 853</span></a>                    <span class="n">props</span><span class="o">=</span><span class="n">mixed_properties</span><span class="p">,</span>
</span><span id="L-854"><a href="#-854"><span class="linenos"> 854</span></a>                    <span class="n">rpm</span><span class="o">=</span><span class="n">rpm</span><span class="p">,</span>
</span><span id="L-855"><a href="#-855"><span class="linenos"> 855</span></a>                    <span class="n">depth</span><span class="o">=</span><span class="n">depth</span><span class="p">,</span>
</span><span id="L-856"><a href="#-856"><span class="linenos"> 856</span></a>                    <span class="n">ng</span><span class="o">=</span><span class="n">net_to_gross</span><span class="p">,</span>
</span><span id="L-857"><a href="#-857"><span class="linenos"> 857</span></a>                    <span class="n">z</span><span class="o">=</span><span class="n">z</span><span class="p">,</span>
</span><span id="L-858"><a href="#-858"><span class="linenos"> 858</span></a>                    <span class="n">fluid</span><span class="o">=</span><span class="s2">&quot;brine&quot;</span><span class="p">,</span>
</span><span id="L-859"><a href="#-859"><span class="linenos"> 859</span></a>                    <span class="n">mix</span><span class="o">=</span><span class="n">mixing_method</span><span class="p">,</span>
</span><span id="L-860"><a href="#-860"><span class="linenos"> 860</span></a>                <span class="p">)</span>
</span><span id="L-861"><a href="#-861"><span class="linenos"> 861</span></a>
</span><span id="L-862"><a href="#-862"><span class="linenos"> 862</span></a>            <span class="c1"># oil sands</span>
</span><span id="L-863"><a href="#-863"><span class="linenos"> 863</span></a>            <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
</span><span id="L-864"><a href="#-864"><span class="linenos"> 864</span></a>                <span class="p">(</span><span class="n">net_to_gross</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">)</span>
</span><span id="L-865"><a href="#-865"><span class="linenos"> 865</span></a>                <span class="o">&amp;</span> <span class="p">(</span><span class="n">oil_closures</span> <span class="o">==</span> <span class="mf">1.0</span><span class="p">)</span>
</span><span id="L-866"><a href="#-866"><span class="linenos"> 866</span></a>                <span class="o">&amp;</span> <span class="p">(</span><span class="n">gas_closures</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">)</span>
</span><span id="L-867"><a href="#-867"><span class="linenos"> 867</span></a>                <span class="o">&amp;</span> <span class="p">(</span><span class="n">integer_faulted_age</span> <span class="o">==</span> <span class="n">z</span><span class="p">)</span>
</span><span id="L-868"><a href="#-868"><span class="linenos"> 868</span></a>            <span class="p">)</span>
</span><span id="L-869"><a href="#-869"><span class="linenos"> 869</span></a>            <span class="n">oil_voxel_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
</span><span id="L-870"><a href="#-870"><span class="linenos"> 870</span></a>            <span class="n">delta_z_rho</span><span class="p">,</span> <span class="n">delta_z_vp</span><span class="p">,</span> <span class="n">delta_z_vs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_delta_z_properties</span><span class="p">(</span>
</span><span id="L-871"><a href="#-871"><span class="linenos"> 871</span></a>                <span class="n">z</span><span class="p">,</span> <span class="n">property_half_range</span>
</span><span id="L-872"><a href="#-872"><span class="linenos"> 872</span></a>            <span class="p">)</span>
</span><span id="L-873"><a href="#-873"><span class="linenos"> 873</span></a>            <span class="n">delta_z_oil_sands</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">delta_z_rho</span><span class="p">,</span> <span class="n">delta_z_vp</span><span class="p">,</span> <span class="n">delta_z_vs</span><span class="p">))</span>
</span><span id="L-874"><a href="#-874"><span class="linenos"> 874</span></a>
</span><span id="L-875"><a href="#-875"><span class="linenos"> 875</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-876"><a href="#-876"><span class="linenos"> 876</span></a>                <span class="n">_k_rho</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
</span><span id="L-877"><a href="#-877"><span class="linenos"> 877</span></a>                    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="n">delta_z_layer</span> <span class="o">+</span> <span class="n">delta_z_rho</span><span class="p">)</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span>
</span><span id="L-878"><a href="#-878"><span class="linenos"> 878</span></a>                        <span class="mi">0</span><span class="p">,</span> <span class="n">cube_shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">10</span>
</span><span id="L-879"><a href="#-879"><span class="linenos"> 879</span></a>                    <span class="p">)</span>
</span><span id="L-880"><a href="#-880"><span class="linenos"> 880</span></a>                <span class="p">)</span>
</span><span id="L-881"><a href="#-881"><span class="linenos"> 881</span></a>                <span class="n">_k_vp</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
</span><span id="L-882"><a href="#-882"><span class="linenos"> 882</span></a>                    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="n">delta_z_layer</span> <span class="o">+</span> <span class="n">delta_z_vp</span><span class="p">)</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span>
</span><span id="L-883"><a href="#-883"><span class="linenos"> 883</span></a>                        <span class="mi">0</span><span class="p">,</span> <span class="n">cube_shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">10</span>
</span><span id="L-884"><a href="#-884"><span class="linenos"> 884</span></a>                    <span class="p">)</span>
</span><span id="L-885"><a href="#-885"><span class="linenos"> 885</span></a>                <span class="p">)</span>
</span><span id="L-886"><a href="#-886"><span class="linenos"> 886</span></a>                <span class="n">_k_vs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
</span><span id="L-887"><a href="#-887"><span class="linenos"> 887</span></a>                    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="n">delta_z_layer</span> <span class="o">+</span> <span class="n">delta_z_vs</span><span class="p">)</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span>
</span><span id="L-888"><a href="#-888"><span class="linenos"> 888</span></a>                        <span class="mi">0</span><span class="p">,</span> <span class="n">cube_shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">10</span>
</span><span id="L-889"><a href="#-889"><span class="linenos"> 889</span></a>                    <span class="p">)</span>
</span><span id="L-890"><a href="#-890"><span class="linenos"> 890</span></a>                <span class="p">)</span>
</span><span id="L-891"><a href="#-891"><span class="linenos"> 891</span></a>
</span><span id="L-892"><a href="#-892"><span class="linenos"> 892</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="L-893"><a href="#-893"><span class="linenos"> 893</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="L-894"><a href="#-894"><span class="linenos"> 894</span></a>                        <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2"> ... Perform fluid substitution for oil sands. &quot;</span><span class="p">,</span>
</span><span id="L-895"><a href="#-895"><span class="linenos"> 895</span></a>                        <span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> ... Number oil voxels in closure = &quot;</span><span class="p">,</span>
</span><span id="L-896"><a href="#-896"><span class="linenos"> 896</span></a>                        <span class="n">mixed_properties</span><span class="o">.</span><span class="n">rho</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
</span><span id="L-897"><a href="#-897"><span class="linenos"> 897</span></a>                    <span class="p">)</span>
</span><span id="L-898"><a href="#-898"><span class="linenos"> 898</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="L-899"><a href="#-899"><span class="linenos"> 899</span></a>                        <span class="s2">&quot; ... closures_oil min/mean/max =  &quot;</span><span class="p">,</span>
</span><span id="L-900"><a href="#-900"><span class="linenos"> 900</span></a>                        <span class="n">oil_closures</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
</span><span id="L-901"><a href="#-901"><span class="linenos"> 901</span></a>                        <span class="n">oil_closures</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span>
</span><span id="L-902"><a href="#-902"><span class="linenos"> 902</span></a>                        <span class="n">oil_closures</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span>
</span><span id="L-903"><a href="#-903"><span class="linenos"> 903</span></a>                    <span class="p">)</span>
</span><span id="L-904"><a href="#-904"><span class="linenos"> 904</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="L-905"><a href="#-905"><span class="linenos"> 905</span></a>                        <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2"> ... np.all(oil_sand_rho[:,:,:] == brine_sand_rho[:,:,:]) &quot;</span><span class="p">,</span>
</span><span id="L-906"><a href="#-906"><span class="linenos"> 906</span></a>                        <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span>
</span><span id="L-907"><a href="#-907"><span class="linenos"> 907</span></a>                            <span class="n">rpm</span><span class="o">.</span><span class="n">calc_oil_sand_properties</span><span class="p">(</span>
</span><span id="L-908"><a href="#-908"><span class="linenos"> 908</span></a>                                <span class="n">depth</span><span class="p">[:],</span> <span class="n">depth</span><span class="p">[:],</span> <span class="n">depth</span><span class="p">[:]</span>
</span><span id="L-909"><a href="#-909"><span class="linenos"> 909</span></a>                            <span class="p">)</span><span class="o">.</span><span class="n">rho</span>
</span><span id="L-910"><a href="#-910"><span class="linenos"> 910</span></a>                            <span class="o">==</span> <span class="n">rpm</span><span class="o">.</span><span class="n">calc_brine_sand_properties</span><span class="p">(</span>
</span><span id="L-911"><a href="#-911"><span class="linenos"> 911</span></a>                                <span class="n">depth</span><span class="p">[:],</span> <span class="n">depth</span><span class="p">[:],</span> <span class="n">depth</span><span class="p">[:]</span>
</span><span id="L-912"><a href="#-912"><span class="linenos"> 912</span></a>                            <span class="p">)</span><span class="o">.</span><span class="n">rho</span>
</span><span id="L-913"><a href="#-913"><span class="linenos"> 913</span></a>                        <span class="p">),</span>
</span><span id="L-914"><a href="#-914"><span class="linenos"> 914</span></a>                    <span class="p">)</span>
</span><span id="L-915"><a href="#-915"><span class="linenos"> 915</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="L-916"><a href="#-916"><span class="linenos"> 916</span></a>                        <span class="s2">&quot; ... oil: (delta_z_rho, delta_z_vp, delta_z_vs) = &quot;</span>
</span><span id="L-917"><a href="#-917"><span class="linenos"> 917</span></a>                        <span class="o">+</span> <span class="nb">str</span><span class="p">((</span><span class="n">delta_z_rho</span><span class="p">,</span> <span class="n">delta_z_vp</span><span class="p">,</span> <span class="n">delta_z_vs</span><span class="p">))</span>
</span><span id="L-918"><a href="#-918"><span class="linenos"> 918</span></a>                    <span class="p">)</span>
</span><span id="L-919"><a href="#-919"><span class="linenos"> 919</span></a>
</span><span id="L-920"><a href="#-920"><span class="linenos"> 920</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="L-921"><a href="#-921"><span class="linenos"> 921</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; ... oil: i = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">i</span><span class="p">)))</span>
</span><span id="L-922"><a href="#-922"><span class="linenos"> 922</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; ... oil: k = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">k</span><span class="p">)))</span>
</span><span id="L-923"><a href="#-923"><span class="linenos"> 923</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; ... oil: _k = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">_k_rho</span><span class="p">)))</span>
</span><span id="L-924"><a href="#-924"><span class="linenos"> 924</span></a>
</span><span id="L-925"><a href="#-925"><span class="linenos"> 925</span></a>                <span class="n">mixed_properties</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_sands</span><span class="p">(</span>
</span><span id="L-926"><a href="#-926"><span class="linenos"> 926</span></a>                    <span class="n">xyz</span><span class="o">=</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span>
</span><span id="L-927"><a href="#-927"><span class="linenos"> 927</span></a>                    <span class="n">shifts</span><span class="o">=</span><span class="p">(</span><span class="n">_k_rho</span><span class="p">,</span> <span class="n">_k_vp</span><span class="p">,</span> <span class="n">_k_vs</span><span class="p">),</span>
</span><span id="L-928"><a href="#-928"><span class="linenos"> 928</span></a>                    <span class="n">props</span><span class="o">=</span><span class="n">mixed_properties</span><span class="p">,</span>
</span><span id="L-929"><a href="#-929"><span class="linenos"> 929</span></a>                    <span class="n">rpm</span><span class="o">=</span><span class="n">rpm</span><span class="p">,</span>
</span><span id="L-930"><a href="#-930"><span class="linenos"> 930</span></a>                    <span class="n">depth</span><span class="o">=</span><span class="n">depth</span><span class="p">,</span>
</span><span id="L-931"><a href="#-931"><span class="linenos"> 931</span></a>                    <span class="n">ng</span><span class="o">=</span><span class="n">net_to_gross</span><span class="p">,</span>
</span><span id="L-932"><a href="#-932"><span class="linenos"> 932</span></a>                    <span class="n">z</span><span class="o">=</span><span class="n">z</span><span class="p">,</span>
</span><span id="L-933"><a href="#-933"><span class="linenos"> 933</span></a>                    <span class="n">fluid</span><span class="o">=</span><span class="s2">&quot;oil&quot;</span><span class="p">,</span>
</span><span id="L-934"><a href="#-934"><span class="linenos"> 934</span></a>                    <span class="n">mix</span><span class="o">=</span><span class="n">mixing_method</span><span class="p">,</span>
</span><span id="L-935"><a href="#-935"><span class="linenos"> 935</span></a>                <span class="p">)</span>
</span><span id="L-936"><a href="#-936"><span class="linenos"> 936</span></a>
</span><span id="L-937"><a href="#-937"><span class="linenos"> 937</span></a>            <span class="c1"># gas sands</span>
</span><span id="L-938"><a href="#-938"><span class="linenos"> 938</span></a>            <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
</span><span id="L-939"><a href="#-939"><span class="linenos"> 939</span></a>                <span class="p">(</span><span class="n">net_to_gross</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">)</span>
</span><span id="L-940"><a href="#-940"><span class="linenos"> 940</span></a>                <span class="o">&amp;</span> <span class="p">(</span><span class="n">oil_closures</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">)</span>
</span><span id="L-941"><a href="#-941"><span class="linenos"> 941</span></a>                <span class="o">&amp;</span> <span class="p">(</span><span class="n">gas_closures</span> <span class="o">==</span> <span class="mf">1.0</span><span class="p">)</span>
</span><span id="L-942"><a href="#-942"><span class="linenos"> 942</span></a>                <span class="o">&amp;</span> <span class="p">(</span><span class="n">integer_faulted_age</span> <span class="o">==</span> <span class="n">z</span><span class="p">)</span>
</span><span id="L-943"><a href="#-943"><span class="linenos"> 943</span></a>            <span class="p">)</span>
</span><span id="L-944"><a href="#-944"><span class="linenos"> 944</span></a>            <span class="n">gas_voxel_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
</span><span id="L-945"><a href="#-945"><span class="linenos"> 945</span></a>            <span class="n">delta_z_rho</span><span class="p">,</span> <span class="n">delta_z_vp</span><span class="p">,</span> <span class="n">delta_z_vs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_delta_z_properties</span><span class="p">(</span>
</span><span id="L-946"><a href="#-946"><span class="linenos"> 946</span></a>                <span class="n">z</span><span class="p">,</span> <span class="n">property_half_range</span>
</span><span id="L-947"><a href="#-947"><span class="linenos"> 947</span></a>            <span class="p">)</span>
</span><span id="L-948"><a href="#-948"><span class="linenos"> 948</span></a>            <span class="n">delta_z_gas_sands</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">delta_z_rho</span><span class="p">,</span> <span class="n">delta_z_vp</span><span class="p">,</span> <span class="n">delta_z_vs</span><span class="p">))</span>
</span><span id="L-949"><a href="#-949"><span class="linenos"> 949</span></a>
</span><span id="L-950"><a href="#-950"><span class="linenos"> 950</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-951"><a href="#-951"><span class="linenos"> 951</span></a>                <span class="n">_k_rho</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
</span><span id="L-952"><a href="#-952"><span class="linenos"> 952</span></a>                    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="n">delta_z_layer</span> <span class="o">+</span> <span class="n">delta_z_rho</span><span class="p">)</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span>
</span><span id="L-953"><a href="#-953"><span class="linenos"> 953</span></a>                        <span class="mi">0</span><span class="p">,</span> <span class="n">cube_shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">10</span>
</span><span id="L-954"><a href="#-954"><span class="linenos"> 954</span></a>                    <span class="p">)</span>
</span><span id="L-955"><a href="#-955"><span class="linenos"> 955</span></a>                <span class="p">)</span>
</span><span id="L-956"><a href="#-956"><span class="linenos"> 956</span></a>                <span class="n">_k_vp</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
</span><span id="L-957"><a href="#-957"><span class="linenos"> 957</span></a>                    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="n">delta_z_layer</span> <span class="o">+</span> <span class="n">delta_z_vp</span><span class="p">)</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span>
</span><span id="L-958"><a href="#-958"><span class="linenos"> 958</span></a>                        <span class="mi">0</span><span class="p">,</span> <span class="n">cube_shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">10</span>
</span><span id="L-959"><a href="#-959"><span class="linenos"> 959</span></a>                    <span class="p">)</span>
</span><span id="L-960"><a href="#-960"><span class="linenos"> 960</span></a>                <span class="p">)</span>
</span><span id="L-961"><a href="#-961"><span class="linenos"> 961</span></a>                <span class="n">_k_vs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
</span><span id="L-962"><a href="#-962"><span class="linenos"> 962</span></a>                    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="n">delta_z_layer</span> <span class="o">+</span> <span class="n">delta_z_vs</span><span class="p">)</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span>
</span><span id="L-963"><a href="#-963"><span class="linenos"> 963</span></a>                        <span class="mi">0</span><span class="p">,</span> <span class="n">cube_shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">10</span>
</span><span id="L-964"><a href="#-964"><span class="linenos"> 964</span></a>                    <span class="p">)</span>
</span><span id="L-965"><a href="#-965"><span class="linenos"> 965</span></a>                <span class="p">)</span>
</span><span id="L-966"><a href="#-966"><span class="linenos"> 966</span></a>
</span><span id="L-967"><a href="#-967"><span class="linenos"> 967</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="L-968"><a href="#-968"><span class="linenos"> 968</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="L-969"><a href="#-969"><span class="linenos"> 969</span></a>                        <span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> ... Perform fluid substitution for gas sands. &quot;</span><span class="p">,</span>
</span><span id="L-970"><a href="#-970"><span class="linenos"> 970</span></a>                        <span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> ... Number gas voxels in closure = &quot;</span><span class="p">,</span>
</span><span id="L-971"><a href="#-971"><span class="linenos"> 971</span></a>                        <span class="n">mixed_properties</span><span class="o">.</span><span class="n">rho</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
</span><span id="L-972"><a href="#-972"><span class="linenos"> 972</span></a>                    <span class="p">)</span>
</span><span id="L-973"><a href="#-973"><span class="linenos"> 973</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="L-974"><a href="#-974"><span class="linenos"> 974</span></a>                        <span class="s2">&quot; ... closures_gas min/mean/max =  &quot;</span><span class="p">,</span>
</span><span id="L-975"><a href="#-975"><span class="linenos"> 975</span></a>                        <span class="n">gas_closures</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
</span><span id="L-976"><a href="#-976"><span class="linenos"> 976</span></a>                        <span class="n">gas_closures</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span>
</span><span id="L-977"><a href="#-977"><span class="linenos"> 977</span></a>                        <span class="n">gas_closures</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span>
</span><span id="L-978"><a href="#-978"><span class="linenos"> 978</span></a>                    <span class="p">)</span>
</span><span id="L-979"><a href="#-979"><span class="linenos"> 979</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="L-980"><a href="#-980"><span class="linenos"> 980</span></a>                        <span class="s2">&quot; ... gas: (delta_z_rho, delta_z_vp, delta_z_vs) = &quot;</span>
</span><span id="L-981"><a href="#-981"><span class="linenos"> 981</span></a>                        <span class="o">+</span> <span class="nb">str</span><span class="p">((</span><span class="n">delta_z_rho</span><span class="p">,</span> <span class="n">delta_z_vp</span><span class="p">,</span> <span class="n">delta_z_vs</span><span class="p">))</span>
</span><span id="L-982"><a href="#-982"><span class="linenos"> 982</span></a>                    <span class="p">)</span>
</span><span id="L-983"><a href="#-983"><span class="linenos"> 983</span></a>
</span><span id="L-984"><a href="#-984"><span class="linenos"> 984</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="L-985"><a href="#-985"><span class="linenos"> 985</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; ... gas: i = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">i</span><span class="p">)))</span>
</span><span id="L-986"><a href="#-986"><span class="linenos"> 986</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; ... gas: k = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">k</span><span class="p">)))</span>
</span><span id="L-987"><a href="#-987"><span class="linenos"> 987</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; ... gas: _k = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">_k_rho</span><span class="p">)))</span>
</span><span id="L-988"><a href="#-988"><span class="linenos"> 988</span></a>
</span><span id="L-989"><a href="#-989"><span class="linenos"> 989</span></a>                <span class="n">mixed_properties</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_sands</span><span class="p">(</span>
</span><span id="L-990"><a href="#-990"><span class="linenos"> 990</span></a>                    <span class="n">xyz</span><span class="o">=</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span>
</span><span id="L-991"><a href="#-991"><span class="linenos"> 991</span></a>                    <span class="n">shifts</span><span class="o">=</span><span class="p">(</span><span class="n">_k_rho</span><span class="p">,</span> <span class="n">_k_vp</span><span class="p">,</span> <span class="n">_k_vs</span><span class="p">),</span>
</span><span id="L-992"><a href="#-992"><span class="linenos"> 992</span></a>                    <span class="n">props</span><span class="o">=</span><span class="n">mixed_properties</span><span class="p">,</span>
</span><span id="L-993"><a href="#-993"><span class="linenos"> 993</span></a>                    <span class="n">rpm</span><span class="o">=</span><span class="n">rpm</span><span class="p">,</span>
</span><span id="L-994"><a href="#-994"><span class="linenos"> 994</span></a>                    <span class="n">depth</span><span class="o">=</span><span class="n">depth</span><span class="p">,</span>
</span><span id="L-995"><a href="#-995"><span class="linenos"> 995</span></a>                    <span class="n">ng</span><span class="o">=</span><span class="n">net_to_gross</span><span class="p">,</span>
</span><span id="L-996"><a href="#-996"><span class="linenos"> 996</span></a>                    <span class="n">z</span><span class="o">=</span><span class="n">z</span><span class="p">,</span>
</span><span id="L-997"><a href="#-997"><span class="linenos"> 997</span></a>                    <span class="n">fluid</span><span class="o">=</span><span class="s2">&quot;gas&quot;</span><span class="p">,</span>
</span><span id="L-998"><a href="#-998"><span class="linenos"> 998</span></a>                    <span class="n">mix</span><span class="o">=</span><span class="n">mixing_method</span><span class="p">,</span>
</span><span id="L-999"><a href="#-999"><span class="linenos"> 999</span></a>                <span class="p">)</span>
</span><span id="L-1000"><a href="#-1000"><span class="linenos">1000</span></a>
</span><span id="L-1001"><a href="#-1001"><span class="linenos">1001</span></a>            <span class="c1"># layer check</span>
</span><span id="L-1002"><a href="#-1002"><span class="linenos">1002</span></a>            <span class="n">__i</span><span class="p">,</span> <span class="n">__j</span><span class="p">,</span> <span class="n">__k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">integer_faulted_age</span> <span class="o">==</span> <span class="n">z</span><span class="p">)</span>
</span><span id="L-1003"><a href="#-1003"><span class="linenos">1003</span></a>
</span><span id="L-1004"><a href="#-1004"><span class="linenos">1004</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">__k</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-1005"><a href="#-1005"><span class="linenos">1005</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="L-1006"><a href="#-1006"><span class="linenos">1006</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="L-1007"><a href="#-1007"><span class="linenos">1007</span></a>                        <span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> ... layer number = &quot;</span>
</span><span id="L-1008"><a href="#-1008"><span class="linenos">1008</span></a>                        <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
</span><span id="L-1009"><a href="#-1009"><span class="linenos">1009</span></a>                        <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> ... sum_net (min,mean,max) = &quot;</span>
</span><span id="L-1010"><a href="#-1010"><span class="linenos">1010</span></a>                        <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="L-1011"><a href="#-1011"><span class="linenos">1011</span></a>                            <span class="p">(</span>
</span><span id="L-1012"><a href="#-1012"><span class="linenos">1012</span></a>                                <span class="n">mixed_properties</span><span class="o">.</span><span class="n">sum_net</span><span class="p">[</span><span class="n">__i</span><span class="p">,</span> <span class="n">__j</span><span class="p">,</span> <span class="n">__k</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
</span><span id="L-1013"><a href="#-1013"><span class="linenos">1013</span></a>                                <span class="n">mixed_properties</span><span class="o">.</span><span class="n">sum_net</span><span class="p">[</span><span class="n">__i</span><span class="p">,</span> <span class="n">__j</span><span class="p">,</span> <span class="n">__k</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span>
</span><span id="L-1014"><a href="#-1014"><span class="linenos">1014</span></a>                                <span class="n">mixed_properties</span><span class="o">.</span><span class="n">sum_net</span><span class="p">[</span><span class="n">__i</span><span class="p">,</span> <span class="n">__j</span><span class="p">,</span> <span class="n">__k</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span>
</span><span id="L-1015"><a href="#-1015"><span class="linenos">1015</span></a>                            <span class="p">)</span>
</span><span id="L-1016"><a href="#-1016"><span class="linenos">1016</span></a>                        <span class="p">)</span>
</span><span id="L-1017"><a href="#-1017"><span class="linenos">1017</span></a>                    <span class="p">)</span>
</span><span id="L-1018"><a href="#-1018"><span class="linenos">1018</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="L-1019"><a href="#-1019"><span class="linenos">1019</span></a>                        <span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> ... layer number = &quot;</span>
</span><span id="L-1020"><a href="#-1020"><span class="linenos">1020</span></a>                        <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
</span><span id="L-1021"><a href="#-1021"><span class="linenos">1021</span></a>                        <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> ... (shale, brine, oil, gas) voxel_counts = &quot;</span>
</span><span id="L-1022"><a href="#-1022"><span class="linenos">1022</span></a>                        <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="L-1023"><a href="#-1023"><span class="linenos">1023</span></a>                            <span class="p">(</span>
</span><span id="L-1024"><a href="#-1024"><span class="linenos">1024</span></a>                                <span class="n">shale_voxel_count</span><span class="p">,</span>
</span><span id="L-1025"><a href="#-1025"><span class="linenos">1025</span></a>                                <span class="n">brine_voxel_count</span><span class="p">,</span>
</span><span id="L-1026"><a href="#-1026"><span class="linenos">1026</span></a>                                <span class="n">oil_voxel_count</span><span class="p">,</span>
</span><span id="L-1027"><a href="#-1027"><span class="linenos">1027</span></a>                                <span class="n">gas_voxel_count</span><span class="p">,</span>
</span><span id="L-1028"><a href="#-1028"><span class="linenos">1028</span></a>                            <span class="p">)</span>
</span><span id="L-1029"><a href="#-1029"><span class="linenos">1029</span></a>                        <span class="p">)</span>
</span><span id="L-1030"><a href="#-1030"><span class="linenos">1030</span></a>                        <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> ... shale_count = brine+oil+gas? &quot;</span>
</span><span id="L-1031"><a href="#-1031"><span class="linenos">1031</span></a>                        <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="L-1032"><a href="#-1032"><span class="linenos">1032</span></a>                            <span class="n">shale_voxel_count</span>
</span><span id="L-1033"><a href="#-1033"><span class="linenos">1033</span></a>                            <span class="o">==</span> <span class="n">brine_voxel_count</span> <span class="o">+</span> <span class="n">oil_voxel_count</span> <span class="o">+</span> <span class="n">gas_voxel_count</span>
</span><span id="L-1034"><a href="#-1034"><span class="linenos">1034</span></a>                        <span class="p">)</span>
</span><span id="L-1035"><a href="#-1035"><span class="linenos">1035</span></a>                        <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">*********************&quot;</span>
</span><span id="L-1036"><a href="#-1036"><span class="linenos">1036</span></a>                    <span class="p">)</span>
</span><span id="L-1037"><a href="#-1037"><span class="linenos">1037</span></a>
</span><span id="L-1038"><a href="#-1038"><span class="linenos">1038</span></a>        <span class="c1"># overwrite rho, vp, vs for salt if required</span>
</span><span id="L-1039"><a href="#-1039"><span class="linenos">1039</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">include_salt</span><span class="p">:</span>
</span><span id="L-1040"><a href="#-1040"><span class="linenos">1040</span></a>            <span class="c1"># Salt. Set lith = 2.0</span>
</span><span id="L-1041"><a href="#-1041"><span class="linenos">1041</span></a>            <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">lith</span> <span class="o">==</span> <span class="mf">2.0</span><span class="p">)</span>
</span><span id="L-1042"><a href="#-1042"><span class="linenos">1042</span></a>            <span class="n">mixed_properties</span><span class="o">.</span><span class="n">rho</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">2.17</span>  <span class="c1"># divide by 2 since lith = 2.0</span>
</span><span id="L-1043"><a href="#-1043"><span class="linenos">1043</span></a>            <span class="n">mixed_properties</span><span class="o">.</span><span class="n">vp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">4500.0</span>
</span><span id="L-1044"><a href="#-1044"><span class="linenos">1044</span></a>            <span class="n">mixed_properties</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">2250.0</span>
</span><span id="L-1045"><a href="#-1045"><span class="linenos">1045</span></a>            <span class="c1"># Include fluidfactor rho, vp, vs inside salt body</span>
</span><span id="L-1046"><a href="#-1046"><span class="linenos">1046</span></a>            <span class="n">mixed_properties</span><span class="o">.</span><span class="n">rho_ff</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">mixed_properties</span><span class="o">.</span><span class="n">rho</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span>
</span><span id="L-1047"><a href="#-1047"><span class="linenos">1047</span></a>            <span class="n">mixed_properties</span><span class="o">.</span><span class="n">vp_ff</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">mixed_properties</span><span class="o">.</span><span class="n">vp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span>
</span><span id="L-1048"><a href="#-1048"><span class="linenos">1048</span></a>            <span class="n">mixed_properties</span><span class="o">.</span><span class="n">vs_ff</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">mixed_properties</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span>
</span><span id="L-1049"><a href="#-1049"><span class="linenos">1049</span></a>
</span><span id="L-1050"><a href="#-1050"><span class="linenos">1050</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="L-1051"><a href="#-1051"><span class="linenos">1051</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Checking for null values inside build_randomised_properties:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1052"><a href="#-1052"><span class="linenos">1052</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="L-1053"><a href="#-1053"><span class="linenos">1053</span></a>                <span class="sa">f</span><span class="s2">&quot;Rho: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">mixed_properties</span><span class="o">.</span><span class="n">rho</span><span class="p">)</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">mixed_properties</span><span class="o">.</span><span class="n">rho</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-1054"><a href="#-1054"><span class="linenos">1054</span></a>            <span class="p">)</span>
</span><span id="L-1055"><a href="#-1055"><span class="linenos">1055</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Vp: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">mixed_properties</span><span class="o">.</span><span class="n">vp</span><span class="p">)</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">mixed_properties</span><span class="o">.</span><span class="n">vp</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1056"><a href="#-1056"><span class="linenos">1056</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Vs: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">mixed_properties</span><span class="o">.</span><span class="n">vs</span><span class="p">)</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">mixed_properties</span><span class="o">.</span><span class="n">vs</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1057"><a href="#-1057"><span class="linenos">1057</span></a>
</span><span id="L-1058"><a href="#-1058"><span class="linenos">1058</span></a>        <span class="c1"># Fix empty voxels at base of property volumes</span>
</span><span id="L-1059"><a href="#-1059"><span class="linenos">1059</span></a>        <span class="n">mixed_properties</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fix_zero_values_at_base</span><span class="p">(</span><span class="n">mixed_properties</span><span class="p">)</span>
</span><span id="L-1060"><a href="#-1060"><span class="linenos">1060</span></a>
</span><span id="L-1061"><a href="#-1061"><span class="linenos">1061</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="L-1062"><a href="#-1062"><span class="linenos">1062</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="L-1063"><a href="#-1063"><span class="linenos">1063</span></a>                <span class="s2">&quot;Checking for null values inside build_randomised_properties AFTER fix:</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="L-1064"><a href="#-1064"><span class="linenos">1064</span></a>            <span class="p">)</span>
</span><span id="L-1065"><a href="#-1065"><span class="linenos">1065</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="L-1066"><a href="#-1066"><span class="linenos">1066</span></a>                <span class="sa">f</span><span class="s2">&quot;Rho: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">mixed_properties</span><span class="o">.</span><span class="n">rho</span><span class="p">)</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">mixed_properties</span><span class="o">.</span><span class="n">rho</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-1067"><a href="#-1067"><span class="linenos">1067</span></a>            <span class="p">)</span>
</span><span id="L-1068"><a href="#-1068"><span class="linenos">1068</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Vp: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">mixed_properties</span><span class="o">.</span><span class="n">vp</span><span class="p">)</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">mixed_properties</span><span class="o">.</span><span class="n">vp</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1069"><a href="#-1069"><span class="linenos">1069</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Vs: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">mixed_properties</span><span class="o">.</span><span class="n">vs</span><span class="p">)</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">mixed_properties</span><span class="o">.</span><span class="n">vs</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1070"><a href="#-1070"><span class="linenos">1070</span></a>
</span><span id="L-1071"><a href="#-1071"><span class="linenos">1071</span></a>        <span class="n">mixed_properties</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_scaling_factors</span><span class="p">(</span>
</span><span id="L-1072"><a href="#-1072"><span class="linenos">1072</span></a>            <span class="n">mixed_properties</span><span class="p">,</span> <span class="n">net_to_gross</span><span class="p">,</span> <span class="n">lith</span>
</span><span id="L-1073"><a href="#-1073"><span class="linenos">1073</span></a>        <span class="p">)</span>
</span><span id="L-1074"><a href="#-1074"><span class="linenos">1074</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">rho</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">mixed_properties</span><span class="o">.</span><span class="n">rho</span>
</span><span id="L-1075"><a href="#-1075"><span class="linenos">1075</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vp</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">mixed_properties</span><span class="o">.</span><span class="n">vp</span>
</span><span id="L-1076"><a href="#-1076"><span class="linenos">1076</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vs</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">mixed_properties</span><span class="o">.</span><span class="n">vs</span>
</span><span id="L-1077"><a href="#-1077"><span class="linenos">1077</span></a>
</span><span id="L-1078"><a href="#-1078"><span class="linenos">1078</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">rho_ff</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">mixed_properties</span><span class="o">.</span><span class="n">rho_ff</span>
</span><span id="L-1079"><a href="#-1079"><span class="linenos">1079</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vp_ff</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">mixed_properties</span><span class="o">.</span><span class="n">vp_ff</span>
</span><span id="L-1080"><a href="#-1080"><span class="linenos">1080</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vs_ff</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">mixed_properties</span><span class="o">.</span><span class="n">vs_ff</span>
</span><span id="L-1081"><a href="#-1081"><span class="linenos">1081</span></a>
</span><span id="L-1082"><a href="#-1082"><span class="linenos">1082</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">qc_plots</span><span class="p">:</span>
</span><span id="L-1083"><a href="#-1083"><span class="linenos">1083</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Creating RPM qc plots&quot;</span><span class="p">)</span>
</span><span id="L-1084"><a href="#-1084"><span class="linenos">1084</span></a>            <span class="kn">from</span> <span class="nn">rockphysics.RockPropertyModels</span> <span class="kn">import</span> <span class="n">rpm_qc_plots</span>
</span><span id="L-1085"><a href="#-1085"><span class="linenos">1085</span></a>
</span><span id="L-1086"><a href="#-1086"><span class="linenos">1086</span></a>            <span class="n">rpm_qc_plots</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="p">,</span> <span class="n">rpm</span><span class="p">)</span>
</span><span id="L-1087"><a href="#-1087"><span class="linenos">1087</span></a>
</span><span id="L-1088"><a href="#-1088"><span class="linenos">1088</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">model_qc_volumes</span><span class="p">:</span>
</span><span id="L-1089"><a href="#-1089"><span class="linenos">1089</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">write_property_volumes_to_disk</span><span class="p">()</span>
</span><span id="L-1090"><a href="#-1090"><span class="linenos">1090</span></a>
</span><span id="L-1091"><a href="#-1091"><span class="linenos">1091</span></a>    <span class="k">def</span> <span class="nf">water_properties</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lith</span><span class="p">,</span> <span class="n">properties</span><span class="p">):</span>
</span><span id="L-1092"><a href="#-1092"><span class="linenos">1092</span></a>        <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">lith</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">)</span>
</span><span id="L-1093"><a href="#-1093"><span class="linenos">1093</span></a>        <span class="n">properties</span><span class="o">.</span><span class="n">rho</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.028</span>
</span><span id="L-1094"><a href="#-1094"><span class="linenos">1094</span></a>        <span class="n">properties</span><span class="o">.</span><span class="n">vp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1500.0</span>
</span><span id="L-1095"><a href="#-1095"><span class="linenos">1095</span></a>        <span class="n">properties</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1000.0</span>
</span><span id="L-1096"><a href="#-1096"><span class="linenos">1096</span></a>        <span class="k">return</span> <span class="n">properties</span>
</span><span id="L-1097"><a href="#-1097"><span class="linenos">1097</span></a>
</span><span id="L-1098"><a href="#-1098"><span class="linenos">1098</span></a>    <span class="k">def</span> <span class="nf">get_delta_z_layer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">half_range</span><span class="p">,</span> <span class="n">z_cells</span><span class="p">):</span>
</span><span id="L-1099"><a href="#-1099"><span class="linenos">1099</span></a>        <span class="k">if</span> <span class="n">z</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_random_lyr</span><span class="p">:</span>
</span><span id="L-1100"><a href="#-1100"><span class="linenos">1100</span></a>            <span class="n">delta_z_layer</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="n">half_range</span><span class="p">,</span> <span class="n">half_range</span><span class="p">))</span>
</span><span id="L-1101"><a href="#-1101"><span class="linenos">1101</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1102"><a href="#-1102"><span class="linenos">1102</span></a>            <span class="n">delta_z_layer</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-1103"><a href="#-1103"><span class="linenos">1103</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="L-1104"><a href="#-1104"><span class="linenos">1104</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; .... Layer </span><span class="si">{</span><span class="n">z</span><span class="si">}</span><span class="s2">: voxel_count = </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">z_cells</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1105"><a href="#-1105"><span class="linenos">1105</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; .... Layer </span><span class="si">{</span><span class="n">z</span><span class="si">}</span><span class="s2">: delta_z_layer = </span><span class="si">{</span><span class="n">delta_z_layer</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1106"><a href="#-1106"><span class="linenos">1106</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="L-1107"><a href="#-1107"><span class="linenos">1107</span></a>                <span class="sa">f</span><span class="s2">&quot; .... Layer </span><span class="si">{</span><span class="n">z</span><span class="si">}</span><span class="s2">: z-range (m): </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">z_cells</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">digi</span><span class="si">}</span><span class="s2">, &quot;</span>
</span><span id="L-1108"><a href="#-1108"><span class="linenos">1108</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">z_cells</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">digi</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-1109"><a href="#-1109"><span class="linenos">1109</span></a>            <span class="p">)</span>
</span><span id="L-1110"><a href="#-1110"><span class="linenos">1110</span></a>        <span class="k">return</span> <span class="n">delta_z_layer</span>
</span><span id="L-1111"><a href="#-1111"><span class="linenos">1111</span></a>
</span><span id="L-1112"><a href="#-1112"><span class="linenos">1112</span></a>    <span class="k">def</span> <span class="nf">get_delta_z_properties</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">half_range</span><span class="p">):</span>
</span><span id="L-1113"><a href="#-1113"><span class="linenos">1113</span></a>        <span class="k">if</span> <span class="n">z</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_random_lyr</span><span class="p">:</span>
</span><span id="L-1114"><a href="#-1114"><span class="linenos">1114</span></a>            <span class="n">delta_z_rho</span><span class="p">,</span> <span class="n">delta_z_vp</span><span class="p">,</span> <span class="n">delta_z_vs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">random_z_rho_vp_vs</span><span class="p">(</span>
</span><span id="L-1115"><a href="#-1115"><span class="linenos">1115</span></a>                <span class="n">dmin</span><span class="o">=-</span><span class="n">half_range</span><span class="p">,</span> <span class="n">dmax</span><span class="o">=</span><span class="n">half_range</span>
</span><span id="L-1116"><a href="#-1116"><span class="linenos">1116</span></a>            <span class="p">)</span>
</span><span id="L-1117"><a href="#-1117"><span class="linenos">1117</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1118"><a href="#-1118"><span class="linenos">1118</span></a>            <span class="n">delta_z_rho</span><span class="p">,</span> <span class="n">delta_z_vp</span><span class="p">,</span> <span class="n">delta_z_vs</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="L-1119"><a href="#-1119"><span class="linenos">1119</span></a>        <span class="k">return</span> <span class="n">delta_z_rho</span><span class="p">,</span> <span class="n">delta_z_vp</span><span class="p">,</span> <span class="n">delta_z_vs</span>
</span><span id="L-1120"><a href="#-1120"><span class="linenos">1120</span></a>
</span><span id="L-1121"><a href="#-1121"><span class="linenos">1121</span></a>    <span class="k">def</span> <span class="nf">calculate_shales</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xyz</span><span class="p">,</span> <span class="n">shifts</span><span class="p">,</span> <span class="n">props</span><span class="p">,</span> <span class="n">rpm</span><span class="p">,</span> <span class="n">depth</span><span class="p">,</span> <span class="n">z</span><span class="p">):</span>
</span><span id="L-1122"><a href="#-1122"><span class="linenos">1122</span></a>        <span class="c1"># Shales required for all voxels, other than water</span>
</span><span id="L-1123"><a href="#-1123"><span class="linenos">1123</span></a>        <span class="c1"># Calculate the properties, select how to mix with other facies later</span>
</span><span id="L-1124"><a href="#-1124"><span class="linenos">1124</span></a>        <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">xyz</span>
</span><span id="L-1125"><a href="#-1125"><span class="linenos">1125</span></a>        <span class="n">k_rho</span><span class="p">,</span> <span class="n">k_vp</span><span class="p">,</span> <span class="n">k_vs</span> <span class="o">=</span> <span class="n">shifts</span>
</span><span id="L-1126"><a href="#-1126"><span class="linenos">1126</span></a>
</span><span id="L-1127"><a href="#-1127"><span class="linenos">1127</span></a>        <span class="n">z_rho</span> <span class="o">=</span> <span class="n">depth</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k_rho</span><span class="p">]</span>
</span><span id="L-1128"><a href="#-1128"><span class="linenos">1128</span></a>        <span class="n">z_vp</span> <span class="o">=</span> <span class="n">depth</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k_vp</span><span class="p">]</span>
</span><span id="L-1129"><a href="#-1129"><span class="linenos">1129</span></a>        <span class="n">z_vs</span> <span class="o">=</span> <span class="n">depth</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k_vs</span><span class="p">]</span>
</span><span id="L-1130"><a href="#-1130"><span class="linenos">1130</span></a>        <span class="n">shales</span> <span class="o">=</span> <span class="n">rpm</span><span class="o">.</span><span class="n">calc_shale_properties</span><span class="p">(</span><span class="n">z_rho</span><span class="p">,</span> <span class="n">z_vp</span><span class="p">,</span> <span class="n">z_vs</span><span class="p">)</span>
</span><span id="L-1131"><a href="#-1131"><span class="linenos">1131</span></a>
</span><span id="L-1132"><a href="#-1132"><span class="linenos">1132</span></a>        <span class="c1"># Do not use net to gross here.</span>
</span><span id="L-1133"><a href="#-1133"><span class="linenos">1133</span></a>        <span class="c1"># Since every voxel will have some shale in, apply the net to gross</span>
</span><span id="L-1134"><a href="#-1134"><span class="linenos">1134</span></a>        <span class="c1"># when combining shales and sands</span>
</span><span id="L-1135"><a href="#-1135"><span class="linenos">1135</span></a>        <span class="c1"># _ng = (1.0 - ng[i, j, k])</span>
</span><span id="L-1136"><a href="#-1136"><span class="linenos">1136</span></a>
</span><span id="L-1137"><a href="#-1137"><span class="linenos">1137</span></a>        <span class="n">props</span><span class="o">.</span><span class="n">rho</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">shales</span><span class="o">.</span><span class="n">rho</span>  <span class="c1"># * _ng</span>
</span><span id="L-1138"><a href="#-1138"><span class="linenos">1138</span></a>        <span class="n">props</span><span class="o">.</span><span class="n">rho_ff</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">shales</span><span class="o">.</span><span class="n">rho</span>  <span class="c1"># * _ng</span>
</span><span id="L-1139"><a href="#-1139"><span class="linenos">1139</span></a>        <span class="n">props</span><span class="o">.</span><span class="n">vp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">shales</span><span class="o">.</span><span class="n">vp</span>  <span class="c1"># * _ng</span>
</span><span id="L-1140"><a href="#-1140"><span class="linenos">1140</span></a>        <span class="n">props</span><span class="o">.</span><span class="n">vp_ff</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">shales</span><span class="o">.</span><span class="n">vp</span>  <span class="c1"># * _ng</span>
</span><span id="L-1141"><a href="#-1141"><span class="linenos">1141</span></a>        <span class="n">props</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">shales</span><span class="o">.</span><span class="n">vs</span>  <span class="c1"># * _ng</span>
</span><span id="L-1142"><a href="#-1142"><span class="linenos">1142</span></a>        <span class="n">props</span><span class="o">.</span><span class="n">vs_ff</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">shales</span><span class="o">.</span><span class="n">vs</span>  <span class="c1"># * _ng</span>
</span><span id="L-1143"><a href="#-1143"><span class="linenos">1143</span></a>        <span class="c1"># props.sum_net[i, j, k] = _ng</span>
</span><span id="L-1144"><a href="#-1144"><span class="linenos">1144</span></a>
</span><span id="L-1145"><a href="#-1145"><span class="linenos">1145</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span> <span class="ow">and</span> <span class="n">z</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_random_lyr</span><span class="p">:</span>
</span><span id="L-1146"><a href="#-1146"><span class="linenos">1146</span></a>            <span class="c1"># Calculate non-randomised properties and differences</span>
</span><span id="L-1147"><a href="#-1147"><span class="linenos">1147</span></a>            <span class="n">_z0</span> <span class="o">=</span> <span class="n">depth</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span>
</span><span id="L-1148"><a href="#-1148"><span class="linenos">1148</span></a>            <span class="n">_shales0</span> <span class="o">=</span> <span class="n">rpm</span><span class="o">.</span><span class="n">calc_shale_properties</span><span class="p">(</span><span class="n">_z0</span><span class="p">,</span> <span class="n">_z0</span><span class="p">,</span> <span class="n">_z0</span><span class="p">)</span>
</span><span id="L-1149"><a href="#-1149"><span class="linenos">1149</span></a>            <span class="n">props</span><span class="o">.</span><span class="n">rho_not_random</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">_shales0</span><span class="o">.</span><span class="n">rho</span>  <span class="c1"># * _ng</span>
</span><span id="L-1150"><a href="#-1150"><span class="linenos">1150</span></a>            <span class="n">props</span><span class="o">.</span><span class="n">vp_not_random</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">_shales0</span><span class="o">.</span><span class="n">vp</span>  <span class="c1"># * _ng</span>
</span><span id="L-1151"><a href="#-1151"><span class="linenos">1151</span></a>            <span class="n">props</span><span class="o">.</span><span class="n">vs_not_random</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">_shales0</span><span class="o">.</span><span class="n">vs</span>  <span class="c1"># * _ng</span>
</span><span id="L-1152"><a href="#-1152"><span class="linenos">1152</span></a>
</span><span id="L-1153"><a href="#-1153"><span class="linenos">1153</span></a>            <span class="n">delta_rho</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="p">(</span><span class="n">props</span><span class="o">.</span><span class="n">rho</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">/</span> <span class="n">props</span><span class="o">.</span><span class="n">rho_not_random</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">])</span>
</span><span id="L-1154"><a href="#-1154"><span class="linenos">1154</span></a>            <span class="n">delta_vp</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="p">(</span><span class="n">props</span><span class="o">.</span><span class="n">vp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">/</span> <span class="n">props</span><span class="o">.</span><span class="n">vp_not_random</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">])</span>
</span><span id="L-1155"><a href="#-1155"><span class="linenos">1155</span></a>            <span class="n">delta_vs</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="p">(</span><span class="n">props</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">/</span> <span class="n">props</span><span class="o">.</span><span class="n">vs_not_random</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">])</span>
</span><span id="L-1156"><a href="#-1156"><span class="linenos">1156</span></a>            <span class="n">pct_change_rho</span> <span class="o">=</span> <span class="n">delta_rho</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span id="L-1157"><a href="#-1157"><span class="linenos">1157</span></a>            <span class="n">pct_change_vp</span> <span class="o">=</span> <span class="n">delta_vp</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span id="L-1158"><a href="#-1158"><span class="linenos">1158</span></a>            <span class="n">pct_change_vs</span> <span class="o">=</span> <span class="n">delta_vs</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span id="L-1159"><a href="#-1159"><span class="linenos">1159</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="L-1160"><a href="#-1160"><span class="linenos">1160</span></a>                <span class="sa">f</span><span class="s2">&quot; ... shale: randomization percent change (rho,vp,vs) = &quot;</span>
</span><span id="L-1161"><a href="#-1161"><span class="linenos">1161</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">pct_change_rho</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">pct_change_vp</span> <span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">pct_change_vs</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-1162"><a href="#-1162"><span class="linenos">1162</span></a>            <span class="p">)</span>
</span><span id="L-1163"><a href="#-1163"><span class="linenos">1163</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="L-1164"><a href="#-1164"><span class="linenos">1164</span></a>                <span class="sa">f</span><span class="s2">&quot; ... shale: min/max pre-randomization (rho, vp, vs)  = &quot;</span>
</span><span id="L-1165"><a href="#-1165"><span class="linenos">1165</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">props</span><span class="o">.</span><span class="n">rho_not_random</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">])</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2"> - &quot;</span>
</span><span id="L-1166"><a href="#-1166"><span class="linenos">1166</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">props</span><span class="o">.</span><span class="n">rho_not_random</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">])</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">, &quot;</span>
</span><span id="L-1167"><a href="#-1167"><span class="linenos">1167</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">props</span><span class="o">.</span><span class="n">vp_not_random</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">])</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> - &quot;</span>
</span><span id="L-1168"><a href="#-1168"><span class="linenos">1168</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">props</span><span class="o">.</span><span class="n">vp_not_random</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">])</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, &quot;</span>
</span><span id="L-1169"><a href="#-1169"><span class="linenos">1169</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">props</span><span class="o">.</span><span class="n">vs_not_random</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">])</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> - &quot;</span>
</span><span id="L-1170"><a href="#-1170"><span class="linenos">1170</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">props</span><span class="o">.</span><span class="n">vs_not_random</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">])</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-1171"><a href="#-1171"><span class="linenos">1171</span></a>            <span class="p">)</span>
</span><span id="L-1172"><a href="#-1172"><span class="linenos">1172</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="L-1173"><a href="#-1173"><span class="linenos">1173</span></a>                <span class="sa">f</span><span class="s2">&quot; ... shale: min/max post-randomization (rho, vp, vs) = &quot;</span>
</span><span id="L-1174"><a href="#-1174"><span class="linenos">1174</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">props</span><span class="o">.</span><span class="n">rho</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">])</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2"> - &quot;</span>
</span><span id="L-1175"><a href="#-1175"><span class="linenos">1175</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">props</span><span class="o">.</span><span class="n">rho</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">])</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">, &quot;</span>
</span><span id="L-1176"><a href="#-1176"><span class="linenos">1176</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">props</span><span class="o">.</span><span class="n">vp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">])</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> - &quot;</span>
</span><span id="L-1177"><a href="#-1177"><span class="linenos">1177</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">props</span><span class="o">.</span><span class="n">vp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">])</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, &quot;</span>
</span><span id="L-1178"><a href="#-1178"><span class="linenos">1178</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">props</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">])</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> - &quot;</span>
</span><span id="L-1179"><a href="#-1179"><span class="linenos">1179</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">props</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">])</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-1180"><a href="#-1180"><span class="linenos">1180</span></a>            <span class="p">)</span>
</span><span id="L-1181"><a href="#-1181"><span class="linenos">1181</span></a>
</span><span id="L-1182"><a href="#-1182"><span class="linenos">1182</span></a>        <span class="k">return</span> <span class="n">props</span>
</span><span id="L-1183"><a href="#-1183"><span class="linenos">1183</span></a>
</span><span id="L-1184"><a href="#-1184"><span class="linenos">1184</span></a>    <span class="k">def</span> <span class="nf">calculate_sands</span><span class="p">(</span>
</span><span id="L-1185"><a href="#-1185"><span class="linenos">1185</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">xyz</span><span class="p">,</span> <span class="n">shifts</span><span class="p">,</span> <span class="n">props</span><span class="p">,</span> <span class="n">rpm</span><span class="p">,</span> <span class="n">depth</span><span class="p">,</span> <span class="n">ng</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">fluid</span><span class="p">,</span> <span class="n">mix</span><span class="o">=</span><span class="s2">&quot;inv_vel&quot;</span>
</span><span id="L-1186"><a href="#-1186"><span class="linenos">1186</span></a>    <span class="p">):</span>
</span><span id="L-1187"><a href="#-1187"><span class="linenos">1187</span></a>        <span class="c1"># brine sand or mixture of brine sand and shale in same voxel</span>
</span><span id="L-1188"><a href="#-1188"><span class="linenos">1188</span></a>        <span class="c1"># - perform velocity sums in slowness or via backus moduli mixing</span>
</span><span id="L-1189"><a href="#-1189"><span class="linenos">1189</span></a>        <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">xyz</span>
</span><span id="L-1190"><a href="#-1190"><span class="linenos">1190</span></a>        <span class="n">k_rho</span><span class="p">,</span> <span class="n">k_vp</span><span class="p">,</span> <span class="n">k_vs</span> <span class="o">=</span> <span class="n">shifts</span>
</span><span id="L-1191"><a href="#-1191"><span class="linenos">1191</span></a>
</span><span id="L-1192"><a href="#-1192"><span class="linenos">1192</span></a>        <span class="n">z_rho</span> <span class="o">=</span> <span class="n">depth</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k_rho</span><span class="p">]</span>
</span><span id="L-1193"><a href="#-1193"><span class="linenos">1193</span></a>        <span class="n">z_vp</span> <span class="o">=</span> <span class="n">depth</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k_vp</span><span class="p">]</span>
</span><span id="L-1194"><a href="#-1194"><span class="linenos">1194</span></a>        <span class="n">z_vs</span> <span class="o">=</span> <span class="n">depth</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k_vs</span><span class="p">]</span>
</span><span id="L-1195"><a href="#-1195"><span class="linenos">1195</span></a>        <span class="k">if</span> <span class="n">fluid</span> <span class="o">==</span> <span class="s2">&quot;brine&quot;</span><span class="p">:</span>
</span><span id="L-1196"><a href="#-1196"><span class="linenos">1196</span></a>            <span class="n">sands</span> <span class="o">=</span> <span class="n">rpm</span><span class="o">.</span><span class="n">calc_brine_sand_properties</span><span class="p">(</span><span class="n">z_rho</span><span class="p">,</span> <span class="n">z_vp</span><span class="p">,</span> <span class="n">z_vs</span><span class="p">)</span>
</span><span id="L-1197"><a href="#-1197"><span class="linenos">1197</span></a>        <span class="k">elif</span> <span class="n">fluid</span> <span class="o">==</span> <span class="s2">&quot;oil&quot;</span><span class="p">:</span>
</span><span id="L-1198"><a href="#-1198"><span class="linenos">1198</span></a>            <span class="n">sands</span> <span class="o">=</span> <span class="n">rpm</span><span class="o">.</span><span class="n">calc_oil_sand_properties</span><span class="p">(</span><span class="n">z_rho</span><span class="p">,</span> <span class="n">z_vp</span><span class="p">,</span> <span class="n">z_vs</span><span class="p">)</span>
</span><span id="L-1199"><a href="#-1199"><span class="linenos">1199</span></a>        <span class="k">elif</span> <span class="n">fluid</span> <span class="o">==</span> <span class="s2">&quot;gas&quot;</span><span class="p">:</span>
</span><span id="L-1200"><a href="#-1200"><span class="linenos">1200</span></a>            <span class="n">sands</span> <span class="o">=</span> <span class="n">rpm</span><span class="o">.</span><span class="n">calc_gas_sand_properties</span><span class="p">(</span><span class="n">z_rho</span><span class="p">,</span> <span class="n">z_vp</span><span class="p">,</span> <span class="n">z_vs</span><span class="p">)</span>
</span><span id="L-1201"><a href="#-1201"><span class="linenos">1201</span></a>
</span><span id="L-1202"><a href="#-1202"><span class="linenos">1202</span></a>        <span class="n">shales</span> <span class="o">=</span> <span class="n">RockProperties</span><span class="p">(</span>
</span><span id="L-1203"><a href="#-1203"><span class="linenos">1203</span></a>            <span class="n">rho</span><span class="o">=</span><span class="n">props</span><span class="o">.</span><span class="n">rho</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">],</span> <span class="n">vp</span><span class="o">=</span><span class="n">props</span><span class="o">.</span><span class="n">vp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">],</span> <span class="n">vs</span><span class="o">=</span><span class="n">props</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span>
</span><span id="L-1204"><a href="#-1204"><span class="linenos">1204</span></a>        <span class="p">)</span>
</span><span id="L-1205"><a href="#-1205"><span class="linenos">1205</span></a>        <span class="n">rpmix</span> <span class="o">=</span> <span class="n">EndMemberMixing</span><span class="p">(</span><span class="n">shales</span><span class="p">,</span> <span class="n">sands</span><span class="p">,</span> <span class="n">ng</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">])</span>
</span><span id="L-1206"><a href="#-1206"><span class="linenos">1206</span></a>
</span><span id="L-1207"><a href="#-1207"><span class="linenos">1207</span></a>        <span class="k">if</span> <span class="n">mix</span> <span class="o">==</span> <span class="s2">&quot;inv_vel&quot;</span><span class="p">:</span>
</span><span id="L-1208"><a href="#-1208"><span class="linenos">1208</span></a>            <span class="n">rpmix</span><span class="o">.</span><span class="n">inverse_velocity_mixing</span><span class="p">()</span>
</span><span id="L-1209"><a href="#-1209"><span class="linenos">1209</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1210"><a href="#-1210"><span class="linenos">1210</span></a>            <span class="n">rpmix</span><span class="o">.</span><span class="n">backus_moduli_mixing</span><span class="p">()</span>
</span><span id="L-1211"><a href="#-1211"><span class="linenos">1211</span></a>
</span><span id="L-1212"><a href="#-1212"><span class="linenos">1212</span></a>        <span class="n">props</span><span class="o">.</span><span class="n">sum_net</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">+=</span> <span class="n">ng</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span>
</span><span id="L-1213"><a href="#-1213"><span class="linenos">1213</span></a>        <span class="n">props</span><span class="o">.</span><span class="n">rho</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">rpmix</span><span class="o">.</span><span class="n">rho</span>
</span><span id="L-1214"><a href="#-1214"><span class="linenos">1214</span></a>        <span class="n">props</span><span class="o">.</span><span class="n">vp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">rpmix</span><span class="o">.</span><span class="n">vp</span>
</span><span id="L-1215"><a href="#-1215"><span class="linenos">1215</span></a>        <span class="n">props</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">rpmix</span><span class="o">.</span><span class="n">vs</span>
</span><span id="L-1216"><a href="#-1216"><span class="linenos">1216</span></a>
</span><span id="L-1217"><a href="#-1217"><span class="linenos">1217</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span> <span class="ow">and</span> <span class="n">z</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_random_lyr</span><span class="p">:</span>
</span><span id="L-1218"><a href="#-1218"><span class="linenos">1218</span></a>            <span class="c1"># Calculate non-randomised properties and differences</span>
</span><span id="L-1219"><a href="#-1219"><span class="linenos">1219</span></a>            <span class="n">_z0</span> <span class="o">=</span> <span class="n">depth</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span>
</span><span id="L-1220"><a href="#-1220"><span class="linenos">1220</span></a>            <span class="k">if</span> <span class="n">fluid</span> <span class="o">==</span> <span class="s2">&quot;brine&quot;</span><span class="p">:</span>
</span><span id="L-1221"><a href="#-1221"><span class="linenos">1221</span></a>                <span class="n">_sands0</span> <span class="o">=</span> <span class="n">rpm</span><span class="o">.</span><span class="n">calc_brine_sand_properties</span><span class="p">(</span><span class="n">_z0</span><span class="p">,</span> <span class="n">_z0</span><span class="p">,</span> <span class="n">_z0</span><span class="p">)</span>
</span><span id="L-1222"><a href="#-1222"><span class="linenos">1222</span></a>            <span class="k">elif</span> <span class="n">fluid</span> <span class="o">==</span> <span class="s2">&quot;oil&quot;</span><span class="p">:</span>
</span><span id="L-1223"><a href="#-1223"><span class="linenos">1223</span></a>                <span class="n">_sands0</span> <span class="o">=</span> <span class="n">rpm</span><span class="o">.</span><span class="n">calc_oil_sand_properties</span><span class="p">(</span><span class="n">_z0</span><span class="p">,</span> <span class="n">_z0</span><span class="p">,</span> <span class="n">_z0</span><span class="p">)</span>
</span><span id="L-1224"><a href="#-1224"><span class="linenos">1224</span></a>            <span class="k">elif</span> <span class="n">fluid</span> <span class="o">==</span> <span class="s2">&quot;gas&quot;</span><span class="p">:</span>
</span><span id="L-1225"><a href="#-1225"><span class="linenos">1225</span></a>                <span class="n">_sands0</span> <span class="o">=</span> <span class="n">rpm</span><span class="o">.</span><span class="n">calc_gas_sand_properties</span><span class="p">(</span><span class="n">_z0</span><span class="p">,</span> <span class="n">_z0</span><span class="p">,</span> <span class="n">_z0</span><span class="p">)</span>
</span><span id="L-1226"><a href="#-1226"><span class="linenos">1226</span></a>
</span><span id="L-1227"><a href="#-1227"><span class="linenos">1227</span></a>            <span class="n">rpmix_0</span> <span class="o">=</span> <span class="n">EndMemberMixing</span><span class="p">(</span><span class="n">shales</span><span class="p">,</span> <span class="n">_sands0</span><span class="p">,</span> <span class="n">ng</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">])</span>
</span><span id="L-1228"><a href="#-1228"><span class="linenos">1228</span></a>            <span class="k">if</span> <span class="n">mix</span> <span class="o">==</span> <span class="s2">&quot;inv_vel&quot;</span><span class="p">:</span>
</span><span id="L-1229"><a href="#-1229"><span class="linenos">1229</span></a>                <span class="c1"># Apply Inverse Velocity mixing</span>
</span><span id="L-1230"><a href="#-1230"><span class="linenos">1230</span></a>                <span class="n">rpmix_0</span><span class="o">.</span><span class="n">inverse_velocity_mixing</span><span class="p">()</span>
</span><span id="L-1231"><a href="#-1231"><span class="linenos">1231</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-1232"><a href="#-1232"><span class="linenos">1232</span></a>                <span class="c1"># Apply Backus Moduli mixing</span>
</span><span id="L-1233"><a href="#-1233"><span class="linenos">1233</span></a>                <span class="n">rpmix_0</span><span class="o">.</span><span class="n">backus_moduli_mixing</span><span class="p">()</span>
</span><span id="L-1234"><a href="#-1234"><span class="linenos">1234</span></a>            <span class="n">props</span><span class="o">.</span><span class="n">rho_not_random</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">rpmix_0</span><span class="o">.</span><span class="n">rho</span>
</span><span id="L-1235"><a href="#-1235"><span class="linenos">1235</span></a>            <span class="n">props</span><span class="o">.</span><span class="n">vp_not_random</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">rpmix_0</span><span class="o">.</span><span class="n">vp</span>
</span><span id="L-1236"><a href="#-1236"><span class="linenos">1236</span></a>            <span class="n">props</span><span class="o">.</span><span class="n">vs_not_random</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">rpmix_0</span><span class="o">.</span><span class="n">vs</span>
</span><span id="L-1237"><a href="#-1237"><span class="linenos">1237</span></a>
</span><span id="L-1238"><a href="#-1238"><span class="linenos">1238</span></a>            <span class="n">delta_rho</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="p">(</span><span class="n">props</span><span class="o">.</span><span class="n">rho</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">/</span> <span class="n">props</span><span class="o">.</span><span class="n">rho_not_random</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">])</span>
</span><span id="L-1239"><a href="#-1239"><span class="linenos">1239</span></a>            <span class="n">delta_vp</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="p">(</span><span class="n">props</span><span class="o">.</span><span class="n">vp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">/</span> <span class="n">props</span><span class="o">.</span><span class="n">vp_not_random</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">])</span>
</span><span id="L-1240"><a href="#-1240"><span class="linenos">1240</span></a>            <span class="n">delta_vs</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="p">(</span><span class="n">props</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">/</span> <span class="n">props</span><span class="o">.</span><span class="n">vs_not_random</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">])</span>
</span><span id="L-1241"><a href="#-1241"><span class="linenos">1241</span></a>            <span class="n">pct_change_rho</span> <span class="o">=</span> <span class="n">delta_rho</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span id="L-1242"><a href="#-1242"><span class="linenos">1242</span></a>            <span class="n">pct_change_vp</span> <span class="o">=</span> <span class="n">delta_vp</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span id="L-1243"><a href="#-1243"><span class="linenos">1243</span></a>            <span class="n">pct_change_vs</span> <span class="o">=</span> <span class="n">delta_vs</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span id="L-1244"><a href="#-1244"><span class="linenos">1244</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="L-1245"><a href="#-1245"><span class="linenos">1245</span></a>                <span class="sa">f</span><span class="s2">&quot; ... </span><span class="si">{</span><span class="n">fluid</span><span class="si">}</span><span class="s2">: randomization percent change (rho,vp,vs) = &quot;</span>
</span><span id="L-1246"><a href="#-1246"><span class="linenos">1246</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">pct_change_rho</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">pct_change_vp</span> <span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">pct_change_vs</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-1247"><a href="#-1247"><span class="linenos">1247</span></a>            <span class="p">)</span>
</span><span id="L-1248"><a href="#-1248"><span class="linenos">1248</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="L-1249"><a href="#-1249"><span class="linenos">1249</span></a>                <span class="sa">f</span><span class="s2">&quot; ... </span><span class="si">{</span><span class="n">fluid</span><span class="si">}</span><span class="s2">: min/max pre-randomization (rho, vp, vs)  = &quot;</span>
</span><span id="L-1250"><a href="#-1250"><span class="linenos">1250</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">props</span><span class="o">.</span><span class="n">rho_not_random</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">])</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2"> - &quot;</span>
</span><span id="L-1251"><a href="#-1251"><span class="linenos">1251</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">props</span><span class="o">.</span><span class="n">rho_not_random</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">])</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">, &quot;</span>
</span><span id="L-1252"><a href="#-1252"><span class="linenos">1252</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">props</span><span class="o">.</span><span class="n">vp_not_random</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">])</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> - &quot;</span>
</span><span id="L-1253"><a href="#-1253"><span class="linenos">1253</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">props</span><span class="o">.</span><span class="n">vp_not_random</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">])</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, &quot;</span>
</span><span id="L-1254"><a href="#-1254"><span class="linenos">1254</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">props</span><span class="o">.</span><span class="n">vs_not_random</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">])</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> - &quot;</span>
</span><span id="L-1255"><a href="#-1255"><span class="linenos">1255</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">props</span><span class="o">.</span><span class="n">vs_not_random</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">])</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-1256"><a href="#-1256"><span class="linenos">1256</span></a>            <span class="p">)</span>
</span><span id="L-1257"><a href="#-1257"><span class="linenos">1257</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="L-1258"><a href="#-1258"><span class="linenos">1258</span></a>                <span class="sa">f</span><span class="s2">&quot; ... </span><span class="si">{</span><span class="n">fluid</span><span class="si">}</span><span class="s2">: min/max post-randomization (rho, vp, vs) = &quot;</span>
</span><span id="L-1259"><a href="#-1259"><span class="linenos">1259</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">props</span><span class="o">.</span><span class="n">rho</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">])</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2"> - &quot;</span>
</span><span id="L-1260"><a href="#-1260"><span class="linenos">1260</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">props</span><span class="o">.</span><span class="n">rho</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">])</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">, &quot;</span>
</span><span id="L-1261"><a href="#-1261"><span class="linenos">1261</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">props</span><span class="o">.</span><span class="n">vp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">])</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> - &quot;</span>
</span><span id="L-1262"><a href="#-1262"><span class="linenos">1262</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">props</span><span class="o">.</span><span class="n">vp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">])</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, &quot;</span>
</span><span id="L-1263"><a href="#-1263"><span class="linenos">1263</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">props</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">])</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> - &quot;</span>
</span><span id="L-1264"><a href="#-1264"><span class="linenos">1264</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">props</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">])</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-1265"><a href="#-1265"><span class="linenos">1265</span></a>            <span class="p">)</span>
</span><span id="L-1266"><a href="#-1266"><span class="linenos">1266</span></a>
</span><span id="L-1267"><a href="#-1267"><span class="linenos">1267</span></a>        <span class="k">return</span> <span class="n">props</span>
</span><span id="L-1268"><a href="#-1268"><span class="linenos">1268</span></a>
</span><span id="L-1269"><a href="#-1269"><span class="linenos">1269</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-1270"><a href="#-1270"><span class="linenos">1270</span></a>    <span class="k">def</span> <span class="nf">fix_zero_values_at_base</span><span class="p">(</span><span class="n">props</span><span class="p">):</span>
</span><span id="L-1271"><a href="#-1271"><span class="linenos">1271</span></a>        <span class="sd">&quot;&quot;&quot;Check for zero values at base of property volumes and replace with</span>
</span><span id="L-1272"><a href="#-1272"><span class="linenos">1272</span></a><span class="sd">        shallower values if present</span>
</span><span id="L-1273"><a href="#-1273"><span class="linenos">1273</span></a>
</span><span id="L-1274"><a href="#-1274"><span class="linenos">1274</span></a><span class="sd">        Args:</span>
</span><span id="L-1275"><a href="#-1275"><span class="linenos">1275</span></a><span class="sd">            a ([type]): [description]</span>
</span><span id="L-1276"><a href="#-1276"><span class="linenos">1276</span></a><span class="sd">            b ([type]): [description]</span>
</span><span id="L-1277"><a href="#-1277"><span class="linenos">1277</span></a><span class="sd">            c ([type]): [description]</span>
</span><span id="L-1278"><a href="#-1278"><span class="linenos">1278</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1279"><a href="#-1279"><span class="linenos">1279</span></a>        <span class="k">for</span> <span class="n">vol</span> <span class="ow">in</span> <span class="p">[</span>
</span><span id="L-1280"><a href="#-1280"><span class="linenos">1280</span></a>            <span class="n">props</span><span class="o">.</span><span class="n">rho</span><span class="p">,</span>
</span><span id="L-1281"><a href="#-1281"><span class="linenos">1281</span></a>            <span class="n">props</span><span class="o">.</span><span class="n">vp</span><span class="p">,</span>
</span><span id="L-1282"><a href="#-1282"><span class="linenos">1282</span></a>            <span class="n">props</span><span class="o">.</span><span class="n">vs</span><span class="p">,</span>
</span><span id="L-1283"><a href="#-1283"><span class="linenos">1283</span></a>            <span class="n">props</span><span class="o">.</span><span class="n">rho_ff</span><span class="p">,</span>
</span><span id="L-1284"><a href="#-1284"><span class="linenos">1284</span></a>            <span class="n">props</span><span class="o">.</span><span class="n">vp_ff</span><span class="p">,</span>
</span><span id="L-1285"><a href="#-1285"><span class="linenos">1285</span></a>            <span class="n">props</span><span class="o">.</span><span class="n">vs_ff</span><span class="p">,</span>
</span><span id="L-1286"><a href="#-1286"><span class="linenos">1286</span></a>        <span class="p">]:</span>
</span><span id="L-1287"><a href="#-1287"><span class="linenos">1287</span></a>            <span class="k">for</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="n">vol</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">):</span>
</span><span id="L-1288"><a href="#-1288"><span class="linenos">1288</span></a>                <span class="n">vol</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">]</span> <span class="o">=</span> <span class="n">vol</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="L-1289"><a href="#-1289"><span class="linenos">1289</span></a>        <span class="k">return</span> <span class="n">props</span>
</span><span id="L-1290"><a href="#-1290"><span class="linenos">1290</span></a>
</span><span id="L-1291"><a href="#-1291"><span class="linenos">1291</span></a>    <span class="k">def</span> <span class="nf">apply_scaling_factors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">props</span><span class="p">,</span> <span class="n">ng</span><span class="p">,</span> <span class="n">lith</span><span class="p">):</span>
</span><span id="L-1292"><a href="#-1292"><span class="linenos">1292</span></a>        <span class="sd">&quot;&quot;&quot;Apply final random scaling factors to sands and shales&quot;&quot;&quot;</span>
</span><span id="L-1293"><a href="#-1293"><span class="linenos">1293</span></a>        <span class="n">rho_factor_shale</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">rpm_scaling_factors</span><span class="p">[</span><span class="s2">&quot;shalerho_factor&quot;</span><span class="p">]</span>
</span><span id="L-1294"><a href="#-1294"><span class="linenos">1294</span></a>        <span class="n">vp_factor_shale</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">rpm_scaling_factors</span><span class="p">[</span><span class="s2">&quot;shalevp_factor&quot;</span><span class="p">]</span>
</span><span id="L-1295"><a href="#-1295"><span class="linenos">1295</span></a>        <span class="n">vs_factor_shale</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">rpm_scaling_factors</span><span class="p">[</span><span class="s2">&quot;shalevs_factor&quot;</span><span class="p">]</span>
</span><span id="L-1296"><a href="#-1296"><span class="linenos">1296</span></a>        <span class="n">rho_factor_sand</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">rpm_scaling_factors</span><span class="p">[</span><span class="s2">&quot;sandrho_factor&quot;</span><span class="p">]</span>
</span><span id="L-1297"><a href="#-1297"><span class="linenos">1297</span></a>        <span class="n">vp_factor_sand</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">rpm_scaling_factors</span><span class="p">[</span><span class="s2">&quot;sandvp_factor&quot;</span><span class="p">]</span>
</span><span id="L-1298"><a href="#-1298"><span class="linenos">1298</span></a>        <span class="n">vs_factor_sand</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">rpm_scaling_factors</span><span class="p">[</span><span class="s2">&quot;sandvs_factor&quot;</span><span class="p">]</span>
</span><span id="L-1299"><a href="#-1299"><span class="linenos">1299</span></a>
</span><span id="L-1300"><a href="#-1300"><span class="linenos">1300</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="L-1301"><a href="#-1301"><span class="linenos">1301</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="L-1302"><a href="#-1302"><span class="linenos">1302</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">... Additional random scaling factors: &quot;</span>
</span><span id="L-1303"><a href="#-1303"><span class="linenos">1303</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> ... Shale Rho </span><span class="si">{</span><span class="n">rho_factor_shale</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">, Vp </span><span class="si">{</span><span class="n">vp_factor_shale</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">, Vs </span><span class="si">{</span><span class="n">vs_factor_shale</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-1304"><a href="#-1304"><span class="linenos">1304</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> ... Sand Rho </span><span class="si">{</span><span class="n">rho_factor_sand</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">, Vp </span><span class="si">{</span><span class="n">vp_factor_sand</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">, Vs </span><span class="si">{</span><span class="n">vs_factor_sand</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-1305"><a href="#-1305"><span class="linenos">1305</span></a>            <span class="p">)</span>
</span><span id="L-1306"><a href="#-1306"><span class="linenos">1306</span></a>
</span><span id="L-1307"><a href="#-1307"><span class="linenos">1307</span></a>        <span class="c1"># Apply final scaling factors to shale/sand properties</span>
</span><span id="L-1308"><a href="#-1308"><span class="linenos">1308</span></a>        <span class="n">props</span><span class="o">.</span><span class="n">rho</span><span class="p">[(</span><span class="n">ng</span> <span class="o">&lt;=</span> <span class="mf">1.0e-2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lith</span> <span class="o">&lt;</span> <span class="mf">2.0</span><span class="p">)]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-1309"><a href="#-1309"><span class="linenos">1309</span></a>            <span class="n">props</span><span class="o">.</span><span class="n">rho</span><span class="p">[(</span><span class="n">ng</span> <span class="o">&lt;=</span> <span class="mf">1.0e-2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lith</span> <span class="o">&lt;</span> <span class="mf">2.0</span><span class="p">)]</span> <span class="o">*</span> <span class="n">rho_factor_shale</span>
</span><span id="L-1310"><a href="#-1310"><span class="linenos">1310</span></a>        <span class="p">)</span>
</span><span id="L-1311"><a href="#-1311"><span class="linenos">1311</span></a>        <span class="n">props</span><span class="o">.</span><span class="n">vp</span><span class="p">[(</span><span class="n">ng</span> <span class="o">&lt;=</span> <span class="mf">1.0e-2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lith</span> <span class="o">&lt;</span> <span class="mf">2.0</span><span class="p">)]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-1312"><a href="#-1312"><span class="linenos">1312</span></a>            <span class="n">props</span><span class="o">.</span><span class="n">vp</span><span class="p">[(</span><span class="n">ng</span> <span class="o">&lt;=</span> <span class="mf">1.0e-2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lith</span> <span class="o">&lt;</span> <span class="mf">2.0</span><span class="p">)]</span> <span class="o">*</span> <span class="n">vp_factor_shale</span>
</span><span id="L-1313"><a href="#-1313"><span class="linenos">1313</span></a>        <span class="p">)</span>
</span><span id="L-1314"><a href="#-1314"><span class="linenos">1314</span></a>        <span class="n">props</span><span class="o">.</span><span class="n">vs</span><span class="p">[(</span><span class="n">ng</span> <span class="o">&lt;=</span> <span class="mf">1.0e-2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lith</span> <span class="o">&lt;</span> <span class="mf">2.0</span><span class="p">)]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-1315"><a href="#-1315"><span class="linenos">1315</span></a>            <span class="n">props</span><span class="o">.</span><span class="n">vs</span><span class="p">[(</span><span class="n">ng</span> <span class="o">&lt;=</span> <span class="mf">1.0e-2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lith</span> <span class="o">&lt;</span> <span class="mf">2.0</span><span class="p">)]</span> <span class="o">*</span> <span class="n">vs_factor_shale</span>
</span><span id="L-1316"><a href="#-1316"><span class="linenos">1316</span></a>        <span class="p">)</span>
</span><span id="L-1317"><a href="#-1317"><span class="linenos">1317</span></a>        <span class="n">props</span><span class="o">.</span><span class="n">rho</span><span class="p">[(</span><span class="n">ng</span> <span class="o">&gt;</span> <span class="mf">1.0e-2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lith</span> <span class="o">&lt;</span> <span class="mf">2.0</span><span class="p">)]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-1318"><a href="#-1318"><span class="linenos">1318</span></a>            <span class="n">props</span><span class="o">.</span><span class="n">rho</span><span class="p">[(</span><span class="n">ng</span> <span class="o">&gt;</span> <span class="mf">1.0e-2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lith</span> <span class="o">&lt;</span> <span class="mf">2.0</span><span class="p">)]</span> <span class="o">*</span> <span class="n">rho_factor_sand</span>
</span><span id="L-1319"><a href="#-1319"><span class="linenos">1319</span></a>        <span class="p">)</span>
</span><span id="L-1320"><a href="#-1320"><span class="linenos">1320</span></a>        <span class="n">props</span><span class="o">.</span><span class="n">vp</span><span class="p">[(</span><span class="n">ng</span> <span class="o">&gt;</span> <span class="mf">1.0e-2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lith</span> <span class="o">&lt;</span> <span class="mf">2.0</span><span class="p">)]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-1321"><a href="#-1321"><span class="linenos">1321</span></a>            <span class="n">props</span><span class="o">.</span><span class="n">vp</span><span class="p">[(</span><span class="n">ng</span> <span class="o">&gt;</span> <span class="mf">1.0e-2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lith</span> <span class="o">&lt;</span> <span class="mf">2.0</span><span class="p">)]</span> <span class="o">*</span> <span class="n">vp_factor_sand</span>
</span><span id="L-1322"><a href="#-1322"><span class="linenos">1322</span></a>        <span class="p">)</span>
</span><span id="L-1323"><a href="#-1323"><span class="linenos">1323</span></a>        <span class="n">props</span><span class="o">.</span><span class="n">vs</span><span class="p">[(</span><span class="n">ng</span> <span class="o">&gt;</span> <span class="mf">1.0e-2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lith</span> <span class="o">&lt;</span> <span class="mf">2.0</span><span class="p">)]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-1324"><a href="#-1324"><span class="linenos">1324</span></a>            <span class="n">props</span><span class="o">.</span><span class="n">vs</span><span class="p">[(</span><span class="n">ng</span> <span class="o">&gt;</span> <span class="mf">1.0e-2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lith</span> <span class="o">&lt;</span> <span class="mf">2.0</span><span class="p">)]</span> <span class="o">*</span> <span class="n">vs_factor_sand</span>
</span><span id="L-1325"><a href="#-1325"><span class="linenos">1325</span></a>        <span class="p">)</span>
</span><span id="L-1326"><a href="#-1326"><span class="linenos">1326</span></a>        <span class="c1"># Apply same factors to the fluid-factor property cubes</span>
</span><span id="L-1327"><a href="#-1327"><span class="linenos">1327</span></a>        <span class="n">props</span><span class="o">.</span><span class="n">rho_ff</span><span class="p">[(</span><span class="n">ng</span> <span class="o">&lt;=</span> <span class="mf">1.0e-2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lith</span> <span class="o">&lt;</span> <span class="mf">2.0</span><span class="p">)]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-1328"><a href="#-1328"><span class="linenos">1328</span></a>            <span class="n">props</span><span class="o">.</span><span class="n">rho_ff</span><span class="p">[(</span><span class="n">ng</span> <span class="o">&lt;=</span> <span class="mf">1.0e-2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lith</span> <span class="o">&lt;</span> <span class="mf">2.0</span><span class="p">)]</span> <span class="o">*</span> <span class="n">rho_factor_shale</span>
</span><span id="L-1329"><a href="#-1329"><span class="linenos">1329</span></a>        <span class="p">)</span>
</span><span id="L-1330"><a href="#-1330"><span class="linenos">1330</span></a>        <span class="n">props</span><span class="o">.</span><span class="n">vp_ff</span><span class="p">[(</span><span class="n">ng</span> <span class="o">&lt;=</span> <span class="mf">1.0e-2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lith</span> <span class="o">&lt;</span> <span class="mf">2.0</span><span class="p">)]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-1331"><a href="#-1331"><span class="linenos">1331</span></a>            <span class="n">props</span><span class="o">.</span><span class="n">vp_ff</span><span class="p">[(</span><span class="n">ng</span> <span class="o">&lt;=</span> <span class="mf">1.0e-2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lith</span> <span class="o">&lt;</span> <span class="mf">2.0</span><span class="p">)]</span> <span class="o">*</span> <span class="n">vp_factor_shale</span>
</span><span id="L-1332"><a href="#-1332"><span class="linenos">1332</span></a>        <span class="p">)</span>
</span><span id="L-1333"><a href="#-1333"><span class="linenos">1333</span></a>        <span class="n">props</span><span class="o">.</span><span class="n">vs_ff</span><span class="p">[(</span><span class="n">ng</span> <span class="o">&lt;=</span> <span class="mf">1.0e-2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lith</span> <span class="o">&lt;</span> <span class="mf">2.0</span><span class="p">)]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-1334"><a href="#-1334"><span class="linenos">1334</span></a>            <span class="n">props</span><span class="o">.</span><span class="n">vs_ff</span><span class="p">[(</span><span class="n">ng</span> <span class="o">&lt;=</span> <span class="mf">1.0e-2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lith</span> <span class="o">&lt;</span> <span class="mf">2.0</span><span class="p">)]</span> <span class="o">*</span> <span class="n">vs_factor_shale</span>
</span><span id="L-1335"><a href="#-1335"><span class="linenos">1335</span></a>        <span class="p">)</span>
</span><span id="L-1336"><a href="#-1336"><span class="linenos">1336</span></a>        <span class="n">props</span><span class="o">.</span><span class="n">rho_ff</span><span class="p">[(</span><span class="n">ng</span> <span class="o">&gt;</span> <span class="mf">1.0e-2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lith</span> <span class="o">&lt;</span> <span class="mf">2.0</span><span class="p">)]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-1337"><a href="#-1337"><span class="linenos">1337</span></a>            <span class="n">props</span><span class="o">.</span><span class="n">rho_ff</span><span class="p">[(</span><span class="n">ng</span> <span class="o">&gt;</span> <span class="mf">1.0e-2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lith</span> <span class="o">&lt;</span> <span class="mf">2.0</span><span class="p">)]</span> <span class="o">*</span> <span class="n">rho_factor_sand</span>
</span><span id="L-1338"><a href="#-1338"><span class="linenos">1338</span></a>        <span class="p">)</span>
</span><span id="L-1339"><a href="#-1339"><span class="linenos">1339</span></a>        <span class="n">props</span><span class="o">.</span><span class="n">vp_ff</span><span class="p">[(</span><span class="n">ng</span> <span class="o">&gt;</span> <span class="mf">1.0e-2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lith</span> <span class="o">&lt;</span> <span class="mf">2.0</span><span class="p">)]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-1340"><a href="#-1340"><span class="linenos">1340</span></a>            <span class="n">props</span><span class="o">.</span><span class="n">vp_ff</span><span class="p">[(</span><span class="n">ng</span> <span class="o">&gt;</span> <span class="mf">1.0e-2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lith</span> <span class="o">&lt;</span> <span class="mf">2.0</span><span class="p">)]</span> <span class="o">*</span> <span class="n">vp_factor_sand</span>
</span><span id="L-1341"><a href="#-1341"><span class="linenos">1341</span></a>        <span class="p">)</span>
</span><span id="L-1342"><a href="#-1342"><span class="linenos">1342</span></a>        <span class="n">props</span><span class="o">.</span><span class="n">vs_ff</span><span class="p">[(</span><span class="n">ng</span> <span class="o">&gt;</span> <span class="mf">1.0e-2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lith</span> <span class="o">&lt;</span> <span class="mf">2.0</span><span class="p">)]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-1343"><a href="#-1343"><span class="linenos">1343</span></a>            <span class="n">props</span><span class="o">.</span><span class="n">vs_ff</span><span class="p">[(</span><span class="n">ng</span> <span class="o">&gt;</span> <span class="mf">1.0e-2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lith</span> <span class="o">&lt;</span> <span class="mf">2.0</span><span class="p">)]</span> <span class="o">*</span> <span class="n">vs_factor_sand</span>
</span><span id="L-1344"><a href="#-1344"><span class="linenos">1344</span></a>        <span class="p">)</span>
</span><span id="L-1345"><a href="#-1345"><span class="linenos">1345</span></a>        <span class="k">return</span> <span class="n">props</span>
</span><span id="L-1346"><a href="#-1346"><span class="linenos">1346</span></a>
</span><span id="L-1347"><a href="#-1347"><span class="linenos">1347</span></a>    <span class="k">def</span> <span class="nf">write_property_volumes_to_disk</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-1348"><a href="#-1348"><span class="linenos">1348</span></a>        <span class="sd">&quot;&quot;&quot;Write Rho, Vp, Vs volumes to disk.&quot;&quot;&quot;</span>
</span><span id="L-1349"><a href="#-1349"><span class="linenos">1349</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">write_cube_to_disk</span><span class="p">(</span>
</span><span id="L-1350"><a href="#-1350"><span class="linenos">1350</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">rho</span><span class="p">[:],</span>
</span><span id="L-1351"><a href="#-1351"><span class="linenos">1351</span></a>            <span class="s2">&quot;qc_volume_rho&quot;</span><span class="p">,</span>
</span><span id="L-1352"><a href="#-1352"><span class="linenos">1352</span></a>        <span class="p">)</span>
</span><span id="L-1353"><a href="#-1353"><span class="linenos">1353</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">write_cube_to_disk</span><span class="p">(</span>
</span><span id="L-1354"><a href="#-1354"><span class="linenos">1354</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">vp</span><span class="p">[:],</span>
</span><span id="L-1355"><a href="#-1355"><span class="linenos">1355</span></a>            <span class="s2">&quot;qc_volume_vp&quot;</span><span class="p">,</span>
</span><span id="L-1356"><a href="#-1356"><span class="linenos">1356</span></a>        <span class="p">)</span>
</span><span id="L-1357"><a href="#-1357"><span class="linenos">1357</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">write_cube_to_disk</span><span class="p">(</span>
</span><span id="L-1358"><a href="#-1358"><span class="linenos">1358</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">vs</span><span class="p">[:],</span>
</span><span id="L-1359"><a href="#-1359"><span class="linenos">1359</span></a>            <span class="s2">&quot;qc_volume_vs&quot;</span><span class="p">,</span>
</span><span id="L-1360"><a href="#-1360"><span class="linenos">1360</span></a>        <span class="p">)</span>
</span><span id="L-1361"><a href="#-1361"><span class="linenos">1361</span></a>
</span><span id="L-1362"><a href="#-1362"><span class="linenos">1362</span></a>
</span><span id="L-1363"><a href="#-1363"><span class="linenos">1363</span></a><span class="k">class</span> <span class="nc">ElasticProperties3D</span><span class="p">:</span>
</span><span id="L-1364"><a href="#-1364"><span class="linenos">1364</span></a>    <span class="sd">&quot;&quot;&quot;Empty class to hold 3D property cubes Rho, Vp, Vs, Rho_ff, Vp_ff, Vs_ff and sum_net&quot;&quot;&quot;</span>
</span><span id="L-1365"><a href="#-1365"><span class="linenos">1365</span></a>
</span><span id="L-1366"><a href="#-1366"><span class="linenos">1366</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-1367"><a href="#-1367"><span class="linenos">1367</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">rho</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-1368"><a href="#-1368"><span class="linenos">1368</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vp</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-1369"><a href="#-1369"><span class="linenos">1369</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vs</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-1370"><a href="#-1370"><span class="linenos">1370</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">rho_ff</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-1371"><a href="#-1371"><span class="linenos">1371</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vp_ff</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-1372"><a href="#-1372"><span class="linenos">1372</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vs_ff</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-1373"><a href="#-1373"><span class="linenos">1373</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sum_net</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-1374"><a href="#-1374"><span class="linenos">1374</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">rho_not_random</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-1375"><a href="#-1375"><span class="linenos">1375</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vp_not_random</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-1376"><a href="#-1376"><span class="linenos">1376</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vs_not_random</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-1377"><a href="#-1377"><span class="linenos">1377</span></a>
</span><span id="L-1378"><a href="#-1378"><span class="linenos">1378</span></a>
</span><span id="L-1379"><a href="#-1379"><span class="linenos">1379</span></a><span class="k">class</span> <span class="nc">RFC</span><span class="p">:</span>
</span><span id="L-1380"><a href="#-1380"><span class="linenos">1380</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1381"><a href="#-1381"><span class="linenos">1381</span></a><span class="sd">    Reflection Coefficient object</span>
</span><span id="L-1382"><a href="#-1382"><span class="linenos">1382</span></a><span class="sd">    Contains methods for calculating the reflection coefficient at an interface</span>
</span><span id="L-1383"><a href="#-1383"><span class="linenos">1383</span></a><span class="sd">    from input Vp, Vs, Rho and incident angle</span>
</span><span id="L-1384"><a href="#-1384"><span class="linenos">1384</span></a><span class="sd">    Angle should be given in degrees and is converted to radians internally</span>
</span><span id="L-1385"><a href="#-1385"><span class="linenos">1385</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-1386"><a href="#-1386"><span class="linenos">1386</span></a>
</span><span id="L-1387"><a href="#-1387"><span class="linenos">1387</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="L-1388"><a href="#-1388"><span class="linenos">1388</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">vp_upper</span><span class="p">,</span> <span class="n">vs_upper</span><span class="p">,</span> <span class="n">rho_upper</span><span class="p">,</span> <span class="n">vp_lower</span><span class="p">,</span> <span class="n">vs_lower</span><span class="p">,</span> <span class="n">rho_lower</span><span class="p">,</span> <span class="n">theta</span>
</span><span id="L-1389"><a href="#-1389"><span class="linenos">1389</span></a>    <span class="p">):</span>
</span><span id="L-1390"><a href="#-1390"><span class="linenos">1390</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">theta</span> <span class="o">=</span> <span class="n">theta</span>
</span><span id="L-1391"><a href="#-1391"><span class="linenos">1391</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vp_upper</span> <span class="o">=</span> <span class="n">vp_upper</span>
</span><span id="L-1392"><a href="#-1392"><span class="linenos">1392</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vs_upper</span> <span class="o">=</span> <span class="n">vs_upper</span>
</span><span id="L-1393"><a href="#-1393"><span class="linenos">1393</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">rho_upper</span> <span class="o">=</span> <span class="n">rho_upper</span>
</span><span id="L-1394"><a href="#-1394"><span class="linenos">1394</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vp_lower</span> <span class="o">=</span> <span class="n">vp_lower</span>
</span><span id="L-1395"><a href="#-1395"><span class="linenos">1395</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vs_lower</span> <span class="o">=</span> <span class="n">vs_lower</span>
</span><span id="L-1396"><a href="#-1396"><span class="linenos">1396</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">rho_lower</span> <span class="o">=</span> <span class="n">rho_lower</span>
</span><span id="L-1397"><a href="#-1397"><span class="linenos">1397</span></a>
</span><span id="L-1398"><a href="#-1398"><span class="linenos">1398</span></a>    <span class="k">def</span> <span class="nf">normal_incidence_rfc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-1399"><a href="#-1399"><span class="linenos">1399</span></a>        <span class="n">z0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rho_upper</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">vp_upper</span>
</span><span id="L-1400"><a href="#-1400"><span class="linenos">1400</span></a>        <span class="n">z1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rho_lower</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">vp_lower</span>
</span><span id="L-1401"><a href="#-1401"><span class="linenos">1401</span></a>        <span class="k">return</span> <span class="p">(</span><span class="n">z1</span> <span class="o">-</span> <span class="n">z0</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">z1</span> <span class="o">+</span> <span class="n">z0</span><span class="p">)</span>
</span><span id="L-1402"><a href="#-1402"><span class="linenos">1402</span></a>
</span><span id="L-1403"><a href="#-1403"><span class="linenos">1403</span></a>    <span class="k">def</span> <span class="nf">shuey</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-1404"><a href="#-1404"><span class="linenos">1404</span></a>        <span class="sd">&quot;&quot;&quot;Use 3-term Shuey to calculate RFC.&quot;&quot;&quot;</span>
</span><span id="L-1405"><a href="#-1405"><span class="linenos">1405</span></a>        <span class="n">radians</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_degrees_to_radians</span><span class="p">()</span>  <span class="c1"># Angle to radians</span>
</span><span id="L-1406"><a href="#-1406"><span class="linenos">1406</span></a>        <span class="n">sin_squared</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">radians</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
</span><span id="L-1407"><a href="#-1407"><span class="linenos">1407</span></a>        <span class="n">tan_squared</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">radians</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
</span><span id="L-1408"><a href="#-1408"><span class="linenos">1408</span></a>
</span><span id="L-1409"><a href="#-1409"><span class="linenos">1409</span></a>        <span class="c1"># Delta Vp, Vs, Rho</span>
</span><span id="L-1410"><a href="#-1410"><span class="linenos">1410</span></a>        <span class="n">d_vp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vp_lower</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">vp_upper</span>
</span><span id="L-1411"><a href="#-1411"><span class="linenos">1411</span></a>        <span class="n">d_vs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vs_lower</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">vs_upper</span>
</span><span id="L-1412"><a href="#-1412"><span class="linenos">1412</span></a>        <span class="n">d_rho</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rho_lower</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">rho_upper</span>
</span><span id="L-1413"><a href="#-1413"><span class="linenos">1413</span></a>        <span class="n">avg_vp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">vp_lower</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">vp_upper</span><span class="p">])</span>
</span><span id="L-1414"><a href="#-1414"><span class="linenos">1414</span></a>        <span class="n">avg_vs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">vs_lower</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">vs_upper</span><span class="p">])</span>
</span><span id="L-1415"><a href="#-1415"><span class="linenos">1415</span></a>        <span class="n">avg_rho</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">rho_lower</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rho_upper</span><span class="p">])</span>
</span><span id="L-1416"><a href="#-1416"><span class="linenos">1416</span></a>
</span><span id="L-1417"><a href="#-1417"><span class="linenos">1417</span></a>        <span class="c1"># 3 Term Shuey</span>
</span><span id="L-1418"><a href="#-1418"><span class="linenos">1418</span></a>        <span class="n">r0</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">d_vp</span> <span class="o">/</span> <span class="n">avg_vp</span> <span class="o">+</span> <span class="n">d_rho</span> <span class="o">/</span> <span class="n">avg_rho</span><span class="p">)</span>
</span><span id="L-1419"><a href="#-1419"><span class="linenos">1419</span></a>        <span class="n">g</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">d_vp</span> <span class="o">/</span> <span class="n">avg_vp</span><span class="p">)</span> <span class="o">-</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">avg_vs</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">avg_vp</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span>
</span><span id="L-1420"><a href="#-1420"><span class="linenos">1420</span></a>            <span class="n">d_rho</span> <span class="o">/</span> <span class="n">avg_rho</span> <span class="o">+</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">d_vs</span> <span class="o">/</span> <span class="n">avg_vs</span>
</span><span id="L-1421"><a href="#-1421"><span class="linenos">1421</span></a>        <span class="p">)</span>
</span><span id="L-1422"><a href="#-1422"><span class="linenos">1422</span></a>        <span class="n">f</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">d_vp</span> <span class="o">/</span> <span class="n">avg_vp</span><span class="p">)</span>
</span><span id="L-1423"><a href="#-1423"><span class="linenos">1423</span></a>
</span><span id="L-1424"><a href="#-1424"><span class="linenos">1424</span></a>        <span class="k">return</span> <span class="n">r0</span> <span class="o">+</span> <span class="n">g</span> <span class="o">*</span> <span class="n">sin_squared</span> <span class="o">+</span> <span class="n">f</span> <span class="o">*</span> <span class="p">(</span><span class="n">tan_squared</span> <span class="o">-</span> <span class="n">sin_squared</span><span class="p">)</span>
</span><span id="L-1425"><a href="#-1425"><span class="linenos">1425</span></a>
</span><span id="L-1426"><a href="#-1426"><span class="linenos">1426</span></a>    <span class="k">def</span> <span class="nf">zoeppritz_reflectivity</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-1427"><a href="#-1427"><span class="linenos">1427</span></a>        <span class="sd">&quot;&quot;&quot;Calculate PP reflectivity using Zoeppritz equation&quot;&quot;&quot;</span>
</span><span id="L-1428"><a href="#-1428"><span class="linenos">1428</span></a>        <span class="n">theta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_degrees_to_radians</span><span class="p">(</span>
</span><span id="L-1429"><a href="#-1429"><span class="linenos">1429</span></a>            <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;complex&quot;</span>
</span><span id="L-1430"><a href="#-1430"><span class="linenos">1430</span></a>        <span class="p">)</span>  <span class="c1"># Convert angle to radians, as complex value</span>
</span><span id="L-1431"><a href="#-1431"><span class="linenos">1431</span></a>        <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">vp_upper</span>  <span class="c1"># ray param</span>
</span><span id="L-1432"><a href="#-1432"><span class="linenos">1432</span></a>        <span class="n">theta2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arcsin</span><span class="p">(</span><span class="n">p</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">vp_lower</span><span class="p">)</span>  <span class="c1"># Transmission angle of P-wave</span>
</span><span id="L-1433"><a href="#-1433"><span class="linenos">1433</span></a>        <span class="n">phi1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arcsin</span><span class="p">(</span><span class="n">p</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">vs_upper</span><span class="p">)</span>  <span class="c1"># Reflection angle of converted S-wave</span>
</span><span id="L-1434"><a href="#-1434"><span class="linenos">1434</span></a>        <span class="n">phi2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arcsin</span><span class="p">(</span><span class="n">p</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">vs_lower</span><span class="p">)</span>  <span class="c1"># Transmission angle of converted S-wave</span>
</span><span id="L-1435"><a href="#-1435"><span class="linenos">1435</span></a>
</span><span id="L-1436"><a href="#-1436"><span class="linenos">1436</span></a>        <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rho_lower</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi2</span><span class="p">)</span> <span class="o">**</span> <span class="mf">2.0</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">rho_upper</span> <span class="o">*</span> <span class="p">(</span>
</span><span id="L-1437"><a href="#-1437"><span class="linenos">1437</span></a>            <span class="mi">1</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi1</span><span class="p">)</span> <span class="o">**</span> <span class="mf">2.0</span>
</span><span id="L-1438"><a href="#-1438"><span class="linenos">1438</span></a>        <span class="p">)</span>
</span><span id="L-1439"><a href="#-1439"><span class="linenos">1439</span></a>        <span class="n">b</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-1440"><a href="#-1440"><span class="linenos">1440</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">rho_lower</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi2</span><span class="p">)</span> <span class="o">**</span> <span class="mf">2.0</span><span class="p">)</span>
</span><span id="L-1441"><a href="#-1441"><span class="linenos">1441</span></a>            <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">rho_upper</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi1</span><span class="p">)</span> <span class="o">**</span> <span class="mf">2.0</span>
</span><span id="L-1442"><a href="#-1442"><span class="linenos">1442</span></a>        <span class="p">)</span>
</span><span id="L-1443"><a href="#-1443"><span class="linenos">1443</span></a>        <span class="n">c</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-1444"><a href="#-1444"><span class="linenos">1444</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">rho_upper</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi1</span><span class="p">)</span> <span class="o">**</span> <span class="mf">2.0</span><span class="p">)</span>
</span><span id="L-1445"><a href="#-1445"><span class="linenos">1445</span></a>            <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">rho_lower</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi2</span><span class="p">)</span> <span class="o">**</span> <span class="mf">2.0</span>
</span><span id="L-1446"><a href="#-1446"><span class="linenos">1446</span></a>        <span class="p">)</span>
</span><span id="L-1447"><a href="#-1447"><span class="linenos">1447</span></a>        <span class="n">d</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span>
</span><span id="L-1448"><a href="#-1448"><span class="linenos">1448</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">rho_lower</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">vs_lower</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">rho_upper</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">vs_upper</span> <span class="o">**</span> <span class="mi">2</span>
</span><span id="L-1449"><a href="#-1449"><span class="linenos">1449</span></a>        <span class="p">)</span>
</span><span id="L-1450"><a href="#-1450"><span class="linenos">1450</span></a>
</span><span id="L-1451"><a href="#-1451"><span class="linenos">1451</span></a>        <span class="n">e</span> <span class="o">=</span> <span class="p">(</span><span class="n">b</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">vp_upper</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">c</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta2</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">vp_lower</span><span class="p">)</span>
</span><span id="L-1452"><a href="#-1452"><span class="linenos">1452</span></a>        <span class="n">f</span> <span class="o">=</span> <span class="p">(</span><span class="n">b</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi1</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">vs_upper</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">c</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi2</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">vs_lower</span><span class="p">)</span>
</span><span id="L-1453"><a href="#-1453"><span class="linenos">1453</span></a>        <span class="n">g</span> <span class="o">=</span> <span class="n">a</span> <span class="o">-</span> <span class="n">d</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">vp_upper</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi2</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">vs_lower</span>
</span><span id="L-1454"><a href="#-1454"><span class="linenos">1454</span></a>        <span class="n">h</span> <span class="o">=</span> <span class="n">a</span> <span class="o">-</span> <span class="n">d</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta2</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">vp_lower</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi1</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">vs_upper</span>
</span><span id="L-1455"><a href="#-1455"><span class="linenos">1455</span></a>
</span><span id="L-1456"><a href="#-1456"><span class="linenos">1456</span></a>        <span class="n">d</span> <span class="o">=</span> <span class="n">e</span> <span class="o">*</span> <span class="n">f</span> <span class="o">+</span> <span class="n">g</span> <span class="o">*</span> <span class="n">h</span> <span class="o">*</span> <span class="n">p</span> <span class="o">**</span> <span class="mi">2</span>
</span><span id="L-1457"><a href="#-1457"><span class="linenos">1457</span></a>
</span><span id="L-1458"><a href="#-1458"><span class="linenos">1458</span></a>        <span class="n">zoep_pp</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-1459"><a href="#-1459"><span class="linenos">1459</span></a>            <span class="n">f</span>
</span><span id="L-1460"><a href="#-1460"><span class="linenos">1460</span></a>            <span class="o">*</span> <span class="p">(</span>
</span><span id="L-1461"><a href="#-1461"><span class="linenos">1461</span></a>                <span class="n">b</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">vp_upper</span><span class="p">)</span>
</span><span id="L-1462"><a href="#-1462"><span class="linenos">1462</span></a>                <span class="o">-</span> <span class="n">c</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta2</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">vp_lower</span><span class="p">)</span>
</span><span id="L-1463"><a href="#-1463"><span class="linenos">1463</span></a>            <span class="p">)</span>
</span><span id="L-1464"><a href="#-1464"><span class="linenos">1464</span></a>            <span class="o">-</span> <span class="n">h</span>
</span><span id="L-1465"><a href="#-1465"><span class="linenos">1465</span></a>            <span class="o">*</span> <span class="n">p</span> <span class="o">**</span> <span class="mi">2</span>
</span><span id="L-1466"><a href="#-1466"><span class="linenos">1466</span></a>            <span class="o">*</span> <span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">d</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">vp_upper</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi2</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">vs_lower</span><span class="p">))</span>
</span><span id="L-1467"><a href="#-1467"><span class="linenos">1467</span></a>        <span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">d</span><span class="p">)</span>
</span><span id="L-1468"><a href="#-1468"><span class="linenos">1468</span></a>
</span><span id="L-1469"><a href="#-1469"><span class="linenos">1469</span></a>        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">zoep_pp</span><span class="p">)</span>
</span><span id="L-1470"><a href="#-1470"><span class="linenos">1470</span></a>
</span><span id="L-1471"><a href="#-1471"><span class="linenos">1471</span></a>    <span class="k">def</span> <span class="nf">_degrees_to_radians</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;float&quot;</span><span class="p">):</span>
</span><span id="L-1472"><a href="#-1472"><span class="linenos">1472</span></a>        <span class="sd">&quot;&quot;&quot;Convert angle in degrees to ange in radians. If dtype != &#39;float&#39;, return a complex dtype array&quot;&quot;&quot;</span>
</span><span id="L-1473"><a href="#-1473"><span class="linenos">1473</span></a>        <span class="k">if</span> <span class="n">dtype</span> <span class="o">==</span> <span class="s2">&quot;float&quot;</span><span class="p">:</span>
</span><span id="L-1474"><a href="#-1474"><span class="linenos">1474</span></a>            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">)</span>
</span><span id="L-1475"><a href="#-1475"><span class="linenos">1475</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1476"><a href="#-1476"><span class="linenos">1476</span></a>            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">complex</span><span class="p">)</span>
</span><span id="L-1477"><a href="#-1477"><span class="linenos">1477</span></a>
</span><span id="L-1478"><a href="#-1478"><span class="linenos">1478</span></a>
</span><span id="L-1479"><a href="#-1479"><span class="linenos">1479</span></a><span class="k">def</span> <span class="nf">derive_butterworth_bandpass</span><span class="p">(</span><span class="n">lowcut</span><span class="p">,</span> <span class="n">highcut</span><span class="p">,</span> <span class="n">digitisation</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">4</span><span class="p">):</span>
</span><span id="L-1480"><a href="#-1480"><span class="linenos">1480</span></a>    <span class="kn">from</span> <span class="nn">scipy.signal</span> <span class="kn">import</span> <span class="n">butter</span>
</span><span id="L-1481"><a href="#-1481"><span class="linenos">1481</span></a>
</span><span id="L-1482"><a href="#-1482"><span class="linenos">1482</span></a>    <span class="n">fs</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="n">digitisation</span> <span class="o">/</span> <span class="mf">1000.0</span><span class="p">)</span>
</span><span id="L-1483"><a href="#-1483"><span class="linenos">1483</span></a>    <span class="n">nyq</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">fs</span>
</span><span id="L-1484"><a href="#-1484"><span class="linenos">1484</span></a>    <span class="n">low</span> <span class="o">=</span> <span class="n">lowcut</span> <span class="o">/</span> <span class="n">nyq</span>
</span><span id="L-1485"><a href="#-1485"><span class="linenos">1485</span></a>    <span class="n">high</span> <span class="o">=</span> <span class="n">highcut</span> <span class="o">/</span> <span class="n">nyq</span>
</span><span id="L-1486"><a href="#-1486"><span class="linenos">1486</span></a>    <span class="n">b</span><span class="p">,</span> <span class="n">a</span> <span class="o">=</span> <span class="n">butter</span><span class="p">(</span><span class="n">order</span><span class="p">,</span> <span class="p">[</span><span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="p">],</span> <span class="n">btype</span><span class="o">=</span><span class="s2">&quot;bandpass&quot;</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="s2">&quot;ba&quot;</span><span class="p">)</span>
</span><span id="L-1487"><a href="#-1487"><span class="linenos">1487</span></a>    <span class="k">return</span> <span class="n">b</span><span class="p">,</span> <span class="n">a</span>
</span><span id="L-1488"><a href="#-1488"><span class="linenos">1488</span></a>
</span><span id="L-1489"><a href="#-1489"><span class="linenos">1489</span></a>
</span><span id="L-1490"><a href="#-1490"><span class="linenos">1490</span></a><span class="k">def</span> <span class="nf">apply_butterworth_bandpass</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
</span><span id="L-1491"><a href="#-1491"><span class="linenos">1491</span></a>    <span class="sd">&quot;&quot;&quot;Apply Butterworth bandpass to data&quot;&quot;&quot;</span>
</span><span id="L-1492"><a href="#-1492"><span class="linenos">1492</span></a>    <span class="kn">from</span> <span class="nn">scipy.signal</span> <span class="kn">import</span> <span class="n">tf2zpk</span><span class="p">,</span> <span class="n">filtfilt</span>
</span><span id="L-1493"><a href="#-1493"><span class="linenos">1493</span></a>
</span><span id="L-1494"><a href="#-1494"><span class="linenos">1494</span></a>    <span class="c1"># Use irlen to remove artefacts generated at base of cubes during bandlimitation</span>
</span><span id="L-1495"><a href="#-1495"><span class="linenos">1495</span></a>    <span class="n">_</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">tf2zpk</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
</span><span id="L-1496"><a href="#-1496"><span class="linenos">1496</span></a>    <span class="n">eps</span> <span class="o">=</span> <span class="mf">1e-9</span>
</span><span id="L-1497"><a href="#-1497"><span class="linenos">1497</span></a>    <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">p</span><span class="p">))</span>
</span><span id="L-1498"><a href="#-1498"><span class="linenos">1498</span></a>    <span class="n">approx_impulse_len</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">eps</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">r</span><span class="p">)))</span>
</span><span id="L-1499"><a href="#-1499"><span class="linenos">1499</span></a>    <span class="n">y</span> <span class="o">=</span> <span class="n">filtfilt</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;gust&quot;</span><span class="p">,</span> <span class="n">irlen</span><span class="o">=</span><span class="n">approx_impulse_len</span><span class="p">)</span>
</span><span id="L-1500"><a href="#-1500"><span class="linenos">1500</span></a>    <span class="c1"># y = filtfilt(b, a, data)</span>
</span><span id="L-1501"><a href="#-1501"><span class="linenos">1501</span></a>    <span class="k">return</span> <span class="n">y</span>
</span><span id="L-1502"><a href="#-1502"><span class="linenos">1502</span></a>
</span><span id="L-1503"><a href="#-1503"><span class="linenos">1503</span></a>
</span><span id="L-1504"><a href="#-1504"><span class="linenos">1504</span></a><span class="k">def</span> <span class="nf">trim_triangular</span><span class="p">(</span><span class="n">low</span><span class="p">,</span> <span class="n">mid</span><span class="p">,</span> <span class="n">high</span><span class="p">):</span>
</span><span id="L-1505"><a href="#-1505"><span class="linenos">1505</span></a>    <span class="c1">###</span>
</span><span id="L-1506"><a href="#-1506"><span class="linenos">1506</span></a>    <span class="c1">### use trimmed triangular distributions</span>
</span><span id="L-1507"><a href="#-1507"><span class="linenos">1507</span></a>    <span class="c1">###</span>
</span><span id="L-1508"><a href="#-1508"><span class="linenos">1508</span></a>    <span class="kn">from</span> <span class="nn">numpy.random</span> <span class="kn">import</span> <span class="n">triangular</span>
</span><span id="L-1509"><a href="#-1509"><span class="linenos">1509</span></a>
</span><span id="L-1510"><a href="#-1510"><span class="linenos">1510</span></a>    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">50</span><span class="p">):</span>
</span><span id="L-1511"><a href="#-1511"><span class="linenos">1511</span></a>        <span class="n">num</span> <span class="o">=</span> <span class="n">triangular</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">low</span> <span class="o">-</span> <span class="n">mid</span><span class="p">,</span> <span class="n">mid</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">high</span> <span class="o">-</span> <span class="n">mid</span><span class="p">)</span>
</span><span id="L-1512"><a href="#-1512"><span class="linenos">1512</span></a>        <span class="k">if</span> <span class="n">low</span> <span class="o">&lt;=</span> <span class="n">num</span> <span class="o">&lt;=</span> <span class="n">high</span><span class="p">:</span>
</span><span id="L-1513"><a href="#-1513"><span class="linenos">1513</span></a>            <span class="k">break</span>
</span><span id="L-1514"><a href="#-1514"><span class="linenos">1514</span></a>    <span class="k">return</span> <span class="n">num</span>
</span><span id="L-1515"><a href="#-1515"><span class="linenos">1515</span></a>
</span><span id="L-1516"><a href="#-1516"><span class="linenos">1516</span></a>
</span><span id="L-1517"><a href="#-1517"><span class="linenos">1517</span></a><span class="k">def</span> <span class="nf">apply_wavelet</span><span class="p">(</span><span class="n">cube</span><span class="p">,</span> <span class="n">wavelet</span><span class="p">):</span>
</span><span id="L-1518"><a href="#-1518"><span class="linenos">1518</span></a>    <span class="n">filtered_cube</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">cube</span><span class="p">)</span>
</span><span id="L-1519"><a href="#-1519"><span class="linenos">1519</span></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">cube</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="L-1520"><a href="#-1520"><span class="linenos">1520</span></a>        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">cube</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
</span><span id="L-1521"><a href="#-1521"><span class="linenos">1521</span></a>            <span class="n">filtered_cube</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">convolve</span><span class="p">(</span><span class="n">cube</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="p">:],</span> <span class="n">wavelet</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;same&quot;</span><span class="p">)</span>
</span><span id="L-1522"><a href="#-1522"><span class="linenos">1522</span></a>    <span class="k">return</span> <span class="n">filtered_cube</span>
</span></pre></div>


            </section>
                <section id="SeismicVolume">
                            <input id="SeismicVolume-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">SeismicVolume</span><wbr>(<span class="base"><a href="Geomodels.html#Geomodel">datagenerator.Geomodels.Geomodel</a></span>):

                <label class="view-source-button" for="SeismicVolume-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SeismicVolume"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SeismicVolume-15"><a href="#-15"><span class="linenos">  15</span></a><span class="k">class</span> <span class="nc">SeismicVolume</span><span class="p">(</span><span class="n">Geomodel</span><span class="p">):</span>
</span><span id="SeismicVolume-16"><a href="#-16"><span class="linenos">  16</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="SeismicVolume-17"><a href="#-17"><span class="linenos">  17</span></a><span class="sd">    SeismicVolume Class</span>
</span><span id="SeismicVolume-18"><a href="#-18"><span class="linenos">  18</span></a><span class="sd">    -------------------</span>
</span><span id="SeismicVolume-19"><a href="#-19"><span class="linenos">  19</span></a>
</span><span id="SeismicVolume-20"><a href="#-20"><span class="linenos">  20</span></a><span class="sd">    This class initializes the seismic volume that contains everything.</span>
</span><span id="SeismicVolume-21"><a href="#-21"><span class="linenos">  21</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="SeismicVolume-22"><a href="#-22"><span class="linenos">  22</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parameters</span><span class="p">,</span> <span class="n">faults</span><span class="p">,</span> <span class="n">closures</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SeismicVolume-23"><a href="#-23"><span class="linenos">  23</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="SeismicVolume-24"><a href="#-24"><span class="linenos">  24</span></a><span class="sd">        __init__</span>
</span><span id="SeismicVolume-25"><a href="#-25"><span class="linenos">  25</span></a><span class="sd">        --------</span>
</span><span id="SeismicVolume-26"><a href="#-26"><span class="linenos">  26</span></a>
</span><span id="SeismicVolume-27"><a href="#-27"><span class="linenos">  27</span></a><span class="sd">        The initialization function.</span>
</span><span id="SeismicVolume-28"><a href="#-28"><span class="linenos">  28</span></a>
</span><span id="SeismicVolume-29"><a href="#-29"><span class="linenos">  29</span></a><span class="sd">        Parameters</span>
</span><span id="SeismicVolume-30"><a href="#-30"><span class="linenos">  30</span></a><span class="sd">        ----------</span>
</span><span id="SeismicVolume-31"><a href="#-31"><span class="linenos">  31</span></a><span class="sd">        parameters : datagenerator.Parameters</span>
</span><span id="SeismicVolume-32"><a href="#-32"><span class="linenos">  32</span></a><span class="sd">            The parameters object of the project.</span>
</span><span id="SeismicVolume-33"><a href="#-33"><span class="linenos">  33</span></a><span class="sd">        faults : np.ndarray</span>
</span><span id="SeismicVolume-34"><a href="#-34"><span class="linenos">  34</span></a><span class="sd">            The faults array.</span>
</span><span id="SeismicVolume-35"><a href="#-35"><span class="linenos">  35</span></a><span class="sd">        closures : np.ndarray</span>
</span><span id="SeismicVolume-36"><a href="#-36"><span class="linenos">  36</span></a><span class="sd">            The closures array.</span>
</span><span id="SeismicVolume-37"><a href="#-37"><span class="linenos">  37</span></a><span class="sd">        </span>
</span><span id="SeismicVolume-38"><a href="#-38"><span class="linenos">  38</span></a><span class="sd">        Returns</span>
</span><span id="SeismicVolume-39"><a href="#-39"><span class="linenos">  39</span></a><span class="sd">        -------</span>
</span><span id="SeismicVolume-40"><a href="#-40"><span class="linenos">  40</span></a><span class="sd">        None</span>
</span><span id="SeismicVolume-41"><a href="#-41"><span class="linenos">  41</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SeismicVolume-42"><a href="#-42"><span class="linenos">  42</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span> <span class="o">=</span> <span class="n">parameters</span>
</span><span id="SeismicVolume-43"><a href="#-43"><span class="linenos">  43</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">faults</span> <span class="o">=</span> <span class="n">faults</span>
</span><span id="SeismicVolume-44"><a href="#-44"><span class="linenos">  44</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">traps</span> <span class="o">=</span> <span class="n">closures</span>
</span><span id="SeismicVolume-45"><a href="#-45"><span class="linenos">  45</span></a>
</span><span id="SeismicVolume-46"><a href="#-46"><span class="linenos">  46</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">model_qc_volumes</span><span class="p">:</span>
</span><span id="SeismicVolume-47"><a href="#-47"><span class="linenos">  47</span></a>            <span class="c1"># Add 0 and 45 degree angles to the list of user-input angles</span>
</span><span id="SeismicVolume-48"><a href="#-48"><span class="linenos">  48</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">angles</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">((</span><span class="mi">0</span><span class="p">,)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">incident_angles</span> <span class="o">+</span> <span class="p">(</span><span class="mi">45</span><span class="p">,))))</span>
</span><span id="SeismicVolume-49"><a href="#-49"><span class="linenos">  49</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SeismicVolume-50"><a href="#-50"><span class="linenos">  50</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">angles</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">incident_angles</span>
</span><span id="SeismicVolume-51"><a href="#-51"><span class="linenos">  51</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="SeismicVolume-52"><a href="#-52"><span class="linenos">  52</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Angles: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">angles</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="SeismicVolume-53"><a href="#-53"><span class="linenos">  53</span></a>
</span><span id="SeismicVolume-54"><a href="#-54"><span class="linenos">  54</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">first_random_lyr</span> <span class="o">=</span> <span class="mi">20</span>  <span class="c1"># do not randomise shallow layers</span>
</span><span id="SeismicVolume-55"><a href="#-55"><span class="linenos">  55</span></a>
</span><span id="SeismicVolume-56"><a href="#-56"><span class="linenos">  56</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">rho</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="SeismicVolume-57"><a href="#-57"><span class="linenos">  57</span></a>            <span class="s2">&quot;rho&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">h5file</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ModelData</span><span class="o">.</span><span class="n">faulted_depth</span><span class="o">.</span><span class="n">shape</span>
</span><span id="SeismicVolume-58"><a href="#-58"><span class="linenos">  58</span></a>        <span class="p">)</span>
</span><span id="SeismicVolume-59"><a href="#-59"><span class="linenos">  59</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="SeismicVolume-60"><a href="#-60"><span class="linenos">  60</span></a>            <span class="s2">&quot;vp&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">h5file</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ModelData</span><span class="o">.</span><span class="n">faulted_depth</span><span class="o">.</span><span class="n">shape</span>
</span><span id="SeismicVolume-61"><a href="#-61"><span class="linenos">  61</span></a>        <span class="p">)</span>
</span><span id="SeismicVolume-62"><a href="#-62"><span class="linenos">  62</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="SeismicVolume-63"><a href="#-63"><span class="linenos">  63</span></a>            <span class="s2">&quot;vs&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">h5file</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ModelData</span><span class="o">.</span><span class="n">faulted_depth</span><span class="o">.</span><span class="n">shape</span>
</span><span id="SeismicVolume-64"><a href="#-64"><span class="linenos">  64</span></a>        <span class="p">)</span>
</span><span id="SeismicVolume-65"><a href="#-65"><span class="linenos">  65</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">rho_ff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="SeismicVolume-66"><a href="#-66"><span class="linenos">  66</span></a>            <span class="s2">&quot;rho_ff&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">h5file</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ModelData</span><span class="o">.</span><span class="n">faulted_depth</span><span class="o">.</span><span class="n">shape</span>
</span><span id="SeismicVolume-67"><a href="#-67"><span class="linenos">  67</span></a>        <span class="p">)</span>
</span><span id="SeismicVolume-68"><a href="#-68"><span class="linenos">  68</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vp_ff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="SeismicVolume-69"><a href="#-69"><span class="linenos">  69</span></a>            <span class="s2">&quot;vp_ff&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">h5file</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ModelData</span><span class="o">.</span><span class="n">faulted_depth</span><span class="o">.</span><span class="n">shape</span>
</span><span id="SeismicVolume-70"><a href="#-70"><span class="linenos">  70</span></a>        <span class="p">)</span>
</span><span id="SeismicVolume-71"><a href="#-71"><span class="linenos">  71</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vs_ff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="SeismicVolume-72"><a href="#-72"><span class="linenos">  72</span></a>            <span class="s2">&quot;vs_ff&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">h5file</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ModelData</span><span class="o">.</span><span class="n">faulted_depth</span><span class="o">.</span><span class="n">shape</span>
</span><span id="SeismicVolume-73"><a href="#-73"><span class="linenos">  73</span></a>        <span class="p">)</span>
</span><span id="SeismicVolume-74"><a href="#-74"><span class="linenos">  74</span></a>
</span><span id="SeismicVolume-75"><a href="#-75"><span class="linenos">  75</span></a>        <span class="n">seis_shape</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="SeismicVolume-76"><a href="#-76"><span class="linenos">  76</span></a>            <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">angles</span><span class="p">),</span>
</span><span id="SeismicVolume-77"><a href="#-77"><span class="linenos">  77</span></a>            <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">h5file</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ModelData</span><span class="o">.</span><span class="n">faulted_depth</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
</span><span id="SeismicVolume-78"><a href="#-78"><span class="linenos">  78</span></a>        <span class="p">)</span>
</span><span id="SeismicVolume-79"><a href="#-79"><span class="linenos">  79</span></a>        <span class="n">rfc_shape</span> <span class="o">=</span> <span class="p">(</span><span class="n">seis_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">seis_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">seis_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">seis_shape</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="SeismicVolume-80"><a href="#-80"><span class="linenos">  80</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">rfc_raw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span><span class="s2">&quot;rfc_raw&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">rfc_shape</span><span class="p">)</span>
</span><span id="SeismicVolume-81"><a href="#-81"><span class="linenos">  81</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">rfc_noise_added</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span><span class="s2">&quot;rfc_noise_added&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">rfc_shape</span><span class="p">)</span>
</span><span id="SeismicVolume-82"><a href="#-82"><span class="linenos">  82</span></a>
</span><span id="SeismicVolume-83"><a href="#-83"><span class="linenos">  83</span></a>    <span class="k">def</span> <span class="nf">build_elastic_properties</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mixing_method</span><span class="o">=</span><span class="s2">&quot;inv_vel&quot;</span><span class="p">):</span>
</span><span id="SeismicVolume-84"><a href="#-84"><span class="linenos">  84</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="SeismicVolume-85"><a href="#-85"><span class="linenos">  85</span></a><span class="sd">        Build Elastic Properties</span>
</span><span id="SeismicVolume-86"><a href="#-86"><span class="linenos">  86</span></a><span class="sd">        ------------------------</span>
</span><span id="SeismicVolume-87"><a href="#-87"><span class="linenos">  87</span></a>
</span><span id="SeismicVolume-88"><a href="#-88"><span class="linenos">  88</span></a><span class="sd">        Creates Rho, Vp, Vs volumes using depth trends.</span>
</span><span id="SeismicVolume-89"><a href="#-89"><span class="linenos">  89</span></a>
</span><span id="SeismicVolume-90"><a href="#-90"><span class="linenos">  90</span></a><span class="sd">        Parameters</span>
</span><span id="SeismicVolume-91"><a href="#-91"><span class="linenos">  91</span></a><span class="sd">        ----------</span>
</span><span id="SeismicVolume-92"><a href="#-92"><span class="linenos">  92</span></a><span class="sd">        mixing_method : str, optional</span>
</span><span id="SeismicVolume-93"><a href="#-93"><span class="linenos">  93</span></a><span class="sd">            Method for mixing Velocities. Defaults to &quot;inv_vel&quot;.</span>
</span><span id="SeismicVolume-94"><a href="#-94"><span class="linenos">  94</span></a>
</span><span id="SeismicVolume-95"><a href="#-95"><span class="linenos">  95</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SeismicVolume-96"><a href="#-96"><span class="linenos">  96</span></a>        <span class="n">rpm</span> <span class="o">=</span> <span class="n">select_rpm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="p">)</span>
</span><span id="SeismicVolume-97"><a href="#-97"><span class="linenos">  97</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">build_property_models_randomised_depth</span><span class="p">(</span>
</span><span id="SeismicVolume-98"><a href="#-98"><span class="linenos">  98</span></a>            <span class="n">rpm</span><span class="p">,</span>
</span><span id="SeismicVolume-99"><a href="#-99"><span class="linenos">  99</span></a>            <span class="n">mixing_method</span><span class="o">=</span><span class="n">mixing_method</span>
</span><span id="SeismicVolume-100"><a href="#-100"><span class="linenos"> 100</span></a>        <span class="p">)</span>
</span><span id="SeismicVolume-101"><a href="#-101"><span class="linenos"> 101</span></a>
</span><span id="SeismicVolume-102"><a href="#-102"><span class="linenos"> 102</span></a>    <span class="k">def</span> <span class="nf">bandlimit_volumes_wavelets</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_wavelets</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
</span><span id="SeismicVolume-103"><a href="#-103"><span class="linenos"> 103</span></a>        <span class="c1"># Pre-prepared n, m, f filter_specs from npy file</span>
</span><span id="SeismicVolume-104"><a href="#-104"><span class="linenos"> 104</span></a>        <span class="n">fs_nr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">wavelets</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="SeismicVolume-105"><a href="#-105"><span class="linenos"> 105</span></a>        <span class="n">fs_md</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">wavelets</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="SeismicVolume-106"><a href="#-106"><span class="linenos"> 106</span></a>        <span class="n">fs_fr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">wavelets</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</span><span id="SeismicVolume-107"><a href="#-107"><span class="linenos"> 107</span></a>
</span><span id="SeismicVolume-108"><a href="#-108"><span class="linenos"> 108</span></a>        <span class="k">for</span> <span class="n">wavelet_count</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_wavelets</span><span class="p">):</span>
</span><span id="SeismicVolume-109"><a href="#-109"><span class="linenos"> 109</span></a>            <span class="n">low_freq_pctile</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
</span><span id="SeismicVolume-110"><a href="#-110"><span class="linenos"> 110</span></a>            <span class="n">mid_freq_pctile</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
</span><span id="SeismicVolume-111"><a href="#-111"><span class="linenos"> 111</span></a>            <span class="n">high_freq_pctile</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
</span><span id="SeismicVolume-112"><a href="#-112"><span class="linenos"> 112</span></a>            <span class="n">low_med_high_percentiles</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="SeismicVolume-113"><a href="#-113"><span class="linenos"> 113</span></a>                <span class="n">low_freq_pctile</span><span class="p">,</span>
</span><span id="SeismicVolume-114"><a href="#-114"><span class="linenos"> 114</span></a>                <span class="n">mid_freq_pctile</span><span class="p">,</span>
</span><span id="SeismicVolume-115"><a href="#-115"><span class="linenos"> 115</span></a>                <span class="n">high_freq_pctile</span><span class="p">,</span>
</span><span id="SeismicVolume-116"><a href="#-116"><span class="linenos"> 116</span></a>            <span class="p">)</span>
</span><span id="SeismicVolume-117"><a href="#-117"><span class="linenos"> 117</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;low_med_high_percentiles: </span><span class="si">{</span><span class="n">low_med_high_percentiles</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="SeismicVolume-118"><a href="#-118"><span class="linenos"> 118</span></a>            <span class="n">f_nr</span><span class="p">,</span> <span class="n">a_nr</span><span class="p">,</span> <span class="n">w_nr</span> <span class="o">=</span> <span class="n">generate_wavelet</span><span class="p">(</span><span class="n">fs_nr</span><span class="p">,</span> <span class="n">low_med_high_percentiles</span><span class="p">)</span>
</span><span id="SeismicVolume-119"><a href="#-119"><span class="linenos"> 119</span></a>            <span class="n">f_md</span><span class="p">,</span> <span class="n">a_md</span><span class="p">,</span> <span class="n">w_md</span> <span class="o">=</span> <span class="n">generate_wavelet</span><span class="p">(</span><span class="n">fs_md</span><span class="p">,</span> <span class="n">low_med_high_percentiles</span><span class="p">)</span>
</span><span id="SeismicVolume-120"><a href="#-120"><span class="linenos"> 120</span></a>            <span class="n">f_fr</span><span class="p">,</span> <span class="n">a_fr</span><span class="p">,</span> <span class="n">w_fr</span> <span class="o">=</span> <span class="n">generate_wavelet</span><span class="p">(</span><span class="n">fs_fr</span><span class="p">,</span> <span class="n">low_med_high_percentiles</span><span class="p">)</span>
</span><span id="SeismicVolume-121"><a href="#-121"><span class="linenos"> 121</span></a>            <span class="n">_f</span> <span class="o">=</span> <span class="p">(</span><span class="n">f_nr</span><span class="p">,</span> <span class="n">f_md</span><span class="p">,</span> <span class="n">f_fr</span><span class="p">)</span>
</span><span id="SeismicVolume-122"><a href="#-122"><span class="linenos"> 122</span></a>            <span class="n">_a</span> <span class="o">=</span> <span class="p">(</span><span class="n">a_nr</span><span class="p">,</span> <span class="n">a_md</span><span class="p">,</span> <span class="n">a_fr</span><span class="p">)</span>
</span><span id="SeismicVolume-123"><a href="#-123"><span class="linenos"> 123</span></a>            <span class="n">_w</span> <span class="o">=</span> <span class="p">(</span><span class="n">w_nr</span><span class="p">,</span> <span class="n">w_md</span><span class="p">,</span> <span class="n">w_fr</span><span class="p">)</span>
</span><span id="SeismicVolume-124"><a href="#-124"><span class="linenos"> 124</span></a>            <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Near&quot;</span><span class="p">,</span> <span class="s2">&quot;Mid&quot;</span><span class="p">,</span> <span class="s2">&quot;Far&quot;</span><span class="p">]</span>
</span><span id="SeismicVolume-125"><a href="#-125"><span class="linenos"> 125</span></a>            <span class="n">pngname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="SeismicVolume-126"><a href="#-126"><span class="linenos"> 126</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">work_subfolder</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;random_wavelets_</span><span class="si">{</span><span class="n">wavelet_count</span><span class="si">}</span><span class="s2">.png&quot;</span>
</span><span id="SeismicVolume-127"><a href="#-127"><span class="linenos"> 127</span></a>            <span class="p">)</span>
</span><span id="SeismicVolume-128"><a href="#-128"><span class="linenos"> 128</span></a>            <span class="n">plot_wavelets</span><span class="p">(</span><span class="n">_f</span><span class="p">,</span> <span class="n">_a</span><span class="p">,</span> <span class="n">_w</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">pngname</span><span class="p">)</span>
</span><span id="SeismicVolume-129"><a href="#-129"><span class="linenos"> 129</span></a>
</span><span id="SeismicVolume-130"><a href="#-130"><span class="linenos"> 130</span></a>            <span class="n">rfc_bandlimited_wavelet</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rfc_noise_added</span><span class="p">)</span>
</span><span id="SeismicVolume-131"><a href="#-131"><span class="linenos"> 131</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">model_qc_volumes</span><span class="p">:</span>
</span><span id="SeismicVolume-132"><a href="#-132"><span class="linenos"> 132</span></a>                <span class="n">wavelets</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="SeismicVolume-133"><a href="#-133"><span class="linenos"> 133</span></a>                    <span class="n">w_nr</span><span class="p">,</span>
</span><span id="SeismicVolume-134"><a href="#-134"><span class="linenos"> 134</span></a>                    <span class="n">w_nr</span><span class="p">,</span>
</span><span id="SeismicVolume-135"><a href="#-135"><span class="linenos"> 135</span></a>                    <span class="n">w_md</span><span class="p">,</span>
</span><span id="SeismicVolume-136"><a href="#-136"><span class="linenos"> 136</span></a>                    <span class="n">w_fr</span><span class="p">,</span>
</span><span id="SeismicVolume-137"><a href="#-137"><span class="linenos"> 137</span></a>                    <span class="n">w_fr</span><span class="p">,</span>
</span><span id="SeismicVolume-138"><a href="#-138"><span class="linenos"> 138</span></a>                <span class="p">]</span>  <span class="c1"># use near for 0 and far for 45 deg cubes</span>
</span><span id="SeismicVolume-139"><a href="#-139"><span class="linenos"> 139</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="SeismicVolume-140"><a href="#-140"><span class="linenos"> 140</span></a>                <span class="n">wavelets</span> <span class="o">=</span> <span class="p">[</span><span class="n">w_nr</span><span class="p">,</span> <span class="n">w_md</span><span class="p">,</span> <span class="n">w_fr</span><span class="p">]</span>
</span><span id="SeismicVolume-141"><a href="#-141"><span class="linenos"> 141</span></a>
</span><span id="SeismicVolume-142"><a href="#-142"><span class="linenos"> 142</span></a>            <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">rfc_bandlimited_wavelet</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="SeismicVolume-143"><a href="#-143"><span class="linenos"> 143</span></a>                <span class="n">rfc_bandlimited_wavelet</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">apply_wavelet</span><span class="p">(</span>
</span><span id="SeismicVolume-144"><a href="#-144"><span class="linenos"> 144</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">rfc_noise_added</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span> <span class="n">wavelets</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
</span><span id="SeismicVolume-145"><a href="#-145"><span class="linenos"> 145</span></a>                <span class="p">)</span>
</span><span id="SeismicVolume-146"><a href="#-146"><span class="linenos"> 146</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">lateral_filter_size</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="SeismicVolume-147"><a href="#-147"><span class="linenos"> 147</span></a>                <span class="c1"># Apply lateral smoothing filter</span>
</span><span id="SeismicVolume-148"><a href="#-148"><span class="linenos"> 148</span></a>                <span class="n">rfc_bandlimited_wavelet</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_lateral_filter</span><span class="p">(</span>
</span><span id="SeismicVolume-149"><a href="#-149"><span class="linenos"> 149</span></a>                    <span class="n">rfc_bandlimited_wavelet</span>
</span><span id="SeismicVolume-150"><a href="#-150"><span class="linenos"> 150</span></a>                <span class="p">)</span>
</span><span id="SeismicVolume-151"><a href="#-151"><span class="linenos"> 151</span></a>            <span class="n">cumsum_wavelet_noise_added</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_cumsum</span><span class="p">(</span><span class="n">rfc_bandlimited_wavelet</span><span class="p">)</span>
</span><span id="SeismicVolume-152"><a href="#-152"><span class="linenos"> 152</span></a>            <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">write_final_cubes_to_disk</span><span class="p">(</span>
</span><span id="SeismicVolume-153"><a href="#-153"><span class="linenos"> 153</span></a>                <span class="n">rfc_bandlimited_wavelet</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;seismicCubes_RFC_Wavelet_</span><span class="si">{</span><span class="n">wavelet_count</span><span class="si">}</span><span class="s2">_&quot;</span>
</span><span id="SeismicVolume-154"><a href="#-154"><span class="linenos"> 154</span></a>            <span class="p">)</span>
</span><span id="SeismicVolume-155"><a href="#-155"><span class="linenos"> 155</span></a>            <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">write_final_cubes_to_disk</span><span class="p">(</span>
</span><span id="SeismicVolume-156"><a href="#-156"><span class="linenos"> 156</span></a>                <span class="n">cumsum_wavelet_noise_added</span><span class="p">,</span>
</span><span id="SeismicVolume-157"><a href="#-157"><span class="linenos"> 157</span></a>                <span class="sa">f</span><span class="s2">&quot;seismicCubes_cumsum_Wavelet_</span><span class="si">{</span><span class="n">wavelet_count</span><span class="si">}</span><span class="s2">_&quot;</span><span class="p">,</span>
</span><span id="SeismicVolume-158"><a href="#-158"><span class="linenos"> 158</span></a>            <span class="p">)</span>
</span><span id="SeismicVolume-159"><a href="#-159"><span class="linenos"> 159</span></a>
</span><span id="SeismicVolume-160"><a href="#-160"><span class="linenos"> 160</span></a>    <span class="k">def</span> <span class="nf">postprocess_rfc_cubes</span><span class="p">(</span>
</span><span id="SeismicVolume-161"><a href="#-161"><span class="linenos"> 161</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">rfc_data</span><span class="p">,</span> <span class="n">filename_suffix</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">bb</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">stack</span><span class="o">=</span><span class="kc">False</span>
</span><span id="SeismicVolume-162"><a href="#-162"><span class="linenos"> 162</span></a>    <span class="p">):</span>
</span><span id="SeismicVolume-163"><a href="#-163"><span class="linenos"> 163</span></a>        <span class="sd">&quot;&quot;&quot;Postprocess the RFC cubes.&quot;&quot;&quot;</span>
</span><span id="SeismicVolume-164"><a href="#-164"><span class="linenos"> 164</span></a>        <span class="k">if</span> <span class="n">bb</span><span class="p">:</span>
</span><span id="SeismicVolume-165"><a href="#-165"><span class="linenos"> 165</span></a>            <span class="n">bandlimited</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_bandlimits</span><span class="p">(</span><span class="n">rfc_data</span><span class="p">,</span> <span class="p">(</span><span class="mf">4.0</span><span class="p">,</span> <span class="mf">90.0</span><span class="p">))</span>
</span><span id="SeismicVolume-166"><a href="#-166"><span class="linenos"> 166</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SeismicVolume-167"><a href="#-167"><span class="linenos"> 167</span></a>            <span class="n">bandlimited</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_bandlimits</span><span class="p">(</span><span class="n">rfc_data</span><span class="p">)</span>
</span><span id="SeismicVolume-168"><a href="#-168"><span class="linenos"> 168</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">lateral_filter_size</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="SeismicVolume-169"><a href="#-169"><span class="linenos"> 169</span></a>            <span class="n">bandlimited</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_lateral_filter</span><span class="p">(</span><span class="n">bandlimited</span><span class="p">)</span>
</span><span id="SeismicVolume-170"><a href="#-170"><span class="linenos"> 170</span></a>        <span class="k">if</span> <span class="n">filename_suffix</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
</span><span id="SeismicVolume-171"><a href="#-171"><span class="linenos"> 171</span></a>            <span class="n">fname</span> <span class="o">=</span> <span class="s2">&quot;seismicCubes_RFC_&quot;</span>
</span><span id="SeismicVolume-172"><a href="#-172"><span class="linenos"> 172</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SeismicVolume-173"><a href="#-173"><span class="linenos"> 173</span></a>            <span class="n">fname</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;seismicCubes_RFC_</span><span class="si">{</span><span class="n">filename_suffix</span><span class="si">}</span><span class="s2">_&quot;</span>
</span><span id="SeismicVolume-174"><a href="#-174"><span class="linenos"> 174</span></a>        <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">write_final_cubes_to_disk</span><span class="p">(</span><span class="n">bandlimited</span><span class="p">,</span> <span class="n">fname</span><span class="p">)</span>
</span><span id="SeismicVolume-175"><a href="#-175"><span class="linenos"> 175</span></a>        <span class="k">if</span> <span class="n">stack</span><span class="p">:</span>
</span><span id="SeismicVolume-176"><a href="#-176"><span class="linenos"> 176</span></a>            <span class="n">rfc_fullstack</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stack_substacks</span><span class="p">(</span>
</span><span id="SeismicVolume-177"><a href="#-177"><span class="linenos"> 177</span></a>                <span class="p">[</span><span class="n">bandlimited</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">angles</span><span class="p">)]</span>
</span><span id="SeismicVolume-178"><a href="#-178"><span class="linenos"> 178</span></a>            <span class="p">)</span>
</span><span id="SeismicVolume-179"><a href="#-179"><span class="linenos"> 179</span></a>            <span class="n">rfc_fullstack_scaled</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scale_seismic</span><span class="p">(</span><span class="n">rfc_fullstack</span><span class="p">)</span>
</span><span id="SeismicVolume-180"><a href="#-180"><span class="linenos"> 180</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">write_cube_to_disk</span><span class="p">(</span>
</span><span id="SeismicVolume-181"><a href="#-181"><span class="linenos"> 181</span></a>                <span class="n">rfc_fullstack_scaled</span><span class="p">,</span>
</span><span id="SeismicVolume-182"><a href="#-182"><span class="linenos"> 182</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">fname</span><span class="si">}</span><span class="s2">fullstack&quot;</span><span class="p">,</span>
</span><span id="SeismicVolume-183"><a href="#-183"><span class="linenos"> 183</span></a>            <span class="p">)</span>
</span><span id="SeismicVolume-184"><a href="#-184"><span class="linenos"> 184</span></a>
</span><span id="SeismicVolume-185"><a href="#-185"><span class="linenos"> 185</span></a>        <span class="n">cumsum</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_cumsum</span><span class="p">(</span><span class="n">bandlimited</span><span class="p">)</span>
</span><span id="SeismicVolume-186"><a href="#-186"><span class="linenos"> 186</span></a>        <span class="k">if</span> <span class="n">filename_suffix</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
</span><span id="SeismicVolume-187"><a href="#-187"><span class="linenos"> 187</span></a>            <span class="n">fname</span> <span class="o">=</span> <span class="s2">&quot;seismicCubes_cumsum_&quot;</span>
</span><span id="SeismicVolume-188"><a href="#-188"><span class="linenos"> 188</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SeismicVolume-189"><a href="#-189"><span class="linenos"> 189</span></a>            <span class="n">fname</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;seismicCubes_cumsum_</span><span class="si">{</span><span class="n">filename_suffix</span><span class="si">}</span><span class="s2">_&quot;</span>
</span><span id="SeismicVolume-190"><a href="#-190"><span class="linenos"> 190</span></a>        <span class="n">normalised_cumsum</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">write_final_cubes_to_disk</span><span class="p">(</span><span class="n">cumsum</span><span class="p">,</span> <span class="n">fname</span><span class="p">)</span>
</span><span id="SeismicVolume-191"><a href="#-191"><span class="linenos"> 191</span></a>        <span class="k">if</span> <span class="n">stack</span><span class="p">:</span>
</span><span id="SeismicVolume-192"><a href="#-192"><span class="linenos"> 192</span></a>            <span class="n">rai_fullstack</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stack_substacks</span><span class="p">(</span>
</span><span id="SeismicVolume-193"><a href="#-193"><span class="linenos"> 193</span></a>                <span class="p">[</span><span class="n">cumsum</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">angles</span><span class="p">)]</span>
</span><span id="SeismicVolume-194"><a href="#-194"><span class="linenos"> 194</span></a>            <span class="p">)</span>
</span><span id="SeismicVolume-195"><a href="#-195"><span class="linenos"> 195</span></a>            <span class="n">rai_fullstack_scaled</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scale_seismic</span><span class="p">(</span><span class="n">rai_fullstack</span><span class="p">)</span>
</span><span id="SeismicVolume-196"><a href="#-196"><span class="linenos"> 196</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">write_cube_to_disk</span><span class="p">(</span>
</span><span id="SeismicVolume-197"><a href="#-197"><span class="linenos"> 197</span></a>                <span class="n">rai_fullstack_scaled</span><span class="p">,</span>
</span><span id="SeismicVolume-198"><a href="#-198"><span class="linenos"> 198</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">fname</span><span class="si">}</span><span class="s2">fullstack&quot;</span><span class="p">,</span>
</span><span id="SeismicVolume-199"><a href="#-199"><span class="linenos"> 199</span></a>            <span class="p">)</span>
</span><span id="SeismicVolume-200"><a href="#-200"><span class="linenos"> 200</span></a>        <span class="k">return</span> <span class="n">normalised_cumsum</span>
</span><span id="SeismicVolume-201"><a href="#-201"><span class="linenos"> 201</span></a>
</span><span id="SeismicVolume-202"><a href="#-202"><span class="linenos"> 202</span></a>    <span class="k">def</span> <span class="nf">apply_augmentations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;cumsum&quot;</span><span class="p">):</span>
</span><span id="SeismicVolume-203"><a href="#-203"><span class="linenos"> 203</span></a>        <span class="n">seabed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">faulted_depth_maps</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">digi</span>
</span><span id="SeismicVolume-204"><a href="#-204"><span class="linenos"> 204</span></a>        <span class="n">augmented_data</span><span class="p">,</span> <span class="n">augmented_labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">augment_data_and_labels</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">seabed</span><span class="p">)</span>
</span><span id="SeismicVolume-205"><a href="#-205"><span class="linenos"> 205</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ang</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">incident_angles</span><span class="p">):</span>
</span><span id="SeismicVolume-206"><a href="#-206"><span class="linenos"> 206</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="n">augmented_data</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
</span><span id="SeismicVolume-207"><a href="#-207"><span class="linenos"> 207</span></a>            <span class="n">fname</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;seismicCubes_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">ang</span><span class="si">}</span><span class="s2">_degrees_normalized_augmented&quot;</span>
</span><span id="SeismicVolume-208"><a href="#-208"><span class="linenos"> 208</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">write_cube_to_disk</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">fname</span><span class="p">)</span>
</span><span id="SeismicVolume-209"><a href="#-209"><span class="linenos"> 209</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">write_cube_to_disk</span><span class="p">(</span><span class="n">augmented_labels</span><span class="p">,</span> <span class="s2">&quot;hc_closures_augmented&quot;</span><span class="p">)</span>
</span><span id="SeismicVolume-210"><a href="#-210"><span class="linenos"> 210</span></a>
</span><span id="SeismicVolume-211"><a href="#-211"><span class="linenos"> 211</span></a>    <span class="k">def</span> <span class="nf">apply_rmo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;cumsum_RMO&quot;</span><span class="p">):</span>
</span><span id="SeismicVolume-212"><a href="#-212"><span class="linenos"> 212</span></a>        <span class="sd">&quot;&quot;&quot;Apply RMO to the cumsum with noise. Note rmo application expects angle in last dimension&quot;&quot;&quot;</span>
</span><span id="SeismicVolume-213"><a href="#-213"><span class="linenos"> 213</span></a>        <span class="n">rmo_indices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_randomRMO_1D</span><span class="p">(</span>
</span><span id="SeismicVolume-214"><a href="#-214"><span class="linenos"> 214</span></a>            <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">incident_angles</span><span class="p">,</span> <span class="n">velocity_fraction</span><span class="o">=</span><span class="mf">0.015</span>
</span><span id="SeismicVolume-215"><a href="#-215"><span class="linenos"> 215</span></a>        <span class="p">)</span>
</span><span id="SeismicVolume-216"><a href="#-216"><span class="linenos"> 216</span></a>        <span class="n">rmo_applied_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">moveaxis</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
</span><span id="SeismicVolume-217"><a href="#-217"><span class="linenos"> 217</span></a>        <span class="k">for</span> <span class="n">iline</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="SeismicVolume-218"><a href="#-218"><span class="linenos"> 218</span></a>            <span class="k">for</span> <span class="n">xline</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
</span><span id="SeismicVolume-219"><a href="#-219"><span class="linenos"> 219</span></a>                <span class="n">rmo_applied_data</span><span class="p">[</span><span class="n">iline</span><span class="p">,</span> <span class="n">xline</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_rmo_augmentation</span><span class="p">(</span>
</span><span id="SeismicVolume-220"><a href="#-220"><span class="linenos"> 220</span></a>                    <span class="n">np</span><span class="o">.</span><span class="n">moveaxis</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)[</span><span class="n">iline</span><span class="p">,</span> <span class="n">xline</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span>
</span><span id="SeismicVolume-221"><a href="#-221"><span class="linenos"> 221</span></a>                    <span class="n">rmo_indices</span><span class="p">,</span>
</span><span id="SeismicVolume-222"><a href="#-222"><span class="linenos"> 222</span></a>                    <span class="n">remove_mean_rmo</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="SeismicVolume-223"><a href="#-223"><span class="linenos"> 223</span></a>                <span class="p">)</span>
</span><span id="SeismicVolume-224"><a href="#-224"><span class="linenos"> 224</span></a>        <span class="n">rmo_applied_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">moveaxis</span><span class="p">(</span>
</span><span id="SeismicVolume-225"><a href="#-225"><span class="linenos"> 225</span></a>            <span class="n">rmo_applied_data</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span>
</span><span id="SeismicVolume-226"><a href="#-226"><span class="linenos"> 226</span></a>        <span class="p">)</span>  <span class="c1"># Put the angles back into 1st dimension</span>
</span><span id="SeismicVolume-227"><a href="#-227"><span class="linenos"> 227</span></a>        <span class="n">normalised_rmo_applied_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">write_final_cubes_to_disk</span><span class="p">(</span>
</span><span id="SeismicVolume-228"><a href="#-228"><span class="linenos"> 228</span></a>            <span class="n">rmo_applied_data</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;seismicCubes_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">_&quot;</span>
</span><span id="SeismicVolume-229"><a href="#-229"><span class="linenos"> 229</span></a>        <span class="p">)</span>
</span><span id="SeismicVolume-230"><a href="#-230"><span class="linenos"> 230</span></a>        <span class="k">return</span> <span class="n">normalised_rmo_applied_data</span>
</span><span id="SeismicVolume-231"><a href="#-231"><span class="linenos"> 231</span></a>
</span><span id="SeismicVolume-232"><a href="#-232"><span class="linenos"> 232</span></a>    <span class="k">def</span> <span class="nf">build_seismic_volumes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="SeismicVolume-233"><a href="#-233"><span class="linenos"> 233</span></a>        <span class="sd">&quot;&quot;&quot;Build Seismic volumes.</span>
</span><span id="SeismicVolume-234"><a href="#-234"><span class="linenos"> 234</span></a>
</span><span id="SeismicVolume-235"><a href="#-235"><span class="linenos"> 235</span></a><span class="sd">        * Use Zoeppritz to create RFC volumes for each required angle, add 0 &amp; 45 degree stacks for QC</span>
</span><span id="SeismicVolume-236"><a href="#-236"><span class="linenos"> 236</span></a><span class="sd">        * Add exponential weighted noise to the angle stacks</span>
</span><span id="SeismicVolume-237"><a href="#-237"><span class="linenos"> 237</span></a><span class="sd">        * Apply bandpass filter</span>
</span><span id="SeismicVolume-238"><a href="#-238"><span class="linenos"> 238</span></a><span class="sd">        * Apply lateral filter</span>
</span><span id="SeismicVolume-239"><a href="#-239"><span class="linenos"> 239</span></a><span class="sd">        * Calculate cumsum</span>
</span><span id="SeismicVolume-240"><a href="#-240"><span class="linenos"> 240</span></a><span class="sd">        * Create full stacks by stacking the user-input angles (i.e. not including 0, 45 degree stacks)</span>
</span><span id="SeismicVolume-241"><a href="#-241"><span class="linenos"> 241</span></a><span class="sd">        * Write seismic volumes to disk</span>
</span><span id="SeismicVolume-242"><a href="#-242"><span class="linenos"> 242</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SeismicVolume-243"><a href="#-243"><span class="linenos"> 243</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="SeismicVolume-244"><a href="#-244"><span class="linenos"> 244</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="SeismicVolume-245"><a href="#-245"><span class="linenos"> 245</span></a>                <span class="sa">f</span><span class="s2">&quot;Generating 3D Rock Properties Rho, Vp and Vs using depth trends for project </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">project</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="SeismicVolume-246"><a href="#-246"><span class="linenos"> 246</span></a>            <span class="p">)</span>
</span><span id="SeismicVolume-247"><a href="#-247"><span class="linenos"> 247</span></a>        <span class="c1"># Calculate Raw RFC from rho, vp, vs using Zoeppritz &amp; write to HdF</span>
</span><span id="SeismicVolume-248"><a href="#-248"><span class="linenos"> 248</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">create_rfc_volumes</span><span class="p">()</span>
</span><span id="SeismicVolume-249"><a href="#-249"><span class="linenos"> 249</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">add_weighted_noise</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">faulted_depth_maps</span><span class="p">)</span>
</span><span id="SeismicVolume-250"><a href="#-250"><span class="linenos"> 250</span></a>        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="p">,</span> <span class="s2">&quot;wavelets&quot;</span><span class="p">):</span>
</span><span id="SeismicVolume-251"><a href="#-251"><span class="linenos"> 251</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">bandlimit_volumes_wavelets</span><span class="p">(</span><span class="n">n_wavelets</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="SeismicVolume-252"><a href="#-252"><span class="linenos"> 252</span></a>        <span class="n">normalised_cumsum</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">postprocess_rfc_cubes</span><span class="p">(</span>
</span><span id="SeismicVolume-253"><a href="#-253"><span class="linenos"> 253</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">rfc_noise_added</span><span class="p">[:],</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">stack</span><span class="o">=</span><span class="kc">True</span>
</span><span id="SeismicVolume-254"><a href="#-254"><span class="linenos"> 254</span></a>        <span class="p">)</span>
</span><span id="SeismicVolume-255"><a href="#-255"><span class="linenos"> 255</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">apply_augmentations</span><span class="p">(</span><span class="n">normalised_cumsum</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;cumsum&quot;</span><span class="p">)</span>
</span><span id="SeismicVolume-256"><a href="#-256"><span class="linenos"> 256</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">model_qc_volumes</span><span class="p">:</span>
</span><span id="SeismicVolume-257"><a href="#-257"><span class="linenos"> 257</span></a>            <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">postprocess_rfc_cubes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rfc_raw</span><span class="p">[:],</span> <span class="s2">&quot;noise_free&quot;</span><span class="p">,</span> <span class="n">bb</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="SeismicVolume-258"><a href="#-258"><span class="linenos"> 258</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">broadband_qc_volume</span><span class="p">:</span>
</span><span id="SeismicVolume-259"><a href="#-259"><span class="linenos"> 259</span></a>                <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">postprocess_rfc_cubes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rfc_raw</span><span class="p">[:],</span> <span class="s2">&quot;noise_free_bb&quot;</span><span class="p">,</span> <span class="n">bb</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="SeismicVolume-260"><a href="#-260"><span class="linenos"> 260</span></a>            <span class="n">normalised_cumsum_rmo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_rmo</span><span class="p">(</span><span class="n">normalised_cumsum</span><span class="p">)</span>
</span><span id="SeismicVolume-261"><a href="#-261"><span class="linenos"> 261</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">apply_augmentations</span><span class="p">(</span><span class="n">normalised_cumsum_rmo</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;cumsum_RMO&quot;</span><span class="p">)</span>
</span><span id="SeismicVolume-262"><a href="#-262"><span class="linenos"> 262</span></a>
</span><span id="SeismicVolume-263"><a href="#-263"><span class="linenos"> 263</span></a>    <span class="k">def</span> <span class="nf">_scale_seismic</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
</span><span id="SeismicVolume-264"><a href="#-264"><span class="linenos"> 264</span></a>        <span class="sd">&quot;&quot;&quot;Apply scaling factor to final seismic data volumes&quot;&quot;&quot;</span>
</span><span id="SeismicVolume-265"><a href="#-265"><span class="linenos"> 265</span></a>        <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
</span><span id="SeismicVolume-266"><a href="#-266"><span class="linenos"> 266</span></a>            <span class="n">avg_stdev</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">([</span><span class="n">data</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])])</span>
</span><span id="SeismicVolume-267"><a href="#-267"><span class="linenos"> 267</span></a>        <span class="k">elif</span> <span class="n">data</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="SeismicVolume-268"><a href="#-268"><span class="linenos"> 268</span></a>            <span class="n">avg_stdev</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
</span><span id="SeismicVolume-269"><a href="#-269"><span class="linenos"> 269</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SeismicVolume-270"><a href="#-270"><span class="linenos"> 270</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="SeismicVolume-271"><a href="#-271"><span class="linenos"> 271</span></a>                <span class="sa">f</span><span class="s2">&quot;Input Data has </span><span class="si">{</span><span class="n">data</span><span class="o">.</span><span class="n">ndim</span><span class="si">}</span><span class="s2"> dimensions, should have 3 or 4 dimensions&quot;</span>
</span><span id="SeismicVolume-272"><a href="#-272"><span class="linenos"> 272</span></a>            <span class="p">)</span>
</span><span id="SeismicVolume-273"><a href="#-273"><span class="linenos"> 273</span></a>        <span class="n">scaled_data</span> <span class="o">=</span> <span class="n">data</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">/</span> <span class="n">avg_stdev</span>
</span><span id="SeismicVolume-274"><a href="#-274"><span class="linenos"> 274</span></a>        <span class="k">return</span> <span class="n">scaled_data</span>
</span><span id="SeismicVolume-275"><a href="#-275"><span class="linenos"> 275</span></a>
</span><span id="SeismicVolume-276"><a href="#-276"><span class="linenos"> 276</span></a>    <span class="k">def</span> <span class="nf">write_final_cubes_to_disk</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dat</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
</span><span id="SeismicVolume-277"><a href="#-277"><span class="linenos"> 277</span></a>        <span class="n">scaled_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scale_seismic</span><span class="p">(</span><span class="n">dat</span><span class="p">)</span>
</span><span id="SeismicVolume-278"><a href="#-278"><span class="linenos"> 278</span></a>
</span><span id="SeismicVolume-279"><a href="#-279"><span class="linenos"> 279</span></a>        <span class="c1"># Apply scaling factors to N, M, F cubes from csv file before determining clip limits</span>
</span><span id="SeismicVolume-280"><a href="#-280"><span class="linenos"> 280</span></a>        <span class="n">factor_near</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">rpm_scaling_factors</span><span class="p">[</span><span class="s2">&quot;nearfactor&quot;</span><span class="p">]</span>
</span><span id="SeismicVolume-281"><a href="#-281"><span class="linenos"> 281</span></a>        <span class="n">factor_mid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">rpm_scaling_factors</span><span class="p">[</span><span class="s2">&quot;midfactor&quot;</span><span class="p">]</span>
</span><span id="SeismicVolume-282"><a href="#-282"><span class="linenos"> 282</span></a>        <span class="n">factor_far</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">rpm_scaling_factors</span><span class="p">[</span><span class="s2">&quot;farfactor&quot;</span><span class="p">]</span>
</span><span id="SeismicVolume-283"><a href="#-283"><span class="linenos"> 283</span></a>        <span class="n">cube_incr</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="SeismicVolume-284"><a href="#-284"><span class="linenos"> 284</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">model_qc_volumes</span> <span class="ow">and</span> <span class="n">dat</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="SeismicVolume-285"><a href="#-285"><span class="linenos"> 285</span></a>            <span class="c1"># 0 degrees has been added at start, and 45 at end</span>
</span><span id="SeismicVolume-286"><a href="#-286"><span class="linenos"> 286</span></a>            <span class="n">cube_incr</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="SeismicVolume-287"><a href="#-287"><span class="linenos"> 287</span></a>        <span class="n">scaled_data</span><span class="p">[</span><span class="mi">0</span> <span class="o">+</span> <span class="n">cube_incr</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">*=</span> <span class="n">factor_near</span>
</span><span id="SeismicVolume-288"><a href="#-288"><span class="linenos"> 288</span></a>        <span class="n">scaled_data</span><span class="p">[</span><span class="mi">1</span> <span class="o">+</span> <span class="n">cube_incr</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">*=</span> <span class="n">factor_mid</span>
</span><span id="SeismicVolume-289"><a href="#-289"><span class="linenos"> 289</span></a>        <span class="n">scaled_data</span><span class="p">[</span><span class="mi">2</span> <span class="o">+</span> <span class="n">cube_incr</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">*=</span> <span class="n">factor_far</span>
</span><span id="SeismicVolume-290"><a href="#-290"><span class="linenos"> 290</span></a>
</span><span id="SeismicVolume-291"><a href="#-291"><span class="linenos"> 291</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ang</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">incident_angles</span><span class="p">):</span>
</span><span id="SeismicVolume-292"><a href="#-292"><span class="linenos"> 292</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="n">scaled_data</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
</span><span id="SeismicVolume-293"><a href="#-293"><span class="linenos"> 293</span></a>            <span class="n">fname</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">ang</span><span class="si">}</span><span class="s2">_degrees&quot;</span>
</span><span id="SeismicVolume-294"><a href="#-294"><span class="linenos"> 294</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">write_cube_to_disk</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">fname</span><span class="p">)</span>
</span><span id="SeismicVolume-295"><a href="#-295"><span class="linenos"> 295</span></a>        <span class="n">normed_data</span> <span class="o">=</span> <span class="n">normalize_seismic</span><span class="p">(</span><span class="n">scaled_data</span><span class="p">)</span>
</span><span id="SeismicVolume-296"><a href="#-296"><span class="linenos"> 296</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ang</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">incident_angles</span><span class="p">):</span>
</span><span id="SeismicVolume-297"><a href="#-297"><span class="linenos"> 297</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="n">normed_data</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
</span><span id="SeismicVolume-298"><a href="#-298"><span class="linenos"> 298</span></a>            <span class="n">fname</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">ang</span><span class="si">}</span><span class="s2">_degrees_normalized&quot;</span>
</span><span id="SeismicVolume-299"><a href="#-299"><span class="linenos"> 299</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">write_cube_to_disk</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">fname</span><span class="p">)</span>
</span><span id="SeismicVolume-300"><a href="#-300"><span class="linenos"> 300</span></a>        <span class="k">return</span> <span class="n">normed_data</span>
</span><span id="SeismicVolume-301"><a href="#-301"><span class="linenos"> 301</span></a>
</span><span id="SeismicVolume-302"><a href="#-302"><span class="linenos"> 302</span></a>    <span class="nd">@staticmethod</span>
</span><span id="SeismicVolume-303"><a href="#-303"><span class="linenos"> 303</span></a>    <span class="k">def</span> <span class="nf">random_z_rho_vp_vs</span><span class="p">(</span><span class="n">dmin</span><span class="o">=-</span><span class="mi">7</span><span class="p">,</span> <span class="n">dmax</span><span class="o">=</span><span class="mi">7</span><span class="p">):</span>
</span><span id="SeismicVolume-304"><a href="#-304"><span class="linenos"> 304</span></a>        <span class="n">delta_z_rho</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">dmin</span><span class="p">,</span> <span class="n">dmax</span><span class="p">))</span>
</span><span id="SeismicVolume-305"><a href="#-305"><span class="linenos"> 305</span></a>        <span class="n">delta_z_vp</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">dmin</span><span class="p">,</span> <span class="n">dmax</span><span class="p">))</span>
</span><span id="SeismicVolume-306"><a href="#-306"><span class="linenos"> 306</span></a>        <span class="n">delta_z_vs</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">dmin</span><span class="p">,</span> <span class="n">dmax</span><span class="p">))</span>
</span><span id="SeismicVolume-307"><a href="#-307"><span class="linenos"> 307</span></a>        <span class="k">return</span> <span class="n">delta_z_rho</span><span class="p">,</span> <span class="n">delta_z_vp</span><span class="p">,</span> <span class="n">delta_z_vs</span>
</span><span id="SeismicVolume-308"><a href="#-308"><span class="linenos"> 308</span></a>
</span><span id="SeismicVolume-309"><a href="#-309"><span class="linenos"> 309</span></a>    <span class="k">def</span> <span class="nf">create_rfc_volumes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="SeismicVolume-310"><a href="#-310"><span class="linenos"> 310</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="SeismicVolume-311"><a href="#-311"><span class="linenos"> 311</span></a><span class="sd">        Build a 3D array of PP-Reflectivity using Zoeppritz for each incident angle given.</span>
</span><span id="SeismicVolume-312"><a href="#-312"><span class="linenos"> 312</span></a>
</span><span id="SeismicVolume-313"><a href="#-313"><span class="linenos"> 313</span></a><span class="sd">        :return: 4D array of PP-Reflectivity. 4th dimension holds reflectivities of each incident angle provided</span>
</span><span id="SeismicVolume-314"><a href="#-314"><span class="linenos"> 314</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SeismicVolume-315"><a href="#-315"><span class="linenos"> 315</span></a>        <span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asanyarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">angles</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span>
</span><span id="SeismicVolume-316"><a href="#-316"><span class="linenos"> 316</span></a>            <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="SeismicVolume-317"><a href="#-317"><span class="linenos"> 317</span></a>        <span class="p">)</span>  <span class="c1"># Convert angles into a column vector</span>
</span><span id="SeismicVolume-318"><a href="#-318"><span class="linenos"> 318</span></a>
</span><span id="SeismicVolume-319"><a href="#-319"><span class="linenos"> 319</span></a>        <span class="c1"># Make empty array to store RPP via zoeppritz</span>
</span><span id="SeismicVolume-320"><a href="#-320"><span class="linenos"> 320</span></a>        <span class="n">zoep</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span>
</span><span id="SeismicVolume-321"><a href="#-321"><span class="linenos"> 321</span></a>            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">rho</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">rho</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">theta</span><span class="o">.</span><span class="n">size</span><span class="p">),</span>
</span><span id="SeismicVolume-322"><a href="#-322"><span class="linenos"> 322</span></a>            <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;complex64&quot;</span><span class="p">,</span>
</span><span id="SeismicVolume-323"><a href="#-323"><span class="linenos"> 323</span></a>        <span class="p">)</span>
</span><span id="SeismicVolume-324"><a href="#-324"><span class="linenos"> 324</span></a>
</span><span id="SeismicVolume-325"><a href="#-325"><span class="linenos"> 325</span></a>        <span class="n">_rho</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rho</span><span class="p">[:]</span>
</span><span id="SeismicVolume-326"><a href="#-326"><span class="linenos"> 326</span></a>        <span class="n">_vp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vp</span><span class="p">[:]</span>
</span><span id="SeismicVolume-327"><a href="#-327"><span class="linenos"> 327</span></a>        <span class="n">_vs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vs</span><span class="p">[:]</span>
</span><span id="SeismicVolume-328"><a href="#-328"><span class="linenos"> 328</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="SeismicVolume-329"><a href="#-329"><span class="linenos"> 329</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Checking for null values inside create_rfc_volumes:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="SeismicVolume-330"><a href="#-330"><span class="linenos"> 330</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Rho: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">_rho</span><span class="p">)</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">_rho</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="SeismicVolume-331"><a href="#-331"><span class="linenos"> 331</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Vp: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">_vp</span><span class="p">)</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">_vp</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="SeismicVolume-332"><a href="#-332"><span class="linenos"> 332</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Vs: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">_vs</span><span class="p">)</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">_vs</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="SeismicVolume-333"><a href="#-333"><span class="linenos"> 333</span></a>        <span class="c1"># Doing this for each trace &amp; all (5) angles is actually quicker than doing entire cubes for each angle</span>
</span><span id="SeismicVolume-334"><a href="#-334"><span class="linenos"> 334</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">trange</span><span class="p">(</span>
</span><span id="SeismicVolume-335"><a href="#-335"><span class="linenos"> 335</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">rho</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
</span><span id="SeismicVolume-336"><a href="#-336"><span class="linenos"> 336</span></a>            <span class="n">desc</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Calculating Zoeppritz for </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">angles</span><span class="p">)</span><span class="si">}</span><span class="s2"> angles&quot;</span><span class="p">,</span>
</span><span id="SeismicVolume-337"><a href="#-337"><span class="linenos"> 337</span></a>        <span class="p">):</span>
</span><span id="SeismicVolume-338"><a href="#-338"><span class="linenos"> 338</span></a>            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
</span><span id="SeismicVolume-339"><a href="#-339"><span class="linenos"> 339</span></a>                <span class="n">rho1</span><span class="p">,</span> <span class="n">rho2</span> <span class="o">=</span> <span class="n">_rho</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">_rho</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="mi">1</span><span class="p">:]</span>
</span><span id="SeismicVolume-340"><a href="#-340"><span class="linenos"> 340</span></a>                <span class="n">vp1</span><span class="p">,</span> <span class="n">vp2</span> <span class="o">=</span> <span class="n">_vp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">_vp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="mi">1</span><span class="p">:]</span>
</span><span id="SeismicVolume-341"><a href="#-341"><span class="linenos"> 341</span></a>                <span class="n">vs1</span><span class="p">,</span> <span class="n">vs2</span> <span class="o">=</span> <span class="n">_vs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">_vs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="mi">1</span><span class="p">:]</span>
</span><span id="SeismicVolume-342"><a href="#-342"><span class="linenos"> 342</span></a>                <span class="n">rfc</span> <span class="o">=</span> <span class="n">RFC</span><span class="p">(</span><span class="n">vp1</span><span class="p">,</span> <span class="n">vs1</span><span class="p">,</span> <span class="n">rho1</span><span class="p">,</span> <span class="n">vp2</span><span class="p">,</span> <span class="n">vs2</span><span class="p">,</span> <span class="n">rho2</span><span class="p">,</span> <span class="n">theta</span><span class="p">)</span>
</span><span id="SeismicVolume-343"><a href="#-343"><span class="linenos"> 343</span></a>                <span class="n">zoep</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">rfc</span><span class="o">.</span><span class="n">zoeppritz_reflectivity</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
</span><span id="SeismicVolume-344"><a href="#-344"><span class="linenos"> 344</span></a>        <span class="c1"># Set any voxels with imaginary parts to 0, since all transmitted energy travels along the reflector</span>
</span><span id="SeismicVolume-345"><a href="#-345"><span class="linenos"> 345</span></a>        <span class="c1"># zoep[np.where(np.imag(zoep) != 0)] = 0</span>
</span><span id="SeismicVolume-346"><a href="#-346"><span class="linenos"> 346</span></a>        <span class="c1"># discard complex values and set dtype to float64</span>
</span><span id="SeismicVolume-347"><a href="#-347"><span class="linenos"> 347</span></a>        <span class="n">zoep</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">zoep</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;float64&quot;</span><span class="p">)</span>
</span><span id="SeismicVolume-348"><a href="#-348"><span class="linenos"> 348</span></a>        <span class="k">del</span> <span class="n">_rho</span><span class="p">,</span> <span class="n">_vp</span><span class="p">,</span> <span class="n">_vs</span>
</span><span id="SeismicVolume-349"><a href="#-349"><span class="linenos"> 349</span></a>
</span><span id="SeismicVolume-350"><a href="#-350"><span class="linenos"> 350</span></a>        <span class="c1"># Move the angle from last dimension to first</span>
</span><span id="SeismicVolume-351"><a href="#-351"><span class="linenos"> 351</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">rfc_raw</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">moveaxis</span><span class="p">(</span><span class="n">zoep</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="SeismicVolume-352"><a href="#-352"><span class="linenos"> 352</span></a>
</span><span id="SeismicVolume-353"><a href="#-353"><span class="linenos"> 353</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_store</span><span class="p">:</span>
</span><span id="SeismicVolume-354"><a href="#-354"><span class="linenos"> 354</span></a>            <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
</span><span id="SeismicVolume-355"><a href="#-355"><span class="linenos"> 355</span></a>                <span class="p">[</span>
</span><span id="SeismicVolume-356"><a href="#-356"><span class="linenos"> 356</span></a>                    <span class="s2">&quot;qc_volume_rfc_raw_</span><span class="si">{}</span><span class="s2">_degrees&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="SeismicVolume-357"><a href="#-357"><span class="linenos"> 357</span></a>                        <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">angles</span><span class="p">[</span><span class="n">x</span><span class="p">])</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span>
</span><span id="SeismicVolume-358"><a href="#-358"><span class="linenos"> 358</span></a>                    <span class="p">)</span>
</span><span id="SeismicVolume-359"><a href="#-359"><span class="linenos"> 359</span></a>                    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rfc_raw</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="SeismicVolume-360"><a href="#-360"><span class="linenos"> 360</span></a>                <span class="p">],</span>
</span><span id="SeismicVolume-361"><a href="#-361"><span class="linenos"> 361</span></a>                <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">rfc_raw</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rfc_raw</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])],</span>
</span><span id="SeismicVolume-362"><a href="#-362"><span class="linenos"> 362</span></a>            <span class="p">):</span>
</span><span id="SeismicVolume-363"><a href="#-363"><span class="linenos"> 363</span></a>                <span class="n">write_data_to_hdf</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_master</span><span class="p">)</span>
</span><span id="SeismicVolume-364"><a href="#-364"><span class="linenos"> 364</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">model_qc_volumes</span><span class="p">:</span>
</span><span id="SeismicVolume-365"><a href="#-365"><span class="linenos"> 365</span></a>            <span class="c1"># Write raw RFC values to disk</span>
</span><span id="SeismicVolume-366"><a href="#-366"><span class="linenos"> 366</span></a>            <span class="n">_</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="SeismicVolume-367"><a href="#-367"><span class="linenos"> 367</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">write_cube_to_disk</span><span class="p">(</span>
</span><span id="SeismicVolume-368"><a href="#-368"><span class="linenos"> 368</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">rfc_raw</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span>
</span><span id="SeismicVolume-369"><a href="#-369"><span class="linenos"> 369</span></a>                    <span class="sa">f</span><span class="s2">&quot;qc_volume_rfc_raw_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">angles</span><span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="si">}</span><span class="s2">_degrees&quot;</span><span class="p">,</span>
</span><span id="SeismicVolume-370"><a href="#-370"><span class="linenos"> 370</span></a>                <span class="p">)</span>
</span><span id="SeismicVolume-371"><a href="#-371"><span class="linenos"> 371</span></a>                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rfc_raw</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="SeismicVolume-372"><a href="#-372"><span class="linenos"> 372</span></a>            <span class="p">]</span>
</span><span id="SeismicVolume-373"><a href="#-373"><span class="linenos"> 373</span></a>            <span class="n">max_amp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rfc_raw</span><span class="p">[:]))</span>
</span><span id="SeismicVolume-374"><a href="#-374"><span class="linenos"> 374</span></a>            <span class="n">_</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="SeismicVolume-375"><a href="#-375"><span class="linenos"> 375</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">write_cube_to_disk</span><span class="p">(</span>
</span><span id="SeismicVolume-376"><a href="#-376"><span class="linenos"> 376</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">rfc_raw</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span>
</span><span id="SeismicVolume-377"><a href="#-377"><span class="linenos"> 377</span></a>                    <span class="sa">f</span><span class="s2">&quot;qc_volume_rfc_raw_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">angles</span><span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="si">}</span><span class="s2">_degrees&quot;</span><span class="p">,</span>
</span><span id="SeismicVolume-378"><a href="#-378"><span class="linenos"> 378</span></a>                <span class="p">)</span>
</span><span id="SeismicVolume-379"><a href="#-379"><span class="linenos"> 379</span></a>                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rfc_raw</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="SeismicVolume-380"><a href="#-380"><span class="linenos"> 380</span></a>            <span class="p">]</span>
</span><span id="SeismicVolume-381"><a href="#-381"><span class="linenos"> 381</span></a>
</span><span id="SeismicVolume-382"><a href="#-382"><span class="linenos"> 382</span></a>    <span class="k">def</span> <span class="nf">noise_3d</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cube_shape</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="SeismicVolume-383"><a href="#-383"><span class="linenos"> 383</span></a>        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="SeismicVolume-384"><a href="#-384"><span class="linenos"> 384</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   ... inside noise3D&quot;</span><span class="p">)</span>
</span><span id="SeismicVolume-385"><a href="#-385"><span class="linenos"> 385</span></a>
</span><span id="SeismicVolume-386"><a href="#-386"><span class="linenos"> 386</span></a>        <span class="n">noise_seed</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="mi">2</span> <span class="o">**</span> <span class="mi">32</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="SeismicVolume-387"><a href="#-387"><span class="linenos"> 387</span></a>        <span class="n">sign_seed</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="mi">2</span> <span class="o">**</span> <span class="mi">32</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="SeismicVolume-388"><a href="#-388"><span class="linenos"> 388</span></a>
</span><span id="SeismicVolume-389"><a href="#-389"><span class="linenos"> 389</span></a>        <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">noise_seed</span><span class="p">)</span>
</span><span id="SeismicVolume-390"><a href="#-390"><span class="linenos"> 390</span></a>        <span class="n">noise3d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">exponential</span><span class="p">(</span>
</span><span id="SeismicVolume-391"><a href="#-391"><span class="linenos"> 391</span></a>            <span class="mf">1.0</span> <span class="o">/</span> <span class="mf">100.0</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">cube_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">cube_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
</span><span id="SeismicVolume-392"><a href="#-392"><span class="linenos"> 392</span></a>        <span class="p">)</span>
</span><span id="SeismicVolume-393"><a href="#-393"><span class="linenos"> 393</span></a>        <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">sign_seed</span><span class="p">)</span>
</span><span id="SeismicVolume-394"><a href="#-394"><span class="linenos"> 394</span></a>        <span class="n">sign</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">binomial</span><span class="p">(</span>
</span><span id="SeismicVolume-395"><a href="#-395"><span class="linenos"> 395</span></a>            <span class="mi">1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">cube_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">cube_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
</span><span id="SeismicVolume-396"><a href="#-396"><span class="linenos"> 396</span></a>        <span class="p">)</span>
</span><span id="SeismicVolume-397"><a href="#-397"><span class="linenos"> 397</span></a>
</span><span id="SeismicVolume-398"><a href="#-398"><span class="linenos"> 398</span></a>        <span class="n">sign</span><span class="p">[</span><span class="n">sign</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
</span><span id="SeismicVolume-399"><a href="#-399"><span class="linenos"> 399</span></a>        <span class="n">noise3d</span> <span class="o">*=</span> <span class="n">sign</span>
</span><span id="SeismicVolume-400"><a href="#-400"><span class="linenos"> 400</span></a>        <span class="n">noise3d</span> <span class="o">=</span> <span class="n">noise3d</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cube_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">cube_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
</span><span id="SeismicVolume-401"><a href="#-401"><span class="linenos"> 401</span></a>        <span class="k">return</span> <span class="n">noise3d</span>
</span><span id="SeismicVolume-402"><a href="#-402"><span class="linenos"> 402</span></a>
</span><span id="SeismicVolume-403"><a href="#-403"><span class="linenos"> 403</span></a>    <span class="k">def</span> <span class="nf">add_weighted_noise</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">depth_maps</span><span class="p">):</span>
</span><span id="SeismicVolume-404"><a href="#-404"><span class="linenos"> 404</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="SeismicVolume-405"><a href="#-405"><span class="linenos"> 405</span></a><span class="sd">        Apply 3D weighted random noise to ndarray.</span>
</span><span id="SeismicVolume-406"><a href="#-406"><span class="linenos"> 406</span></a>
</span><span id="SeismicVolume-407"><a href="#-407"><span class="linenos"> 407</span></a><span class="sd">        :return: Sum of rfc_volumes and 3D noise model, weighted by angle</span>
</span><span id="SeismicVolume-408"><a href="#-408"><span class="linenos"> 408</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SeismicVolume-409"><a href="#-409"><span class="linenos"> 409</span></a>
</span><span id="SeismicVolume-410"><a href="#-410"><span class="linenos"> 410</span></a>        <span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">sin</span><span class="p">,</span> <span class="n">cos</span>
</span><span id="SeismicVolume-411"><a href="#-411"><span class="linenos"> 411</span></a>        <span class="kn">from</span> <span class="nn">datagenerator.util</span> <span class="kn">import</span> <span class="n">mute_above_seafloor</span>
</span><span id="SeismicVolume-412"><a href="#-412"><span class="linenos"> 412</span></a>        <span class="kn">from</span> <span class="nn">datagenerator.util</span> <span class="kn">import</span> <span class="n">infill_surface</span>
</span><span id="SeismicVolume-413"><a href="#-413"><span class="linenos"> 413</span></a>
</span><span id="SeismicVolume-414"><a href="#-414"><span class="linenos"> 414</span></a>        <span class="c1"># Calculate standard deviation ratio to use based on user-input sn_db parameter</span>
</span><span id="SeismicVolume-415"><a href="#-415"><span class="linenos"> 415</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="SeismicVolume-416"><a href="#-416"><span class="linenos"> 416</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">...adding random noise to </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">rfc_raw</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> cubes...&quot;</span><span class="p">)</span>
</span><span id="SeismicVolume-417"><a href="#-417"><span class="linenos"> 417</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;S/N ratio = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">sn_db</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="SeismicVolume-418"><a href="#-418"><span class="linenos"> 418</span></a>        <span class="n">std_ratio</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">10</span> <span class="o">**</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">sn_db</span> <span class="o">/</span> <span class="mf">10.0</span><span class="p">))</span>
</span><span id="SeismicVolume-419"><a href="#-419"><span class="linenos"> 419</span></a>
</span><span id="SeismicVolume-420"><a href="#-420"><span class="linenos"> 420</span></a>        <span class="c1"># Compute standard deviation in bottom half of cube, and use this to scale the noise</span>
</span><span id="SeismicVolume-421"><a href="#-421"><span class="linenos"> 421</span></a>        <span class="c1"># if wb has holes (i.e. Nan or 0 values), fill holes using replacement with interpolated (NN) values</span>
</span><span id="SeismicVolume-422"><a href="#-422"><span class="linenos"> 422</span></a>        <span class="n">wb_map</span> <span class="o">=</span> <span class="n">depth_maps</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
</span><span id="SeismicVolume-423"><a href="#-423"><span class="linenos"> 423</span></a>        <span class="c1"># Add test for all 0&#39;s in wb_map in case z_shift has been applied</span>
</span><span id="SeismicVolume-424"><a href="#-424"><span class="linenos"> 424</span></a>        <span class="k">if</span> <span class="p">(</span>
</span><span id="SeismicVolume-425"><a href="#-425"><span class="linenos"> 425</span></a>            <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">wb_map</span><span class="p">))</span> <span class="ow">or</span> <span class="mi">0</span> <span class="ow">in</span> <span class="n">wb_map</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">wb_map</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="SeismicVolume-426"><a href="#-426"><span class="linenos"> 426</span></a>        <span class="p">):</span>  <span class="c1"># If wb contains nan&#39;s or at least one 0, this will return True</span>
</span><span id="SeismicVolume-427"><a href="#-427"><span class="linenos"> 427</span></a>            <span class="n">wb_map</span> <span class="o">=</span> <span class="n">infill_surface</span><span class="p">(</span><span class="n">wb_map</span><span class="p">)</span>
</span><span id="SeismicVolume-428"><a href="#-428"><span class="linenos"> 428</span></a>        <span class="n">wb_plus_15samples</span> <span class="o">=</span> <span class="n">wb_map</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">digi</span> <span class="o">+</span> <span class="mi">15</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">digi</span>
</span><span id="SeismicVolume-429"><a href="#-429"><span class="linenos"> 429</span></a>
</span><span id="SeismicVolume-430"><a href="#-430"><span class="linenos"> 430</span></a>        <span class="c1"># Use the Middle angle cube for normalisation</span>
</span><span id="SeismicVolume-431"><a href="#-431"><span class="linenos"> 431</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">model_qc_volumes</span><span class="p">:</span>
</span><span id="SeismicVolume-432"><a href="#-432"><span class="linenos"> 432</span></a>            <span class="c1"># 0 and 45 degree cubes have been added</span>
</span><span id="SeismicVolume-433"><a href="#-433"><span class="linenos"> 433</span></a>            <span class="n">norm_cube</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rfc_raw</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
</span><span id="SeismicVolume-434"><a href="#-434"><span class="linenos"> 434</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SeismicVolume-435"><a href="#-435"><span class="linenos"> 435</span></a>            <span class="n">norm_cube</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rfc_raw</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
</span><span id="SeismicVolume-436"><a href="#-436"><span class="linenos"> 436</span></a>        <span class="n">data_below_seafloor</span> <span class="o">=</span> <span class="n">norm_cube</span><span class="p">[</span>
</span><span id="SeismicVolume-437"><a href="#-437"><span class="linenos"> 437</span></a>            <span class="n">mute_above_seafloor</span><span class="p">(</span><span class="n">wb_plus_15samples</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">norm_cube</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="s2">&quot;float&quot;</span><span class="p">))</span>
</span><span id="SeismicVolume-438"><a href="#-438"><span class="linenos"> 438</span></a>            <span class="o">!=</span> <span class="mf">0.0</span>
</span><span id="SeismicVolume-439"><a href="#-439"><span class="linenos"> 439</span></a>        <span class="p">]</span>
</span><span id="SeismicVolume-440"><a href="#-440"><span class="linenos"> 440</span></a>        <span class="n">data_std</span> <span class="o">=</span> <span class="n">data_below_seafloor</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
</span><span id="SeismicVolume-441"><a href="#-441"><span class="linenos"> 441</span></a>
</span><span id="SeismicVolume-442"><a href="#-442"><span class="linenos"> 442</span></a>        <span class="c1"># Create array to store the 3D noise model for each angle</span>
</span><span id="SeismicVolume-443"><a href="#-443"><span class="linenos"> 443</span></a>        <span class="n">noise3d_cubes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rfc_raw</span><span class="p">[:])</span>
</span><span id="SeismicVolume-444"><a href="#-444"><span class="linenos"> 444</span></a>
</span><span id="SeismicVolume-445"><a href="#-445"><span class="linenos"> 445</span></a>        <span class="c1"># Add weighted stack of noise using Hilterman equation to each angle substack</span>
</span><span id="SeismicVolume-446"><a href="#-446"><span class="linenos"> 446</span></a>        <span class="n">noise_0deg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">noise_3d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rfc_raw</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="SeismicVolume-447"><a href="#-447"><span class="linenos"> 447</span></a>        <span class="n">noise_45deg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">noise_3d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rfc_raw</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="SeismicVolume-448"><a href="#-448"><span class="linenos"> 448</span></a>        <span class="c1"># Store the noise models</span>
</span><span id="SeismicVolume-449"><a href="#-449"><span class="linenos"> 449</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">noise_0deg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span><span class="s2">&quot;noise_0deg&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">noise_0deg</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span><span id="SeismicVolume-450"><a href="#-450"><span class="linenos"> 450</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">noise_45deg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span><span class="s2">&quot;noise_45deg&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">noise_45deg</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span><span id="SeismicVolume-451"><a href="#-451"><span class="linenos"> 451</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">noise_0deg</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">noise_0deg</span>
</span><span id="SeismicVolume-452"><a href="#-452"><span class="linenos"> 452</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">noise_45deg</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">noise_45deg</span>
</span><span id="SeismicVolume-453"><a href="#-453"><span class="linenos"> 453</span></a>
</span><span id="SeismicVolume-454"><a href="#-454"><span class="linenos"> 454</span></a>        <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">ang</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">angles</span><span class="p">):</span>
</span><span id="SeismicVolume-455"><a href="#-455"><span class="linenos"> 455</span></a>            <span class="n">weighted_noise</span> <span class="o">=</span> <span class="n">noise_0deg</span> <span class="o">*</span> <span class="p">(</span><span class="n">cos</span><span class="p">(</span><span class="n">ang</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">noise_45deg</span> <span class="o">*</span> <span class="p">(</span>
</span><span id="SeismicVolume-456"><a href="#-456"><span class="linenos"> 456</span></a>                <span class="n">sin</span><span class="p">(</span><span class="n">ang</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
</span><span id="SeismicVolume-457"><a href="#-457"><span class="linenos"> 457</span></a>            <span class="p">)</span>
</span><span id="SeismicVolume-458"><a href="#-458"><span class="linenos"> 458</span></a>            <span class="n">noise_std</span> <span class="o">=</span> <span class="n">weighted_noise</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
</span><span id="SeismicVolume-459"><a href="#-459"><span class="linenos"> 459</span></a>            <span class="n">noise3d_cubes</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">weighted_noise</span> <span class="o">*</span> <span class="p">(</span><span class="n">data_std</span> <span class="o">/</span> <span class="n">noise_std</span><span class="p">)</span> <span class="o">/</span> <span class="n">std_ratio</span>
</span><span id="SeismicVolume-460"><a href="#-460"><span class="linenos"> 460</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="SeismicVolume-461"><a href="#-461"><span class="linenos"> 461</span></a>                <span class="nb">print</span><span class="p">(</span>
</span><span id="SeismicVolume-462"><a href="#-462"><span class="linenos"> 462</span></a>                    <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">...Normalised noise3d for angle </span><span class="si">{</span><span class="n">ang</span><span class="si">}</span><span class="s2">:</span><span class="se">\t</span><span class="s2">Min: </span><span class="si">{</span><span class="n">noise3d_cubes</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">,&quot;</span>
</span><span id="SeismicVolume-463"><a href="#-463"><span class="linenos"> 463</span></a>                    <span class="sa">f</span><span class="s2">&quot; mean: </span><span class="si">{</span><span class="n">noise3d_cubes</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">, max: </span><span class="si">{</span><span class="n">noise3d_cubes</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">,&quot;</span>
</span><span id="SeismicVolume-464"><a href="#-464"><span class="linenos"> 464</span></a>                    <span class="sa">f</span><span class="s2">&quot; std: </span><span class="si">{</span><span class="n">noise3d_cubes</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="SeismicVolume-465"><a href="#-465"><span class="linenos"> 465</span></a>                <span class="p">)</span>
</span><span id="SeismicVolume-466"><a href="#-466"><span class="linenos"> 466</span></a>                <span class="nb">print</span><span class="p">(</span>
</span><span id="SeismicVolume-467"><a href="#-467"><span class="linenos"> 467</span></a>                    <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">S/N ratio = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">sn_db</span><span class="si">:</span><span class="s2">3.1f</span><span class="si">}</span><span class="s2"> dB.</span><span class="se">\n\t</span><span class="s2">std_ratio = </span><span class="si">{</span><span class="n">std_ratio</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="SeismicVolume-468"><a href="#-468"><span class="linenos"> 468</span></a>                    <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n\t</span><span class="s2">data_std = </span><span class="si">{</span><span class="n">data_std</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="se">\n\t</span><span class="s2">noise_std = </span><span class="si">{</span><span class="n">noise_std</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="SeismicVolume-469"><a href="#-469"><span class="linenos"> 469</span></a>                <span class="p">)</span>
</span><span id="SeismicVolume-470"><a href="#-470"><span class="linenos"> 470</span></a>
</span><span id="SeismicVolume-471"><a href="#-471"><span class="linenos"> 471</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">rfc_noise_added</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">noise3d_cubes</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">rfc_raw</span><span class="p">[:]</span>
</span><span id="SeismicVolume-472"><a href="#-472"><span class="linenos"> 472</span></a>
</span><span id="SeismicVolume-473"><a href="#-473"><span class="linenos"> 473</span></a>    <span class="k">def</span> <span class="nf">apply_bandlimits</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">frequencies</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="SeismicVolume-474"><a href="#-474"><span class="linenos"> 474</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="SeismicVolume-475"><a href="#-475"><span class="linenos"> 475</span></a><span class="sd">        Apply Butterworth Bandpass Filter to data</span>
</span><span id="SeismicVolume-476"><a href="#-476"><span class="linenos"> 476</span></a><span class="sd">        :param data: 4D array of RFC values</span>
</span><span id="SeismicVolume-477"><a href="#-477"><span class="linenos"> 477</span></a><span class="sd">        :param frequencies: Explicit frequency bounds (lower, upper)</span>
</span><span id="SeismicVolume-478"><a href="#-478"><span class="linenos"> 478</span></a><span class="sd">        :return: 4D array of band-limited RFC</span>
</span><span id="SeismicVolume-479"><a href="#-479"><span class="linenos"> 479</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SeismicVolume-480"><a href="#-480"><span class="linenos"> 480</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="SeismicVolume-481"><a href="#-481"><span class="linenos"> 481</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Data Min: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, Data Max: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="SeismicVolume-482"><a href="#-482"><span class="linenos"> 482</span></a>        <span class="n">dt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">digi</span> <span class="o">/</span> <span class="mf">1000.0</span>
</span><span id="SeismicVolume-483"><a href="#-483"><span class="linenos"> 483</span></a>        <span class="k">if</span> <span class="p">(</span>
</span><span id="SeismicVolume-484"><a href="#-484"><span class="linenos"> 484</span></a>            <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">infill_factor</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">pad_samples</span>
</span><span id="SeismicVolume-485"><a href="#-485"><span class="linenos"> 485</span></a>            <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="SeismicVolume-486"><a href="#-486"><span class="linenos"> 486</span></a>        <span class="p">):</span>
</span><span id="SeismicVolume-487"><a href="#-487"><span class="linenos"> 487</span></a>            <span class="c1"># Input data is infilled</span>
</span><span id="SeismicVolume-488"><a href="#-488"><span class="linenos"> 488</span></a>            <span class="n">dt</span> <span class="o">/=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">infill_factor</span>
</span><span id="SeismicVolume-489"><a href="#-489"><span class="linenos"> 489</span></a>        <span class="k">if</span> <span class="n">frequencies</span><span class="p">:</span>  <span class="c1"># if frequencies explicitly defined</span>
</span><span id="SeismicVolume-490"><a href="#-490"><span class="linenos"> 490</span></a>            <span class="n">low</span> <span class="o">=</span> <span class="n">frequencies</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="SeismicVolume-491"><a href="#-491"><span class="linenos"> 491</span></a>            <span class="n">high</span> <span class="o">=</span> <span class="n">frequencies</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="SeismicVolume-492"><a href="#-492"><span class="linenos"> 492</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SeismicVolume-493"><a href="#-493"><span class="linenos"> 493</span></a>            <span class="n">low</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">lowfreq</span>
</span><span id="SeismicVolume-494"><a href="#-494"><span class="linenos"> 494</span></a>            <span class="n">high</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">highfreq</span>
</span><span id="SeismicVolume-495"><a href="#-495"><span class="linenos"> 495</span></a>        <span class="n">b</span><span class="p">,</span> <span class="n">a</span> <span class="o">=</span> <span class="n">derive_butterworth_bandpass</span><span class="p">(</span>
</span><span id="SeismicVolume-496"><a href="#-496"><span class="linenos"> 496</span></a>            <span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="p">,</span> <span class="p">(</span><span class="n">dt</span> <span class="o">*</span> <span class="mf">1000.0</span><span class="p">),</span> <span class="n">order</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">order</span>
</span><span id="SeismicVolume-497"><a href="#-497"><span class="linenos"> 497</span></a>        <span class="p">)</span>
</span><span id="SeismicVolume-498"><a href="#-498"><span class="linenos"> 498</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="SeismicVolume-499"><a href="#-499"><span class="linenos"> 499</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">... Low Frequency; </span><span class="si">{</span><span class="n">low</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> Hz, High Frequency: </span><span class="si">{</span><span class="n">high</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> Hz&quot;</span><span class="p">)</span>
</span><span id="SeismicVolume-500"><a href="#-500"><span class="linenos"> 500</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="SeismicVolume-501"><a href="#-501"><span class="linenos"> 501</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">... start_width: </span><span class="si">{</span><span class="mf">1.</span> <span class="o">/</span> <span class="p">(</span><span class="n">dt</span> <span class="o">*</span> <span class="n">low</span><span class="p">)</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">, end_width: </span><span class="si">{</span><span class="mf">1.</span> <span class="o">/</span> <span class="p">(</span><span class="n">dt</span> <span class="o">*</span> <span class="n">high</span><span class="p">)</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="SeismicVolume-502"><a href="#-502"><span class="linenos"> 502</span></a>            <span class="p">)</span>
</span><span id="SeismicVolume-503"><a href="#-503"><span class="linenos"> 503</span></a>
</span><span id="SeismicVolume-504"><a href="#-504"><span class="linenos"> 504</span></a>        <span class="c1"># Loop over 3D angle stack arrays</span>
</span><span id="SeismicVolume-505"><a href="#-505"><span class="linenos"> 505</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="SeismicVolume-506"><a href="#-506"><span class="linenos"> 506</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; ... shape of data being bandlimited = &quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="SeismicVolume-507"><a href="#-507"><span class="linenos"> 507</span></a>        <span class="n">num</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="SeismicVolume-508"><a href="#-508"><span class="linenos"> 508</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="SeismicVolume-509"><a href="#-509"><span class="linenos"> 509</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Applying Bandpass to </span><span class="si">{</span><span class="n">num</span><span class="si">}</span><span class="s2"> cubes&quot;</span><span class="p">)</span>
</span><span id="SeismicVolume-510"><a href="#-510"><span class="linenos"> 510</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">multiprocess_bp</span><span class="p">:</span>
</span><span id="SeismicVolume-511"><a href="#-511"><span class="linenos"> 511</span></a>            <span class="c1"># Much faster to use multiprocessing and apply band-limitation to entire cube at once</span>
</span><span id="SeismicVolume-512"><a href="#-512"><span class="linenos"> 512</span></a>            <span class="k">with</span> <span class="n">Pool</span><span class="p">(</span><span class="n">processes</span><span class="o">=</span><span class="nb">min</span><span class="p">(</span><span class="n">num</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">cpu_count</span><span class="p">()</span> <span class="o">-</span> <span class="mi">2</span><span class="p">))</span> <span class="k">as</span> <span class="n">p</span><span class="p">:</span>
</span><span id="SeismicVolume-513"><a href="#-513"><span class="linenos"> 513</span></a>                <span class="n">iterator</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span>
</span><span id="SeismicVolume-514"><a href="#-514"><span class="linenos"> 514</span></a>                    <span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num</span><span class="p">)],</span>
</span><span id="SeismicVolume-515"><a href="#-515"><span class="linenos"> 515</span></a>                    <span class="n">itertools</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">b</span><span class="p">),</span>
</span><span id="SeismicVolume-516"><a href="#-516"><span class="linenos"> 516</span></a>                    <span class="n">itertools</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">a</span><span class="p">),</span>
</span><span id="SeismicVolume-517"><a href="#-517"><span class="linenos"> 517</span></a>                <span class="p">)</span>
</span><span id="SeismicVolume-518"><a href="#-518"><span class="linenos"> 518</span></a>                <span class="n">out_cubes_mp</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">starmap</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_run_bandpass_on_cubes</span><span class="p">,</span> <span class="n">iterator</span><span class="p">)</span>
</span><span id="SeismicVolume-519"><a href="#-519"><span class="linenos"> 519</span></a>            <span class="n">out_cubes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">out_cubes_mp</span><span class="p">)</span>
</span><span id="SeismicVolume-520"><a href="#-520"><span class="linenos"> 520</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SeismicVolume-521"><a href="#-521"><span class="linenos"> 521</span></a>            <span class="c1"># multiprocessing can fail using Python version 3.6 and very large arrays</span>
</span><span id="SeismicVolume-522"><a href="#-522"><span class="linenos"> 522</span></a>            <span class="n">out_cubes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="SeismicVolume-523"><a href="#-523"><span class="linenos"> 523</span></a>            <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num</span><span class="p">):</span>
</span><span id="SeismicVolume-524"><a href="#-524"><span class="linenos"> 524</span></a>                <span class="n">out_cubes</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_run_bandpass_on_cubes</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span> <span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
</span><span id="SeismicVolume-525"><a href="#-525"><span class="linenos"> 525</span></a>
</span><span id="SeismicVolume-526"><a href="#-526"><span class="linenos"> 526</span></a>        <span class="k">return</span> <span class="n">out_cubes</span>
</span><span id="SeismicVolume-527"><a href="#-527"><span class="linenos"> 527</span></a>
</span><span id="SeismicVolume-528"><a href="#-528"><span class="linenos"> 528</span></a>    <span class="nd">@staticmethod</span>
</span><span id="SeismicVolume-529"><a href="#-529"><span class="linenos"> 529</span></a>    <span class="k">def</span> <span class="nf">_run_bandpass_on_cubes</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
</span><span id="SeismicVolume-530"><a href="#-530"><span class="linenos"> 530</span></a>        <span class="n">out_cube</span> <span class="o">=</span> <span class="n">apply_butterworth_bandpass</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
</span><span id="SeismicVolume-531"><a href="#-531"><span class="linenos"> 531</span></a>        <span class="k">return</span> <span class="n">out_cube</span>
</span><span id="SeismicVolume-532"><a href="#-532"><span class="linenos"> 532</span></a>
</span><span id="SeismicVolume-533"><a href="#-533"><span class="linenos"> 533</span></a>    <span class="k">def</span> <span class="nf">apply_lateral_filter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
</span><span id="SeismicVolume-534"><a href="#-534"><span class="linenos"> 534</span></a>        <span class="kn">from</span> <span class="nn">scipy.ndimage</span> <span class="kn">import</span> <span class="n">uniform_filter</span>
</span><span id="SeismicVolume-535"><a href="#-535"><span class="linenos"> 535</span></a>
</span><span id="SeismicVolume-536"><a href="#-536"><span class="linenos"> 536</span></a>        <span class="n">n_filt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">lateral_filter_size</span>
</span><span id="SeismicVolume-537"><a href="#-537"><span class="linenos"> 537</span></a>        <span class="k">return</span> <span class="n">uniform_filter</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n_filt</span><span class="p">,</span> <span class="n">n_filt</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
</span><span id="SeismicVolume-538"><a href="#-538"><span class="linenos"> 538</span></a>
</span><span id="SeismicVolume-539"><a href="#-539"><span class="linenos"> 539</span></a>    <span class="k">def</span> <span class="nf">apply_cumsum</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
</span><span id="SeismicVolume-540"><a href="#-540"><span class="linenos"> 540</span></a>        <span class="sd">&quot;&quot;&quot;Calculate cumulative sum on the Z-axis of input data</span>
</span><span id="SeismicVolume-541"><a href="#-541"><span class="linenos"> 541</span></a><span class="sd">        Sipmap&#39;s cumsum also applies an Ormsby filter to the cumulatively summed data</span>
</span><span id="SeismicVolume-542"><a href="#-542"><span class="linenos"> 542</span></a><span class="sd">        To replicate this, apply a butterworth filter to the data using 2, 100Hz frequency limits</span>
</span><span id="SeismicVolume-543"><a href="#-543"><span class="linenos"> 543</span></a><span class="sd">        todo: make an ormsby function&quot;&quot;&quot;</span>
</span><span id="SeismicVolume-544"><a href="#-544"><span class="linenos"> 544</span></a>        <span class="n">cumsum</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="SeismicVolume-545"><a href="#-545"><span class="linenos"> 545</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_bandlimits</span><span class="p">(</span><span class="n">cumsum</span><span class="p">,</span> <span class="p">(</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">100.0</span><span class="p">))</span>
</span><span id="SeismicVolume-546"><a href="#-546"><span class="linenos"> 546</span></a>
</span><span id="SeismicVolume-547"><a href="#-547"><span class="linenos"> 547</span></a>    <span class="nd">@staticmethod</span>
</span><span id="SeismicVolume-548"><a href="#-548"><span class="linenos"> 548</span></a>    <span class="k">def</span> <span class="nf">stack_substacks</span><span class="p">(</span><span class="n">cube_list</span><span class="p">):</span>
</span><span id="SeismicVolume-549"><a href="#-549"><span class="linenos"> 549</span></a>        <span class="sd">&quot;&quot;&quot;Stack cubes by taking mean&quot;&quot;&quot;</span>
</span><span id="SeismicVolume-550"><a href="#-550"><span class="linenos"> 550</span></a>        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">cube_list</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="SeismicVolume-551"><a href="#-551"><span class="linenos"> 551</span></a>
</span><span id="SeismicVolume-552"><a href="#-552"><span class="linenos"> 552</span></a>    <span class="k">def</span> <span class="nf">augment_data_and_labels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">normalised_seismic</span><span class="p">,</span> <span class="n">seabed</span><span class="p">):</span>
</span><span id="SeismicVolume-553"><a href="#-553"><span class="linenos"> 553</span></a>        <span class="kn">from</span> <span class="nn">datagenerator.Augmentation</span> <span class="kn">import</span> <span class="n">tz_stretch</span><span class="p">,</span> <span class="n">uniform_stretch</span>
</span><span id="SeismicVolume-554"><a href="#-554"><span class="linenos"> 554</span></a>
</span><span id="SeismicVolume-555"><a href="#-555"><span class="linenos"> 555</span></a>        <span class="n">hc_labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">h5file</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ModelData</span><span class="o">.</span><span class="n">hc_labels</span><span class="p">[:]</span>
</span><span id="SeismicVolume-556"><a href="#-556"><span class="linenos"> 556</span></a>        <span class="n">data</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">tz_stretch</span><span class="p">(</span>
</span><span id="SeismicVolume-557"><a href="#-557"><span class="linenos"> 557</span></a>            <span class="n">normalised_seismic</span><span class="p">,</span>
</span><span id="SeismicVolume-558"><a href="#-558"><span class="linenos"> 558</span></a>            <span class="n">hc_labels</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">pad_samples</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span>
</span><span id="SeismicVolume-559"><a href="#-559"><span class="linenos"> 559</span></a>            <span class="n">seabed</span><span class="p">,</span>
</span><span id="SeismicVolume-560"><a href="#-560"><span class="linenos"> 560</span></a>        <span class="p">)</span>
</span><span id="SeismicVolume-561"><a href="#-561"><span class="linenos"> 561</span></a>        <span class="n">seismic</span><span class="p">,</span> <span class="n">hc</span> <span class="o">=</span> <span class="n">uniform_stretch</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">labels</span><span class="p">)</span>
</span><span id="SeismicVolume-562"><a href="#-562"><span class="linenos"> 562</span></a>        <span class="k">return</span> <span class="n">seismic</span><span class="p">,</span> <span class="n">hc</span>
</span><span id="SeismicVolume-563"><a href="#-563"><span class="linenos"> 563</span></a>
</span><span id="SeismicVolume-564"><a href="#-564"><span class="linenos"> 564</span></a>    <span class="k">def</span> <span class="nf">compute_randomRMO_1D</span><span class="p">(</span>
</span><span id="SeismicVolume-565"><a href="#-565"><span class="linenos"> 565</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">nsamples</span><span class="p">,</span> <span class="n">inc_angle_list</span><span class="p">,</span> <span class="n">velocity_fraction</span><span class="o">=</span><span class="mf">0.015</span><span class="p">,</span> <span class="n">return_plot</span><span class="o">=</span><span class="kc">False</span>
</span><span id="SeismicVolume-566"><a href="#-566"><span class="linenos"> 566</span></a>    <span class="p">):</span>
</span><span id="SeismicVolume-567"><a href="#-567"><span class="linenos"> 567</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="SeismicVolume-568"><a href="#-568"><span class="linenos"> 568</span></a><span class="sd">        compute 1D indices for to apply residual moveout via interpolation</span>
</span><span id="SeismicVolume-569"><a href="#-569"><span class="linenos"> 569</span></a><span class="sd">        - nsamples is the array length in depth</span>
</span><span id="SeismicVolume-570"><a href="#-570"><span class="linenos"> 570</span></a><span class="sd">        - inc_angle_list is a list of angle in degrees for angle stacks to which</span>
</span><span id="SeismicVolume-571"><a href="#-571"><span class="linenos"> 571</span></a><span class="sd">        results will be applied</span>
</span><span id="SeismicVolume-572"><a href="#-572"><span class="linenos"> 572</span></a><span class="sd">        - velocity_fraction is the maximum percent error in absolute value.</span>
</span><span id="SeismicVolume-573"><a href="#-573"><span class="linenos"> 573</span></a><span class="sd">        for example, .03 would generate RMO based on velocity from .97 to 1.03 times correct velocity</span>
</span><span id="SeismicVolume-574"><a href="#-574"><span class="linenos"> 574</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SeismicVolume-575"><a href="#-575"><span class="linenos"> 575</span></a>        <span class="kn">from</span> <span class="nn">scipy.interpolate</span> <span class="kn">import</span> <span class="n">UnivariateSpline</span>
</span><span id="SeismicVolume-576"><a href="#-576"><span class="linenos"> 576</span></a>
</span><span id="SeismicVolume-577"><a href="#-577"><span class="linenos"> 577</span></a>        <span class="n">input_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nsamples</span><span class="p">)</span>
</span><span id="SeismicVolume-578"><a href="#-578"><span class="linenos"> 578</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">qc_plots</span><span class="p">:</span>
</span><span id="SeismicVolume-579"><a href="#-579"><span class="linenos"> 579</span></a>            <span class="kn">from</span> <span class="nn">datagenerator.util</span> <span class="kn">import</span> <span class="n">import_matplotlib</span>
</span><span id="SeismicVolume-580"><a href="#-580"><span class="linenos"> 580</span></a>
</span><span id="SeismicVolume-581"><a href="#-581"><span class="linenos"> 581</span></a>            <span class="n">plt</span> <span class="o">=</span> <span class="n">import_matplotlib</span><span class="p">()</span>
</span><span id="SeismicVolume-582"><a href="#-582"><span class="linenos"> 582</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span id="SeismicVolume-583"><a href="#-583"><span class="linenos"> 583</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mf">4.75</span><span class="p">,</span> <span class="mf">6.0</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
</span><span id="SeismicVolume-584"><a href="#-584"><span class="linenos"> 584</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
</span><span id="SeismicVolume-585"><a href="#-585"><span class="linenos"> 585</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
</span><span id="SeismicVolume-586"><a href="#-586"><span class="linenos"> 586</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">((</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
</span><span id="SeismicVolume-587"><a href="#-587"><span class="linenos"> 587</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">((</span><span class="n">nsamples</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
</span><span id="SeismicVolume-588"><a href="#-588"><span class="linenos"> 588</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;depth (samples)&quot;</span><span class="p">)</span>
</span><span id="SeismicVolume-589"><a href="#-589"><span class="linenos"> 589</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;RMO (samples)&quot;</span><span class="p">)</span>
</span><span id="SeismicVolume-590"><a href="#-590"><span class="linenos"> 590</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span>
</span><span id="SeismicVolume-591"><a href="#-591"><span class="linenos"> 591</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">work_subfolder</span><span class="p">,</span> <span class="s2">&quot;rmo_1d.png&quot;</span><span class="p">),</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;png&quot;</span>
</span><span id="SeismicVolume-592"><a href="#-592"><span class="linenos"> 592</span></a>            <span class="p">)</span>
</span><span id="SeismicVolume-593"><a href="#-593"><span class="linenos"> 593</span></a>        <span class="c1"># generate 1 to 3 randomly located velocity fractions at random depth indices</span>
</span><span id="SeismicVolume-594"><a href="#-594"><span class="linenos"> 594</span></a>        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">250</span><span class="p">):</span>
</span><span id="SeismicVolume-595"><a href="#-595"><span class="linenos"> 595</span></a>            <span class="n">num_tie_points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
</span><span id="SeismicVolume-596"><a href="#-596"><span class="linenos"> 596</span></a>            <span class="n">tie_fractions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span>
</span><span id="SeismicVolume-597"><a href="#-597"><span class="linenos"> 597</span></a>                <span class="n">low</span><span class="o">=-</span><span class="n">velocity_fraction</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="n">velocity_fraction</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">num_tie_points</span>
</span><span id="SeismicVolume-598"><a href="#-598"><span class="linenos"> 598</span></a>            <span class="p">)</span>
</span><span id="SeismicVolume-599"><a href="#-599"><span class="linenos"> 599</span></a>            <span class="k">if</span> <span class="n">num_tie_points</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="SeismicVolume-600"><a href="#-600"><span class="linenos"> 600</span></a>                <span class="n">tie_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span>
</span><span id="SeismicVolume-601"><a href="#-601"><span class="linenos"> 601</span></a>                    <span class="n">low</span><span class="o">=</span><span class="mf">0.25</span> <span class="o">*</span> <span class="n">nsamples</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="mf">0.75</span> <span class="o">*</span> <span class="n">nsamples</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">num_tie_points</span>
</span><span id="SeismicVolume-602"><a href="#-602"><span class="linenos"> 602</span></a>                <span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;int&quot;</span><span class="p">)</span>
</span><span id="SeismicVolume-603"><a href="#-603"><span class="linenos"> 603</span></a>
</span><span id="SeismicVolume-604"><a href="#-604"><span class="linenos"> 604</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="SeismicVolume-605"><a href="#-605"><span class="linenos"> 605</span></a>                <span class="n">tie_indices</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span>
</span><span id="SeismicVolume-606"><a href="#-606"><span class="linenos"> 606</span></a>                    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="mf">0.25</span> <span class="o">*</span> <span class="n">nsamples</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="mf">0.75</span> <span class="o">*</span> <span class="n">nsamples</span><span class="p">)</span>
</span><span id="SeismicVolume-607"><a href="#-607"><span class="linenos"> 607</span></a>                <span class="p">)</span>
</span><span id="SeismicVolume-608"><a href="#-608"><span class="linenos"> 608</span></a>            <span class="n">tie_fractions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span> <span class="n">tie_fractions</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]))</span>
</span><span id="SeismicVolume-609"><a href="#-609"><span class="linenos"> 609</span></a>            <span class="n">tie_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">tie_indices</span><span class="p">,</span> <span class="p">[</span><span class="n">nsamples</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span> <span class="n">nsamples</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]))</span>
</span><span id="SeismicVolume-610"><a href="#-610"><span class="linenos"> 610</span></a>            <span class="n">tie_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">tie_indices</span><span class="p">)</span>
</span><span id="SeismicVolume-611"><a href="#-611"><span class="linenos"> 611</span></a>            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">tie_indices</span><span class="p">)</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">:</span>
</span><span id="SeismicVolume-612"><a href="#-612"><span class="linenos"> 612</span></a>                <span class="k">continue</span>
</span><span id="SeismicVolume-613"><a href="#-613"><span class="linenos"> 613</span></a>            <span class="n">s</span> <span class="o">=</span> <span class="n">UnivariateSpline</span><span class="p">(</span><span class="n">tie_indices</span><span class="p">,</span> <span class="n">tie_fractions</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
</span><span id="SeismicVolume-614"><a href="#-614"><span class="linenos"> 614</span></a>            <span class="n">tie_fraction_array</span> <span class="o">=</span> <span class="n">s</span><span class="p">(</span><span class="n">input_indices</span><span class="p">)</span>
</span><span id="SeismicVolume-615"><a href="#-615"><span class="linenos"> 615</span></a>            <span class="n">output_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nsamples</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">inc_angle_list</span><span class="p">)))</span>
</span><span id="SeismicVolume-616"><a href="#-616"><span class="linenos"> 616</span></a>            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">iangle</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">inc_angle_list</span><span class="p">):</span>
</span><span id="SeismicVolume-617"><a href="#-617"><span class="linenos"> 617</span></a>                <span class="n">output_indices</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">input_indices</span> <span class="o">*</span> <span class="p">(</span>
</span><span id="SeismicVolume-618"><a href="#-618"><span class="linenos"> 618</span></a>                    <span class="mf">1.0</span>
</span><span id="SeismicVolume-619"><a href="#-619"><span class="linenos"> 619</span></a>                    <span class="o">+</span> <span class="n">tie_fraction_array</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">iangle</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">180.0</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
</span><span id="SeismicVolume-620"><a href="#-620"><span class="linenos"> 620</span></a>                <span class="p">)</span>
</span><span id="SeismicVolume-621"><a href="#-621"><span class="linenos"> 621</span></a>            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">output_indices</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">input_indices</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mf">10.0</span><span class="p">:</span>
</span><span id="SeismicVolume-622"><a href="#-622"><span class="linenos"> 622</span></a>                <span class="k">break</span>
</span><span id="SeismicVolume-623"><a href="#-623"><span class="linenos"> 623</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">iangle</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">inc_angle_list</span><span class="p">):</span>
</span><span id="SeismicVolume-624"><a href="#-624"><span class="linenos"> 624</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">qc_plots</span><span class="p">:</span>
</span><span id="SeismicVolume-625"><a href="#-625"><span class="linenos"> 625</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
</span><span id="SeismicVolume-626"><a href="#-626"><span class="linenos"> 626</span></a>                    <span class="n">output_indices</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">input_indices</span><span class="p">,</span>
</span><span id="SeismicVolume-627"><a href="#-627"><span class="linenos"> 627</span></a>                    <span class="n">input_indices</span><span class="p">,</span>
</span><span id="SeismicVolume-628"><a href="#-628"><span class="linenos"> 628</span></a>                    <span class="n">label</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">inc_angle_list</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span>
</span><span id="SeismicVolume-629"><a href="#-629"><span class="linenos"> 629</span></a>                <span class="p">)</span>
</span><span id="SeismicVolume-630"><a href="#-630"><span class="linenos"> 630</span></a>
</span><span id="SeismicVolume-631"><a href="#-631"><span class="linenos"> 631</span></a>                <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">inc_angle_list</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="SeismicVolume-632"><a href="#-632"><span class="linenos"> 632</span></a>                    <span class="n">output_tie_indices</span> <span class="o">=</span> <span class="n">tie_indices</span> <span class="o">*</span> <span class="p">(</span>
</span><span id="SeismicVolume-633"><a href="#-633"><span class="linenos"> 633</span></a>                        <span class="mf">1.0</span>
</span><span id="SeismicVolume-634"><a href="#-634"><span class="linenos"> 634</span></a>                        <span class="o">+</span> <span class="n">tie_fraction_array</span><span class="p">[</span><span class="n">tie_indices</span><span class="p">]</span>
</span><span id="SeismicVolume-635"><a href="#-635"><span class="linenos"> 635</span></a>                        <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">iangle</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">180.0</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
</span><span id="SeismicVolume-636"><a href="#-636"><span class="linenos"> 636</span></a>                    <span class="p">)</span>
</span><span id="SeismicVolume-637"><a href="#-637"><span class="linenos"> 637</span></a>                    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">output_tie_indices</span> <span class="o">-</span> <span class="n">tie_indices</span><span class="p">,</span> <span class="n">tie_indices</span><span class="p">,</span> <span class="s2">&quot;ko&quot;</span><span class="p">)</span>
</span><span id="SeismicVolume-638"><a href="#-638"><span class="linenos"> 638</span></a>                    <span class="n">rmo_min</span> <span class="o">=</span> <span class="p">(</span><span class="n">output_indices</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">input_indices</span><span class="p">)</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
</span><span id="SeismicVolume-639"><a href="#-639"><span class="linenos"> 639</span></a>                    <span class="n">rmo_max</span> <span class="o">=</span> <span class="p">(</span><span class="n">output_indices</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">input_indices</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</span><span id="SeismicVolume-640"><a href="#-640"><span class="linenos"> 640</span></a>                    <span class="n">rmo_range</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">rmo_min</span><span class="p">,</span> <span class="n">rmo_max</span><span class="p">))</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span id="SeismicVolume-641"><a href="#-641"><span class="linenos"> 641</span></a>                    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span>
</span><span id="SeismicVolume-642"><a href="#-642"><span class="linenos"> 642</span></a>                        <span class="s2">&quot;simultated RMO arrival time offsets</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="SeismicVolume-643"><a href="#-643"><span class="linenos"> 643</span></a>                        <span class="o">+</span> <span class="s2">&quot;rmo range = &quot;</span>
</span><span id="SeismicVolume-644"><a href="#-644"><span class="linenos"> 644</span></a>                        <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">rmo_range</span><span class="p">),</span>
</span><span id="SeismicVolume-645"><a href="#-645"><span class="linenos"> 645</span></a>                        <span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span>
</span><span id="SeismicVolume-646"><a href="#-646"><span class="linenos"> 646</span></a>                    <span class="p">)</span>
</span><span id="SeismicVolume-647"><a href="#-647"><span class="linenos"> 647</span></a>                    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</span><span id="SeismicVolume-648"><a href="#-648"><span class="linenos"> 648</span></a>                    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</span><span id="SeismicVolume-649"><a href="#-649"><span class="linenos"> 649</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span>
</span><span id="SeismicVolume-650"><a href="#-650"><span class="linenos"> 650</span></a>                    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">work_subfolder</span><span class="p">,</span> <span class="s2">&quot;rmo_arrival_time.png&quot;</span><span class="p">),</span>
</span><span id="SeismicVolume-651"><a href="#-651"><span class="linenos"> 651</span></a>                    <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;png&quot;</span><span class="p">,</span>
</span><span id="SeismicVolume-652"><a href="#-652"><span class="linenos"> 652</span></a>                <span class="p">)</span>
</span><span id="SeismicVolume-653"><a href="#-653"><span class="linenos"> 653</span></a>
</span><span id="SeismicVolume-654"><a href="#-654"><span class="linenos"> 654</span></a>        <span class="k">if</span> <span class="n">return_plot</span><span class="p">:</span>
</span><span id="SeismicVolume-655"><a href="#-655"><span class="linenos"> 655</span></a>            <span class="k">return</span> <span class="n">output_indices</span><span class="p">,</span> <span class="n">plt</span>
</span><span id="SeismicVolume-656"><a href="#-656"><span class="linenos"> 656</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SeismicVolume-657"><a href="#-657"><span class="linenos"> 657</span></a>            <span class="k">return</span> <span class="n">output_indices</span>
</span><span id="SeismicVolume-658"><a href="#-658"><span class="linenos"> 658</span></a>
</span><span id="SeismicVolume-659"><a href="#-659"><span class="linenos"> 659</span></a>    <span class="k">def</span> <span class="nf">apply_rmo_augmentation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">angle_gather</span><span class="p">,</span> <span class="n">rmo_indices</span><span class="p">,</span> <span class="n">remove_mean_rmo</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="SeismicVolume-660"><a href="#-660"><span class="linenos"> 660</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="SeismicVolume-661"><a href="#-661"><span class="linenos"> 661</span></a><span class="sd">        apply residual moveout via interpolation</span>
</span><span id="SeismicVolume-662"><a href="#-662"><span class="linenos"> 662</span></a><span class="sd">        applied to &#39;angle_gather&#39; with results from compute_randomRMO_1D in rmo_indices</span>
</span><span id="SeismicVolume-663"><a href="#-663"><span class="linenos"> 663</span></a><span class="sd">        angle_gather and rmo_indices need to be 2D arrays with the same shape (n_samples x n_angles)</span>
</span><span id="SeismicVolume-664"><a href="#-664"><span class="linenos"> 664</span></a><span class="sd">        - angle_gather is the array to which RMO is applied</span>
</span><span id="SeismicVolume-665"><a href="#-665"><span class="linenos"> 665</span></a><span class="sd">        - rmo_indices is the array used to modify the two-way-times of angle_gather</span>
</span><span id="SeismicVolume-666"><a href="#-666"><span class="linenos"> 666</span></a><span class="sd">        - remove_mean_rmo can be used to (when True) to apply relative RMO that keeps</span>
</span><span id="SeismicVolume-667"><a href="#-667"><span class="linenos"> 667</span></a><span class="sd">        event energy at roughly the same TWT. for example to avoid applying RMO</span>
</span><span id="SeismicVolume-668"><a href="#-668"><span class="linenos"> 668</span></a><span class="sd">        to both data and labels</span>
</span><span id="SeismicVolume-669"><a href="#-669"><span class="linenos"> 669</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SeismicVolume-670"><a href="#-670"><span class="linenos"> 670</span></a>        <span class="k">if</span> <span class="n">remove_mean_rmo</span><span class="p">:</span>
</span><span id="SeismicVolume-671"><a href="#-671"><span class="linenos"> 671</span></a>            <span class="c1"># apply de-trending to ensure that rmo does not change TWT</span>
</span><span id="SeismicVolume-672"><a href="#-672"><span class="linenos"> 672</span></a>            <span class="c1"># after rmo compared to before rmo &#39;augmentation&#39;</span>
</span><span id="SeismicVolume-673"><a href="#-673"><span class="linenos"> 673</span></a>            <span class="n">residual_times</span> <span class="o">=</span> <span class="n">rmo_indices</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span>
</span><span id="SeismicVolume-674"><a href="#-674"><span class="linenos"> 674</span></a>                <span class="n">angle_gather</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="SeismicVolume-675"><a href="#-675"><span class="linenos"> 675</span></a>            <span class="p">)</span>
</span><span id="SeismicVolume-676"><a href="#-676"><span class="linenos"> 676</span></a>            <span class="n">residual_rmo_indices</span> <span class="o">=</span> <span class="n">rmo_indices</span> <span class="o">*</span> <span class="mf">1.0</span>
</span><span id="SeismicVolume-677"><a href="#-677"><span class="linenos"> 677</span></a>            <span class="n">residual_rmo_indices</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-=</span> <span class="n">residual_times</span>
</span><span id="SeismicVolume-678"><a href="#-678"><span class="linenos"> 678</span></a>            <span class="n">residual_rmo_indices</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-=</span> <span class="n">residual_times</span>
</span><span id="SeismicVolume-679"><a href="#-679"><span class="linenos"> 679</span></a>            <span class="n">residual_rmo_indices</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">-=</span> <span class="n">residual_times</span>
</span><span id="SeismicVolume-680"><a href="#-680"><span class="linenos"> 680</span></a>            <span class="n">_rmo_indices</span> <span class="o">=</span> <span class="n">residual_rmo_indices</span>
</span><span id="SeismicVolume-681"><a href="#-681"><span class="linenos"> 681</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SeismicVolume-682"><a href="#-682"><span class="linenos"> 682</span></a>            <span class="n">_rmo_indices</span> <span class="o">=</span> <span class="n">rmo_indices</span>
</span><span id="SeismicVolume-683"><a href="#-683"><span class="linenos"> 683</span></a>
</span><span id="SeismicVolume-684"><a href="#-684"><span class="linenos"> 684</span></a>        <span class="n">rmo_angle_gather</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">angle_gather</span><span class="p">)</span>
</span><span id="SeismicVolume-685"><a href="#-685"><span class="linenos"> 685</span></a>        <span class="k">for</span> <span class="n">iangle</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rmo_indices</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])):</span>
</span><span id="SeismicVolume-686"><a href="#-686"><span class="linenos"> 686</span></a>            <span class="n">rmo_angle_gather</span><span class="p">[:,</span> <span class="n">iangle</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span>
</span><span id="SeismicVolume-687"><a href="#-687"><span class="linenos"> 687</span></a>                <span class="nb">range</span><span class="p">(</span><span class="n">angle_gather</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
</span><span id="SeismicVolume-688"><a href="#-688"><span class="linenos"> 688</span></a>                <span class="n">_rmo_indices</span><span class="p">[:,</span> <span class="n">iangle</span><span class="p">],</span>
</span><span id="SeismicVolume-689"><a href="#-689"><span class="linenos"> 689</span></a>                <span class="n">angle_gather</span><span class="p">[:,</span> <span class="n">iangle</span><span class="p">],</span>
</span><span id="SeismicVolume-690"><a href="#-690"><span class="linenos"> 690</span></a>            <span class="p">)</span>
</span><span id="SeismicVolume-691"><a href="#-691"><span class="linenos"> 691</span></a>
</span><span id="SeismicVolume-692"><a href="#-692"><span class="linenos"> 692</span></a>        <span class="k">return</span> <span class="n">rmo_angle_gather</span>
</span><span id="SeismicVolume-693"><a href="#-693"><span class="linenos"> 693</span></a>
</span><span id="SeismicVolume-694"><a href="#-694"><span class="linenos"> 694</span></a>    <span class="k">def</span> <span class="nf">build_property_models_randomised_depth</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rpm</span><span class="p">,</span> <span class="n">mixing_method</span><span class="o">=</span><span class="s2">&quot;inv_vel&quot;</span><span class="p">):</span>
</span><span id="SeismicVolume-695"><a href="#-695"><span class="linenos"> 695</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="SeismicVolume-696"><a href="#-696"><span class="linenos"> 696</span></a><span class="sd">        Build property models with randomised depth</span>
</span><span id="SeismicVolume-697"><a href="#-697"><span class="linenos"> 697</span></a><span class="sd">        -------------------------------------------</span>
</span><span id="SeismicVolume-698"><a href="#-698"><span class="linenos"> 698</span></a><span class="sd">        Builds property models with randomised depth.</span>
</span><span id="SeismicVolume-699"><a href="#-699"><span class="linenos"> 699</span></a>
</span><span id="SeismicVolume-700"><a href="#-700"><span class="linenos"> 700</span></a><span class="sd">        v2 but with Backus moduli mixing instead of inverse velocity mixing</span>
</span><span id="SeismicVolume-701"><a href="#-701"><span class="linenos"> 701</span></a><span class="sd">        mixing_method one of [&quot;InverseVelocity&quot;, &quot;BackusModuli&quot;]</span>
</span><span id="SeismicVolume-702"><a href="#-702"><span class="linenos"> 702</span></a>
</span><span id="SeismicVolume-703"><a href="#-703"><span class="linenos"> 703</span></a><span class="sd">        Parameters</span>
</span><span id="SeismicVolume-704"><a href="#-704"><span class="linenos"> 704</span></a><span class="sd">        ----------</span>
</span><span id="SeismicVolume-705"><a href="#-705"><span class="linenos"> 705</span></a><span class="sd">        rpm : str</span>
</span><span id="SeismicVolume-706"><a href="#-706"><span class="linenos"> 706</span></a><span class="sd">            Rock properties model.</span>
</span><span id="SeismicVolume-707"><a href="#-707"><span class="linenos"> 707</span></a><span class="sd">        mixing_method : str</span>
</span><span id="SeismicVolume-708"><a href="#-708"><span class="linenos"> 708</span></a><span class="sd">            Mixing method for randomised depth.</span>
</span><span id="SeismicVolume-709"><a href="#-709"><span class="linenos"> 709</span></a><span class="sd">        </span>
</span><span id="SeismicVolume-710"><a href="#-710"><span class="linenos"> 710</span></a><span class="sd">        Returns</span>
</span><span id="SeismicVolume-711"><a href="#-711"><span class="linenos"> 711</span></a><span class="sd">        -------</span>
</span><span id="SeismicVolume-712"><a href="#-712"><span class="linenos"> 712</span></a><span class="sd">        None</span>
</span><span id="SeismicVolume-713"><a href="#-713"><span class="linenos"> 713</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SeismicVolume-714"><a href="#-714"><span class="linenos"> 714</span></a>        <span class="n">layer_half_range</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">rpm_scaling_factors</span><span class="p">[</span><span class="s2">&quot;layershiftsamples&quot;</span><span class="p">]</span>
</span><span id="SeismicVolume-715"><a href="#-715"><span class="linenos"> 715</span></a>        <span class="n">property_half_range</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">rpm_scaling_factors</span><span class="p">[</span><span class="s2">&quot;RPshiftsamples&quot;</span><span class="p">]</span>
</span><span id="SeismicVolume-716"><a href="#-716"><span class="linenos"> 716</span></a>
</span><span id="SeismicVolume-717"><a href="#-717"><span class="linenos"> 717</span></a>        <span class="n">depth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">h5file</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ModelData</span><span class="o">.</span><span class="n">faulted_depth</span><span class="p">[:]</span>
</span><span id="SeismicVolume-718"><a href="#-718"><span class="linenos"> 718</span></a>        <span class="n">lith</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">faulted_lithology</span><span class="p">[:]</span>
</span><span id="SeismicVolume-719"><a href="#-719"><span class="linenos"> 719</span></a>        <span class="n">net_to_gross</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">faulted_net_to_gross</span><span class="p">[:]</span>
</span><span id="SeismicVolume-720"><a href="#-720"><span class="linenos"> 720</span></a>
</span><span id="SeismicVolume-721"><a href="#-721"><span class="linenos"> 721</span></a>        <span class="n">oil_closures</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">h5file</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ModelData</span><span class="o">.</span><span class="n">oil_closures</span><span class="p">[:]</span>
</span><span id="SeismicVolume-722"><a href="#-722"><span class="linenos"> 722</span></a>        <span class="n">gas_closures</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">h5file</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ModelData</span><span class="o">.</span><span class="n">gas_closures</span><span class="p">[:]</span>
</span><span id="SeismicVolume-723"><a href="#-723"><span class="linenos"> 723</span></a>
</span><span id="SeismicVolume-724"><a href="#-724"><span class="linenos"> 724</span></a>        <span class="n">integer_faulted_age</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="SeismicVolume-725"><a href="#-725"><span class="linenos"> 725</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">h5file</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ModelData</span><span class="o">.</span><span class="n">faulted_age_volume</span><span class="p">[:]</span> <span class="o">+</span> <span class="mf">0.00001</span>
</span><span id="SeismicVolume-726"><a href="#-726"><span class="linenos"> 726</span></a>        <span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</span><span id="SeismicVolume-727"><a href="#-727"><span class="linenos"> 727</span></a>
</span><span id="SeismicVolume-728"><a href="#-728"><span class="linenos"> 728</span></a>        <span class="c1"># Use empty class object to store all Rho, Vp, Vs volumes (randomised, fluid factor and non randomised)</span>
</span><span id="SeismicVolume-729"><a href="#-729"><span class="linenos"> 729</span></a>        <span class="n">mixed_properties</span> <span class="o">=</span> <span class="n">ElasticProperties3D</span><span class="p">()</span>
</span><span id="SeismicVolume-730"><a href="#-730"><span class="linenos"> 730</span></a>        <span class="n">mixed_properties</span><span class="o">.</span><span class="n">rho</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">lith</span><span class="p">)</span>
</span><span id="SeismicVolume-731"><a href="#-731"><span class="linenos"> 731</span></a>        <span class="n">mixed_properties</span><span class="o">.</span><span class="n">vp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">lith</span><span class="p">)</span>
</span><span id="SeismicVolume-732"><a href="#-732"><span class="linenos"> 732</span></a>        <span class="n">mixed_properties</span><span class="o">.</span><span class="n">vs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">lith</span><span class="p">)</span>
</span><span id="SeismicVolume-733"><a href="#-733"><span class="linenos"> 733</span></a>        <span class="n">mixed_properties</span><span class="o">.</span><span class="n">sum_net</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">lith</span><span class="p">)</span>
</span><span id="SeismicVolume-734"><a href="#-734"><span class="linenos"> 734</span></a>        <span class="n">cube_shape</span> <span class="o">=</span> <span class="n">lith</span><span class="o">.</span><span class="n">shape</span>
</span><span id="SeismicVolume-735"><a href="#-735"><span class="linenos"> 735</span></a>
</span><span id="SeismicVolume-736"><a href="#-736"><span class="linenos"> 736</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="SeismicVolume-737"><a href="#-737"><span class="linenos"> 737</span></a>            <span class="n">mixed_properties</span><span class="o">.</span><span class="n">rho_not_random</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">lith</span><span class="p">)</span>
</span><span id="SeismicVolume-738"><a href="#-738"><span class="linenos"> 738</span></a>            <span class="n">mixed_properties</span><span class="o">.</span><span class="n">vp_not_random</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">lith</span><span class="p">)</span>
</span><span id="SeismicVolume-739"><a href="#-739"><span class="linenos"> 739</span></a>            <span class="n">mixed_properties</span><span class="o">.</span><span class="n">vs_not_random</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">lith</span><span class="p">)</span>
</span><span id="SeismicVolume-740"><a href="#-740"><span class="linenos"> 740</span></a>
</span><span id="SeismicVolume-741"><a href="#-741"><span class="linenos"> 741</span></a>        <span class="c1"># water layer</span>
</span><span id="SeismicVolume-742"><a href="#-742"><span class="linenos"> 742</span></a>        <span class="n">mixed_properties</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">water_properties</span><span class="p">(</span><span class="n">lith</span><span class="p">,</span> <span class="n">mixed_properties</span><span class="p">)</span>
</span><span id="SeismicVolume-743"><a href="#-743"><span class="linenos"> 743</span></a>
</span><span id="SeismicVolume-744"><a href="#-744"><span class="linenos"> 744</span></a>        <span class="n">mixed_properties</span><span class="o">.</span><span class="n">rho_ff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">mixed_properties</span><span class="o">.</span><span class="n">rho</span><span class="p">)</span>
</span><span id="SeismicVolume-745"><a href="#-745"><span class="linenos"> 745</span></a>        <span class="n">mixed_properties</span><span class="o">.</span><span class="n">vp_ff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">mixed_properties</span><span class="o">.</span><span class="n">vp</span><span class="p">)</span>
</span><span id="SeismicVolume-746"><a href="#-746"><span class="linenos"> 746</span></a>        <span class="n">mixed_properties</span><span class="o">.</span><span class="n">vs_ff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">mixed_properties</span><span class="o">.</span><span class="n">vs</span><span class="p">)</span>
</span><span id="SeismicVolume-747"><a href="#-747"><span class="linenos"> 747</span></a>
</span><span id="SeismicVolume-748"><a href="#-748"><span class="linenos"> 748</span></a>        <span class="n">delta_z_lyrs</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="SeismicVolume-749"><a href="#-749"><span class="linenos"> 749</span></a>        <span class="n">delta_z_shales</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="SeismicVolume-750"><a href="#-750"><span class="linenos"> 750</span></a>        <span class="n">delta_z_brine_sands</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="SeismicVolume-751"><a href="#-751"><span class="linenos"> 751</span></a>        <span class="n">delta_z_oil_sands</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="SeismicVolume-752"><a href="#-752"><span class="linenos"> 752</span></a>        <span class="n">delta_z_gas_sands</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="SeismicVolume-753"><a href="#-753"><span class="linenos"> 753</span></a>
</span><span id="SeismicVolume-754"><a href="#-754"><span class="linenos"> 754</span></a>        <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">integer_faulted_age</span><span class="o">.</span><span class="n">max</span><span class="p">()):</span>
</span><span id="SeismicVolume-755"><a href="#-755"><span class="linenos"> 755</span></a>            <span class="n">__i</span><span class="p">,</span> <span class="n">__j</span><span class="p">,</span> <span class="n">__k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">integer_faulted_age</span> <span class="o">==</span> <span class="n">z</span><span class="p">)</span>
</span><span id="SeismicVolume-756"><a href="#-756"><span class="linenos"> 756</span></a>
</span><span id="SeismicVolume-757"><a href="#-757"><span class="linenos"> 757</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">__k</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="SeismicVolume-758"><a href="#-758"><span class="linenos"> 758</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="SeismicVolume-759"><a href="#-759"><span class="linenos"> 759</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="SeismicVolume-760"><a href="#-760"><span class="linenos"> 760</span></a>                        <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">*********************</span><span class="se">\n</span><span class="s2"> ... layer number = </span><span class="si">{</span><span class="n">z</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="SeismicVolume-761"><a href="#-761"><span class="linenos"> 761</span></a>                        <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> ... n2g (min,mean,max) = &quot;</span>
</span><span id="SeismicVolume-762"><a href="#-762"><span class="linenos"> 762</span></a>                        <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">net_to_gross</span><span class="p">[</span><span class="n">__i</span><span class="p">,</span> <span class="n">__j</span><span class="p">,</span> <span class="n">__k</span><span class="p">])</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="si">}</span><span class="s2">,&quot;</span>
</span><span id="SeismicVolume-763"><a href="#-763"><span class="linenos"> 763</span></a>                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">net_to_gross</span><span class="p">[</span><span class="n">__i</span><span class="p">,</span> <span class="n">__j</span><span class="p">,</span> <span class="n">__k</span><span class="p">])</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="si">}</span><span class="s2">,&quot;</span>
</span><span id="SeismicVolume-764"><a href="#-764"><span class="linenos"> 764</span></a>                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">net_to_gross</span><span class="p">[</span><span class="n">__i</span><span class="p">,</span> <span class="n">__j</span><span class="p">,</span> <span class="n">__k</span><span class="p">])</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="si">}</span><span class="s2">,)&quot;</span>
</span><span id="SeismicVolume-765"><a href="#-765"><span class="linenos"> 765</span></a>                    <span class="p">)</span>
</span><span id="SeismicVolume-766"><a href="#-766"><span class="linenos"> 766</span></a>
</span><span id="SeismicVolume-767"><a href="#-767"><span class="linenos"> 767</span></a>                <span class="n">delta_z_layer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_delta_z_layer</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">layer_half_range</span><span class="p">,</span> <span class="n">__k</span><span class="p">)</span>
</span><span id="SeismicVolume-768"><a href="#-768"><span class="linenos"> 768</span></a>                <span class="n">delta_z_lyrs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">delta_z_layer</span><span class="p">)</span>
</span><span id="SeismicVolume-769"><a href="#-769"><span class="linenos"> 769</span></a>
</span><span id="SeismicVolume-770"><a href="#-770"><span class="linenos"> 770</span></a>            <span class="c1"># shale required for all voxels</span>
</span><span id="SeismicVolume-771"><a href="#-771"><span class="linenos"> 771</span></a>            <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">net_to_gross</span> <span class="o">&gt;=</span> <span class="mf">0.0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">integer_faulted_age</span> <span class="o">==</span> <span class="n">z</span><span class="p">))</span>
</span><span id="SeismicVolume-772"><a href="#-772"><span class="linenos"> 772</span></a>
</span><span id="SeismicVolume-773"><a href="#-773"><span class="linenos"> 773</span></a>            <span class="n">shale_voxel_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
</span><span id="SeismicVolume-774"><a href="#-774"><span class="linenos"> 774</span></a>            <span class="n">delta_z_rho</span><span class="p">,</span> <span class="n">delta_z_vp</span><span class="p">,</span> <span class="n">delta_z_vs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_delta_z_properties</span><span class="p">(</span>
</span><span id="SeismicVolume-775"><a href="#-775"><span class="linenos"> 775</span></a>                <span class="n">z</span><span class="p">,</span> <span class="n">property_half_range</span>
</span><span id="SeismicVolume-776"><a href="#-776"><span class="linenos"> 776</span></a>            <span class="p">)</span>
</span><span id="SeismicVolume-777"><a href="#-777"><span class="linenos"> 777</span></a>            <span class="n">delta_z_shales</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">delta_z_rho</span><span class="p">,</span> <span class="n">delta_z_vp</span><span class="p">,</span> <span class="n">delta_z_vs</span><span class="p">))</span>
</span><span id="SeismicVolume-778"><a href="#-778"><span class="linenos"> 778</span></a>
</span><span id="SeismicVolume-779"><a href="#-779"><span class="linenos"> 779</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="SeismicVolume-780"><a href="#-780"><span class="linenos"> 780</span></a>                <span class="n">_k_rho</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
</span><span id="SeismicVolume-781"><a href="#-781"><span class="linenos"> 781</span></a>                    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="n">delta_z_layer</span> <span class="o">+</span> <span class="n">delta_z_rho</span><span class="p">)</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span>
</span><span id="SeismicVolume-782"><a href="#-782"><span class="linenos"> 782</span></a>                        <span class="mi">0</span><span class="p">,</span> <span class="n">cube_shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">10</span>
</span><span id="SeismicVolume-783"><a href="#-783"><span class="linenos"> 783</span></a>                    <span class="p">)</span>
</span><span id="SeismicVolume-784"><a href="#-784"><span class="linenos"> 784</span></a>                <span class="p">)</span>
</span><span id="SeismicVolume-785"><a href="#-785"><span class="linenos"> 785</span></a>                <span class="n">_k_vp</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
</span><span id="SeismicVolume-786"><a href="#-786"><span class="linenos"> 786</span></a>                    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="n">delta_z_layer</span> <span class="o">+</span> <span class="n">delta_z_vp</span><span class="p">)</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span>
</span><span id="SeismicVolume-787"><a href="#-787"><span class="linenos"> 787</span></a>                        <span class="mi">0</span><span class="p">,</span> <span class="n">cube_shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">10</span>
</span><span id="SeismicVolume-788"><a href="#-788"><span class="linenos"> 788</span></a>                    <span class="p">)</span>
</span><span id="SeismicVolume-789"><a href="#-789"><span class="linenos"> 789</span></a>                <span class="p">)</span>
</span><span id="SeismicVolume-790"><a href="#-790"><span class="linenos"> 790</span></a>                <span class="n">_k_vs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
</span><span id="SeismicVolume-791"><a href="#-791"><span class="linenos"> 791</span></a>                    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="n">delta_z_layer</span> <span class="o">+</span> <span class="n">delta_z_vs</span><span class="p">)</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span>
</span><span id="SeismicVolume-792"><a href="#-792"><span class="linenos"> 792</span></a>                        <span class="mi">0</span><span class="p">,</span> <span class="n">cube_shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">10</span>
</span><span id="SeismicVolume-793"><a href="#-793"><span class="linenos"> 793</span></a>                    <span class="p">)</span>
</span><span id="SeismicVolume-794"><a href="#-794"><span class="linenos"> 794</span></a>                <span class="p">)</span>
</span><span id="SeismicVolume-795"><a href="#-795"><span class="linenos"> 795</span></a>
</span><span id="SeismicVolume-796"><a href="#-796"><span class="linenos"> 796</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="SeismicVolume-797"><a href="#-797"><span class="linenos"> 797</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="SeismicVolume-798"><a href="#-798"><span class="linenos"> 798</span></a>                        <span class="sa">f</span><span class="s2">&quot; ... shale: (delta_z_rho, delta_z_vp, delta_z_vs) = </span><span class="si">{</span><span class="n">delta_z_rho</span><span class="p">,</span> <span class="n">delta_z_vp</span><span class="p">,</span> <span class="n">delta_z_vs</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="SeismicVolume-799"><a href="#-799"><span class="linenos"> 799</span></a>                    <span class="p">)</span>
</span><span id="SeismicVolume-800"><a href="#-800"><span class="linenos"> 800</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; ... shale: i = </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="SeismicVolume-801"><a href="#-801"><span class="linenos"> 801</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; ... shale: k = </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="SeismicVolume-802"><a href="#-802"><span class="linenos"> 802</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; ... shale: _k = </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">_k_rho</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="SeismicVolume-803"><a href="#-803"><span class="linenos"> 803</span></a>
</span><span id="SeismicVolume-804"><a href="#-804"><span class="linenos"> 804</span></a>                <span class="n">mixed_properties</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_shales</span><span class="p">(</span>
</span><span id="SeismicVolume-805"><a href="#-805"><span class="linenos"> 805</span></a>                    <span class="n">xyz</span><span class="o">=</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span>
</span><span id="SeismicVolume-806"><a href="#-806"><span class="linenos"> 806</span></a>                    <span class="n">shifts</span><span class="o">=</span><span class="p">(</span><span class="n">_k_rho</span><span class="p">,</span> <span class="n">_k_vp</span><span class="p">,</span> <span class="n">_k_vs</span><span class="p">),</span>
</span><span id="SeismicVolume-807"><a href="#-807"><span class="linenos"> 807</span></a>                    <span class="n">props</span><span class="o">=</span><span class="n">mixed_properties</span><span class="p">,</span>
</span><span id="SeismicVolume-808"><a href="#-808"><span class="linenos"> 808</span></a>                    <span class="n">rpm</span><span class="o">=</span><span class="n">rpm</span><span class="p">,</span>
</span><span id="SeismicVolume-809"><a href="#-809"><span class="linenos"> 809</span></a>                    <span class="n">depth</span><span class="o">=</span><span class="n">depth</span><span class="p">,</span>
</span><span id="SeismicVolume-810"><a href="#-810"><span class="linenos"> 810</span></a>                    <span class="n">z</span><span class="o">=</span><span class="n">z</span><span class="p">,</span>
</span><span id="SeismicVolume-811"><a href="#-811"><span class="linenos"> 811</span></a>                <span class="p">)</span>
</span><span id="SeismicVolume-812"><a href="#-812"><span class="linenos"> 812</span></a>
</span><span id="SeismicVolume-813"><a href="#-813"><span class="linenos"> 813</span></a>            <span class="c1"># brine sand or mixture of brine sand and shale in same voxel</span>
</span><span id="SeismicVolume-814"><a href="#-814"><span class="linenos"> 814</span></a>            <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
</span><span id="SeismicVolume-815"><a href="#-815"><span class="linenos"> 815</span></a>                <span class="p">(</span><span class="n">net_to_gross</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">)</span>
</span><span id="SeismicVolume-816"><a href="#-816"><span class="linenos"> 816</span></a>                <span class="o">&amp;</span> <span class="p">(</span><span class="n">oil_closures</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">)</span>
</span><span id="SeismicVolume-817"><a href="#-817"><span class="linenos"> 817</span></a>                <span class="o">&amp;</span> <span class="p">(</span><span class="n">gas_closures</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">)</span>
</span><span id="SeismicVolume-818"><a href="#-818"><span class="linenos"> 818</span></a>                <span class="o">&amp;</span> <span class="p">(</span><span class="n">integer_faulted_age</span> <span class="o">==</span> <span class="n">z</span><span class="p">)</span>
</span><span id="SeismicVolume-819"><a href="#-819"><span class="linenos"> 819</span></a>            <span class="p">)</span>
</span><span id="SeismicVolume-820"><a href="#-820"><span class="linenos"> 820</span></a>            <span class="n">brine_voxel_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
</span><span id="SeismicVolume-821"><a href="#-821"><span class="linenos"> 821</span></a>            <span class="n">delta_z_rho</span><span class="p">,</span> <span class="n">delta_z_vp</span><span class="p">,</span> <span class="n">delta_z_vs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_delta_z_properties</span><span class="p">(</span>
</span><span id="SeismicVolume-822"><a href="#-822"><span class="linenos"> 822</span></a>                <span class="n">z</span><span class="p">,</span> <span class="n">property_half_range</span>
</span><span id="SeismicVolume-823"><a href="#-823"><span class="linenos"> 823</span></a>            <span class="p">)</span>
</span><span id="SeismicVolume-824"><a href="#-824"><span class="linenos"> 824</span></a>            <span class="n">delta_z_brine_sands</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">delta_z_rho</span><span class="p">,</span> <span class="n">delta_z_vp</span><span class="p">,</span> <span class="n">delta_z_vs</span><span class="p">))</span>
</span><span id="SeismicVolume-825"><a href="#-825"><span class="linenos"> 825</span></a>
</span><span id="SeismicVolume-826"><a href="#-826"><span class="linenos"> 826</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="SeismicVolume-827"><a href="#-827"><span class="linenos"> 827</span></a>                <span class="n">_k_rho</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
</span><span id="SeismicVolume-828"><a href="#-828"><span class="linenos"> 828</span></a>                    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="n">delta_z_layer</span> <span class="o">+</span> <span class="n">delta_z_rho</span><span class="p">)</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span>
</span><span id="SeismicVolume-829"><a href="#-829"><span class="linenos"> 829</span></a>                        <span class="mi">0</span><span class="p">,</span> <span class="n">cube_shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">10</span>
</span><span id="SeismicVolume-830"><a href="#-830"><span class="linenos"> 830</span></a>                    <span class="p">)</span>
</span><span id="SeismicVolume-831"><a href="#-831"><span class="linenos"> 831</span></a>                <span class="p">)</span>
</span><span id="SeismicVolume-832"><a href="#-832"><span class="linenos"> 832</span></a>                <span class="n">_k_vp</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
</span><span id="SeismicVolume-833"><a href="#-833"><span class="linenos"> 833</span></a>                    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="n">delta_z_layer</span> <span class="o">+</span> <span class="n">delta_z_vp</span><span class="p">)</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span>
</span><span id="SeismicVolume-834"><a href="#-834"><span class="linenos"> 834</span></a>                        <span class="mi">0</span><span class="p">,</span> <span class="n">cube_shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">10</span>
</span><span id="SeismicVolume-835"><a href="#-835"><span class="linenos"> 835</span></a>                    <span class="p">)</span>
</span><span id="SeismicVolume-836"><a href="#-836"><span class="linenos"> 836</span></a>                <span class="p">)</span>
</span><span id="SeismicVolume-837"><a href="#-837"><span class="linenos"> 837</span></a>                <span class="n">_k_vs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
</span><span id="SeismicVolume-838"><a href="#-838"><span class="linenos"> 838</span></a>                    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="n">delta_z_layer</span> <span class="o">+</span> <span class="n">delta_z_vs</span><span class="p">)</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span>
</span><span id="SeismicVolume-839"><a href="#-839"><span class="linenos"> 839</span></a>                        <span class="mi">0</span><span class="p">,</span> <span class="n">cube_shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">10</span>
</span><span id="SeismicVolume-840"><a href="#-840"><span class="linenos"> 840</span></a>                    <span class="p">)</span>
</span><span id="SeismicVolume-841"><a href="#-841"><span class="linenos"> 841</span></a>                <span class="p">)</span>
</span><span id="SeismicVolume-842"><a href="#-842"><span class="linenos"> 842</span></a>
</span><span id="SeismicVolume-843"><a href="#-843"><span class="linenos"> 843</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="SeismicVolume-844"><a href="#-844"><span class="linenos"> 844</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="SeismicVolume-845"><a href="#-845"><span class="linenos"> 845</span></a>                        <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> ... brine: (delta_z_rho, delta_z_vp, delta_z_vs) = </span><span class="si">{</span><span class="n">delta_z_rho</span><span class="p">,</span> <span class="n">delta_z_vp</span><span class="p">,</span> <span class="n">delta_z_vs</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="SeismicVolume-846"><a href="#-846"><span class="linenos"> 846</span></a>                    <span class="p">)</span>
</span><span id="SeismicVolume-847"><a href="#-847"><span class="linenos"> 847</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; ... brine: i = </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="SeismicVolume-848"><a href="#-848"><span class="linenos"> 848</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; ... brine: k = </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="SeismicVolume-849"><a href="#-849"><span class="linenos"> 849</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; ... brine: _k = </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">_k_rho</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="SeismicVolume-850"><a href="#-850"><span class="linenos"> 850</span></a>
</span><span id="SeismicVolume-851"><a href="#-851"><span class="linenos"> 851</span></a>                <span class="n">mixed_properties</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_sands</span><span class="p">(</span>
</span><span id="SeismicVolume-852"><a href="#-852"><span class="linenos"> 852</span></a>                    <span class="n">xyz</span><span class="o">=</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span>
</span><span id="SeismicVolume-853"><a href="#-853"><span class="linenos"> 853</span></a>                    <span class="n">shifts</span><span class="o">=</span><span class="p">(</span><span class="n">_k_rho</span><span class="p">,</span> <span class="n">_k_vp</span><span class="p">,</span> <span class="n">_k_vs</span><span class="p">),</span>
</span><span id="SeismicVolume-854"><a href="#-854"><span class="linenos"> 854</span></a>                    <span class="n">props</span><span class="o">=</span><span class="n">mixed_properties</span><span class="p">,</span>
</span><span id="SeismicVolume-855"><a href="#-855"><span class="linenos"> 855</span></a>                    <span class="n">rpm</span><span class="o">=</span><span class="n">rpm</span><span class="p">,</span>
</span><span id="SeismicVolume-856"><a href="#-856"><span class="linenos"> 856</span></a>                    <span class="n">depth</span><span class="o">=</span><span class="n">depth</span><span class="p">,</span>
</span><span id="SeismicVolume-857"><a href="#-857"><span class="linenos"> 857</span></a>                    <span class="n">ng</span><span class="o">=</span><span class="n">net_to_gross</span><span class="p">,</span>
</span><span id="SeismicVolume-858"><a href="#-858"><span class="linenos"> 858</span></a>                    <span class="n">z</span><span class="o">=</span><span class="n">z</span><span class="p">,</span>
</span><span id="SeismicVolume-859"><a href="#-859"><span class="linenos"> 859</span></a>                    <span class="n">fluid</span><span class="o">=</span><span class="s2">&quot;brine&quot;</span><span class="p">,</span>
</span><span id="SeismicVolume-860"><a href="#-860"><span class="linenos"> 860</span></a>                    <span class="n">mix</span><span class="o">=</span><span class="n">mixing_method</span><span class="p">,</span>
</span><span id="SeismicVolume-861"><a href="#-861"><span class="linenos"> 861</span></a>                <span class="p">)</span>
</span><span id="SeismicVolume-862"><a href="#-862"><span class="linenos"> 862</span></a>
</span><span id="SeismicVolume-863"><a href="#-863"><span class="linenos"> 863</span></a>            <span class="c1"># oil sands</span>
</span><span id="SeismicVolume-864"><a href="#-864"><span class="linenos"> 864</span></a>            <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
</span><span id="SeismicVolume-865"><a href="#-865"><span class="linenos"> 865</span></a>                <span class="p">(</span><span class="n">net_to_gross</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">)</span>
</span><span id="SeismicVolume-866"><a href="#-866"><span class="linenos"> 866</span></a>                <span class="o">&amp;</span> <span class="p">(</span><span class="n">oil_closures</span> <span class="o">==</span> <span class="mf">1.0</span><span class="p">)</span>
</span><span id="SeismicVolume-867"><a href="#-867"><span class="linenos"> 867</span></a>                <span class="o">&amp;</span> <span class="p">(</span><span class="n">gas_closures</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">)</span>
</span><span id="SeismicVolume-868"><a href="#-868"><span class="linenos"> 868</span></a>                <span class="o">&amp;</span> <span class="p">(</span><span class="n">integer_faulted_age</span> <span class="o">==</span> <span class="n">z</span><span class="p">)</span>
</span><span id="SeismicVolume-869"><a href="#-869"><span class="linenos"> 869</span></a>            <span class="p">)</span>
</span><span id="SeismicVolume-870"><a href="#-870"><span class="linenos"> 870</span></a>            <span class="n">oil_voxel_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
</span><span id="SeismicVolume-871"><a href="#-871"><span class="linenos"> 871</span></a>            <span class="n">delta_z_rho</span><span class="p">,</span> <span class="n">delta_z_vp</span><span class="p">,</span> <span class="n">delta_z_vs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_delta_z_properties</span><span class="p">(</span>
</span><span id="SeismicVolume-872"><a href="#-872"><span class="linenos"> 872</span></a>                <span class="n">z</span><span class="p">,</span> <span class="n">property_half_range</span>
</span><span id="SeismicVolume-873"><a href="#-873"><span class="linenos"> 873</span></a>            <span class="p">)</span>
</span><span id="SeismicVolume-874"><a href="#-874"><span class="linenos"> 874</span></a>            <span class="n">delta_z_oil_sands</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">delta_z_rho</span><span class="p">,</span> <span class="n">delta_z_vp</span><span class="p">,</span> <span class="n">delta_z_vs</span><span class="p">))</span>
</span><span id="SeismicVolume-875"><a href="#-875"><span class="linenos"> 875</span></a>
</span><span id="SeismicVolume-876"><a href="#-876"><span class="linenos"> 876</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="SeismicVolume-877"><a href="#-877"><span class="linenos"> 877</span></a>                <span class="n">_k_rho</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
</span><span id="SeismicVolume-878"><a href="#-878"><span class="linenos"> 878</span></a>                    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="n">delta_z_layer</span> <span class="o">+</span> <span class="n">delta_z_rho</span><span class="p">)</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span>
</span><span id="SeismicVolume-879"><a href="#-879"><span class="linenos"> 879</span></a>                        <span class="mi">0</span><span class="p">,</span> <span class="n">cube_shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">10</span>
</span><span id="SeismicVolume-880"><a href="#-880"><span class="linenos"> 880</span></a>                    <span class="p">)</span>
</span><span id="SeismicVolume-881"><a href="#-881"><span class="linenos"> 881</span></a>                <span class="p">)</span>
</span><span id="SeismicVolume-882"><a href="#-882"><span class="linenos"> 882</span></a>                <span class="n">_k_vp</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
</span><span id="SeismicVolume-883"><a href="#-883"><span class="linenos"> 883</span></a>                    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="n">delta_z_layer</span> <span class="o">+</span> <span class="n">delta_z_vp</span><span class="p">)</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span>
</span><span id="SeismicVolume-884"><a href="#-884"><span class="linenos"> 884</span></a>                        <span class="mi">0</span><span class="p">,</span> <span class="n">cube_shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">10</span>
</span><span id="SeismicVolume-885"><a href="#-885"><span class="linenos"> 885</span></a>                    <span class="p">)</span>
</span><span id="SeismicVolume-886"><a href="#-886"><span class="linenos"> 886</span></a>                <span class="p">)</span>
</span><span id="SeismicVolume-887"><a href="#-887"><span class="linenos"> 887</span></a>                <span class="n">_k_vs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
</span><span id="SeismicVolume-888"><a href="#-888"><span class="linenos"> 888</span></a>                    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="n">delta_z_layer</span> <span class="o">+</span> <span class="n">delta_z_vs</span><span class="p">)</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span>
</span><span id="SeismicVolume-889"><a href="#-889"><span class="linenos"> 889</span></a>                        <span class="mi">0</span><span class="p">,</span> <span class="n">cube_shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">10</span>
</span><span id="SeismicVolume-890"><a href="#-890"><span class="linenos"> 890</span></a>                    <span class="p">)</span>
</span><span id="SeismicVolume-891"><a href="#-891"><span class="linenos"> 891</span></a>                <span class="p">)</span>
</span><span id="SeismicVolume-892"><a href="#-892"><span class="linenos"> 892</span></a>
</span><span id="SeismicVolume-893"><a href="#-893"><span class="linenos"> 893</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="SeismicVolume-894"><a href="#-894"><span class="linenos"> 894</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="SeismicVolume-895"><a href="#-895"><span class="linenos"> 895</span></a>                        <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2"> ... Perform fluid substitution for oil sands. &quot;</span><span class="p">,</span>
</span><span id="SeismicVolume-896"><a href="#-896"><span class="linenos"> 896</span></a>                        <span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> ... Number oil voxels in closure = &quot;</span><span class="p">,</span>
</span><span id="SeismicVolume-897"><a href="#-897"><span class="linenos"> 897</span></a>                        <span class="n">mixed_properties</span><span class="o">.</span><span class="n">rho</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
</span><span id="SeismicVolume-898"><a href="#-898"><span class="linenos"> 898</span></a>                    <span class="p">)</span>
</span><span id="SeismicVolume-899"><a href="#-899"><span class="linenos"> 899</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="SeismicVolume-900"><a href="#-900"><span class="linenos"> 900</span></a>                        <span class="s2">&quot; ... closures_oil min/mean/max =  &quot;</span><span class="p">,</span>
</span><span id="SeismicVolume-901"><a href="#-901"><span class="linenos"> 901</span></a>                        <span class="n">oil_closures</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
</span><span id="SeismicVolume-902"><a href="#-902"><span class="linenos"> 902</span></a>                        <span class="n">oil_closures</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span>
</span><span id="SeismicVolume-903"><a href="#-903"><span class="linenos"> 903</span></a>                        <span class="n">oil_closures</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span>
</span><span id="SeismicVolume-904"><a href="#-904"><span class="linenos"> 904</span></a>                    <span class="p">)</span>
</span><span id="SeismicVolume-905"><a href="#-905"><span class="linenos"> 905</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="SeismicVolume-906"><a href="#-906"><span class="linenos"> 906</span></a>                        <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2"> ... np.all(oil_sand_rho[:,:,:] == brine_sand_rho[:,:,:]) &quot;</span><span class="p">,</span>
</span><span id="SeismicVolume-907"><a href="#-907"><span class="linenos"> 907</span></a>                        <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span>
</span><span id="SeismicVolume-908"><a href="#-908"><span class="linenos"> 908</span></a>                            <span class="n">rpm</span><span class="o">.</span><span class="n">calc_oil_sand_properties</span><span class="p">(</span>
</span><span id="SeismicVolume-909"><a href="#-909"><span class="linenos"> 909</span></a>                                <span class="n">depth</span><span class="p">[:],</span> <span class="n">depth</span><span class="p">[:],</span> <span class="n">depth</span><span class="p">[:]</span>
</span><span id="SeismicVolume-910"><a href="#-910"><span class="linenos"> 910</span></a>                            <span class="p">)</span><span class="o">.</span><span class="n">rho</span>
</span><span id="SeismicVolume-911"><a href="#-911"><span class="linenos"> 911</span></a>                            <span class="o">==</span> <span class="n">rpm</span><span class="o">.</span><span class="n">calc_brine_sand_properties</span><span class="p">(</span>
</span><span id="SeismicVolume-912"><a href="#-912"><span class="linenos"> 912</span></a>                                <span class="n">depth</span><span class="p">[:],</span> <span class="n">depth</span><span class="p">[:],</span> <span class="n">depth</span><span class="p">[:]</span>
</span><span id="SeismicVolume-913"><a href="#-913"><span class="linenos"> 913</span></a>                            <span class="p">)</span><span class="o">.</span><span class="n">rho</span>
</span><span id="SeismicVolume-914"><a href="#-914"><span class="linenos"> 914</span></a>                        <span class="p">),</span>
</span><span id="SeismicVolume-915"><a href="#-915"><span class="linenos"> 915</span></a>                    <span class="p">)</span>
</span><span id="SeismicVolume-916"><a href="#-916"><span class="linenos"> 916</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="SeismicVolume-917"><a href="#-917"><span class="linenos"> 917</span></a>                        <span class="s2">&quot; ... oil: (delta_z_rho, delta_z_vp, delta_z_vs) = &quot;</span>
</span><span id="SeismicVolume-918"><a href="#-918"><span class="linenos"> 918</span></a>                        <span class="o">+</span> <span class="nb">str</span><span class="p">((</span><span class="n">delta_z_rho</span><span class="p">,</span> <span class="n">delta_z_vp</span><span class="p">,</span> <span class="n">delta_z_vs</span><span class="p">))</span>
</span><span id="SeismicVolume-919"><a href="#-919"><span class="linenos"> 919</span></a>                    <span class="p">)</span>
</span><span id="SeismicVolume-920"><a href="#-920"><span class="linenos"> 920</span></a>
</span><span id="SeismicVolume-921"><a href="#-921"><span class="linenos"> 921</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="SeismicVolume-922"><a href="#-922"><span class="linenos"> 922</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; ... oil: i = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">i</span><span class="p">)))</span>
</span><span id="SeismicVolume-923"><a href="#-923"><span class="linenos"> 923</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; ... oil: k = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">k</span><span class="p">)))</span>
</span><span id="SeismicVolume-924"><a href="#-924"><span class="linenos"> 924</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; ... oil: _k = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">_k_rho</span><span class="p">)))</span>
</span><span id="SeismicVolume-925"><a href="#-925"><span class="linenos"> 925</span></a>
</span><span id="SeismicVolume-926"><a href="#-926"><span class="linenos"> 926</span></a>                <span class="n">mixed_properties</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_sands</span><span class="p">(</span>
</span><span id="SeismicVolume-927"><a href="#-927"><span class="linenos"> 927</span></a>                    <span class="n">xyz</span><span class="o">=</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span>
</span><span id="SeismicVolume-928"><a href="#-928"><span class="linenos"> 928</span></a>                    <span class="n">shifts</span><span class="o">=</span><span class="p">(</span><span class="n">_k_rho</span><span class="p">,</span> <span class="n">_k_vp</span><span class="p">,</span> <span class="n">_k_vs</span><span class="p">),</span>
</span><span id="SeismicVolume-929"><a href="#-929"><span class="linenos"> 929</span></a>                    <span class="n">props</span><span class="o">=</span><span class="n">mixed_properties</span><span class="p">,</span>
</span><span id="SeismicVolume-930"><a href="#-930"><span class="linenos"> 930</span></a>                    <span class="n">rpm</span><span class="o">=</span><span class="n">rpm</span><span class="p">,</span>
</span><span id="SeismicVolume-931"><a href="#-931"><span class="linenos"> 931</span></a>                    <span class="n">depth</span><span class="o">=</span><span class="n">depth</span><span class="p">,</span>
</span><span id="SeismicVolume-932"><a href="#-932"><span class="linenos"> 932</span></a>                    <span class="n">ng</span><span class="o">=</span><span class="n">net_to_gross</span><span class="p">,</span>
</span><span id="SeismicVolume-933"><a href="#-933"><span class="linenos"> 933</span></a>                    <span class="n">z</span><span class="o">=</span><span class="n">z</span><span class="p">,</span>
</span><span id="SeismicVolume-934"><a href="#-934"><span class="linenos"> 934</span></a>                    <span class="n">fluid</span><span class="o">=</span><span class="s2">&quot;oil&quot;</span><span class="p">,</span>
</span><span id="SeismicVolume-935"><a href="#-935"><span class="linenos"> 935</span></a>                    <span class="n">mix</span><span class="o">=</span><span class="n">mixing_method</span><span class="p">,</span>
</span><span id="SeismicVolume-936"><a href="#-936"><span class="linenos"> 936</span></a>                <span class="p">)</span>
</span><span id="SeismicVolume-937"><a href="#-937"><span class="linenos"> 937</span></a>
</span><span id="SeismicVolume-938"><a href="#-938"><span class="linenos"> 938</span></a>            <span class="c1"># gas sands</span>
</span><span id="SeismicVolume-939"><a href="#-939"><span class="linenos"> 939</span></a>            <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
</span><span id="SeismicVolume-940"><a href="#-940"><span class="linenos"> 940</span></a>                <span class="p">(</span><span class="n">net_to_gross</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">)</span>
</span><span id="SeismicVolume-941"><a href="#-941"><span class="linenos"> 941</span></a>                <span class="o">&amp;</span> <span class="p">(</span><span class="n">oil_closures</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">)</span>
</span><span id="SeismicVolume-942"><a href="#-942"><span class="linenos"> 942</span></a>                <span class="o">&amp;</span> <span class="p">(</span><span class="n">gas_closures</span> <span class="o">==</span> <span class="mf">1.0</span><span class="p">)</span>
</span><span id="SeismicVolume-943"><a href="#-943"><span class="linenos"> 943</span></a>                <span class="o">&amp;</span> <span class="p">(</span><span class="n">integer_faulted_age</span> <span class="o">==</span> <span class="n">z</span><span class="p">)</span>
</span><span id="SeismicVolume-944"><a href="#-944"><span class="linenos"> 944</span></a>            <span class="p">)</span>
</span><span id="SeismicVolume-945"><a href="#-945"><span class="linenos"> 945</span></a>            <span class="n">gas_voxel_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
</span><span id="SeismicVolume-946"><a href="#-946"><span class="linenos"> 946</span></a>            <span class="n">delta_z_rho</span><span class="p">,</span> <span class="n">delta_z_vp</span><span class="p">,</span> <span class="n">delta_z_vs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_delta_z_properties</span><span class="p">(</span>
</span><span id="SeismicVolume-947"><a href="#-947"><span class="linenos"> 947</span></a>                <span class="n">z</span><span class="p">,</span> <span class="n">property_half_range</span>
</span><span id="SeismicVolume-948"><a href="#-948"><span class="linenos"> 948</span></a>            <span class="p">)</span>
</span><span id="SeismicVolume-949"><a href="#-949"><span class="linenos"> 949</span></a>            <span class="n">delta_z_gas_sands</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">delta_z_rho</span><span class="p">,</span> <span class="n">delta_z_vp</span><span class="p">,</span> <span class="n">delta_z_vs</span><span class="p">))</span>
</span><span id="SeismicVolume-950"><a href="#-950"><span class="linenos"> 950</span></a>
</span><span id="SeismicVolume-951"><a href="#-951"><span class="linenos"> 951</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="SeismicVolume-952"><a href="#-952"><span class="linenos"> 952</span></a>                <span class="n">_k_rho</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
</span><span id="SeismicVolume-953"><a href="#-953"><span class="linenos"> 953</span></a>                    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="n">delta_z_layer</span> <span class="o">+</span> <span class="n">delta_z_rho</span><span class="p">)</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span>
</span><span id="SeismicVolume-954"><a href="#-954"><span class="linenos"> 954</span></a>                        <span class="mi">0</span><span class="p">,</span> <span class="n">cube_shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">10</span>
</span><span id="SeismicVolume-955"><a href="#-955"><span class="linenos"> 955</span></a>                    <span class="p">)</span>
</span><span id="SeismicVolume-956"><a href="#-956"><span class="linenos"> 956</span></a>                <span class="p">)</span>
</span><span id="SeismicVolume-957"><a href="#-957"><span class="linenos"> 957</span></a>                <span class="n">_k_vp</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
</span><span id="SeismicVolume-958"><a href="#-958"><span class="linenos"> 958</span></a>                    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="n">delta_z_layer</span> <span class="o">+</span> <span class="n">delta_z_vp</span><span class="p">)</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span>
</span><span id="SeismicVolume-959"><a href="#-959"><span class="linenos"> 959</span></a>                        <span class="mi">0</span><span class="p">,</span> <span class="n">cube_shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">10</span>
</span><span id="SeismicVolume-960"><a href="#-960"><span class="linenos"> 960</span></a>                    <span class="p">)</span>
</span><span id="SeismicVolume-961"><a href="#-961"><span class="linenos"> 961</span></a>                <span class="p">)</span>
</span><span id="SeismicVolume-962"><a href="#-962"><span class="linenos"> 962</span></a>                <span class="n">_k_vs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
</span><span id="SeismicVolume-963"><a href="#-963"><span class="linenos"> 963</span></a>                    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="n">delta_z_layer</span> <span class="o">+</span> <span class="n">delta_z_vs</span><span class="p">)</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span>
</span><span id="SeismicVolume-964"><a href="#-964"><span class="linenos"> 964</span></a>                        <span class="mi">0</span><span class="p">,</span> <span class="n">cube_shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">10</span>
</span><span id="SeismicVolume-965"><a href="#-965"><span class="linenos"> 965</span></a>                    <span class="p">)</span>
</span><span id="SeismicVolume-966"><a href="#-966"><span class="linenos"> 966</span></a>                <span class="p">)</span>
</span><span id="SeismicVolume-967"><a href="#-967"><span class="linenos"> 967</span></a>
</span><span id="SeismicVolume-968"><a href="#-968"><span class="linenos"> 968</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="SeismicVolume-969"><a href="#-969"><span class="linenos"> 969</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="SeismicVolume-970"><a href="#-970"><span class="linenos"> 970</span></a>                        <span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> ... Perform fluid substitution for gas sands. &quot;</span><span class="p">,</span>
</span><span id="SeismicVolume-971"><a href="#-971"><span class="linenos"> 971</span></a>                        <span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> ... Number gas voxels in closure = &quot;</span><span class="p">,</span>
</span><span id="SeismicVolume-972"><a href="#-972"><span class="linenos"> 972</span></a>                        <span class="n">mixed_properties</span><span class="o">.</span><span class="n">rho</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
</span><span id="SeismicVolume-973"><a href="#-973"><span class="linenos"> 973</span></a>                    <span class="p">)</span>
</span><span id="SeismicVolume-974"><a href="#-974"><span class="linenos"> 974</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="SeismicVolume-975"><a href="#-975"><span class="linenos"> 975</span></a>                        <span class="s2">&quot; ... closures_gas min/mean/max =  &quot;</span><span class="p">,</span>
</span><span id="SeismicVolume-976"><a href="#-976"><span class="linenos"> 976</span></a>                        <span class="n">gas_closures</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
</span><span id="SeismicVolume-977"><a href="#-977"><span class="linenos"> 977</span></a>                        <span class="n">gas_closures</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span>
</span><span id="SeismicVolume-978"><a href="#-978"><span class="linenos"> 978</span></a>                        <span class="n">gas_closures</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span>
</span><span id="SeismicVolume-979"><a href="#-979"><span class="linenos"> 979</span></a>                    <span class="p">)</span>
</span><span id="SeismicVolume-980"><a href="#-980"><span class="linenos"> 980</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="SeismicVolume-981"><a href="#-981"><span class="linenos"> 981</span></a>                        <span class="s2">&quot; ... gas: (delta_z_rho, delta_z_vp, delta_z_vs) = &quot;</span>
</span><span id="SeismicVolume-982"><a href="#-982"><span class="linenos"> 982</span></a>                        <span class="o">+</span> <span class="nb">str</span><span class="p">((</span><span class="n">delta_z_rho</span><span class="p">,</span> <span class="n">delta_z_vp</span><span class="p">,</span> <span class="n">delta_z_vs</span><span class="p">))</span>
</span><span id="SeismicVolume-983"><a href="#-983"><span class="linenos"> 983</span></a>                    <span class="p">)</span>
</span><span id="SeismicVolume-984"><a href="#-984"><span class="linenos"> 984</span></a>
</span><span id="SeismicVolume-985"><a href="#-985"><span class="linenos"> 985</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="SeismicVolume-986"><a href="#-986"><span class="linenos"> 986</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; ... gas: i = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">i</span><span class="p">)))</span>
</span><span id="SeismicVolume-987"><a href="#-987"><span class="linenos"> 987</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; ... gas: k = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">k</span><span class="p">)))</span>
</span><span id="SeismicVolume-988"><a href="#-988"><span class="linenos"> 988</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; ... gas: _k = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">_k_rho</span><span class="p">)))</span>
</span><span id="SeismicVolume-989"><a href="#-989"><span class="linenos"> 989</span></a>
</span><span id="SeismicVolume-990"><a href="#-990"><span class="linenos"> 990</span></a>                <span class="n">mixed_properties</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_sands</span><span class="p">(</span>
</span><span id="SeismicVolume-991"><a href="#-991"><span class="linenos"> 991</span></a>                    <span class="n">xyz</span><span class="o">=</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span>
</span><span id="SeismicVolume-992"><a href="#-992"><span class="linenos"> 992</span></a>                    <span class="n">shifts</span><span class="o">=</span><span class="p">(</span><span class="n">_k_rho</span><span class="p">,</span> <span class="n">_k_vp</span><span class="p">,</span> <span class="n">_k_vs</span><span class="p">),</span>
</span><span id="SeismicVolume-993"><a href="#-993"><span class="linenos"> 993</span></a>                    <span class="n">props</span><span class="o">=</span><span class="n">mixed_properties</span><span class="p">,</span>
</span><span id="SeismicVolume-994"><a href="#-994"><span class="linenos"> 994</span></a>                    <span class="n">rpm</span><span class="o">=</span><span class="n">rpm</span><span class="p">,</span>
</span><span id="SeismicVolume-995"><a href="#-995"><span class="linenos"> 995</span></a>                    <span class="n">depth</span><span class="o">=</span><span class="n">depth</span><span class="p">,</span>
</span><span id="SeismicVolume-996"><a href="#-996"><span class="linenos"> 996</span></a>                    <span class="n">ng</span><span class="o">=</span><span class="n">net_to_gross</span><span class="p">,</span>
</span><span id="SeismicVolume-997"><a href="#-997"><span class="linenos"> 997</span></a>                    <span class="n">z</span><span class="o">=</span><span class="n">z</span><span class="p">,</span>
</span><span id="SeismicVolume-998"><a href="#-998"><span class="linenos"> 998</span></a>                    <span class="n">fluid</span><span class="o">=</span><span class="s2">&quot;gas&quot;</span><span class="p">,</span>
</span><span id="SeismicVolume-999"><a href="#-999"><span class="linenos"> 999</span></a>                    <span class="n">mix</span><span class="o">=</span><span class="n">mixing_method</span><span class="p">,</span>
</span><span id="SeismicVolume-1000"><a href="#-1000"><span class="linenos">1000</span></a>                <span class="p">)</span>
</span><span id="SeismicVolume-1001"><a href="#-1001"><span class="linenos">1001</span></a>
</span><span id="SeismicVolume-1002"><a href="#-1002"><span class="linenos">1002</span></a>            <span class="c1"># layer check</span>
</span><span id="SeismicVolume-1003"><a href="#-1003"><span class="linenos">1003</span></a>            <span class="n">__i</span><span class="p">,</span> <span class="n">__j</span><span class="p">,</span> <span class="n">__k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">integer_faulted_age</span> <span class="o">==</span> <span class="n">z</span><span class="p">)</span>
</span><span id="SeismicVolume-1004"><a href="#-1004"><span class="linenos">1004</span></a>
</span><span id="SeismicVolume-1005"><a href="#-1005"><span class="linenos">1005</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">__k</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="SeismicVolume-1006"><a href="#-1006"><span class="linenos">1006</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="SeismicVolume-1007"><a href="#-1007"><span class="linenos">1007</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="SeismicVolume-1008"><a href="#-1008"><span class="linenos">1008</span></a>                        <span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> ... layer number = &quot;</span>
</span><span id="SeismicVolume-1009"><a href="#-1009"><span class="linenos">1009</span></a>                        <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
</span><span id="SeismicVolume-1010"><a href="#-1010"><span class="linenos">1010</span></a>                        <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> ... sum_net (min,mean,max) = &quot;</span>
</span><span id="SeismicVolume-1011"><a href="#-1011"><span class="linenos">1011</span></a>                        <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="SeismicVolume-1012"><a href="#-1012"><span class="linenos">1012</span></a>                            <span class="p">(</span>
</span><span id="SeismicVolume-1013"><a href="#-1013"><span class="linenos">1013</span></a>                                <span class="n">mixed_properties</span><span class="o">.</span><span class="n">sum_net</span><span class="p">[</span><span class="n">__i</span><span class="p">,</span> <span class="n">__j</span><span class="p">,</span> <span class="n">__k</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
</span><span id="SeismicVolume-1014"><a href="#-1014"><span class="linenos">1014</span></a>                                <span class="n">mixed_properties</span><span class="o">.</span><span class="n">sum_net</span><span class="p">[</span><span class="n">__i</span><span class="p">,</span> <span class="n">__j</span><span class="p">,</span> <span class="n">__k</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span>
</span><span id="SeismicVolume-1015"><a href="#-1015"><span class="linenos">1015</span></a>                                <span class="n">mixed_properties</span><span class="o">.</span><span class="n">sum_net</span><span class="p">[</span><span class="n">__i</span><span class="p">,</span> <span class="n">__j</span><span class="p">,</span> <span class="n">__k</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span>
</span><span id="SeismicVolume-1016"><a href="#-1016"><span class="linenos">1016</span></a>                            <span class="p">)</span>
</span><span id="SeismicVolume-1017"><a href="#-1017"><span class="linenos">1017</span></a>                        <span class="p">)</span>
</span><span id="SeismicVolume-1018"><a href="#-1018"><span class="linenos">1018</span></a>                    <span class="p">)</span>
</span><span id="SeismicVolume-1019"><a href="#-1019"><span class="linenos">1019</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="SeismicVolume-1020"><a href="#-1020"><span class="linenos">1020</span></a>                        <span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> ... layer number = &quot;</span>
</span><span id="SeismicVolume-1021"><a href="#-1021"><span class="linenos">1021</span></a>                        <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
</span><span id="SeismicVolume-1022"><a href="#-1022"><span class="linenos">1022</span></a>                        <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> ... (shale, brine, oil, gas) voxel_counts = &quot;</span>
</span><span id="SeismicVolume-1023"><a href="#-1023"><span class="linenos">1023</span></a>                        <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="SeismicVolume-1024"><a href="#-1024"><span class="linenos">1024</span></a>                            <span class="p">(</span>
</span><span id="SeismicVolume-1025"><a href="#-1025"><span class="linenos">1025</span></a>                                <span class="n">shale_voxel_count</span><span class="p">,</span>
</span><span id="SeismicVolume-1026"><a href="#-1026"><span class="linenos">1026</span></a>                                <span class="n">brine_voxel_count</span><span class="p">,</span>
</span><span id="SeismicVolume-1027"><a href="#-1027"><span class="linenos">1027</span></a>                                <span class="n">oil_voxel_count</span><span class="p">,</span>
</span><span id="SeismicVolume-1028"><a href="#-1028"><span class="linenos">1028</span></a>                                <span class="n">gas_voxel_count</span><span class="p">,</span>
</span><span id="SeismicVolume-1029"><a href="#-1029"><span class="linenos">1029</span></a>                            <span class="p">)</span>
</span><span id="SeismicVolume-1030"><a href="#-1030"><span class="linenos">1030</span></a>                        <span class="p">)</span>
</span><span id="SeismicVolume-1031"><a href="#-1031"><span class="linenos">1031</span></a>                        <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> ... shale_count = brine+oil+gas? &quot;</span>
</span><span id="SeismicVolume-1032"><a href="#-1032"><span class="linenos">1032</span></a>                        <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="SeismicVolume-1033"><a href="#-1033"><span class="linenos">1033</span></a>                            <span class="n">shale_voxel_count</span>
</span><span id="SeismicVolume-1034"><a href="#-1034"><span class="linenos">1034</span></a>                            <span class="o">==</span> <span class="n">brine_voxel_count</span> <span class="o">+</span> <span class="n">oil_voxel_count</span> <span class="o">+</span> <span class="n">gas_voxel_count</span>
</span><span id="SeismicVolume-1035"><a href="#-1035"><span class="linenos">1035</span></a>                        <span class="p">)</span>
</span><span id="SeismicVolume-1036"><a href="#-1036"><span class="linenos">1036</span></a>                        <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">*********************&quot;</span>
</span><span id="SeismicVolume-1037"><a href="#-1037"><span class="linenos">1037</span></a>                    <span class="p">)</span>
</span><span id="SeismicVolume-1038"><a href="#-1038"><span class="linenos">1038</span></a>
</span><span id="SeismicVolume-1039"><a href="#-1039"><span class="linenos">1039</span></a>        <span class="c1"># overwrite rho, vp, vs for salt if required</span>
</span><span id="SeismicVolume-1040"><a href="#-1040"><span class="linenos">1040</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">include_salt</span><span class="p">:</span>
</span><span id="SeismicVolume-1041"><a href="#-1041"><span class="linenos">1041</span></a>            <span class="c1"># Salt. Set lith = 2.0</span>
</span><span id="SeismicVolume-1042"><a href="#-1042"><span class="linenos">1042</span></a>            <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">lith</span> <span class="o">==</span> <span class="mf">2.0</span><span class="p">)</span>
</span><span id="SeismicVolume-1043"><a href="#-1043"><span class="linenos">1043</span></a>            <span class="n">mixed_properties</span><span class="o">.</span><span class="n">rho</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">2.17</span>  <span class="c1"># divide by 2 since lith = 2.0</span>
</span><span id="SeismicVolume-1044"><a href="#-1044"><span class="linenos">1044</span></a>            <span class="n">mixed_properties</span><span class="o">.</span><span class="n">vp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">4500.0</span>
</span><span id="SeismicVolume-1045"><a href="#-1045"><span class="linenos">1045</span></a>            <span class="n">mixed_properties</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">2250.0</span>
</span><span id="SeismicVolume-1046"><a href="#-1046"><span class="linenos">1046</span></a>            <span class="c1"># Include fluidfactor rho, vp, vs inside salt body</span>
</span><span id="SeismicVolume-1047"><a href="#-1047"><span class="linenos">1047</span></a>            <span class="n">mixed_properties</span><span class="o">.</span><span class="n">rho_ff</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">mixed_properties</span><span class="o">.</span><span class="n">rho</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span>
</span><span id="SeismicVolume-1048"><a href="#-1048"><span class="linenos">1048</span></a>            <span class="n">mixed_properties</span><span class="o">.</span><span class="n">vp_ff</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">mixed_properties</span><span class="o">.</span><span class="n">vp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span>
</span><span id="SeismicVolume-1049"><a href="#-1049"><span class="linenos">1049</span></a>            <span class="n">mixed_properties</span><span class="o">.</span><span class="n">vs_ff</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">mixed_properties</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span>
</span><span id="SeismicVolume-1050"><a href="#-1050"><span class="linenos">1050</span></a>
</span><span id="SeismicVolume-1051"><a href="#-1051"><span class="linenos">1051</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="SeismicVolume-1052"><a href="#-1052"><span class="linenos">1052</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Checking for null values inside build_randomised_properties:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="SeismicVolume-1053"><a href="#-1053"><span class="linenos">1053</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="SeismicVolume-1054"><a href="#-1054"><span class="linenos">1054</span></a>                <span class="sa">f</span><span class="s2">&quot;Rho: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">mixed_properties</span><span class="o">.</span><span class="n">rho</span><span class="p">)</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">mixed_properties</span><span class="o">.</span><span class="n">rho</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="SeismicVolume-1055"><a href="#-1055"><span class="linenos">1055</span></a>            <span class="p">)</span>
</span><span id="SeismicVolume-1056"><a href="#-1056"><span class="linenos">1056</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Vp: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">mixed_properties</span><span class="o">.</span><span class="n">vp</span><span class="p">)</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">mixed_properties</span><span class="o">.</span><span class="n">vp</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="SeismicVolume-1057"><a href="#-1057"><span class="linenos">1057</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Vs: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">mixed_properties</span><span class="o">.</span><span class="n">vs</span><span class="p">)</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">mixed_properties</span><span class="o">.</span><span class="n">vs</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="SeismicVolume-1058"><a href="#-1058"><span class="linenos">1058</span></a>
</span><span id="SeismicVolume-1059"><a href="#-1059"><span class="linenos">1059</span></a>        <span class="c1"># Fix empty voxels at base of property volumes</span>
</span><span id="SeismicVolume-1060"><a href="#-1060"><span class="linenos">1060</span></a>        <span class="n">mixed_properties</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fix_zero_values_at_base</span><span class="p">(</span><span class="n">mixed_properties</span><span class="p">)</span>
</span><span id="SeismicVolume-1061"><a href="#-1061"><span class="linenos">1061</span></a>
</span><span id="SeismicVolume-1062"><a href="#-1062"><span class="linenos">1062</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="SeismicVolume-1063"><a href="#-1063"><span class="linenos">1063</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="SeismicVolume-1064"><a href="#-1064"><span class="linenos">1064</span></a>                <span class="s2">&quot;Checking for null values inside build_randomised_properties AFTER fix:</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="SeismicVolume-1065"><a href="#-1065"><span class="linenos">1065</span></a>            <span class="p">)</span>
</span><span id="SeismicVolume-1066"><a href="#-1066"><span class="linenos">1066</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="SeismicVolume-1067"><a href="#-1067"><span class="linenos">1067</span></a>                <span class="sa">f</span><span class="s2">&quot;Rho: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">mixed_properties</span><span class="o">.</span><span class="n">rho</span><span class="p">)</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">mixed_properties</span><span class="o">.</span><span class="n">rho</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="SeismicVolume-1068"><a href="#-1068"><span class="linenos">1068</span></a>            <span class="p">)</span>
</span><span id="SeismicVolume-1069"><a href="#-1069"><span class="linenos">1069</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Vp: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">mixed_properties</span><span class="o">.</span><span class="n">vp</span><span class="p">)</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">mixed_properties</span><span class="o">.</span><span class="n">vp</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="SeismicVolume-1070"><a href="#-1070"><span class="linenos">1070</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Vs: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">mixed_properties</span><span class="o">.</span><span class="n">vs</span><span class="p">)</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">mixed_properties</span><span class="o">.</span><span class="n">vs</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="SeismicVolume-1071"><a href="#-1071"><span class="linenos">1071</span></a>
</span><span id="SeismicVolume-1072"><a href="#-1072"><span class="linenos">1072</span></a>        <span class="n">mixed_properties</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_scaling_factors</span><span class="p">(</span>
</span><span id="SeismicVolume-1073"><a href="#-1073"><span class="linenos">1073</span></a>            <span class="n">mixed_properties</span><span class="p">,</span> <span class="n">net_to_gross</span><span class="p">,</span> <span class="n">lith</span>
</span><span id="SeismicVolume-1074"><a href="#-1074"><span class="linenos">1074</span></a>        <span class="p">)</span>
</span><span id="SeismicVolume-1075"><a href="#-1075"><span class="linenos">1075</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">rho</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">mixed_properties</span><span class="o">.</span><span class="n">rho</span>
</span><span id="SeismicVolume-1076"><a href="#-1076"><span class="linenos">1076</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vp</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">mixed_properties</span><span class="o">.</span><span class="n">vp</span>
</span><span id="SeismicVolume-1077"><a href="#-1077"><span class="linenos">1077</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vs</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">mixed_properties</span><span class="o">.</span><span class="n">vs</span>
</span><span id="SeismicVolume-1078"><a href="#-1078"><span class="linenos">1078</span></a>
</span><span id="SeismicVolume-1079"><a href="#-1079"><span class="linenos">1079</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">rho_ff</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">mixed_properties</span><span class="o">.</span><span class="n">rho_ff</span>
</span><span id="SeismicVolume-1080"><a href="#-1080"><span class="linenos">1080</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vp_ff</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">mixed_properties</span><span class="o">.</span><span class="n">vp_ff</span>
</span><span id="SeismicVolume-1081"><a href="#-1081"><span class="linenos">1081</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vs_ff</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">mixed_properties</span><span class="o">.</span><span class="n">vs_ff</span>
</span><span id="SeismicVolume-1082"><a href="#-1082"><span class="linenos">1082</span></a>
</span><span id="SeismicVolume-1083"><a href="#-1083"><span class="linenos">1083</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">qc_plots</span><span class="p">:</span>
</span><span id="SeismicVolume-1084"><a href="#-1084"><span class="linenos">1084</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Creating RPM qc plots&quot;</span><span class="p">)</span>
</span><span id="SeismicVolume-1085"><a href="#-1085"><span class="linenos">1085</span></a>            <span class="kn">from</span> <span class="nn">rockphysics.RockPropertyModels</span> <span class="kn">import</span> <span class="n">rpm_qc_plots</span>
</span><span id="SeismicVolume-1086"><a href="#-1086"><span class="linenos">1086</span></a>
</span><span id="SeismicVolume-1087"><a href="#-1087"><span class="linenos">1087</span></a>            <span class="n">rpm_qc_plots</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="p">,</span> <span class="n">rpm</span><span class="p">)</span>
</span><span id="SeismicVolume-1088"><a href="#-1088"><span class="linenos">1088</span></a>
</span><span id="SeismicVolume-1089"><a href="#-1089"><span class="linenos">1089</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">model_qc_volumes</span><span class="p">:</span>
</span><span id="SeismicVolume-1090"><a href="#-1090"><span class="linenos">1090</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">write_property_volumes_to_disk</span><span class="p">()</span>
</span><span id="SeismicVolume-1091"><a href="#-1091"><span class="linenos">1091</span></a>
</span><span id="SeismicVolume-1092"><a href="#-1092"><span class="linenos">1092</span></a>    <span class="k">def</span> <span class="nf">water_properties</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lith</span><span class="p">,</span> <span class="n">properties</span><span class="p">):</span>
</span><span id="SeismicVolume-1093"><a href="#-1093"><span class="linenos">1093</span></a>        <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">lith</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">)</span>
</span><span id="SeismicVolume-1094"><a href="#-1094"><span class="linenos">1094</span></a>        <span class="n">properties</span><span class="o">.</span><span class="n">rho</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.028</span>
</span><span id="SeismicVolume-1095"><a href="#-1095"><span class="linenos">1095</span></a>        <span class="n">properties</span><span class="o">.</span><span class="n">vp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1500.0</span>
</span><span id="SeismicVolume-1096"><a href="#-1096"><span class="linenos">1096</span></a>        <span class="n">properties</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1000.0</span>
</span><span id="SeismicVolume-1097"><a href="#-1097"><span class="linenos">1097</span></a>        <span class="k">return</span> <span class="n">properties</span>
</span><span id="SeismicVolume-1098"><a href="#-1098"><span class="linenos">1098</span></a>
</span><span id="SeismicVolume-1099"><a href="#-1099"><span class="linenos">1099</span></a>    <span class="k">def</span> <span class="nf">get_delta_z_layer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">half_range</span><span class="p">,</span> <span class="n">z_cells</span><span class="p">):</span>
</span><span id="SeismicVolume-1100"><a href="#-1100"><span class="linenos">1100</span></a>        <span class="k">if</span> <span class="n">z</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_random_lyr</span><span class="p">:</span>
</span><span id="SeismicVolume-1101"><a href="#-1101"><span class="linenos">1101</span></a>            <span class="n">delta_z_layer</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="n">half_range</span><span class="p">,</span> <span class="n">half_range</span><span class="p">))</span>
</span><span id="SeismicVolume-1102"><a href="#-1102"><span class="linenos">1102</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SeismicVolume-1103"><a href="#-1103"><span class="linenos">1103</span></a>            <span class="n">delta_z_layer</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="SeismicVolume-1104"><a href="#-1104"><span class="linenos">1104</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="SeismicVolume-1105"><a href="#-1105"><span class="linenos">1105</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; .... Layer </span><span class="si">{</span><span class="n">z</span><span class="si">}</span><span class="s2">: voxel_count = </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">z_cells</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="SeismicVolume-1106"><a href="#-1106"><span class="linenos">1106</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; .... Layer </span><span class="si">{</span><span class="n">z</span><span class="si">}</span><span class="s2">: delta_z_layer = </span><span class="si">{</span><span class="n">delta_z_layer</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="SeismicVolume-1107"><a href="#-1107"><span class="linenos">1107</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="SeismicVolume-1108"><a href="#-1108"><span class="linenos">1108</span></a>                <span class="sa">f</span><span class="s2">&quot; .... Layer </span><span class="si">{</span><span class="n">z</span><span class="si">}</span><span class="s2">: z-range (m): </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">z_cells</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">digi</span><span class="si">}</span><span class="s2">, &quot;</span>
</span><span id="SeismicVolume-1109"><a href="#-1109"><span class="linenos">1109</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">z_cells</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">digi</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="SeismicVolume-1110"><a href="#-1110"><span class="linenos">1110</span></a>            <span class="p">)</span>
</span><span id="SeismicVolume-1111"><a href="#-1111"><span class="linenos">1111</span></a>        <span class="k">return</span> <span class="n">delta_z_layer</span>
</span><span id="SeismicVolume-1112"><a href="#-1112"><span class="linenos">1112</span></a>
</span><span id="SeismicVolume-1113"><a href="#-1113"><span class="linenos">1113</span></a>    <span class="k">def</span> <span class="nf">get_delta_z_properties</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">half_range</span><span class="p">):</span>
</span><span id="SeismicVolume-1114"><a href="#-1114"><span class="linenos">1114</span></a>        <span class="k">if</span> <span class="n">z</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_random_lyr</span><span class="p">:</span>
</span><span id="SeismicVolume-1115"><a href="#-1115"><span class="linenos">1115</span></a>            <span class="n">delta_z_rho</span><span class="p">,</span> <span class="n">delta_z_vp</span><span class="p">,</span> <span class="n">delta_z_vs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">random_z_rho_vp_vs</span><span class="p">(</span>
</span><span id="SeismicVolume-1116"><a href="#-1116"><span class="linenos">1116</span></a>                <span class="n">dmin</span><span class="o">=-</span><span class="n">half_range</span><span class="p">,</span> <span class="n">dmax</span><span class="o">=</span><span class="n">half_range</span>
</span><span id="SeismicVolume-1117"><a href="#-1117"><span class="linenos">1117</span></a>            <span class="p">)</span>
</span><span id="SeismicVolume-1118"><a href="#-1118"><span class="linenos">1118</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SeismicVolume-1119"><a href="#-1119"><span class="linenos">1119</span></a>            <span class="n">delta_z_rho</span><span class="p">,</span> <span class="n">delta_z_vp</span><span class="p">,</span> <span class="n">delta_z_vs</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="SeismicVolume-1120"><a href="#-1120"><span class="linenos">1120</span></a>        <span class="k">return</span> <span class="n">delta_z_rho</span><span class="p">,</span> <span class="n">delta_z_vp</span><span class="p">,</span> <span class="n">delta_z_vs</span>
</span><span id="SeismicVolume-1121"><a href="#-1121"><span class="linenos">1121</span></a>
</span><span id="SeismicVolume-1122"><a href="#-1122"><span class="linenos">1122</span></a>    <span class="k">def</span> <span class="nf">calculate_shales</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xyz</span><span class="p">,</span> <span class="n">shifts</span><span class="p">,</span> <span class="n">props</span><span class="p">,</span> <span class="n">rpm</span><span class="p">,</span> <span class="n">depth</span><span class="p">,</span> <span class="n">z</span><span class="p">):</span>
</span><span id="SeismicVolume-1123"><a href="#-1123"><span class="linenos">1123</span></a>        <span class="c1"># Shales required for all voxels, other than water</span>
</span><span id="SeismicVolume-1124"><a href="#-1124"><span class="linenos">1124</span></a>        <span class="c1"># Calculate the properties, select how to mix with other facies later</span>
</span><span id="SeismicVolume-1125"><a href="#-1125"><span class="linenos">1125</span></a>        <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">xyz</span>
</span><span id="SeismicVolume-1126"><a href="#-1126"><span class="linenos">1126</span></a>        <span class="n">k_rho</span><span class="p">,</span> <span class="n">k_vp</span><span class="p">,</span> <span class="n">k_vs</span> <span class="o">=</span> <span class="n">shifts</span>
</span><span id="SeismicVolume-1127"><a href="#-1127"><span class="linenos">1127</span></a>
</span><span id="SeismicVolume-1128"><a href="#-1128"><span class="linenos">1128</span></a>        <span class="n">z_rho</span> <span class="o">=</span> <span class="n">depth</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k_rho</span><span class="p">]</span>
</span><span id="SeismicVolume-1129"><a href="#-1129"><span class="linenos">1129</span></a>        <span class="n">z_vp</span> <span class="o">=</span> <span class="n">depth</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k_vp</span><span class="p">]</span>
</span><span id="SeismicVolume-1130"><a href="#-1130"><span class="linenos">1130</span></a>        <span class="n">z_vs</span> <span class="o">=</span> <span class="n">depth</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k_vs</span><span class="p">]</span>
</span><span id="SeismicVolume-1131"><a href="#-1131"><span class="linenos">1131</span></a>        <span class="n">shales</span> <span class="o">=</span> <span class="n">rpm</span><span class="o">.</span><span class="n">calc_shale_properties</span><span class="p">(</span><span class="n">z_rho</span><span class="p">,</span> <span class="n">z_vp</span><span class="p">,</span> <span class="n">z_vs</span><span class="p">)</span>
</span><span id="SeismicVolume-1132"><a href="#-1132"><span class="linenos">1132</span></a>
</span><span id="SeismicVolume-1133"><a href="#-1133"><span class="linenos">1133</span></a>        <span class="c1"># Do not use net to gross here.</span>
</span><span id="SeismicVolume-1134"><a href="#-1134"><span class="linenos">1134</span></a>        <span class="c1"># Since every voxel will have some shale in, apply the net to gross</span>
</span><span id="SeismicVolume-1135"><a href="#-1135"><span class="linenos">1135</span></a>        <span class="c1"># when combining shales and sands</span>
</span><span id="SeismicVolume-1136"><a href="#-1136"><span class="linenos">1136</span></a>        <span class="c1"># _ng = (1.0 - ng[i, j, k])</span>
</span><span id="SeismicVolume-1137"><a href="#-1137"><span class="linenos">1137</span></a>
</span><span id="SeismicVolume-1138"><a href="#-1138"><span class="linenos">1138</span></a>        <span class="n">props</span><span class="o">.</span><span class="n">rho</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">shales</span><span class="o">.</span><span class="n">rho</span>  <span class="c1"># * _ng</span>
</span><span id="SeismicVolume-1139"><a href="#-1139"><span class="linenos">1139</span></a>        <span class="n">props</span><span class="o">.</span><span class="n">rho_ff</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">shales</span><span class="o">.</span><span class="n">rho</span>  <span class="c1"># * _ng</span>
</span><span id="SeismicVolume-1140"><a href="#-1140"><span class="linenos">1140</span></a>        <span class="n">props</span><span class="o">.</span><span class="n">vp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">shales</span><span class="o">.</span><span class="n">vp</span>  <span class="c1"># * _ng</span>
</span><span id="SeismicVolume-1141"><a href="#-1141"><span class="linenos">1141</span></a>        <span class="n">props</span><span class="o">.</span><span class="n">vp_ff</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">shales</span><span class="o">.</span><span class="n">vp</span>  <span class="c1"># * _ng</span>
</span><span id="SeismicVolume-1142"><a href="#-1142"><span class="linenos">1142</span></a>        <span class="n">props</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">shales</span><span class="o">.</span><span class="n">vs</span>  <span class="c1"># * _ng</span>
</span><span id="SeismicVolume-1143"><a href="#-1143"><span class="linenos">1143</span></a>        <span class="n">props</span><span class="o">.</span><span class="n">vs_ff</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">shales</span><span class="o">.</span><span class="n">vs</span>  <span class="c1"># * _ng</span>
</span><span id="SeismicVolume-1144"><a href="#-1144"><span class="linenos">1144</span></a>        <span class="c1"># props.sum_net[i, j, k] = _ng</span>
</span><span id="SeismicVolume-1145"><a href="#-1145"><span class="linenos">1145</span></a>
</span><span id="SeismicVolume-1146"><a href="#-1146"><span class="linenos">1146</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span> <span class="ow">and</span> <span class="n">z</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_random_lyr</span><span class="p">:</span>
</span><span id="SeismicVolume-1147"><a href="#-1147"><span class="linenos">1147</span></a>            <span class="c1"># Calculate non-randomised properties and differences</span>
</span><span id="SeismicVolume-1148"><a href="#-1148"><span class="linenos">1148</span></a>            <span class="n">_z0</span> <span class="o">=</span> <span class="n">depth</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span>
</span><span id="SeismicVolume-1149"><a href="#-1149"><span class="linenos">1149</span></a>            <span class="n">_shales0</span> <span class="o">=</span> <span class="n">rpm</span><span class="o">.</span><span class="n">calc_shale_properties</span><span class="p">(</span><span class="n">_z0</span><span class="p">,</span> <span class="n">_z0</span><span class="p">,</span> <span class="n">_z0</span><span class="p">)</span>
</span><span id="SeismicVolume-1150"><a href="#-1150"><span class="linenos">1150</span></a>            <span class="n">props</span><span class="o">.</span><span class="n">rho_not_random</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">_shales0</span><span class="o">.</span><span class="n">rho</span>  <span class="c1"># * _ng</span>
</span><span id="SeismicVolume-1151"><a href="#-1151"><span class="linenos">1151</span></a>            <span class="n">props</span><span class="o">.</span><span class="n">vp_not_random</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">_shales0</span><span class="o">.</span><span class="n">vp</span>  <span class="c1"># * _ng</span>
</span><span id="SeismicVolume-1152"><a href="#-1152"><span class="linenos">1152</span></a>            <span class="n">props</span><span class="o">.</span><span class="n">vs_not_random</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">_shales0</span><span class="o">.</span><span class="n">vs</span>  <span class="c1"># * _ng</span>
</span><span id="SeismicVolume-1153"><a href="#-1153"><span class="linenos">1153</span></a>
</span><span id="SeismicVolume-1154"><a href="#-1154"><span class="linenos">1154</span></a>            <span class="n">delta_rho</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="p">(</span><span class="n">props</span><span class="o">.</span><span class="n">rho</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">/</span> <span class="n">props</span><span class="o">.</span><span class="n">rho_not_random</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">])</span>
</span><span id="SeismicVolume-1155"><a href="#-1155"><span class="linenos">1155</span></a>            <span class="n">delta_vp</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="p">(</span><span class="n">props</span><span class="o">.</span><span class="n">vp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">/</span> <span class="n">props</span><span class="o">.</span><span class="n">vp_not_random</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">])</span>
</span><span id="SeismicVolume-1156"><a href="#-1156"><span class="linenos">1156</span></a>            <span class="n">delta_vs</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="p">(</span><span class="n">props</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">/</span> <span class="n">props</span><span class="o">.</span><span class="n">vs_not_random</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">])</span>
</span><span id="SeismicVolume-1157"><a href="#-1157"><span class="linenos">1157</span></a>            <span class="n">pct_change_rho</span> <span class="o">=</span> <span class="n">delta_rho</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span id="SeismicVolume-1158"><a href="#-1158"><span class="linenos">1158</span></a>            <span class="n">pct_change_vp</span> <span class="o">=</span> <span class="n">delta_vp</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span id="SeismicVolume-1159"><a href="#-1159"><span class="linenos">1159</span></a>            <span class="n">pct_change_vs</span> <span class="o">=</span> <span class="n">delta_vs</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span id="SeismicVolume-1160"><a href="#-1160"><span class="linenos">1160</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="SeismicVolume-1161"><a href="#-1161"><span class="linenos">1161</span></a>                <span class="sa">f</span><span class="s2">&quot; ... shale: randomization percent change (rho,vp,vs) = &quot;</span>
</span><span id="SeismicVolume-1162"><a href="#-1162"><span class="linenos">1162</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">pct_change_rho</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">pct_change_vp</span> <span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">pct_change_vs</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="SeismicVolume-1163"><a href="#-1163"><span class="linenos">1163</span></a>            <span class="p">)</span>
</span><span id="SeismicVolume-1164"><a href="#-1164"><span class="linenos">1164</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="SeismicVolume-1165"><a href="#-1165"><span class="linenos">1165</span></a>                <span class="sa">f</span><span class="s2">&quot; ... shale: min/max pre-randomization (rho, vp, vs)  = &quot;</span>
</span><span id="SeismicVolume-1166"><a href="#-1166"><span class="linenos">1166</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">props</span><span class="o">.</span><span class="n">rho_not_random</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">])</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2"> - &quot;</span>
</span><span id="SeismicVolume-1167"><a href="#-1167"><span class="linenos">1167</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">props</span><span class="o">.</span><span class="n">rho_not_random</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">])</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">, &quot;</span>
</span><span id="SeismicVolume-1168"><a href="#-1168"><span class="linenos">1168</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">props</span><span class="o">.</span><span class="n">vp_not_random</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">])</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> - &quot;</span>
</span><span id="SeismicVolume-1169"><a href="#-1169"><span class="linenos">1169</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">props</span><span class="o">.</span><span class="n">vp_not_random</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">])</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, &quot;</span>
</span><span id="SeismicVolume-1170"><a href="#-1170"><span class="linenos">1170</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">props</span><span class="o">.</span><span class="n">vs_not_random</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">])</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> - &quot;</span>
</span><span id="SeismicVolume-1171"><a href="#-1171"><span class="linenos">1171</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">props</span><span class="o">.</span><span class="n">vs_not_random</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">])</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="SeismicVolume-1172"><a href="#-1172"><span class="linenos">1172</span></a>            <span class="p">)</span>
</span><span id="SeismicVolume-1173"><a href="#-1173"><span class="linenos">1173</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="SeismicVolume-1174"><a href="#-1174"><span class="linenos">1174</span></a>                <span class="sa">f</span><span class="s2">&quot; ... shale: min/max post-randomization (rho, vp, vs) = &quot;</span>
</span><span id="SeismicVolume-1175"><a href="#-1175"><span class="linenos">1175</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">props</span><span class="o">.</span><span class="n">rho</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">])</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2"> - &quot;</span>
</span><span id="SeismicVolume-1176"><a href="#-1176"><span class="linenos">1176</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">props</span><span class="o">.</span><span class="n">rho</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">])</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">, &quot;</span>
</span><span id="SeismicVolume-1177"><a href="#-1177"><span class="linenos">1177</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">props</span><span class="o">.</span><span class="n">vp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">])</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> - &quot;</span>
</span><span id="SeismicVolume-1178"><a href="#-1178"><span class="linenos">1178</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">props</span><span class="o">.</span><span class="n">vp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">])</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, &quot;</span>
</span><span id="SeismicVolume-1179"><a href="#-1179"><span class="linenos">1179</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">props</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">])</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> - &quot;</span>
</span><span id="SeismicVolume-1180"><a href="#-1180"><span class="linenos">1180</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">props</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">])</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="SeismicVolume-1181"><a href="#-1181"><span class="linenos">1181</span></a>            <span class="p">)</span>
</span><span id="SeismicVolume-1182"><a href="#-1182"><span class="linenos">1182</span></a>
</span><span id="SeismicVolume-1183"><a href="#-1183"><span class="linenos">1183</span></a>        <span class="k">return</span> <span class="n">props</span>
</span><span id="SeismicVolume-1184"><a href="#-1184"><span class="linenos">1184</span></a>
</span><span id="SeismicVolume-1185"><a href="#-1185"><span class="linenos">1185</span></a>    <span class="k">def</span> <span class="nf">calculate_sands</span><span class="p">(</span>
</span><span id="SeismicVolume-1186"><a href="#-1186"><span class="linenos">1186</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">xyz</span><span class="p">,</span> <span class="n">shifts</span><span class="p">,</span> <span class="n">props</span><span class="p">,</span> <span class="n">rpm</span><span class="p">,</span> <span class="n">depth</span><span class="p">,</span> <span class="n">ng</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">fluid</span><span class="p">,</span> <span class="n">mix</span><span class="o">=</span><span class="s2">&quot;inv_vel&quot;</span>
</span><span id="SeismicVolume-1187"><a href="#-1187"><span class="linenos">1187</span></a>    <span class="p">):</span>
</span><span id="SeismicVolume-1188"><a href="#-1188"><span class="linenos">1188</span></a>        <span class="c1"># brine sand or mixture of brine sand and shale in same voxel</span>
</span><span id="SeismicVolume-1189"><a href="#-1189"><span class="linenos">1189</span></a>        <span class="c1"># - perform velocity sums in slowness or via backus moduli mixing</span>
</span><span id="SeismicVolume-1190"><a href="#-1190"><span class="linenos">1190</span></a>        <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">xyz</span>
</span><span id="SeismicVolume-1191"><a href="#-1191"><span class="linenos">1191</span></a>        <span class="n">k_rho</span><span class="p">,</span> <span class="n">k_vp</span><span class="p">,</span> <span class="n">k_vs</span> <span class="o">=</span> <span class="n">shifts</span>
</span><span id="SeismicVolume-1192"><a href="#-1192"><span class="linenos">1192</span></a>
</span><span id="SeismicVolume-1193"><a href="#-1193"><span class="linenos">1193</span></a>        <span class="n">z_rho</span> <span class="o">=</span> <span class="n">depth</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k_rho</span><span class="p">]</span>
</span><span id="SeismicVolume-1194"><a href="#-1194"><span class="linenos">1194</span></a>        <span class="n">z_vp</span> <span class="o">=</span> <span class="n">depth</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k_vp</span><span class="p">]</span>
</span><span id="SeismicVolume-1195"><a href="#-1195"><span class="linenos">1195</span></a>        <span class="n">z_vs</span> <span class="o">=</span> <span class="n">depth</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k_vs</span><span class="p">]</span>
</span><span id="SeismicVolume-1196"><a href="#-1196"><span class="linenos">1196</span></a>        <span class="k">if</span> <span class="n">fluid</span> <span class="o">==</span> <span class="s2">&quot;brine&quot;</span><span class="p">:</span>
</span><span id="SeismicVolume-1197"><a href="#-1197"><span class="linenos">1197</span></a>            <span class="n">sands</span> <span class="o">=</span> <span class="n">rpm</span><span class="o">.</span><span class="n">calc_brine_sand_properties</span><span class="p">(</span><span class="n">z_rho</span><span class="p">,</span> <span class="n">z_vp</span><span class="p">,</span> <span class="n">z_vs</span><span class="p">)</span>
</span><span id="SeismicVolume-1198"><a href="#-1198"><span class="linenos">1198</span></a>        <span class="k">elif</span> <span class="n">fluid</span> <span class="o">==</span> <span class="s2">&quot;oil&quot;</span><span class="p">:</span>
</span><span id="SeismicVolume-1199"><a href="#-1199"><span class="linenos">1199</span></a>            <span class="n">sands</span> <span class="o">=</span> <span class="n">rpm</span><span class="o">.</span><span class="n">calc_oil_sand_properties</span><span class="p">(</span><span class="n">z_rho</span><span class="p">,</span> <span class="n">z_vp</span><span class="p">,</span> <span class="n">z_vs</span><span class="p">)</span>
</span><span id="SeismicVolume-1200"><a href="#-1200"><span class="linenos">1200</span></a>        <span class="k">elif</span> <span class="n">fluid</span> <span class="o">==</span> <span class="s2">&quot;gas&quot;</span><span class="p">:</span>
</span><span id="SeismicVolume-1201"><a href="#-1201"><span class="linenos">1201</span></a>            <span class="n">sands</span> <span class="o">=</span> <span class="n">rpm</span><span class="o">.</span><span class="n">calc_gas_sand_properties</span><span class="p">(</span><span class="n">z_rho</span><span class="p">,</span> <span class="n">z_vp</span><span class="p">,</span> <span class="n">z_vs</span><span class="p">)</span>
</span><span id="SeismicVolume-1202"><a href="#-1202"><span class="linenos">1202</span></a>
</span><span id="SeismicVolume-1203"><a href="#-1203"><span class="linenos">1203</span></a>        <span class="n">shales</span> <span class="o">=</span> <span class="n">RockProperties</span><span class="p">(</span>
</span><span id="SeismicVolume-1204"><a href="#-1204"><span class="linenos">1204</span></a>            <span class="n">rho</span><span class="o">=</span><span class="n">props</span><span class="o">.</span><span class="n">rho</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">],</span> <span class="n">vp</span><span class="o">=</span><span class="n">props</span><span class="o">.</span><span class="n">vp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">],</span> <span class="n">vs</span><span class="o">=</span><span class="n">props</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span>
</span><span id="SeismicVolume-1205"><a href="#-1205"><span class="linenos">1205</span></a>        <span class="p">)</span>
</span><span id="SeismicVolume-1206"><a href="#-1206"><span class="linenos">1206</span></a>        <span class="n">rpmix</span> <span class="o">=</span> <span class="n">EndMemberMixing</span><span class="p">(</span><span class="n">shales</span><span class="p">,</span> <span class="n">sands</span><span class="p">,</span> <span class="n">ng</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">])</span>
</span><span id="SeismicVolume-1207"><a href="#-1207"><span class="linenos">1207</span></a>
</span><span id="SeismicVolume-1208"><a href="#-1208"><span class="linenos">1208</span></a>        <span class="k">if</span> <span class="n">mix</span> <span class="o">==</span> <span class="s2">&quot;inv_vel&quot;</span><span class="p">:</span>
</span><span id="SeismicVolume-1209"><a href="#-1209"><span class="linenos">1209</span></a>            <span class="n">rpmix</span><span class="o">.</span><span class="n">inverse_velocity_mixing</span><span class="p">()</span>
</span><span id="SeismicVolume-1210"><a href="#-1210"><span class="linenos">1210</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SeismicVolume-1211"><a href="#-1211"><span class="linenos">1211</span></a>            <span class="n">rpmix</span><span class="o">.</span><span class="n">backus_moduli_mixing</span><span class="p">()</span>
</span><span id="SeismicVolume-1212"><a href="#-1212"><span class="linenos">1212</span></a>
</span><span id="SeismicVolume-1213"><a href="#-1213"><span class="linenos">1213</span></a>        <span class="n">props</span><span class="o">.</span><span class="n">sum_net</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">+=</span> <span class="n">ng</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span>
</span><span id="SeismicVolume-1214"><a href="#-1214"><span class="linenos">1214</span></a>        <span class="n">props</span><span class="o">.</span><span class="n">rho</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">rpmix</span><span class="o">.</span><span class="n">rho</span>
</span><span id="SeismicVolume-1215"><a href="#-1215"><span class="linenos">1215</span></a>        <span class="n">props</span><span class="o">.</span><span class="n">vp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">rpmix</span><span class="o">.</span><span class="n">vp</span>
</span><span id="SeismicVolume-1216"><a href="#-1216"><span class="linenos">1216</span></a>        <span class="n">props</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">rpmix</span><span class="o">.</span><span class="n">vs</span>
</span><span id="SeismicVolume-1217"><a href="#-1217"><span class="linenos">1217</span></a>
</span><span id="SeismicVolume-1218"><a href="#-1218"><span class="linenos">1218</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span> <span class="ow">and</span> <span class="n">z</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_random_lyr</span><span class="p">:</span>
</span><span id="SeismicVolume-1219"><a href="#-1219"><span class="linenos">1219</span></a>            <span class="c1"># Calculate non-randomised properties and differences</span>
</span><span id="SeismicVolume-1220"><a href="#-1220"><span class="linenos">1220</span></a>            <span class="n">_z0</span> <span class="o">=</span> <span class="n">depth</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span>
</span><span id="SeismicVolume-1221"><a href="#-1221"><span class="linenos">1221</span></a>            <span class="k">if</span> <span class="n">fluid</span> <span class="o">==</span> <span class="s2">&quot;brine&quot;</span><span class="p">:</span>
</span><span id="SeismicVolume-1222"><a href="#-1222"><span class="linenos">1222</span></a>                <span class="n">_sands0</span> <span class="o">=</span> <span class="n">rpm</span><span class="o">.</span><span class="n">calc_brine_sand_properties</span><span class="p">(</span><span class="n">_z0</span><span class="p">,</span> <span class="n">_z0</span><span class="p">,</span> <span class="n">_z0</span><span class="p">)</span>
</span><span id="SeismicVolume-1223"><a href="#-1223"><span class="linenos">1223</span></a>            <span class="k">elif</span> <span class="n">fluid</span> <span class="o">==</span> <span class="s2">&quot;oil&quot;</span><span class="p">:</span>
</span><span id="SeismicVolume-1224"><a href="#-1224"><span class="linenos">1224</span></a>                <span class="n">_sands0</span> <span class="o">=</span> <span class="n">rpm</span><span class="o">.</span><span class="n">calc_oil_sand_properties</span><span class="p">(</span><span class="n">_z0</span><span class="p">,</span> <span class="n">_z0</span><span class="p">,</span> <span class="n">_z0</span><span class="p">)</span>
</span><span id="SeismicVolume-1225"><a href="#-1225"><span class="linenos">1225</span></a>            <span class="k">elif</span> <span class="n">fluid</span> <span class="o">==</span> <span class="s2">&quot;gas&quot;</span><span class="p">:</span>
</span><span id="SeismicVolume-1226"><a href="#-1226"><span class="linenos">1226</span></a>                <span class="n">_sands0</span> <span class="o">=</span> <span class="n">rpm</span><span class="o">.</span><span class="n">calc_gas_sand_properties</span><span class="p">(</span><span class="n">_z0</span><span class="p">,</span> <span class="n">_z0</span><span class="p">,</span> <span class="n">_z0</span><span class="p">)</span>
</span><span id="SeismicVolume-1227"><a href="#-1227"><span class="linenos">1227</span></a>
</span><span id="SeismicVolume-1228"><a href="#-1228"><span class="linenos">1228</span></a>            <span class="n">rpmix_0</span> <span class="o">=</span> <span class="n">EndMemberMixing</span><span class="p">(</span><span class="n">shales</span><span class="p">,</span> <span class="n">_sands0</span><span class="p">,</span> <span class="n">ng</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">])</span>
</span><span id="SeismicVolume-1229"><a href="#-1229"><span class="linenos">1229</span></a>            <span class="k">if</span> <span class="n">mix</span> <span class="o">==</span> <span class="s2">&quot;inv_vel&quot;</span><span class="p">:</span>
</span><span id="SeismicVolume-1230"><a href="#-1230"><span class="linenos">1230</span></a>                <span class="c1"># Apply Inverse Velocity mixing</span>
</span><span id="SeismicVolume-1231"><a href="#-1231"><span class="linenos">1231</span></a>                <span class="n">rpmix_0</span><span class="o">.</span><span class="n">inverse_velocity_mixing</span><span class="p">()</span>
</span><span id="SeismicVolume-1232"><a href="#-1232"><span class="linenos">1232</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="SeismicVolume-1233"><a href="#-1233"><span class="linenos">1233</span></a>                <span class="c1"># Apply Backus Moduli mixing</span>
</span><span id="SeismicVolume-1234"><a href="#-1234"><span class="linenos">1234</span></a>                <span class="n">rpmix_0</span><span class="o">.</span><span class="n">backus_moduli_mixing</span><span class="p">()</span>
</span><span id="SeismicVolume-1235"><a href="#-1235"><span class="linenos">1235</span></a>            <span class="n">props</span><span class="o">.</span><span class="n">rho_not_random</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">rpmix_0</span><span class="o">.</span><span class="n">rho</span>
</span><span id="SeismicVolume-1236"><a href="#-1236"><span class="linenos">1236</span></a>            <span class="n">props</span><span class="o">.</span><span class="n">vp_not_random</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">rpmix_0</span><span class="o">.</span><span class="n">vp</span>
</span><span id="SeismicVolume-1237"><a href="#-1237"><span class="linenos">1237</span></a>            <span class="n">props</span><span class="o">.</span><span class="n">vs_not_random</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">rpmix_0</span><span class="o">.</span><span class="n">vs</span>
</span><span id="SeismicVolume-1238"><a href="#-1238"><span class="linenos">1238</span></a>
</span><span id="SeismicVolume-1239"><a href="#-1239"><span class="linenos">1239</span></a>            <span class="n">delta_rho</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="p">(</span><span class="n">props</span><span class="o">.</span><span class="n">rho</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">/</span> <span class="n">props</span><span class="o">.</span><span class="n">rho_not_random</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">])</span>
</span><span id="SeismicVolume-1240"><a href="#-1240"><span class="linenos">1240</span></a>            <span class="n">delta_vp</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="p">(</span><span class="n">props</span><span class="o">.</span><span class="n">vp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">/</span> <span class="n">props</span><span class="o">.</span><span class="n">vp_not_random</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">])</span>
</span><span id="SeismicVolume-1241"><a href="#-1241"><span class="linenos">1241</span></a>            <span class="n">delta_vs</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="p">(</span><span class="n">props</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">/</span> <span class="n">props</span><span class="o">.</span><span class="n">vs_not_random</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">])</span>
</span><span id="SeismicVolume-1242"><a href="#-1242"><span class="linenos">1242</span></a>            <span class="n">pct_change_rho</span> <span class="o">=</span> <span class="n">delta_rho</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span id="SeismicVolume-1243"><a href="#-1243"><span class="linenos">1243</span></a>            <span class="n">pct_change_vp</span> <span class="o">=</span> <span class="n">delta_vp</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span id="SeismicVolume-1244"><a href="#-1244"><span class="linenos">1244</span></a>            <span class="n">pct_change_vs</span> <span class="o">=</span> <span class="n">delta_vs</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span id="SeismicVolume-1245"><a href="#-1245"><span class="linenos">1245</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="SeismicVolume-1246"><a href="#-1246"><span class="linenos">1246</span></a>                <span class="sa">f</span><span class="s2">&quot; ... </span><span class="si">{</span><span class="n">fluid</span><span class="si">}</span><span class="s2">: randomization percent change (rho,vp,vs) = &quot;</span>
</span><span id="SeismicVolume-1247"><a href="#-1247"><span class="linenos">1247</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">pct_change_rho</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">pct_change_vp</span> <span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">pct_change_vs</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="SeismicVolume-1248"><a href="#-1248"><span class="linenos">1248</span></a>            <span class="p">)</span>
</span><span id="SeismicVolume-1249"><a href="#-1249"><span class="linenos">1249</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="SeismicVolume-1250"><a href="#-1250"><span class="linenos">1250</span></a>                <span class="sa">f</span><span class="s2">&quot; ... </span><span class="si">{</span><span class="n">fluid</span><span class="si">}</span><span class="s2">: min/max pre-randomization (rho, vp, vs)  = &quot;</span>
</span><span id="SeismicVolume-1251"><a href="#-1251"><span class="linenos">1251</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">props</span><span class="o">.</span><span class="n">rho_not_random</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">])</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2"> - &quot;</span>
</span><span id="SeismicVolume-1252"><a href="#-1252"><span class="linenos">1252</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">props</span><span class="o">.</span><span class="n">rho_not_random</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">])</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">, &quot;</span>
</span><span id="SeismicVolume-1253"><a href="#-1253"><span class="linenos">1253</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">props</span><span class="o">.</span><span class="n">vp_not_random</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">])</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> - &quot;</span>
</span><span id="SeismicVolume-1254"><a href="#-1254"><span class="linenos">1254</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">props</span><span class="o">.</span><span class="n">vp_not_random</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">])</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, &quot;</span>
</span><span id="SeismicVolume-1255"><a href="#-1255"><span class="linenos">1255</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">props</span><span class="o">.</span><span class="n">vs_not_random</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">])</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> - &quot;</span>
</span><span id="SeismicVolume-1256"><a href="#-1256"><span class="linenos">1256</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">props</span><span class="o">.</span><span class="n">vs_not_random</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">])</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="SeismicVolume-1257"><a href="#-1257"><span class="linenos">1257</span></a>            <span class="p">)</span>
</span><span id="SeismicVolume-1258"><a href="#-1258"><span class="linenos">1258</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="SeismicVolume-1259"><a href="#-1259"><span class="linenos">1259</span></a>                <span class="sa">f</span><span class="s2">&quot; ... </span><span class="si">{</span><span class="n">fluid</span><span class="si">}</span><span class="s2">: min/max post-randomization (rho, vp, vs) = &quot;</span>
</span><span id="SeismicVolume-1260"><a href="#-1260"><span class="linenos">1260</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">props</span><span class="o">.</span><span class="n">rho</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">])</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2"> - &quot;</span>
</span><span id="SeismicVolume-1261"><a href="#-1261"><span class="linenos">1261</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">props</span><span class="o">.</span><span class="n">rho</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">])</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">, &quot;</span>
</span><span id="SeismicVolume-1262"><a href="#-1262"><span class="linenos">1262</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">props</span><span class="o">.</span><span class="n">vp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">])</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> - &quot;</span>
</span><span id="SeismicVolume-1263"><a href="#-1263"><span class="linenos">1263</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">props</span><span class="o">.</span><span class="n">vp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">])</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, &quot;</span>
</span><span id="SeismicVolume-1264"><a href="#-1264"><span class="linenos">1264</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">props</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">])</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> - &quot;</span>
</span><span id="SeismicVolume-1265"><a href="#-1265"><span class="linenos">1265</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">props</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">])</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="SeismicVolume-1266"><a href="#-1266"><span class="linenos">1266</span></a>            <span class="p">)</span>
</span><span id="SeismicVolume-1267"><a href="#-1267"><span class="linenos">1267</span></a>
</span><span id="SeismicVolume-1268"><a href="#-1268"><span class="linenos">1268</span></a>        <span class="k">return</span> <span class="n">props</span>
</span><span id="SeismicVolume-1269"><a href="#-1269"><span class="linenos">1269</span></a>
</span><span id="SeismicVolume-1270"><a href="#-1270"><span class="linenos">1270</span></a>    <span class="nd">@staticmethod</span>
</span><span id="SeismicVolume-1271"><a href="#-1271"><span class="linenos">1271</span></a>    <span class="k">def</span> <span class="nf">fix_zero_values_at_base</span><span class="p">(</span><span class="n">props</span><span class="p">):</span>
</span><span id="SeismicVolume-1272"><a href="#-1272"><span class="linenos">1272</span></a>        <span class="sd">&quot;&quot;&quot;Check for zero values at base of property volumes and replace with</span>
</span><span id="SeismicVolume-1273"><a href="#-1273"><span class="linenos">1273</span></a><span class="sd">        shallower values if present</span>
</span><span id="SeismicVolume-1274"><a href="#-1274"><span class="linenos">1274</span></a>
</span><span id="SeismicVolume-1275"><a href="#-1275"><span class="linenos">1275</span></a><span class="sd">        Args:</span>
</span><span id="SeismicVolume-1276"><a href="#-1276"><span class="linenos">1276</span></a><span class="sd">            a ([type]): [description]</span>
</span><span id="SeismicVolume-1277"><a href="#-1277"><span class="linenos">1277</span></a><span class="sd">            b ([type]): [description]</span>
</span><span id="SeismicVolume-1278"><a href="#-1278"><span class="linenos">1278</span></a><span class="sd">            c ([type]): [description]</span>
</span><span id="SeismicVolume-1279"><a href="#-1279"><span class="linenos">1279</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SeismicVolume-1280"><a href="#-1280"><span class="linenos">1280</span></a>        <span class="k">for</span> <span class="n">vol</span> <span class="ow">in</span> <span class="p">[</span>
</span><span id="SeismicVolume-1281"><a href="#-1281"><span class="linenos">1281</span></a>            <span class="n">props</span><span class="o">.</span><span class="n">rho</span><span class="p">,</span>
</span><span id="SeismicVolume-1282"><a href="#-1282"><span class="linenos">1282</span></a>            <span class="n">props</span><span class="o">.</span><span class="n">vp</span><span class="p">,</span>
</span><span id="SeismicVolume-1283"><a href="#-1283"><span class="linenos">1283</span></a>            <span class="n">props</span><span class="o">.</span><span class="n">vs</span><span class="p">,</span>
</span><span id="SeismicVolume-1284"><a href="#-1284"><span class="linenos">1284</span></a>            <span class="n">props</span><span class="o">.</span><span class="n">rho_ff</span><span class="p">,</span>
</span><span id="SeismicVolume-1285"><a href="#-1285"><span class="linenos">1285</span></a>            <span class="n">props</span><span class="o">.</span><span class="n">vp_ff</span><span class="p">,</span>
</span><span id="SeismicVolume-1286"><a href="#-1286"><span class="linenos">1286</span></a>            <span class="n">props</span><span class="o">.</span><span class="n">vs_ff</span><span class="p">,</span>
</span><span id="SeismicVolume-1287"><a href="#-1287"><span class="linenos">1287</span></a>        <span class="p">]:</span>
</span><span id="SeismicVolume-1288"><a href="#-1288"><span class="linenos">1288</span></a>            <span class="k">for</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="n">vol</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">):</span>
</span><span id="SeismicVolume-1289"><a href="#-1289"><span class="linenos">1289</span></a>                <span class="n">vol</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">]</span> <span class="o">=</span> <span class="n">vol</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="SeismicVolume-1290"><a href="#-1290"><span class="linenos">1290</span></a>        <span class="k">return</span> <span class="n">props</span>
</span><span id="SeismicVolume-1291"><a href="#-1291"><span class="linenos">1291</span></a>
</span><span id="SeismicVolume-1292"><a href="#-1292"><span class="linenos">1292</span></a>    <span class="k">def</span> <span class="nf">apply_scaling_factors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">props</span><span class="p">,</span> <span class="n">ng</span><span class="p">,</span> <span class="n">lith</span><span class="p">):</span>
</span><span id="SeismicVolume-1293"><a href="#-1293"><span class="linenos">1293</span></a>        <span class="sd">&quot;&quot;&quot;Apply final random scaling factors to sands and shales&quot;&quot;&quot;</span>
</span><span id="SeismicVolume-1294"><a href="#-1294"><span class="linenos">1294</span></a>        <span class="n">rho_factor_shale</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">rpm_scaling_factors</span><span class="p">[</span><span class="s2">&quot;shalerho_factor&quot;</span><span class="p">]</span>
</span><span id="SeismicVolume-1295"><a href="#-1295"><span class="linenos">1295</span></a>        <span class="n">vp_factor_shale</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">rpm_scaling_factors</span><span class="p">[</span><span class="s2">&quot;shalevp_factor&quot;</span><span class="p">]</span>
</span><span id="SeismicVolume-1296"><a href="#-1296"><span class="linenos">1296</span></a>        <span class="n">vs_factor_shale</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">rpm_scaling_factors</span><span class="p">[</span><span class="s2">&quot;shalevs_factor&quot;</span><span class="p">]</span>
</span><span id="SeismicVolume-1297"><a href="#-1297"><span class="linenos">1297</span></a>        <span class="n">rho_factor_sand</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">rpm_scaling_factors</span><span class="p">[</span><span class="s2">&quot;sandrho_factor&quot;</span><span class="p">]</span>
</span><span id="SeismicVolume-1298"><a href="#-1298"><span class="linenos">1298</span></a>        <span class="n">vp_factor_sand</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">rpm_scaling_factors</span><span class="p">[</span><span class="s2">&quot;sandvp_factor&quot;</span><span class="p">]</span>
</span><span id="SeismicVolume-1299"><a href="#-1299"><span class="linenos">1299</span></a>        <span class="n">vs_factor_sand</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">rpm_scaling_factors</span><span class="p">[</span><span class="s2">&quot;sandvs_factor&quot;</span><span class="p">]</span>
</span><span id="SeismicVolume-1300"><a href="#-1300"><span class="linenos">1300</span></a>
</span><span id="SeismicVolume-1301"><a href="#-1301"><span class="linenos">1301</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="SeismicVolume-1302"><a href="#-1302"><span class="linenos">1302</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="SeismicVolume-1303"><a href="#-1303"><span class="linenos">1303</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">... Additional random scaling factors: &quot;</span>
</span><span id="SeismicVolume-1304"><a href="#-1304"><span class="linenos">1304</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> ... Shale Rho </span><span class="si">{</span><span class="n">rho_factor_shale</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">, Vp </span><span class="si">{</span><span class="n">vp_factor_shale</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">, Vs </span><span class="si">{</span><span class="n">vs_factor_shale</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="SeismicVolume-1305"><a href="#-1305"><span class="linenos">1305</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> ... Sand Rho </span><span class="si">{</span><span class="n">rho_factor_sand</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">, Vp </span><span class="si">{</span><span class="n">vp_factor_sand</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">, Vs </span><span class="si">{</span><span class="n">vs_factor_sand</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="SeismicVolume-1306"><a href="#-1306"><span class="linenos">1306</span></a>            <span class="p">)</span>
</span><span id="SeismicVolume-1307"><a href="#-1307"><span class="linenos">1307</span></a>
</span><span id="SeismicVolume-1308"><a href="#-1308"><span class="linenos">1308</span></a>        <span class="c1"># Apply final scaling factors to shale/sand properties</span>
</span><span id="SeismicVolume-1309"><a href="#-1309"><span class="linenos">1309</span></a>        <span class="n">props</span><span class="o">.</span><span class="n">rho</span><span class="p">[(</span><span class="n">ng</span> <span class="o">&lt;=</span> <span class="mf">1.0e-2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lith</span> <span class="o">&lt;</span> <span class="mf">2.0</span><span class="p">)]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="SeismicVolume-1310"><a href="#-1310"><span class="linenos">1310</span></a>            <span class="n">props</span><span class="o">.</span><span class="n">rho</span><span class="p">[(</span><span class="n">ng</span> <span class="o">&lt;=</span> <span class="mf">1.0e-2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lith</span> <span class="o">&lt;</span> <span class="mf">2.0</span><span class="p">)]</span> <span class="o">*</span> <span class="n">rho_factor_shale</span>
</span><span id="SeismicVolume-1311"><a href="#-1311"><span class="linenos">1311</span></a>        <span class="p">)</span>
</span><span id="SeismicVolume-1312"><a href="#-1312"><span class="linenos">1312</span></a>        <span class="n">props</span><span class="o">.</span><span class="n">vp</span><span class="p">[(</span><span class="n">ng</span> <span class="o">&lt;=</span> <span class="mf">1.0e-2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lith</span> <span class="o">&lt;</span> <span class="mf">2.0</span><span class="p">)]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="SeismicVolume-1313"><a href="#-1313"><span class="linenos">1313</span></a>            <span class="n">props</span><span class="o">.</span><span class="n">vp</span><span class="p">[(</span><span class="n">ng</span> <span class="o">&lt;=</span> <span class="mf">1.0e-2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lith</span> <span class="o">&lt;</span> <span class="mf">2.0</span><span class="p">)]</span> <span class="o">*</span> <span class="n">vp_factor_shale</span>
</span><span id="SeismicVolume-1314"><a href="#-1314"><span class="linenos">1314</span></a>        <span class="p">)</span>
</span><span id="SeismicVolume-1315"><a href="#-1315"><span class="linenos">1315</span></a>        <span class="n">props</span><span class="o">.</span><span class="n">vs</span><span class="p">[(</span><span class="n">ng</span> <span class="o">&lt;=</span> <span class="mf">1.0e-2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lith</span> <span class="o">&lt;</span> <span class="mf">2.0</span><span class="p">)]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="SeismicVolume-1316"><a href="#-1316"><span class="linenos">1316</span></a>            <span class="n">props</span><span class="o">.</span><span class="n">vs</span><span class="p">[(</span><span class="n">ng</span> <span class="o">&lt;=</span> <span class="mf">1.0e-2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lith</span> <span class="o">&lt;</span> <span class="mf">2.0</span><span class="p">)]</span> <span class="o">*</span> <span class="n">vs_factor_shale</span>
</span><span id="SeismicVolume-1317"><a href="#-1317"><span class="linenos">1317</span></a>        <span class="p">)</span>
</span><span id="SeismicVolume-1318"><a href="#-1318"><span class="linenos">1318</span></a>        <span class="n">props</span><span class="o">.</span><span class="n">rho</span><span class="p">[(</span><span class="n">ng</span> <span class="o">&gt;</span> <span class="mf">1.0e-2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lith</span> <span class="o">&lt;</span> <span class="mf">2.0</span><span class="p">)]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="SeismicVolume-1319"><a href="#-1319"><span class="linenos">1319</span></a>            <span class="n">props</span><span class="o">.</span><span class="n">rho</span><span class="p">[(</span><span class="n">ng</span> <span class="o">&gt;</span> <span class="mf">1.0e-2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lith</span> <span class="o">&lt;</span> <span class="mf">2.0</span><span class="p">)]</span> <span class="o">*</span> <span class="n">rho_factor_sand</span>
</span><span id="SeismicVolume-1320"><a href="#-1320"><span class="linenos">1320</span></a>        <span class="p">)</span>
</span><span id="SeismicVolume-1321"><a href="#-1321"><span class="linenos">1321</span></a>        <span class="n">props</span><span class="o">.</span><span class="n">vp</span><span class="p">[(</span><span class="n">ng</span> <span class="o">&gt;</span> <span class="mf">1.0e-2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lith</span> <span class="o">&lt;</span> <span class="mf">2.0</span><span class="p">)]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="SeismicVolume-1322"><a href="#-1322"><span class="linenos">1322</span></a>            <span class="n">props</span><span class="o">.</span><span class="n">vp</span><span class="p">[(</span><span class="n">ng</span> <span class="o">&gt;</span> <span class="mf">1.0e-2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lith</span> <span class="o">&lt;</span> <span class="mf">2.0</span><span class="p">)]</span> <span class="o">*</span> <span class="n">vp_factor_sand</span>
</span><span id="SeismicVolume-1323"><a href="#-1323"><span class="linenos">1323</span></a>        <span class="p">)</span>
</span><span id="SeismicVolume-1324"><a href="#-1324"><span class="linenos">1324</span></a>        <span class="n">props</span><span class="o">.</span><span class="n">vs</span><span class="p">[(</span><span class="n">ng</span> <span class="o">&gt;</span> <span class="mf">1.0e-2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lith</span> <span class="o">&lt;</span> <span class="mf">2.0</span><span class="p">)]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="SeismicVolume-1325"><a href="#-1325"><span class="linenos">1325</span></a>            <span class="n">props</span><span class="o">.</span><span class="n">vs</span><span class="p">[(</span><span class="n">ng</span> <span class="o">&gt;</span> <span class="mf">1.0e-2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lith</span> <span class="o">&lt;</span> <span class="mf">2.0</span><span class="p">)]</span> <span class="o">*</span> <span class="n">vs_factor_sand</span>
</span><span id="SeismicVolume-1326"><a href="#-1326"><span class="linenos">1326</span></a>        <span class="p">)</span>
</span><span id="SeismicVolume-1327"><a href="#-1327"><span class="linenos">1327</span></a>        <span class="c1"># Apply same factors to the fluid-factor property cubes</span>
</span><span id="SeismicVolume-1328"><a href="#-1328"><span class="linenos">1328</span></a>        <span class="n">props</span><span class="o">.</span><span class="n">rho_ff</span><span class="p">[(</span><span class="n">ng</span> <span class="o">&lt;=</span> <span class="mf">1.0e-2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lith</span> <span class="o">&lt;</span> <span class="mf">2.0</span><span class="p">)]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="SeismicVolume-1329"><a href="#-1329"><span class="linenos">1329</span></a>            <span class="n">props</span><span class="o">.</span><span class="n">rho_ff</span><span class="p">[(</span><span class="n">ng</span> <span class="o">&lt;=</span> <span class="mf">1.0e-2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lith</span> <span class="o">&lt;</span> <span class="mf">2.0</span><span class="p">)]</span> <span class="o">*</span> <span class="n">rho_factor_shale</span>
</span><span id="SeismicVolume-1330"><a href="#-1330"><span class="linenos">1330</span></a>        <span class="p">)</span>
</span><span id="SeismicVolume-1331"><a href="#-1331"><span class="linenos">1331</span></a>        <span class="n">props</span><span class="o">.</span><span class="n">vp_ff</span><span class="p">[(</span><span class="n">ng</span> <span class="o">&lt;=</span> <span class="mf">1.0e-2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lith</span> <span class="o">&lt;</span> <span class="mf">2.0</span><span class="p">)]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="SeismicVolume-1332"><a href="#-1332"><span class="linenos">1332</span></a>            <span class="n">props</span><span class="o">.</span><span class="n">vp_ff</span><span class="p">[(</span><span class="n">ng</span> <span class="o">&lt;=</span> <span class="mf">1.0e-2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lith</span> <span class="o">&lt;</span> <span class="mf">2.0</span><span class="p">)]</span> <span class="o">*</span> <span class="n">vp_factor_shale</span>
</span><span id="SeismicVolume-1333"><a href="#-1333"><span class="linenos">1333</span></a>        <span class="p">)</span>
</span><span id="SeismicVolume-1334"><a href="#-1334"><span class="linenos">1334</span></a>        <span class="n">props</span><span class="o">.</span><span class="n">vs_ff</span><span class="p">[(</span><span class="n">ng</span> <span class="o">&lt;=</span> <span class="mf">1.0e-2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lith</span> <span class="o">&lt;</span> <span class="mf">2.0</span><span class="p">)]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="SeismicVolume-1335"><a href="#-1335"><span class="linenos">1335</span></a>            <span class="n">props</span><span class="o">.</span><span class="n">vs_ff</span><span class="p">[(</span><span class="n">ng</span> <span class="o">&lt;=</span> <span class="mf">1.0e-2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lith</span> <span class="o">&lt;</span> <span class="mf">2.0</span><span class="p">)]</span> <span class="o">*</span> <span class="n">vs_factor_shale</span>
</span><span id="SeismicVolume-1336"><a href="#-1336"><span class="linenos">1336</span></a>        <span class="p">)</span>
</span><span id="SeismicVolume-1337"><a href="#-1337"><span class="linenos">1337</span></a>        <span class="n">props</span><span class="o">.</span><span class="n">rho_ff</span><span class="p">[(</span><span class="n">ng</span> <span class="o">&gt;</span> <span class="mf">1.0e-2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lith</span> <span class="o">&lt;</span> <span class="mf">2.0</span><span class="p">)]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="SeismicVolume-1338"><a href="#-1338"><span class="linenos">1338</span></a>            <span class="n">props</span><span class="o">.</span><span class="n">rho_ff</span><span class="p">[(</span><span class="n">ng</span> <span class="o">&gt;</span> <span class="mf">1.0e-2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lith</span> <span class="o">&lt;</span> <span class="mf">2.0</span><span class="p">)]</span> <span class="o">*</span> <span class="n">rho_factor_sand</span>
</span><span id="SeismicVolume-1339"><a href="#-1339"><span class="linenos">1339</span></a>        <span class="p">)</span>
</span><span id="SeismicVolume-1340"><a href="#-1340"><span class="linenos">1340</span></a>        <span class="n">props</span><span class="o">.</span><span class="n">vp_ff</span><span class="p">[(</span><span class="n">ng</span> <span class="o">&gt;</span> <span class="mf">1.0e-2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lith</span> <span class="o">&lt;</span> <span class="mf">2.0</span><span class="p">)]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="SeismicVolume-1341"><a href="#-1341"><span class="linenos">1341</span></a>            <span class="n">props</span><span class="o">.</span><span class="n">vp_ff</span><span class="p">[(</span><span class="n">ng</span> <span class="o">&gt;</span> <span class="mf">1.0e-2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lith</span> <span class="o">&lt;</span> <span class="mf">2.0</span><span class="p">)]</span> <span class="o">*</span> <span class="n">vp_factor_sand</span>
</span><span id="SeismicVolume-1342"><a href="#-1342"><span class="linenos">1342</span></a>        <span class="p">)</span>
</span><span id="SeismicVolume-1343"><a href="#-1343"><span class="linenos">1343</span></a>        <span class="n">props</span><span class="o">.</span><span class="n">vs_ff</span><span class="p">[(</span><span class="n">ng</span> <span class="o">&gt;</span> <span class="mf">1.0e-2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lith</span> <span class="o">&lt;</span> <span class="mf">2.0</span><span class="p">)]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="SeismicVolume-1344"><a href="#-1344"><span class="linenos">1344</span></a>            <span class="n">props</span><span class="o">.</span><span class="n">vs_ff</span><span class="p">[(</span><span class="n">ng</span> <span class="o">&gt;</span> <span class="mf">1.0e-2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lith</span> <span class="o">&lt;</span> <span class="mf">2.0</span><span class="p">)]</span> <span class="o">*</span> <span class="n">vs_factor_sand</span>
</span><span id="SeismicVolume-1345"><a href="#-1345"><span class="linenos">1345</span></a>        <span class="p">)</span>
</span><span id="SeismicVolume-1346"><a href="#-1346"><span class="linenos">1346</span></a>        <span class="k">return</span> <span class="n">props</span>
</span><span id="SeismicVolume-1347"><a href="#-1347"><span class="linenos">1347</span></a>
</span><span id="SeismicVolume-1348"><a href="#-1348"><span class="linenos">1348</span></a>    <span class="k">def</span> <span class="nf">write_property_volumes_to_disk</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="SeismicVolume-1349"><a href="#-1349"><span class="linenos">1349</span></a>        <span class="sd">&quot;&quot;&quot;Write Rho, Vp, Vs volumes to disk.&quot;&quot;&quot;</span>
</span><span id="SeismicVolume-1350"><a href="#-1350"><span class="linenos">1350</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">write_cube_to_disk</span><span class="p">(</span>
</span><span id="SeismicVolume-1351"><a href="#-1351"><span class="linenos">1351</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">rho</span><span class="p">[:],</span>
</span><span id="SeismicVolume-1352"><a href="#-1352"><span class="linenos">1352</span></a>            <span class="s2">&quot;qc_volume_rho&quot;</span><span class="p">,</span>
</span><span id="SeismicVolume-1353"><a href="#-1353"><span class="linenos">1353</span></a>        <span class="p">)</span>
</span><span id="SeismicVolume-1354"><a href="#-1354"><span class="linenos">1354</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">write_cube_to_disk</span><span class="p">(</span>
</span><span id="SeismicVolume-1355"><a href="#-1355"><span class="linenos">1355</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">vp</span><span class="p">[:],</span>
</span><span id="SeismicVolume-1356"><a href="#-1356"><span class="linenos">1356</span></a>            <span class="s2">&quot;qc_volume_vp&quot;</span><span class="p">,</span>
</span><span id="SeismicVolume-1357"><a href="#-1357"><span class="linenos">1357</span></a>        <span class="p">)</span>
</span><span id="SeismicVolume-1358"><a href="#-1358"><span class="linenos">1358</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">write_cube_to_disk</span><span class="p">(</span>
</span><span id="SeismicVolume-1359"><a href="#-1359"><span class="linenos">1359</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">vs</span><span class="p">[:],</span>
</span><span id="SeismicVolume-1360"><a href="#-1360"><span class="linenos">1360</span></a>            <span class="s2">&quot;qc_volume_vs&quot;</span><span class="p">,</span>
</span><span id="SeismicVolume-1361"><a href="#-1361"><span class="linenos">1361</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><h6 id="seismicvolume-class">SeismicVolume Class</h6>

<p>This class initializes the seismic volume that contains everything.</p>
</div>


                            <div id="SeismicVolume.__init__" class="classattr">
                                        <input id="SeismicVolume.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">SeismicVolume</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">parameters</span>, </span><span class="param"><span class="n">faults</span>, </span><span class="param"><span class="n">closures</span></span>)</span>

                <label class="view-source-button" for="SeismicVolume.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SeismicVolume.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SeismicVolume.__init__-22"><a href="#-22"><span class="linenos">22</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parameters</span><span class="p">,</span> <span class="n">faults</span><span class="p">,</span> <span class="n">closures</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SeismicVolume.__init__-23"><a href="#-23"><span class="linenos">23</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="SeismicVolume.__init__-24"><a href="#-24"><span class="linenos">24</span></a><span class="sd">        __init__</span>
</span><span id="SeismicVolume.__init__-25"><a href="#-25"><span class="linenos">25</span></a><span class="sd">        --------</span>
</span><span id="SeismicVolume.__init__-26"><a href="#-26"><span class="linenos">26</span></a>
</span><span id="SeismicVolume.__init__-27"><a href="#-27"><span class="linenos">27</span></a><span class="sd">        The initialization function.</span>
</span><span id="SeismicVolume.__init__-28"><a href="#-28"><span class="linenos">28</span></a>
</span><span id="SeismicVolume.__init__-29"><a href="#-29"><span class="linenos">29</span></a><span class="sd">        Parameters</span>
</span><span id="SeismicVolume.__init__-30"><a href="#-30"><span class="linenos">30</span></a><span class="sd">        ----------</span>
</span><span id="SeismicVolume.__init__-31"><a href="#-31"><span class="linenos">31</span></a><span class="sd">        parameters : datagenerator.Parameters</span>
</span><span id="SeismicVolume.__init__-32"><a href="#-32"><span class="linenos">32</span></a><span class="sd">            The parameters object of the project.</span>
</span><span id="SeismicVolume.__init__-33"><a href="#-33"><span class="linenos">33</span></a><span class="sd">        faults : np.ndarray</span>
</span><span id="SeismicVolume.__init__-34"><a href="#-34"><span class="linenos">34</span></a><span class="sd">            The faults array.</span>
</span><span id="SeismicVolume.__init__-35"><a href="#-35"><span class="linenos">35</span></a><span class="sd">        closures : np.ndarray</span>
</span><span id="SeismicVolume.__init__-36"><a href="#-36"><span class="linenos">36</span></a><span class="sd">            The closures array.</span>
</span><span id="SeismicVolume.__init__-37"><a href="#-37"><span class="linenos">37</span></a><span class="sd">        </span>
</span><span id="SeismicVolume.__init__-38"><a href="#-38"><span class="linenos">38</span></a><span class="sd">        Returns</span>
</span><span id="SeismicVolume.__init__-39"><a href="#-39"><span class="linenos">39</span></a><span class="sd">        -------</span>
</span><span id="SeismicVolume.__init__-40"><a href="#-40"><span class="linenos">40</span></a><span class="sd">        None</span>
</span><span id="SeismicVolume.__init__-41"><a href="#-41"><span class="linenos">41</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SeismicVolume.__init__-42"><a href="#-42"><span class="linenos">42</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span> <span class="o">=</span> <span class="n">parameters</span>
</span><span id="SeismicVolume.__init__-43"><a href="#-43"><span class="linenos">43</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">faults</span> <span class="o">=</span> <span class="n">faults</span>
</span><span id="SeismicVolume.__init__-44"><a href="#-44"><span class="linenos">44</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">traps</span> <span class="o">=</span> <span class="n">closures</span>
</span><span id="SeismicVolume.__init__-45"><a href="#-45"><span class="linenos">45</span></a>
</span><span id="SeismicVolume.__init__-46"><a href="#-46"><span class="linenos">46</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">model_qc_volumes</span><span class="p">:</span>
</span><span id="SeismicVolume.__init__-47"><a href="#-47"><span class="linenos">47</span></a>            <span class="c1"># Add 0 and 45 degree angles to the list of user-input angles</span>
</span><span id="SeismicVolume.__init__-48"><a href="#-48"><span class="linenos">48</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">angles</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">((</span><span class="mi">0</span><span class="p">,)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">incident_angles</span> <span class="o">+</span> <span class="p">(</span><span class="mi">45</span><span class="p">,))))</span>
</span><span id="SeismicVolume.__init__-49"><a href="#-49"><span class="linenos">49</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SeismicVolume.__init__-50"><a href="#-50"><span class="linenos">50</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">angles</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">incident_angles</span>
</span><span id="SeismicVolume.__init__-51"><a href="#-51"><span class="linenos">51</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="SeismicVolume.__init__-52"><a href="#-52"><span class="linenos">52</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Angles: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">angles</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="SeismicVolume.__init__-53"><a href="#-53"><span class="linenos">53</span></a>
</span><span id="SeismicVolume.__init__-54"><a href="#-54"><span class="linenos">54</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">first_random_lyr</span> <span class="o">=</span> <span class="mi">20</span>  <span class="c1"># do not randomise shallow layers</span>
</span><span id="SeismicVolume.__init__-55"><a href="#-55"><span class="linenos">55</span></a>
</span><span id="SeismicVolume.__init__-56"><a href="#-56"><span class="linenos">56</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">rho</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="SeismicVolume.__init__-57"><a href="#-57"><span class="linenos">57</span></a>            <span class="s2">&quot;rho&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">h5file</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ModelData</span><span class="o">.</span><span class="n">faulted_depth</span><span class="o">.</span><span class="n">shape</span>
</span><span id="SeismicVolume.__init__-58"><a href="#-58"><span class="linenos">58</span></a>        <span class="p">)</span>
</span><span id="SeismicVolume.__init__-59"><a href="#-59"><span class="linenos">59</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="SeismicVolume.__init__-60"><a href="#-60"><span class="linenos">60</span></a>            <span class="s2">&quot;vp&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">h5file</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ModelData</span><span class="o">.</span><span class="n">faulted_depth</span><span class="o">.</span><span class="n">shape</span>
</span><span id="SeismicVolume.__init__-61"><a href="#-61"><span class="linenos">61</span></a>        <span class="p">)</span>
</span><span id="SeismicVolume.__init__-62"><a href="#-62"><span class="linenos">62</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="SeismicVolume.__init__-63"><a href="#-63"><span class="linenos">63</span></a>            <span class="s2">&quot;vs&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">h5file</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ModelData</span><span class="o">.</span><span class="n">faulted_depth</span><span class="o">.</span><span class="n">shape</span>
</span><span id="SeismicVolume.__init__-64"><a href="#-64"><span class="linenos">64</span></a>        <span class="p">)</span>
</span><span id="SeismicVolume.__init__-65"><a href="#-65"><span class="linenos">65</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">rho_ff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="SeismicVolume.__init__-66"><a href="#-66"><span class="linenos">66</span></a>            <span class="s2">&quot;rho_ff&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">h5file</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ModelData</span><span class="o">.</span><span class="n">faulted_depth</span><span class="o">.</span><span class="n">shape</span>
</span><span id="SeismicVolume.__init__-67"><a href="#-67"><span class="linenos">67</span></a>        <span class="p">)</span>
</span><span id="SeismicVolume.__init__-68"><a href="#-68"><span class="linenos">68</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vp_ff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="SeismicVolume.__init__-69"><a href="#-69"><span class="linenos">69</span></a>            <span class="s2">&quot;vp_ff&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">h5file</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ModelData</span><span class="o">.</span><span class="n">faulted_depth</span><span class="o">.</span><span class="n">shape</span>
</span><span id="SeismicVolume.__init__-70"><a href="#-70"><span class="linenos">70</span></a>        <span class="p">)</span>
</span><span id="SeismicVolume.__init__-71"><a href="#-71"><span class="linenos">71</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vs_ff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span>
</span><span id="SeismicVolume.__init__-72"><a href="#-72"><span class="linenos">72</span></a>            <span class="s2">&quot;vs_ff&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">h5file</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ModelData</span><span class="o">.</span><span class="n">faulted_depth</span><span class="o">.</span><span class="n">shape</span>
</span><span id="SeismicVolume.__init__-73"><a href="#-73"><span class="linenos">73</span></a>        <span class="p">)</span>
</span><span id="SeismicVolume.__init__-74"><a href="#-74"><span class="linenos">74</span></a>
</span><span id="SeismicVolume.__init__-75"><a href="#-75"><span class="linenos">75</span></a>        <span class="n">seis_shape</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="SeismicVolume.__init__-76"><a href="#-76"><span class="linenos">76</span></a>            <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">angles</span><span class="p">),</span>
</span><span id="SeismicVolume.__init__-77"><a href="#-77"><span class="linenos">77</span></a>            <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">h5file</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ModelData</span><span class="o">.</span><span class="n">faulted_depth</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
</span><span id="SeismicVolume.__init__-78"><a href="#-78"><span class="linenos">78</span></a>        <span class="p">)</span>
</span><span id="SeismicVolume.__init__-79"><a href="#-79"><span class="linenos">79</span></a>        <span class="n">rfc_shape</span> <span class="o">=</span> <span class="p">(</span><span class="n">seis_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">seis_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">seis_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">seis_shape</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="SeismicVolume.__init__-80"><a href="#-80"><span class="linenos">80</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">rfc_raw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span><span class="s2">&quot;rfc_raw&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">rfc_shape</span><span class="p">)</span>
</span><span id="SeismicVolume.__init__-81"><a href="#-81"><span class="linenos">81</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">rfc_noise_added</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span><span class="s2">&quot;rfc_noise_added&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">rfc_shape</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><h2 id="__init__">__init__</h2>

<p>The initialization function.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>parameters</strong> (<a href="Parameters.html">datagenerator.Parameters</a>):
The parameters object of the project.</li>
<li><strong>faults</strong> (np.ndarray):
The faults array.</li>
<li><strong>closures</strong> (np.ndarray):
The closures array.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>None</strong></li>
</ul>
</div>


                            </div>
                            <div id="SeismicVolume.build_elastic_properties" class="classattr">
                                        <input id="SeismicVolume.build_elastic_properties-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">build_elastic_properties</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">mixing_method</span><span class="o">=</span><span class="s1">&#39;inv_vel&#39;</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SeismicVolume.build_elastic_properties-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SeismicVolume.build_elastic_properties"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SeismicVolume.build_elastic_properties-83"><a href="#-83"><span class="linenos"> 83</span></a>    <span class="k">def</span> <span class="nf">build_elastic_properties</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mixing_method</span><span class="o">=</span><span class="s2">&quot;inv_vel&quot;</span><span class="p">):</span>
</span><span id="SeismicVolume.build_elastic_properties-84"><a href="#-84"><span class="linenos"> 84</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="SeismicVolume.build_elastic_properties-85"><a href="#-85"><span class="linenos"> 85</span></a><span class="sd">        Build Elastic Properties</span>
</span><span id="SeismicVolume.build_elastic_properties-86"><a href="#-86"><span class="linenos"> 86</span></a><span class="sd">        ------------------------</span>
</span><span id="SeismicVolume.build_elastic_properties-87"><a href="#-87"><span class="linenos"> 87</span></a>
</span><span id="SeismicVolume.build_elastic_properties-88"><a href="#-88"><span class="linenos"> 88</span></a><span class="sd">        Creates Rho, Vp, Vs volumes using depth trends.</span>
</span><span id="SeismicVolume.build_elastic_properties-89"><a href="#-89"><span class="linenos"> 89</span></a>
</span><span id="SeismicVolume.build_elastic_properties-90"><a href="#-90"><span class="linenos"> 90</span></a><span class="sd">        Parameters</span>
</span><span id="SeismicVolume.build_elastic_properties-91"><a href="#-91"><span class="linenos"> 91</span></a><span class="sd">        ----------</span>
</span><span id="SeismicVolume.build_elastic_properties-92"><a href="#-92"><span class="linenos"> 92</span></a><span class="sd">        mixing_method : str, optional</span>
</span><span id="SeismicVolume.build_elastic_properties-93"><a href="#-93"><span class="linenos"> 93</span></a><span class="sd">            Method for mixing Velocities. Defaults to &quot;inv_vel&quot;.</span>
</span><span id="SeismicVolume.build_elastic_properties-94"><a href="#-94"><span class="linenos"> 94</span></a>
</span><span id="SeismicVolume.build_elastic_properties-95"><a href="#-95"><span class="linenos"> 95</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SeismicVolume.build_elastic_properties-96"><a href="#-96"><span class="linenos"> 96</span></a>        <span class="n">rpm</span> <span class="o">=</span> <span class="n">select_rpm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="p">)</span>
</span><span id="SeismicVolume.build_elastic_properties-97"><a href="#-97"><span class="linenos"> 97</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">build_property_models_randomised_depth</span><span class="p">(</span>
</span><span id="SeismicVolume.build_elastic_properties-98"><a href="#-98"><span class="linenos"> 98</span></a>            <span class="n">rpm</span><span class="p">,</span>
</span><span id="SeismicVolume.build_elastic_properties-99"><a href="#-99"><span class="linenos"> 99</span></a>            <span class="n">mixing_method</span><span class="o">=</span><span class="n">mixing_method</span>
</span><span id="SeismicVolume.build_elastic_properties-100"><a href="#-100"><span class="linenos">100</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><h6 id="build-elastic-properties">Build Elastic Properties</h6>

<p>Creates Rho, Vp, Vs volumes using depth trends.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>mixing_method</strong> (str, optional):
Method for mixing Velocities. Defaults to "inv_vel".</li>
</ul>
</div>


                            </div>
                            <div id="SeismicVolume.bandlimit_volumes_wavelets" class="classattr">
                                        <input id="SeismicVolume.bandlimit_volumes_wavelets-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">bandlimit_volumes_wavelets</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">n_wavelets</span><span class="o">=</span><span class="mi">10</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SeismicVolume.bandlimit_volumes_wavelets-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SeismicVolume.bandlimit_volumes_wavelets"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SeismicVolume.bandlimit_volumes_wavelets-102"><a href="#-102"><span class="linenos">102</span></a>    <span class="k">def</span> <span class="nf">bandlimit_volumes_wavelets</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_wavelets</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
</span><span id="SeismicVolume.bandlimit_volumes_wavelets-103"><a href="#-103"><span class="linenos">103</span></a>        <span class="c1"># Pre-prepared n, m, f filter_specs from npy file</span>
</span><span id="SeismicVolume.bandlimit_volumes_wavelets-104"><a href="#-104"><span class="linenos">104</span></a>        <span class="n">fs_nr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">wavelets</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="SeismicVolume.bandlimit_volumes_wavelets-105"><a href="#-105"><span class="linenos">105</span></a>        <span class="n">fs_md</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">wavelets</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="SeismicVolume.bandlimit_volumes_wavelets-106"><a href="#-106"><span class="linenos">106</span></a>        <span class="n">fs_fr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">wavelets</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</span><span id="SeismicVolume.bandlimit_volumes_wavelets-107"><a href="#-107"><span class="linenos">107</span></a>
</span><span id="SeismicVolume.bandlimit_volumes_wavelets-108"><a href="#-108"><span class="linenos">108</span></a>        <span class="k">for</span> <span class="n">wavelet_count</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_wavelets</span><span class="p">):</span>
</span><span id="SeismicVolume.bandlimit_volumes_wavelets-109"><a href="#-109"><span class="linenos">109</span></a>            <span class="n">low_freq_pctile</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
</span><span id="SeismicVolume.bandlimit_volumes_wavelets-110"><a href="#-110"><span class="linenos">110</span></a>            <span class="n">mid_freq_pctile</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
</span><span id="SeismicVolume.bandlimit_volumes_wavelets-111"><a href="#-111"><span class="linenos">111</span></a>            <span class="n">high_freq_pctile</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
</span><span id="SeismicVolume.bandlimit_volumes_wavelets-112"><a href="#-112"><span class="linenos">112</span></a>            <span class="n">low_med_high_percentiles</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="SeismicVolume.bandlimit_volumes_wavelets-113"><a href="#-113"><span class="linenos">113</span></a>                <span class="n">low_freq_pctile</span><span class="p">,</span>
</span><span id="SeismicVolume.bandlimit_volumes_wavelets-114"><a href="#-114"><span class="linenos">114</span></a>                <span class="n">mid_freq_pctile</span><span class="p">,</span>
</span><span id="SeismicVolume.bandlimit_volumes_wavelets-115"><a href="#-115"><span class="linenos">115</span></a>                <span class="n">high_freq_pctile</span><span class="p">,</span>
</span><span id="SeismicVolume.bandlimit_volumes_wavelets-116"><a href="#-116"><span class="linenos">116</span></a>            <span class="p">)</span>
</span><span id="SeismicVolume.bandlimit_volumes_wavelets-117"><a href="#-117"><span class="linenos">117</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;low_med_high_percentiles: </span><span class="si">{</span><span class="n">low_med_high_percentiles</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="SeismicVolume.bandlimit_volumes_wavelets-118"><a href="#-118"><span class="linenos">118</span></a>            <span class="n">f_nr</span><span class="p">,</span> <span class="n">a_nr</span><span class="p">,</span> <span class="n">w_nr</span> <span class="o">=</span> <span class="n">generate_wavelet</span><span class="p">(</span><span class="n">fs_nr</span><span class="p">,</span> <span class="n">low_med_high_percentiles</span><span class="p">)</span>
</span><span id="SeismicVolume.bandlimit_volumes_wavelets-119"><a href="#-119"><span class="linenos">119</span></a>            <span class="n">f_md</span><span class="p">,</span> <span class="n">a_md</span><span class="p">,</span> <span class="n">w_md</span> <span class="o">=</span> <span class="n">generate_wavelet</span><span class="p">(</span><span class="n">fs_md</span><span class="p">,</span> <span class="n">low_med_high_percentiles</span><span class="p">)</span>
</span><span id="SeismicVolume.bandlimit_volumes_wavelets-120"><a href="#-120"><span class="linenos">120</span></a>            <span class="n">f_fr</span><span class="p">,</span> <span class="n">a_fr</span><span class="p">,</span> <span class="n">w_fr</span> <span class="o">=</span> <span class="n">generate_wavelet</span><span class="p">(</span><span class="n">fs_fr</span><span class="p">,</span> <span class="n">low_med_high_percentiles</span><span class="p">)</span>
</span><span id="SeismicVolume.bandlimit_volumes_wavelets-121"><a href="#-121"><span class="linenos">121</span></a>            <span class="n">_f</span> <span class="o">=</span> <span class="p">(</span><span class="n">f_nr</span><span class="p">,</span> <span class="n">f_md</span><span class="p">,</span> <span class="n">f_fr</span><span class="p">)</span>
</span><span id="SeismicVolume.bandlimit_volumes_wavelets-122"><a href="#-122"><span class="linenos">122</span></a>            <span class="n">_a</span> <span class="o">=</span> <span class="p">(</span><span class="n">a_nr</span><span class="p">,</span> <span class="n">a_md</span><span class="p">,</span> <span class="n">a_fr</span><span class="p">)</span>
</span><span id="SeismicVolume.bandlimit_volumes_wavelets-123"><a href="#-123"><span class="linenos">123</span></a>            <span class="n">_w</span> <span class="o">=</span> <span class="p">(</span><span class="n">w_nr</span><span class="p">,</span> <span class="n">w_md</span><span class="p">,</span> <span class="n">w_fr</span><span class="p">)</span>
</span><span id="SeismicVolume.bandlimit_volumes_wavelets-124"><a href="#-124"><span class="linenos">124</span></a>            <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Near&quot;</span><span class="p">,</span> <span class="s2">&quot;Mid&quot;</span><span class="p">,</span> <span class="s2">&quot;Far&quot;</span><span class="p">]</span>
</span><span id="SeismicVolume.bandlimit_volumes_wavelets-125"><a href="#-125"><span class="linenos">125</span></a>            <span class="n">pngname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="SeismicVolume.bandlimit_volumes_wavelets-126"><a href="#-126"><span class="linenos">126</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">work_subfolder</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;random_wavelets_</span><span class="si">{</span><span class="n">wavelet_count</span><span class="si">}</span><span class="s2">.png&quot;</span>
</span><span id="SeismicVolume.bandlimit_volumes_wavelets-127"><a href="#-127"><span class="linenos">127</span></a>            <span class="p">)</span>
</span><span id="SeismicVolume.bandlimit_volumes_wavelets-128"><a href="#-128"><span class="linenos">128</span></a>            <span class="n">plot_wavelets</span><span class="p">(</span><span class="n">_f</span><span class="p">,</span> <span class="n">_a</span><span class="p">,</span> <span class="n">_w</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">pngname</span><span class="p">)</span>
</span><span id="SeismicVolume.bandlimit_volumes_wavelets-129"><a href="#-129"><span class="linenos">129</span></a>
</span><span id="SeismicVolume.bandlimit_volumes_wavelets-130"><a href="#-130"><span class="linenos">130</span></a>            <span class="n">rfc_bandlimited_wavelet</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rfc_noise_added</span><span class="p">)</span>
</span><span id="SeismicVolume.bandlimit_volumes_wavelets-131"><a href="#-131"><span class="linenos">131</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">model_qc_volumes</span><span class="p">:</span>
</span><span id="SeismicVolume.bandlimit_volumes_wavelets-132"><a href="#-132"><span class="linenos">132</span></a>                <span class="n">wavelets</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="SeismicVolume.bandlimit_volumes_wavelets-133"><a href="#-133"><span class="linenos">133</span></a>                    <span class="n">w_nr</span><span class="p">,</span>
</span><span id="SeismicVolume.bandlimit_volumes_wavelets-134"><a href="#-134"><span class="linenos">134</span></a>                    <span class="n">w_nr</span><span class="p">,</span>
</span><span id="SeismicVolume.bandlimit_volumes_wavelets-135"><a href="#-135"><span class="linenos">135</span></a>                    <span class="n">w_md</span><span class="p">,</span>
</span><span id="SeismicVolume.bandlimit_volumes_wavelets-136"><a href="#-136"><span class="linenos">136</span></a>                    <span class="n">w_fr</span><span class="p">,</span>
</span><span id="SeismicVolume.bandlimit_volumes_wavelets-137"><a href="#-137"><span class="linenos">137</span></a>                    <span class="n">w_fr</span><span class="p">,</span>
</span><span id="SeismicVolume.bandlimit_volumes_wavelets-138"><a href="#-138"><span class="linenos">138</span></a>                <span class="p">]</span>  <span class="c1"># use near for 0 and far for 45 deg cubes</span>
</span><span id="SeismicVolume.bandlimit_volumes_wavelets-139"><a href="#-139"><span class="linenos">139</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="SeismicVolume.bandlimit_volumes_wavelets-140"><a href="#-140"><span class="linenos">140</span></a>                <span class="n">wavelets</span> <span class="o">=</span> <span class="p">[</span><span class="n">w_nr</span><span class="p">,</span> <span class="n">w_md</span><span class="p">,</span> <span class="n">w_fr</span><span class="p">]</span>
</span><span id="SeismicVolume.bandlimit_volumes_wavelets-141"><a href="#-141"><span class="linenos">141</span></a>
</span><span id="SeismicVolume.bandlimit_volumes_wavelets-142"><a href="#-142"><span class="linenos">142</span></a>            <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">rfc_bandlimited_wavelet</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="SeismicVolume.bandlimit_volumes_wavelets-143"><a href="#-143"><span class="linenos">143</span></a>                <span class="n">rfc_bandlimited_wavelet</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">apply_wavelet</span><span class="p">(</span>
</span><span id="SeismicVolume.bandlimit_volumes_wavelets-144"><a href="#-144"><span class="linenos">144</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">rfc_noise_added</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span> <span class="n">wavelets</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
</span><span id="SeismicVolume.bandlimit_volumes_wavelets-145"><a href="#-145"><span class="linenos">145</span></a>                <span class="p">)</span>
</span><span id="SeismicVolume.bandlimit_volumes_wavelets-146"><a href="#-146"><span class="linenos">146</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">lateral_filter_size</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="SeismicVolume.bandlimit_volumes_wavelets-147"><a href="#-147"><span class="linenos">147</span></a>                <span class="c1"># Apply lateral smoothing filter</span>
</span><span id="SeismicVolume.bandlimit_volumes_wavelets-148"><a href="#-148"><span class="linenos">148</span></a>                <span class="n">rfc_bandlimited_wavelet</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_lateral_filter</span><span class="p">(</span>
</span><span id="SeismicVolume.bandlimit_volumes_wavelets-149"><a href="#-149"><span class="linenos">149</span></a>                    <span class="n">rfc_bandlimited_wavelet</span>
</span><span id="SeismicVolume.bandlimit_volumes_wavelets-150"><a href="#-150"><span class="linenos">150</span></a>                <span class="p">)</span>
</span><span id="SeismicVolume.bandlimit_volumes_wavelets-151"><a href="#-151"><span class="linenos">151</span></a>            <span class="n">cumsum_wavelet_noise_added</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_cumsum</span><span class="p">(</span><span class="n">rfc_bandlimited_wavelet</span><span class="p">)</span>
</span><span id="SeismicVolume.bandlimit_volumes_wavelets-152"><a href="#-152"><span class="linenos">152</span></a>            <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">write_final_cubes_to_disk</span><span class="p">(</span>
</span><span id="SeismicVolume.bandlimit_volumes_wavelets-153"><a href="#-153"><span class="linenos">153</span></a>                <span class="n">rfc_bandlimited_wavelet</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;seismicCubes_RFC_Wavelet_</span><span class="si">{</span><span class="n">wavelet_count</span><span class="si">}</span><span class="s2">_&quot;</span>
</span><span id="SeismicVolume.bandlimit_volumes_wavelets-154"><a href="#-154"><span class="linenos">154</span></a>            <span class="p">)</span>
</span><span id="SeismicVolume.bandlimit_volumes_wavelets-155"><a href="#-155"><span class="linenos">155</span></a>            <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">write_final_cubes_to_disk</span><span class="p">(</span>
</span><span id="SeismicVolume.bandlimit_volumes_wavelets-156"><a href="#-156"><span class="linenos">156</span></a>                <span class="n">cumsum_wavelet_noise_added</span><span class="p">,</span>
</span><span id="SeismicVolume.bandlimit_volumes_wavelets-157"><a href="#-157"><span class="linenos">157</span></a>                <span class="sa">f</span><span class="s2">&quot;seismicCubes_cumsum_Wavelet_</span><span class="si">{</span><span class="n">wavelet_count</span><span class="si">}</span><span class="s2">_&quot;</span><span class="p">,</span>
</span><span id="SeismicVolume.bandlimit_volumes_wavelets-158"><a href="#-158"><span class="linenos">158</span></a>            <span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="SeismicVolume.postprocess_rfc_cubes" class="classattr">
                                        <input id="SeismicVolume.postprocess_rfc_cubes-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">postprocess_rfc_cubes</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">rfc_data</span>, </span><span class="param"><span class="n">filename_suffix</span><span class="o">=</span><span class="s1">&#39;&#39;</span>, </span><span class="param"><span class="n">bb</span><span class="o">=</span><span class="kc">False</span>, </span><span class="param"><span class="n">stack</span><span class="o">=</span><span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SeismicVolume.postprocess_rfc_cubes-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SeismicVolume.postprocess_rfc_cubes"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SeismicVolume.postprocess_rfc_cubes-160"><a href="#-160"><span class="linenos">160</span></a>    <span class="k">def</span> <span class="nf">postprocess_rfc_cubes</span><span class="p">(</span>
</span><span id="SeismicVolume.postprocess_rfc_cubes-161"><a href="#-161"><span class="linenos">161</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">rfc_data</span><span class="p">,</span> <span class="n">filename_suffix</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">bb</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">stack</span><span class="o">=</span><span class="kc">False</span>
</span><span id="SeismicVolume.postprocess_rfc_cubes-162"><a href="#-162"><span class="linenos">162</span></a>    <span class="p">):</span>
</span><span id="SeismicVolume.postprocess_rfc_cubes-163"><a href="#-163"><span class="linenos">163</span></a>        <span class="sd">&quot;&quot;&quot;Postprocess the RFC cubes.&quot;&quot;&quot;</span>
</span><span id="SeismicVolume.postprocess_rfc_cubes-164"><a href="#-164"><span class="linenos">164</span></a>        <span class="k">if</span> <span class="n">bb</span><span class="p">:</span>
</span><span id="SeismicVolume.postprocess_rfc_cubes-165"><a href="#-165"><span class="linenos">165</span></a>            <span class="n">bandlimited</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_bandlimits</span><span class="p">(</span><span class="n">rfc_data</span><span class="p">,</span> <span class="p">(</span><span class="mf">4.0</span><span class="p">,</span> <span class="mf">90.0</span><span class="p">))</span>
</span><span id="SeismicVolume.postprocess_rfc_cubes-166"><a href="#-166"><span class="linenos">166</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SeismicVolume.postprocess_rfc_cubes-167"><a href="#-167"><span class="linenos">167</span></a>            <span class="n">bandlimited</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_bandlimits</span><span class="p">(</span><span class="n">rfc_data</span><span class="p">)</span>
</span><span id="SeismicVolume.postprocess_rfc_cubes-168"><a href="#-168"><span class="linenos">168</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">lateral_filter_size</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="SeismicVolume.postprocess_rfc_cubes-169"><a href="#-169"><span class="linenos">169</span></a>            <span class="n">bandlimited</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_lateral_filter</span><span class="p">(</span><span class="n">bandlimited</span><span class="p">)</span>
</span><span id="SeismicVolume.postprocess_rfc_cubes-170"><a href="#-170"><span class="linenos">170</span></a>        <span class="k">if</span> <span class="n">filename_suffix</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
</span><span id="SeismicVolume.postprocess_rfc_cubes-171"><a href="#-171"><span class="linenos">171</span></a>            <span class="n">fname</span> <span class="o">=</span> <span class="s2">&quot;seismicCubes_RFC_&quot;</span>
</span><span id="SeismicVolume.postprocess_rfc_cubes-172"><a href="#-172"><span class="linenos">172</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SeismicVolume.postprocess_rfc_cubes-173"><a href="#-173"><span class="linenos">173</span></a>            <span class="n">fname</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;seismicCubes_RFC_</span><span class="si">{</span><span class="n">filename_suffix</span><span class="si">}</span><span class="s2">_&quot;</span>
</span><span id="SeismicVolume.postprocess_rfc_cubes-174"><a href="#-174"><span class="linenos">174</span></a>        <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">write_final_cubes_to_disk</span><span class="p">(</span><span class="n">bandlimited</span><span class="p">,</span> <span class="n">fname</span><span class="p">)</span>
</span><span id="SeismicVolume.postprocess_rfc_cubes-175"><a href="#-175"><span class="linenos">175</span></a>        <span class="k">if</span> <span class="n">stack</span><span class="p">:</span>
</span><span id="SeismicVolume.postprocess_rfc_cubes-176"><a href="#-176"><span class="linenos">176</span></a>            <span class="n">rfc_fullstack</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stack_substacks</span><span class="p">(</span>
</span><span id="SeismicVolume.postprocess_rfc_cubes-177"><a href="#-177"><span class="linenos">177</span></a>                <span class="p">[</span><span class="n">bandlimited</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">angles</span><span class="p">)]</span>
</span><span id="SeismicVolume.postprocess_rfc_cubes-178"><a href="#-178"><span class="linenos">178</span></a>            <span class="p">)</span>
</span><span id="SeismicVolume.postprocess_rfc_cubes-179"><a href="#-179"><span class="linenos">179</span></a>            <span class="n">rfc_fullstack_scaled</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scale_seismic</span><span class="p">(</span><span class="n">rfc_fullstack</span><span class="p">)</span>
</span><span id="SeismicVolume.postprocess_rfc_cubes-180"><a href="#-180"><span class="linenos">180</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">write_cube_to_disk</span><span class="p">(</span>
</span><span id="SeismicVolume.postprocess_rfc_cubes-181"><a href="#-181"><span class="linenos">181</span></a>                <span class="n">rfc_fullstack_scaled</span><span class="p">,</span>
</span><span id="SeismicVolume.postprocess_rfc_cubes-182"><a href="#-182"><span class="linenos">182</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">fname</span><span class="si">}</span><span class="s2">fullstack&quot;</span><span class="p">,</span>
</span><span id="SeismicVolume.postprocess_rfc_cubes-183"><a href="#-183"><span class="linenos">183</span></a>            <span class="p">)</span>
</span><span id="SeismicVolume.postprocess_rfc_cubes-184"><a href="#-184"><span class="linenos">184</span></a>
</span><span id="SeismicVolume.postprocess_rfc_cubes-185"><a href="#-185"><span class="linenos">185</span></a>        <span class="n">cumsum</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_cumsum</span><span class="p">(</span><span class="n">bandlimited</span><span class="p">)</span>
</span><span id="SeismicVolume.postprocess_rfc_cubes-186"><a href="#-186"><span class="linenos">186</span></a>        <span class="k">if</span> <span class="n">filename_suffix</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
</span><span id="SeismicVolume.postprocess_rfc_cubes-187"><a href="#-187"><span class="linenos">187</span></a>            <span class="n">fname</span> <span class="o">=</span> <span class="s2">&quot;seismicCubes_cumsum_&quot;</span>
</span><span id="SeismicVolume.postprocess_rfc_cubes-188"><a href="#-188"><span class="linenos">188</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SeismicVolume.postprocess_rfc_cubes-189"><a href="#-189"><span class="linenos">189</span></a>            <span class="n">fname</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;seismicCubes_cumsum_</span><span class="si">{</span><span class="n">filename_suffix</span><span class="si">}</span><span class="s2">_&quot;</span>
</span><span id="SeismicVolume.postprocess_rfc_cubes-190"><a href="#-190"><span class="linenos">190</span></a>        <span class="n">normalised_cumsum</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">write_final_cubes_to_disk</span><span class="p">(</span><span class="n">cumsum</span><span class="p">,</span> <span class="n">fname</span><span class="p">)</span>
</span><span id="SeismicVolume.postprocess_rfc_cubes-191"><a href="#-191"><span class="linenos">191</span></a>        <span class="k">if</span> <span class="n">stack</span><span class="p">:</span>
</span><span id="SeismicVolume.postprocess_rfc_cubes-192"><a href="#-192"><span class="linenos">192</span></a>            <span class="n">rai_fullstack</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stack_substacks</span><span class="p">(</span>
</span><span id="SeismicVolume.postprocess_rfc_cubes-193"><a href="#-193"><span class="linenos">193</span></a>                <span class="p">[</span><span class="n">cumsum</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">angles</span><span class="p">)]</span>
</span><span id="SeismicVolume.postprocess_rfc_cubes-194"><a href="#-194"><span class="linenos">194</span></a>            <span class="p">)</span>
</span><span id="SeismicVolume.postprocess_rfc_cubes-195"><a href="#-195"><span class="linenos">195</span></a>            <span class="n">rai_fullstack_scaled</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scale_seismic</span><span class="p">(</span><span class="n">rai_fullstack</span><span class="p">)</span>
</span><span id="SeismicVolume.postprocess_rfc_cubes-196"><a href="#-196"><span class="linenos">196</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">write_cube_to_disk</span><span class="p">(</span>
</span><span id="SeismicVolume.postprocess_rfc_cubes-197"><a href="#-197"><span class="linenos">197</span></a>                <span class="n">rai_fullstack_scaled</span><span class="p">,</span>
</span><span id="SeismicVolume.postprocess_rfc_cubes-198"><a href="#-198"><span class="linenos">198</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">fname</span><span class="si">}</span><span class="s2">fullstack&quot;</span><span class="p">,</span>
</span><span id="SeismicVolume.postprocess_rfc_cubes-199"><a href="#-199"><span class="linenos">199</span></a>            <span class="p">)</span>
</span><span id="SeismicVolume.postprocess_rfc_cubes-200"><a href="#-200"><span class="linenos">200</span></a>        <span class="k">return</span> <span class="n">normalised_cumsum</span>
</span></pre></div>


            <div class="docstring"><p>Postprocess the RFC cubes.</p>
</div>


                            </div>
                            <div id="SeismicVolume.apply_augmentations" class="classattr">
                                        <input id="SeismicVolume.apply_augmentations-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">apply_augmentations</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">data</span>, </span><span class="param"><span class="n">name</span><span class="o">=</span><span class="s1">&#39;cumsum&#39;</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SeismicVolume.apply_augmentations-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SeismicVolume.apply_augmentations"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SeismicVolume.apply_augmentations-202"><a href="#-202"><span class="linenos">202</span></a>    <span class="k">def</span> <span class="nf">apply_augmentations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;cumsum&quot;</span><span class="p">):</span>
</span><span id="SeismicVolume.apply_augmentations-203"><a href="#-203"><span class="linenos">203</span></a>        <span class="n">seabed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">faulted_depth_maps</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">digi</span>
</span><span id="SeismicVolume.apply_augmentations-204"><a href="#-204"><span class="linenos">204</span></a>        <span class="n">augmented_data</span><span class="p">,</span> <span class="n">augmented_labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">augment_data_and_labels</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">seabed</span><span class="p">)</span>
</span><span id="SeismicVolume.apply_augmentations-205"><a href="#-205"><span class="linenos">205</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ang</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">incident_angles</span><span class="p">):</span>
</span><span id="SeismicVolume.apply_augmentations-206"><a href="#-206"><span class="linenos">206</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="n">augmented_data</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
</span><span id="SeismicVolume.apply_augmentations-207"><a href="#-207"><span class="linenos">207</span></a>            <span class="n">fname</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;seismicCubes_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">ang</span><span class="si">}</span><span class="s2">_degrees_normalized_augmented&quot;</span>
</span><span id="SeismicVolume.apply_augmentations-208"><a href="#-208"><span class="linenos">208</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">write_cube_to_disk</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">fname</span><span class="p">)</span>
</span><span id="SeismicVolume.apply_augmentations-209"><a href="#-209"><span class="linenos">209</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">write_cube_to_disk</span><span class="p">(</span><span class="n">augmented_labels</span><span class="p">,</span> <span class="s2">&quot;hc_closures_augmented&quot;</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="SeismicVolume.apply_rmo" class="classattr">
                                        <input id="SeismicVolume.apply_rmo-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">apply_rmo</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">data</span>, </span><span class="param"><span class="n">name</span><span class="o">=</span><span class="s1">&#39;cumsum_RMO&#39;</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SeismicVolume.apply_rmo-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SeismicVolume.apply_rmo"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SeismicVolume.apply_rmo-211"><a href="#-211"><span class="linenos">211</span></a>    <span class="k">def</span> <span class="nf">apply_rmo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;cumsum_RMO&quot;</span><span class="p">):</span>
</span><span id="SeismicVolume.apply_rmo-212"><a href="#-212"><span class="linenos">212</span></a>        <span class="sd">&quot;&quot;&quot;Apply RMO to the cumsum with noise. Note rmo application expects angle in last dimension&quot;&quot;&quot;</span>
</span><span id="SeismicVolume.apply_rmo-213"><a href="#-213"><span class="linenos">213</span></a>        <span class="n">rmo_indices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_randomRMO_1D</span><span class="p">(</span>
</span><span id="SeismicVolume.apply_rmo-214"><a href="#-214"><span class="linenos">214</span></a>            <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">incident_angles</span><span class="p">,</span> <span class="n">velocity_fraction</span><span class="o">=</span><span class="mf">0.015</span>
</span><span id="SeismicVolume.apply_rmo-215"><a href="#-215"><span class="linenos">215</span></a>        <span class="p">)</span>
</span><span id="SeismicVolume.apply_rmo-216"><a href="#-216"><span class="linenos">216</span></a>        <span class="n">rmo_applied_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">moveaxis</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
</span><span id="SeismicVolume.apply_rmo-217"><a href="#-217"><span class="linenos">217</span></a>        <span class="k">for</span> <span class="n">iline</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="SeismicVolume.apply_rmo-218"><a href="#-218"><span class="linenos">218</span></a>            <span class="k">for</span> <span class="n">xline</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
</span><span id="SeismicVolume.apply_rmo-219"><a href="#-219"><span class="linenos">219</span></a>                <span class="n">rmo_applied_data</span><span class="p">[</span><span class="n">iline</span><span class="p">,</span> <span class="n">xline</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_rmo_augmentation</span><span class="p">(</span>
</span><span id="SeismicVolume.apply_rmo-220"><a href="#-220"><span class="linenos">220</span></a>                    <span class="n">np</span><span class="o">.</span><span class="n">moveaxis</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)[</span><span class="n">iline</span><span class="p">,</span> <span class="n">xline</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span>
</span><span id="SeismicVolume.apply_rmo-221"><a href="#-221"><span class="linenos">221</span></a>                    <span class="n">rmo_indices</span><span class="p">,</span>
</span><span id="SeismicVolume.apply_rmo-222"><a href="#-222"><span class="linenos">222</span></a>                    <span class="n">remove_mean_rmo</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="SeismicVolume.apply_rmo-223"><a href="#-223"><span class="linenos">223</span></a>                <span class="p">)</span>
</span><span id="SeismicVolume.apply_rmo-224"><a href="#-224"><span class="linenos">224</span></a>        <span class="n">rmo_applied_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">moveaxis</span><span class="p">(</span>
</span><span id="SeismicVolume.apply_rmo-225"><a href="#-225"><span class="linenos">225</span></a>            <span class="n">rmo_applied_data</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span>
</span><span id="SeismicVolume.apply_rmo-226"><a href="#-226"><span class="linenos">226</span></a>        <span class="p">)</span>  <span class="c1"># Put the angles back into 1st dimension</span>
</span><span id="SeismicVolume.apply_rmo-227"><a href="#-227"><span class="linenos">227</span></a>        <span class="n">normalised_rmo_applied_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">write_final_cubes_to_disk</span><span class="p">(</span>
</span><span id="SeismicVolume.apply_rmo-228"><a href="#-228"><span class="linenos">228</span></a>            <span class="n">rmo_applied_data</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;seismicCubes_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">_&quot;</span>
</span><span id="SeismicVolume.apply_rmo-229"><a href="#-229"><span class="linenos">229</span></a>        <span class="p">)</span>
</span><span id="SeismicVolume.apply_rmo-230"><a href="#-230"><span class="linenos">230</span></a>        <span class="k">return</span> <span class="n">normalised_rmo_applied_data</span>
</span></pre></div>


            <div class="docstring"><p>Apply RMO to the cumsum with noise. Note rmo application expects angle in last dimension</p>
</div>


                            </div>
                            <div id="SeismicVolume.build_seismic_volumes" class="classattr">
                                        <input id="SeismicVolume.build_seismic_volumes-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">build_seismic_volumes</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SeismicVolume.build_seismic_volumes-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SeismicVolume.build_seismic_volumes"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SeismicVolume.build_seismic_volumes-232"><a href="#-232"><span class="linenos">232</span></a>    <span class="k">def</span> <span class="nf">build_seismic_volumes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="SeismicVolume.build_seismic_volumes-233"><a href="#-233"><span class="linenos">233</span></a>        <span class="sd">&quot;&quot;&quot;Build Seismic volumes.</span>
</span><span id="SeismicVolume.build_seismic_volumes-234"><a href="#-234"><span class="linenos">234</span></a>
</span><span id="SeismicVolume.build_seismic_volumes-235"><a href="#-235"><span class="linenos">235</span></a><span class="sd">        * Use Zoeppritz to create RFC volumes for each required angle, add 0 &amp; 45 degree stacks for QC</span>
</span><span id="SeismicVolume.build_seismic_volumes-236"><a href="#-236"><span class="linenos">236</span></a><span class="sd">        * Add exponential weighted noise to the angle stacks</span>
</span><span id="SeismicVolume.build_seismic_volumes-237"><a href="#-237"><span class="linenos">237</span></a><span class="sd">        * Apply bandpass filter</span>
</span><span id="SeismicVolume.build_seismic_volumes-238"><a href="#-238"><span class="linenos">238</span></a><span class="sd">        * Apply lateral filter</span>
</span><span id="SeismicVolume.build_seismic_volumes-239"><a href="#-239"><span class="linenos">239</span></a><span class="sd">        * Calculate cumsum</span>
</span><span id="SeismicVolume.build_seismic_volumes-240"><a href="#-240"><span class="linenos">240</span></a><span class="sd">        * Create full stacks by stacking the user-input angles (i.e. not including 0, 45 degree stacks)</span>
</span><span id="SeismicVolume.build_seismic_volumes-241"><a href="#-241"><span class="linenos">241</span></a><span class="sd">        * Write seismic volumes to disk</span>
</span><span id="SeismicVolume.build_seismic_volumes-242"><a href="#-242"><span class="linenos">242</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SeismicVolume.build_seismic_volumes-243"><a href="#-243"><span class="linenos">243</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="SeismicVolume.build_seismic_volumes-244"><a href="#-244"><span class="linenos">244</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="SeismicVolume.build_seismic_volumes-245"><a href="#-245"><span class="linenos">245</span></a>                <span class="sa">f</span><span class="s2">&quot;Generating 3D Rock Properties Rho, Vp and Vs using depth trends for project </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">project</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="SeismicVolume.build_seismic_volumes-246"><a href="#-246"><span class="linenos">246</span></a>            <span class="p">)</span>
</span><span id="SeismicVolume.build_seismic_volumes-247"><a href="#-247"><span class="linenos">247</span></a>        <span class="c1"># Calculate Raw RFC from rho, vp, vs using Zoeppritz &amp; write to HdF</span>
</span><span id="SeismicVolume.build_seismic_volumes-248"><a href="#-248"><span class="linenos">248</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">create_rfc_volumes</span><span class="p">()</span>
</span><span id="SeismicVolume.build_seismic_volumes-249"><a href="#-249"><span class="linenos">249</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">add_weighted_noise</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">faulted_depth_maps</span><span class="p">)</span>
</span><span id="SeismicVolume.build_seismic_volumes-250"><a href="#-250"><span class="linenos">250</span></a>        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="p">,</span> <span class="s2">&quot;wavelets&quot;</span><span class="p">):</span>
</span><span id="SeismicVolume.build_seismic_volumes-251"><a href="#-251"><span class="linenos">251</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">bandlimit_volumes_wavelets</span><span class="p">(</span><span class="n">n_wavelets</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="SeismicVolume.build_seismic_volumes-252"><a href="#-252"><span class="linenos">252</span></a>        <span class="n">normalised_cumsum</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">postprocess_rfc_cubes</span><span class="p">(</span>
</span><span id="SeismicVolume.build_seismic_volumes-253"><a href="#-253"><span class="linenos">253</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">rfc_noise_added</span><span class="p">[:],</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">stack</span><span class="o">=</span><span class="kc">True</span>
</span><span id="SeismicVolume.build_seismic_volumes-254"><a href="#-254"><span class="linenos">254</span></a>        <span class="p">)</span>
</span><span id="SeismicVolume.build_seismic_volumes-255"><a href="#-255"><span class="linenos">255</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">apply_augmentations</span><span class="p">(</span><span class="n">normalised_cumsum</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;cumsum&quot;</span><span class="p">)</span>
</span><span id="SeismicVolume.build_seismic_volumes-256"><a href="#-256"><span class="linenos">256</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">model_qc_volumes</span><span class="p">:</span>
</span><span id="SeismicVolume.build_seismic_volumes-257"><a href="#-257"><span class="linenos">257</span></a>            <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">postprocess_rfc_cubes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rfc_raw</span><span class="p">[:],</span> <span class="s2">&quot;noise_free&quot;</span><span class="p">,</span> <span class="n">bb</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="SeismicVolume.build_seismic_volumes-258"><a href="#-258"><span class="linenos">258</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">broadband_qc_volume</span><span class="p">:</span>
</span><span id="SeismicVolume.build_seismic_volumes-259"><a href="#-259"><span class="linenos">259</span></a>                <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">postprocess_rfc_cubes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rfc_raw</span><span class="p">[:],</span> <span class="s2">&quot;noise_free_bb&quot;</span><span class="p">,</span> <span class="n">bb</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="SeismicVolume.build_seismic_volumes-260"><a href="#-260"><span class="linenos">260</span></a>            <span class="n">normalised_cumsum_rmo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_rmo</span><span class="p">(</span><span class="n">normalised_cumsum</span><span class="p">)</span>
</span><span id="SeismicVolume.build_seismic_volumes-261"><a href="#-261"><span class="linenos">261</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">apply_augmentations</span><span class="p">(</span><span class="n">normalised_cumsum_rmo</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;cumsum_RMO&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Build Seismic volumes.</p>

<ul>
<li>Use Zoeppritz to create RFC volumes for each required angle, add 0 &amp; 45 degree stacks for QC</li>
<li>Add exponential weighted noise to the angle stacks</li>
<li>Apply bandpass filter</li>
<li>Apply lateral filter</li>
<li>Calculate cumsum</li>
<li>Create full stacks by stacking the user-input angles (i.e. not including 0, 45 degree stacks)</li>
<li>Write seismic volumes to disk</li>
</ul>
</div>


                            </div>
                            <div id="SeismicVolume.write_final_cubes_to_disk" class="classattr">
                                        <input id="SeismicVolume.write_final_cubes_to_disk-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">write_final_cubes_to_disk</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">dat</span>, </span><span class="param"><span class="n">name</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SeismicVolume.write_final_cubes_to_disk-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SeismicVolume.write_final_cubes_to_disk"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SeismicVolume.write_final_cubes_to_disk-276"><a href="#-276"><span class="linenos">276</span></a>    <span class="k">def</span> <span class="nf">write_final_cubes_to_disk</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dat</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
</span><span id="SeismicVolume.write_final_cubes_to_disk-277"><a href="#-277"><span class="linenos">277</span></a>        <span class="n">scaled_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scale_seismic</span><span class="p">(</span><span class="n">dat</span><span class="p">)</span>
</span><span id="SeismicVolume.write_final_cubes_to_disk-278"><a href="#-278"><span class="linenos">278</span></a>
</span><span id="SeismicVolume.write_final_cubes_to_disk-279"><a href="#-279"><span class="linenos">279</span></a>        <span class="c1"># Apply scaling factors to N, M, F cubes from csv file before determining clip limits</span>
</span><span id="SeismicVolume.write_final_cubes_to_disk-280"><a href="#-280"><span class="linenos">280</span></a>        <span class="n">factor_near</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">rpm_scaling_factors</span><span class="p">[</span><span class="s2">&quot;nearfactor&quot;</span><span class="p">]</span>
</span><span id="SeismicVolume.write_final_cubes_to_disk-281"><a href="#-281"><span class="linenos">281</span></a>        <span class="n">factor_mid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">rpm_scaling_factors</span><span class="p">[</span><span class="s2">&quot;midfactor&quot;</span><span class="p">]</span>
</span><span id="SeismicVolume.write_final_cubes_to_disk-282"><a href="#-282"><span class="linenos">282</span></a>        <span class="n">factor_far</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">rpm_scaling_factors</span><span class="p">[</span><span class="s2">&quot;farfactor&quot;</span><span class="p">]</span>
</span><span id="SeismicVolume.write_final_cubes_to_disk-283"><a href="#-283"><span class="linenos">283</span></a>        <span class="n">cube_incr</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="SeismicVolume.write_final_cubes_to_disk-284"><a href="#-284"><span class="linenos">284</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">model_qc_volumes</span> <span class="ow">and</span> <span class="n">dat</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="SeismicVolume.write_final_cubes_to_disk-285"><a href="#-285"><span class="linenos">285</span></a>            <span class="c1"># 0 degrees has been added at start, and 45 at end</span>
</span><span id="SeismicVolume.write_final_cubes_to_disk-286"><a href="#-286"><span class="linenos">286</span></a>            <span class="n">cube_incr</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="SeismicVolume.write_final_cubes_to_disk-287"><a href="#-287"><span class="linenos">287</span></a>        <span class="n">scaled_data</span><span class="p">[</span><span class="mi">0</span> <span class="o">+</span> <span class="n">cube_incr</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">*=</span> <span class="n">factor_near</span>
</span><span id="SeismicVolume.write_final_cubes_to_disk-288"><a href="#-288"><span class="linenos">288</span></a>        <span class="n">scaled_data</span><span class="p">[</span><span class="mi">1</span> <span class="o">+</span> <span class="n">cube_incr</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">*=</span> <span class="n">factor_mid</span>
</span><span id="SeismicVolume.write_final_cubes_to_disk-289"><a href="#-289"><span class="linenos">289</span></a>        <span class="n">scaled_data</span><span class="p">[</span><span class="mi">2</span> <span class="o">+</span> <span class="n">cube_incr</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">*=</span> <span class="n">factor_far</span>
</span><span id="SeismicVolume.write_final_cubes_to_disk-290"><a href="#-290"><span class="linenos">290</span></a>
</span><span id="SeismicVolume.write_final_cubes_to_disk-291"><a href="#-291"><span class="linenos">291</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ang</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">incident_angles</span><span class="p">):</span>
</span><span id="SeismicVolume.write_final_cubes_to_disk-292"><a href="#-292"><span class="linenos">292</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="n">scaled_data</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
</span><span id="SeismicVolume.write_final_cubes_to_disk-293"><a href="#-293"><span class="linenos">293</span></a>            <span class="n">fname</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">ang</span><span class="si">}</span><span class="s2">_degrees&quot;</span>
</span><span id="SeismicVolume.write_final_cubes_to_disk-294"><a href="#-294"><span class="linenos">294</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">write_cube_to_disk</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">fname</span><span class="p">)</span>
</span><span id="SeismicVolume.write_final_cubes_to_disk-295"><a href="#-295"><span class="linenos">295</span></a>        <span class="n">normed_data</span> <span class="o">=</span> <span class="n">normalize_seismic</span><span class="p">(</span><span class="n">scaled_data</span><span class="p">)</span>
</span><span id="SeismicVolume.write_final_cubes_to_disk-296"><a href="#-296"><span class="linenos">296</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ang</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">incident_angles</span><span class="p">):</span>
</span><span id="SeismicVolume.write_final_cubes_to_disk-297"><a href="#-297"><span class="linenos">297</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="n">normed_data</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
</span><span id="SeismicVolume.write_final_cubes_to_disk-298"><a href="#-298"><span class="linenos">298</span></a>            <span class="n">fname</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">ang</span><span class="si">}</span><span class="s2">_degrees_normalized&quot;</span>
</span><span id="SeismicVolume.write_final_cubes_to_disk-299"><a href="#-299"><span class="linenos">299</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">write_cube_to_disk</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">fname</span><span class="p">)</span>
</span><span id="SeismicVolume.write_final_cubes_to_disk-300"><a href="#-300"><span class="linenos">300</span></a>        <span class="k">return</span> <span class="n">normed_data</span>
</span></pre></div>


    

                            </div>
                            <div id="SeismicVolume.random_z_rho_vp_vs" class="classattr">
                                        <input id="SeismicVolume.random_z_rho_vp_vs-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">random_z_rho_vp_vs</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">dmin</span><span class="o">=-</span><span class="mi">7</span>, </span><span class="param"><span class="n">dmax</span><span class="o">=</span><span class="mi">7</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SeismicVolume.random_z_rho_vp_vs-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SeismicVolume.random_z_rho_vp_vs"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SeismicVolume.random_z_rho_vp_vs-302"><a href="#-302"><span class="linenos">302</span></a>    <span class="nd">@staticmethod</span>
</span><span id="SeismicVolume.random_z_rho_vp_vs-303"><a href="#-303"><span class="linenos">303</span></a>    <span class="k">def</span> <span class="nf">random_z_rho_vp_vs</span><span class="p">(</span><span class="n">dmin</span><span class="o">=-</span><span class="mi">7</span><span class="p">,</span> <span class="n">dmax</span><span class="o">=</span><span class="mi">7</span><span class="p">):</span>
</span><span id="SeismicVolume.random_z_rho_vp_vs-304"><a href="#-304"><span class="linenos">304</span></a>        <span class="n">delta_z_rho</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">dmin</span><span class="p">,</span> <span class="n">dmax</span><span class="p">))</span>
</span><span id="SeismicVolume.random_z_rho_vp_vs-305"><a href="#-305"><span class="linenos">305</span></a>        <span class="n">delta_z_vp</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">dmin</span><span class="p">,</span> <span class="n">dmax</span><span class="p">))</span>
</span><span id="SeismicVolume.random_z_rho_vp_vs-306"><a href="#-306"><span class="linenos">306</span></a>        <span class="n">delta_z_vs</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">dmin</span><span class="p">,</span> <span class="n">dmax</span><span class="p">))</span>
</span><span id="SeismicVolume.random_z_rho_vp_vs-307"><a href="#-307"><span class="linenos">307</span></a>        <span class="k">return</span> <span class="n">delta_z_rho</span><span class="p">,</span> <span class="n">delta_z_vp</span><span class="p">,</span> <span class="n">delta_z_vs</span>
</span></pre></div>


    

                            </div>
                            <div id="SeismicVolume.create_rfc_volumes" class="classattr">
                                        <input id="SeismicVolume.create_rfc_volumes-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">create_rfc_volumes</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SeismicVolume.create_rfc_volumes-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SeismicVolume.create_rfc_volumes"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SeismicVolume.create_rfc_volumes-309"><a href="#-309"><span class="linenos">309</span></a>    <span class="k">def</span> <span class="nf">create_rfc_volumes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="SeismicVolume.create_rfc_volumes-310"><a href="#-310"><span class="linenos">310</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="SeismicVolume.create_rfc_volumes-311"><a href="#-311"><span class="linenos">311</span></a><span class="sd">        Build a 3D array of PP-Reflectivity using Zoeppritz for each incident angle given.</span>
</span><span id="SeismicVolume.create_rfc_volumes-312"><a href="#-312"><span class="linenos">312</span></a>
</span><span id="SeismicVolume.create_rfc_volumes-313"><a href="#-313"><span class="linenos">313</span></a><span class="sd">        :return: 4D array of PP-Reflectivity. 4th dimension holds reflectivities of each incident angle provided</span>
</span><span id="SeismicVolume.create_rfc_volumes-314"><a href="#-314"><span class="linenos">314</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SeismicVolume.create_rfc_volumes-315"><a href="#-315"><span class="linenos">315</span></a>        <span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asanyarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">angles</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span>
</span><span id="SeismicVolume.create_rfc_volumes-316"><a href="#-316"><span class="linenos">316</span></a>            <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="SeismicVolume.create_rfc_volumes-317"><a href="#-317"><span class="linenos">317</span></a>        <span class="p">)</span>  <span class="c1"># Convert angles into a column vector</span>
</span><span id="SeismicVolume.create_rfc_volumes-318"><a href="#-318"><span class="linenos">318</span></a>
</span><span id="SeismicVolume.create_rfc_volumes-319"><a href="#-319"><span class="linenos">319</span></a>        <span class="c1"># Make empty array to store RPP via zoeppritz</span>
</span><span id="SeismicVolume.create_rfc_volumes-320"><a href="#-320"><span class="linenos">320</span></a>        <span class="n">zoep</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span>
</span><span id="SeismicVolume.create_rfc_volumes-321"><a href="#-321"><span class="linenos">321</span></a>            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">rho</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">rho</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">theta</span><span class="o">.</span><span class="n">size</span><span class="p">),</span>
</span><span id="SeismicVolume.create_rfc_volumes-322"><a href="#-322"><span class="linenos">322</span></a>            <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;complex64&quot;</span><span class="p">,</span>
</span><span id="SeismicVolume.create_rfc_volumes-323"><a href="#-323"><span class="linenos">323</span></a>        <span class="p">)</span>
</span><span id="SeismicVolume.create_rfc_volumes-324"><a href="#-324"><span class="linenos">324</span></a>
</span><span id="SeismicVolume.create_rfc_volumes-325"><a href="#-325"><span class="linenos">325</span></a>        <span class="n">_rho</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rho</span><span class="p">[:]</span>
</span><span id="SeismicVolume.create_rfc_volumes-326"><a href="#-326"><span class="linenos">326</span></a>        <span class="n">_vp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vp</span><span class="p">[:]</span>
</span><span id="SeismicVolume.create_rfc_volumes-327"><a href="#-327"><span class="linenos">327</span></a>        <span class="n">_vs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vs</span><span class="p">[:]</span>
</span><span id="SeismicVolume.create_rfc_volumes-328"><a href="#-328"><span class="linenos">328</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="SeismicVolume.create_rfc_volumes-329"><a href="#-329"><span class="linenos">329</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Checking for null values inside create_rfc_volumes:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="SeismicVolume.create_rfc_volumes-330"><a href="#-330"><span class="linenos">330</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Rho: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">_rho</span><span class="p">)</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">_rho</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="SeismicVolume.create_rfc_volumes-331"><a href="#-331"><span class="linenos">331</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Vp: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">_vp</span><span class="p">)</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">_vp</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="SeismicVolume.create_rfc_volumes-332"><a href="#-332"><span class="linenos">332</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Vs: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">_vs</span><span class="p">)</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">_vs</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="SeismicVolume.create_rfc_volumes-333"><a href="#-333"><span class="linenos">333</span></a>        <span class="c1"># Doing this for each trace &amp; all (5) angles is actually quicker than doing entire cubes for each angle</span>
</span><span id="SeismicVolume.create_rfc_volumes-334"><a href="#-334"><span class="linenos">334</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">trange</span><span class="p">(</span>
</span><span id="SeismicVolume.create_rfc_volumes-335"><a href="#-335"><span class="linenos">335</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">rho</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
</span><span id="SeismicVolume.create_rfc_volumes-336"><a href="#-336"><span class="linenos">336</span></a>            <span class="n">desc</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Calculating Zoeppritz for </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">angles</span><span class="p">)</span><span class="si">}</span><span class="s2"> angles&quot;</span><span class="p">,</span>
</span><span id="SeismicVolume.create_rfc_volumes-337"><a href="#-337"><span class="linenos">337</span></a>        <span class="p">):</span>
</span><span id="SeismicVolume.create_rfc_volumes-338"><a href="#-338"><span class="linenos">338</span></a>            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
</span><span id="SeismicVolume.create_rfc_volumes-339"><a href="#-339"><span class="linenos">339</span></a>                <span class="n">rho1</span><span class="p">,</span> <span class="n">rho2</span> <span class="o">=</span> <span class="n">_rho</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">_rho</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="mi">1</span><span class="p">:]</span>
</span><span id="SeismicVolume.create_rfc_volumes-340"><a href="#-340"><span class="linenos">340</span></a>                <span class="n">vp1</span><span class="p">,</span> <span class="n">vp2</span> <span class="o">=</span> <span class="n">_vp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">_vp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="mi">1</span><span class="p">:]</span>
</span><span id="SeismicVolume.create_rfc_volumes-341"><a href="#-341"><span class="linenos">341</span></a>                <span class="n">vs1</span><span class="p">,</span> <span class="n">vs2</span> <span class="o">=</span> <span class="n">_vs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">_vs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="mi">1</span><span class="p">:]</span>
</span><span id="SeismicVolume.create_rfc_volumes-342"><a href="#-342"><span class="linenos">342</span></a>                <span class="n">rfc</span> <span class="o">=</span> <span class="n">RFC</span><span class="p">(</span><span class="n">vp1</span><span class="p">,</span> <span class="n">vs1</span><span class="p">,</span> <span class="n">rho1</span><span class="p">,</span> <span class="n">vp2</span><span class="p">,</span> <span class="n">vs2</span><span class="p">,</span> <span class="n">rho2</span><span class="p">,</span> <span class="n">theta</span><span class="p">)</span>
</span><span id="SeismicVolume.create_rfc_volumes-343"><a href="#-343"><span class="linenos">343</span></a>                <span class="n">zoep</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">rfc</span><span class="o">.</span><span class="n">zoeppritz_reflectivity</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
</span><span id="SeismicVolume.create_rfc_volumes-344"><a href="#-344"><span class="linenos">344</span></a>        <span class="c1"># Set any voxels with imaginary parts to 0, since all transmitted energy travels along the reflector</span>
</span><span id="SeismicVolume.create_rfc_volumes-345"><a href="#-345"><span class="linenos">345</span></a>        <span class="c1"># zoep[np.where(np.imag(zoep) != 0)] = 0</span>
</span><span id="SeismicVolume.create_rfc_volumes-346"><a href="#-346"><span class="linenos">346</span></a>        <span class="c1"># discard complex values and set dtype to float64</span>
</span><span id="SeismicVolume.create_rfc_volumes-347"><a href="#-347"><span class="linenos">347</span></a>        <span class="n">zoep</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">zoep</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;float64&quot;</span><span class="p">)</span>
</span><span id="SeismicVolume.create_rfc_volumes-348"><a href="#-348"><span class="linenos">348</span></a>        <span class="k">del</span> <span class="n">_rho</span><span class="p">,</span> <span class="n">_vp</span><span class="p">,</span> <span class="n">_vs</span>
</span><span id="SeismicVolume.create_rfc_volumes-349"><a href="#-349"><span class="linenos">349</span></a>
</span><span id="SeismicVolume.create_rfc_volumes-350"><a href="#-350"><span class="linenos">350</span></a>        <span class="c1"># Move the angle from last dimension to first</span>
</span><span id="SeismicVolume.create_rfc_volumes-351"><a href="#-351"><span class="linenos">351</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">rfc_raw</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">moveaxis</span><span class="p">(</span><span class="n">zoep</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="SeismicVolume.create_rfc_volumes-352"><a href="#-352"><span class="linenos">352</span></a>
</span><span id="SeismicVolume.create_rfc_volumes-353"><a href="#-353"><span class="linenos">353</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_store</span><span class="p">:</span>
</span><span id="SeismicVolume.create_rfc_volumes-354"><a href="#-354"><span class="linenos">354</span></a>            <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
</span><span id="SeismicVolume.create_rfc_volumes-355"><a href="#-355"><span class="linenos">355</span></a>                <span class="p">[</span>
</span><span id="SeismicVolume.create_rfc_volumes-356"><a href="#-356"><span class="linenos">356</span></a>                    <span class="s2">&quot;qc_volume_rfc_raw_</span><span class="si">{}</span><span class="s2">_degrees&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="SeismicVolume.create_rfc_volumes-357"><a href="#-357"><span class="linenos">357</span></a>                        <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">angles</span><span class="p">[</span><span class="n">x</span><span class="p">])</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span>
</span><span id="SeismicVolume.create_rfc_volumes-358"><a href="#-358"><span class="linenos">358</span></a>                    <span class="p">)</span>
</span><span id="SeismicVolume.create_rfc_volumes-359"><a href="#-359"><span class="linenos">359</span></a>                    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rfc_raw</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="SeismicVolume.create_rfc_volumes-360"><a href="#-360"><span class="linenos">360</span></a>                <span class="p">],</span>
</span><span id="SeismicVolume.create_rfc_volumes-361"><a href="#-361"><span class="linenos">361</span></a>                <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">rfc_raw</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rfc_raw</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])],</span>
</span><span id="SeismicVolume.create_rfc_volumes-362"><a href="#-362"><span class="linenos">362</span></a>            <span class="p">):</span>
</span><span id="SeismicVolume.create_rfc_volumes-363"><a href="#-363"><span class="linenos">363</span></a>                <span class="n">write_data_to_hdf</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_master</span><span class="p">)</span>
</span><span id="SeismicVolume.create_rfc_volumes-364"><a href="#-364"><span class="linenos">364</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">model_qc_volumes</span><span class="p">:</span>
</span><span id="SeismicVolume.create_rfc_volumes-365"><a href="#-365"><span class="linenos">365</span></a>            <span class="c1"># Write raw RFC values to disk</span>
</span><span id="SeismicVolume.create_rfc_volumes-366"><a href="#-366"><span class="linenos">366</span></a>            <span class="n">_</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="SeismicVolume.create_rfc_volumes-367"><a href="#-367"><span class="linenos">367</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">write_cube_to_disk</span><span class="p">(</span>
</span><span id="SeismicVolume.create_rfc_volumes-368"><a href="#-368"><span class="linenos">368</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">rfc_raw</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span>
</span><span id="SeismicVolume.create_rfc_volumes-369"><a href="#-369"><span class="linenos">369</span></a>                    <span class="sa">f</span><span class="s2">&quot;qc_volume_rfc_raw_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">angles</span><span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="si">}</span><span class="s2">_degrees&quot;</span><span class="p">,</span>
</span><span id="SeismicVolume.create_rfc_volumes-370"><a href="#-370"><span class="linenos">370</span></a>                <span class="p">)</span>
</span><span id="SeismicVolume.create_rfc_volumes-371"><a href="#-371"><span class="linenos">371</span></a>                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rfc_raw</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="SeismicVolume.create_rfc_volumes-372"><a href="#-372"><span class="linenos">372</span></a>            <span class="p">]</span>
</span><span id="SeismicVolume.create_rfc_volumes-373"><a href="#-373"><span class="linenos">373</span></a>            <span class="n">max_amp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rfc_raw</span><span class="p">[:]))</span>
</span><span id="SeismicVolume.create_rfc_volumes-374"><a href="#-374"><span class="linenos">374</span></a>            <span class="n">_</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="SeismicVolume.create_rfc_volumes-375"><a href="#-375"><span class="linenos">375</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">write_cube_to_disk</span><span class="p">(</span>
</span><span id="SeismicVolume.create_rfc_volumes-376"><a href="#-376"><span class="linenos">376</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">rfc_raw</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span>
</span><span id="SeismicVolume.create_rfc_volumes-377"><a href="#-377"><span class="linenos">377</span></a>                    <span class="sa">f</span><span class="s2">&quot;qc_volume_rfc_raw_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">angles</span><span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="si">}</span><span class="s2">_degrees&quot;</span><span class="p">,</span>
</span><span id="SeismicVolume.create_rfc_volumes-378"><a href="#-378"><span class="linenos">378</span></a>                <span class="p">)</span>
</span><span id="SeismicVolume.create_rfc_volumes-379"><a href="#-379"><span class="linenos">379</span></a>                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rfc_raw</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="SeismicVolume.create_rfc_volumes-380"><a href="#-380"><span class="linenos">380</span></a>            <span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>Build a 3D array of PP-Reflectivity using Zoeppritz for each incident angle given.</p>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>4D array of PP-Reflectivity. 4th dimension holds reflectivities of each incident angle provided</p>
</blockquote>
</div>


                            </div>
                            <div id="SeismicVolume.noise_3d" class="classattr">
                                        <input id="SeismicVolume.noise_3d-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">noise_3d</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">cube_shape</span>, </span><span class="param"><span class="n">verbose</span><span class="o">=</span><span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SeismicVolume.noise_3d-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SeismicVolume.noise_3d"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SeismicVolume.noise_3d-382"><a href="#-382"><span class="linenos">382</span></a>    <span class="k">def</span> <span class="nf">noise_3d</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cube_shape</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="SeismicVolume.noise_3d-383"><a href="#-383"><span class="linenos">383</span></a>        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="SeismicVolume.noise_3d-384"><a href="#-384"><span class="linenos">384</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   ... inside noise3D&quot;</span><span class="p">)</span>
</span><span id="SeismicVolume.noise_3d-385"><a href="#-385"><span class="linenos">385</span></a>
</span><span id="SeismicVolume.noise_3d-386"><a href="#-386"><span class="linenos">386</span></a>        <span class="n">noise_seed</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="mi">2</span> <span class="o">**</span> <span class="mi">32</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="SeismicVolume.noise_3d-387"><a href="#-387"><span class="linenos">387</span></a>        <span class="n">sign_seed</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="mi">2</span> <span class="o">**</span> <span class="mi">32</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="SeismicVolume.noise_3d-388"><a href="#-388"><span class="linenos">388</span></a>
</span><span id="SeismicVolume.noise_3d-389"><a href="#-389"><span class="linenos">389</span></a>        <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">noise_seed</span><span class="p">)</span>
</span><span id="SeismicVolume.noise_3d-390"><a href="#-390"><span class="linenos">390</span></a>        <span class="n">noise3d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">exponential</span><span class="p">(</span>
</span><span id="SeismicVolume.noise_3d-391"><a href="#-391"><span class="linenos">391</span></a>            <span class="mf">1.0</span> <span class="o">/</span> <span class="mf">100.0</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">cube_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">cube_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
</span><span id="SeismicVolume.noise_3d-392"><a href="#-392"><span class="linenos">392</span></a>        <span class="p">)</span>
</span><span id="SeismicVolume.noise_3d-393"><a href="#-393"><span class="linenos">393</span></a>        <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">sign_seed</span><span class="p">)</span>
</span><span id="SeismicVolume.noise_3d-394"><a href="#-394"><span class="linenos">394</span></a>        <span class="n">sign</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">binomial</span><span class="p">(</span>
</span><span id="SeismicVolume.noise_3d-395"><a href="#-395"><span class="linenos">395</span></a>            <span class="mi">1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">cube_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">cube_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
</span><span id="SeismicVolume.noise_3d-396"><a href="#-396"><span class="linenos">396</span></a>        <span class="p">)</span>
</span><span id="SeismicVolume.noise_3d-397"><a href="#-397"><span class="linenos">397</span></a>
</span><span id="SeismicVolume.noise_3d-398"><a href="#-398"><span class="linenos">398</span></a>        <span class="n">sign</span><span class="p">[</span><span class="n">sign</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
</span><span id="SeismicVolume.noise_3d-399"><a href="#-399"><span class="linenos">399</span></a>        <span class="n">noise3d</span> <span class="o">*=</span> <span class="n">sign</span>
</span><span id="SeismicVolume.noise_3d-400"><a href="#-400"><span class="linenos">400</span></a>        <span class="n">noise3d</span> <span class="o">=</span> <span class="n">noise3d</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cube_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">cube_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
</span><span id="SeismicVolume.noise_3d-401"><a href="#-401"><span class="linenos">401</span></a>        <span class="k">return</span> <span class="n">noise3d</span>
</span></pre></div>


    

                            </div>
                            <div id="SeismicVolume.add_weighted_noise" class="classattr">
                                        <input id="SeismicVolume.add_weighted_noise-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">add_weighted_noise</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">depth_maps</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SeismicVolume.add_weighted_noise-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SeismicVolume.add_weighted_noise"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SeismicVolume.add_weighted_noise-403"><a href="#-403"><span class="linenos">403</span></a>    <span class="k">def</span> <span class="nf">add_weighted_noise</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">depth_maps</span><span class="p">):</span>
</span><span id="SeismicVolume.add_weighted_noise-404"><a href="#-404"><span class="linenos">404</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="SeismicVolume.add_weighted_noise-405"><a href="#-405"><span class="linenos">405</span></a><span class="sd">        Apply 3D weighted random noise to ndarray.</span>
</span><span id="SeismicVolume.add_weighted_noise-406"><a href="#-406"><span class="linenos">406</span></a>
</span><span id="SeismicVolume.add_weighted_noise-407"><a href="#-407"><span class="linenos">407</span></a><span class="sd">        :return: Sum of rfc_volumes and 3D noise model, weighted by angle</span>
</span><span id="SeismicVolume.add_weighted_noise-408"><a href="#-408"><span class="linenos">408</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SeismicVolume.add_weighted_noise-409"><a href="#-409"><span class="linenos">409</span></a>
</span><span id="SeismicVolume.add_weighted_noise-410"><a href="#-410"><span class="linenos">410</span></a>        <span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">sin</span><span class="p">,</span> <span class="n">cos</span>
</span><span id="SeismicVolume.add_weighted_noise-411"><a href="#-411"><span class="linenos">411</span></a>        <span class="kn">from</span> <span class="nn">datagenerator.util</span> <span class="kn">import</span> <span class="n">mute_above_seafloor</span>
</span><span id="SeismicVolume.add_weighted_noise-412"><a href="#-412"><span class="linenos">412</span></a>        <span class="kn">from</span> <span class="nn">datagenerator.util</span> <span class="kn">import</span> <span class="n">infill_surface</span>
</span><span id="SeismicVolume.add_weighted_noise-413"><a href="#-413"><span class="linenos">413</span></a>
</span><span id="SeismicVolume.add_weighted_noise-414"><a href="#-414"><span class="linenos">414</span></a>        <span class="c1"># Calculate standard deviation ratio to use based on user-input sn_db parameter</span>
</span><span id="SeismicVolume.add_weighted_noise-415"><a href="#-415"><span class="linenos">415</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="SeismicVolume.add_weighted_noise-416"><a href="#-416"><span class="linenos">416</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">...adding random noise to </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">rfc_raw</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> cubes...&quot;</span><span class="p">)</span>
</span><span id="SeismicVolume.add_weighted_noise-417"><a href="#-417"><span class="linenos">417</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;S/N ratio = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">sn_db</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="SeismicVolume.add_weighted_noise-418"><a href="#-418"><span class="linenos">418</span></a>        <span class="n">std_ratio</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">10</span> <span class="o">**</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">sn_db</span> <span class="o">/</span> <span class="mf">10.0</span><span class="p">))</span>
</span><span id="SeismicVolume.add_weighted_noise-419"><a href="#-419"><span class="linenos">419</span></a>
</span><span id="SeismicVolume.add_weighted_noise-420"><a href="#-420"><span class="linenos">420</span></a>        <span class="c1"># Compute standard deviation in bottom half of cube, and use this to scale the noise</span>
</span><span id="SeismicVolume.add_weighted_noise-421"><a href="#-421"><span class="linenos">421</span></a>        <span class="c1"># if wb has holes (i.e. Nan or 0 values), fill holes using replacement with interpolated (NN) values</span>
</span><span id="SeismicVolume.add_weighted_noise-422"><a href="#-422"><span class="linenos">422</span></a>        <span class="n">wb_map</span> <span class="o">=</span> <span class="n">depth_maps</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
</span><span id="SeismicVolume.add_weighted_noise-423"><a href="#-423"><span class="linenos">423</span></a>        <span class="c1"># Add test for all 0&#39;s in wb_map in case z_shift has been applied</span>
</span><span id="SeismicVolume.add_weighted_noise-424"><a href="#-424"><span class="linenos">424</span></a>        <span class="k">if</span> <span class="p">(</span>
</span><span id="SeismicVolume.add_weighted_noise-425"><a href="#-425"><span class="linenos">425</span></a>            <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">wb_map</span><span class="p">))</span> <span class="ow">or</span> <span class="mi">0</span> <span class="ow">in</span> <span class="n">wb_map</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">wb_map</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="SeismicVolume.add_weighted_noise-426"><a href="#-426"><span class="linenos">426</span></a>        <span class="p">):</span>  <span class="c1"># If wb contains nan&#39;s or at least one 0, this will return True</span>
</span><span id="SeismicVolume.add_weighted_noise-427"><a href="#-427"><span class="linenos">427</span></a>            <span class="n">wb_map</span> <span class="o">=</span> <span class="n">infill_surface</span><span class="p">(</span><span class="n">wb_map</span><span class="p">)</span>
</span><span id="SeismicVolume.add_weighted_noise-428"><a href="#-428"><span class="linenos">428</span></a>        <span class="n">wb_plus_15samples</span> <span class="o">=</span> <span class="n">wb_map</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">digi</span> <span class="o">+</span> <span class="mi">15</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">digi</span>
</span><span id="SeismicVolume.add_weighted_noise-429"><a href="#-429"><span class="linenos">429</span></a>
</span><span id="SeismicVolume.add_weighted_noise-430"><a href="#-430"><span class="linenos">430</span></a>        <span class="c1"># Use the Middle angle cube for normalisation</span>
</span><span id="SeismicVolume.add_weighted_noise-431"><a href="#-431"><span class="linenos">431</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">model_qc_volumes</span><span class="p">:</span>
</span><span id="SeismicVolume.add_weighted_noise-432"><a href="#-432"><span class="linenos">432</span></a>            <span class="c1"># 0 and 45 degree cubes have been added</span>
</span><span id="SeismicVolume.add_weighted_noise-433"><a href="#-433"><span class="linenos">433</span></a>            <span class="n">norm_cube</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rfc_raw</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
</span><span id="SeismicVolume.add_weighted_noise-434"><a href="#-434"><span class="linenos">434</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SeismicVolume.add_weighted_noise-435"><a href="#-435"><span class="linenos">435</span></a>            <span class="n">norm_cube</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rfc_raw</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
</span><span id="SeismicVolume.add_weighted_noise-436"><a href="#-436"><span class="linenos">436</span></a>        <span class="n">data_below_seafloor</span> <span class="o">=</span> <span class="n">norm_cube</span><span class="p">[</span>
</span><span id="SeismicVolume.add_weighted_noise-437"><a href="#-437"><span class="linenos">437</span></a>            <span class="n">mute_above_seafloor</span><span class="p">(</span><span class="n">wb_plus_15samples</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">norm_cube</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="s2">&quot;float&quot;</span><span class="p">))</span>
</span><span id="SeismicVolume.add_weighted_noise-438"><a href="#-438"><span class="linenos">438</span></a>            <span class="o">!=</span> <span class="mf">0.0</span>
</span><span id="SeismicVolume.add_weighted_noise-439"><a href="#-439"><span class="linenos">439</span></a>        <span class="p">]</span>
</span><span id="SeismicVolume.add_weighted_noise-440"><a href="#-440"><span class="linenos">440</span></a>        <span class="n">data_std</span> <span class="o">=</span> <span class="n">data_below_seafloor</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
</span><span id="SeismicVolume.add_weighted_noise-441"><a href="#-441"><span class="linenos">441</span></a>
</span><span id="SeismicVolume.add_weighted_noise-442"><a href="#-442"><span class="linenos">442</span></a>        <span class="c1"># Create array to store the 3D noise model for each angle</span>
</span><span id="SeismicVolume.add_weighted_noise-443"><a href="#-443"><span class="linenos">443</span></a>        <span class="n">noise3d_cubes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rfc_raw</span><span class="p">[:])</span>
</span><span id="SeismicVolume.add_weighted_noise-444"><a href="#-444"><span class="linenos">444</span></a>
</span><span id="SeismicVolume.add_weighted_noise-445"><a href="#-445"><span class="linenos">445</span></a>        <span class="c1"># Add weighted stack of noise using Hilterman equation to each angle substack</span>
</span><span id="SeismicVolume.add_weighted_noise-446"><a href="#-446"><span class="linenos">446</span></a>        <span class="n">noise_0deg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">noise_3d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rfc_raw</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="SeismicVolume.add_weighted_noise-447"><a href="#-447"><span class="linenos">447</span></a>        <span class="n">noise_45deg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">noise_3d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rfc_raw</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="SeismicVolume.add_weighted_noise-448"><a href="#-448"><span class="linenos">448</span></a>        <span class="c1"># Store the noise models</span>
</span><span id="SeismicVolume.add_weighted_noise-449"><a href="#-449"><span class="linenos">449</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">noise_0deg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span><span class="s2">&quot;noise_0deg&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">noise_0deg</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span><span id="SeismicVolume.add_weighted_noise-450"><a href="#-450"><span class="linenos">450</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">noise_45deg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">hdf_init</span><span class="p">(</span><span class="s2">&quot;noise_45deg&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">noise_45deg</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span><span id="SeismicVolume.add_weighted_noise-451"><a href="#-451"><span class="linenos">451</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">noise_0deg</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">noise_0deg</span>
</span><span id="SeismicVolume.add_weighted_noise-452"><a href="#-452"><span class="linenos">452</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">noise_45deg</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">noise_45deg</span>
</span><span id="SeismicVolume.add_weighted_noise-453"><a href="#-453"><span class="linenos">453</span></a>
</span><span id="SeismicVolume.add_weighted_noise-454"><a href="#-454"><span class="linenos">454</span></a>        <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">ang</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">angles</span><span class="p">):</span>
</span><span id="SeismicVolume.add_weighted_noise-455"><a href="#-455"><span class="linenos">455</span></a>            <span class="n">weighted_noise</span> <span class="o">=</span> <span class="n">noise_0deg</span> <span class="o">*</span> <span class="p">(</span><span class="n">cos</span><span class="p">(</span><span class="n">ang</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">noise_45deg</span> <span class="o">*</span> <span class="p">(</span>
</span><span id="SeismicVolume.add_weighted_noise-456"><a href="#-456"><span class="linenos">456</span></a>                <span class="n">sin</span><span class="p">(</span><span class="n">ang</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
</span><span id="SeismicVolume.add_weighted_noise-457"><a href="#-457"><span class="linenos">457</span></a>            <span class="p">)</span>
</span><span id="SeismicVolume.add_weighted_noise-458"><a href="#-458"><span class="linenos">458</span></a>            <span class="n">noise_std</span> <span class="o">=</span> <span class="n">weighted_noise</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
</span><span id="SeismicVolume.add_weighted_noise-459"><a href="#-459"><span class="linenos">459</span></a>            <span class="n">noise3d_cubes</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">weighted_noise</span> <span class="o">*</span> <span class="p">(</span><span class="n">data_std</span> <span class="o">/</span> <span class="n">noise_std</span><span class="p">)</span> <span class="o">/</span> <span class="n">std_ratio</span>
</span><span id="SeismicVolume.add_weighted_noise-460"><a href="#-460"><span class="linenos">460</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="SeismicVolume.add_weighted_noise-461"><a href="#-461"><span class="linenos">461</span></a>                <span class="nb">print</span><span class="p">(</span>
</span><span id="SeismicVolume.add_weighted_noise-462"><a href="#-462"><span class="linenos">462</span></a>                    <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">...Normalised noise3d for angle </span><span class="si">{</span><span class="n">ang</span><span class="si">}</span><span class="s2">:</span><span class="se">\t</span><span class="s2">Min: </span><span class="si">{</span><span class="n">noise3d_cubes</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">,&quot;</span>
</span><span id="SeismicVolume.add_weighted_noise-463"><a href="#-463"><span class="linenos">463</span></a>                    <span class="sa">f</span><span class="s2">&quot; mean: </span><span class="si">{</span><span class="n">noise3d_cubes</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">, max: </span><span class="si">{</span><span class="n">noise3d_cubes</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">,&quot;</span>
</span><span id="SeismicVolume.add_weighted_noise-464"><a href="#-464"><span class="linenos">464</span></a>                    <span class="sa">f</span><span class="s2">&quot; std: </span><span class="si">{</span><span class="n">noise3d_cubes</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="SeismicVolume.add_weighted_noise-465"><a href="#-465"><span class="linenos">465</span></a>                <span class="p">)</span>
</span><span id="SeismicVolume.add_weighted_noise-466"><a href="#-466"><span class="linenos">466</span></a>                <span class="nb">print</span><span class="p">(</span>
</span><span id="SeismicVolume.add_weighted_noise-467"><a href="#-467"><span class="linenos">467</span></a>                    <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">S/N ratio = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">sn_db</span><span class="si">:</span><span class="s2">3.1f</span><span class="si">}</span><span class="s2"> dB.</span><span class="se">\n\t</span><span class="s2">std_ratio = </span><span class="si">{</span><span class="n">std_ratio</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="SeismicVolume.add_weighted_noise-468"><a href="#-468"><span class="linenos">468</span></a>                    <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n\t</span><span class="s2">data_std = </span><span class="si">{</span><span class="n">data_std</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="se">\n\t</span><span class="s2">noise_std = </span><span class="si">{</span><span class="n">noise_std</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="SeismicVolume.add_weighted_noise-469"><a href="#-469"><span class="linenos">469</span></a>                <span class="p">)</span>
</span><span id="SeismicVolume.add_weighted_noise-470"><a href="#-470"><span class="linenos">470</span></a>
</span><span id="SeismicVolume.add_weighted_noise-471"><a href="#-471"><span class="linenos">471</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">rfc_noise_added</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">noise3d_cubes</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">rfc_raw</span><span class="p">[:]</span>
</span></pre></div>


            <div class="docstring"><p>Apply 3D weighted random noise to ndarray.</p>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>Sum of rfc_volumes and 3D noise model, weighted by angle</p>
</blockquote>
</div>


                            </div>
                            <div id="SeismicVolume.apply_bandlimits" class="classattr">
                                        <input id="SeismicVolume.apply_bandlimits-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">apply_bandlimits</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">data</span>, </span><span class="param"><span class="n">frequencies</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SeismicVolume.apply_bandlimits-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SeismicVolume.apply_bandlimits"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SeismicVolume.apply_bandlimits-473"><a href="#-473"><span class="linenos">473</span></a>    <span class="k">def</span> <span class="nf">apply_bandlimits</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">frequencies</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="SeismicVolume.apply_bandlimits-474"><a href="#-474"><span class="linenos">474</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="SeismicVolume.apply_bandlimits-475"><a href="#-475"><span class="linenos">475</span></a><span class="sd">        Apply Butterworth Bandpass Filter to data</span>
</span><span id="SeismicVolume.apply_bandlimits-476"><a href="#-476"><span class="linenos">476</span></a><span class="sd">        :param data: 4D array of RFC values</span>
</span><span id="SeismicVolume.apply_bandlimits-477"><a href="#-477"><span class="linenos">477</span></a><span class="sd">        :param frequencies: Explicit frequency bounds (lower, upper)</span>
</span><span id="SeismicVolume.apply_bandlimits-478"><a href="#-478"><span class="linenos">478</span></a><span class="sd">        :return: 4D array of band-limited RFC</span>
</span><span id="SeismicVolume.apply_bandlimits-479"><a href="#-479"><span class="linenos">479</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SeismicVolume.apply_bandlimits-480"><a href="#-480"><span class="linenos">480</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="SeismicVolume.apply_bandlimits-481"><a href="#-481"><span class="linenos">481</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Data Min: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, Data Max: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="SeismicVolume.apply_bandlimits-482"><a href="#-482"><span class="linenos">482</span></a>        <span class="n">dt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">digi</span> <span class="o">/</span> <span class="mf">1000.0</span>
</span><span id="SeismicVolume.apply_bandlimits-483"><a href="#-483"><span class="linenos">483</span></a>        <span class="k">if</span> <span class="p">(</span>
</span><span id="SeismicVolume.apply_bandlimits-484"><a href="#-484"><span class="linenos">484</span></a>            <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">infill_factor</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">pad_samples</span>
</span><span id="SeismicVolume.apply_bandlimits-485"><a href="#-485"><span class="linenos">485</span></a>            <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="SeismicVolume.apply_bandlimits-486"><a href="#-486"><span class="linenos">486</span></a>        <span class="p">):</span>
</span><span id="SeismicVolume.apply_bandlimits-487"><a href="#-487"><span class="linenos">487</span></a>            <span class="c1"># Input data is infilled</span>
</span><span id="SeismicVolume.apply_bandlimits-488"><a href="#-488"><span class="linenos">488</span></a>            <span class="n">dt</span> <span class="o">/=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">infill_factor</span>
</span><span id="SeismicVolume.apply_bandlimits-489"><a href="#-489"><span class="linenos">489</span></a>        <span class="k">if</span> <span class="n">frequencies</span><span class="p">:</span>  <span class="c1"># if frequencies explicitly defined</span>
</span><span id="SeismicVolume.apply_bandlimits-490"><a href="#-490"><span class="linenos">490</span></a>            <span class="n">low</span> <span class="o">=</span> <span class="n">frequencies</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="SeismicVolume.apply_bandlimits-491"><a href="#-491"><span class="linenos">491</span></a>            <span class="n">high</span> <span class="o">=</span> <span class="n">frequencies</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="SeismicVolume.apply_bandlimits-492"><a href="#-492"><span class="linenos">492</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SeismicVolume.apply_bandlimits-493"><a href="#-493"><span class="linenos">493</span></a>            <span class="n">low</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">lowfreq</span>
</span><span id="SeismicVolume.apply_bandlimits-494"><a href="#-494"><span class="linenos">494</span></a>            <span class="n">high</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">highfreq</span>
</span><span id="SeismicVolume.apply_bandlimits-495"><a href="#-495"><span class="linenos">495</span></a>        <span class="n">b</span><span class="p">,</span> <span class="n">a</span> <span class="o">=</span> <span class="n">derive_butterworth_bandpass</span><span class="p">(</span>
</span><span id="SeismicVolume.apply_bandlimits-496"><a href="#-496"><span class="linenos">496</span></a>            <span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="p">,</span> <span class="p">(</span><span class="n">dt</span> <span class="o">*</span> <span class="mf">1000.0</span><span class="p">),</span> <span class="n">order</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">order</span>
</span><span id="SeismicVolume.apply_bandlimits-497"><a href="#-497"><span class="linenos">497</span></a>        <span class="p">)</span>
</span><span id="SeismicVolume.apply_bandlimits-498"><a href="#-498"><span class="linenos">498</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="SeismicVolume.apply_bandlimits-499"><a href="#-499"><span class="linenos">499</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">... Low Frequency; </span><span class="si">{</span><span class="n">low</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> Hz, High Frequency: </span><span class="si">{</span><span class="n">high</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> Hz&quot;</span><span class="p">)</span>
</span><span id="SeismicVolume.apply_bandlimits-500"><a href="#-500"><span class="linenos">500</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="SeismicVolume.apply_bandlimits-501"><a href="#-501"><span class="linenos">501</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">... start_width: </span><span class="si">{</span><span class="mf">1.</span> <span class="o">/</span> <span class="p">(</span><span class="n">dt</span> <span class="o">*</span> <span class="n">low</span><span class="p">)</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">, end_width: </span><span class="si">{</span><span class="mf">1.</span> <span class="o">/</span> <span class="p">(</span><span class="n">dt</span> <span class="o">*</span> <span class="n">high</span><span class="p">)</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="SeismicVolume.apply_bandlimits-502"><a href="#-502"><span class="linenos">502</span></a>            <span class="p">)</span>
</span><span id="SeismicVolume.apply_bandlimits-503"><a href="#-503"><span class="linenos">503</span></a>
</span><span id="SeismicVolume.apply_bandlimits-504"><a href="#-504"><span class="linenos">504</span></a>        <span class="c1"># Loop over 3D angle stack arrays</span>
</span><span id="SeismicVolume.apply_bandlimits-505"><a href="#-505"><span class="linenos">505</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="SeismicVolume.apply_bandlimits-506"><a href="#-506"><span class="linenos">506</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; ... shape of data being bandlimited = &quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="SeismicVolume.apply_bandlimits-507"><a href="#-507"><span class="linenos">507</span></a>        <span class="n">num</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="SeismicVolume.apply_bandlimits-508"><a href="#-508"><span class="linenos">508</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="SeismicVolume.apply_bandlimits-509"><a href="#-509"><span class="linenos">509</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Applying Bandpass to </span><span class="si">{</span><span class="n">num</span><span class="si">}</span><span class="s2"> cubes&quot;</span><span class="p">)</span>
</span><span id="SeismicVolume.apply_bandlimits-510"><a href="#-510"><span class="linenos">510</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">multiprocess_bp</span><span class="p">:</span>
</span><span id="SeismicVolume.apply_bandlimits-511"><a href="#-511"><span class="linenos">511</span></a>            <span class="c1"># Much faster to use multiprocessing and apply band-limitation to entire cube at once</span>
</span><span id="SeismicVolume.apply_bandlimits-512"><a href="#-512"><span class="linenos">512</span></a>            <span class="k">with</span> <span class="n">Pool</span><span class="p">(</span><span class="n">processes</span><span class="o">=</span><span class="nb">min</span><span class="p">(</span><span class="n">num</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">cpu_count</span><span class="p">()</span> <span class="o">-</span> <span class="mi">2</span><span class="p">))</span> <span class="k">as</span> <span class="n">p</span><span class="p">:</span>
</span><span id="SeismicVolume.apply_bandlimits-513"><a href="#-513"><span class="linenos">513</span></a>                <span class="n">iterator</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span>
</span><span id="SeismicVolume.apply_bandlimits-514"><a href="#-514"><span class="linenos">514</span></a>                    <span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num</span><span class="p">)],</span>
</span><span id="SeismicVolume.apply_bandlimits-515"><a href="#-515"><span class="linenos">515</span></a>                    <span class="n">itertools</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">b</span><span class="p">),</span>
</span><span id="SeismicVolume.apply_bandlimits-516"><a href="#-516"><span class="linenos">516</span></a>                    <span class="n">itertools</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">a</span><span class="p">),</span>
</span><span id="SeismicVolume.apply_bandlimits-517"><a href="#-517"><span class="linenos">517</span></a>                <span class="p">)</span>
</span><span id="SeismicVolume.apply_bandlimits-518"><a href="#-518"><span class="linenos">518</span></a>                <span class="n">out_cubes_mp</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">starmap</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_run_bandpass_on_cubes</span><span class="p">,</span> <span class="n">iterator</span><span class="p">)</span>
</span><span id="SeismicVolume.apply_bandlimits-519"><a href="#-519"><span class="linenos">519</span></a>            <span class="n">out_cubes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">out_cubes_mp</span><span class="p">)</span>
</span><span id="SeismicVolume.apply_bandlimits-520"><a href="#-520"><span class="linenos">520</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SeismicVolume.apply_bandlimits-521"><a href="#-521"><span class="linenos">521</span></a>            <span class="c1"># multiprocessing can fail using Python version 3.6 and very large arrays</span>
</span><span id="SeismicVolume.apply_bandlimits-522"><a href="#-522"><span class="linenos">522</span></a>            <span class="n">out_cubes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="SeismicVolume.apply_bandlimits-523"><a href="#-523"><span class="linenos">523</span></a>            <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num</span><span class="p">):</span>
</span><span id="SeismicVolume.apply_bandlimits-524"><a href="#-524"><span class="linenos">524</span></a>                <span class="n">out_cubes</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_run_bandpass_on_cubes</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span> <span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
</span><span id="SeismicVolume.apply_bandlimits-525"><a href="#-525"><span class="linenos">525</span></a>
</span><span id="SeismicVolume.apply_bandlimits-526"><a href="#-526"><span class="linenos">526</span></a>        <span class="k">return</span> <span class="n">out_cubes</span>
</span></pre></div>


            <div class="docstring"><p>Apply Butterworth Bandpass Filter to data</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>data</strong>:  4D array of RFC values</li>
<li><strong>frequencies</strong>:  Explicit frequency bounds (lower, upper)</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>4D array of band-limited RFC</p>
</blockquote>
</div>


                            </div>
                            <div id="SeismicVolume.apply_lateral_filter" class="classattr">
                                        <input id="SeismicVolume.apply_lateral_filter-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">apply_lateral_filter</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">data</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SeismicVolume.apply_lateral_filter-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SeismicVolume.apply_lateral_filter"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SeismicVolume.apply_lateral_filter-533"><a href="#-533"><span class="linenos">533</span></a>    <span class="k">def</span> <span class="nf">apply_lateral_filter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
</span><span id="SeismicVolume.apply_lateral_filter-534"><a href="#-534"><span class="linenos">534</span></a>        <span class="kn">from</span> <span class="nn">scipy.ndimage</span> <span class="kn">import</span> <span class="n">uniform_filter</span>
</span><span id="SeismicVolume.apply_lateral_filter-535"><a href="#-535"><span class="linenos">535</span></a>
</span><span id="SeismicVolume.apply_lateral_filter-536"><a href="#-536"><span class="linenos">536</span></a>        <span class="n">n_filt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">lateral_filter_size</span>
</span><span id="SeismicVolume.apply_lateral_filter-537"><a href="#-537"><span class="linenos">537</span></a>        <span class="k">return</span> <span class="n">uniform_filter</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n_filt</span><span class="p">,</span> <span class="n">n_filt</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
</span></pre></div>


    

                            </div>
                            <div id="SeismicVolume.apply_cumsum" class="classattr">
                                        <input id="SeismicVolume.apply_cumsum-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">apply_cumsum</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">data</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SeismicVolume.apply_cumsum-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SeismicVolume.apply_cumsum"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SeismicVolume.apply_cumsum-539"><a href="#-539"><span class="linenos">539</span></a>    <span class="k">def</span> <span class="nf">apply_cumsum</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
</span><span id="SeismicVolume.apply_cumsum-540"><a href="#-540"><span class="linenos">540</span></a>        <span class="sd">&quot;&quot;&quot;Calculate cumulative sum on the Z-axis of input data</span>
</span><span id="SeismicVolume.apply_cumsum-541"><a href="#-541"><span class="linenos">541</span></a><span class="sd">        Sipmap&#39;s cumsum also applies an Ormsby filter to the cumulatively summed data</span>
</span><span id="SeismicVolume.apply_cumsum-542"><a href="#-542"><span class="linenos">542</span></a><span class="sd">        To replicate this, apply a butterworth filter to the data using 2, 100Hz frequency limits</span>
</span><span id="SeismicVolume.apply_cumsum-543"><a href="#-543"><span class="linenos">543</span></a><span class="sd">        todo: make an ormsby function&quot;&quot;&quot;</span>
</span><span id="SeismicVolume.apply_cumsum-544"><a href="#-544"><span class="linenos">544</span></a>        <span class="n">cumsum</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="SeismicVolume.apply_cumsum-545"><a href="#-545"><span class="linenos">545</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_bandlimits</span><span class="p">(</span><span class="n">cumsum</span><span class="p">,</span> <span class="p">(</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">100.0</span><span class="p">))</span>
</span></pre></div>


            <div class="docstring"><p>Calculate cumulative sum on the Z-axis of input data
Sipmap's cumsum also applies an Ormsby filter to the cumulatively summed data
To replicate this, apply a butterworth filter to the data using 2, 100Hz frequency limits
todo: make an ormsby function</p>
</div>


                            </div>
                            <div id="SeismicVolume.stack_substacks" class="classattr">
                                        <input id="SeismicVolume.stack_substacks-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">stack_substacks</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">cube_list</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SeismicVolume.stack_substacks-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SeismicVolume.stack_substacks"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SeismicVolume.stack_substacks-547"><a href="#-547"><span class="linenos">547</span></a>    <span class="nd">@staticmethod</span>
</span><span id="SeismicVolume.stack_substacks-548"><a href="#-548"><span class="linenos">548</span></a>    <span class="k">def</span> <span class="nf">stack_substacks</span><span class="p">(</span><span class="n">cube_list</span><span class="p">):</span>
</span><span id="SeismicVolume.stack_substacks-549"><a href="#-549"><span class="linenos">549</span></a>        <span class="sd">&quot;&quot;&quot;Stack cubes by taking mean&quot;&quot;&quot;</span>
</span><span id="SeismicVolume.stack_substacks-550"><a href="#-550"><span class="linenos">550</span></a>        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">cube_list</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Stack cubes by taking mean</p>
</div>


                            </div>
                            <div id="SeismicVolume.augment_data_and_labels" class="classattr">
                                        <input id="SeismicVolume.augment_data_and_labels-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">augment_data_and_labels</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">normalised_seismic</span>, </span><span class="param"><span class="n">seabed</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SeismicVolume.augment_data_and_labels-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SeismicVolume.augment_data_and_labels"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SeismicVolume.augment_data_and_labels-552"><a href="#-552"><span class="linenos">552</span></a>    <span class="k">def</span> <span class="nf">augment_data_and_labels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">normalised_seismic</span><span class="p">,</span> <span class="n">seabed</span><span class="p">):</span>
</span><span id="SeismicVolume.augment_data_and_labels-553"><a href="#-553"><span class="linenos">553</span></a>        <span class="kn">from</span> <span class="nn">datagenerator.Augmentation</span> <span class="kn">import</span> <span class="n">tz_stretch</span><span class="p">,</span> <span class="n">uniform_stretch</span>
</span><span id="SeismicVolume.augment_data_and_labels-554"><a href="#-554"><span class="linenos">554</span></a>
</span><span id="SeismicVolume.augment_data_and_labels-555"><a href="#-555"><span class="linenos">555</span></a>        <span class="n">hc_labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">h5file</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ModelData</span><span class="o">.</span><span class="n">hc_labels</span><span class="p">[:]</span>
</span><span id="SeismicVolume.augment_data_and_labels-556"><a href="#-556"><span class="linenos">556</span></a>        <span class="n">data</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">tz_stretch</span><span class="p">(</span>
</span><span id="SeismicVolume.augment_data_and_labels-557"><a href="#-557"><span class="linenos">557</span></a>            <span class="n">normalised_seismic</span><span class="p">,</span>
</span><span id="SeismicVolume.augment_data_and_labels-558"><a href="#-558"><span class="linenos">558</span></a>            <span class="n">hc_labels</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">cube_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">pad_samples</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span>
</span><span id="SeismicVolume.augment_data_and_labels-559"><a href="#-559"><span class="linenos">559</span></a>            <span class="n">seabed</span><span class="p">,</span>
</span><span id="SeismicVolume.augment_data_and_labels-560"><a href="#-560"><span class="linenos">560</span></a>        <span class="p">)</span>
</span><span id="SeismicVolume.augment_data_and_labels-561"><a href="#-561"><span class="linenos">561</span></a>        <span class="n">seismic</span><span class="p">,</span> <span class="n">hc</span> <span class="o">=</span> <span class="n">uniform_stretch</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">labels</span><span class="p">)</span>
</span><span id="SeismicVolume.augment_data_and_labels-562"><a href="#-562"><span class="linenos">562</span></a>        <span class="k">return</span> <span class="n">seismic</span><span class="p">,</span> <span class="n">hc</span>
</span></pre></div>


    

                            </div>
                            <div id="SeismicVolume.compute_randomRMO_1D" class="classattr">
                                        <input id="SeismicVolume.compute_randomRMO_1D-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">compute_randomRMO_1D</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">nsamples</span>,</span><span class="param">	<span class="n">inc_angle_list</span>,</span><span class="param">	<span class="n">velocity_fraction</span><span class="o">=</span><span class="mf">0.015</span>,</span><span class="param">	<span class="n">return_plot</span><span class="o">=</span><span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SeismicVolume.compute_randomRMO_1D-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SeismicVolume.compute_randomRMO_1D"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SeismicVolume.compute_randomRMO_1D-564"><a href="#-564"><span class="linenos">564</span></a>    <span class="k">def</span> <span class="nf">compute_randomRMO_1D</span><span class="p">(</span>
</span><span id="SeismicVolume.compute_randomRMO_1D-565"><a href="#-565"><span class="linenos">565</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">nsamples</span><span class="p">,</span> <span class="n">inc_angle_list</span><span class="p">,</span> <span class="n">velocity_fraction</span><span class="o">=</span><span class="mf">0.015</span><span class="p">,</span> <span class="n">return_plot</span><span class="o">=</span><span class="kc">False</span>
</span><span id="SeismicVolume.compute_randomRMO_1D-566"><a href="#-566"><span class="linenos">566</span></a>    <span class="p">):</span>
</span><span id="SeismicVolume.compute_randomRMO_1D-567"><a href="#-567"><span class="linenos">567</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="SeismicVolume.compute_randomRMO_1D-568"><a href="#-568"><span class="linenos">568</span></a><span class="sd">        compute 1D indices for to apply residual moveout via interpolation</span>
</span><span id="SeismicVolume.compute_randomRMO_1D-569"><a href="#-569"><span class="linenos">569</span></a><span class="sd">        - nsamples is the array length in depth</span>
</span><span id="SeismicVolume.compute_randomRMO_1D-570"><a href="#-570"><span class="linenos">570</span></a><span class="sd">        - inc_angle_list is a list of angle in degrees for angle stacks to which</span>
</span><span id="SeismicVolume.compute_randomRMO_1D-571"><a href="#-571"><span class="linenos">571</span></a><span class="sd">        results will be applied</span>
</span><span id="SeismicVolume.compute_randomRMO_1D-572"><a href="#-572"><span class="linenos">572</span></a><span class="sd">        - velocity_fraction is the maximum percent error in absolute value.</span>
</span><span id="SeismicVolume.compute_randomRMO_1D-573"><a href="#-573"><span class="linenos">573</span></a><span class="sd">        for example, .03 would generate RMO based on velocity from .97 to 1.03 times correct velocity</span>
</span><span id="SeismicVolume.compute_randomRMO_1D-574"><a href="#-574"><span class="linenos">574</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SeismicVolume.compute_randomRMO_1D-575"><a href="#-575"><span class="linenos">575</span></a>        <span class="kn">from</span> <span class="nn">scipy.interpolate</span> <span class="kn">import</span> <span class="n">UnivariateSpline</span>
</span><span id="SeismicVolume.compute_randomRMO_1D-576"><a href="#-576"><span class="linenos">576</span></a>
</span><span id="SeismicVolume.compute_randomRMO_1D-577"><a href="#-577"><span class="linenos">577</span></a>        <span class="n">input_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nsamples</span><span class="p">)</span>
</span><span id="SeismicVolume.compute_randomRMO_1D-578"><a href="#-578"><span class="linenos">578</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">qc_plots</span><span class="p">:</span>
</span><span id="SeismicVolume.compute_randomRMO_1D-579"><a href="#-579"><span class="linenos">579</span></a>            <span class="kn">from</span> <span class="nn">datagenerator.util</span> <span class="kn">import</span> <span class="n">import_matplotlib</span>
</span><span id="SeismicVolume.compute_randomRMO_1D-580"><a href="#-580"><span class="linenos">580</span></a>
</span><span id="SeismicVolume.compute_randomRMO_1D-581"><a href="#-581"><span class="linenos">581</span></a>            <span class="n">plt</span> <span class="o">=</span> <span class="n">import_matplotlib</span><span class="p">()</span>
</span><span id="SeismicVolume.compute_randomRMO_1D-582"><a href="#-582"><span class="linenos">582</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span id="SeismicVolume.compute_randomRMO_1D-583"><a href="#-583"><span class="linenos">583</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mf">4.75</span><span class="p">,</span> <span class="mf">6.0</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
</span><span id="SeismicVolume.compute_randomRMO_1D-584"><a href="#-584"><span class="linenos">584</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
</span><span id="SeismicVolume.compute_randomRMO_1D-585"><a href="#-585"><span class="linenos">585</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
</span><span id="SeismicVolume.compute_randomRMO_1D-586"><a href="#-586"><span class="linenos">586</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">((</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
</span><span id="SeismicVolume.compute_randomRMO_1D-587"><a href="#-587"><span class="linenos">587</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">((</span><span class="n">nsamples</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
</span><span id="SeismicVolume.compute_randomRMO_1D-588"><a href="#-588"><span class="linenos">588</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;depth (samples)&quot;</span><span class="p">)</span>
</span><span id="SeismicVolume.compute_randomRMO_1D-589"><a href="#-589"><span class="linenos">589</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;RMO (samples)&quot;</span><span class="p">)</span>
</span><span id="SeismicVolume.compute_randomRMO_1D-590"><a href="#-590"><span class="linenos">590</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span>
</span><span id="SeismicVolume.compute_randomRMO_1D-591"><a href="#-591"><span class="linenos">591</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">work_subfolder</span><span class="p">,</span> <span class="s2">&quot;rmo_1d.png&quot;</span><span class="p">),</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;png&quot;</span>
</span><span id="SeismicVolume.compute_randomRMO_1D-592"><a href="#-592"><span class="linenos">592</span></a>            <span class="p">)</span>
</span><span id="SeismicVolume.compute_randomRMO_1D-593"><a href="#-593"><span class="linenos">593</span></a>        <span class="c1"># generate 1 to 3 randomly located velocity fractions at random depth indices</span>
</span><span id="SeismicVolume.compute_randomRMO_1D-594"><a href="#-594"><span class="linenos">594</span></a>        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">250</span><span class="p">):</span>
</span><span id="SeismicVolume.compute_randomRMO_1D-595"><a href="#-595"><span class="linenos">595</span></a>            <span class="n">num_tie_points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
</span><span id="SeismicVolume.compute_randomRMO_1D-596"><a href="#-596"><span class="linenos">596</span></a>            <span class="n">tie_fractions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span>
</span><span id="SeismicVolume.compute_randomRMO_1D-597"><a href="#-597"><span class="linenos">597</span></a>                <span class="n">low</span><span class="o">=-</span><span class="n">velocity_fraction</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="n">velocity_fraction</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">num_tie_points</span>
</span><span id="SeismicVolume.compute_randomRMO_1D-598"><a href="#-598"><span class="linenos">598</span></a>            <span class="p">)</span>
</span><span id="SeismicVolume.compute_randomRMO_1D-599"><a href="#-599"><span class="linenos">599</span></a>            <span class="k">if</span> <span class="n">num_tie_points</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="SeismicVolume.compute_randomRMO_1D-600"><a href="#-600"><span class="linenos">600</span></a>                <span class="n">tie_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span>
</span><span id="SeismicVolume.compute_randomRMO_1D-601"><a href="#-601"><span class="linenos">601</span></a>                    <span class="n">low</span><span class="o">=</span><span class="mf">0.25</span> <span class="o">*</span> <span class="n">nsamples</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="mf">0.75</span> <span class="o">*</span> <span class="n">nsamples</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">num_tie_points</span>
</span><span id="SeismicVolume.compute_randomRMO_1D-602"><a href="#-602"><span class="linenos">602</span></a>                <span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;int&quot;</span><span class="p">)</span>
</span><span id="SeismicVolume.compute_randomRMO_1D-603"><a href="#-603"><span class="linenos">603</span></a>
</span><span id="SeismicVolume.compute_randomRMO_1D-604"><a href="#-604"><span class="linenos">604</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="SeismicVolume.compute_randomRMO_1D-605"><a href="#-605"><span class="linenos">605</span></a>                <span class="n">tie_indices</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span>
</span><span id="SeismicVolume.compute_randomRMO_1D-606"><a href="#-606"><span class="linenos">606</span></a>                    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="mf">0.25</span> <span class="o">*</span> <span class="n">nsamples</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="mf">0.75</span> <span class="o">*</span> <span class="n">nsamples</span><span class="p">)</span>
</span><span id="SeismicVolume.compute_randomRMO_1D-607"><a href="#-607"><span class="linenos">607</span></a>                <span class="p">)</span>
</span><span id="SeismicVolume.compute_randomRMO_1D-608"><a href="#-608"><span class="linenos">608</span></a>            <span class="n">tie_fractions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span> <span class="n">tie_fractions</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]))</span>
</span><span id="SeismicVolume.compute_randomRMO_1D-609"><a href="#-609"><span class="linenos">609</span></a>            <span class="n">tie_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">tie_indices</span><span class="p">,</span> <span class="p">[</span><span class="n">nsamples</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span> <span class="n">nsamples</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]))</span>
</span><span id="SeismicVolume.compute_randomRMO_1D-610"><a href="#-610"><span class="linenos">610</span></a>            <span class="n">tie_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">tie_indices</span><span class="p">)</span>
</span><span id="SeismicVolume.compute_randomRMO_1D-611"><a href="#-611"><span class="linenos">611</span></a>            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">tie_indices</span><span class="p">)</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">:</span>
</span><span id="SeismicVolume.compute_randomRMO_1D-612"><a href="#-612"><span class="linenos">612</span></a>                <span class="k">continue</span>
</span><span id="SeismicVolume.compute_randomRMO_1D-613"><a href="#-613"><span class="linenos">613</span></a>            <span class="n">s</span> <span class="o">=</span> <span class="n">UnivariateSpline</span><span class="p">(</span><span class="n">tie_indices</span><span class="p">,</span> <span class="n">tie_fractions</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
</span><span id="SeismicVolume.compute_randomRMO_1D-614"><a href="#-614"><span class="linenos">614</span></a>            <span class="n">tie_fraction_array</span> <span class="o">=</span> <span class="n">s</span><span class="p">(</span><span class="n">input_indices</span><span class="p">)</span>
</span><span id="SeismicVolume.compute_randomRMO_1D-615"><a href="#-615"><span class="linenos">615</span></a>            <span class="n">output_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nsamples</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">inc_angle_list</span><span class="p">)))</span>
</span><span id="SeismicVolume.compute_randomRMO_1D-616"><a href="#-616"><span class="linenos">616</span></a>            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">iangle</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">inc_angle_list</span><span class="p">):</span>
</span><span id="SeismicVolume.compute_randomRMO_1D-617"><a href="#-617"><span class="linenos">617</span></a>                <span class="n">output_indices</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">input_indices</span> <span class="o">*</span> <span class="p">(</span>
</span><span id="SeismicVolume.compute_randomRMO_1D-618"><a href="#-618"><span class="linenos">618</span></a>                    <span class="mf">1.0</span>
</span><span id="SeismicVolume.compute_randomRMO_1D-619"><a href="#-619"><span class="linenos">619</span></a>                    <span class="o">+</span> <span class="n">tie_fraction_array</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">iangle</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">180.0</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
</span><span id="SeismicVolume.compute_randomRMO_1D-620"><a href="#-620"><span class="linenos">620</span></a>                <span class="p">)</span>
</span><span id="SeismicVolume.compute_randomRMO_1D-621"><a href="#-621"><span class="linenos">621</span></a>            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">output_indices</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">input_indices</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mf">10.0</span><span class="p">:</span>
</span><span id="SeismicVolume.compute_randomRMO_1D-622"><a href="#-622"><span class="linenos">622</span></a>                <span class="k">break</span>
</span><span id="SeismicVolume.compute_randomRMO_1D-623"><a href="#-623"><span class="linenos">623</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">iangle</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">inc_angle_list</span><span class="p">):</span>
</span><span id="SeismicVolume.compute_randomRMO_1D-624"><a href="#-624"><span class="linenos">624</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">qc_plots</span><span class="p">:</span>
</span><span id="SeismicVolume.compute_randomRMO_1D-625"><a href="#-625"><span class="linenos">625</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
</span><span id="SeismicVolume.compute_randomRMO_1D-626"><a href="#-626"><span class="linenos">626</span></a>                    <span class="n">output_indices</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">input_indices</span><span class="p">,</span>
</span><span id="SeismicVolume.compute_randomRMO_1D-627"><a href="#-627"><span class="linenos">627</span></a>                    <span class="n">input_indices</span><span class="p">,</span>
</span><span id="SeismicVolume.compute_randomRMO_1D-628"><a href="#-628"><span class="linenos">628</span></a>                    <span class="n">label</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">inc_angle_list</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span>
</span><span id="SeismicVolume.compute_randomRMO_1D-629"><a href="#-629"><span class="linenos">629</span></a>                <span class="p">)</span>
</span><span id="SeismicVolume.compute_randomRMO_1D-630"><a href="#-630"><span class="linenos">630</span></a>
</span><span id="SeismicVolume.compute_randomRMO_1D-631"><a href="#-631"><span class="linenos">631</span></a>                <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">inc_angle_list</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="SeismicVolume.compute_randomRMO_1D-632"><a href="#-632"><span class="linenos">632</span></a>                    <span class="n">output_tie_indices</span> <span class="o">=</span> <span class="n">tie_indices</span> <span class="o">*</span> <span class="p">(</span>
</span><span id="SeismicVolume.compute_randomRMO_1D-633"><a href="#-633"><span class="linenos">633</span></a>                        <span class="mf">1.0</span>
</span><span id="SeismicVolume.compute_randomRMO_1D-634"><a href="#-634"><span class="linenos">634</span></a>                        <span class="o">+</span> <span class="n">tie_fraction_array</span><span class="p">[</span><span class="n">tie_indices</span><span class="p">]</span>
</span><span id="SeismicVolume.compute_randomRMO_1D-635"><a href="#-635"><span class="linenos">635</span></a>                        <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">iangle</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">180.0</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
</span><span id="SeismicVolume.compute_randomRMO_1D-636"><a href="#-636"><span class="linenos">636</span></a>                    <span class="p">)</span>
</span><span id="SeismicVolume.compute_randomRMO_1D-637"><a href="#-637"><span class="linenos">637</span></a>                    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">output_tie_indices</span> <span class="o">-</span> <span class="n">tie_indices</span><span class="p">,</span> <span class="n">tie_indices</span><span class="p">,</span> <span class="s2">&quot;ko&quot;</span><span class="p">)</span>
</span><span id="SeismicVolume.compute_randomRMO_1D-638"><a href="#-638"><span class="linenos">638</span></a>                    <span class="n">rmo_min</span> <span class="o">=</span> <span class="p">(</span><span class="n">output_indices</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">input_indices</span><span class="p">)</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
</span><span id="SeismicVolume.compute_randomRMO_1D-639"><a href="#-639"><span class="linenos">639</span></a>                    <span class="n">rmo_max</span> <span class="o">=</span> <span class="p">(</span><span class="n">output_indices</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">input_indices</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</span><span id="SeismicVolume.compute_randomRMO_1D-640"><a href="#-640"><span class="linenos">640</span></a>                    <span class="n">rmo_range</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">rmo_min</span><span class="p">,</span> <span class="n">rmo_max</span><span class="p">))</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span id="SeismicVolume.compute_randomRMO_1D-641"><a href="#-641"><span class="linenos">641</span></a>                    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span>
</span><span id="SeismicVolume.compute_randomRMO_1D-642"><a href="#-642"><span class="linenos">642</span></a>                        <span class="s2">&quot;simultated RMO arrival time offsets</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="SeismicVolume.compute_randomRMO_1D-643"><a href="#-643"><span class="linenos">643</span></a>                        <span class="o">+</span> <span class="s2">&quot;rmo range = &quot;</span>
</span><span id="SeismicVolume.compute_randomRMO_1D-644"><a href="#-644"><span class="linenos">644</span></a>                        <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">rmo_range</span><span class="p">),</span>
</span><span id="SeismicVolume.compute_randomRMO_1D-645"><a href="#-645"><span class="linenos">645</span></a>                        <span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span>
</span><span id="SeismicVolume.compute_randomRMO_1D-646"><a href="#-646"><span class="linenos">646</span></a>                    <span class="p">)</span>
</span><span id="SeismicVolume.compute_randomRMO_1D-647"><a href="#-647"><span class="linenos">647</span></a>                    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</span><span id="SeismicVolume.compute_randomRMO_1D-648"><a href="#-648"><span class="linenos">648</span></a>                    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</span><span id="SeismicVolume.compute_randomRMO_1D-649"><a href="#-649"><span class="linenos">649</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span>
</span><span id="SeismicVolume.compute_randomRMO_1D-650"><a href="#-650"><span class="linenos">650</span></a>                    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">work_subfolder</span><span class="p">,</span> <span class="s2">&quot;rmo_arrival_time.png&quot;</span><span class="p">),</span>
</span><span id="SeismicVolume.compute_randomRMO_1D-651"><a href="#-651"><span class="linenos">651</span></a>                    <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;png&quot;</span><span class="p">,</span>
</span><span id="SeismicVolume.compute_randomRMO_1D-652"><a href="#-652"><span class="linenos">652</span></a>                <span class="p">)</span>
</span><span id="SeismicVolume.compute_randomRMO_1D-653"><a href="#-653"><span class="linenos">653</span></a>
</span><span id="SeismicVolume.compute_randomRMO_1D-654"><a href="#-654"><span class="linenos">654</span></a>        <span class="k">if</span> <span class="n">return_plot</span><span class="p">:</span>
</span><span id="SeismicVolume.compute_randomRMO_1D-655"><a href="#-655"><span class="linenos">655</span></a>            <span class="k">return</span> <span class="n">output_indices</span><span class="p">,</span> <span class="n">plt</span>
</span><span id="SeismicVolume.compute_randomRMO_1D-656"><a href="#-656"><span class="linenos">656</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SeismicVolume.compute_randomRMO_1D-657"><a href="#-657"><span class="linenos">657</span></a>            <span class="k">return</span> <span class="n">output_indices</span>
</span></pre></div>


            <div class="docstring"><p>compute 1D indices for to apply residual moveout via interpolation</p>

<ul>
<li>nsamples is the array length in depth</li>
<li>inc_angle_list is a list of angle in degrees for angle stacks to which
results will be applied</li>
<li>velocity_fraction is the maximum percent error in absolute value.
for example, .03 would generate RMO based on velocity from .97 to 1.03 times correct velocity</li>
</ul>
</div>


                            </div>
                            <div id="SeismicVolume.apply_rmo_augmentation" class="classattr">
                                        <input id="SeismicVolume.apply_rmo_augmentation-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">apply_rmo_augmentation</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">angle_gather</span>, </span><span class="param"><span class="n">rmo_indices</span>, </span><span class="param"><span class="n">remove_mean_rmo</span><span class="o">=</span><span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SeismicVolume.apply_rmo_augmentation-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SeismicVolume.apply_rmo_augmentation"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SeismicVolume.apply_rmo_augmentation-659"><a href="#-659"><span class="linenos">659</span></a>    <span class="k">def</span> <span class="nf">apply_rmo_augmentation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">angle_gather</span><span class="p">,</span> <span class="n">rmo_indices</span><span class="p">,</span> <span class="n">remove_mean_rmo</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="SeismicVolume.apply_rmo_augmentation-660"><a href="#-660"><span class="linenos">660</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="SeismicVolume.apply_rmo_augmentation-661"><a href="#-661"><span class="linenos">661</span></a><span class="sd">        apply residual moveout via interpolation</span>
</span><span id="SeismicVolume.apply_rmo_augmentation-662"><a href="#-662"><span class="linenos">662</span></a><span class="sd">        applied to &#39;angle_gather&#39; with results from compute_randomRMO_1D in rmo_indices</span>
</span><span id="SeismicVolume.apply_rmo_augmentation-663"><a href="#-663"><span class="linenos">663</span></a><span class="sd">        angle_gather and rmo_indices need to be 2D arrays with the same shape (n_samples x n_angles)</span>
</span><span id="SeismicVolume.apply_rmo_augmentation-664"><a href="#-664"><span class="linenos">664</span></a><span class="sd">        - angle_gather is the array to which RMO is applied</span>
</span><span id="SeismicVolume.apply_rmo_augmentation-665"><a href="#-665"><span class="linenos">665</span></a><span class="sd">        - rmo_indices is the array used to modify the two-way-times of angle_gather</span>
</span><span id="SeismicVolume.apply_rmo_augmentation-666"><a href="#-666"><span class="linenos">666</span></a><span class="sd">        - remove_mean_rmo can be used to (when True) to apply relative RMO that keeps</span>
</span><span id="SeismicVolume.apply_rmo_augmentation-667"><a href="#-667"><span class="linenos">667</span></a><span class="sd">        event energy at roughly the same TWT. for example to avoid applying RMO</span>
</span><span id="SeismicVolume.apply_rmo_augmentation-668"><a href="#-668"><span class="linenos">668</span></a><span class="sd">        to both data and labels</span>
</span><span id="SeismicVolume.apply_rmo_augmentation-669"><a href="#-669"><span class="linenos">669</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SeismicVolume.apply_rmo_augmentation-670"><a href="#-670"><span class="linenos">670</span></a>        <span class="k">if</span> <span class="n">remove_mean_rmo</span><span class="p">:</span>
</span><span id="SeismicVolume.apply_rmo_augmentation-671"><a href="#-671"><span class="linenos">671</span></a>            <span class="c1"># apply de-trending to ensure that rmo does not change TWT</span>
</span><span id="SeismicVolume.apply_rmo_augmentation-672"><a href="#-672"><span class="linenos">672</span></a>            <span class="c1"># after rmo compared to before rmo &#39;augmentation&#39;</span>
</span><span id="SeismicVolume.apply_rmo_augmentation-673"><a href="#-673"><span class="linenos">673</span></a>            <span class="n">residual_times</span> <span class="o">=</span> <span class="n">rmo_indices</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span>
</span><span id="SeismicVolume.apply_rmo_augmentation-674"><a href="#-674"><span class="linenos">674</span></a>                <span class="n">angle_gather</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="SeismicVolume.apply_rmo_augmentation-675"><a href="#-675"><span class="linenos">675</span></a>            <span class="p">)</span>
</span><span id="SeismicVolume.apply_rmo_augmentation-676"><a href="#-676"><span class="linenos">676</span></a>            <span class="n">residual_rmo_indices</span> <span class="o">=</span> <span class="n">rmo_indices</span> <span class="o">*</span> <span class="mf">1.0</span>
</span><span id="SeismicVolume.apply_rmo_augmentation-677"><a href="#-677"><span class="linenos">677</span></a>            <span class="n">residual_rmo_indices</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-=</span> <span class="n">residual_times</span>
</span><span id="SeismicVolume.apply_rmo_augmentation-678"><a href="#-678"><span class="linenos">678</span></a>            <span class="n">residual_rmo_indices</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-=</span> <span class="n">residual_times</span>
</span><span id="SeismicVolume.apply_rmo_augmentation-679"><a href="#-679"><span class="linenos">679</span></a>            <span class="n">residual_rmo_indices</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">-=</span> <span class="n">residual_times</span>
</span><span id="SeismicVolume.apply_rmo_augmentation-680"><a href="#-680"><span class="linenos">680</span></a>            <span class="n">_rmo_indices</span> <span class="o">=</span> <span class="n">residual_rmo_indices</span>
</span><span id="SeismicVolume.apply_rmo_augmentation-681"><a href="#-681"><span class="linenos">681</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SeismicVolume.apply_rmo_augmentation-682"><a href="#-682"><span class="linenos">682</span></a>            <span class="n">_rmo_indices</span> <span class="o">=</span> <span class="n">rmo_indices</span>
</span><span id="SeismicVolume.apply_rmo_augmentation-683"><a href="#-683"><span class="linenos">683</span></a>
</span><span id="SeismicVolume.apply_rmo_augmentation-684"><a href="#-684"><span class="linenos">684</span></a>        <span class="n">rmo_angle_gather</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">angle_gather</span><span class="p">)</span>
</span><span id="SeismicVolume.apply_rmo_augmentation-685"><a href="#-685"><span class="linenos">685</span></a>        <span class="k">for</span> <span class="n">iangle</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rmo_indices</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])):</span>
</span><span id="SeismicVolume.apply_rmo_augmentation-686"><a href="#-686"><span class="linenos">686</span></a>            <span class="n">rmo_angle_gather</span><span class="p">[:,</span> <span class="n">iangle</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span>
</span><span id="SeismicVolume.apply_rmo_augmentation-687"><a href="#-687"><span class="linenos">687</span></a>                <span class="nb">range</span><span class="p">(</span><span class="n">angle_gather</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
</span><span id="SeismicVolume.apply_rmo_augmentation-688"><a href="#-688"><span class="linenos">688</span></a>                <span class="n">_rmo_indices</span><span class="p">[:,</span> <span class="n">iangle</span><span class="p">],</span>
</span><span id="SeismicVolume.apply_rmo_augmentation-689"><a href="#-689"><span class="linenos">689</span></a>                <span class="n">angle_gather</span><span class="p">[:,</span> <span class="n">iangle</span><span class="p">],</span>
</span><span id="SeismicVolume.apply_rmo_augmentation-690"><a href="#-690"><span class="linenos">690</span></a>            <span class="p">)</span>
</span><span id="SeismicVolume.apply_rmo_augmentation-691"><a href="#-691"><span class="linenos">691</span></a>
</span><span id="SeismicVolume.apply_rmo_augmentation-692"><a href="#-692"><span class="linenos">692</span></a>        <span class="k">return</span> <span class="n">rmo_angle_gather</span>
</span></pre></div>


            <div class="docstring"><p>apply residual moveout via interpolation
applied to 'angle_gather' with results from compute_randomRMO_1D in rmo_indices
angle_gather and rmo_indices need to be 2D arrays with the same shape (n_samples x n_angles)</p>

<ul>
<li>angle_gather is the array to which RMO is applied</li>
<li>rmo_indices is the array used to modify the two-way-times of angle_gather</li>
<li>remove_mean_rmo can be used to (when True) to apply relative RMO that keeps
event energy at roughly the same TWT. for example to avoid applying RMO
to both data and labels</li>
</ul>
</div>


                            </div>
                            <div id="SeismicVolume.build_property_models_randomised_depth" class="classattr">
                                        <input id="SeismicVolume.build_property_models_randomised_depth-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">build_property_models_randomised_depth</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">rpm</span>, </span><span class="param"><span class="n">mixing_method</span><span class="o">=</span><span class="s1">&#39;inv_vel&#39;</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SeismicVolume.build_property_models_randomised_depth-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SeismicVolume.build_property_models_randomised_depth"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SeismicVolume.build_property_models_randomised_depth-694"><a href="#-694"><span class="linenos"> 694</span></a>    <span class="k">def</span> <span class="nf">build_property_models_randomised_depth</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rpm</span><span class="p">,</span> <span class="n">mixing_method</span><span class="o">=</span><span class="s2">&quot;inv_vel&quot;</span><span class="p">):</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-695"><a href="#-695"><span class="linenos"> 695</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-696"><a href="#-696"><span class="linenos"> 696</span></a><span class="sd">        Build property models with randomised depth</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-697"><a href="#-697"><span class="linenos"> 697</span></a><span class="sd">        -------------------------------------------</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-698"><a href="#-698"><span class="linenos"> 698</span></a><span class="sd">        Builds property models with randomised depth.</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-699"><a href="#-699"><span class="linenos"> 699</span></a>
</span><span id="SeismicVolume.build_property_models_randomised_depth-700"><a href="#-700"><span class="linenos"> 700</span></a><span class="sd">        v2 but with Backus moduli mixing instead of inverse velocity mixing</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-701"><a href="#-701"><span class="linenos"> 701</span></a><span class="sd">        mixing_method one of [&quot;InverseVelocity&quot;, &quot;BackusModuli&quot;]</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-702"><a href="#-702"><span class="linenos"> 702</span></a>
</span><span id="SeismicVolume.build_property_models_randomised_depth-703"><a href="#-703"><span class="linenos"> 703</span></a><span class="sd">        Parameters</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-704"><a href="#-704"><span class="linenos"> 704</span></a><span class="sd">        ----------</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-705"><a href="#-705"><span class="linenos"> 705</span></a><span class="sd">        rpm : str</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-706"><a href="#-706"><span class="linenos"> 706</span></a><span class="sd">            Rock properties model.</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-707"><a href="#-707"><span class="linenos"> 707</span></a><span class="sd">        mixing_method : str</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-708"><a href="#-708"><span class="linenos"> 708</span></a><span class="sd">            Mixing method for randomised depth.</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-709"><a href="#-709"><span class="linenos"> 709</span></a><span class="sd">        </span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-710"><a href="#-710"><span class="linenos"> 710</span></a><span class="sd">        Returns</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-711"><a href="#-711"><span class="linenos"> 711</span></a><span class="sd">        -------</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-712"><a href="#-712"><span class="linenos"> 712</span></a><span class="sd">        None</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-713"><a href="#-713"><span class="linenos"> 713</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-714"><a href="#-714"><span class="linenos"> 714</span></a>        <span class="n">layer_half_range</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">rpm_scaling_factors</span><span class="p">[</span><span class="s2">&quot;layershiftsamples&quot;</span><span class="p">]</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-715"><a href="#-715"><span class="linenos"> 715</span></a>        <span class="n">property_half_range</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">rpm_scaling_factors</span><span class="p">[</span><span class="s2">&quot;RPshiftsamples&quot;</span><span class="p">]</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-716"><a href="#-716"><span class="linenos"> 716</span></a>
</span><span id="SeismicVolume.build_property_models_randomised_depth-717"><a href="#-717"><span class="linenos"> 717</span></a>        <span class="n">depth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">h5file</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ModelData</span><span class="o">.</span><span class="n">faulted_depth</span><span class="p">[:]</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-718"><a href="#-718"><span class="linenos"> 718</span></a>        <span class="n">lith</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">faulted_lithology</span><span class="p">[:]</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-719"><a href="#-719"><span class="linenos"> 719</span></a>        <span class="n">net_to_gross</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">faults</span><span class="o">.</span><span class="n">faulted_net_to_gross</span><span class="p">[:]</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-720"><a href="#-720"><span class="linenos"> 720</span></a>
</span><span id="SeismicVolume.build_property_models_randomised_depth-721"><a href="#-721"><span class="linenos"> 721</span></a>        <span class="n">oil_closures</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">h5file</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ModelData</span><span class="o">.</span><span class="n">oil_closures</span><span class="p">[:]</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-722"><a href="#-722"><span class="linenos"> 722</span></a>        <span class="n">gas_closures</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">h5file</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ModelData</span><span class="o">.</span><span class="n">gas_closures</span><span class="p">[:]</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-723"><a href="#-723"><span class="linenos"> 723</span></a>
</span><span id="SeismicVolume.build_property_models_randomised_depth-724"><a href="#-724"><span class="linenos"> 724</span></a>        <span class="n">integer_faulted_age</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-725"><a href="#-725"><span class="linenos"> 725</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">h5file</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">ModelData</span><span class="o">.</span><span class="n">faulted_age_volume</span><span class="p">[:]</span> <span class="o">+</span> <span class="mf">0.00001</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-726"><a href="#-726"><span class="linenos"> 726</span></a>        <span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-727"><a href="#-727"><span class="linenos"> 727</span></a>
</span><span id="SeismicVolume.build_property_models_randomised_depth-728"><a href="#-728"><span class="linenos"> 728</span></a>        <span class="c1"># Use empty class object to store all Rho, Vp, Vs volumes (randomised, fluid factor and non randomised)</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-729"><a href="#-729"><span class="linenos"> 729</span></a>        <span class="n">mixed_properties</span> <span class="o">=</span> <span class="n">ElasticProperties3D</span><span class="p">()</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-730"><a href="#-730"><span class="linenos"> 730</span></a>        <span class="n">mixed_properties</span><span class="o">.</span><span class="n">rho</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">lith</span><span class="p">)</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-731"><a href="#-731"><span class="linenos"> 731</span></a>        <span class="n">mixed_properties</span><span class="o">.</span><span class="n">vp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">lith</span><span class="p">)</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-732"><a href="#-732"><span class="linenos"> 732</span></a>        <span class="n">mixed_properties</span><span class="o">.</span><span class="n">vs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">lith</span><span class="p">)</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-733"><a href="#-733"><span class="linenos"> 733</span></a>        <span class="n">mixed_properties</span><span class="o">.</span><span class="n">sum_net</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">lith</span><span class="p">)</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-734"><a href="#-734"><span class="linenos"> 734</span></a>        <span class="n">cube_shape</span> <span class="o">=</span> <span class="n">lith</span><span class="o">.</span><span class="n">shape</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-735"><a href="#-735"><span class="linenos"> 735</span></a>
</span><span id="SeismicVolume.build_property_models_randomised_depth-736"><a href="#-736"><span class="linenos"> 736</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-737"><a href="#-737"><span class="linenos"> 737</span></a>            <span class="n">mixed_properties</span><span class="o">.</span><span class="n">rho_not_random</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">lith</span><span class="p">)</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-738"><a href="#-738"><span class="linenos"> 738</span></a>            <span class="n">mixed_properties</span><span class="o">.</span><span class="n">vp_not_random</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">lith</span><span class="p">)</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-739"><a href="#-739"><span class="linenos"> 739</span></a>            <span class="n">mixed_properties</span><span class="o">.</span><span class="n">vs_not_random</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">lith</span><span class="p">)</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-740"><a href="#-740"><span class="linenos"> 740</span></a>
</span><span id="SeismicVolume.build_property_models_randomised_depth-741"><a href="#-741"><span class="linenos"> 741</span></a>        <span class="c1"># water layer</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-742"><a href="#-742"><span class="linenos"> 742</span></a>        <span class="n">mixed_properties</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">water_properties</span><span class="p">(</span><span class="n">lith</span><span class="p">,</span> <span class="n">mixed_properties</span><span class="p">)</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-743"><a href="#-743"><span class="linenos"> 743</span></a>
</span><span id="SeismicVolume.build_property_models_randomised_depth-744"><a href="#-744"><span class="linenos"> 744</span></a>        <span class="n">mixed_properties</span><span class="o">.</span><span class="n">rho_ff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">mixed_properties</span><span class="o">.</span><span class="n">rho</span><span class="p">)</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-745"><a href="#-745"><span class="linenos"> 745</span></a>        <span class="n">mixed_properties</span><span class="o">.</span><span class="n">vp_ff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">mixed_properties</span><span class="o">.</span><span class="n">vp</span><span class="p">)</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-746"><a href="#-746"><span class="linenos"> 746</span></a>        <span class="n">mixed_properties</span><span class="o">.</span><span class="n">vs_ff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">mixed_properties</span><span class="o">.</span><span class="n">vs</span><span class="p">)</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-747"><a href="#-747"><span class="linenos"> 747</span></a>
</span><span id="SeismicVolume.build_property_models_randomised_depth-748"><a href="#-748"><span class="linenos"> 748</span></a>        <span class="n">delta_z_lyrs</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-749"><a href="#-749"><span class="linenos"> 749</span></a>        <span class="n">delta_z_shales</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-750"><a href="#-750"><span class="linenos"> 750</span></a>        <span class="n">delta_z_brine_sands</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-751"><a href="#-751"><span class="linenos"> 751</span></a>        <span class="n">delta_z_oil_sands</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-752"><a href="#-752"><span class="linenos"> 752</span></a>        <span class="n">delta_z_gas_sands</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-753"><a href="#-753"><span class="linenos"> 753</span></a>
</span><span id="SeismicVolume.build_property_models_randomised_depth-754"><a href="#-754"><span class="linenos"> 754</span></a>        <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">integer_faulted_age</span><span class="o">.</span><span class="n">max</span><span class="p">()):</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-755"><a href="#-755"><span class="linenos"> 755</span></a>            <span class="n">__i</span><span class="p">,</span> <span class="n">__j</span><span class="p">,</span> <span class="n">__k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">integer_faulted_age</span> <span class="o">==</span> <span class="n">z</span><span class="p">)</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-756"><a href="#-756"><span class="linenos"> 756</span></a>
</span><span id="SeismicVolume.build_property_models_randomised_depth-757"><a href="#-757"><span class="linenos"> 757</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">__k</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-758"><a href="#-758"><span class="linenos"> 758</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-759"><a href="#-759"><span class="linenos"> 759</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-760"><a href="#-760"><span class="linenos"> 760</span></a>                        <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">*********************</span><span class="se">\n</span><span class="s2"> ... layer number = </span><span class="si">{</span><span class="n">z</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-761"><a href="#-761"><span class="linenos"> 761</span></a>                        <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> ... n2g (min,mean,max) = &quot;</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-762"><a href="#-762"><span class="linenos"> 762</span></a>                        <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">net_to_gross</span><span class="p">[</span><span class="n">__i</span><span class="p">,</span> <span class="n">__j</span><span class="p">,</span> <span class="n">__k</span><span class="p">])</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="si">}</span><span class="s2">,&quot;</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-763"><a href="#-763"><span class="linenos"> 763</span></a>                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">net_to_gross</span><span class="p">[</span><span class="n">__i</span><span class="p">,</span> <span class="n">__j</span><span class="p">,</span> <span class="n">__k</span><span class="p">])</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="si">}</span><span class="s2">,&quot;</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-764"><a href="#-764"><span class="linenos"> 764</span></a>                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">net_to_gross</span><span class="p">[</span><span class="n">__i</span><span class="p">,</span> <span class="n">__j</span><span class="p">,</span> <span class="n">__k</span><span class="p">])</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="si">}</span><span class="s2">,)&quot;</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-765"><a href="#-765"><span class="linenos"> 765</span></a>                    <span class="p">)</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-766"><a href="#-766"><span class="linenos"> 766</span></a>
</span><span id="SeismicVolume.build_property_models_randomised_depth-767"><a href="#-767"><span class="linenos"> 767</span></a>                <span class="n">delta_z_layer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_delta_z_layer</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">layer_half_range</span><span class="p">,</span> <span class="n">__k</span><span class="p">)</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-768"><a href="#-768"><span class="linenos"> 768</span></a>                <span class="n">delta_z_lyrs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">delta_z_layer</span><span class="p">)</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-769"><a href="#-769"><span class="linenos"> 769</span></a>
</span><span id="SeismicVolume.build_property_models_randomised_depth-770"><a href="#-770"><span class="linenos"> 770</span></a>            <span class="c1"># shale required for all voxels</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-771"><a href="#-771"><span class="linenos"> 771</span></a>            <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">net_to_gross</span> <span class="o">&gt;=</span> <span class="mf">0.0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">integer_faulted_age</span> <span class="o">==</span> <span class="n">z</span><span class="p">))</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-772"><a href="#-772"><span class="linenos"> 772</span></a>
</span><span id="SeismicVolume.build_property_models_randomised_depth-773"><a href="#-773"><span class="linenos"> 773</span></a>            <span class="n">shale_voxel_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-774"><a href="#-774"><span class="linenos"> 774</span></a>            <span class="n">delta_z_rho</span><span class="p">,</span> <span class="n">delta_z_vp</span><span class="p">,</span> <span class="n">delta_z_vs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_delta_z_properties</span><span class="p">(</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-775"><a href="#-775"><span class="linenos"> 775</span></a>                <span class="n">z</span><span class="p">,</span> <span class="n">property_half_range</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-776"><a href="#-776"><span class="linenos"> 776</span></a>            <span class="p">)</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-777"><a href="#-777"><span class="linenos"> 777</span></a>            <span class="n">delta_z_shales</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">delta_z_rho</span><span class="p">,</span> <span class="n">delta_z_vp</span><span class="p">,</span> <span class="n">delta_z_vs</span><span class="p">))</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-778"><a href="#-778"><span class="linenos"> 778</span></a>
</span><span id="SeismicVolume.build_property_models_randomised_depth-779"><a href="#-779"><span class="linenos"> 779</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-780"><a href="#-780"><span class="linenos"> 780</span></a>                <span class="n">_k_rho</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-781"><a href="#-781"><span class="linenos"> 781</span></a>                    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="n">delta_z_layer</span> <span class="o">+</span> <span class="n">delta_z_rho</span><span class="p">)</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-782"><a href="#-782"><span class="linenos"> 782</span></a>                        <span class="mi">0</span><span class="p">,</span> <span class="n">cube_shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">10</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-783"><a href="#-783"><span class="linenos"> 783</span></a>                    <span class="p">)</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-784"><a href="#-784"><span class="linenos"> 784</span></a>                <span class="p">)</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-785"><a href="#-785"><span class="linenos"> 785</span></a>                <span class="n">_k_vp</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-786"><a href="#-786"><span class="linenos"> 786</span></a>                    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="n">delta_z_layer</span> <span class="o">+</span> <span class="n">delta_z_vp</span><span class="p">)</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-787"><a href="#-787"><span class="linenos"> 787</span></a>                        <span class="mi">0</span><span class="p">,</span> <span class="n">cube_shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">10</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-788"><a href="#-788"><span class="linenos"> 788</span></a>                    <span class="p">)</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-789"><a href="#-789"><span class="linenos"> 789</span></a>                <span class="p">)</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-790"><a href="#-790"><span class="linenos"> 790</span></a>                <span class="n">_k_vs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-791"><a href="#-791"><span class="linenos"> 791</span></a>                    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="n">delta_z_layer</span> <span class="o">+</span> <span class="n">delta_z_vs</span><span class="p">)</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-792"><a href="#-792"><span class="linenos"> 792</span></a>                        <span class="mi">0</span><span class="p">,</span> <span class="n">cube_shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">10</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-793"><a href="#-793"><span class="linenos"> 793</span></a>                    <span class="p">)</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-794"><a href="#-794"><span class="linenos"> 794</span></a>                <span class="p">)</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-795"><a href="#-795"><span class="linenos"> 795</span></a>
</span><span id="SeismicVolume.build_property_models_randomised_depth-796"><a href="#-796"><span class="linenos"> 796</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-797"><a href="#-797"><span class="linenos"> 797</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-798"><a href="#-798"><span class="linenos"> 798</span></a>                        <span class="sa">f</span><span class="s2">&quot; ... shale: (delta_z_rho, delta_z_vp, delta_z_vs) = </span><span class="si">{</span><span class="n">delta_z_rho</span><span class="p">,</span> <span class="n">delta_z_vp</span><span class="p">,</span> <span class="n">delta_z_vs</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-799"><a href="#-799"><span class="linenos"> 799</span></a>                    <span class="p">)</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-800"><a href="#-800"><span class="linenos"> 800</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; ... shale: i = </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-801"><a href="#-801"><span class="linenos"> 801</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; ... shale: k = </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-802"><a href="#-802"><span class="linenos"> 802</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; ... shale: _k = </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">_k_rho</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-803"><a href="#-803"><span class="linenos"> 803</span></a>
</span><span id="SeismicVolume.build_property_models_randomised_depth-804"><a href="#-804"><span class="linenos"> 804</span></a>                <span class="n">mixed_properties</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_shales</span><span class="p">(</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-805"><a href="#-805"><span class="linenos"> 805</span></a>                    <span class="n">xyz</span><span class="o">=</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-806"><a href="#-806"><span class="linenos"> 806</span></a>                    <span class="n">shifts</span><span class="o">=</span><span class="p">(</span><span class="n">_k_rho</span><span class="p">,</span> <span class="n">_k_vp</span><span class="p">,</span> <span class="n">_k_vs</span><span class="p">),</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-807"><a href="#-807"><span class="linenos"> 807</span></a>                    <span class="n">props</span><span class="o">=</span><span class="n">mixed_properties</span><span class="p">,</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-808"><a href="#-808"><span class="linenos"> 808</span></a>                    <span class="n">rpm</span><span class="o">=</span><span class="n">rpm</span><span class="p">,</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-809"><a href="#-809"><span class="linenos"> 809</span></a>                    <span class="n">depth</span><span class="o">=</span><span class="n">depth</span><span class="p">,</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-810"><a href="#-810"><span class="linenos"> 810</span></a>                    <span class="n">z</span><span class="o">=</span><span class="n">z</span><span class="p">,</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-811"><a href="#-811"><span class="linenos"> 811</span></a>                <span class="p">)</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-812"><a href="#-812"><span class="linenos"> 812</span></a>
</span><span id="SeismicVolume.build_property_models_randomised_depth-813"><a href="#-813"><span class="linenos"> 813</span></a>            <span class="c1"># brine sand or mixture of brine sand and shale in same voxel</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-814"><a href="#-814"><span class="linenos"> 814</span></a>            <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-815"><a href="#-815"><span class="linenos"> 815</span></a>                <span class="p">(</span><span class="n">net_to_gross</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">)</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-816"><a href="#-816"><span class="linenos"> 816</span></a>                <span class="o">&amp;</span> <span class="p">(</span><span class="n">oil_closures</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">)</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-817"><a href="#-817"><span class="linenos"> 817</span></a>                <span class="o">&amp;</span> <span class="p">(</span><span class="n">gas_closures</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">)</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-818"><a href="#-818"><span class="linenos"> 818</span></a>                <span class="o">&amp;</span> <span class="p">(</span><span class="n">integer_faulted_age</span> <span class="o">==</span> <span class="n">z</span><span class="p">)</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-819"><a href="#-819"><span class="linenos"> 819</span></a>            <span class="p">)</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-820"><a href="#-820"><span class="linenos"> 820</span></a>            <span class="n">brine_voxel_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-821"><a href="#-821"><span class="linenos"> 821</span></a>            <span class="n">delta_z_rho</span><span class="p">,</span> <span class="n">delta_z_vp</span><span class="p">,</span> <span class="n">delta_z_vs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_delta_z_properties</span><span class="p">(</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-822"><a href="#-822"><span class="linenos"> 822</span></a>                <span class="n">z</span><span class="p">,</span> <span class="n">property_half_range</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-823"><a href="#-823"><span class="linenos"> 823</span></a>            <span class="p">)</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-824"><a href="#-824"><span class="linenos"> 824</span></a>            <span class="n">delta_z_brine_sands</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">delta_z_rho</span><span class="p">,</span> <span class="n">delta_z_vp</span><span class="p">,</span> <span class="n">delta_z_vs</span><span class="p">))</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-825"><a href="#-825"><span class="linenos"> 825</span></a>
</span><span id="SeismicVolume.build_property_models_randomised_depth-826"><a href="#-826"><span class="linenos"> 826</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-827"><a href="#-827"><span class="linenos"> 827</span></a>                <span class="n">_k_rho</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-828"><a href="#-828"><span class="linenos"> 828</span></a>                    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="n">delta_z_layer</span> <span class="o">+</span> <span class="n">delta_z_rho</span><span class="p">)</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-829"><a href="#-829"><span class="linenos"> 829</span></a>                        <span class="mi">0</span><span class="p">,</span> <span class="n">cube_shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">10</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-830"><a href="#-830"><span class="linenos"> 830</span></a>                    <span class="p">)</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-831"><a href="#-831"><span class="linenos"> 831</span></a>                <span class="p">)</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-832"><a href="#-832"><span class="linenos"> 832</span></a>                <span class="n">_k_vp</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-833"><a href="#-833"><span class="linenos"> 833</span></a>                    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="n">delta_z_layer</span> <span class="o">+</span> <span class="n">delta_z_vp</span><span class="p">)</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-834"><a href="#-834"><span class="linenos"> 834</span></a>                        <span class="mi">0</span><span class="p">,</span> <span class="n">cube_shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">10</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-835"><a href="#-835"><span class="linenos"> 835</span></a>                    <span class="p">)</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-836"><a href="#-836"><span class="linenos"> 836</span></a>                <span class="p">)</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-837"><a href="#-837"><span class="linenos"> 837</span></a>                <span class="n">_k_vs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-838"><a href="#-838"><span class="linenos"> 838</span></a>                    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="n">delta_z_layer</span> <span class="o">+</span> <span class="n">delta_z_vs</span><span class="p">)</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-839"><a href="#-839"><span class="linenos"> 839</span></a>                        <span class="mi">0</span><span class="p">,</span> <span class="n">cube_shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">10</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-840"><a href="#-840"><span class="linenos"> 840</span></a>                    <span class="p">)</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-841"><a href="#-841"><span class="linenos"> 841</span></a>                <span class="p">)</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-842"><a href="#-842"><span class="linenos"> 842</span></a>
</span><span id="SeismicVolume.build_property_models_randomised_depth-843"><a href="#-843"><span class="linenos"> 843</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-844"><a href="#-844"><span class="linenos"> 844</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-845"><a href="#-845"><span class="linenos"> 845</span></a>                        <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> ... brine: (delta_z_rho, delta_z_vp, delta_z_vs) = </span><span class="si">{</span><span class="n">delta_z_rho</span><span class="p">,</span> <span class="n">delta_z_vp</span><span class="p">,</span> <span class="n">delta_z_vs</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-846"><a href="#-846"><span class="linenos"> 846</span></a>                    <span class="p">)</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-847"><a href="#-847"><span class="linenos"> 847</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; ... brine: i = </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-848"><a href="#-848"><span class="linenos"> 848</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; ... brine: k = </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-849"><a href="#-849"><span class="linenos"> 849</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; ... brine: _k = </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">_k_rho</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-850"><a href="#-850"><span class="linenos"> 850</span></a>
</span><span id="SeismicVolume.build_property_models_randomised_depth-851"><a href="#-851"><span class="linenos"> 851</span></a>                <span class="n">mixed_properties</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_sands</span><span class="p">(</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-852"><a href="#-852"><span class="linenos"> 852</span></a>                    <span class="n">xyz</span><span class="o">=</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-853"><a href="#-853"><span class="linenos"> 853</span></a>                    <span class="n">shifts</span><span class="o">=</span><span class="p">(</span><span class="n">_k_rho</span><span class="p">,</span> <span class="n">_k_vp</span><span class="p">,</span> <span class="n">_k_vs</span><span class="p">),</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-854"><a href="#-854"><span class="linenos"> 854</span></a>                    <span class="n">props</span><span class="o">=</span><span class="n">mixed_properties</span><span class="p">,</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-855"><a href="#-855"><span class="linenos"> 855</span></a>                    <span class="n">rpm</span><span class="o">=</span><span class="n">rpm</span><span class="p">,</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-856"><a href="#-856"><span class="linenos"> 856</span></a>                    <span class="n">depth</span><span class="o">=</span><span class="n">depth</span><span class="p">,</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-857"><a href="#-857"><span class="linenos"> 857</span></a>                    <span class="n">ng</span><span class="o">=</span><span class="n">net_to_gross</span><span class="p">,</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-858"><a href="#-858"><span class="linenos"> 858</span></a>                    <span class="n">z</span><span class="o">=</span><span class="n">z</span><span class="p">,</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-859"><a href="#-859"><span class="linenos"> 859</span></a>                    <span class="n">fluid</span><span class="o">=</span><span class="s2">&quot;brine&quot;</span><span class="p">,</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-860"><a href="#-860"><span class="linenos"> 860</span></a>                    <span class="n">mix</span><span class="o">=</span><span class="n">mixing_method</span><span class="p">,</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-861"><a href="#-861"><span class="linenos"> 861</span></a>                <span class="p">)</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-862"><a href="#-862"><span class="linenos"> 862</span></a>
</span><span id="SeismicVolume.build_property_models_randomised_depth-863"><a href="#-863"><span class="linenos"> 863</span></a>            <span class="c1"># oil sands</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-864"><a href="#-864"><span class="linenos"> 864</span></a>            <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-865"><a href="#-865"><span class="linenos"> 865</span></a>                <span class="p">(</span><span class="n">net_to_gross</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">)</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-866"><a href="#-866"><span class="linenos"> 866</span></a>                <span class="o">&amp;</span> <span class="p">(</span><span class="n">oil_closures</span> <span class="o">==</span> <span class="mf">1.0</span><span class="p">)</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-867"><a href="#-867"><span class="linenos"> 867</span></a>                <span class="o">&amp;</span> <span class="p">(</span><span class="n">gas_closures</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">)</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-868"><a href="#-868"><span class="linenos"> 868</span></a>                <span class="o">&amp;</span> <span class="p">(</span><span class="n">integer_faulted_age</span> <span class="o">==</span> <span class="n">z</span><span class="p">)</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-869"><a href="#-869"><span class="linenos"> 869</span></a>            <span class="p">)</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-870"><a href="#-870"><span class="linenos"> 870</span></a>            <span class="n">oil_voxel_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-871"><a href="#-871"><span class="linenos"> 871</span></a>            <span class="n">delta_z_rho</span><span class="p">,</span> <span class="n">delta_z_vp</span><span class="p">,</span> <span class="n">delta_z_vs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_delta_z_properties</span><span class="p">(</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-872"><a href="#-872"><span class="linenos"> 872</span></a>                <span class="n">z</span><span class="p">,</span> <span class="n">property_half_range</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-873"><a href="#-873"><span class="linenos"> 873</span></a>            <span class="p">)</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-874"><a href="#-874"><span class="linenos"> 874</span></a>            <span class="n">delta_z_oil_sands</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">delta_z_rho</span><span class="p">,</span> <span class="n">delta_z_vp</span><span class="p">,</span> <span class="n">delta_z_vs</span><span class="p">))</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-875"><a href="#-875"><span class="linenos"> 875</span></a>
</span><span id="SeismicVolume.build_property_models_randomised_depth-876"><a href="#-876"><span class="linenos"> 876</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-877"><a href="#-877"><span class="linenos"> 877</span></a>                <span class="n">_k_rho</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-878"><a href="#-878"><span class="linenos"> 878</span></a>                    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="n">delta_z_layer</span> <span class="o">+</span> <span class="n">delta_z_rho</span><span class="p">)</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-879"><a href="#-879"><span class="linenos"> 879</span></a>                        <span class="mi">0</span><span class="p">,</span> <span class="n">cube_shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">10</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-880"><a href="#-880"><span class="linenos"> 880</span></a>                    <span class="p">)</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-881"><a href="#-881"><span class="linenos"> 881</span></a>                <span class="p">)</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-882"><a href="#-882"><span class="linenos"> 882</span></a>                <span class="n">_k_vp</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-883"><a href="#-883"><span class="linenos"> 883</span></a>                    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="n">delta_z_layer</span> <span class="o">+</span> <span class="n">delta_z_vp</span><span class="p">)</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-884"><a href="#-884"><span class="linenos"> 884</span></a>                        <span class="mi">0</span><span class="p">,</span> <span class="n">cube_shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">10</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-885"><a href="#-885"><span class="linenos"> 885</span></a>                    <span class="p">)</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-886"><a href="#-886"><span class="linenos"> 886</span></a>                <span class="p">)</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-887"><a href="#-887"><span class="linenos"> 887</span></a>                <span class="n">_k_vs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-888"><a href="#-888"><span class="linenos"> 888</span></a>                    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="n">delta_z_layer</span> <span class="o">+</span> <span class="n">delta_z_vs</span><span class="p">)</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-889"><a href="#-889"><span class="linenos"> 889</span></a>                        <span class="mi">0</span><span class="p">,</span> <span class="n">cube_shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">10</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-890"><a href="#-890"><span class="linenos"> 890</span></a>                    <span class="p">)</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-891"><a href="#-891"><span class="linenos"> 891</span></a>                <span class="p">)</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-892"><a href="#-892"><span class="linenos"> 892</span></a>
</span><span id="SeismicVolume.build_property_models_randomised_depth-893"><a href="#-893"><span class="linenos"> 893</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-894"><a href="#-894"><span class="linenos"> 894</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-895"><a href="#-895"><span class="linenos"> 895</span></a>                        <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2"> ... Perform fluid substitution for oil sands. &quot;</span><span class="p">,</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-896"><a href="#-896"><span class="linenos"> 896</span></a>                        <span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> ... Number oil voxels in closure = &quot;</span><span class="p">,</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-897"><a href="#-897"><span class="linenos"> 897</span></a>                        <span class="n">mixed_properties</span><span class="o">.</span><span class="n">rho</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-898"><a href="#-898"><span class="linenos"> 898</span></a>                    <span class="p">)</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-899"><a href="#-899"><span class="linenos"> 899</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-900"><a href="#-900"><span class="linenos"> 900</span></a>                        <span class="s2">&quot; ... closures_oil min/mean/max =  &quot;</span><span class="p">,</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-901"><a href="#-901"><span class="linenos"> 901</span></a>                        <span class="n">oil_closures</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-902"><a href="#-902"><span class="linenos"> 902</span></a>                        <span class="n">oil_closures</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-903"><a href="#-903"><span class="linenos"> 903</span></a>                        <span class="n">oil_closures</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-904"><a href="#-904"><span class="linenos"> 904</span></a>                    <span class="p">)</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-905"><a href="#-905"><span class="linenos"> 905</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-906"><a href="#-906"><span class="linenos"> 906</span></a>                        <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2"> ... np.all(oil_sand_rho[:,:,:] == brine_sand_rho[:,:,:]) &quot;</span><span class="p">,</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-907"><a href="#-907"><span class="linenos"> 907</span></a>                        <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-908"><a href="#-908"><span class="linenos"> 908</span></a>                            <span class="n">rpm</span><span class="o">.</span><span class="n">calc_oil_sand_properties</span><span class="p">(</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-909"><a href="#-909"><span class="linenos"> 909</span></a>                                <span class="n">depth</span><span class="p">[:],</span> <span class="n">depth</span><span class="p">[:],</span> <span class="n">depth</span><span class="p">[:]</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-910"><a href="#-910"><span class="linenos"> 910</span></a>                            <span class="p">)</span><span class="o">.</span><span class="n">rho</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-911"><a href="#-911"><span class="linenos"> 911</span></a>                            <span class="o">==</span> <span class="n">rpm</span><span class="o">.</span><span class="n">calc_brine_sand_properties</span><span class="p">(</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-912"><a href="#-912"><span class="linenos"> 912</span></a>                                <span class="n">depth</span><span class="p">[:],</span> <span class="n">depth</span><span class="p">[:],</span> <span class="n">depth</span><span class="p">[:]</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-913"><a href="#-913"><span class="linenos"> 913</span></a>                            <span class="p">)</span><span class="o">.</span><span class="n">rho</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-914"><a href="#-914"><span class="linenos"> 914</span></a>                        <span class="p">),</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-915"><a href="#-915"><span class="linenos"> 915</span></a>                    <span class="p">)</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-916"><a href="#-916"><span class="linenos"> 916</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-917"><a href="#-917"><span class="linenos"> 917</span></a>                        <span class="s2">&quot; ... oil: (delta_z_rho, delta_z_vp, delta_z_vs) = &quot;</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-918"><a href="#-918"><span class="linenos"> 918</span></a>                        <span class="o">+</span> <span class="nb">str</span><span class="p">((</span><span class="n">delta_z_rho</span><span class="p">,</span> <span class="n">delta_z_vp</span><span class="p">,</span> <span class="n">delta_z_vs</span><span class="p">))</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-919"><a href="#-919"><span class="linenos"> 919</span></a>                    <span class="p">)</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-920"><a href="#-920"><span class="linenos"> 920</span></a>
</span><span id="SeismicVolume.build_property_models_randomised_depth-921"><a href="#-921"><span class="linenos"> 921</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-922"><a href="#-922"><span class="linenos"> 922</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; ... oil: i = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">i</span><span class="p">)))</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-923"><a href="#-923"><span class="linenos"> 923</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; ... oil: k = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">k</span><span class="p">)))</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-924"><a href="#-924"><span class="linenos"> 924</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; ... oil: _k = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">_k_rho</span><span class="p">)))</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-925"><a href="#-925"><span class="linenos"> 925</span></a>
</span><span id="SeismicVolume.build_property_models_randomised_depth-926"><a href="#-926"><span class="linenos"> 926</span></a>                <span class="n">mixed_properties</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_sands</span><span class="p">(</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-927"><a href="#-927"><span class="linenos"> 927</span></a>                    <span class="n">xyz</span><span class="o">=</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-928"><a href="#-928"><span class="linenos"> 928</span></a>                    <span class="n">shifts</span><span class="o">=</span><span class="p">(</span><span class="n">_k_rho</span><span class="p">,</span> <span class="n">_k_vp</span><span class="p">,</span> <span class="n">_k_vs</span><span class="p">),</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-929"><a href="#-929"><span class="linenos"> 929</span></a>                    <span class="n">props</span><span class="o">=</span><span class="n">mixed_properties</span><span class="p">,</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-930"><a href="#-930"><span class="linenos"> 930</span></a>                    <span class="n">rpm</span><span class="o">=</span><span class="n">rpm</span><span class="p">,</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-931"><a href="#-931"><span class="linenos"> 931</span></a>                    <span class="n">depth</span><span class="o">=</span><span class="n">depth</span><span class="p">,</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-932"><a href="#-932"><span class="linenos"> 932</span></a>                    <span class="n">ng</span><span class="o">=</span><span class="n">net_to_gross</span><span class="p">,</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-933"><a href="#-933"><span class="linenos"> 933</span></a>                    <span class="n">z</span><span class="o">=</span><span class="n">z</span><span class="p">,</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-934"><a href="#-934"><span class="linenos"> 934</span></a>                    <span class="n">fluid</span><span class="o">=</span><span class="s2">&quot;oil&quot;</span><span class="p">,</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-935"><a href="#-935"><span class="linenos"> 935</span></a>                    <span class="n">mix</span><span class="o">=</span><span class="n">mixing_method</span><span class="p">,</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-936"><a href="#-936"><span class="linenos"> 936</span></a>                <span class="p">)</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-937"><a href="#-937"><span class="linenos"> 937</span></a>
</span><span id="SeismicVolume.build_property_models_randomised_depth-938"><a href="#-938"><span class="linenos"> 938</span></a>            <span class="c1"># gas sands</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-939"><a href="#-939"><span class="linenos"> 939</span></a>            <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-940"><a href="#-940"><span class="linenos"> 940</span></a>                <span class="p">(</span><span class="n">net_to_gross</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">)</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-941"><a href="#-941"><span class="linenos"> 941</span></a>                <span class="o">&amp;</span> <span class="p">(</span><span class="n">oil_closures</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">)</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-942"><a href="#-942"><span class="linenos"> 942</span></a>                <span class="o">&amp;</span> <span class="p">(</span><span class="n">gas_closures</span> <span class="o">==</span> <span class="mf">1.0</span><span class="p">)</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-943"><a href="#-943"><span class="linenos"> 943</span></a>                <span class="o">&amp;</span> <span class="p">(</span><span class="n">integer_faulted_age</span> <span class="o">==</span> <span class="n">z</span><span class="p">)</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-944"><a href="#-944"><span class="linenos"> 944</span></a>            <span class="p">)</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-945"><a href="#-945"><span class="linenos"> 945</span></a>            <span class="n">gas_voxel_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-946"><a href="#-946"><span class="linenos"> 946</span></a>            <span class="n">delta_z_rho</span><span class="p">,</span> <span class="n">delta_z_vp</span><span class="p">,</span> <span class="n">delta_z_vs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_delta_z_properties</span><span class="p">(</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-947"><a href="#-947"><span class="linenos"> 947</span></a>                <span class="n">z</span><span class="p">,</span> <span class="n">property_half_range</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-948"><a href="#-948"><span class="linenos"> 948</span></a>            <span class="p">)</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-949"><a href="#-949"><span class="linenos"> 949</span></a>            <span class="n">delta_z_gas_sands</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">delta_z_rho</span><span class="p">,</span> <span class="n">delta_z_vp</span><span class="p">,</span> <span class="n">delta_z_vs</span><span class="p">))</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-950"><a href="#-950"><span class="linenos"> 950</span></a>
</span><span id="SeismicVolume.build_property_models_randomised_depth-951"><a href="#-951"><span class="linenos"> 951</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-952"><a href="#-952"><span class="linenos"> 952</span></a>                <span class="n">_k_rho</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-953"><a href="#-953"><span class="linenos"> 953</span></a>                    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="n">delta_z_layer</span> <span class="o">+</span> <span class="n">delta_z_rho</span><span class="p">)</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-954"><a href="#-954"><span class="linenos"> 954</span></a>                        <span class="mi">0</span><span class="p">,</span> <span class="n">cube_shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">10</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-955"><a href="#-955"><span class="linenos"> 955</span></a>                    <span class="p">)</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-956"><a href="#-956"><span class="linenos"> 956</span></a>                <span class="p">)</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-957"><a href="#-957"><span class="linenos"> 957</span></a>                <span class="n">_k_vp</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-958"><a href="#-958"><span class="linenos"> 958</span></a>                    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="n">delta_z_layer</span> <span class="o">+</span> <span class="n">delta_z_vp</span><span class="p">)</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-959"><a href="#-959"><span class="linenos"> 959</span></a>                        <span class="mi">0</span><span class="p">,</span> <span class="n">cube_shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">10</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-960"><a href="#-960"><span class="linenos"> 960</span></a>                    <span class="p">)</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-961"><a href="#-961"><span class="linenos"> 961</span></a>                <span class="p">)</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-962"><a href="#-962"><span class="linenos"> 962</span></a>                <span class="n">_k_vs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-963"><a href="#-963"><span class="linenos"> 963</span></a>                    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="n">delta_z_layer</span> <span class="o">+</span> <span class="n">delta_z_vs</span><span class="p">)</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-964"><a href="#-964"><span class="linenos"> 964</span></a>                        <span class="mi">0</span><span class="p">,</span> <span class="n">cube_shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">10</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-965"><a href="#-965"><span class="linenos"> 965</span></a>                    <span class="p">)</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-966"><a href="#-966"><span class="linenos"> 966</span></a>                <span class="p">)</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-967"><a href="#-967"><span class="linenos"> 967</span></a>
</span><span id="SeismicVolume.build_property_models_randomised_depth-968"><a href="#-968"><span class="linenos"> 968</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-969"><a href="#-969"><span class="linenos"> 969</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-970"><a href="#-970"><span class="linenos"> 970</span></a>                        <span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> ... Perform fluid substitution for gas sands. &quot;</span><span class="p">,</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-971"><a href="#-971"><span class="linenos"> 971</span></a>                        <span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> ... Number gas voxels in closure = &quot;</span><span class="p">,</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-972"><a href="#-972"><span class="linenos"> 972</span></a>                        <span class="n">mixed_properties</span><span class="o">.</span><span class="n">rho</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-973"><a href="#-973"><span class="linenos"> 973</span></a>                    <span class="p">)</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-974"><a href="#-974"><span class="linenos"> 974</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-975"><a href="#-975"><span class="linenos"> 975</span></a>                        <span class="s2">&quot; ... closures_gas min/mean/max =  &quot;</span><span class="p">,</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-976"><a href="#-976"><span class="linenos"> 976</span></a>                        <span class="n">gas_closures</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-977"><a href="#-977"><span class="linenos"> 977</span></a>                        <span class="n">gas_closures</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-978"><a href="#-978"><span class="linenos"> 978</span></a>                        <span class="n">gas_closures</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-979"><a href="#-979"><span class="linenos"> 979</span></a>                    <span class="p">)</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-980"><a href="#-980"><span class="linenos"> 980</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-981"><a href="#-981"><span class="linenos"> 981</span></a>                        <span class="s2">&quot; ... gas: (delta_z_rho, delta_z_vp, delta_z_vs) = &quot;</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-982"><a href="#-982"><span class="linenos"> 982</span></a>                        <span class="o">+</span> <span class="nb">str</span><span class="p">((</span><span class="n">delta_z_rho</span><span class="p">,</span> <span class="n">delta_z_vp</span><span class="p">,</span> <span class="n">delta_z_vs</span><span class="p">))</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-983"><a href="#-983"><span class="linenos"> 983</span></a>                    <span class="p">)</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-984"><a href="#-984"><span class="linenos"> 984</span></a>
</span><span id="SeismicVolume.build_property_models_randomised_depth-985"><a href="#-985"><span class="linenos"> 985</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-986"><a href="#-986"><span class="linenos"> 986</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; ... gas: i = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">i</span><span class="p">)))</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-987"><a href="#-987"><span class="linenos"> 987</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; ... gas: k = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">k</span><span class="p">)))</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-988"><a href="#-988"><span class="linenos"> 988</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; ... gas: _k = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">_k_rho</span><span class="p">)))</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-989"><a href="#-989"><span class="linenos"> 989</span></a>
</span><span id="SeismicVolume.build_property_models_randomised_depth-990"><a href="#-990"><span class="linenos"> 990</span></a>                <span class="n">mixed_properties</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_sands</span><span class="p">(</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-991"><a href="#-991"><span class="linenos"> 991</span></a>                    <span class="n">xyz</span><span class="o">=</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-992"><a href="#-992"><span class="linenos"> 992</span></a>                    <span class="n">shifts</span><span class="o">=</span><span class="p">(</span><span class="n">_k_rho</span><span class="p">,</span> <span class="n">_k_vp</span><span class="p">,</span> <span class="n">_k_vs</span><span class="p">),</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-993"><a href="#-993"><span class="linenos"> 993</span></a>                    <span class="n">props</span><span class="o">=</span><span class="n">mixed_properties</span><span class="p">,</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-994"><a href="#-994"><span class="linenos"> 994</span></a>                    <span class="n">rpm</span><span class="o">=</span><span class="n">rpm</span><span class="p">,</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-995"><a href="#-995"><span class="linenos"> 995</span></a>                    <span class="n">depth</span><span class="o">=</span><span class="n">depth</span><span class="p">,</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-996"><a href="#-996"><span class="linenos"> 996</span></a>                    <span class="n">ng</span><span class="o">=</span><span class="n">net_to_gross</span><span class="p">,</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-997"><a href="#-997"><span class="linenos"> 997</span></a>                    <span class="n">z</span><span class="o">=</span><span class="n">z</span><span class="p">,</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-998"><a href="#-998"><span class="linenos"> 998</span></a>                    <span class="n">fluid</span><span class="o">=</span><span class="s2">&quot;gas&quot;</span><span class="p">,</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-999"><a href="#-999"><span class="linenos"> 999</span></a>                    <span class="n">mix</span><span class="o">=</span><span class="n">mixing_method</span><span class="p">,</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-1000"><a href="#-1000"><span class="linenos">1000</span></a>                <span class="p">)</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-1001"><a href="#-1001"><span class="linenos">1001</span></a>
</span><span id="SeismicVolume.build_property_models_randomised_depth-1002"><a href="#-1002"><span class="linenos">1002</span></a>            <span class="c1"># layer check</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-1003"><a href="#-1003"><span class="linenos">1003</span></a>            <span class="n">__i</span><span class="p">,</span> <span class="n">__j</span><span class="p">,</span> <span class="n">__k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">integer_faulted_age</span> <span class="o">==</span> <span class="n">z</span><span class="p">)</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-1004"><a href="#-1004"><span class="linenos">1004</span></a>
</span><span id="SeismicVolume.build_property_models_randomised_depth-1005"><a href="#-1005"><span class="linenos">1005</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">__k</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-1006"><a href="#-1006"><span class="linenos">1006</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-1007"><a href="#-1007"><span class="linenos">1007</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-1008"><a href="#-1008"><span class="linenos">1008</span></a>                        <span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> ... layer number = &quot;</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-1009"><a href="#-1009"><span class="linenos">1009</span></a>                        <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-1010"><a href="#-1010"><span class="linenos">1010</span></a>                        <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> ... sum_net (min,mean,max) = &quot;</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-1011"><a href="#-1011"><span class="linenos">1011</span></a>                        <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-1012"><a href="#-1012"><span class="linenos">1012</span></a>                            <span class="p">(</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-1013"><a href="#-1013"><span class="linenos">1013</span></a>                                <span class="n">mixed_properties</span><span class="o">.</span><span class="n">sum_net</span><span class="p">[</span><span class="n">__i</span><span class="p">,</span> <span class="n">__j</span><span class="p">,</span> <span class="n">__k</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-1014"><a href="#-1014"><span class="linenos">1014</span></a>                                <span class="n">mixed_properties</span><span class="o">.</span><span class="n">sum_net</span><span class="p">[</span><span class="n">__i</span><span class="p">,</span> <span class="n">__j</span><span class="p">,</span> <span class="n">__k</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-1015"><a href="#-1015"><span class="linenos">1015</span></a>                                <span class="n">mixed_properties</span><span class="o">.</span><span class="n">sum_net</span><span class="p">[</span><span class="n">__i</span><span class="p">,</span> <span class="n">__j</span><span class="p">,</span> <span class="n">__k</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-1016"><a href="#-1016"><span class="linenos">1016</span></a>                            <span class="p">)</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-1017"><a href="#-1017"><span class="linenos">1017</span></a>                        <span class="p">)</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-1018"><a href="#-1018"><span class="linenos">1018</span></a>                    <span class="p">)</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-1019"><a href="#-1019"><span class="linenos">1019</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-1020"><a href="#-1020"><span class="linenos">1020</span></a>                        <span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> ... layer number = &quot;</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-1021"><a href="#-1021"><span class="linenos">1021</span></a>                        <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-1022"><a href="#-1022"><span class="linenos">1022</span></a>                        <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> ... (shale, brine, oil, gas) voxel_counts = &quot;</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-1023"><a href="#-1023"><span class="linenos">1023</span></a>                        <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-1024"><a href="#-1024"><span class="linenos">1024</span></a>                            <span class="p">(</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-1025"><a href="#-1025"><span class="linenos">1025</span></a>                                <span class="n">shale_voxel_count</span><span class="p">,</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-1026"><a href="#-1026"><span class="linenos">1026</span></a>                                <span class="n">brine_voxel_count</span><span class="p">,</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-1027"><a href="#-1027"><span class="linenos">1027</span></a>                                <span class="n">oil_voxel_count</span><span class="p">,</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-1028"><a href="#-1028"><span class="linenos">1028</span></a>                                <span class="n">gas_voxel_count</span><span class="p">,</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-1029"><a href="#-1029"><span class="linenos">1029</span></a>                            <span class="p">)</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-1030"><a href="#-1030"><span class="linenos">1030</span></a>                        <span class="p">)</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-1031"><a href="#-1031"><span class="linenos">1031</span></a>                        <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> ... shale_count = brine+oil+gas? &quot;</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-1032"><a href="#-1032"><span class="linenos">1032</span></a>                        <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-1033"><a href="#-1033"><span class="linenos">1033</span></a>                            <span class="n">shale_voxel_count</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-1034"><a href="#-1034"><span class="linenos">1034</span></a>                            <span class="o">==</span> <span class="n">brine_voxel_count</span> <span class="o">+</span> <span class="n">oil_voxel_count</span> <span class="o">+</span> <span class="n">gas_voxel_count</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-1035"><a href="#-1035"><span class="linenos">1035</span></a>                        <span class="p">)</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-1036"><a href="#-1036"><span class="linenos">1036</span></a>                        <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">*********************&quot;</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-1037"><a href="#-1037"><span class="linenos">1037</span></a>                    <span class="p">)</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-1038"><a href="#-1038"><span class="linenos">1038</span></a>
</span><span id="SeismicVolume.build_property_models_randomised_depth-1039"><a href="#-1039"><span class="linenos">1039</span></a>        <span class="c1"># overwrite rho, vp, vs for salt if required</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-1040"><a href="#-1040"><span class="linenos">1040</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">include_salt</span><span class="p">:</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-1041"><a href="#-1041"><span class="linenos">1041</span></a>            <span class="c1"># Salt. Set lith = 2.0</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-1042"><a href="#-1042"><span class="linenos">1042</span></a>            <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">lith</span> <span class="o">==</span> <span class="mf">2.0</span><span class="p">)</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-1043"><a href="#-1043"><span class="linenos">1043</span></a>            <span class="n">mixed_properties</span><span class="o">.</span><span class="n">rho</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">2.17</span>  <span class="c1"># divide by 2 since lith = 2.0</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-1044"><a href="#-1044"><span class="linenos">1044</span></a>            <span class="n">mixed_properties</span><span class="o">.</span><span class="n">vp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">4500.0</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-1045"><a href="#-1045"><span class="linenos">1045</span></a>            <span class="n">mixed_properties</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">2250.0</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-1046"><a href="#-1046"><span class="linenos">1046</span></a>            <span class="c1"># Include fluidfactor rho, vp, vs inside salt body</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-1047"><a href="#-1047"><span class="linenos">1047</span></a>            <span class="n">mixed_properties</span><span class="o">.</span><span class="n">rho_ff</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">mixed_properties</span><span class="o">.</span><span class="n">rho</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-1048"><a href="#-1048"><span class="linenos">1048</span></a>            <span class="n">mixed_properties</span><span class="o">.</span><span class="n">vp_ff</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">mixed_properties</span><span class="o">.</span><span class="n">vp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-1049"><a href="#-1049"><span class="linenos">1049</span></a>            <span class="n">mixed_properties</span><span class="o">.</span><span class="n">vs_ff</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">mixed_properties</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-1050"><a href="#-1050"><span class="linenos">1050</span></a>
</span><span id="SeismicVolume.build_property_models_randomised_depth-1051"><a href="#-1051"><span class="linenos">1051</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-1052"><a href="#-1052"><span class="linenos">1052</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Checking for null values inside build_randomised_properties:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-1053"><a href="#-1053"><span class="linenos">1053</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-1054"><a href="#-1054"><span class="linenos">1054</span></a>                <span class="sa">f</span><span class="s2">&quot;Rho: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">mixed_properties</span><span class="o">.</span><span class="n">rho</span><span class="p">)</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">mixed_properties</span><span class="o">.</span><span class="n">rho</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-1055"><a href="#-1055"><span class="linenos">1055</span></a>            <span class="p">)</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-1056"><a href="#-1056"><span class="linenos">1056</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Vp: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">mixed_properties</span><span class="o">.</span><span class="n">vp</span><span class="p">)</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">mixed_properties</span><span class="o">.</span><span class="n">vp</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-1057"><a href="#-1057"><span class="linenos">1057</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Vs: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">mixed_properties</span><span class="o">.</span><span class="n">vs</span><span class="p">)</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">mixed_properties</span><span class="o">.</span><span class="n">vs</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-1058"><a href="#-1058"><span class="linenos">1058</span></a>
</span><span id="SeismicVolume.build_property_models_randomised_depth-1059"><a href="#-1059"><span class="linenos">1059</span></a>        <span class="c1"># Fix empty voxels at base of property volumes</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-1060"><a href="#-1060"><span class="linenos">1060</span></a>        <span class="n">mixed_properties</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fix_zero_values_at_base</span><span class="p">(</span><span class="n">mixed_properties</span><span class="p">)</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-1061"><a href="#-1061"><span class="linenos">1061</span></a>
</span><span id="SeismicVolume.build_property_models_randomised_depth-1062"><a href="#-1062"><span class="linenos">1062</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-1063"><a href="#-1063"><span class="linenos">1063</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-1064"><a href="#-1064"><span class="linenos">1064</span></a>                <span class="s2">&quot;Checking for null values inside build_randomised_properties AFTER fix:</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-1065"><a href="#-1065"><span class="linenos">1065</span></a>            <span class="p">)</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-1066"><a href="#-1066"><span class="linenos">1066</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-1067"><a href="#-1067"><span class="linenos">1067</span></a>                <span class="sa">f</span><span class="s2">&quot;Rho: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">mixed_properties</span><span class="o">.</span><span class="n">rho</span><span class="p">)</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">mixed_properties</span><span class="o">.</span><span class="n">rho</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-1068"><a href="#-1068"><span class="linenos">1068</span></a>            <span class="p">)</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-1069"><a href="#-1069"><span class="linenos">1069</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Vp: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">mixed_properties</span><span class="o">.</span><span class="n">vp</span><span class="p">)</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">mixed_properties</span><span class="o">.</span><span class="n">vp</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-1070"><a href="#-1070"><span class="linenos">1070</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Vs: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">mixed_properties</span><span class="o">.</span><span class="n">vs</span><span class="p">)</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">mixed_properties</span><span class="o">.</span><span class="n">vs</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-1071"><a href="#-1071"><span class="linenos">1071</span></a>
</span><span id="SeismicVolume.build_property_models_randomised_depth-1072"><a href="#-1072"><span class="linenos">1072</span></a>        <span class="n">mixed_properties</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_scaling_factors</span><span class="p">(</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-1073"><a href="#-1073"><span class="linenos">1073</span></a>            <span class="n">mixed_properties</span><span class="p">,</span> <span class="n">net_to_gross</span><span class="p">,</span> <span class="n">lith</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-1074"><a href="#-1074"><span class="linenos">1074</span></a>        <span class="p">)</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-1075"><a href="#-1075"><span class="linenos">1075</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">rho</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">mixed_properties</span><span class="o">.</span><span class="n">rho</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-1076"><a href="#-1076"><span class="linenos">1076</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vp</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">mixed_properties</span><span class="o">.</span><span class="n">vp</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-1077"><a href="#-1077"><span class="linenos">1077</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vs</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">mixed_properties</span><span class="o">.</span><span class="n">vs</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-1078"><a href="#-1078"><span class="linenos">1078</span></a>
</span><span id="SeismicVolume.build_property_models_randomised_depth-1079"><a href="#-1079"><span class="linenos">1079</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">rho_ff</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">mixed_properties</span><span class="o">.</span><span class="n">rho_ff</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-1080"><a href="#-1080"><span class="linenos">1080</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vp_ff</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">mixed_properties</span><span class="o">.</span><span class="n">vp_ff</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-1081"><a href="#-1081"><span class="linenos">1081</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vs_ff</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">mixed_properties</span><span class="o">.</span><span class="n">vs_ff</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-1082"><a href="#-1082"><span class="linenos">1082</span></a>
</span><span id="SeismicVolume.build_property_models_randomised_depth-1083"><a href="#-1083"><span class="linenos">1083</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">qc_plots</span><span class="p">:</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-1084"><a href="#-1084"><span class="linenos">1084</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Creating RPM qc plots&quot;</span><span class="p">)</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-1085"><a href="#-1085"><span class="linenos">1085</span></a>            <span class="kn">from</span> <span class="nn">rockphysics.RockPropertyModels</span> <span class="kn">import</span> <span class="n">rpm_qc_plots</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-1086"><a href="#-1086"><span class="linenos">1086</span></a>
</span><span id="SeismicVolume.build_property_models_randomised_depth-1087"><a href="#-1087"><span class="linenos">1087</span></a>            <span class="n">rpm_qc_plots</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="p">,</span> <span class="n">rpm</span><span class="p">)</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-1088"><a href="#-1088"><span class="linenos">1088</span></a>
</span><span id="SeismicVolume.build_property_models_randomised_depth-1089"><a href="#-1089"><span class="linenos">1089</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">model_qc_volumes</span><span class="p">:</span>
</span><span id="SeismicVolume.build_property_models_randomised_depth-1090"><a href="#-1090"><span class="linenos">1090</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">write_property_volumes_to_disk</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><h6 id="build-property-models-with-randomised-depth">Build property models with randomised depth</h6>

<p>Builds property models with randomised depth.</p>

<p>v2 but with Backus moduli mixing instead of inverse velocity mixing
mixing_method one of ["InverseVelocity", "BackusModuli"]</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>rpm</strong> (str):
Rock properties model.</li>
<li><strong>mixing_method</strong> (str):
Mixing method for randomised depth.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>None</strong></li>
</ul>
</div>


                            </div>
                            <div id="SeismicVolume.water_properties" class="classattr">
                                        <input id="SeismicVolume.water_properties-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">water_properties</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">lith</span>, </span><span class="param"><span class="n">properties</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SeismicVolume.water_properties-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SeismicVolume.water_properties"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SeismicVolume.water_properties-1092"><a href="#-1092"><span class="linenos">1092</span></a>    <span class="k">def</span> <span class="nf">water_properties</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lith</span><span class="p">,</span> <span class="n">properties</span><span class="p">):</span>
</span><span id="SeismicVolume.water_properties-1093"><a href="#-1093"><span class="linenos">1093</span></a>        <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">lith</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">)</span>
</span><span id="SeismicVolume.water_properties-1094"><a href="#-1094"><span class="linenos">1094</span></a>        <span class="n">properties</span><span class="o">.</span><span class="n">rho</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.028</span>
</span><span id="SeismicVolume.water_properties-1095"><a href="#-1095"><span class="linenos">1095</span></a>        <span class="n">properties</span><span class="o">.</span><span class="n">vp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1500.0</span>
</span><span id="SeismicVolume.water_properties-1096"><a href="#-1096"><span class="linenos">1096</span></a>        <span class="n">properties</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1000.0</span>
</span><span id="SeismicVolume.water_properties-1097"><a href="#-1097"><span class="linenos">1097</span></a>        <span class="k">return</span> <span class="n">properties</span>
</span></pre></div>


    

                            </div>
                            <div id="SeismicVolume.get_delta_z_layer" class="classattr">
                                        <input id="SeismicVolume.get_delta_z_layer-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_delta_z_layer</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">z</span>, </span><span class="param"><span class="n">half_range</span>, </span><span class="param"><span class="n">z_cells</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SeismicVolume.get_delta_z_layer-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SeismicVolume.get_delta_z_layer"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SeismicVolume.get_delta_z_layer-1099"><a href="#-1099"><span class="linenos">1099</span></a>    <span class="k">def</span> <span class="nf">get_delta_z_layer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">half_range</span><span class="p">,</span> <span class="n">z_cells</span><span class="p">):</span>
</span><span id="SeismicVolume.get_delta_z_layer-1100"><a href="#-1100"><span class="linenos">1100</span></a>        <span class="k">if</span> <span class="n">z</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_random_lyr</span><span class="p">:</span>
</span><span id="SeismicVolume.get_delta_z_layer-1101"><a href="#-1101"><span class="linenos">1101</span></a>            <span class="n">delta_z_layer</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="n">half_range</span><span class="p">,</span> <span class="n">half_range</span><span class="p">))</span>
</span><span id="SeismicVolume.get_delta_z_layer-1102"><a href="#-1102"><span class="linenos">1102</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SeismicVolume.get_delta_z_layer-1103"><a href="#-1103"><span class="linenos">1103</span></a>            <span class="n">delta_z_layer</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="SeismicVolume.get_delta_z_layer-1104"><a href="#-1104"><span class="linenos">1104</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="SeismicVolume.get_delta_z_layer-1105"><a href="#-1105"><span class="linenos">1105</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; .... Layer </span><span class="si">{</span><span class="n">z</span><span class="si">}</span><span class="s2">: voxel_count = </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">z_cells</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="SeismicVolume.get_delta_z_layer-1106"><a href="#-1106"><span class="linenos">1106</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; .... Layer </span><span class="si">{</span><span class="n">z</span><span class="si">}</span><span class="s2">: delta_z_layer = </span><span class="si">{</span><span class="n">delta_z_layer</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="SeismicVolume.get_delta_z_layer-1107"><a href="#-1107"><span class="linenos">1107</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="SeismicVolume.get_delta_z_layer-1108"><a href="#-1108"><span class="linenos">1108</span></a>                <span class="sa">f</span><span class="s2">&quot; .... Layer </span><span class="si">{</span><span class="n">z</span><span class="si">}</span><span class="s2">: z-range (m): </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">z_cells</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">digi</span><span class="si">}</span><span class="s2">, &quot;</span>
</span><span id="SeismicVolume.get_delta_z_layer-1109"><a href="#-1109"><span class="linenos">1109</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">z_cells</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">digi</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="SeismicVolume.get_delta_z_layer-1110"><a href="#-1110"><span class="linenos">1110</span></a>            <span class="p">)</span>
</span><span id="SeismicVolume.get_delta_z_layer-1111"><a href="#-1111"><span class="linenos">1111</span></a>        <span class="k">return</span> <span class="n">delta_z_layer</span>
</span></pre></div>


    

                            </div>
                            <div id="SeismicVolume.get_delta_z_properties" class="classattr">
                                        <input id="SeismicVolume.get_delta_z_properties-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_delta_z_properties</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">z</span>, </span><span class="param"><span class="n">half_range</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SeismicVolume.get_delta_z_properties-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SeismicVolume.get_delta_z_properties"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SeismicVolume.get_delta_z_properties-1113"><a href="#-1113"><span class="linenos">1113</span></a>    <span class="k">def</span> <span class="nf">get_delta_z_properties</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">half_range</span><span class="p">):</span>
</span><span id="SeismicVolume.get_delta_z_properties-1114"><a href="#-1114"><span class="linenos">1114</span></a>        <span class="k">if</span> <span class="n">z</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_random_lyr</span><span class="p">:</span>
</span><span id="SeismicVolume.get_delta_z_properties-1115"><a href="#-1115"><span class="linenos">1115</span></a>            <span class="n">delta_z_rho</span><span class="p">,</span> <span class="n">delta_z_vp</span><span class="p">,</span> <span class="n">delta_z_vs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">random_z_rho_vp_vs</span><span class="p">(</span>
</span><span id="SeismicVolume.get_delta_z_properties-1116"><a href="#-1116"><span class="linenos">1116</span></a>                <span class="n">dmin</span><span class="o">=-</span><span class="n">half_range</span><span class="p">,</span> <span class="n">dmax</span><span class="o">=</span><span class="n">half_range</span>
</span><span id="SeismicVolume.get_delta_z_properties-1117"><a href="#-1117"><span class="linenos">1117</span></a>            <span class="p">)</span>
</span><span id="SeismicVolume.get_delta_z_properties-1118"><a href="#-1118"><span class="linenos">1118</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SeismicVolume.get_delta_z_properties-1119"><a href="#-1119"><span class="linenos">1119</span></a>            <span class="n">delta_z_rho</span><span class="p">,</span> <span class="n">delta_z_vp</span><span class="p">,</span> <span class="n">delta_z_vs</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="SeismicVolume.get_delta_z_properties-1120"><a href="#-1120"><span class="linenos">1120</span></a>        <span class="k">return</span> <span class="n">delta_z_rho</span><span class="p">,</span> <span class="n">delta_z_vp</span><span class="p">,</span> <span class="n">delta_z_vs</span>
</span></pre></div>


    

                            </div>
                            <div id="SeismicVolume.calculate_shales" class="classattr">
                                        <input id="SeismicVolume.calculate_shales-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">calculate_shales</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">xyz</span>, </span><span class="param"><span class="n">shifts</span>, </span><span class="param"><span class="n">props</span>, </span><span class="param"><span class="n">rpm</span>, </span><span class="param"><span class="n">depth</span>, </span><span class="param"><span class="n">z</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SeismicVolume.calculate_shales-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SeismicVolume.calculate_shales"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SeismicVolume.calculate_shales-1122"><a href="#-1122"><span class="linenos">1122</span></a>    <span class="k">def</span> <span class="nf">calculate_shales</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xyz</span><span class="p">,</span> <span class="n">shifts</span><span class="p">,</span> <span class="n">props</span><span class="p">,</span> <span class="n">rpm</span><span class="p">,</span> <span class="n">depth</span><span class="p">,</span> <span class="n">z</span><span class="p">):</span>
</span><span id="SeismicVolume.calculate_shales-1123"><a href="#-1123"><span class="linenos">1123</span></a>        <span class="c1"># Shales required for all voxels, other than water</span>
</span><span id="SeismicVolume.calculate_shales-1124"><a href="#-1124"><span class="linenos">1124</span></a>        <span class="c1"># Calculate the properties, select how to mix with other facies later</span>
</span><span id="SeismicVolume.calculate_shales-1125"><a href="#-1125"><span class="linenos">1125</span></a>        <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">xyz</span>
</span><span id="SeismicVolume.calculate_shales-1126"><a href="#-1126"><span class="linenos">1126</span></a>        <span class="n">k_rho</span><span class="p">,</span> <span class="n">k_vp</span><span class="p">,</span> <span class="n">k_vs</span> <span class="o">=</span> <span class="n">shifts</span>
</span><span id="SeismicVolume.calculate_shales-1127"><a href="#-1127"><span class="linenos">1127</span></a>
</span><span id="SeismicVolume.calculate_shales-1128"><a href="#-1128"><span class="linenos">1128</span></a>        <span class="n">z_rho</span> <span class="o">=</span> <span class="n">depth</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k_rho</span><span class="p">]</span>
</span><span id="SeismicVolume.calculate_shales-1129"><a href="#-1129"><span class="linenos">1129</span></a>        <span class="n">z_vp</span> <span class="o">=</span> <span class="n">depth</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k_vp</span><span class="p">]</span>
</span><span id="SeismicVolume.calculate_shales-1130"><a href="#-1130"><span class="linenos">1130</span></a>        <span class="n">z_vs</span> <span class="o">=</span> <span class="n">depth</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k_vs</span><span class="p">]</span>
</span><span id="SeismicVolume.calculate_shales-1131"><a href="#-1131"><span class="linenos">1131</span></a>        <span class="n">shales</span> <span class="o">=</span> <span class="n">rpm</span><span class="o">.</span><span class="n">calc_shale_properties</span><span class="p">(</span><span class="n">z_rho</span><span class="p">,</span> <span class="n">z_vp</span><span class="p">,</span> <span class="n">z_vs</span><span class="p">)</span>
</span><span id="SeismicVolume.calculate_shales-1132"><a href="#-1132"><span class="linenos">1132</span></a>
</span><span id="SeismicVolume.calculate_shales-1133"><a href="#-1133"><span class="linenos">1133</span></a>        <span class="c1"># Do not use net to gross here.</span>
</span><span id="SeismicVolume.calculate_shales-1134"><a href="#-1134"><span class="linenos">1134</span></a>        <span class="c1"># Since every voxel will have some shale in, apply the net to gross</span>
</span><span id="SeismicVolume.calculate_shales-1135"><a href="#-1135"><span class="linenos">1135</span></a>        <span class="c1"># when combining shales and sands</span>
</span><span id="SeismicVolume.calculate_shales-1136"><a href="#-1136"><span class="linenos">1136</span></a>        <span class="c1"># _ng = (1.0 - ng[i, j, k])</span>
</span><span id="SeismicVolume.calculate_shales-1137"><a href="#-1137"><span class="linenos">1137</span></a>
</span><span id="SeismicVolume.calculate_shales-1138"><a href="#-1138"><span class="linenos">1138</span></a>        <span class="n">props</span><span class="o">.</span><span class="n">rho</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">shales</span><span class="o">.</span><span class="n">rho</span>  <span class="c1"># * _ng</span>
</span><span id="SeismicVolume.calculate_shales-1139"><a href="#-1139"><span class="linenos">1139</span></a>        <span class="n">props</span><span class="o">.</span><span class="n">rho_ff</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">shales</span><span class="o">.</span><span class="n">rho</span>  <span class="c1"># * _ng</span>
</span><span id="SeismicVolume.calculate_shales-1140"><a href="#-1140"><span class="linenos">1140</span></a>        <span class="n">props</span><span class="o">.</span><span class="n">vp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">shales</span><span class="o">.</span><span class="n">vp</span>  <span class="c1"># * _ng</span>
</span><span id="SeismicVolume.calculate_shales-1141"><a href="#-1141"><span class="linenos">1141</span></a>        <span class="n">props</span><span class="o">.</span><span class="n">vp_ff</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">shales</span><span class="o">.</span><span class="n">vp</span>  <span class="c1"># * _ng</span>
</span><span id="SeismicVolume.calculate_shales-1142"><a href="#-1142"><span class="linenos">1142</span></a>        <span class="n">props</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">shales</span><span class="o">.</span><span class="n">vs</span>  <span class="c1"># * _ng</span>
</span><span id="SeismicVolume.calculate_shales-1143"><a href="#-1143"><span class="linenos">1143</span></a>        <span class="n">props</span><span class="o">.</span><span class="n">vs_ff</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">shales</span><span class="o">.</span><span class="n">vs</span>  <span class="c1"># * _ng</span>
</span><span id="SeismicVolume.calculate_shales-1144"><a href="#-1144"><span class="linenos">1144</span></a>        <span class="c1"># props.sum_net[i, j, k] = _ng</span>
</span><span id="SeismicVolume.calculate_shales-1145"><a href="#-1145"><span class="linenos">1145</span></a>
</span><span id="SeismicVolume.calculate_shales-1146"><a href="#-1146"><span class="linenos">1146</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span> <span class="ow">and</span> <span class="n">z</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_random_lyr</span><span class="p">:</span>
</span><span id="SeismicVolume.calculate_shales-1147"><a href="#-1147"><span class="linenos">1147</span></a>            <span class="c1"># Calculate non-randomised properties and differences</span>
</span><span id="SeismicVolume.calculate_shales-1148"><a href="#-1148"><span class="linenos">1148</span></a>            <span class="n">_z0</span> <span class="o">=</span> <span class="n">depth</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span>
</span><span id="SeismicVolume.calculate_shales-1149"><a href="#-1149"><span class="linenos">1149</span></a>            <span class="n">_shales0</span> <span class="o">=</span> <span class="n">rpm</span><span class="o">.</span><span class="n">calc_shale_properties</span><span class="p">(</span><span class="n">_z0</span><span class="p">,</span> <span class="n">_z0</span><span class="p">,</span> <span class="n">_z0</span><span class="p">)</span>
</span><span id="SeismicVolume.calculate_shales-1150"><a href="#-1150"><span class="linenos">1150</span></a>            <span class="n">props</span><span class="o">.</span><span class="n">rho_not_random</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">_shales0</span><span class="o">.</span><span class="n">rho</span>  <span class="c1"># * _ng</span>
</span><span id="SeismicVolume.calculate_shales-1151"><a href="#-1151"><span class="linenos">1151</span></a>            <span class="n">props</span><span class="o">.</span><span class="n">vp_not_random</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">_shales0</span><span class="o">.</span><span class="n">vp</span>  <span class="c1"># * _ng</span>
</span><span id="SeismicVolume.calculate_shales-1152"><a href="#-1152"><span class="linenos">1152</span></a>            <span class="n">props</span><span class="o">.</span><span class="n">vs_not_random</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">_shales0</span><span class="o">.</span><span class="n">vs</span>  <span class="c1"># * _ng</span>
</span><span id="SeismicVolume.calculate_shales-1153"><a href="#-1153"><span class="linenos">1153</span></a>
</span><span id="SeismicVolume.calculate_shales-1154"><a href="#-1154"><span class="linenos">1154</span></a>            <span class="n">delta_rho</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="p">(</span><span class="n">props</span><span class="o">.</span><span class="n">rho</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">/</span> <span class="n">props</span><span class="o">.</span><span class="n">rho_not_random</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">])</span>
</span><span id="SeismicVolume.calculate_shales-1155"><a href="#-1155"><span class="linenos">1155</span></a>            <span class="n">delta_vp</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="p">(</span><span class="n">props</span><span class="o">.</span><span class="n">vp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">/</span> <span class="n">props</span><span class="o">.</span><span class="n">vp_not_random</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">])</span>
</span><span id="SeismicVolume.calculate_shales-1156"><a href="#-1156"><span class="linenos">1156</span></a>            <span class="n">delta_vs</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="p">(</span><span class="n">props</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">/</span> <span class="n">props</span><span class="o">.</span><span class="n">vs_not_random</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">])</span>
</span><span id="SeismicVolume.calculate_shales-1157"><a href="#-1157"><span class="linenos">1157</span></a>            <span class="n">pct_change_rho</span> <span class="o">=</span> <span class="n">delta_rho</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span id="SeismicVolume.calculate_shales-1158"><a href="#-1158"><span class="linenos">1158</span></a>            <span class="n">pct_change_vp</span> <span class="o">=</span> <span class="n">delta_vp</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span id="SeismicVolume.calculate_shales-1159"><a href="#-1159"><span class="linenos">1159</span></a>            <span class="n">pct_change_vs</span> <span class="o">=</span> <span class="n">delta_vs</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span id="SeismicVolume.calculate_shales-1160"><a href="#-1160"><span class="linenos">1160</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="SeismicVolume.calculate_shales-1161"><a href="#-1161"><span class="linenos">1161</span></a>                <span class="sa">f</span><span class="s2">&quot; ... shale: randomization percent change (rho,vp,vs) = &quot;</span>
</span><span id="SeismicVolume.calculate_shales-1162"><a href="#-1162"><span class="linenos">1162</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">pct_change_rho</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">pct_change_vp</span> <span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">pct_change_vs</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="SeismicVolume.calculate_shales-1163"><a href="#-1163"><span class="linenos">1163</span></a>            <span class="p">)</span>
</span><span id="SeismicVolume.calculate_shales-1164"><a href="#-1164"><span class="linenos">1164</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="SeismicVolume.calculate_shales-1165"><a href="#-1165"><span class="linenos">1165</span></a>                <span class="sa">f</span><span class="s2">&quot; ... shale: min/max pre-randomization (rho, vp, vs)  = &quot;</span>
</span><span id="SeismicVolume.calculate_shales-1166"><a href="#-1166"><span class="linenos">1166</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">props</span><span class="o">.</span><span class="n">rho_not_random</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">])</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2"> - &quot;</span>
</span><span id="SeismicVolume.calculate_shales-1167"><a href="#-1167"><span class="linenos">1167</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">props</span><span class="o">.</span><span class="n">rho_not_random</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">])</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">, &quot;</span>
</span><span id="SeismicVolume.calculate_shales-1168"><a href="#-1168"><span class="linenos">1168</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">props</span><span class="o">.</span><span class="n">vp_not_random</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">])</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> - &quot;</span>
</span><span id="SeismicVolume.calculate_shales-1169"><a href="#-1169"><span class="linenos">1169</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">props</span><span class="o">.</span><span class="n">vp_not_random</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">])</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, &quot;</span>
</span><span id="SeismicVolume.calculate_shales-1170"><a href="#-1170"><span class="linenos">1170</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">props</span><span class="o">.</span><span class="n">vs_not_random</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">])</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> - &quot;</span>
</span><span id="SeismicVolume.calculate_shales-1171"><a href="#-1171"><span class="linenos">1171</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">props</span><span class="o">.</span><span class="n">vs_not_random</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">])</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="SeismicVolume.calculate_shales-1172"><a href="#-1172"><span class="linenos">1172</span></a>            <span class="p">)</span>
</span><span id="SeismicVolume.calculate_shales-1173"><a href="#-1173"><span class="linenos">1173</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="SeismicVolume.calculate_shales-1174"><a href="#-1174"><span class="linenos">1174</span></a>                <span class="sa">f</span><span class="s2">&quot; ... shale: min/max post-randomization (rho, vp, vs) = &quot;</span>
</span><span id="SeismicVolume.calculate_shales-1175"><a href="#-1175"><span class="linenos">1175</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">props</span><span class="o">.</span><span class="n">rho</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">])</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2"> - &quot;</span>
</span><span id="SeismicVolume.calculate_shales-1176"><a href="#-1176"><span class="linenos">1176</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">props</span><span class="o">.</span><span class="n">rho</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">])</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">, &quot;</span>
</span><span id="SeismicVolume.calculate_shales-1177"><a href="#-1177"><span class="linenos">1177</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">props</span><span class="o">.</span><span class="n">vp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">])</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> - &quot;</span>
</span><span id="SeismicVolume.calculate_shales-1178"><a href="#-1178"><span class="linenos">1178</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">props</span><span class="o">.</span><span class="n">vp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">])</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, &quot;</span>
</span><span id="SeismicVolume.calculate_shales-1179"><a href="#-1179"><span class="linenos">1179</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">props</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">])</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> - &quot;</span>
</span><span id="SeismicVolume.calculate_shales-1180"><a href="#-1180"><span class="linenos">1180</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">props</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">])</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="SeismicVolume.calculate_shales-1181"><a href="#-1181"><span class="linenos">1181</span></a>            <span class="p">)</span>
</span><span id="SeismicVolume.calculate_shales-1182"><a href="#-1182"><span class="linenos">1182</span></a>
</span><span id="SeismicVolume.calculate_shales-1183"><a href="#-1183"><span class="linenos">1183</span></a>        <span class="k">return</span> <span class="n">props</span>
</span></pre></div>


    

                            </div>
                            <div id="SeismicVolume.calculate_sands" class="classattr">
                                        <input id="SeismicVolume.calculate_sands-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">calculate_sands</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">xyz</span>, </span><span class="param"><span class="n">shifts</span>, </span><span class="param"><span class="n">props</span>, </span><span class="param"><span class="n">rpm</span>, </span><span class="param"><span class="n">depth</span>, </span><span class="param"><span class="n">ng</span>, </span><span class="param"><span class="n">z</span>, </span><span class="param"><span class="n">fluid</span>, </span><span class="param"><span class="n">mix</span><span class="o">=</span><span class="s1">&#39;inv_vel&#39;</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SeismicVolume.calculate_sands-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SeismicVolume.calculate_sands"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SeismicVolume.calculate_sands-1185"><a href="#-1185"><span class="linenos">1185</span></a>    <span class="k">def</span> <span class="nf">calculate_sands</span><span class="p">(</span>
</span><span id="SeismicVolume.calculate_sands-1186"><a href="#-1186"><span class="linenos">1186</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">xyz</span><span class="p">,</span> <span class="n">shifts</span><span class="p">,</span> <span class="n">props</span><span class="p">,</span> <span class="n">rpm</span><span class="p">,</span> <span class="n">depth</span><span class="p">,</span> <span class="n">ng</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">fluid</span><span class="p">,</span> <span class="n">mix</span><span class="o">=</span><span class="s2">&quot;inv_vel&quot;</span>
</span><span id="SeismicVolume.calculate_sands-1187"><a href="#-1187"><span class="linenos">1187</span></a>    <span class="p">):</span>
</span><span id="SeismicVolume.calculate_sands-1188"><a href="#-1188"><span class="linenos">1188</span></a>        <span class="c1"># brine sand or mixture of brine sand and shale in same voxel</span>
</span><span id="SeismicVolume.calculate_sands-1189"><a href="#-1189"><span class="linenos">1189</span></a>        <span class="c1"># - perform velocity sums in slowness or via backus moduli mixing</span>
</span><span id="SeismicVolume.calculate_sands-1190"><a href="#-1190"><span class="linenos">1190</span></a>        <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">xyz</span>
</span><span id="SeismicVolume.calculate_sands-1191"><a href="#-1191"><span class="linenos">1191</span></a>        <span class="n">k_rho</span><span class="p">,</span> <span class="n">k_vp</span><span class="p">,</span> <span class="n">k_vs</span> <span class="o">=</span> <span class="n">shifts</span>
</span><span id="SeismicVolume.calculate_sands-1192"><a href="#-1192"><span class="linenos">1192</span></a>
</span><span id="SeismicVolume.calculate_sands-1193"><a href="#-1193"><span class="linenos">1193</span></a>        <span class="n">z_rho</span> <span class="o">=</span> <span class="n">depth</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k_rho</span><span class="p">]</span>
</span><span id="SeismicVolume.calculate_sands-1194"><a href="#-1194"><span class="linenos">1194</span></a>        <span class="n">z_vp</span> <span class="o">=</span> <span class="n">depth</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k_vp</span><span class="p">]</span>
</span><span id="SeismicVolume.calculate_sands-1195"><a href="#-1195"><span class="linenos">1195</span></a>        <span class="n">z_vs</span> <span class="o">=</span> <span class="n">depth</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k_vs</span><span class="p">]</span>
</span><span id="SeismicVolume.calculate_sands-1196"><a href="#-1196"><span class="linenos">1196</span></a>        <span class="k">if</span> <span class="n">fluid</span> <span class="o">==</span> <span class="s2">&quot;brine&quot;</span><span class="p">:</span>
</span><span id="SeismicVolume.calculate_sands-1197"><a href="#-1197"><span class="linenos">1197</span></a>            <span class="n">sands</span> <span class="o">=</span> <span class="n">rpm</span><span class="o">.</span><span class="n">calc_brine_sand_properties</span><span class="p">(</span><span class="n">z_rho</span><span class="p">,</span> <span class="n">z_vp</span><span class="p">,</span> <span class="n">z_vs</span><span class="p">)</span>
</span><span id="SeismicVolume.calculate_sands-1198"><a href="#-1198"><span class="linenos">1198</span></a>        <span class="k">elif</span> <span class="n">fluid</span> <span class="o">==</span> <span class="s2">&quot;oil&quot;</span><span class="p">:</span>
</span><span id="SeismicVolume.calculate_sands-1199"><a href="#-1199"><span class="linenos">1199</span></a>            <span class="n">sands</span> <span class="o">=</span> <span class="n">rpm</span><span class="o">.</span><span class="n">calc_oil_sand_properties</span><span class="p">(</span><span class="n">z_rho</span><span class="p">,</span> <span class="n">z_vp</span><span class="p">,</span> <span class="n">z_vs</span><span class="p">)</span>
</span><span id="SeismicVolume.calculate_sands-1200"><a href="#-1200"><span class="linenos">1200</span></a>        <span class="k">elif</span> <span class="n">fluid</span> <span class="o">==</span> <span class="s2">&quot;gas&quot;</span><span class="p">:</span>
</span><span id="SeismicVolume.calculate_sands-1201"><a href="#-1201"><span class="linenos">1201</span></a>            <span class="n">sands</span> <span class="o">=</span> <span class="n">rpm</span><span class="o">.</span><span class="n">calc_gas_sand_properties</span><span class="p">(</span><span class="n">z_rho</span><span class="p">,</span> <span class="n">z_vp</span><span class="p">,</span> <span class="n">z_vs</span><span class="p">)</span>
</span><span id="SeismicVolume.calculate_sands-1202"><a href="#-1202"><span class="linenos">1202</span></a>
</span><span id="SeismicVolume.calculate_sands-1203"><a href="#-1203"><span class="linenos">1203</span></a>        <span class="n">shales</span> <span class="o">=</span> <span class="n">RockProperties</span><span class="p">(</span>
</span><span id="SeismicVolume.calculate_sands-1204"><a href="#-1204"><span class="linenos">1204</span></a>            <span class="n">rho</span><span class="o">=</span><span class="n">props</span><span class="o">.</span><span class="n">rho</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">],</span> <span class="n">vp</span><span class="o">=</span><span class="n">props</span><span class="o">.</span><span class="n">vp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">],</span> <span class="n">vs</span><span class="o">=</span><span class="n">props</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span>
</span><span id="SeismicVolume.calculate_sands-1205"><a href="#-1205"><span class="linenos">1205</span></a>        <span class="p">)</span>
</span><span id="SeismicVolume.calculate_sands-1206"><a href="#-1206"><span class="linenos">1206</span></a>        <span class="n">rpmix</span> <span class="o">=</span> <span class="n">EndMemberMixing</span><span class="p">(</span><span class="n">shales</span><span class="p">,</span> <span class="n">sands</span><span class="p">,</span> <span class="n">ng</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">])</span>
</span><span id="SeismicVolume.calculate_sands-1207"><a href="#-1207"><span class="linenos">1207</span></a>
</span><span id="SeismicVolume.calculate_sands-1208"><a href="#-1208"><span class="linenos">1208</span></a>        <span class="k">if</span> <span class="n">mix</span> <span class="o">==</span> <span class="s2">&quot;inv_vel&quot;</span><span class="p">:</span>
</span><span id="SeismicVolume.calculate_sands-1209"><a href="#-1209"><span class="linenos">1209</span></a>            <span class="n">rpmix</span><span class="o">.</span><span class="n">inverse_velocity_mixing</span><span class="p">()</span>
</span><span id="SeismicVolume.calculate_sands-1210"><a href="#-1210"><span class="linenos">1210</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SeismicVolume.calculate_sands-1211"><a href="#-1211"><span class="linenos">1211</span></a>            <span class="n">rpmix</span><span class="o">.</span><span class="n">backus_moduli_mixing</span><span class="p">()</span>
</span><span id="SeismicVolume.calculate_sands-1212"><a href="#-1212"><span class="linenos">1212</span></a>
</span><span id="SeismicVolume.calculate_sands-1213"><a href="#-1213"><span class="linenos">1213</span></a>        <span class="n">props</span><span class="o">.</span><span class="n">sum_net</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">+=</span> <span class="n">ng</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span>
</span><span id="SeismicVolume.calculate_sands-1214"><a href="#-1214"><span class="linenos">1214</span></a>        <span class="n">props</span><span class="o">.</span><span class="n">rho</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">rpmix</span><span class="o">.</span><span class="n">rho</span>
</span><span id="SeismicVolume.calculate_sands-1215"><a href="#-1215"><span class="linenos">1215</span></a>        <span class="n">props</span><span class="o">.</span><span class="n">vp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">rpmix</span><span class="o">.</span><span class="n">vp</span>
</span><span id="SeismicVolume.calculate_sands-1216"><a href="#-1216"><span class="linenos">1216</span></a>        <span class="n">props</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">rpmix</span><span class="o">.</span><span class="n">vs</span>
</span><span id="SeismicVolume.calculate_sands-1217"><a href="#-1217"><span class="linenos">1217</span></a>
</span><span id="SeismicVolume.calculate_sands-1218"><a href="#-1218"><span class="linenos">1218</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span> <span class="ow">and</span> <span class="n">z</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_random_lyr</span><span class="p">:</span>
</span><span id="SeismicVolume.calculate_sands-1219"><a href="#-1219"><span class="linenos">1219</span></a>            <span class="c1"># Calculate non-randomised properties and differences</span>
</span><span id="SeismicVolume.calculate_sands-1220"><a href="#-1220"><span class="linenos">1220</span></a>            <span class="n">_z0</span> <span class="o">=</span> <span class="n">depth</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span>
</span><span id="SeismicVolume.calculate_sands-1221"><a href="#-1221"><span class="linenos">1221</span></a>            <span class="k">if</span> <span class="n">fluid</span> <span class="o">==</span> <span class="s2">&quot;brine&quot;</span><span class="p">:</span>
</span><span id="SeismicVolume.calculate_sands-1222"><a href="#-1222"><span class="linenos">1222</span></a>                <span class="n">_sands0</span> <span class="o">=</span> <span class="n">rpm</span><span class="o">.</span><span class="n">calc_brine_sand_properties</span><span class="p">(</span><span class="n">_z0</span><span class="p">,</span> <span class="n">_z0</span><span class="p">,</span> <span class="n">_z0</span><span class="p">)</span>
</span><span id="SeismicVolume.calculate_sands-1223"><a href="#-1223"><span class="linenos">1223</span></a>            <span class="k">elif</span> <span class="n">fluid</span> <span class="o">==</span> <span class="s2">&quot;oil&quot;</span><span class="p">:</span>
</span><span id="SeismicVolume.calculate_sands-1224"><a href="#-1224"><span class="linenos">1224</span></a>                <span class="n">_sands0</span> <span class="o">=</span> <span class="n">rpm</span><span class="o">.</span><span class="n">calc_oil_sand_properties</span><span class="p">(</span><span class="n">_z0</span><span class="p">,</span> <span class="n">_z0</span><span class="p">,</span> <span class="n">_z0</span><span class="p">)</span>
</span><span id="SeismicVolume.calculate_sands-1225"><a href="#-1225"><span class="linenos">1225</span></a>            <span class="k">elif</span> <span class="n">fluid</span> <span class="o">==</span> <span class="s2">&quot;gas&quot;</span><span class="p">:</span>
</span><span id="SeismicVolume.calculate_sands-1226"><a href="#-1226"><span class="linenos">1226</span></a>                <span class="n">_sands0</span> <span class="o">=</span> <span class="n">rpm</span><span class="o">.</span><span class="n">calc_gas_sand_properties</span><span class="p">(</span><span class="n">_z0</span><span class="p">,</span> <span class="n">_z0</span><span class="p">,</span> <span class="n">_z0</span><span class="p">)</span>
</span><span id="SeismicVolume.calculate_sands-1227"><a href="#-1227"><span class="linenos">1227</span></a>
</span><span id="SeismicVolume.calculate_sands-1228"><a href="#-1228"><span class="linenos">1228</span></a>            <span class="n">rpmix_0</span> <span class="o">=</span> <span class="n">EndMemberMixing</span><span class="p">(</span><span class="n">shales</span><span class="p">,</span> <span class="n">_sands0</span><span class="p">,</span> <span class="n">ng</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">])</span>
</span><span id="SeismicVolume.calculate_sands-1229"><a href="#-1229"><span class="linenos">1229</span></a>            <span class="k">if</span> <span class="n">mix</span> <span class="o">==</span> <span class="s2">&quot;inv_vel&quot;</span><span class="p">:</span>
</span><span id="SeismicVolume.calculate_sands-1230"><a href="#-1230"><span class="linenos">1230</span></a>                <span class="c1"># Apply Inverse Velocity mixing</span>
</span><span id="SeismicVolume.calculate_sands-1231"><a href="#-1231"><span class="linenos">1231</span></a>                <span class="n">rpmix_0</span><span class="o">.</span><span class="n">inverse_velocity_mixing</span><span class="p">()</span>
</span><span id="SeismicVolume.calculate_sands-1232"><a href="#-1232"><span class="linenos">1232</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="SeismicVolume.calculate_sands-1233"><a href="#-1233"><span class="linenos">1233</span></a>                <span class="c1"># Apply Backus Moduli mixing</span>
</span><span id="SeismicVolume.calculate_sands-1234"><a href="#-1234"><span class="linenos">1234</span></a>                <span class="n">rpmix_0</span><span class="o">.</span><span class="n">backus_moduli_mixing</span><span class="p">()</span>
</span><span id="SeismicVolume.calculate_sands-1235"><a href="#-1235"><span class="linenos">1235</span></a>            <span class="n">props</span><span class="o">.</span><span class="n">rho_not_random</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">rpmix_0</span><span class="o">.</span><span class="n">rho</span>
</span><span id="SeismicVolume.calculate_sands-1236"><a href="#-1236"><span class="linenos">1236</span></a>            <span class="n">props</span><span class="o">.</span><span class="n">vp_not_random</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">rpmix_0</span><span class="o">.</span><span class="n">vp</span>
</span><span id="SeismicVolume.calculate_sands-1237"><a href="#-1237"><span class="linenos">1237</span></a>            <span class="n">props</span><span class="o">.</span><span class="n">vs_not_random</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">rpmix_0</span><span class="o">.</span><span class="n">vs</span>
</span><span id="SeismicVolume.calculate_sands-1238"><a href="#-1238"><span class="linenos">1238</span></a>
</span><span id="SeismicVolume.calculate_sands-1239"><a href="#-1239"><span class="linenos">1239</span></a>            <span class="n">delta_rho</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="p">(</span><span class="n">props</span><span class="o">.</span><span class="n">rho</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">/</span> <span class="n">props</span><span class="o">.</span><span class="n">rho_not_random</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">])</span>
</span><span id="SeismicVolume.calculate_sands-1240"><a href="#-1240"><span class="linenos">1240</span></a>            <span class="n">delta_vp</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="p">(</span><span class="n">props</span><span class="o">.</span><span class="n">vp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">/</span> <span class="n">props</span><span class="o">.</span><span class="n">vp_not_random</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">])</span>
</span><span id="SeismicVolume.calculate_sands-1241"><a href="#-1241"><span class="linenos">1241</span></a>            <span class="n">delta_vs</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="p">(</span><span class="n">props</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">/</span> <span class="n">props</span><span class="o">.</span><span class="n">vs_not_random</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">])</span>
</span><span id="SeismicVolume.calculate_sands-1242"><a href="#-1242"><span class="linenos">1242</span></a>            <span class="n">pct_change_rho</span> <span class="o">=</span> <span class="n">delta_rho</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span id="SeismicVolume.calculate_sands-1243"><a href="#-1243"><span class="linenos">1243</span></a>            <span class="n">pct_change_vp</span> <span class="o">=</span> <span class="n">delta_vp</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span id="SeismicVolume.calculate_sands-1244"><a href="#-1244"><span class="linenos">1244</span></a>            <span class="n">pct_change_vs</span> <span class="o">=</span> <span class="n">delta_vs</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span id="SeismicVolume.calculate_sands-1245"><a href="#-1245"><span class="linenos">1245</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="SeismicVolume.calculate_sands-1246"><a href="#-1246"><span class="linenos">1246</span></a>                <span class="sa">f</span><span class="s2">&quot; ... </span><span class="si">{</span><span class="n">fluid</span><span class="si">}</span><span class="s2">: randomization percent change (rho,vp,vs) = &quot;</span>
</span><span id="SeismicVolume.calculate_sands-1247"><a href="#-1247"><span class="linenos">1247</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">pct_change_rho</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">pct_change_vp</span> <span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">pct_change_vs</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="SeismicVolume.calculate_sands-1248"><a href="#-1248"><span class="linenos">1248</span></a>            <span class="p">)</span>
</span><span id="SeismicVolume.calculate_sands-1249"><a href="#-1249"><span class="linenos">1249</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="SeismicVolume.calculate_sands-1250"><a href="#-1250"><span class="linenos">1250</span></a>                <span class="sa">f</span><span class="s2">&quot; ... </span><span class="si">{</span><span class="n">fluid</span><span class="si">}</span><span class="s2">: min/max pre-randomization (rho, vp, vs)  = &quot;</span>
</span><span id="SeismicVolume.calculate_sands-1251"><a href="#-1251"><span class="linenos">1251</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">props</span><span class="o">.</span><span class="n">rho_not_random</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">])</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2"> - &quot;</span>
</span><span id="SeismicVolume.calculate_sands-1252"><a href="#-1252"><span class="linenos">1252</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">props</span><span class="o">.</span><span class="n">rho_not_random</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">])</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">, &quot;</span>
</span><span id="SeismicVolume.calculate_sands-1253"><a href="#-1253"><span class="linenos">1253</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">props</span><span class="o">.</span><span class="n">vp_not_random</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">])</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> - &quot;</span>
</span><span id="SeismicVolume.calculate_sands-1254"><a href="#-1254"><span class="linenos">1254</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">props</span><span class="o">.</span><span class="n">vp_not_random</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">])</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, &quot;</span>
</span><span id="SeismicVolume.calculate_sands-1255"><a href="#-1255"><span class="linenos">1255</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">props</span><span class="o">.</span><span class="n">vs_not_random</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">])</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> - &quot;</span>
</span><span id="SeismicVolume.calculate_sands-1256"><a href="#-1256"><span class="linenos">1256</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">props</span><span class="o">.</span><span class="n">vs_not_random</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">])</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="SeismicVolume.calculate_sands-1257"><a href="#-1257"><span class="linenos">1257</span></a>            <span class="p">)</span>
</span><span id="SeismicVolume.calculate_sands-1258"><a href="#-1258"><span class="linenos">1258</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="SeismicVolume.calculate_sands-1259"><a href="#-1259"><span class="linenos">1259</span></a>                <span class="sa">f</span><span class="s2">&quot; ... </span><span class="si">{</span><span class="n">fluid</span><span class="si">}</span><span class="s2">: min/max post-randomization (rho, vp, vs) = &quot;</span>
</span><span id="SeismicVolume.calculate_sands-1260"><a href="#-1260"><span class="linenos">1260</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">props</span><span class="o">.</span><span class="n">rho</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">])</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2"> - &quot;</span>
</span><span id="SeismicVolume.calculate_sands-1261"><a href="#-1261"><span class="linenos">1261</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">props</span><span class="o">.</span><span class="n">rho</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">])</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">, &quot;</span>
</span><span id="SeismicVolume.calculate_sands-1262"><a href="#-1262"><span class="linenos">1262</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">props</span><span class="o">.</span><span class="n">vp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">])</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> - &quot;</span>
</span><span id="SeismicVolume.calculate_sands-1263"><a href="#-1263"><span class="linenos">1263</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">props</span><span class="o">.</span><span class="n">vp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">])</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, &quot;</span>
</span><span id="SeismicVolume.calculate_sands-1264"><a href="#-1264"><span class="linenos">1264</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">props</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">])</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> - &quot;</span>
</span><span id="SeismicVolume.calculate_sands-1265"><a href="#-1265"><span class="linenos">1265</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">props</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">])</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="SeismicVolume.calculate_sands-1266"><a href="#-1266"><span class="linenos">1266</span></a>            <span class="p">)</span>
</span><span id="SeismicVolume.calculate_sands-1267"><a href="#-1267"><span class="linenos">1267</span></a>
</span><span id="SeismicVolume.calculate_sands-1268"><a href="#-1268"><span class="linenos">1268</span></a>        <span class="k">return</span> <span class="n">props</span>
</span></pre></div>


    

                            </div>
                            <div id="SeismicVolume.fix_zero_values_at_base" class="classattr">
                                        <input id="SeismicVolume.fix_zero_values_at_base-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">fix_zero_values_at_base</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">props</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SeismicVolume.fix_zero_values_at_base-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SeismicVolume.fix_zero_values_at_base"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SeismicVolume.fix_zero_values_at_base-1270"><a href="#-1270"><span class="linenos">1270</span></a>    <span class="nd">@staticmethod</span>
</span><span id="SeismicVolume.fix_zero_values_at_base-1271"><a href="#-1271"><span class="linenos">1271</span></a>    <span class="k">def</span> <span class="nf">fix_zero_values_at_base</span><span class="p">(</span><span class="n">props</span><span class="p">):</span>
</span><span id="SeismicVolume.fix_zero_values_at_base-1272"><a href="#-1272"><span class="linenos">1272</span></a>        <span class="sd">&quot;&quot;&quot;Check for zero values at base of property volumes and replace with</span>
</span><span id="SeismicVolume.fix_zero_values_at_base-1273"><a href="#-1273"><span class="linenos">1273</span></a><span class="sd">        shallower values if present</span>
</span><span id="SeismicVolume.fix_zero_values_at_base-1274"><a href="#-1274"><span class="linenos">1274</span></a>
</span><span id="SeismicVolume.fix_zero_values_at_base-1275"><a href="#-1275"><span class="linenos">1275</span></a><span class="sd">        Args:</span>
</span><span id="SeismicVolume.fix_zero_values_at_base-1276"><a href="#-1276"><span class="linenos">1276</span></a><span class="sd">            a ([type]): [description]</span>
</span><span id="SeismicVolume.fix_zero_values_at_base-1277"><a href="#-1277"><span class="linenos">1277</span></a><span class="sd">            b ([type]): [description]</span>
</span><span id="SeismicVolume.fix_zero_values_at_base-1278"><a href="#-1278"><span class="linenos">1278</span></a><span class="sd">            c ([type]): [description]</span>
</span><span id="SeismicVolume.fix_zero_values_at_base-1279"><a href="#-1279"><span class="linenos">1279</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SeismicVolume.fix_zero_values_at_base-1280"><a href="#-1280"><span class="linenos">1280</span></a>        <span class="k">for</span> <span class="n">vol</span> <span class="ow">in</span> <span class="p">[</span>
</span><span id="SeismicVolume.fix_zero_values_at_base-1281"><a href="#-1281"><span class="linenos">1281</span></a>            <span class="n">props</span><span class="o">.</span><span class="n">rho</span><span class="p">,</span>
</span><span id="SeismicVolume.fix_zero_values_at_base-1282"><a href="#-1282"><span class="linenos">1282</span></a>            <span class="n">props</span><span class="o">.</span><span class="n">vp</span><span class="p">,</span>
</span><span id="SeismicVolume.fix_zero_values_at_base-1283"><a href="#-1283"><span class="linenos">1283</span></a>            <span class="n">props</span><span class="o">.</span><span class="n">vs</span><span class="p">,</span>
</span><span id="SeismicVolume.fix_zero_values_at_base-1284"><a href="#-1284"><span class="linenos">1284</span></a>            <span class="n">props</span><span class="o">.</span><span class="n">rho_ff</span><span class="p">,</span>
</span><span id="SeismicVolume.fix_zero_values_at_base-1285"><a href="#-1285"><span class="linenos">1285</span></a>            <span class="n">props</span><span class="o">.</span><span class="n">vp_ff</span><span class="p">,</span>
</span><span id="SeismicVolume.fix_zero_values_at_base-1286"><a href="#-1286"><span class="linenos">1286</span></a>            <span class="n">props</span><span class="o">.</span><span class="n">vs_ff</span><span class="p">,</span>
</span><span id="SeismicVolume.fix_zero_values_at_base-1287"><a href="#-1287"><span class="linenos">1287</span></a>        <span class="p">]:</span>
</span><span id="SeismicVolume.fix_zero_values_at_base-1288"><a href="#-1288"><span class="linenos">1288</span></a>            <span class="k">for</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="n">vol</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">):</span>
</span><span id="SeismicVolume.fix_zero_values_at_base-1289"><a href="#-1289"><span class="linenos">1289</span></a>                <span class="n">vol</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">]</span> <span class="o">=</span> <span class="n">vol</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="SeismicVolume.fix_zero_values_at_base-1290"><a href="#-1290"><span class="linenos">1290</span></a>        <span class="k">return</span> <span class="n">props</span>
</span></pre></div>


            <div class="docstring"><p>Check for zero values at base of property volumes and replace with
shallower values if present</p>

<p>Args:
    a ([type]): [description]
    b ([type]): [description]
    c ([type]): [description]</p>
</div>


                            </div>
                            <div id="SeismicVolume.apply_scaling_factors" class="classattr">
                                        <input id="SeismicVolume.apply_scaling_factors-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">apply_scaling_factors</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">props</span>, </span><span class="param"><span class="n">ng</span>, </span><span class="param"><span class="n">lith</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SeismicVolume.apply_scaling_factors-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SeismicVolume.apply_scaling_factors"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SeismicVolume.apply_scaling_factors-1292"><a href="#-1292"><span class="linenos">1292</span></a>    <span class="k">def</span> <span class="nf">apply_scaling_factors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">props</span><span class="p">,</span> <span class="n">ng</span><span class="p">,</span> <span class="n">lith</span><span class="p">):</span>
</span><span id="SeismicVolume.apply_scaling_factors-1293"><a href="#-1293"><span class="linenos">1293</span></a>        <span class="sd">&quot;&quot;&quot;Apply final random scaling factors to sands and shales&quot;&quot;&quot;</span>
</span><span id="SeismicVolume.apply_scaling_factors-1294"><a href="#-1294"><span class="linenos">1294</span></a>        <span class="n">rho_factor_shale</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">rpm_scaling_factors</span><span class="p">[</span><span class="s2">&quot;shalerho_factor&quot;</span><span class="p">]</span>
</span><span id="SeismicVolume.apply_scaling_factors-1295"><a href="#-1295"><span class="linenos">1295</span></a>        <span class="n">vp_factor_shale</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">rpm_scaling_factors</span><span class="p">[</span><span class="s2">&quot;shalevp_factor&quot;</span><span class="p">]</span>
</span><span id="SeismicVolume.apply_scaling_factors-1296"><a href="#-1296"><span class="linenos">1296</span></a>        <span class="n">vs_factor_shale</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">rpm_scaling_factors</span><span class="p">[</span><span class="s2">&quot;shalevs_factor&quot;</span><span class="p">]</span>
</span><span id="SeismicVolume.apply_scaling_factors-1297"><a href="#-1297"><span class="linenos">1297</span></a>        <span class="n">rho_factor_sand</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">rpm_scaling_factors</span><span class="p">[</span><span class="s2">&quot;sandrho_factor&quot;</span><span class="p">]</span>
</span><span id="SeismicVolume.apply_scaling_factors-1298"><a href="#-1298"><span class="linenos">1298</span></a>        <span class="n">vp_factor_sand</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">rpm_scaling_factors</span><span class="p">[</span><span class="s2">&quot;sandvp_factor&quot;</span><span class="p">]</span>
</span><span id="SeismicVolume.apply_scaling_factors-1299"><a href="#-1299"><span class="linenos">1299</span></a>        <span class="n">vs_factor_sand</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">rpm_scaling_factors</span><span class="p">[</span><span class="s2">&quot;sandvs_factor&quot;</span><span class="p">]</span>
</span><span id="SeismicVolume.apply_scaling_factors-1300"><a href="#-1300"><span class="linenos">1300</span></a>
</span><span id="SeismicVolume.apply_scaling_factors-1301"><a href="#-1301"><span class="linenos">1301</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="SeismicVolume.apply_scaling_factors-1302"><a href="#-1302"><span class="linenos">1302</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="SeismicVolume.apply_scaling_factors-1303"><a href="#-1303"><span class="linenos">1303</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">... Additional random scaling factors: &quot;</span>
</span><span id="SeismicVolume.apply_scaling_factors-1304"><a href="#-1304"><span class="linenos">1304</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> ... Shale Rho </span><span class="si">{</span><span class="n">rho_factor_shale</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">, Vp </span><span class="si">{</span><span class="n">vp_factor_shale</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">, Vs </span><span class="si">{</span><span class="n">vs_factor_shale</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="SeismicVolume.apply_scaling_factors-1305"><a href="#-1305"><span class="linenos">1305</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> ... Sand Rho </span><span class="si">{</span><span class="n">rho_factor_sand</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">, Vp </span><span class="si">{</span><span class="n">vp_factor_sand</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">, Vs </span><span class="si">{</span><span class="n">vs_factor_sand</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="SeismicVolume.apply_scaling_factors-1306"><a href="#-1306"><span class="linenos">1306</span></a>            <span class="p">)</span>
</span><span id="SeismicVolume.apply_scaling_factors-1307"><a href="#-1307"><span class="linenos">1307</span></a>
</span><span id="SeismicVolume.apply_scaling_factors-1308"><a href="#-1308"><span class="linenos">1308</span></a>        <span class="c1"># Apply final scaling factors to shale/sand properties</span>
</span><span id="SeismicVolume.apply_scaling_factors-1309"><a href="#-1309"><span class="linenos">1309</span></a>        <span class="n">props</span><span class="o">.</span><span class="n">rho</span><span class="p">[(</span><span class="n">ng</span> <span class="o">&lt;=</span> <span class="mf">1.0e-2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lith</span> <span class="o">&lt;</span> <span class="mf">2.0</span><span class="p">)]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="SeismicVolume.apply_scaling_factors-1310"><a href="#-1310"><span class="linenos">1310</span></a>            <span class="n">props</span><span class="o">.</span><span class="n">rho</span><span class="p">[(</span><span class="n">ng</span> <span class="o">&lt;=</span> <span class="mf">1.0e-2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lith</span> <span class="o">&lt;</span> <span class="mf">2.0</span><span class="p">)]</span> <span class="o">*</span> <span class="n">rho_factor_shale</span>
</span><span id="SeismicVolume.apply_scaling_factors-1311"><a href="#-1311"><span class="linenos">1311</span></a>        <span class="p">)</span>
</span><span id="SeismicVolume.apply_scaling_factors-1312"><a href="#-1312"><span class="linenos">1312</span></a>        <span class="n">props</span><span class="o">.</span><span class="n">vp</span><span class="p">[(</span><span class="n">ng</span> <span class="o">&lt;=</span> <span class="mf">1.0e-2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lith</span> <span class="o">&lt;</span> <span class="mf">2.0</span><span class="p">)]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="SeismicVolume.apply_scaling_factors-1313"><a href="#-1313"><span class="linenos">1313</span></a>            <span class="n">props</span><span class="o">.</span><span class="n">vp</span><span class="p">[(</span><span class="n">ng</span> <span class="o">&lt;=</span> <span class="mf">1.0e-2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lith</span> <span class="o">&lt;</span> <span class="mf">2.0</span><span class="p">)]</span> <span class="o">*</span> <span class="n">vp_factor_shale</span>
</span><span id="SeismicVolume.apply_scaling_factors-1314"><a href="#-1314"><span class="linenos">1314</span></a>        <span class="p">)</span>
</span><span id="SeismicVolume.apply_scaling_factors-1315"><a href="#-1315"><span class="linenos">1315</span></a>        <span class="n">props</span><span class="o">.</span><span class="n">vs</span><span class="p">[(</span><span class="n">ng</span> <span class="o">&lt;=</span> <span class="mf">1.0e-2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lith</span> <span class="o">&lt;</span> <span class="mf">2.0</span><span class="p">)]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="SeismicVolume.apply_scaling_factors-1316"><a href="#-1316"><span class="linenos">1316</span></a>            <span class="n">props</span><span class="o">.</span><span class="n">vs</span><span class="p">[(</span><span class="n">ng</span> <span class="o">&lt;=</span> <span class="mf">1.0e-2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lith</span> <span class="o">&lt;</span> <span class="mf">2.0</span><span class="p">)]</span> <span class="o">*</span> <span class="n">vs_factor_shale</span>
</span><span id="SeismicVolume.apply_scaling_factors-1317"><a href="#-1317"><span class="linenos">1317</span></a>        <span class="p">)</span>
</span><span id="SeismicVolume.apply_scaling_factors-1318"><a href="#-1318"><span class="linenos">1318</span></a>        <span class="n">props</span><span class="o">.</span><span class="n">rho</span><span class="p">[(</span><span class="n">ng</span> <span class="o">&gt;</span> <span class="mf">1.0e-2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lith</span> <span class="o">&lt;</span> <span class="mf">2.0</span><span class="p">)]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="SeismicVolume.apply_scaling_factors-1319"><a href="#-1319"><span class="linenos">1319</span></a>            <span class="n">props</span><span class="o">.</span><span class="n">rho</span><span class="p">[(</span><span class="n">ng</span> <span class="o">&gt;</span> <span class="mf">1.0e-2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lith</span> <span class="o">&lt;</span> <span class="mf">2.0</span><span class="p">)]</span> <span class="o">*</span> <span class="n">rho_factor_sand</span>
</span><span id="SeismicVolume.apply_scaling_factors-1320"><a href="#-1320"><span class="linenos">1320</span></a>        <span class="p">)</span>
</span><span id="SeismicVolume.apply_scaling_factors-1321"><a href="#-1321"><span class="linenos">1321</span></a>        <span class="n">props</span><span class="o">.</span><span class="n">vp</span><span class="p">[(</span><span class="n">ng</span> <span class="o">&gt;</span> <span class="mf">1.0e-2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lith</span> <span class="o">&lt;</span> <span class="mf">2.0</span><span class="p">)]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="SeismicVolume.apply_scaling_factors-1322"><a href="#-1322"><span class="linenos">1322</span></a>            <span class="n">props</span><span class="o">.</span><span class="n">vp</span><span class="p">[(</span><span class="n">ng</span> <span class="o">&gt;</span> <span class="mf">1.0e-2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lith</span> <span class="o">&lt;</span> <span class="mf">2.0</span><span class="p">)]</span> <span class="o">*</span> <span class="n">vp_factor_sand</span>
</span><span id="SeismicVolume.apply_scaling_factors-1323"><a href="#-1323"><span class="linenos">1323</span></a>        <span class="p">)</span>
</span><span id="SeismicVolume.apply_scaling_factors-1324"><a href="#-1324"><span class="linenos">1324</span></a>        <span class="n">props</span><span class="o">.</span><span class="n">vs</span><span class="p">[(</span><span class="n">ng</span> <span class="o">&gt;</span> <span class="mf">1.0e-2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lith</span> <span class="o">&lt;</span> <span class="mf">2.0</span><span class="p">)]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="SeismicVolume.apply_scaling_factors-1325"><a href="#-1325"><span class="linenos">1325</span></a>            <span class="n">props</span><span class="o">.</span><span class="n">vs</span><span class="p">[(</span><span class="n">ng</span> <span class="o">&gt;</span> <span class="mf">1.0e-2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lith</span> <span class="o">&lt;</span> <span class="mf">2.0</span><span class="p">)]</span> <span class="o">*</span> <span class="n">vs_factor_sand</span>
</span><span id="SeismicVolume.apply_scaling_factors-1326"><a href="#-1326"><span class="linenos">1326</span></a>        <span class="p">)</span>
</span><span id="SeismicVolume.apply_scaling_factors-1327"><a href="#-1327"><span class="linenos">1327</span></a>        <span class="c1"># Apply same factors to the fluid-factor property cubes</span>
</span><span id="SeismicVolume.apply_scaling_factors-1328"><a href="#-1328"><span class="linenos">1328</span></a>        <span class="n">props</span><span class="o">.</span><span class="n">rho_ff</span><span class="p">[(</span><span class="n">ng</span> <span class="o">&lt;=</span> <span class="mf">1.0e-2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lith</span> <span class="o">&lt;</span> <span class="mf">2.0</span><span class="p">)]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="SeismicVolume.apply_scaling_factors-1329"><a href="#-1329"><span class="linenos">1329</span></a>            <span class="n">props</span><span class="o">.</span><span class="n">rho_ff</span><span class="p">[(</span><span class="n">ng</span> <span class="o">&lt;=</span> <span class="mf">1.0e-2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lith</span> <span class="o">&lt;</span> <span class="mf">2.0</span><span class="p">)]</span> <span class="o">*</span> <span class="n">rho_factor_shale</span>
</span><span id="SeismicVolume.apply_scaling_factors-1330"><a href="#-1330"><span class="linenos">1330</span></a>        <span class="p">)</span>
</span><span id="SeismicVolume.apply_scaling_factors-1331"><a href="#-1331"><span class="linenos">1331</span></a>        <span class="n">props</span><span class="o">.</span><span class="n">vp_ff</span><span class="p">[(</span><span class="n">ng</span> <span class="o">&lt;=</span> <span class="mf">1.0e-2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lith</span> <span class="o">&lt;</span> <span class="mf">2.0</span><span class="p">)]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="SeismicVolume.apply_scaling_factors-1332"><a href="#-1332"><span class="linenos">1332</span></a>            <span class="n">props</span><span class="o">.</span><span class="n">vp_ff</span><span class="p">[(</span><span class="n">ng</span> <span class="o">&lt;=</span> <span class="mf">1.0e-2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lith</span> <span class="o">&lt;</span> <span class="mf">2.0</span><span class="p">)]</span> <span class="o">*</span> <span class="n">vp_factor_shale</span>
</span><span id="SeismicVolume.apply_scaling_factors-1333"><a href="#-1333"><span class="linenos">1333</span></a>        <span class="p">)</span>
</span><span id="SeismicVolume.apply_scaling_factors-1334"><a href="#-1334"><span class="linenos">1334</span></a>        <span class="n">props</span><span class="o">.</span><span class="n">vs_ff</span><span class="p">[(</span><span class="n">ng</span> <span class="o">&lt;=</span> <span class="mf">1.0e-2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lith</span> <span class="o">&lt;</span> <span class="mf">2.0</span><span class="p">)]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="SeismicVolume.apply_scaling_factors-1335"><a href="#-1335"><span class="linenos">1335</span></a>            <span class="n">props</span><span class="o">.</span><span class="n">vs_ff</span><span class="p">[(</span><span class="n">ng</span> <span class="o">&lt;=</span> <span class="mf">1.0e-2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lith</span> <span class="o">&lt;</span> <span class="mf">2.0</span><span class="p">)]</span> <span class="o">*</span> <span class="n">vs_factor_shale</span>
</span><span id="SeismicVolume.apply_scaling_factors-1336"><a href="#-1336"><span class="linenos">1336</span></a>        <span class="p">)</span>
</span><span id="SeismicVolume.apply_scaling_factors-1337"><a href="#-1337"><span class="linenos">1337</span></a>        <span class="n">props</span><span class="o">.</span><span class="n">rho_ff</span><span class="p">[(</span><span class="n">ng</span> <span class="o">&gt;</span> <span class="mf">1.0e-2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lith</span> <span class="o">&lt;</span> <span class="mf">2.0</span><span class="p">)]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="SeismicVolume.apply_scaling_factors-1338"><a href="#-1338"><span class="linenos">1338</span></a>            <span class="n">props</span><span class="o">.</span><span class="n">rho_ff</span><span class="p">[(</span><span class="n">ng</span> <span class="o">&gt;</span> <span class="mf">1.0e-2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lith</span> <span class="o">&lt;</span> <span class="mf">2.0</span><span class="p">)]</span> <span class="o">*</span> <span class="n">rho_factor_sand</span>
</span><span id="SeismicVolume.apply_scaling_factors-1339"><a href="#-1339"><span class="linenos">1339</span></a>        <span class="p">)</span>
</span><span id="SeismicVolume.apply_scaling_factors-1340"><a href="#-1340"><span class="linenos">1340</span></a>        <span class="n">props</span><span class="o">.</span><span class="n">vp_ff</span><span class="p">[(</span><span class="n">ng</span> <span class="o">&gt;</span> <span class="mf">1.0e-2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lith</span> <span class="o">&lt;</span> <span class="mf">2.0</span><span class="p">)]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="SeismicVolume.apply_scaling_factors-1341"><a href="#-1341"><span class="linenos">1341</span></a>            <span class="n">props</span><span class="o">.</span><span class="n">vp_ff</span><span class="p">[(</span><span class="n">ng</span> <span class="o">&gt;</span> <span class="mf">1.0e-2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lith</span> <span class="o">&lt;</span> <span class="mf">2.0</span><span class="p">)]</span> <span class="o">*</span> <span class="n">vp_factor_sand</span>
</span><span id="SeismicVolume.apply_scaling_factors-1342"><a href="#-1342"><span class="linenos">1342</span></a>        <span class="p">)</span>
</span><span id="SeismicVolume.apply_scaling_factors-1343"><a href="#-1343"><span class="linenos">1343</span></a>        <span class="n">props</span><span class="o">.</span><span class="n">vs_ff</span><span class="p">[(</span><span class="n">ng</span> <span class="o">&gt;</span> <span class="mf">1.0e-2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lith</span> <span class="o">&lt;</span> <span class="mf">2.0</span><span class="p">)]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="SeismicVolume.apply_scaling_factors-1344"><a href="#-1344"><span class="linenos">1344</span></a>            <span class="n">props</span><span class="o">.</span><span class="n">vs_ff</span><span class="p">[(</span><span class="n">ng</span> <span class="o">&gt;</span> <span class="mf">1.0e-2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lith</span> <span class="o">&lt;</span> <span class="mf">2.0</span><span class="p">)]</span> <span class="o">*</span> <span class="n">vs_factor_sand</span>
</span><span id="SeismicVolume.apply_scaling_factors-1345"><a href="#-1345"><span class="linenos">1345</span></a>        <span class="p">)</span>
</span><span id="SeismicVolume.apply_scaling_factors-1346"><a href="#-1346"><span class="linenos">1346</span></a>        <span class="k">return</span> <span class="n">props</span>
</span></pre></div>


            <div class="docstring"><p>Apply final random scaling factors to sands and shales</p>
</div>


                            </div>
                            <div id="SeismicVolume.write_property_volumes_to_disk" class="classattr">
                                        <input id="SeismicVolume.write_property_volumes_to_disk-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">write_property_volumes_to_disk</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SeismicVolume.write_property_volumes_to_disk-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SeismicVolume.write_property_volumes_to_disk"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SeismicVolume.write_property_volumes_to_disk-1348"><a href="#-1348"><span class="linenos">1348</span></a>    <span class="k">def</span> <span class="nf">write_property_volumes_to_disk</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="SeismicVolume.write_property_volumes_to_disk-1349"><a href="#-1349"><span class="linenos">1349</span></a>        <span class="sd">&quot;&quot;&quot;Write Rho, Vp, Vs volumes to disk.&quot;&quot;&quot;</span>
</span><span id="SeismicVolume.write_property_volumes_to_disk-1350"><a href="#-1350"><span class="linenos">1350</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">write_cube_to_disk</span><span class="p">(</span>
</span><span id="SeismicVolume.write_property_volumes_to_disk-1351"><a href="#-1351"><span class="linenos">1351</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">rho</span><span class="p">[:],</span>
</span><span id="SeismicVolume.write_property_volumes_to_disk-1352"><a href="#-1352"><span class="linenos">1352</span></a>            <span class="s2">&quot;qc_volume_rho&quot;</span><span class="p">,</span>
</span><span id="SeismicVolume.write_property_volumes_to_disk-1353"><a href="#-1353"><span class="linenos">1353</span></a>        <span class="p">)</span>
</span><span id="SeismicVolume.write_property_volumes_to_disk-1354"><a href="#-1354"><span class="linenos">1354</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">write_cube_to_disk</span><span class="p">(</span>
</span><span id="SeismicVolume.write_property_volumes_to_disk-1355"><a href="#-1355"><span class="linenos">1355</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">vp</span><span class="p">[:],</span>
</span><span id="SeismicVolume.write_property_volumes_to_disk-1356"><a href="#-1356"><span class="linenos">1356</span></a>            <span class="s2">&quot;qc_volume_vp&quot;</span><span class="p">,</span>
</span><span id="SeismicVolume.write_property_volumes_to_disk-1357"><a href="#-1357"><span class="linenos">1357</span></a>        <span class="p">)</span>
</span><span id="SeismicVolume.write_property_volumes_to_disk-1358"><a href="#-1358"><span class="linenos">1358</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">write_cube_to_disk</span><span class="p">(</span>
</span><span id="SeismicVolume.write_property_volumes_to_disk-1359"><a href="#-1359"><span class="linenos">1359</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">vs</span><span class="p">[:],</span>
</span><span id="SeismicVolume.write_property_volumes_to_disk-1360"><a href="#-1360"><span class="linenos">1360</span></a>            <span class="s2">&quot;qc_volume_vs&quot;</span><span class="p">,</span>
</span><span id="SeismicVolume.write_property_volumes_to_disk-1361"><a href="#-1361"><span class="linenos">1361</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Write Rho, Vp, Vs volumes to disk.</p>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="Geomodels.html#Geomodel">datagenerator.Geomodels.Geomodel</a></dt>
                                <dd id="SeismicVolume.build_unfaulted_geomodels" class="function"><a href="Geomodels.html#Geomodel.build_unfaulted_geomodels">build_unfaulted_geomodels</a></dd>
                <dd id="SeismicVolume.infilled_cube_shape" class="function"><a href="Geomodels.html#Geomodel.infilled_cube_shape">infilled_cube_shape</a></dd>
                <dd id="SeismicVolume.build_meshgrid" class="function"><a href="Geomodels.html#Geomodel.build_meshgrid">build_meshgrid</a></dd>
                <dd id="SeismicVolume.create_geologic_age_3d_from_infilled_horizons" class="function"><a href="Geomodels.html#Geomodel.create_geologic_age_3d_from_infilled_horizons">create_geologic_age_3d_from_infilled_horizons</a></dd>
                <dd id="SeismicVolume.vertical_anti_alias_filter_simple" class="function"><a href="Geomodels.html#Geomodel.vertical_anti_alias_filter_simple">vertical_anti_alias_filter_simple</a></dd>
                <dd id="SeismicVolume.vertical_anti_alias_filter" class="function"><a href="Geomodels.html#Geomodel.vertical_anti_alias_filter">vertical_anti_alias_filter</a></dd>
                <dd id="SeismicVolume.plot_channels" class="function"><a href="Geomodels.html#Geomodel.plot_channels">plot_channels</a></dd>
                <dd id="SeismicVolume.insert_onlap_surfaces" class="function"><a href="Geomodels.html#Geomodel.insert_onlap_surfaces">insert_onlap_surfaces</a></dd>
                <dd id="SeismicVolume.write_cube_to_disk" class="function"><a href="Geomodels.html#Geomodel.write_cube_to_disk">write_cube_to_disk</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="ElasticProperties3D">
                            <input id="ElasticProperties3D-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">ElasticProperties3D</span>:

                <label class="view-source-button" for="ElasticProperties3D-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ElasticProperties3D"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ElasticProperties3D-1364"><a href="#-1364"><span class="linenos">1364</span></a><span class="k">class</span> <span class="nc">ElasticProperties3D</span><span class="p">:</span>
</span><span id="ElasticProperties3D-1365"><a href="#-1365"><span class="linenos">1365</span></a>    <span class="sd">&quot;&quot;&quot;Empty class to hold 3D property cubes Rho, Vp, Vs, Rho_ff, Vp_ff, Vs_ff and sum_net&quot;&quot;&quot;</span>
</span><span id="ElasticProperties3D-1366"><a href="#-1366"><span class="linenos">1366</span></a>
</span><span id="ElasticProperties3D-1367"><a href="#-1367"><span class="linenos">1367</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="ElasticProperties3D-1368"><a href="#-1368"><span class="linenos">1368</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">rho</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ElasticProperties3D-1369"><a href="#-1369"><span class="linenos">1369</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vp</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ElasticProperties3D-1370"><a href="#-1370"><span class="linenos">1370</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vs</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ElasticProperties3D-1371"><a href="#-1371"><span class="linenos">1371</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">rho_ff</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ElasticProperties3D-1372"><a href="#-1372"><span class="linenos">1372</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vp_ff</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ElasticProperties3D-1373"><a href="#-1373"><span class="linenos">1373</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vs_ff</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ElasticProperties3D-1374"><a href="#-1374"><span class="linenos">1374</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sum_net</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ElasticProperties3D-1375"><a href="#-1375"><span class="linenos">1375</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">rho_not_random</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ElasticProperties3D-1376"><a href="#-1376"><span class="linenos">1376</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vp_not_random</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ElasticProperties3D-1377"><a href="#-1377"><span class="linenos">1377</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vs_not_random</span> <span class="o">=</span> <span class="kc">None</span>
</span></pre></div>


            <div class="docstring"><p>Empty class to hold 3D property cubes Rho, Vp, Vs, Rho_ff, Vp_ff, Vs_ff and sum_net</p>
</div>


                            <div id="ElasticProperties3D.__init__" class="classattr">
                                        <input id="ElasticProperties3D.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">ElasticProperties3D</span><span class="signature pdoc-code condensed">()</span>

                <label class="view-source-button" for="ElasticProperties3D.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ElasticProperties3D.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ElasticProperties3D.__init__-1367"><a href="#-1367"><span class="linenos">1367</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="ElasticProperties3D.__init__-1368"><a href="#-1368"><span class="linenos">1368</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">rho</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ElasticProperties3D.__init__-1369"><a href="#-1369"><span class="linenos">1369</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vp</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ElasticProperties3D.__init__-1370"><a href="#-1370"><span class="linenos">1370</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vs</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ElasticProperties3D.__init__-1371"><a href="#-1371"><span class="linenos">1371</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">rho_ff</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ElasticProperties3D.__init__-1372"><a href="#-1372"><span class="linenos">1372</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vp_ff</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ElasticProperties3D.__init__-1373"><a href="#-1373"><span class="linenos">1373</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vs_ff</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ElasticProperties3D.__init__-1374"><a href="#-1374"><span class="linenos">1374</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sum_net</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ElasticProperties3D.__init__-1375"><a href="#-1375"><span class="linenos">1375</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">rho_not_random</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ElasticProperties3D.__init__-1376"><a href="#-1376"><span class="linenos">1376</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vp_not_random</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ElasticProperties3D.__init__-1377"><a href="#-1377"><span class="linenos">1377</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vs_not_random</span> <span class="o">=</span> <span class="kc">None</span>
</span></pre></div>


    

                            </div>
                </section>
                <section id="RFC">
                            <input id="RFC-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">RFC</span>:

                <label class="view-source-button" for="RFC-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#RFC"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="RFC-1380"><a href="#-1380"><span class="linenos">1380</span></a><span class="k">class</span> <span class="nc">RFC</span><span class="p">:</span>
</span><span id="RFC-1381"><a href="#-1381"><span class="linenos">1381</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="RFC-1382"><a href="#-1382"><span class="linenos">1382</span></a><span class="sd">    Reflection Coefficient object</span>
</span><span id="RFC-1383"><a href="#-1383"><span class="linenos">1383</span></a><span class="sd">    Contains methods for calculating the reflection coefficient at an interface</span>
</span><span id="RFC-1384"><a href="#-1384"><span class="linenos">1384</span></a><span class="sd">    from input Vp, Vs, Rho and incident angle</span>
</span><span id="RFC-1385"><a href="#-1385"><span class="linenos">1385</span></a><span class="sd">    Angle should be given in degrees and is converted to radians internally</span>
</span><span id="RFC-1386"><a href="#-1386"><span class="linenos">1386</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="RFC-1387"><a href="#-1387"><span class="linenos">1387</span></a>
</span><span id="RFC-1388"><a href="#-1388"><span class="linenos">1388</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="RFC-1389"><a href="#-1389"><span class="linenos">1389</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">vp_upper</span><span class="p">,</span> <span class="n">vs_upper</span><span class="p">,</span> <span class="n">rho_upper</span><span class="p">,</span> <span class="n">vp_lower</span><span class="p">,</span> <span class="n">vs_lower</span><span class="p">,</span> <span class="n">rho_lower</span><span class="p">,</span> <span class="n">theta</span>
</span><span id="RFC-1390"><a href="#-1390"><span class="linenos">1390</span></a>    <span class="p">):</span>
</span><span id="RFC-1391"><a href="#-1391"><span class="linenos">1391</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">theta</span> <span class="o">=</span> <span class="n">theta</span>
</span><span id="RFC-1392"><a href="#-1392"><span class="linenos">1392</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vp_upper</span> <span class="o">=</span> <span class="n">vp_upper</span>
</span><span id="RFC-1393"><a href="#-1393"><span class="linenos">1393</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vs_upper</span> <span class="o">=</span> <span class="n">vs_upper</span>
</span><span id="RFC-1394"><a href="#-1394"><span class="linenos">1394</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">rho_upper</span> <span class="o">=</span> <span class="n">rho_upper</span>
</span><span id="RFC-1395"><a href="#-1395"><span class="linenos">1395</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vp_lower</span> <span class="o">=</span> <span class="n">vp_lower</span>
</span><span id="RFC-1396"><a href="#-1396"><span class="linenos">1396</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vs_lower</span> <span class="o">=</span> <span class="n">vs_lower</span>
</span><span id="RFC-1397"><a href="#-1397"><span class="linenos">1397</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">rho_lower</span> <span class="o">=</span> <span class="n">rho_lower</span>
</span><span id="RFC-1398"><a href="#-1398"><span class="linenos">1398</span></a>
</span><span id="RFC-1399"><a href="#-1399"><span class="linenos">1399</span></a>    <span class="k">def</span> <span class="nf">normal_incidence_rfc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="RFC-1400"><a href="#-1400"><span class="linenos">1400</span></a>        <span class="n">z0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rho_upper</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">vp_upper</span>
</span><span id="RFC-1401"><a href="#-1401"><span class="linenos">1401</span></a>        <span class="n">z1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rho_lower</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">vp_lower</span>
</span><span id="RFC-1402"><a href="#-1402"><span class="linenos">1402</span></a>        <span class="k">return</span> <span class="p">(</span><span class="n">z1</span> <span class="o">-</span> <span class="n">z0</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">z1</span> <span class="o">+</span> <span class="n">z0</span><span class="p">)</span>
</span><span id="RFC-1403"><a href="#-1403"><span class="linenos">1403</span></a>
</span><span id="RFC-1404"><a href="#-1404"><span class="linenos">1404</span></a>    <span class="k">def</span> <span class="nf">shuey</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="RFC-1405"><a href="#-1405"><span class="linenos">1405</span></a>        <span class="sd">&quot;&quot;&quot;Use 3-term Shuey to calculate RFC.&quot;&quot;&quot;</span>
</span><span id="RFC-1406"><a href="#-1406"><span class="linenos">1406</span></a>        <span class="n">radians</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_degrees_to_radians</span><span class="p">()</span>  <span class="c1"># Angle to radians</span>
</span><span id="RFC-1407"><a href="#-1407"><span class="linenos">1407</span></a>        <span class="n">sin_squared</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">radians</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
</span><span id="RFC-1408"><a href="#-1408"><span class="linenos">1408</span></a>        <span class="n">tan_squared</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">radians</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
</span><span id="RFC-1409"><a href="#-1409"><span class="linenos">1409</span></a>
</span><span id="RFC-1410"><a href="#-1410"><span class="linenos">1410</span></a>        <span class="c1"># Delta Vp, Vs, Rho</span>
</span><span id="RFC-1411"><a href="#-1411"><span class="linenos">1411</span></a>        <span class="n">d_vp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vp_lower</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">vp_upper</span>
</span><span id="RFC-1412"><a href="#-1412"><span class="linenos">1412</span></a>        <span class="n">d_vs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vs_lower</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">vs_upper</span>
</span><span id="RFC-1413"><a href="#-1413"><span class="linenos">1413</span></a>        <span class="n">d_rho</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rho_lower</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">rho_upper</span>
</span><span id="RFC-1414"><a href="#-1414"><span class="linenos">1414</span></a>        <span class="n">avg_vp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">vp_lower</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">vp_upper</span><span class="p">])</span>
</span><span id="RFC-1415"><a href="#-1415"><span class="linenos">1415</span></a>        <span class="n">avg_vs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">vs_lower</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">vs_upper</span><span class="p">])</span>
</span><span id="RFC-1416"><a href="#-1416"><span class="linenos">1416</span></a>        <span class="n">avg_rho</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">rho_lower</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rho_upper</span><span class="p">])</span>
</span><span id="RFC-1417"><a href="#-1417"><span class="linenos">1417</span></a>
</span><span id="RFC-1418"><a href="#-1418"><span class="linenos">1418</span></a>        <span class="c1"># 3 Term Shuey</span>
</span><span id="RFC-1419"><a href="#-1419"><span class="linenos">1419</span></a>        <span class="n">r0</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">d_vp</span> <span class="o">/</span> <span class="n">avg_vp</span> <span class="o">+</span> <span class="n">d_rho</span> <span class="o">/</span> <span class="n">avg_rho</span><span class="p">)</span>
</span><span id="RFC-1420"><a href="#-1420"><span class="linenos">1420</span></a>        <span class="n">g</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">d_vp</span> <span class="o">/</span> <span class="n">avg_vp</span><span class="p">)</span> <span class="o">-</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">avg_vs</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">avg_vp</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span>
</span><span id="RFC-1421"><a href="#-1421"><span class="linenos">1421</span></a>            <span class="n">d_rho</span> <span class="o">/</span> <span class="n">avg_rho</span> <span class="o">+</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">d_vs</span> <span class="o">/</span> <span class="n">avg_vs</span>
</span><span id="RFC-1422"><a href="#-1422"><span class="linenos">1422</span></a>        <span class="p">)</span>
</span><span id="RFC-1423"><a href="#-1423"><span class="linenos">1423</span></a>        <span class="n">f</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">d_vp</span> <span class="o">/</span> <span class="n">avg_vp</span><span class="p">)</span>
</span><span id="RFC-1424"><a href="#-1424"><span class="linenos">1424</span></a>
</span><span id="RFC-1425"><a href="#-1425"><span class="linenos">1425</span></a>        <span class="k">return</span> <span class="n">r0</span> <span class="o">+</span> <span class="n">g</span> <span class="o">*</span> <span class="n">sin_squared</span> <span class="o">+</span> <span class="n">f</span> <span class="o">*</span> <span class="p">(</span><span class="n">tan_squared</span> <span class="o">-</span> <span class="n">sin_squared</span><span class="p">)</span>
</span><span id="RFC-1426"><a href="#-1426"><span class="linenos">1426</span></a>
</span><span id="RFC-1427"><a href="#-1427"><span class="linenos">1427</span></a>    <span class="k">def</span> <span class="nf">zoeppritz_reflectivity</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="RFC-1428"><a href="#-1428"><span class="linenos">1428</span></a>        <span class="sd">&quot;&quot;&quot;Calculate PP reflectivity using Zoeppritz equation&quot;&quot;&quot;</span>
</span><span id="RFC-1429"><a href="#-1429"><span class="linenos">1429</span></a>        <span class="n">theta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_degrees_to_radians</span><span class="p">(</span>
</span><span id="RFC-1430"><a href="#-1430"><span class="linenos">1430</span></a>            <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;complex&quot;</span>
</span><span id="RFC-1431"><a href="#-1431"><span class="linenos">1431</span></a>        <span class="p">)</span>  <span class="c1"># Convert angle to radians, as complex value</span>
</span><span id="RFC-1432"><a href="#-1432"><span class="linenos">1432</span></a>        <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">vp_upper</span>  <span class="c1"># ray param</span>
</span><span id="RFC-1433"><a href="#-1433"><span class="linenos">1433</span></a>        <span class="n">theta2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arcsin</span><span class="p">(</span><span class="n">p</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">vp_lower</span><span class="p">)</span>  <span class="c1"># Transmission angle of P-wave</span>
</span><span id="RFC-1434"><a href="#-1434"><span class="linenos">1434</span></a>        <span class="n">phi1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arcsin</span><span class="p">(</span><span class="n">p</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">vs_upper</span><span class="p">)</span>  <span class="c1"># Reflection angle of converted S-wave</span>
</span><span id="RFC-1435"><a href="#-1435"><span class="linenos">1435</span></a>        <span class="n">phi2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arcsin</span><span class="p">(</span><span class="n">p</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">vs_lower</span><span class="p">)</span>  <span class="c1"># Transmission angle of converted S-wave</span>
</span><span id="RFC-1436"><a href="#-1436"><span class="linenos">1436</span></a>
</span><span id="RFC-1437"><a href="#-1437"><span class="linenos">1437</span></a>        <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rho_lower</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi2</span><span class="p">)</span> <span class="o">**</span> <span class="mf">2.0</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">rho_upper</span> <span class="o">*</span> <span class="p">(</span>
</span><span id="RFC-1438"><a href="#-1438"><span class="linenos">1438</span></a>            <span class="mi">1</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi1</span><span class="p">)</span> <span class="o">**</span> <span class="mf">2.0</span>
</span><span id="RFC-1439"><a href="#-1439"><span class="linenos">1439</span></a>        <span class="p">)</span>
</span><span id="RFC-1440"><a href="#-1440"><span class="linenos">1440</span></a>        <span class="n">b</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="RFC-1441"><a href="#-1441"><span class="linenos">1441</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">rho_lower</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi2</span><span class="p">)</span> <span class="o">**</span> <span class="mf">2.0</span><span class="p">)</span>
</span><span id="RFC-1442"><a href="#-1442"><span class="linenos">1442</span></a>            <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">rho_upper</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi1</span><span class="p">)</span> <span class="o">**</span> <span class="mf">2.0</span>
</span><span id="RFC-1443"><a href="#-1443"><span class="linenos">1443</span></a>        <span class="p">)</span>
</span><span id="RFC-1444"><a href="#-1444"><span class="linenos">1444</span></a>        <span class="n">c</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="RFC-1445"><a href="#-1445"><span class="linenos">1445</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">rho_upper</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi1</span><span class="p">)</span> <span class="o">**</span> <span class="mf">2.0</span><span class="p">)</span>
</span><span id="RFC-1446"><a href="#-1446"><span class="linenos">1446</span></a>            <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">rho_lower</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi2</span><span class="p">)</span> <span class="o">**</span> <span class="mf">2.0</span>
</span><span id="RFC-1447"><a href="#-1447"><span class="linenos">1447</span></a>        <span class="p">)</span>
</span><span id="RFC-1448"><a href="#-1448"><span class="linenos">1448</span></a>        <span class="n">d</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span>
</span><span id="RFC-1449"><a href="#-1449"><span class="linenos">1449</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">rho_lower</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">vs_lower</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">rho_upper</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">vs_upper</span> <span class="o">**</span> <span class="mi">2</span>
</span><span id="RFC-1450"><a href="#-1450"><span class="linenos">1450</span></a>        <span class="p">)</span>
</span><span id="RFC-1451"><a href="#-1451"><span class="linenos">1451</span></a>
</span><span id="RFC-1452"><a href="#-1452"><span class="linenos">1452</span></a>        <span class="n">e</span> <span class="o">=</span> <span class="p">(</span><span class="n">b</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">vp_upper</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">c</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta2</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">vp_lower</span><span class="p">)</span>
</span><span id="RFC-1453"><a href="#-1453"><span class="linenos">1453</span></a>        <span class="n">f</span> <span class="o">=</span> <span class="p">(</span><span class="n">b</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi1</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">vs_upper</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">c</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi2</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">vs_lower</span><span class="p">)</span>
</span><span id="RFC-1454"><a href="#-1454"><span class="linenos">1454</span></a>        <span class="n">g</span> <span class="o">=</span> <span class="n">a</span> <span class="o">-</span> <span class="n">d</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">vp_upper</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi2</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">vs_lower</span>
</span><span id="RFC-1455"><a href="#-1455"><span class="linenos">1455</span></a>        <span class="n">h</span> <span class="o">=</span> <span class="n">a</span> <span class="o">-</span> <span class="n">d</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta2</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">vp_lower</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi1</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">vs_upper</span>
</span><span id="RFC-1456"><a href="#-1456"><span class="linenos">1456</span></a>
</span><span id="RFC-1457"><a href="#-1457"><span class="linenos">1457</span></a>        <span class="n">d</span> <span class="o">=</span> <span class="n">e</span> <span class="o">*</span> <span class="n">f</span> <span class="o">+</span> <span class="n">g</span> <span class="o">*</span> <span class="n">h</span> <span class="o">*</span> <span class="n">p</span> <span class="o">**</span> <span class="mi">2</span>
</span><span id="RFC-1458"><a href="#-1458"><span class="linenos">1458</span></a>
</span><span id="RFC-1459"><a href="#-1459"><span class="linenos">1459</span></a>        <span class="n">zoep_pp</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="RFC-1460"><a href="#-1460"><span class="linenos">1460</span></a>            <span class="n">f</span>
</span><span id="RFC-1461"><a href="#-1461"><span class="linenos">1461</span></a>            <span class="o">*</span> <span class="p">(</span>
</span><span id="RFC-1462"><a href="#-1462"><span class="linenos">1462</span></a>                <span class="n">b</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">vp_upper</span><span class="p">)</span>
</span><span id="RFC-1463"><a href="#-1463"><span class="linenos">1463</span></a>                <span class="o">-</span> <span class="n">c</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta2</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">vp_lower</span><span class="p">)</span>
</span><span id="RFC-1464"><a href="#-1464"><span class="linenos">1464</span></a>            <span class="p">)</span>
</span><span id="RFC-1465"><a href="#-1465"><span class="linenos">1465</span></a>            <span class="o">-</span> <span class="n">h</span>
</span><span id="RFC-1466"><a href="#-1466"><span class="linenos">1466</span></a>            <span class="o">*</span> <span class="n">p</span> <span class="o">**</span> <span class="mi">2</span>
</span><span id="RFC-1467"><a href="#-1467"><span class="linenos">1467</span></a>            <span class="o">*</span> <span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">d</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">vp_upper</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi2</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">vs_lower</span><span class="p">))</span>
</span><span id="RFC-1468"><a href="#-1468"><span class="linenos">1468</span></a>        <span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">d</span><span class="p">)</span>
</span><span id="RFC-1469"><a href="#-1469"><span class="linenos">1469</span></a>
</span><span id="RFC-1470"><a href="#-1470"><span class="linenos">1470</span></a>        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">zoep_pp</span><span class="p">)</span>
</span><span id="RFC-1471"><a href="#-1471"><span class="linenos">1471</span></a>
</span><span id="RFC-1472"><a href="#-1472"><span class="linenos">1472</span></a>    <span class="k">def</span> <span class="nf">_degrees_to_radians</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;float&quot;</span><span class="p">):</span>
</span><span id="RFC-1473"><a href="#-1473"><span class="linenos">1473</span></a>        <span class="sd">&quot;&quot;&quot;Convert angle in degrees to ange in radians. If dtype != &#39;float&#39;, return a complex dtype array&quot;&quot;&quot;</span>
</span><span id="RFC-1474"><a href="#-1474"><span class="linenos">1474</span></a>        <span class="k">if</span> <span class="n">dtype</span> <span class="o">==</span> <span class="s2">&quot;float&quot;</span><span class="p">:</span>
</span><span id="RFC-1475"><a href="#-1475"><span class="linenos">1475</span></a>            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">)</span>
</span><span id="RFC-1476"><a href="#-1476"><span class="linenos">1476</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="RFC-1477"><a href="#-1477"><span class="linenos">1477</span></a>            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">complex</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Reflection Coefficient object
Contains methods for calculating the reflection coefficient at an interface
from input Vp, Vs, Rho and incident angle
Angle should be given in degrees and is converted to radians internally</p>
</div>


                            <div id="RFC.__init__" class="classattr">
                                        <input id="RFC.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">RFC</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">vp_upper</span>, </span><span class="param"><span class="n">vs_upper</span>, </span><span class="param"><span class="n">rho_upper</span>, </span><span class="param"><span class="n">vp_lower</span>, </span><span class="param"><span class="n">vs_lower</span>, </span><span class="param"><span class="n">rho_lower</span>, </span><span class="param"><span class="n">theta</span></span>)</span>

                <label class="view-source-button" for="RFC.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#RFC.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="RFC.__init__-1388"><a href="#-1388"><span class="linenos">1388</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="RFC.__init__-1389"><a href="#-1389"><span class="linenos">1389</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">vp_upper</span><span class="p">,</span> <span class="n">vs_upper</span><span class="p">,</span> <span class="n">rho_upper</span><span class="p">,</span> <span class="n">vp_lower</span><span class="p">,</span> <span class="n">vs_lower</span><span class="p">,</span> <span class="n">rho_lower</span><span class="p">,</span> <span class="n">theta</span>
</span><span id="RFC.__init__-1390"><a href="#-1390"><span class="linenos">1390</span></a>    <span class="p">):</span>
</span><span id="RFC.__init__-1391"><a href="#-1391"><span class="linenos">1391</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">theta</span> <span class="o">=</span> <span class="n">theta</span>
</span><span id="RFC.__init__-1392"><a href="#-1392"><span class="linenos">1392</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vp_upper</span> <span class="o">=</span> <span class="n">vp_upper</span>
</span><span id="RFC.__init__-1393"><a href="#-1393"><span class="linenos">1393</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vs_upper</span> <span class="o">=</span> <span class="n">vs_upper</span>
</span><span id="RFC.__init__-1394"><a href="#-1394"><span class="linenos">1394</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">rho_upper</span> <span class="o">=</span> <span class="n">rho_upper</span>
</span><span id="RFC.__init__-1395"><a href="#-1395"><span class="linenos">1395</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vp_lower</span> <span class="o">=</span> <span class="n">vp_lower</span>
</span><span id="RFC.__init__-1396"><a href="#-1396"><span class="linenos">1396</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vs_lower</span> <span class="o">=</span> <span class="n">vs_lower</span>
</span><span id="RFC.__init__-1397"><a href="#-1397"><span class="linenos">1397</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">rho_lower</span> <span class="o">=</span> <span class="n">rho_lower</span>
</span></pre></div>


    

                            </div>
                            <div id="RFC.normal_incidence_rfc" class="classattr">
                                        <input id="RFC.normal_incidence_rfc-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">normal_incidence_rfc</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="RFC.normal_incidence_rfc-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#RFC.normal_incidence_rfc"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="RFC.normal_incidence_rfc-1399"><a href="#-1399"><span class="linenos">1399</span></a>    <span class="k">def</span> <span class="nf">normal_incidence_rfc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="RFC.normal_incidence_rfc-1400"><a href="#-1400"><span class="linenos">1400</span></a>        <span class="n">z0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rho_upper</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">vp_upper</span>
</span><span id="RFC.normal_incidence_rfc-1401"><a href="#-1401"><span class="linenos">1401</span></a>        <span class="n">z1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rho_lower</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">vp_lower</span>
</span><span id="RFC.normal_incidence_rfc-1402"><a href="#-1402"><span class="linenos">1402</span></a>        <span class="k">return</span> <span class="p">(</span><span class="n">z1</span> <span class="o">-</span> <span class="n">z0</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">z1</span> <span class="o">+</span> <span class="n">z0</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="RFC.shuey" class="classattr">
                                        <input id="RFC.shuey-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">shuey</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="RFC.shuey-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#RFC.shuey"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="RFC.shuey-1404"><a href="#-1404"><span class="linenos">1404</span></a>    <span class="k">def</span> <span class="nf">shuey</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="RFC.shuey-1405"><a href="#-1405"><span class="linenos">1405</span></a>        <span class="sd">&quot;&quot;&quot;Use 3-term Shuey to calculate RFC.&quot;&quot;&quot;</span>
</span><span id="RFC.shuey-1406"><a href="#-1406"><span class="linenos">1406</span></a>        <span class="n">radians</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_degrees_to_radians</span><span class="p">()</span>  <span class="c1"># Angle to radians</span>
</span><span id="RFC.shuey-1407"><a href="#-1407"><span class="linenos">1407</span></a>        <span class="n">sin_squared</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">radians</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
</span><span id="RFC.shuey-1408"><a href="#-1408"><span class="linenos">1408</span></a>        <span class="n">tan_squared</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">radians</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
</span><span id="RFC.shuey-1409"><a href="#-1409"><span class="linenos">1409</span></a>
</span><span id="RFC.shuey-1410"><a href="#-1410"><span class="linenos">1410</span></a>        <span class="c1"># Delta Vp, Vs, Rho</span>
</span><span id="RFC.shuey-1411"><a href="#-1411"><span class="linenos">1411</span></a>        <span class="n">d_vp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vp_lower</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">vp_upper</span>
</span><span id="RFC.shuey-1412"><a href="#-1412"><span class="linenos">1412</span></a>        <span class="n">d_vs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vs_lower</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">vs_upper</span>
</span><span id="RFC.shuey-1413"><a href="#-1413"><span class="linenos">1413</span></a>        <span class="n">d_rho</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rho_lower</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">rho_upper</span>
</span><span id="RFC.shuey-1414"><a href="#-1414"><span class="linenos">1414</span></a>        <span class="n">avg_vp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">vp_lower</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">vp_upper</span><span class="p">])</span>
</span><span id="RFC.shuey-1415"><a href="#-1415"><span class="linenos">1415</span></a>        <span class="n">avg_vs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">vs_lower</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">vs_upper</span><span class="p">])</span>
</span><span id="RFC.shuey-1416"><a href="#-1416"><span class="linenos">1416</span></a>        <span class="n">avg_rho</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">rho_lower</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rho_upper</span><span class="p">])</span>
</span><span id="RFC.shuey-1417"><a href="#-1417"><span class="linenos">1417</span></a>
</span><span id="RFC.shuey-1418"><a href="#-1418"><span class="linenos">1418</span></a>        <span class="c1"># 3 Term Shuey</span>
</span><span id="RFC.shuey-1419"><a href="#-1419"><span class="linenos">1419</span></a>        <span class="n">r0</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">d_vp</span> <span class="o">/</span> <span class="n">avg_vp</span> <span class="o">+</span> <span class="n">d_rho</span> <span class="o">/</span> <span class="n">avg_rho</span><span class="p">)</span>
</span><span id="RFC.shuey-1420"><a href="#-1420"><span class="linenos">1420</span></a>        <span class="n">g</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">d_vp</span> <span class="o">/</span> <span class="n">avg_vp</span><span class="p">)</span> <span class="o">-</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">avg_vs</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">avg_vp</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span>
</span><span id="RFC.shuey-1421"><a href="#-1421"><span class="linenos">1421</span></a>            <span class="n">d_rho</span> <span class="o">/</span> <span class="n">avg_rho</span> <span class="o">+</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">d_vs</span> <span class="o">/</span> <span class="n">avg_vs</span>
</span><span id="RFC.shuey-1422"><a href="#-1422"><span class="linenos">1422</span></a>        <span class="p">)</span>
</span><span id="RFC.shuey-1423"><a href="#-1423"><span class="linenos">1423</span></a>        <span class="n">f</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">d_vp</span> <span class="o">/</span> <span class="n">avg_vp</span><span class="p">)</span>
</span><span id="RFC.shuey-1424"><a href="#-1424"><span class="linenos">1424</span></a>
</span><span id="RFC.shuey-1425"><a href="#-1425"><span class="linenos">1425</span></a>        <span class="k">return</span> <span class="n">r0</span> <span class="o">+</span> <span class="n">g</span> <span class="o">*</span> <span class="n">sin_squared</span> <span class="o">+</span> <span class="n">f</span> <span class="o">*</span> <span class="p">(</span><span class="n">tan_squared</span> <span class="o">-</span> <span class="n">sin_squared</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Use 3-term Shuey to calculate RFC.</p>
</div>


                            </div>
                            <div id="RFC.zoeppritz_reflectivity" class="classattr">
                                        <input id="RFC.zoeppritz_reflectivity-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">zoeppritz_reflectivity</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="RFC.zoeppritz_reflectivity-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#RFC.zoeppritz_reflectivity"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="RFC.zoeppritz_reflectivity-1427"><a href="#-1427"><span class="linenos">1427</span></a>    <span class="k">def</span> <span class="nf">zoeppritz_reflectivity</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="RFC.zoeppritz_reflectivity-1428"><a href="#-1428"><span class="linenos">1428</span></a>        <span class="sd">&quot;&quot;&quot;Calculate PP reflectivity using Zoeppritz equation&quot;&quot;&quot;</span>
</span><span id="RFC.zoeppritz_reflectivity-1429"><a href="#-1429"><span class="linenos">1429</span></a>        <span class="n">theta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_degrees_to_radians</span><span class="p">(</span>
</span><span id="RFC.zoeppritz_reflectivity-1430"><a href="#-1430"><span class="linenos">1430</span></a>            <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;complex&quot;</span>
</span><span id="RFC.zoeppritz_reflectivity-1431"><a href="#-1431"><span class="linenos">1431</span></a>        <span class="p">)</span>  <span class="c1"># Convert angle to radians, as complex value</span>
</span><span id="RFC.zoeppritz_reflectivity-1432"><a href="#-1432"><span class="linenos">1432</span></a>        <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">vp_upper</span>  <span class="c1"># ray param</span>
</span><span id="RFC.zoeppritz_reflectivity-1433"><a href="#-1433"><span class="linenos">1433</span></a>        <span class="n">theta2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arcsin</span><span class="p">(</span><span class="n">p</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">vp_lower</span><span class="p">)</span>  <span class="c1"># Transmission angle of P-wave</span>
</span><span id="RFC.zoeppritz_reflectivity-1434"><a href="#-1434"><span class="linenos">1434</span></a>        <span class="n">phi1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arcsin</span><span class="p">(</span><span class="n">p</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">vs_upper</span><span class="p">)</span>  <span class="c1"># Reflection angle of converted S-wave</span>
</span><span id="RFC.zoeppritz_reflectivity-1435"><a href="#-1435"><span class="linenos">1435</span></a>        <span class="n">phi2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arcsin</span><span class="p">(</span><span class="n">p</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">vs_lower</span><span class="p">)</span>  <span class="c1"># Transmission angle of converted S-wave</span>
</span><span id="RFC.zoeppritz_reflectivity-1436"><a href="#-1436"><span class="linenos">1436</span></a>
</span><span id="RFC.zoeppritz_reflectivity-1437"><a href="#-1437"><span class="linenos">1437</span></a>        <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rho_lower</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi2</span><span class="p">)</span> <span class="o">**</span> <span class="mf">2.0</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">rho_upper</span> <span class="o">*</span> <span class="p">(</span>
</span><span id="RFC.zoeppritz_reflectivity-1438"><a href="#-1438"><span class="linenos">1438</span></a>            <span class="mi">1</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi1</span><span class="p">)</span> <span class="o">**</span> <span class="mf">2.0</span>
</span><span id="RFC.zoeppritz_reflectivity-1439"><a href="#-1439"><span class="linenos">1439</span></a>        <span class="p">)</span>
</span><span id="RFC.zoeppritz_reflectivity-1440"><a href="#-1440"><span class="linenos">1440</span></a>        <span class="n">b</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="RFC.zoeppritz_reflectivity-1441"><a href="#-1441"><span class="linenos">1441</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">rho_lower</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi2</span><span class="p">)</span> <span class="o">**</span> <span class="mf">2.0</span><span class="p">)</span>
</span><span id="RFC.zoeppritz_reflectivity-1442"><a href="#-1442"><span class="linenos">1442</span></a>            <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">rho_upper</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi1</span><span class="p">)</span> <span class="o">**</span> <span class="mf">2.0</span>
</span><span id="RFC.zoeppritz_reflectivity-1443"><a href="#-1443"><span class="linenos">1443</span></a>        <span class="p">)</span>
</span><span id="RFC.zoeppritz_reflectivity-1444"><a href="#-1444"><span class="linenos">1444</span></a>        <span class="n">c</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="RFC.zoeppritz_reflectivity-1445"><a href="#-1445"><span class="linenos">1445</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">rho_upper</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi1</span><span class="p">)</span> <span class="o">**</span> <span class="mf">2.0</span><span class="p">)</span>
</span><span id="RFC.zoeppritz_reflectivity-1446"><a href="#-1446"><span class="linenos">1446</span></a>            <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">rho_lower</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi2</span><span class="p">)</span> <span class="o">**</span> <span class="mf">2.0</span>
</span><span id="RFC.zoeppritz_reflectivity-1447"><a href="#-1447"><span class="linenos">1447</span></a>        <span class="p">)</span>
</span><span id="RFC.zoeppritz_reflectivity-1448"><a href="#-1448"><span class="linenos">1448</span></a>        <span class="n">d</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span>
</span><span id="RFC.zoeppritz_reflectivity-1449"><a href="#-1449"><span class="linenos">1449</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">rho_lower</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">vs_lower</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">rho_upper</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">vs_upper</span> <span class="o">**</span> <span class="mi">2</span>
</span><span id="RFC.zoeppritz_reflectivity-1450"><a href="#-1450"><span class="linenos">1450</span></a>        <span class="p">)</span>
</span><span id="RFC.zoeppritz_reflectivity-1451"><a href="#-1451"><span class="linenos">1451</span></a>
</span><span id="RFC.zoeppritz_reflectivity-1452"><a href="#-1452"><span class="linenos">1452</span></a>        <span class="n">e</span> <span class="o">=</span> <span class="p">(</span><span class="n">b</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">vp_upper</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">c</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta2</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">vp_lower</span><span class="p">)</span>
</span><span id="RFC.zoeppritz_reflectivity-1453"><a href="#-1453"><span class="linenos">1453</span></a>        <span class="n">f</span> <span class="o">=</span> <span class="p">(</span><span class="n">b</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi1</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">vs_upper</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">c</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi2</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">vs_lower</span><span class="p">)</span>
</span><span id="RFC.zoeppritz_reflectivity-1454"><a href="#-1454"><span class="linenos">1454</span></a>        <span class="n">g</span> <span class="o">=</span> <span class="n">a</span> <span class="o">-</span> <span class="n">d</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">vp_upper</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi2</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">vs_lower</span>
</span><span id="RFC.zoeppritz_reflectivity-1455"><a href="#-1455"><span class="linenos">1455</span></a>        <span class="n">h</span> <span class="o">=</span> <span class="n">a</span> <span class="o">-</span> <span class="n">d</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta2</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">vp_lower</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi1</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">vs_upper</span>
</span><span id="RFC.zoeppritz_reflectivity-1456"><a href="#-1456"><span class="linenos">1456</span></a>
</span><span id="RFC.zoeppritz_reflectivity-1457"><a href="#-1457"><span class="linenos">1457</span></a>        <span class="n">d</span> <span class="o">=</span> <span class="n">e</span> <span class="o">*</span> <span class="n">f</span> <span class="o">+</span> <span class="n">g</span> <span class="o">*</span> <span class="n">h</span> <span class="o">*</span> <span class="n">p</span> <span class="o">**</span> <span class="mi">2</span>
</span><span id="RFC.zoeppritz_reflectivity-1458"><a href="#-1458"><span class="linenos">1458</span></a>
</span><span id="RFC.zoeppritz_reflectivity-1459"><a href="#-1459"><span class="linenos">1459</span></a>        <span class="n">zoep_pp</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="RFC.zoeppritz_reflectivity-1460"><a href="#-1460"><span class="linenos">1460</span></a>            <span class="n">f</span>
</span><span id="RFC.zoeppritz_reflectivity-1461"><a href="#-1461"><span class="linenos">1461</span></a>            <span class="o">*</span> <span class="p">(</span>
</span><span id="RFC.zoeppritz_reflectivity-1462"><a href="#-1462"><span class="linenos">1462</span></a>                <span class="n">b</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">vp_upper</span><span class="p">)</span>
</span><span id="RFC.zoeppritz_reflectivity-1463"><a href="#-1463"><span class="linenos">1463</span></a>                <span class="o">-</span> <span class="n">c</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta2</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">vp_lower</span><span class="p">)</span>
</span><span id="RFC.zoeppritz_reflectivity-1464"><a href="#-1464"><span class="linenos">1464</span></a>            <span class="p">)</span>
</span><span id="RFC.zoeppritz_reflectivity-1465"><a href="#-1465"><span class="linenos">1465</span></a>            <span class="o">-</span> <span class="n">h</span>
</span><span id="RFC.zoeppritz_reflectivity-1466"><a href="#-1466"><span class="linenos">1466</span></a>            <span class="o">*</span> <span class="n">p</span> <span class="o">**</span> <span class="mi">2</span>
</span><span id="RFC.zoeppritz_reflectivity-1467"><a href="#-1467"><span class="linenos">1467</span></a>            <span class="o">*</span> <span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">d</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">vp_upper</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi2</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">vs_lower</span><span class="p">))</span>
</span><span id="RFC.zoeppritz_reflectivity-1468"><a href="#-1468"><span class="linenos">1468</span></a>        <span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">d</span><span class="p">)</span>
</span><span id="RFC.zoeppritz_reflectivity-1469"><a href="#-1469"><span class="linenos">1469</span></a>
</span><span id="RFC.zoeppritz_reflectivity-1470"><a href="#-1470"><span class="linenos">1470</span></a>        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">zoep_pp</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Calculate PP reflectivity using Zoeppritz equation</p>
</div>


                            </div>
                </section>
                <section id="derive_butterworth_bandpass">
                            <input id="derive_butterworth_bandpass-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">derive_butterworth_bandpass</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">lowcut</span>, </span><span class="param"><span class="n">highcut</span>, </span><span class="param"><span class="n">digitisation</span>, </span><span class="param"><span class="n">order</span><span class="o">=</span><span class="mi">4</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="derive_butterworth_bandpass-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#derive_butterworth_bandpass"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="derive_butterworth_bandpass-1480"><a href="#-1480"><span class="linenos">1480</span></a><span class="k">def</span> <span class="nf">derive_butterworth_bandpass</span><span class="p">(</span><span class="n">lowcut</span><span class="p">,</span> <span class="n">highcut</span><span class="p">,</span> <span class="n">digitisation</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">4</span><span class="p">):</span>
</span><span id="derive_butterworth_bandpass-1481"><a href="#-1481"><span class="linenos">1481</span></a>    <span class="kn">from</span> <span class="nn">scipy.signal</span> <span class="kn">import</span> <span class="n">butter</span>
</span><span id="derive_butterworth_bandpass-1482"><a href="#-1482"><span class="linenos">1482</span></a>
</span><span id="derive_butterworth_bandpass-1483"><a href="#-1483"><span class="linenos">1483</span></a>    <span class="n">fs</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="n">digitisation</span> <span class="o">/</span> <span class="mf">1000.0</span><span class="p">)</span>
</span><span id="derive_butterworth_bandpass-1484"><a href="#-1484"><span class="linenos">1484</span></a>    <span class="n">nyq</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">fs</span>
</span><span id="derive_butterworth_bandpass-1485"><a href="#-1485"><span class="linenos">1485</span></a>    <span class="n">low</span> <span class="o">=</span> <span class="n">lowcut</span> <span class="o">/</span> <span class="n">nyq</span>
</span><span id="derive_butterworth_bandpass-1486"><a href="#-1486"><span class="linenos">1486</span></a>    <span class="n">high</span> <span class="o">=</span> <span class="n">highcut</span> <span class="o">/</span> <span class="n">nyq</span>
</span><span id="derive_butterworth_bandpass-1487"><a href="#-1487"><span class="linenos">1487</span></a>    <span class="n">b</span><span class="p">,</span> <span class="n">a</span> <span class="o">=</span> <span class="n">butter</span><span class="p">(</span><span class="n">order</span><span class="p">,</span> <span class="p">[</span><span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="p">],</span> <span class="n">btype</span><span class="o">=</span><span class="s2">&quot;bandpass&quot;</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="s2">&quot;ba&quot;</span><span class="p">)</span>
</span><span id="derive_butterworth_bandpass-1488"><a href="#-1488"><span class="linenos">1488</span></a>    <span class="k">return</span> <span class="n">b</span><span class="p">,</span> <span class="n">a</span>
</span></pre></div>


    

                </section>
                <section id="apply_butterworth_bandpass">
                            <input id="apply_butterworth_bandpass-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">apply_butterworth_bandpass</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">data</span>, </span><span class="param"><span class="n">b</span>, </span><span class="param"><span class="n">a</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="apply_butterworth_bandpass-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#apply_butterworth_bandpass"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="apply_butterworth_bandpass-1491"><a href="#-1491"><span class="linenos">1491</span></a><span class="k">def</span> <span class="nf">apply_butterworth_bandpass</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
</span><span id="apply_butterworth_bandpass-1492"><a href="#-1492"><span class="linenos">1492</span></a>    <span class="sd">&quot;&quot;&quot;Apply Butterworth bandpass to data&quot;&quot;&quot;</span>
</span><span id="apply_butterworth_bandpass-1493"><a href="#-1493"><span class="linenos">1493</span></a>    <span class="kn">from</span> <span class="nn">scipy.signal</span> <span class="kn">import</span> <span class="n">tf2zpk</span><span class="p">,</span> <span class="n">filtfilt</span>
</span><span id="apply_butterworth_bandpass-1494"><a href="#-1494"><span class="linenos">1494</span></a>
</span><span id="apply_butterworth_bandpass-1495"><a href="#-1495"><span class="linenos">1495</span></a>    <span class="c1"># Use irlen to remove artefacts generated at base of cubes during bandlimitation</span>
</span><span id="apply_butterworth_bandpass-1496"><a href="#-1496"><span class="linenos">1496</span></a>    <span class="n">_</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">tf2zpk</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
</span><span id="apply_butterworth_bandpass-1497"><a href="#-1497"><span class="linenos">1497</span></a>    <span class="n">eps</span> <span class="o">=</span> <span class="mf">1e-9</span>
</span><span id="apply_butterworth_bandpass-1498"><a href="#-1498"><span class="linenos">1498</span></a>    <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">p</span><span class="p">))</span>
</span><span id="apply_butterworth_bandpass-1499"><a href="#-1499"><span class="linenos">1499</span></a>    <span class="n">approx_impulse_len</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">eps</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">r</span><span class="p">)))</span>
</span><span id="apply_butterworth_bandpass-1500"><a href="#-1500"><span class="linenos">1500</span></a>    <span class="n">y</span> <span class="o">=</span> <span class="n">filtfilt</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;gust&quot;</span><span class="p">,</span> <span class="n">irlen</span><span class="o">=</span><span class="n">approx_impulse_len</span><span class="p">)</span>
</span><span id="apply_butterworth_bandpass-1501"><a href="#-1501"><span class="linenos">1501</span></a>    <span class="c1"># y = filtfilt(b, a, data)</span>
</span><span id="apply_butterworth_bandpass-1502"><a href="#-1502"><span class="linenos">1502</span></a>    <span class="k">return</span> <span class="n">y</span>
</span></pre></div>


            <div class="docstring"><p>Apply Butterworth bandpass to data</p>
</div>


                </section>
                <section id="trim_triangular">
                            <input id="trim_triangular-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">trim_triangular</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">low</span>, </span><span class="param"><span class="n">mid</span>, </span><span class="param"><span class="n">high</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="trim_triangular-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#trim_triangular"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="trim_triangular-1505"><a href="#-1505"><span class="linenos">1505</span></a><span class="k">def</span> <span class="nf">trim_triangular</span><span class="p">(</span><span class="n">low</span><span class="p">,</span> <span class="n">mid</span><span class="p">,</span> <span class="n">high</span><span class="p">):</span>
</span><span id="trim_triangular-1506"><a href="#-1506"><span class="linenos">1506</span></a>    <span class="c1">###</span>
</span><span id="trim_triangular-1507"><a href="#-1507"><span class="linenos">1507</span></a>    <span class="c1">### use trimmed triangular distributions</span>
</span><span id="trim_triangular-1508"><a href="#-1508"><span class="linenos">1508</span></a>    <span class="c1">###</span>
</span><span id="trim_triangular-1509"><a href="#-1509"><span class="linenos">1509</span></a>    <span class="kn">from</span> <span class="nn">numpy.random</span> <span class="kn">import</span> <span class="n">triangular</span>
</span><span id="trim_triangular-1510"><a href="#-1510"><span class="linenos">1510</span></a>
</span><span id="trim_triangular-1511"><a href="#-1511"><span class="linenos">1511</span></a>    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">50</span><span class="p">):</span>
</span><span id="trim_triangular-1512"><a href="#-1512"><span class="linenos">1512</span></a>        <span class="n">num</span> <span class="o">=</span> <span class="n">triangular</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">low</span> <span class="o">-</span> <span class="n">mid</span><span class="p">,</span> <span class="n">mid</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">high</span> <span class="o">-</span> <span class="n">mid</span><span class="p">)</span>
</span><span id="trim_triangular-1513"><a href="#-1513"><span class="linenos">1513</span></a>        <span class="k">if</span> <span class="n">low</span> <span class="o">&lt;=</span> <span class="n">num</span> <span class="o">&lt;=</span> <span class="n">high</span><span class="p">:</span>
</span><span id="trim_triangular-1514"><a href="#-1514"><span class="linenos">1514</span></a>            <span class="k">break</span>
</span><span id="trim_triangular-1515"><a href="#-1515"><span class="linenos">1515</span></a>    <span class="k">return</span> <span class="n">num</span>
</span></pre></div>


    

                </section>
                <section id="apply_wavelet">
                            <input id="apply_wavelet-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">apply_wavelet</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">cube</span>, </span><span class="param"><span class="n">wavelet</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="apply_wavelet-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#apply_wavelet"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="apply_wavelet-1518"><a href="#-1518"><span class="linenos">1518</span></a><span class="k">def</span> <span class="nf">apply_wavelet</span><span class="p">(</span><span class="n">cube</span><span class="p">,</span> <span class="n">wavelet</span><span class="p">):</span>
</span><span id="apply_wavelet-1519"><a href="#-1519"><span class="linenos">1519</span></a>    <span class="n">filtered_cube</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">cube</span><span class="p">)</span>
</span><span id="apply_wavelet-1520"><a href="#-1520"><span class="linenos">1520</span></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">cube</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="apply_wavelet-1521"><a href="#-1521"><span class="linenos">1521</span></a>        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">cube</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
</span><span id="apply_wavelet-1522"><a href="#-1522"><span class="linenos">1522</span></a>            <span class="n">filtered_cube</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">convolve</span><span class="p">(</span><span class="n">cube</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="p">:],</span> <span class="n">wavelet</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;same&quot;</span><span class="p">)</span>
</span><span id="apply_wavelet-1523"><a href="#-1523"><span class="linenos">1523</span></a>    <span class="k">return</span> <span class="n">filtered_cube</span>
</span></pre></div>


    

                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "../search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `../${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.kind) {
                    case "function":
                        if (doc.fullname.endsWith(".__init__")) {
                            heading = `<span class="name">${doc.fullname.replace(/\.__init__$/, "")}</span>${doc.signature}`;
                        } else {
                            heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span>${doc.signature}`;
                        }
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value">${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.kind}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>